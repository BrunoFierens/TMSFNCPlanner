)]}'
{"version":3,"file":"TMSWeb_FNCPlanner.js","sources":["E:/TMS/TMS Web Core/Core Source/RTL/rtl.js","E:/TMS/TMS Web Core/Core Source/RTL/system.pas","E:/TMS/TMS Web Core/Core Source/RTL/rtlconsts.pas","E:/TMS/TMS Web Core/Core Source/RTL/types.pas","E:/TMS/TMS Web Core/Core Source/RTL/js.pas","E:/TMS/TMS Web Core/Core Source/RTL/sysutils.pas","E:/TMS/TMS Web Core/Core Source/RTL/classes.pas","E:/TMS/TMS Web Core/Core Source/RTL/web.pas","E:/TMS/TMS Web Core/Core Source/RTL/math.pas","E:/TMS/TMS Web Core/Core Source/RTL/contnrs.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Graphics.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.StdCtrls.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Controls.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Lang.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.ExtCtrls.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.WebTools.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Dialogs.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Forms.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCTypes.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCUtils.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCGraphicsTypes.pas","E:/TMS/TMS Web Core/Core Source/RTL/typinfo.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCCustomComponent.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCGraphics.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCBitmapContainer.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCHTMLEngine.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCGraphics.General.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCGraphics.WEB.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCStyles.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCCustomControl.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCPlannerBase.pas","E:/TMS/TMS Web Core/Core Source/RTL/dateutils.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCPlannerData.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCImage.pas","E:/TMS/TMS FNC Core/WEBLib.TMSFNCPopup.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCToolBarRes.pas","E:/TMS/TMS Web Core/Core Source/WEBLib.Menus.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCToolBar.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCToolBarPopup.pas","E:/TMS/TMS FNC UI Pack/WEBLib.TMSFNCPlanner.pas","E:/TMS/TMS Web Core/Demo/FNC/Planner/Overview/Unit1.pas","E:/TMS/TMS Web Core/Demo/FNC/Planner/Overview/TMSWeb_FNCPlanner.dpr"],"sourcesContent":["var pas = {};\r\n\r\nvar rtl = {\r\n\r\n  quiet: false,\r\n  debug_load_units: false,\r\n  debug_rtti: false,\r\n\r\n  debug: function(){\r\n    if (rtl.quiet || !console || !console.log) return;\r\n    console.log(arguments);\r\n  },\r\n\r\n  error: function(s){\r\n    rtl.debug('Error: ',s);\r\n    throw s;\r\n  },\r\n\r\n  warn: function(s){\r\n    rtl.debug('Warn: ',s);\r\n  },\r\n\r\n  hasString: function(s){\r\n    return rtl.isString(s) && (s.length>0);\r\n  },\r\n\r\n  isArray: function(a) {\r\n    return Array.isArray(a);\r\n  },\r\n\r\n  isFunction: function(f){\r\n    return typeof(f)===\"function\";\r\n  },\r\n\r\n  isModule: function(m){\r\n    return rtl.isObject(m) && rtl.hasString(m.$name) && (pas[m.$name]===m);\r\n  },\r\n\r\n  isImplementation: function(m){\r\n    return rtl.isObject(m) && rtl.isModule(m.$module) && (m.$module.$impl===m);\r\n  },\r\n\r\n  isNumber: function(n){\r\n    return typeof(n)===\"number\";\r\n  },\r\n\r\n  isObject: function(o){\r\n    var s=typeof(o);\r\n    return (typeof(o)===\"object\") && (o!=null);\r\n  },\r\n\r\n  isString: function(s){\r\n    return typeof(s)===\"string\";\r\n  },\r\n\r\n  getNumber: function(n){\r\n    return typeof(n)===\"number\"?n:NaN;\r\n  },\r\n\r\n  getChar: function(c){\r\n    return ((typeof(c)===\"string\") && (c.length===1)) ? c : \"\";\r\n  },\r\n\r\n  getObject: function(o){\r\n    return ((typeof(o)===\"object\") || (typeof(o)==='function')) ? o : null;\r\n  },\r\n\r\n  isPasClass: function(type){\r\n    return (rtl.isObject(type) && type.hasOwnProperty('$classname') && rtl.isObject(type.$module));\r\n  },\r\n\r\n  isPasClassInstance: function(type){\r\n    return (rtl.isObject(type) && rtl.isPasClass(type.$class));\r\n  },\r\n\r\n  hexStr: function(n,digits){\r\n    return (\"000000000000000\"+n.toString(16).toUpperCase()).slice(-digits);\r\n  },\r\n\r\n  m_loading: 0,\r\n  m_loading_intf: 1,\r\n  m_intf_loaded: 2,\r\n  m_loading_impl: 3, // loading all used unit\r\n  m_initializing: 4, // running initialization\r\n  m_initialized: 5,\r\n\r\n  module: function(module_name, intfuseslist, intfcode, impluseslist, implcode){\r\n    if (rtl.debug_load_units) rtl.debug('rtl.module name=\"'+module_name+'\" intfuses='+intfuseslist+' impluses='+impluseslist+' hasimplcode='+rtl.isFunction(implcode));\r\n    if (!rtl.hasString(module_name)) rtl.error('invalid module name \"'+module_name+'\"');\r\n    if (!rtl.isArray(intfuseslist)) rtl.error('invalid interface useslist of \"'+module_name+'\"');\r\n    if (!rtl.isFunction(intfcode)) rtl.error('invalid interface code of \"'+module_name+'\"');\r\n    if (!(impluseslist==undefined) && !rtl.isArray(impluseslist)) rtl.error('invalid implementation useslist of \"'+module_name+'\"');\r\n    if (!(implcode==undefined) && !rtl.isFunction(implcode)) rtl.error('invalid implementation code of \"'+module_name+'\"');\r\n\r\n    if (pas[module_name])\r\n      rtl.error('module \"'+module_name+'\" is already registered');\r\n\r\n    var module = pas[module_name] = {\r\n      $name: module_name,\r\n      $intfuseslist: intfuseslist,\r\n      $impluseslist: impluseslist,\r\n      $state: rtl.m_loading,\r\n      $intfcode: intfcode,\r\n      $implcode: implcode,\r\n      $impl: null,\r\n      $rtti: Object.create(rtl.tSectionRTTI)\r\n    };\r\n    module.$rtti.$module = module;\r\n    if (implcode) module.$impl = {\r\n      $module: module,\r\n      $rtti: module.$rtti\r\n    };\r\n  },\r\n\r\n  exitcode: 0,\r\n\r\n  run: function(module_name){\r\n  \r\n    function doRun(){\r\n      if (!rtl.hasString(module_name)) module_name='program';\r\n      if (rtl.debug_load_units) rtl.debug('rtl.run module=\"'+module_name+'\"');\r\n      rtl.initRTTI();\r\n      var module = pas[module_name];\r\n      if (!module) rtl.error('rtl.run module \"'+module_name+'\" missing');\r\n      rtl.loadintf(module);\r\n      rtl.loadimpl(module);\r\n      if (module_name=='program'){\r\n        if (rtl.debug_load_units) rtl.debug('running $main');\r\n        var r = pas.program.$main();\r\n        if (rtl.isNumber(r)) rtl.exitcode = r;\r\n      }\r\n    }\r\n    \r\n    if (rtl.showUncaughtExceptions) {\r\n      try{\r\n        doRun();\r\n      } catch(re) {\r\n        var errMsg = re.hasOwnProperty('$class') ? re.$class.$classname : '';\r\n\t    errMsg +=  ((errMsg) ? ': ' : '') + (re.hasOwnProperty('fMessage') ? re.fMessage : re);\r\n        alert('Uncaught Exception : '+errMsg);\r\n        rtl.exitCode = 216;\r\n      }\r\n    } else {\r\n      doRun();\r\n    }\r\n    return rtl.exitcode;\r\n  },\r\n\r\n  loadintf: function(module){\r\n    if (module.$state>rtl.m_loading_intf) return; // already finished\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: \"'+module.$name+'\"');\r\n    if (module.$state===rtl.m_loading_intf)\r\n      rtl.error('unit cycle detected \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_intf;\r\n    // load interfaces of interface useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadintf);\r\n    // run interface\r\n    if (rtl.debug_load_units) rtl.debug('loadintf: run intf of \"'+module.$name+'\"');\r\n    module.$intfcode(module.$intfuseslist);\r\n    // success\r\n    module.$state=rtl.m_intf_loaded;\r\n    // Note: units only used in implementations are not yet loaded (not even their interfaces)\r\n  },\r\n\r\n  loaduseslist: function(module,useslist,f){\r\n    if (useslist==undefined) return;\r\n    for (var i in useslist){\r\n      var unitname=useslist[i];\r\n      if (rtl.debug_load_units) rtl.debug('loaduseslist of \"'+module.$name+'\" uses=\"'+unitname+'\"');\r\n      if (pas[unitname]==undefined)\r\n        rtl.error('module \"'+module.$name+'\" misses \"'+unitname+'\"');\r\n      f(pas[unitname]);\r\n    }\r\n  },\r\n\r\n  loadimpl: function(module){\r\n    if (module.$state>=rtl.m_loading_impl) return; // already processing\r\n    if (module.$state<rtl.m_intf_loaded) rtl.error('loadimpl: interface not loaded of \"'+module.$name+'\"');\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: load uses of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_loading_impl;\r\n    // load interfaces of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadintf);\r\n    // load implementation of interfaces useslist\r\n    rtl.loaduseslist(module,module.$intfuseslist,rtl.loadimpl);\r\n    // load implementation of implementation useslist\r\n    rtl.loaduseslist(module,module.$impluseslist,rtl.loadimpl);\r\n    // Note: At this point all interfaces used by this unit are loaded. If\r\n    //   there are implementation uses cycles some used units might not yet be\r\n    //   initialized. This is by design.\r\n    // run implementation\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run impl of \"'+module.$name+'\"');\r\n    if (rtl.isFunction(module.$implcode)) module.$implcode(module.$impluseslist);\r\n    // run initialization\r\n    if (rtl.debug_load_units) rtl.debug('loadimpl: run init of \"'+module.$name+'\"');\r\n    module.$state=rtl.m_initializing;\r\n    if (rtl.isFunction(module.$init)) module.$init();\r\n    // unit initialized\r\n    module.$state=rtl.m_initialized;\r\n  },\r\n\r\n  createCallback: function(scope, fn){\r\n    var cb;\r\n    if (typeof(fn)==='string'){\r\n      cb = function(){\r\n        return scope[fn].apply(scope,arguments);\r\n      };\r\n    } else {\r\n      cb = function(){\r\n        return fn.apply(scope,arguments);\r\n      };\r\n    };\r\n    cb.scope = scope;\r\n    cb.fn = fn;\r\n    return cb;\r\n  },\r\n\r\n  cloneCallback: function(cb){\r\n    return rtl.createCallback(cb.scope,cb.fn);\r\n  },\r\n\r\n  eqCallback: function(a,b){\r\n    // can be a function or a function wrapper\r\n    if (a==b){\r\n      return true;\r\n    } else {\r\n      return (a!=null) && (b!=null) && (a.fn) && (a.scope===b.scope) && (a.fn==b.fn);\r\n    }\r\n  },\r\n\r\n  initClass: function(c,parent,name,initfn){\r\n    parent[name] = c;\r\n    c.$classname = name;\r\n    if ((parent.$module) && (parent.$module.$impl===parent)) parent=parent.$module;\r\n    c.$parent = parent;\r\n    c.$fullname = parent.$name+'.'+name;\r\n    if (rtl.isModule(parent)){\r\n      c.$module = parent;\r\n      c.$name = name;\r\n    } else {\r\n      c.$module = parent.$module;\r\n      c.$name = parent.name+'.'+name;\r\n    };\r\n    // rtti\r\n    if (rtl.debug_rtti) rtl.debug('initClass '+c.$fullname);\r\n    var t = c.$module.$rtti.$Class(c.$name,{ \"class\": c, module: parent });\r\n    c.$rtti = t;\r\n    if (rtl.isObject(c.$ancestor)) t.ancestor = c.$ancestor.$rtti;\r\n    if (!t.ancestor) t.ancestor = null;\r\n    // init members\r\n    initfn.call(c);\r\n  },\r\n\r\n  createClass: function(parent,name,ancestor,initfn){\r\n    // create a normal class,\r\n    // ancestor must be null or a normal class,\r\n    // the root ancestor can be an external class\r\n    var c = null;\r\n    if (ancestor != null){\r\n      c = Object.create(ancestor);\r\n      c.$ancestor = ancestor;\r\n      // Note:\r\n      // if root is an \"object\" then c.$ancestor === Object.getPrototypeOf(c)\r\n      // if root is a \"function\" then c.$ancestor === c.__proto__, Object.getPrototypeOf(c) returns the root\r\n    } else {\r\n      c = {};\r\n      c.$create = function(fnname,args){\r\n        if (args == undefined) args = [];\r\n        var o = Object.create(this);\r\n        o.$class = this; // Note: o.$class === Object.getPrototypeOf(o)\r\n        o.$init();\r\n        try{\r\n          o[fnname].apply(o,args);\r\n          o.AfterConstruction();\r\n        } catch($e){\r\n          o.$destroy;\r\n          throw $e;\r\n        }\r\n        return o;\r\n      };\r\n      c.$destroy = function(fnname){\r\n        this.BeforeDestruction();\r\n        this[fnname]();\r\n        this.$final;\r\n      };\r\n    };\r\n    rtl.initClass(c,parent,name,initfn);\r\n  },\r\n\r\n  createClassExt: function(parent,name,ancestor,newinstancefnname,initfn){\r\n    // Create a class using an external ancestor.\r\n    // If newinstancefnname is given, use that function to create the new object.\r\n    // If exist call BeforeDestruction and AfterConstruction.\r\n    var c = null;\r\n    c = Object.create(ancestor);\r\n    c.$create = function(fnname,args){\r\n      if (args == undefined) args = [];\r\n      var o = null;\r\n      if (newinstancefnname.length>0){\r\n        o = this[newinstancefnname](fnname,args);\r\n      } else {\r\n        o = Object.create(this);\r\n      }\r\n      o.$class = this; // Note: o.$class === Object.getPrototypeOf(o)\r\n      o.$init();\r\n      try{\r\n        o[fnname].apply(o,args);\r\n        if (o.AfterConstruction) o.AfterConstruction();\r\n      } catch($e){\r\n        o.$destroy;\r\n        throw $e;\r\n      }\r\n      return o;\r\n    };\r\n    c.$destroy = function(fnname){\r\n      if (this.BeforeDestruction) this.BeforeDestruction();\r\n      this[fnname]();\r\n      this.$final;\r\n    };\r\n    rtl.initClass(c,parent,name,initfn);\r\n  },\r\n\r\n  tObjectDestroy: \"Destroy\",\r\n\r\n  free: function(obj,name){\r\n    if (obj[name]==null) return;\r\n    obj[name].$destroy(rtl.tObjectDestroy);\r\n    obj[name]=null;\r\n  },\r\n\r\n  freeLoc: function(obj){\r\n    if (obj==null) return;\r\n    obj.$destroy(rtl.tObjectDestroy);\r\n    return null;\r\n  },\r\n\r\n  is: function(instance,type){\r\n    return type.isPrototypeOf(instance) || (instance===type);\r\n  },\r\n\r\n  isExt: function(instance,type,mode){\r\n    // mode===1 means instance must be a Pascal class instance\r\n    // mode===2 means instance must be a Pascal class\r\n    // Notes:\r\n    // isPrototypeOf and instanceof return false on equal\r\n    // isPrototypeOf does not work for Date.isPrototypeOf(new Date())\r\n    //   so if isPrototypeOf is false test with instanceof\r\n    // instanceof needs a function on right side\r\n    if (instance == null) return false; // Note: ==null checks for undefined too\r\n    if ((typeof(type) !== 'object') && (typeof(type) !== 'function')) return false;\r\n    if (instance === type){\r\n      if (mode===1) return false;\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if (type.isPrototypeOf && type.isPrototypeOf(instance)){\r\n      if (mode===1) return rtl.isPasClassInstance(instance);\r\n      if (mode===2) return rtl.isPasClass(instance);\r\n      return true;\r\n    }\r\n    if ((typeof type == 'function') && (instance instanceof type)) return true;\r\n    return false;\r\n  },\r\n\r\n  Exception: null,\r\n  EInvalidCast: null,\r\n  EAbstractError: null,\r\n  ERangeError: null,\r\n\r\n  raiseE: function(typename){\r\n    var t = rtl[typename];\r\n    if (t==null){\r\n      var mod = pas.SysUtils;\r\n      if (!mod) mod = pas.sysutils;\r\n      if (mod){\r\n        t = mod[typename];\r\n        if (!t) t = mod[typename.toLowerCase()];\r\n        if (!t) t = mod['Exception'];\r\n        if (!t) t = mod['exception'];\r\n      }\r\n    }\r\n    if (t){\r\n      if (t.Create){\r\n        throw t.$create(\"Create\");\r\n      } else if (t.create){\r\n        throw t.$create(\"create\");\r\n      }\r\n    }\r\n    if (typename === \"EInvalidCast\") throw \"invalid type cast\";\r\n    if (typename === \"EAbstractError\") throw \"Abstract method called\";\r\n    if (typename === \"ERangeError\") throw \"range error\";\r\n    throw typename;\r\n  },\r\n\r\n  as: function(instance,type){\r\n    if((instance === null) || rtl.is(instance,type)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  asExt: function(instance,type,mode){\r\n    if((instance === null) || rtl.isExt(instance,type,mode)) return instance;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  createInterface: function(module, name, guid, fnnames, ancestor, initfn){\r\n    //console.log('createInterface name=\"'+name+'\" guid=\"'+guid+'\" names='+fnnames);\r\n    var i = ancestor?Object.create(ancestor):{};\r\n    module[name] = i;\r\n    i.$module = module;\r\n    i.$name = name;\r\n    i.$fullname = module.$name+'.'+name;\r\n    i.$guid = guid;\r\n    i.$guidr = null;\r\n    i.$names = fnnames?fnnames:[];\r\n    if (rtl.isFunction(initfn)){\r\n      // rtti\r\n      if (rtl.debug_rtti) rtl.debug('createInterface '+i.$fullname);\r\n      var t = i.$module.$rtti.$Interface(name,{ \"interface\": i, module: module });\r\n      i.$rtti = t;\r\n      if (ancestor) t.ancestor = ancestor.$rtti;\r\n      if (!t.ancestor) t.ancestor = null;\r\n      initfn.call(i);\r\n    }\r\n    return i;\r\n  },\r\n\r\n  strToGUIDR: function(s,g){\r\n    var p = 0;\r\n    function n(l){\r\n      var h = s.substr(p,l);\r\n      p+=l;\r\n      return parseInt(h,16);\r\n    }\r\n    p+=1; // skip {\r\n    g.D1 = n(8);\r\n    p+=1; // skip -\r\n    g.D2 = n(4);\r\n    p+=1; // skip -\r\n    g.D3 = n(4);\r\n    p+=1; // skip -\r\n    if (!g.D4) g.D4=[];\r\n    g.D4[0] = n(2);\r\n    g.D4[1] = n(2);\r\n    p+=1; // skip -\r\n    for(var i=2; i<8; i++) g.D4[i] = n(2);\r\n    return g;\r\n  },\r\n\r\n  guidrToStr: function(g){\r\n    if (g.$intf) return g.$intf.$guid;\r\n    var h = rtl.hexStr;\r\n    var s='{'+h(g.D1,8)+'-'+h(g.D2,4)+'-'+h(g.D3,4)+'-'+h(g.D4[0],2)+h(g.D4[1],2)+'-';\r\n    for (var i=2; i<8; i++) s+=h(g.D4[i],2);\r\n    s+='}';\r\n    return s;\r\n  },\r\n\r\n  createTGUID: function(guid){\r\n    var TGuid = (pas.System)?pas.System.TGuid:pas.system.tguid;\r\n    var g = rtl.strToGUIDR(guid,new TGuid());\r\n    return g;\r\n  },\r\n\r\n  getIntfGUIDR: function(intfTypeOrVar){\r\n    if (!intfTypeOrVar) return null;\r\n    if (!intfTypeOrVar.$guidr){\r\n      var g = rtl.createTGUID(intfTypeOrVar.$guid);\r\n      if (!intfTypeOrVar.hasOwnProperty('$guid')) intfTypeOrVar = Object.getPrototypeOf(intfTypeOrVar);\r\n      g.$intf = intfTypeOrVar;\r\n      intfTypeOrVar.$guidr = g;\r\n    }\r\n    return intfTypeOrVar.$guidr;\r\n  },\r\n\r\n  addIntf: function (aclass, intf, map){\r\n    function jmp(fn){\r\n      if (typeof(fn)===\"function\"){\r\n        return function(){ return fn.apply(this.$o,arguments); };\r\n      } else {\r\n        return function(){ rtl.raiseE('EAbstractError'); };\r\n      }\r\n    }\r\n    if(!map) map = {};\r\n    var t = intf;\r\n    var item = Object.create(t);\r\n    aclass.$intfmaps[intf.$guid] = item;\r\n    do{\r\n      var names = t.$names;\r\n      if (!names) break;\r\n      for (var i=0; i<names.length; i++){\r\n        var intfname = names[i];\r\n        var fnname = map[intfname];\r\n        if (!fnname) fnname = intfname;\r\n        //console.log('addIntf: intftype='+t.$name+' index='+i+' intfname=\"'+intfname+'\" fnname=\"'+fnname+'\" proc='+typeof(fn));\r\n        item[intfname] = jmp(aclass[fnname]);\r\n      }\r\n      t = Object.getPrototypeOf(t);\r\n    }while(t!=null);\r\n  },\r\n\r\n  getIntfG: function (obj, guid, query){\r\n    if (!obj) return null;\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query);\r\n    // search\r\n    var maps = obj.$intfmaps;\r\n    if (!maps) return null;\r\n    var item = maps[guid];\r\n    if (!item) return null;\r\n    // check delegation\r\n    //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' query='+query+' item='+typeof(item));\r\n    if (typeof item === 'function') return item.call(obj); // COM: contains _AddRef\r\n    // check cache\r\n    var intf = null;\r\n    if (obj.$interfaces){\r\n      intf = obj.$interfaces[guid];\r\n      //console.log('getIntfG: obj='+obj.$classname+' guid='+guid+' cache='+typeof(intf));\r\n    }\r\n    if (!intf){ // intf can be undefined!\r\n      intf = Object.create(item);\r\n      intf.$o = obj;\r\n      if (!obj.$interfaces) obj.$interfaces = {};\r\n      obj.$interfaces[guid] = intf;\r\n    }\r\n    if (typeof(query)==='object'){\r\n      // called by queryIntfT\r\n      var o = null;\r\n      if (intf.QueryInterface(rtl.getIntfGUIDR(query),\r\n          {get:function(){ return o; }, set:function(v){ o=v; }}) === 0){\r\n        return o;\r\n      } else {\r\n        return null;\r\n      }\r\n    } else if(query===2){\r\n      // called by TObject.GetInterfaceByStr\r\n      if (intf.$kind === 'com') intf._AddRef();\r\n    }\r\n    return intf;\r\n  },\r\n\r\n  getIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid);\r\n  },\r\n\r\n  queryIntfT: function(obj,intftype){\r\n    return rtl.getIntfG(obj,intftype.$guid,intftype);\r\n  },\r\n\r\n  queryIntfIsT: function(obj,intftype){\r\n    var i = rtl.queryIntfG(obj,intftype.$guid);\r\n    if (!i) return false;\r\n    if (i.$kind === 'com') i._Release();\r\n    return true;\r\n  },\r\n\r\n  asIntfT: function (obj,intftype){\r\n    var i = rtl.getIntfG(obj,intftype.$guid);\r\n    if (i!==null) return i;\r\n    rtl.raiseEInvalidCast();\r\n  },\r\n\r\n  intfIsClass: function(intf,classtype){\r\n    return (intf!=null) && (rtl.is(intf.$o,classtype));\r\n  },\r\n\r\n  intfAsClass: function(intf,classtype){\r\n    if (intf==null) return null;\r\n    return rtl.as(intf.$o,classtype);\r\n  },\r\n\r\n  intfToClass: function(intf,classtype){\r\n    if ((intf!==null) && rtl.is(intf.$o,classtype)) return intf.$o;\r\n    return null;\r\n  },\r\n\r\n  // interface reference counting\r\n  intfRefs: { // base object for temporary interface variables\r\n    ref: function(id,intf){\r\n      // called for temporary interface references needing delayed release\r\n      var old = this[id];\r\n      //console.log('rtl.intfRefs.ref: id='+id+' old=\"'+(old?old.$name:'null')+'\" intf=\"'+(intf?intf.$name:'null'));\r\n      if (old){\r\n        // called again, e.g. in a loop\r\n        delete this[id];\r\n        old._Release(); // may fail\r\n      }\r\n      this[id]=intf;\r\n      return intf;\r\n    },\r\n    free: function(){\r\n      //console.log('rtl.intfRefs.free...');\r\n      for (var id in this){\r\n        if (this.hasOwnProperty(id)) this[id]._Release;\r\n      }\r\n    }\r\n  },\r\n\r\n  createIntfRefs: function(){\r\n    //console.log('rtl.createIntfRefs');\r\n    return Object.create(rtl.intfRefs);\r\n  },\r\n\r\n  setIntfP: function(path,name,value,skipAddRef){\r\n    var old = path[name];\r\n    //console.log('rtl.setIntfP path='+path+' name='+name+' old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old === value) return;\r\n    if (old !== null){\r\n      path[name]=null;\r\n      old._Release();\r\n    }\r\n    if (value !== null){\r\n      if (!skipAddRef) value._AddRef();\r\n      path[name]=value;\r\n    }\r\n  },\r\n\r\n  setIntfL: function(old,value,skipAddRef){\r\n    //console.log('rtl.setIntfL old=\"'+(old?old.$name:'null')+'\" value=\"'+(value?value.$name:'null')+'\"');\r\n    if (old !== value){\r\n      if (value!==null){\r\n        if (!skipAddRef) value._AddRef();\r\n      }\r\n      if (old!==null){\r\n        old._Release();  // Release after AddRef, to avoid double Release if Release creates an exception\r\n      }\r\n    } else if (skipAddRef){\r\n      if (old!==null){\r\n        old._Release();  // value has an AddRef\r\n      }\r\n    }\r\n    return value;\r\n  },\r\n\r\n  _AddRef: function(intf){\r\n    //if (intf) console.log('rtl._AddRef intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._AddRef();\r\n    return intf;\r\n  },\r\n\r\n  _Release: function(intf){\r\n    //if (intf) console.log('rtl._Release intf=\"'+(intf?intf.$name:'null')+'\"');\r\n    if (intf) intf._Release();\r\n    return intf;\r\n  },\r\n\r\n  checkMethodCall: function(obj,type){\r\n    if (rtl.isObject(obj) && rtl.is(obj,type)) return;\r\n    rtl.raiseE(\"EInvalidCast\");\r\n  },\r\n\r\n  rc: function(i,minval,maxval){\r\n    // range check integer\r\n    if ((Math.floor(i)===i) && (i>=minval) && (i<=maxval)) return i;\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcc: function(c,minval,maxval){\r\n    // range check char\r\n    if ((typeof(c)==='string') && (c.length===1)){\r\n      var i = c.charCodeAt(0);\r\n      if ((i>=minval) && (i<=maxval)) return c;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcSetCharAt: function(s,index,c){\r\n    // range check setCharAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return rtl.setCharAt(s,index,c);\r\n  },\r\n\r\n  rcCharAt: function(s,index){\r\n    // range check charAt\r\n    if ((typeof(s)!=='string') || (index<0) || (index>=s.length)) rtl.raiseE('ERangeError');\r\n    return s.charAt(index);\r\n  },\r\n\r\n  rcArrR: function(arr,index){\r\n    // range check read array\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      if (arguments.length>2){\r\n        // arr,index1,index2,...\r\n        arr=arr[index];\r\n        for (var i=2; i<arguments.length; i++) arr=rtl.rcArrR(arr,arguments[i]);\r\n        return arr;\r\n      }\r\n      return arr[index];\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  rcArrW: function(arr,index,value){\r\n    // range check write array\r\n    // arr,index1,index2,...,value\r\n    for (var i=3; i<arguments.length; i++){\r\n      arr=rtl.rcArrR(arr,index);\r\n      index=arguments[i-1];\r\n      value=arguments[i];\r\n    }\r\n    if (Array.isArray(arr) && (typeof(index)==='number') && (index>=0) && (index<arr.length)){\r\n      return arr[index]=value;\r\n    }\r\n    rtl.raiseE('ERangeError');\r\n  },\r\n\r\n  length: function(arr){\r\n    return (arr == null) ? 0 : arr.length;\r\n  },\r\n\r\n  arraySetLength: function(arr,defaultvalue,newlength){\r\n    // multi dim: (arr,defaultvalue,dim1,dim2,...)\r\n    if (arr == null) arr = [];\r\n    var p = arguments;\r\n    function setLength(a,argNo){\r\n      var oldlen = a.length;\r\n      var newlen = p[argNo];\r\n      if (oldlen!==newlength){\r\n        a.length = newlength;\r\n        if (argNo === p.length-1){\r\n          if (rtl.isArray(defaultvalue)){\r\n            for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\r\n          } else if (rtl.isFunction(defaultvalue)){\r\n            for (var i=oldlen; i<newlen; i++) a[i]=new defaultvalue(); // e.g. record\r\n          } else if (rtl.isObject(defaultvalue)) {\r\n            for (var i=oldlen; i<newlen; i++) a[i]={}; // e.g. set\r\n          } else {\r\n            for (var i=oldlen; i<newlen; i++) a[i]=defaultvalue;\r\n          }\r\n        } else {\r\n          for (var i=oldlen; i<newlen; i++) a[i]=[]; // nested array\r\n        }\r\n      }\r\n      if (argNo < p.length-1){\r\n        // multi argNo\r\n        for (var i=0; i<newlen; i++) a[i]=setLength(a[i],argNo+1);\r\n      }\r\n      return a;\r\n    }\r\n    return setLength(arr,2);\r\n  },\r\n\r\n  arrayEq: function(a,b){\r\n    if (a===null) return b===null;\r\n    if (b===null) return false;\r\n    if (a.length!==b.length) return false;\r\n    for (var i=0; i<a.length; i++) if (a[i]!==b[i]) return false;\r\n    return true;\r\n  },\r\n\r\n  arrayClone: function(type,src,srcpos,end,dst,dstpos){\r\n    // type: 0 for references, \"refset\" for calling refSet(), a function for new type()\r\n    // src must not be null\r\n    // This function does not range check.\r\n    if (rtl.isFunction(type)){\r\n      for (; srcpos<end; srcpos++) dst[dstpos++] = new type(src[srcpos]); // clone record\r\n    } else if((typeof(type)===\"string\") && (type === 'refSet')) {\r\n      for (; srcpos<end; srcpos++) dst[dstpos++] = rtl.refSet(src[srcpos]); // ref set\r\n    }  else {\r\n      for (; srcpos<end; srcpos++) dst[dstpos++] = src[srcpos]; // reference\r\n    };\r\n  },\r\n\r\n  arrayConcat: function(type){\r\n    // type: see rtl.arrayClone\r\n    var a = [];\r\n    var l = 0;\r\n    for (var i=1; i<arguments.length; i++) l+=arguments[i].length;\r\n    a.length = l;\r\n    l=0;\r\n    for (var i=1; i<arguments.length; i++){\r\n      var src = arguments[i];\r\n      if (src == null) continue;\r\n      rtl.arrayClone(type,src,0,src.length,a,l);\r\n      l+=src.length;\r\n    };\r\n    return a;\r\n  },\r\n\r\n  arrayCopy: function(type, srcarray, index, count){\r\n    // type: see rtl.arrayClone\r\n    // if count is missing, use srcarray.length\r\n    if (srcarray == null) return [];\r\n    if (index < 0) index = 0;\r\n    if (count === undefined) count=srcarray.length;\r\n    var end = index+count;\r\n    if (end>srcarray.length) end = srcarray.length;\r\n    if (index>=end) return [];\r\n    if (type===0){\r\n      return srcarray.slice(index,end);\r\n    } else {\r\n      var a = [];\r\n      a.length = end-index;\r\n      rtl.arrayClone(type,srcarray,index,end,a,0);\r\n      return a;\r\n    }\r\n  },\r\n\r\n  setCharAt: function(s,index,c){\r\n    return s.substr(0,index)+c+s.substr(index+1);\r\n  },\r\n\r\n  getResStr: function(mod,name){\r\n    var rs = mod.$resourcestrings[name];\r\n    return rs.current?rs.current:rs.org;\r\n  },\r\n\r\n  createSet: function(){\r\n    var s = {};\r\n    for (var i=0; i<arguments.length; i++){\r\n      if (arguments[i]!=null){\r\n        s[arguments[i]]=true;\r\n      } else {\r\n        var first=arguments[i+=1];\r\n        var last=arguments[i+=1];\r\n        for(var j=first; j<=last; j++) s[j]=true;\r\n      }\r\n    }\r\n    return s;\r\n  },\r\n\r\n  cloneSet: function(s){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    return r;\r\n  },\r\n\r\n  refSet: function(s){\r\n    s.$shared = true;\r\n    return s;\r\n  },\r\n\r\n  includeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    s[enumvalue] = true;\r\n    return s;\r\n  },\r\n\r\n  excludeSet: function(s,enumvalue){\r\n    if (s.$shared) s = rtl.cloneSet(s);\r\n    delete s[enumvalue];\r\n    return s;\r\n  },\r\n\r\n  diffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    delete r.$shared;\r\n    return r;\r\n  },\r\n\r\n  unionSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) r[key]=true;\r\n    for (var key in t) r[key]=true;\r\n    delete r.$shared;\r\n    return r;\r\n  },\r\n\r\n  intersectSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (t[key]) r[key]=true;\r\n    delete r.$shared;\r\n    return r;\r\n  },\r\n\r\n  symDiffSet: function(s,t){\r\n    var r = {};\r\n    for (var key in s) if (!t[key]) r[key]=true;\r\n    for (var key in t) if (!s[key]) r[key]=true;\r\n    delete r.$shared;\r\n    return r;\r\n  },\r\n\r\n  eqSet: function(s,t){\r\n    for (var key in s) if (!t[key] && (key!='$shared')) return false;\r\n    for (var key in t) if (!s[key] && (key!='$shared')) return false;\r\n    return true;\r\n  },\r\n\r\n  neSet: function(s,t){\r\n    return !rtl.eqSet(s,t);\r\n  },\r\n\r\n  leSet: function(s,t){\r\n    for (var key in s) if (!t[key] && (key!='$shared')) return false;\r\n    return true;\r\n  },\r\n\r\n  geSet: function(s,t){\r\n    for (var key in t) if (!s[key] && (key!='$shared')) return false;\r\n    return true;\r\n  },\r\n\r\n  strSetLength: function(s,newlen){\r\n    var oldlen = s.length;\r\n    if (oldlen > newlen){\r\n      return s.substring(0,newlen);\r\n    } else if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return s+' '.repeat(newlen-oldlen);\r\n    } else {\r\n       while (oldlen<newlen){\r\n         s+=' ';\r\n         oldlen++;\r\n       };\r\n       return s;\r\n    }\r\n  },\r\n\r\n  spaceLeft: function(s,width){\r\n    var l=s.length;\r\n    if (l>=width) return s;\r\n    if (s.repeat){\r\n      // Note: repeat needs ECMAScript6!\r\n      return ' '.repeat(width-l) + s;\r\n    } else {\r\n      while (l<width){\r\n        s=' '+s;\r\n        l++;\r\n      };\r\n    };\r\n  },\r\n\r\n  floatToStr : function(d,w,p){\r\n    // input 1-3 arguments: double, width, precision\r\n    if (arguments.length>2){\r\n      return rtl.spaceLeft(d.toFixed(p),w);\r\n    } else {\r\n\t  // exponent width\r\n\t  var pad = \"\";\r\n\t  var ad = Math.abs(d);\r\n\t  if (ad<1.0e+10) {\r\n\t\tpad='00';\r\n\t  } else if (ad<1.0e+100) {\r\n\t\tpad='0';\r\n      }  \t\r\n\t  if (arguments.length<2) {\r\n\t    w=9;\t\t\r\n      } else if (w<9) {\r\n\t\tw=9;\r\n      }\t\t  \r\n      var p = w-8;\r\n      var s=(d>0 ? \" \" : \"\" ) + d.toExponential(p);\r\n      s=s.replace(/e(.)/,'E$1'+pad);\r\n      return rtl.spaceLeft(s,w);\r\n    }\r\n  },\r\n\r\n  initRTTI: function(){\r\n    if (rtl.debug_rtti) rtl.debug('initRTTI');\r\n\r\n    // base types\r\n    rtl.tTypeInfo = { name: \"tTypeInfo\" };\r\n    function newBaseTI(name,kind,ancestor){\r\n      if (!ancestor) ancestor = rtl.tTypeInfo;\r\n      if (rtl.debug_rtti) rtl.debug('initRTTI.newBaseTI \"'+name+'\" '+kind+' (\"'+ancestor.name+'\")');\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      t.kind = kind;\r\n      rtl[name] = t;\r\n      return t;\r\n    };\r\n    function newBaseInt(name,minvalue,maxvalue,ordtype){\r\n      var t = newBaseTI(name,1 /* tkInteger */,rtl.tTypeInfoInteger);\r\n      t.minvalue = minvalue;\r\n      t.maxvalue = maxvalue;\r\n      t.ordtype = ordtype;\r\n      return t;\r\n    };\r\n    newBaseTI(\"tTypeInfoInteger\",1 /* tkInteger */);\r\n    newBaseInt(\"shortint\",-0x80,0x7f,0);\r\n    newBaseInt(\"byte\",0,0xff,1);\r\n    newBaseInt(\"smallint\",-0x8000,0x7fff,2);\r\n    newBaseInt(\"word\",0,0xffff,3);\r\n    newBaseInt(\"longint\",-0x80000000,0x7fffffff,4);\r\n    newBaseInt(\"longword\",0,0xffffffff,5);\r\n    newBaseInt(\"nativeint\",-0x10000000000000,0xfffffffffffff,6);\r\n    newBaseInt(\"nativeuint\",0,0xfffffffffffff,7);\r\n    newBaseTI(\"char\",2 /* tkChar */);\r\n    newBaseTI(\"string\",3 /* tkString */);\r\n    newBaseTI(\"tTypeInfoEnum\",4 /* tkEnumeration */,rtl.tTypeInfoInteger);\r\n    newBaseTI(\"tTypeInfoSet\",5 /* tkSet */);\r\n    newBaseTI(\"double\",6 /* tkDouble */);\r\n    newBaseTI(\"boolean\",7 /* tkBool */);\r\n    newBaseTI(\"tTypeInfoProcVar\",8 /* tkProcVar */);\r\n    newBaseTI(\"tTypeInfoMethodVar\",9 /* tkMethod */,rtl.tTypeInfoProcVar);\r\n    newBaseTI(\"tTypeInfoArray\",10 /* tkArray */);\r\n    newBaseTI(\"tTypeInfoDynArray\",11 /* tkDynArray */);\r\n    newBaseTI(\"tTypeInfoPointer\",15 /* tkPointer */);\r\n    var t = newBaseTI(\"pointer\",15 /* tkPointer */,rtl.tTypeInfoPointer);\r\n    t.reftype = null;\r\n    newBaseTI(\"jsvalue\",16 /* tkJSValue */);\r\n    newBaseTI(\"tTypeInfoRefToProcVar\",17 /* tkRefToProcVar */,rtl.tTypeInfoProcVar);\r\n\r\n    // member kinds\r\n    rtl.tTypeMember = {};\r\n    function newMember(name,kind){\r\n      var m = Object.create(rtl.tTypeMember);\r\n      m.name = name;\r\n      m.kind = kind;\r\n      rtl[name] = m;\r\n    };\r\n    newMember(\"tTypeMemberField\",1); // tmkField\r\n    newMember(\"tTypeMemberMethod\",2); // tmkMethod\r\n    newMember(\"tTypeMemberProperty\",3); // tmkProperty\r\n\r\n    // base object for storing members: a simple object\r\n    rtl.tTypeMembers = {};\r\n\r\n    // tTypeInfoStruct - base object for tTypeInfoClass, tTypeInfoRecord, tTypeInfoInterface\r\n    var tis = newBaseTI(\"tTypeInfoStruct\",0);\r\n    tis.$addMember = function(name,ancestor,options){\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.hasString(name) || (name.charAt()==='$')) throw 'invalid member \"'+name+'\", this=\"'+this.name+'\"';\r\n        if (!rtl.is(ancestor,rtl.tTypeMember)) throw 'invalid ancestor \"'+ancestor+':'+ancestor.name+'\", \"'+this.name+'.'+name+'\"';\r\n        if ((options!=undefined) && (typeof(options)!='object')) throw 'invalid options \"'+options+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      var t = Object.create(ancestor);\r\n      t.name = name;\r\n      this.members[name] = t;\r\n      this.names.push(name);\r\n      if (rtl.isObject(options)){\r\n        for (var key in options) if (options.hasOwnProperty(key)) t[key] = options[key];\r\n      };\r\n      return t;\r\n    };\r\n    tis.addField = function(name,type,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberField,options);\r\n      if (rtl.debug_rtti){\r\n        if (!rtl.is(type,rtl.tTypeInfo)) throw 'invalid type \"'+type+'\", \"'+this.name+'.'+name+'\"';\r\n      };\r\n      t.typeinfo = type;\r\n      this.fields.push(name);\r\n      return t;\r\n    };\r\n    tis.addFields = function(){\r\n      var i=0;\r\n      while(i<arguments.length){\r\n        var name = arguments[i++];\r\n        var type = arguments[i++];\r\n        if ((i<arguments.length) && (typeof(arguments[i])==='object')){\r\n          this.addField(name,type,arguments[i++]);\r\n        } else {\r\n          this.addField(name,type);\r\n        };\r\n      };\r\n    };\r\n    tis.addMethod = function(name,methodkind,params,result,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberMethod,options);\r\n      t.methodkind = methodkind;\r\n      t.procsig = rtl.newTIProcSig(params);\r\n      t.procsig.resulttype = result?result:null;\r\n      this.methods.push(name);\r\n      return t;\r\n    };\r\n    tis.addProperty = function(name,flags,result,getter,setter,options){\r\n      var t = this.$addMember(name,rtl.tTypeMemberProperty,options);\r\n      t.flags = flags;\r\n      t.typeinfo = result;\r\n      t.getter = getter;\r\n      t.setter = setter;\r\n      // Note: in options: params, stored, defaultvalue\r\n      if (rtl.isArray(t.params)) t.params = rtl.newTIParams(t.params);\r\n      this.properties.push(name);\r\n      if (!rtl.isString(t.stored)) t.stored = \"\";\r\n      return t;\r\n    };\r\n    tis.getField = function(index){\r\n      return this.members[this.fields[index]];\r\n    };\r\n    tis.getMethod = function(index){\r\n      return this.members[this.methods[index]];\r\n    };\r\n    tis.getProperty = function(index){\r\n      return this.members[this.properties[index]];\r\n    };\r\n\r\n    newBaseTI(\"tTypeInfoRecord\",12 /* tkRecord */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClass\",13 /* tkClass */,rtl.tTypeInfoStruct);\r\n    newBaseTI(\"tTypeInfoClassRef\",14 /* tkClassRef */);\r\n    newBaseTI(\"tTypeInfoInterface\",15 /* tkInterface */,rtl.tTypeInfoStruct);\r\n  },\r\n\r\n  tSectionRTTI: {\r\n    $module: null,\r\n    $inherited: function(name,ancestor,o){\r\n      if (rtl.debug_rtti){\r\n        rtl.debug('tSectionRTTI.newTI \"'+(this.$module?this.$module.$name:\"(no module)\")\r\n          +'\".\"'+name+'\" ('+ancestor.name+') '+(o?'init':'forward'));\r\n      };\r\n      var t = this[name];\r\n      if (t){\r\n        if (!t.$forward) throw 'duplicate type \"'+name+'\"';\r\n        if (!ancestor.isPrototypeOf(t)) throw 'typeinfo ancestor mismatch \"'+name+'\" ancestor=\"'+ancestor.name+'\" t.name=\"'+t.name+'\"';\r\n      } else {\r\n        t = Object.create(ancestor);\r\n        t.name = name;\r\n        t.module = this.module;\r\n        this[name] = t;\r\n      }\r\n      if (o){\r\n        delete t.$forward;\r\n        for (var key in o) if (o.hasOwnProperty(key)) t[key]=o[key];\r\n      } else {\r\n        t.$forward = true;\r\n      }\r\n      return t;\r\n    },\r\n    $Scope: function(name,ancestor,o){\r\n      var t=this.$inherited(name,ancestor,o);\r\n      t.members = {};\r\n      t.names = [];\r\n      t.fields = [];\r\n      t.methods = [];\r\n      t.properties = [];\r\n      return t;\r\n    },\r\n    $TI: function(name,kind,o){ var t=this.$inherited(name,rtl.tTypeInfo,o); t.kind = kind; return t; },\r\n    $Int: function(name,o){ return this.$inherited(name,rtl.tTypeInfoInteger,o); },\r\n    $Enum: function(name,o){ return this.$inherited(name,rtl.tTypeInfoEnum,o); },\r\n    $Set: function(name,o){ return this.$inherited(name,rtl.tTypeInfoSet,o); },\r\n    $StaticArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoArray,o); },\r\n    $DynArray: function(name,o){ return this.$inherited(name,rtl.tTypeInfoDynArray,o); },\r\n    $ProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoProcVar,o); },\r\n    $RefToProcVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoRefToProcVar,o); },\r\n    $MethodVar: function(name,o){ return this.$inherited(name,rtl.tTypeInfoMethodVar,o); },\r\n    $Record: function(name,o){ return this.$Scope(name,rtl.tTypeInfoRecord,o); },\r\n    $Class: function(name,o){ return this.$Scope(name,rtl.tTypeInfoClass,o); },\r\n    $ClassRef: function(name,o){ return this.$inherited(name,rtl.tTypeInfoClassRef,o); },\r\n    $Pointer: function(name,o){ return this.$inherited(name,rtl.tTypeInfoPointer,o); },\r\n    $Interface: function(name,o){ return this.$Scope(name,rtl.tTypeInfoInterface,o); }\r\n  },\r\n\r\n  newTIParam: function(param){\r\n    // param is an array, 0=name, 1=type, 2=optional flags\r\n    var t = {\r\n      name: param[0],\r\n      typeinfo: param[1],\r\n      flags: (rtl.isNumber(param[2]) ? param[2] : 0)\r\n    };\r\n    return t;\r\n  },\r\n\r\n  newTIParams: function(list){\r\n    // list: optional array of [paramname,typeinfo,optional flags]\r\n    var params = [];\r\n    if (rtl.isArray(list)){\r\n      for (var i=0; i<list.length; i++) params.push(rtl.newTIParam(list[i]));\r\n    };\r\n    return params;\r\n  },\r\n\r\n  newTIProcSig: function(params,result,flags){\r\n    var s = {\r\n      params: rtl.newTIParams(params),\r\n      resulttype: result,\r\n      flags: flags\r\n    };\r\n    return s;\r\n  }\r\n}\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit System;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nconst\r\n  LineEnding = #10;\r\n  sLineBreak = LineEnding;\r\n\r\n  MaxSmallint = 32767;\r\n  MinSmallint = -32768;\r\n  MaxShortInt = 127;\r\n  MinShortInt = -128;\r\n  MaxByte = $FF;\r\n  MaxWord = $FFFF;\r\n  MaxLongint  = $7fffffff;\r\n  MaxCardinal = LongWord($ffffffff);\r\n\r\n  Maxint = MaxLongint;\r\n  IsMultiThread = false;\r\n{*****************************************************************************\r\n                               Base types\r\n*****************************************************************************}\r\ntype\r\n  Integer = LongInt;\r\n  Cardinal = LongWord;\r\n  DWord = LongWord;\r\n  SizeInt = NativeInt;\r\n  SizeUInt = NativeUInt;\r\n  PtrInt = NativeInt;\r\n  PtrUInt = NativeUInt;\r\n  ValSInt = NativeInt;\r\n  ValUInt = NativeUInt;\r\n  ValReal = Double;\r\n  Real = type Double;\r\n  Extended = Double;\r\n\r\n  Int64 = type NativeInt; // unimplemented; // only 53 bits at runtime\r\n  UInt64 = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  QWord = type NativeUInt unimplemented; // only 52 bits at runtime\r\n  Single = Double; // unimplemented;\r\n  Comp = type NativeInt unimplemented;\r\n  NativeLargeInt = NativeInt;\r\n  NativeLargeUInt = NativeUInt;\r\n\r\n  UnicodeString = type String;\r\n  WideString = type String;\r\n  WideChar = char;\r\n  UnicodeChar = char;\r\n\r\n  TDynArrayIndex = NativeInt;\r\n  TTextLineBreakStyle = (tlbsLF,tlbsCRLF,tlbsCR);\r\n\r\n{*****************************************************************************\r\n                            Date and time\r\n*****************************************************************************}\r\ntype\r\n  TDateTime = type double;\r\n\r\n  TTime = type TDateTime;\r\n  TDate = type TDateTime;\r\n\r\n  TSystemTime = record\r\n     Year, Month, Day, DayOfWeek: word;\r\n     Hour, Minute, Second, MilliSecond: word;\r\n  end ;\r\n  TTimeStamp = record\r\n     Time: longint;   { Number of milliseconds since midnight }\r\n     Date: longint;   { One plus number of days since 1/1/0001 }\r\n  end ;\r\n\r\n\r\n{*****************************************************************************\r\n            TObject, TClass, IUnknown, IInterface, TInterfacedObject\r\n*****************************************************************************}\r\ntype\r\n  TGuid = record\r\n    D1: DWord;\r\n    D2: word;\r\n    D3: word;\r\n    D4: array[0..7] of byte;\r\n  end;\r\n  TGUIDString = string; // ToDo: use type string when supported by compiler\r\n\r\n  TClass = class of TObject;\r\n\r\n  { TObject }\r\n\r\n  TObject = class\r\n  private\r\n    class var FClassName: String; external name '$classname';\r\n    class var FClassParent: TClass; external name '$ancestor';\r\n    class var FUnitName: String; external name '$module.$name';\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; virtual;\r\n\r\n    // Free is using compiler magic.\r\n    // Reasons:\r\n    // 1. In JS calling obj.Free when obj=nil would crash.\r\n    // 2. In JS freeing memory requires to set all references to nil.\r\n    // Therefore any obj.free call is replaced by the compiler with some rtl magic.\r\n    procedure Free;\r\n\r\n    class function ClassType: TClass; assembler;\r\n    class property ClassName: String read FClassName;\r\n    class function ClassNameIs(const Name: string): boolean;\r\n    class property ClassParent: TClass read FClassParent;\r\n    class function InheritsFrom(aClass: TClass): boolean; assembler;\r\n    class property UnitName: String read FUnitName;\r\n\r\n    procedure AfterConstruction; virtual;\r\n    procedure BeforeDestruction; virtual;\r\n\r\n    function GetInterface(const iid: TGuid; out obj): boolean;\r\n    function GetInterface(const iidstr: String; out obj): boolean; inline;\r\n    function GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\n    function GetInterfaceWeak(const iid: TGuid; out obj): boolean; // equal to GetInterface but the interface returned is not referenced\r\n\r\n    function Equals(Obj: TObject): boolean; virtual;\r\n    function ToString: String; virtual;\r\n  end;\r\n\r\nconst\r\n  { IInterface }\r\n  S_OK          = 0;\r\n  S_FALSE       = 1;\r\n  E_NOINTERFACE = -2147467262; // FPC: longint($80004002)\r\n  E_UNEXPECTED  = -2147418113; // FPC: longint($8000FFFF)\r\n  E_NOTIMPL     = -2147467263; // FPC: longint($80004001)\r\n\r\ntype\r\n  {$Interfaces COM}\r\n  IUnknown = interface\r\n    ['{00000000-0000-0000-C000-000000000046}']\r\n    function QueryInterface(const iid: TGuid; out obj): Integer;\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  end;\r\n  IInterface = IUnknown;\r\n\r\n  {$M+}\r\n  IInvokable = interface(IInterface)\r\n  end;\r\n  {$M-}\r\n\r\n  { Enumerator support }\r\n  IEnumerator = interface(IInterface)\r\n    function GetCurrent: TObject;\r\n    function MoveNext: Boolean;\r\n    procedure Reset;\r\n    property Current: TObject read GetCurrent;\r\n  end;\r\n\r\n  IEnumerable = interface(IInterface)\r\n    function GetEnumerator: IEnumerator;\r\n  end;\r\n\r\n  { TInterfacedObject }\r\n\r\n  TInterfacedObject = class(TObject,IUnknown)\r\n  protected\r\n    fRefCount: Integer;\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    procedure BeforeDestruction; override;\r\n    property RefCount: Integer read fRefCount;\r\n  end;\r\n  TInterfacedClass = class of TInterfacedObject;\r\n\r\n  { TAggregatedObject - sub or satellite object using same interface as controller }\r\n\r\n  TAggregatedObject = class(TObject)\r\n  private\r\n    fController: Pointer;\r\n    function GetController: IUnknown;\r\n  protected\r\n    { implement methods of IUnknown }\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; virtual;\r\n    function _AddRef: Integer; virtual;\r\n    function _Release: Integer; virtual;\r\n  public\r\n    constructor Create(const aController: IUnknown); reintroduce;\r\n    property Controller: IUnknown read GetController;\r\n  end;\r\n\r\n  { TContainedObject }\r\n\r\n  TContainedObject = class(TAggregatedObject,IInterface)\r\n  protected\r\n    function QueryInterface(const iid: TGuid; out obj): Integer; override;\r\n  end;\r\n\r\nconst\r\n  { for safe as operator support }\r\n  IObjectInstance: TGuid = '{D91C9AF4-3C93-420F-A303-BF5BA82BFD23}';\r\n\r\nfunction GUIDToString(const GUID: TGUID): string; external name 'rtl.guidrToStr';\r\n\r\n{*****************************************************************************\r\n                            Init / Exit / ExitProc\r\n*****************************************************************************}\r\nvar\r\n  ExitCode: Integer; external name 'rtl.exitcode';\r\n  IsConsole: Boolean = {$IFDEF NodeJS}true{$ELSE}false{$ENDIF};\r\n\r\ntype\r\n  TOnParamCount = function: Longint;\r\n  TOnParamStr = function(Index: Longint): String;\r\nvar\r\n  OnParamCount: TOnParamCount;\r\n  OnParamStr: TOnParamStr;\r\n\r\nfunction ParamCount: Longint;\r\nfunction ParamStr(Index: Longint): String;\r\n\r\n{*****************************************************************************\r\n                                 Math\r\n*****************************************************************************}\r\nvar // ToDo: make these const\r\n  PI: Double; external name 'Math.PI';\r\n  MathE: Double; external name 'Math.E'; // Euler's number\r\n  MathLN10: Double; external name 'Math.LN10'; // ln(10)\r\n  MathLN2: Double; external name 'Math.LN2'; // ln(2)\r\n  MathLog10E: Double; external name 'Math.Log10E'; // log10(e)\r\n  MathLog2E: Double; external name 'Math.LOG2E'; // log2(e)\r\n  MathSQRT1_2: Double; external name 'Math.SQRT1_2'; // sqrt(0.5)\r\n  MathSQRT2: Double; external name 'Math.SQRT2'; // sqrt(2)\r\n\r\nfunction Abs(const A: integer): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: NativeInt): integer; overload; external name 'Math.abs';\r\nfunction Abs(const A: Double): Double; overload; external name 'Math.abs';\r\nfunction ArcTan(const A, B: Double): Double; external name 'Math.atan';\r\nfunction Cos(const A: Double): Double; external name 'Math.cos';\r\nfunction Exp(const A: Double): Double; external name 'Math.exp';\r\nfunction Frac(const A: Double): Double; assembler;\r\nfunction Ln(const A: Double): Double; external name 'Math.log';\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nfunction Random(const Range: Integer): Integer; overload; assembler;\r\nfunction Random: Double; overload; external name 'Math.random';\r\nfunction Round(const A: Double): NativeInt; external name 'Math.round';\r\nfunction Sin(const A: Double): Double; external name 'Math.sin';\r\nfunction Sqr(const A: Integer): Integer; assembler; overload;\r\nfunction Sqr(const A: Double): Double; assembler; overload;\r\nfunction sqrt(const A: Double): Double; external name 'Math.sqrt';\r\nfunction Trunc(const A: Double): NativeInt;\r\n\r\n{*****************************************************************************\r\n                          String functions\r\n*****************************************************************************}\r\nconst\r\n  DefaultTextLineBreakStyle : TTextLineBreakStyle = tlbsLF;\r\n\r\nfunction Int(const A: Double): double;\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler; overload;\r\nfunction Copy(const S: string; Index: Integer): String; assembler; overload;\r\nprocedure Delete(var S: String; Index, Size: Integer); assembler; overload;\r\nfunction Pos(const Search, InString: String): Integer; assembler; overload;\r\n//function Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer); overload;\r\nfunction upcase(c : char) : char; assembler;\r\nfunction HexStr(Val: NativeInt; cnt: byte): string; external name 'rtl.hexStr'; overload;\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer); overload;\r\nprocedure val(const S: String; out B : Byte; out Code: Integer); overload;\r\nprocedure val(const S: String; out SI : smallint; out Code: Integer); overload;\r\nprocedure val(const S: String; out W : word; out Code : Integer); overload;\r\nprocedure val(const S: String; out I : integer; out Code : Integer); overload;\r\nprocedure val(const S: String; out C : Cardinal; out Code: Integer); overload;\r\nprocedure val(const S: String; out d : double; out Code : Integer); overload;\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\n\r\n{*****************************************************************************\r\n                          Other functions\r\n*****************************************************************************}\r\nprocedure Write; varargs; // ToDo: should be compiler built-in function\r\nprocedure Writeln; varargs; // ToDo: should be compiler built-in function\r\n\r\nType\r\n  TConsoleHandler = Procedure (S : JSValue; NewLine : Boolean);\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler; overload;\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\n\r\nimplementation\r\n\r\n// function parseInt(s: String; Radix: NativeInt): NativeInt; external name 'parseInt'; // may result NaN\r\nfunction isNaN(i: JSValue): boolean; external name 'isNaN'; // may result NaN\r\n\r\n// needed by ClassNameIs, the real SameText is in SysUtils\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction ParamCount: Longint;\r\nbegin\r\n  if Assigned(OnParamCount) then\r\n    Result:=OnParamCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction ParamStr(Index: Longint): String;\r\nbegin\r\n  if Assigned(OnParamStr) then\r\n    Result:=OnParamStr(Index)\r\n  else if Index=0 then\r\n    Result:='js'\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n\r\nfunction Frac(const A: Double): Double; assembler;\r\nasm\r\n  return A % 1;\r\nend;\r\n\r\nfunction Odd(const A: Integer): Boolean; assembler;\r\nasm\r\n  return A&1 != 0;\r\nend;\r\n\r\nfunction Random(const Range: Integer): Integer; assembler;\r\nasm\r\n  return Math.floor(Math.random()*Range);\r\nend;\r\n\r\nfunction Sqr(const A: Integer): Integer; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Sqr(const A: Double): Double; assembler;\r\nasm\r\n  return A*A;\r\nend;\r\n\r\nfunction Trunc(const A: Double): NativeInt; assembler;\r\nasm\r\n  if (!Math.trunc) {\r\n    Math.trunc = function(v) {\r\n      v = +v;\r\n      if (!isFinite(v)) return v;\r\n      return (v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);\r\n    };\r\n  }\r\n  $mod.Trunc = Math.trunc;\r\n  return Math.trunc(A);\r\nend;\r\n\r\nfunction Copy(const S: string; Index, Size: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return (Size>0) ? S.substring(Index-1,Index+Size-1) : \"\";\r\nend;\r\n\r\nfunction Copy(const S: string; Index: Integer): String; assembler;\r\nasm\r\n  if (Index<1) Index = 1;\r\n  return S.substr(Index-1);\r\nend;\r\n\r\nprocedure Delete(var S: String; Index, Size: Integer);\r\nvar\r\n  h: String;\r\nbegin\r\n  if (Index<1) or (Index>length(S)) or (Size<=0) then exit;\r\n  h:=S;\r\n  S:=copy(h,1,Index-1)+copy(h,Index+Size);\r\nend;\r\n\r\nfunction Pos(const Search, InString: String): Integer; assembler;\r\nasm\r\n  return InString.indexOf(Search)+1;\r\nend;\r\n\r\n//function Pos(const Search, InString: String; StartAt : Integer): Integer; assembler; overload;\r\n//\r\n//asm\r\n//  return InString.indexOf(Search,StartAt-1)+1;\r\n//end;\r\n\r\n\r\n\r\nprocedure Insert(const Insertion: String; var Target: String; Index: Integer);\r\nvar\r\n  t: String;\r\nbegin\r\n  if Insertion='' then exit;\r\n  t:=Target;\r\n  if Index<1 then\r\n    Target:=Insertion+t\r\n  else if Index>length(t) then\r\n    Target:=t+Insertion\r\n  else\r\n    Target:=copy(t,1,Index-1)+Insertion+copy(t,Index,length(t));\r\nend;\r\n\r\nvar\r\n  WriteBuf: String;\r\n  JSArguments: array of JSValue; external name 'arguments';\r\n  WriteCallBack : TConsoleHandler;\r\n\r\nFunction SetWriteCallBack(H : TConsoleHandler) : TConsoleHandler;\r\n\r\nbegin\r\n  Result:=WriteCallBack;\r\n  WriteCallBack:=H;\r\nend;\r\n\r\nprocedure Write;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  for i:=0 to length(JSArguments)-1 do\r\n    if Assigned(WriteCallBack) then\r\n      WriteCallBack(JSArguments[i],False)\r\n    else\r\n      WriteBuf:=WriteBuf+String(JSArguments[i]);\r\nend;\r\n\r\nprocedure Writeln;\r\n\r\nvar\r\n  i,l: Integer;\r\n  s: String;\r\n\r\nbegin\r\n  L:=length(JSArguments)-1;\r\n  if Assigned(WriteCallBack) then\r\n    begin\r\n    for i:=0 to L do\r\n      WriteCallBack(JSArguments[i],I=L);\r\n    end\r\n  else\r\n    begin\r\n    s:=WriteBuf;\r\n    for i:=0 to L do\r\n      s:=s+String(JSArguments[i]);\r\n    asm\r\n      console.log(s);\r\n    end;\r\n    WriteBuf:='';\r\n    end;\r\nend;\r\n\r\nfunction Int(const A: Double): double;\r\n\r\n  function FTrunc(const A: Double): double; overload; external name 'Math.trunc';\r\n\r\nbegin\r\n  Result:=FTrunc(A);\r\nend;\r\n\r\nfunction Number(S: String): Double; external name 'Number';\r\n\r\nprocedure val(const S: String; out NI : NativeInt; out Code: Integer);\r\n\r\nvar\r\n  x : double;\r\n\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else\r\n    NI:=Trunc(x);\r\nend;\r\n\r\nprocedure val(const S: String; out SI : ShortInt; out Code: Integer);\r\n\r\nvar\r\n  X:Double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<MinShortInt) or (x>MaxShortInt) then\r\n    Code:=2\r\n  else\r\n    SI:=Trunc(x);\r\nend;\r\n\r\nprocedure val(const S: String; out SI: smallint; out Code: Integer);\r\n\r\nvar\r\n  x: double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<MinSmallint) or (x>MaxSmallint) then\r\n    Code:=2\r\n  else\r\n    SI:=Trunc(x);\r\nend;\r\n\r\nprocedure val(const S: String; out C: Cardinal; out Code: Integer);\r\n\r\nvar\r\n  x: double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<0) or (x>MaxCardinal) then\r\n    Code:=2\r\n  else\r\n    C:=trunc(x);\r\nend;\r\n\r\nprocedure val(const S: String; out B: Byte; out Code: Integer);\r\n\r\nvar\r\n  x: double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) or (X<>Int(X)) then\r\n    Code:=1\r\n  else if (x<0) or (x>MaxByte) then\r\n    Code:=2\r\n  else\r\n    B:=Trunc(x);\r\nend;\r\n\r\n\r\nprocedure val(const S: String; out W: word; out Code: Integer);\r\n\r\nvar\r\n  x: double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else if (x<0) or (x>MaxWord) then\r\n    Code:=2\r\n  else\r\n    W:=Trunc(x);\r\nend;\r\n\r\nprocedure val(const S : String; out I : integer; out Code : Integer);\r\nvar\r\n  x: double;\r\nbegin\r\n  Code:=0;\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else if x>MaxInt then\r\n    Code:=2\r\n  else\r\n    I:=Trunc(x);\r\nend;\r\n\r\nprocedure val(const S : String; out d : double; out Code : Integer);\r\n\r\nVar\r\n  x: double;\r\nbegin\r\n  x:=Number(S);\r\n  if isNaN(x) then\r\n    Code:=1\r\n  else\r\n    begin\r\n    Code:=0;\r\n    d:=x;\r\n    end;\r\nend;\r\n\r\nfunction upcase(c : char) : char; assembler;\r\n\r\nasm\r\n  return c.toUpperCase();\r\nend;\r\n\r\nfunction StringOfChar(c: Char; l: NativeInt): String;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result:='';\r\n  for i:=1 to l do Result:=Result+c;\r\nend;\r\n\r\nfunction Assigned(const V: JSValue): boolean; assembler;\r\nasm\r\n  return (V!=undefined) && (V!=null) && (!rtl.isArray(V) || (V.length > 0));\r\nend;\r\n\r\nfunction StrictEqual(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A === B;\r\nend;\r\n\r\nfunction StrictInequal(const A: JSValue; const B): boolean; assembler;\r\nasm\r\n  return A !== B;\r\nend;\r\n\r\n{ TContainedObject }\r\n\r\nfunction TContainedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\n{ TAggregatedObject }\r\n\r\nfunction TAggregatedObject.GetController: IUnknown;\r\nbegin\r\n  Result := IUnknown(fController);\r\nend;\r\n\r\nfunction TAggregatedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  Result := IUnknown(fController).QueryInterface(iid, obj);\r\nend;\r\n\r\nfunction TAggregatedObject._AddRef: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._AddRef;\r\nend;\r\n\r\nfunction TAggregatedObject._Release: Integer;\r\nbegin\r\n  Result := IUnknown(fController)._Release;\r\nend;\r\n\r\nconstructor TAggregatedObject.Create(const aController: IUnknown);\r\nbegin\r\n  inherited Create;\r\n  { do not keep a counted reference to the controller! }\r\n  fController := Pointer(aController);\r\nend;\r\n\r\n{ TInterfacedObject }\r\n\r\nfunction TInterfacedObject.QueryInterface(const iid: TGuid; out obj): Integer;\r\nbegin\r\n  if GetInterface(iid,obj) then\r\n    Result:=S_OK\r\n  else\r\n    Result:=Integer(E_NOINTERFACE);\r\nend;\r\n\r\nfunction TInterfacedObject._AddRef: Integer;\r\nbegin\r\n  inc(fRefCount);\r\n  Result:=fRefCount;\r\nend;\r\n\r\nfunction TInterfacedObject._Release: Integer;\r\nbegin\r\n  dec(fRefCount);\r\n  Result:=fRefCount;\r\n  if fRefCount=0 then\r\n    Destroy;\r\nend;\r\n\r\nprocedure TInterfacedObject.BeforeDestruction;\r\nbegin\r\n  if fRefCount<>0 then\r\n    asm\r\n    rtl.raiseE('EHeapMemoryError');\r\n    end;\r\nend;\r\n\r\n{ TObject }\r\n\r\nconstructor TObject.Create;\r\nbegin\r\n\r\nend;\r\n\r\ndestructor TObject.Destroy;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.Free;\r\nbegin\r\n  Destroy;\r\nend;\r\n\r\nclass function TObject.ClassType: TClass; assembler;\r\nasm\r\n  return this;\r\nend;\r\n\r\nclass function TObject.ClassNameIs(const Name: string): boolean;\r\nbegin\r\n  Result:=SameText(Name,ClassName);\r\nend;\r\n\r\nclass function TObject.InheritsFrom(aClass: TClass): boolean; assembler;\r\nasm\r\n  return (aClass!=null) && ((this==aClass) || aClass.isPrototypeOf(this));\r\nend;\r\n\r\nprocedure TObject.AfterConstruction;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TObject.BeforeDestruction;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TObject.GetInterface(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  asm\r\n    var i = iid.$intf;\r\n    if (i){\r\n      i = rtl.getIntfG(this,i.$guid,2);\r\n      if (i){\r\n        obj.set(i);\r\n        return true;\r\n      }\r\n    }\r\n  end;\r\n  Result := GetInterfaceByStr(GUIDToString(iid),obj);\r\nend;\r\n\r\nfunction TObject.GetInterface(const iidstr: String; out obj): boolean;\r\nbegin\r\n  Result := GetInterfaceByStr(iidstr,obj);\r\nend;\r\n\r\nfunction TObject.GetInterfaceByStr(const iidstr: String; out obj): boolean;\r\nbegin\r\n  if (iidstr = IObjectInstance) then\r\n    begin\r\n    obj:=Self;\r\n    exit(true);\r\n    end;\r\n  asm\r\n    var i = rtl.getIntfG(this,iidstr,2);\r\n    obj.set(i);\r\n    return i!==null;\r\n  end;\r\n  Result:=false;\r\nend;\r\n\r\nfunction TObject.GetInterfaceWeak(const iid: TGuid; out obj): boolean;\r\nbegin\r\n  Result:=GetInterface(iid,obj);\r\n  asm\r\n    if (Result){\r\n      var o = obj.get();\r\n      if (o.$kind==='com'){\r\n        o._Release();\r\n      }\r\n    }\r\n  end;\r\nend;\r\n\r\nfunction TObject.Equals(Obj: TObject): boolean;\r\nbegin\r\n  Result:=Obj=Self;\r\nend;\r\n\r\nfunction TObject.ToString: String;\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\ninitialization\r\n  ExitCode:=0; // set it here, so that WPO does not remove it\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit RTLConsts;\r\n\r\ninterface\r\n\r\nconst\r\n  SArgumentMissing              = 'Missing argument in format \"%s\"';\r\n  SInvalidFormat                = 'Invalid format specifier : \"%s\"';\r\n  SInvalidArgIndex              = 'Invalid argument index in format: \"%s\"';\r\n  SListCapacityError            = 'List capacity (%s) exceeded.';\r\n  SListCountError               = 'List count (%s) out of bounds.';\r\n  SListIndexError               = 'List index (%s) out of bounds';\r\n  SSortedListError              = 'Operation not allowed on sorted list';\r\n  SDuplicateString              = 'String list does not allow duplicates';  \r\n  SErrFindNeedsSortedList       = 'Cannot use find on unsorted list';\r\n\r\n  SInvalidName                  = 'Invalid component name: \"%s\"';\r\n  SInvalidBoolean               = '\"%s\" is not a valid boolean.';\r\n  SDuplicateName                = 'Duplicate component name: \"%s\"';\r\n\r\n  SErrInvalidDate               = 'Invalid date: \"%s\"';\r\n  SErrInvalidTimeFormat         = 'Invalid time format: \"%s\"';\r\n  SInvalidDateFormat            = 'Invalid date format: \"%s\"';\r\n\r\n  SCantReadPropertyS            = 'Cannot read property \"%s\"';\r\n  SCantWritePropertyS           = 'Cannot write property \"%s\"';\r\n  SErrPropertyNotFound          = 'Unknown property: \"%s\"';\r\n  SIndexedPropertyNeedsParams   = 'Indexed property \"%s\" needs parameters';\r\n\r\n  SErrInvalidInteger            = 'Invalid integer value: \"%s\"';\r\n  SErrInvalidFloat              = 'Invalid floating-point value: \"%s\"';\r\n  SInvalidDateTime              = 'Invalid date-time value: %s';\r\n  SInvalidCurrency              = 'Invalid currency value: %s';\r\n  SErrInvalidDayOfWeek          = '%d is not a valid day of the week';\r\n  SErrInvalidTimeStamp          = 'Invalid date/timestamp : \"%s\"';\r\n  SErrInvalidDateWeek           = '%d %d %d is not a valid dateweek';\r\n  SErrInvalidDayOfYear          = 'Year %d does not have a day number %d';\r\n  SErrInvalidDateMonthWeek      = 'Year %d, month %d, Week %d and day %d is not a valid date.';\r\n  SErrInvalidDayOfWeekInMonth   = 'Year %d Month %d NDow %d DOW %d is not a valid date';\r\n  SInvalidJulianDate            = '%f Julian cannot be represented as a DateTime';\r\n  SErrInvalidHourMinuteSecMsec  = '%d:%d:%d.%d is not a valid time specification';\r\n\r\n  SInvalidGUID                  = '\"%s\" is not a valid GUID value';\r\n\r\nimplementation\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Types;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\ntype\r\n  TDirection = (FromBeginning, FromEnd);\r\n\r\n  TBooleanDynArray = array of Boolean;\r\n  TIntegerDynArray = array of Integer;\r\n  TNativeIntDynArray = array of NativeInt;\r\n  TStringDynArray = array of String;\r\n  TDoubleDynArray = array of Double;\r\n  TJSValueDynArray = array of JSValue;\r\n\r\n  TDuplicates = (dupIgnore, dupAccept, dupError);\r\n\r\n  TListCallback = procedure(data, arg: JSValue) of object;\r\n  TListStaticCallback = procedure(data, arg: JSValue);\r\n\r\n  TSize  = record\r\n    cx, cy: integer;\r\n  end;\r\n\r\n  TPoint  = record\r\n    x, y: integer;\r\n  end;\r\n\r\n  TRect  = record\r\n    Left, Top, Right, Bottom: Integer;\r\n  end;\r\n\r\nfunction EqualRect(const r1,r2 : TRect) : Boolean;\r\nfunction Rect(Left, Top, Right, Bottom : Integer) : TRect;\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight : Integer) : TRect;\r\nfunction Point(x,y : Integer): TPoint; {$IFDEF Has_Inline}inline;{$ENDIF}\r\nfunction PtInRect(const aRect: TRect; const p: TPoint) : Boolean;\r\nfunction IntersectRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction UnionRect(out aRect: TRect; const R1,R2: TRect) : Boolean;\r\nfunction IsRectEmpty(const aRect: TRect) : Boolean;\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer) : Boolean;\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nfunction Size(const aRect: TRect): TSize;\r\n\r\nimplementation\r\n\r\nfunction EqualRect(const r1, r2: TRect): Boolean;\r\nbegin\r\n  Result:=(r1.left=r2.left) and (r1.right=r2.right) and (r1.top=r2.top) and (r1.bottom=r2.bottom);\r\nend;\r\n\r\nfunction Rect(Left, Top, Right, Bottom: Integer): TRect;\r\nbegin\r\n  Result.Left:=Left;\r\n  Result.Top:=Top;\r\n  Result.Right:=Right;\r\n  Result.Bottom:=Bottom;\r\nend;\r\n\r\nfunction Bounds(ALeft, ATop, AWidth, AHeight: Integer): TRect;\r\nbegin\r\n  Result.Left:=ALeft;\r\n  Result.Top:=ATop;\r\n  Result.Right:=ALeft+AWidth;\r\n  Result.Bottom:=ATop+AHeight;\r\nend;\r\n\r\nfunction Point(x, y: Integer): TPoint;\r\nbegin\r\n  Result.x:=x;\r\n  Result.y:=y;\r\nend;\r\n\r\nfunction PtInRect(const aRect: TRect; const p: TPoint): Boolean;\r\nbegin\r\n  Result:=(p.y>=aRect.Top) and\r\n          (p.y<aRect.Bottom) and\r\n          (p.x>=aRect.Left) and\r\n          (p.x<aRect.Right);\r\nend;\r\n\r\nfunction IntersectRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect := R1;\r\n  if R2.Left > R1.Left then\r\n    lRect.Left := R2.Left;\r\n  if R2.Top > R1.Top then\r\n    lRect.Top := R2.Top;\r\n  if R2.Right < R1.Right then\r\n    lRect.Right := R2.Right;\r\n  if R2.Bottom < R1.Bottom then\r\n    lRect.Bottom := R2.Bottom;\r\n\r\n  // The var parameter is only assigned in the end to avoid problems\r\n  // when passing the same rectangle in the var and const parameters.\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    Result:=true;\r\n    aRect := lRect;\r\n  end;\r\nend;\r\n\r\nfunction UnionRect(out aRect: TRect; const R1, R2: TRect): Boolean;\r\nvar\r\n  lRect: TRect;\r\nbegin\r\n  lRect:=R1;\r\n  if R2.Left<R1.Left then\r\n    lRect.Left:=R2.Left;\r\n  if R2.Top<R1.Top then\r\n    lRect.Top:=R2.Top;\r\n  if R2.Right>R1.Right then\r\n    lRect.Right:=R2.Right;\r\n  if R2.Bottom>R1.Bottom then\r\n    lRect.Bottom:=R2.Bottom;\r\n\r\n  if IsRectEmpty(lRect) then\r\n  begin\r\n    aRect:=Rect(0,0,0,0);\r\n    Result:=false;\r\n  end\r\n  else\r\n  begin\r\n    aRect:=lRect;\r\n    Result:=true;\r\n  end;\r\nend;\r\n\r\nfunction IsRectEmpty(const aRect: TRect): Boolean;\r\nbegin\r\n  Result:=(aRect.Right<=aRect.Left) or (aRect.Bottom<=aRect.Top);\r\nend;\r\n\r\nfunction OffsetRect(var aRect: TRect; DX, DY: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n    begin\r\n    inc(Left,dx);\r\n    inc(Top,dy);\r\n    inc(Right,dx);\r\n    inc(Bottom,dy);\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction CenterPoint(const aRect: TRect): TPoint;\r\n\r\n  function Avg(a, b: Longint): Longint;\r\n  begin\r\n    if a < b then\r\n      Result := a + ((b - a) shr 1)\r\n    else\r\n      Result := b + ((a - b) shr 1);\r\n  end;\r\n\r\nbegin\r\n  with aRect do\r\n    begin\r\n      Result.X := Avg(Left, Right);\r\n      Result.Y := Avg(Top, Bottom);\r\n    end;\r\nend;\r\n\r\nfunction InflateRect(var aRect: TRect; dx, dy: Integer): Boolean;\r\nbegin\r\n  with aRect do\r\n  begin\r\n    dec(Left, dx);\r\n    dec(Top, dy);\r\n    inc(Right, dx);\r\n    inc(Bottom, dy);\r\n  end;\r\n  Result := True;\r\nend;\r\n\r\nfunction Size(AWidth, AHeight: Integer): TSize;\r\nbegin\r\n  Result.cx := AWidth;\r\n  Result.cy := AHeight;\r\nend;\r\n\r\nfunction Size(const aRect: TRect): TSize;\r\nbegin\r\n  Result.cx := aRect.Right - aRect.Left;\r\n  Result.cy := aRect.Bottom - aRect.Top;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit JS;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Types;\r\n\r\ntype\r\n  // We cannot use EConvertError or Exception, this would result in a circular dependency.\r\n\r\n  { EJS }\r\n\r\n  EJS = class(TObject)\r\n  private\r\n    FMessage: string;\r\n  Public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    property Message : string Read FMessage Write FMessage;\r\n  end;\r\n\r\n  TJSObjectPropertyDescriptor = JSValue;\r\n  Float32 = Double;\r\n  Float64 = Double;\r\n\r\n  { TJSObject }\r\n\r\n  TJSObject = class external name 'Object'\r\n  private\r\n    function GetProperties(Name: String): JSValue; external name '[]';\r\n    procedure SetProperties(Name: String; const AValue: JSValue); external name '[]';\r\n  public\r\n    constructor new;\r\n    class function create(const proto: TJSObject): TJSObject;\r\n    class function create(const proto, propertiesObject: TJSObject): TJSObject;\r\n    class function assign(const Target, Source1: TJSObject): TJSObject; varargs;\r\n    class procedure defineProperty(const obj: TJSObject; propname: String; const descriptor: TJSObjectPropertyDescriptor);\r\n    //class procedure defineProperties\r\n    class function freeze(const obj: TJSObject): TJSObject;\r\n    class function getOwnPropertyDescriptor(const obj: TJSObject; propname: String): TJSObjectPropertyDescriptor;\r\n    //class function getOwnPropertyDescriptors\r\n    class function getOwnPropertyNames(const obj: TJSObject): TStringDynArray;\r\n    {$IFDEF FIREFOX}\r\n    class function getOwnPropertySymbols(const obj: TJSObject): TJSValueDynArray;\r\n    {$ENDIF}\r\n    class function getPrototypeOf(const obj: TJSObject): TJSObject;\r\n    {$IFDEF FIREFOX}\r\n    class function _is(const value1, value2: JSValue): boolean;\r\n    {$ENDIF}\r\n    class function isExtensible(const obj: TJSObject): boolean;\r\n    class function isFrozen(const obj: TJSObject): boolean;\r\n    class function isSealed(const obj: TJSObject): boolean;\r\n    class function keys(const obj: TJSObject): TStringDynArray;\r\n    class function preventExtensions(const obj: TJSObject): TJSObject;\r\n    class function seal(const obj: TJSObject): TJSObject;\r\n    class function setPrototypeOf(const obj, prototype: TJSObject): TJSObject;\r\n    function hasOwnProperty(prop: String): boolean;\r\n    function isPrototypeOf(const obj: TJSObject): boolean;\r\n    function propertyIsEnumerable(propname: String): boolean;\r\n    function toLocaleString: String;\r\n    function toString: String;\r\n    function valueOf: JSValue;\r\n    property Properties[Name: String]: JSValue read GetProperties write SetProperties; default;\r\n  end;\r\n\r\n  TJSObjectDynArray = Array of TJSObject;\r\n  TJSObjectDynArrayArray = Array of TJSObjectDynArray;\r\n  TJSStringDynArray = Array of String;\r\n\r\n  { TJSFunction }\r\n\r\n  TJSFunction = class external name 'Function'(TJSObject)\r\n  private\r\n    Flength: NativeInt external name 'length';\r\n    Fprototyp: TJSFunction external name 'prototyp';\r\n  public\r\n    name: String;\r\n    property prototyp: TJSFunction read Fprototyp;\r\n    property length: NativeInt read Flength;\r\n    function apply(thisArg: TJSObject; const ArgArray: TJSValueDynArray): JSValue; varargs;\r\n    function bind(thisArg: TJSObject): JSValue; varargs;\r\n    function call(thisArg: TJSObject): JSValue; varargs;\r\n  end;\r\n\r\n  { TJSDate - wrapper for JavaScript Date }\r\n\r\n  TJSDate = class external name 'Date'(TJSFunction)\r\n  private\r\n    function getDate: NativeInt;\r\n    function getFullYear: NativeInt;\r\n    function getHours: NativeInt;\r\n    function getMilliseconds: NativeInt;\r\n    function getMinutes: NativeInt;\r\n    function getMonth: NativeInt;\r\n    function getSeconds: NativeInt;\r\n    function getYear: NativeInt;\r\n    function getTime: NativeInt;\r\n    function getUTCDate: NativeInt;\r\n    function getUTCFullYear: NativeInt;\r\n    function getUTCHours: NativeInt;\r\n    function getUTCMilliseconds: NativeInt;\r\n    function getUTCMinutes: NativeInt;\r\n    function getUTCMonth: NativeInt;\r\n    function getUTCSeconds: NativeInt;\r\n    procedure setDate(const AValue: NativeInt);\r\n    procedure setFullYear(const AValue: NativeInt);\r\n    procedure setHours(const AValue: NativeInt);\r\n    procedure setMilliseconds(const AValue: NativeInt);\r\n    procedure setMinutes(const AValue: NativeInt);\r\n    procedure setMonth(const AValue: NativeInt);\r\n    procedure setSeconds(const AValue: NativeInt);\r\n    procedure setYear(const AValue: NativeInt);\r\n    procedure setTime(const AValue: NativeInt);\r\n    procedure setUTCDate(const AValue: NativeInt);\r\n    procedure setUTCFullYear(const AValue: NativeInt);\r\n    procedure setUTCHours(const AValue: NativeInt);\r\n    procedure setUTCMilliseconds(const AValue: NativeInt);\r\n    procedure setUTCMinutes(const AValue: NativeInt);\r\n    procedure setUTCMonth(const AValue: NativeInt);\r\n    procedure setUTCSeconds(const AValue: NativeInt);\r\n  public\r\n    constructor New; reintroduce;\r\n    constructor New(const MilliSecsSince1970: NativeInt); // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    constructor New(const aDateString: String); // RFC 2822, ISO8601\r\n    constructor New(aYear: NativeInt; aMonth: NativeInt; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0);\r\n    class function now: NativeInt; // current date and time in milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    class function parse(const aDateString: string): NativeInt; // format depends on browser\r\n    class function UTC(aYear: NativeInt; aMonth: NativeInt = 0; aDayOfMonth: NativeInt = 1;\r\n      TheHours: NativeInt = 0; TheMinutes: NativeInt = 0; TheSeconds: NativeInt = 0;\r\n      TheMilliseconds: NativeInt = 0): NativeInt;\r\n    function getDay: NativeInt;\r\n    function getTimezoneOffset: NativeInt;\r\n    function getUTCDay: NativeInt; // day of the week\r\n    function toDateString: string; // human readable date, without time\r\n    function toISOString: string; // ISO 8601 Extended Format\r\n    function toJSON: string;\r\n    function toGMTString: string; // in GMT timezone\r\n    function toLocaleDateString: string; // date in locale timezone, no time\r\n    function toLocaleString: string; reintroduce; // date and time in locale timezone\r\n    function toLocaleTimeString: string; // time in locale timezone, no date\r\n    function toTimeString: string; // time human readable, no date\r\n    function toUTCString: string; // date and time using UTC timezone\r\n    property Year: NativeInt read getYear write setYear;\r\n    property Time: NativeInt read getTime write setTime; // milliseconds since 1 January 1970 00:00:00 UTC, with leap seconds ignored\r\n    property FullYear: NativeInt read getFullYear write setFullYear;\r\n    property UTCDate: NativeInt read getUTCDate write setUTCDate; // day of month\r\n    property UTCFullYear: NativeInt read getUTCFullYear write setUTCFullYear;\r\n    property UTCHours: NativeInt read getUTCHours write setUTCHours;\r\n    property UTCMilliseconds: NativeInt read getUTCMilliseconds write setUTCMilliseconds;\r\n    property UTCMinutes: NativeInt read getUTCMinutes write setUTCMinutes;\r\n    property UTCMonth: NativeInt read getUTCMonth write setUTCMonth;\r\n    property UTCSeconds: NativeInt read getUTCSeconds write setUTCSeconds;\r\n    property Month: NativeInt read getMonth write setMonth;\r\n    property Date: NativeInt read getDate write setDate; // day of the month, starting at 1\r\n    property Hours: NativeInt read getHours write setHours;\r\n    property Minutes: NativeInt read getMinutes write setMinutes;\r\n    property Seconds: NativeInt read getSeconds write setSeconds;\r\n    property Milliseconds: NativeInt read getMilliseconds write setMilliseconds;\r\n  end;\r\n\r\n  TLocaleCompareOptions = record\r\n    localematched : string;\r\n    usage: string;\r\n    sensitivity : string;\r\n    ignorePunctuation : Boolean;\r\n    numeric : boolean;\r\n    caseFirst : string;\r\n  end;\r\n\r\n  TJSRegexp = class external name 'RegExp'\r\n  private\r\n  {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    FFlags : string; external name 'flags';\r\n    FSticky : boolean; external name 'sticky';\r\n  {$endif}\r\n    fglobal: boolean; external name 'global';\r\n    fignoreCase : boolean; external name 'ignoreCase';\r\n    fmultiline : boolean; external name 'multiline';\r\n    fsource : string; external name 'source';\r\n    funicode : boolean; external name 'unicode';\r\n  public\r\n    Constructor New(Pattern : string);\r\n    Constructor New(Pattern, Flags : string);\r\n    lastIndex: NativeInt;\r\n    function exec(aString : string): TStringDynArray;\r\n    function test(aString : string) : boolean;\r\n    function toString : String;\r\n    property Global : boolean read fglobal;\r\n    property IgnoreCase : Boolean read FIgnoreCase;\r\n    property Multiline : Boolean Read FMultiLine;\r\n    Property Source : string Read FSource;\r\n    Property Unicode : boolean Read FUnicode;\r\n    {$IFDEF FIREFOX}\r\n    // not on all browsers:\r\n    property Flags : string read FFlags;\r\n    property Sticky : boolean read FSticky;\r\n    {$endif}\r\n  end;\r\n\r\n\r\n  TReplaceCallBack = Function () : string; varargs;\r\n\r\n  TJSString = class external name 'String'\r\n  private\r\n    flength : NativeInt; external name 'length';\r\n  public \r\n    constructor New(Const S : String);\r\n    constructor New(Const I : NativeInt);\r\n    constructor New(Const D : double);\r\n    property length : NativeInt read flength; \r\n    class function fromCharCode() : string; varargs;\r\n    class function fromCodePoint() : string; varargs;\r\n    function anchor(const aName : string) : string;\r\n    function charAt(aIndex : NativeInt) : string;\r\n    function charCodeAt(aIndex : NativeInt) : NativeInt;\r\n    function codePointAt(aIndex : NativeInt) : NativeInt;\r\n    function concat(s : string) : string; varargs;\r\n    function endsWith(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function includes(aSearchString : string; Pos : NativeInt = 0) : boolean;\r\n    function indexOf(aSearchString : String; Pos : NativeInt = 0) : Integer;\r\n    function lastIndexOf(aSearchString : String) : NativeInt;overload;\r\n    function lastIndexOf(aSearchString : String; Pos : NativeInt) : Integer;overload;\r\n    function link(aUrl : string) : String;\r\n    function localeCompare(aCompareString : string) : NativeInt; overload;\r\n    function localeCompare(aCompareString : string; aLocales: string) : integer; overload;\r\n    function localeCompare(compareString : string; locales: string; Options : TlocaleCompareOptions) : integer; overload;\r\n    function match(aRegexp : TJSRegexp) : TStringDynArray; overload;\r\n    function match(aRegexp : String) : TStringDynArray;overload;\r\n    {$IFDEF ECMAScript6}\r\n    function normalize(aForm : string) : string;\r\n    {$ENDIF}\r\n    function _repeat(aCount : NativeInt) : Integer; external name 'repeat';\r\n    function replace(aRegexp : String; NewString : String) : String; overload;\r\n    function replace(aRegexp : TJSRegexp; NewString : String) : String; overload;\r\n    function replace(Regexp : String; aCallback : TReplaceCallBack) : String; overload;\r\n    function replace(Regexp : TJSRegexp; aCallback : TReplaceCallBack) : String; overload;\r\n    function search(Regexp : TJSRegexp) : NativeInt; overload;\r\n    function search(Regexp : JSValue) : NativeInt; overload;\r\n    function slice(aBeginIndex : NativeInt) : String; overload;\r\n    function slice(aBeginIndex, aEndIndex : NativeInt) : String; overload;\r\n    function split : TStringDynArray; overload;\r\n    function split(aSeparator : string) : TStringDynArray; overload;\r\n    function split(aSeparator : string; aLimit : NativeInt) : TStringDynArray; overload;\r\n    function startsWith(aSearchString : String) : Boolean; overload;\r\n    function startsWith(aSearchString : String; aPosition : NativeInt) : Boolean; overload;\r\n    function substr(aStartIndex : NativeInt) : String; overload;\r\n    function substr(aStartIndex,aLength : NativeInt) : String; overload;\r\n    function subString(aStartIndex : NativeInt) : String; overload;\r\n    function subString(aStartIndex,aEndIndex : NativeInt) : String; overload;\r\n    function toLocaleLowerCase : String;\r\n    function toLocaleUpperCase : String;\r\n    function toLowerCase : String;\r\n    function toString : string;\r\n    function toUpperCase : String;\r\n    function trim : string;\r\n    function valueOf : string;\r\n  end;\r\n\r\n  TJSArray = Class;\r\n  \r\n  TJSArrayEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : Boolean;\r\n  TJSArrayMapEvent = reference to function (element : JSValue; index: NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayReduceEvent = reference to function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSArray) : JSValue;\r\n  TJSArrayCompareEvent = reference to function (a,b : JSValue) : NativeInt;\r\n  TJSArrayCallback = TJSArrayEvent;\r\n  TJSArrayMapCallback = TJSArrayMapEvent;\r\n  TJSArrayReduceCallBack = TJSArrayReduceEvent;\r\n  TJSArrayCompareCallBack = TJSArrayCompareEvent;\r\n\r\n  { TJSArray }\r\n\r\n  TJSArray = Class external name 'Array'\r\n  private\r\n    function GetElements(Index: NativeInt): JSValue; external name '[]';\r\n    procedure SetElements(Index: NativeInt; const AValue: JSValue); external name '[]';\r\n  public\r\n    FLength : NativeInt; external name 'length';\r\n    constructor new; overload;\r\n    constructor new(aLength : NativeInt); overload;\r\n    constructor new(aElement1 : JSValue); varargs; overload;\r\n    class function _of() : TJSArray; varargs; external name 'of'; \r\n    class function isArray(a: JSValue) : Boolean;\r\n{$IFDEF JAVASCRIPT2015}    \r\n    class function from(a : JSValue) : TJSArray;\r\n{$ENDIF}    \r\n    function concat(el : JSValue) : TJSArray; varargs;\r\n    function copyWithin(aTarget : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSarray;overload; // not in IE\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSarray;overload; // not in IE\r\n    Function every(const aCallback : TJSArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function filter(const aCallBack : TJSArrayCallBack) : TJSArray; overload;\r\n    Function filter(const aCallBack : TJSArrayEvent; aThis : TObject) : TJSArray;overload;\r\n    Function fill(aValue : JSValue) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSArray; overload;\r\n    Function find(const aCallBack : TJSArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent); overload;\r\n    procedure forEach(const aCallBack : TJSArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSArrayMapCallBack) : TJSArray; overload;\r\n    Function map(const aCallBack : TJSArrayMapEvent; aThis : TObject) : TJSArray; overload;\r\n    function pop : JSValue; \r\n    function push(aElement : JSValue) : NativeInt; varargs;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSArray;\r\n    Function shift : JSValue;\r\n    Function slice : TJSArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArray; overload;\r\n    Function some(const aCallback : TJSArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSArrayCompareCallBack) : TJSArray; overload;\r\n    Function sort() : TJSArray; overload;\r\n    function splice(aStart : NativeInt) : TJSArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs; \r\n    Property Length : NativeInt Read FLength Write FLength;\r\n    property Elements[Index: NativeInt]: JSValue read GetElements write SetElements; default;\r\n  end;\r\n\r\n  TJSArrayBuffer = Class external name 'ArrayBuffer'\r\n  private\r\n    fLength : NativeInt; external name 'byteLength';\r\n  public\r\n    constructor new(aByteLength : NativeInt);\r\n    class function isView(aValue : JSValue) : Boolean;   \r\n    function slice(aBegin : NativeInt) : TJSArrayBuffer; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSArrayBuffer; overload;\r\n    Property byteLength : NativeInt Read fLength;\r\n  end;\r\n\r\n  TJSBufferSource = class external name 'BufferSource'\r\n  end;\r\n\r\n  { TJSTypedArray }\r\n  TJSTypedArray = Class;\r\n\r\n  TJSTypedArrayCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean;\r\n  TJSTypedArrayEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : Boolean of object;\r\n  TJSTypedArrayMapCallBack = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayMapEvent = function (element : JSValue; index: NativeInt; anArray : TJSTypedArray) : JSValue of object;\r\n  TJSTypedArrayReduceCallBack = function (accumulator, currentValue : JSValue; currentIndex : NativeInt; anArray : TJSTypedArray) : JSValue;\r\n  TJSTypedArrayCompareCallBack = function (a,b : JSValue) : NativeInt;\r\n\r\n  TJSTypedArray = class external name 'TypedArray' (TJSBufferSource)\r\n  Private\r\n    FBuffer: TJSArrayBuffer; external name 'buffer';\r\n    FByteLength: NativeInt; external name 'byteLength';\r\n    FLength: NativeInt; external name 'length';\r\n    FByteOffset: NativeInt; external name 'byteOffset';\r\n    function getValue(Index : NativeInt) : JSValue; external name '[]';\r\n    procedure setValue(Index : NativeInt;AValue : JSValue); external name '[]';\r\n  Public\r\n    class var BYTES_PER_ELEMENT : NativeInt;\r\n    class var name : string;\r\n    class function from(aValue : jsValue) : TJSTypedArray;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSTypedArray;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSTypedArray;\r\n    class function _of(aValue : jsValue) : TJSTypedArray; varargs; external name 'of';\r\n    function copyWithin(aTarget : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart : NativeInt) : TJSTypedArray;overload;\r\n    function copyWithin(aTarget, aStart, aEnd : NativeInt) : TJSTypedArray;overload;\r\n    Function every(const aCallback : TJSTypedArrayCallBack) : boolean;overload;\r\n    Function every(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean;overload;\r\n    Function fill(aValue : JSValue) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function fill(aValue : JSValue; aStartIndex,aEndIndex : NativeInt) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function filter(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray;overload;\r\n    Function find(const aCallBack : TJSTypedArrayCallBack) : JSValue; overload;\r\n    Function find(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : JSValue; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayCallBack) : NativeInt; overload;\r\n    Function findIndex(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : NativeInt; overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayCallBack); overload;\r\n    procedure forEach(const aCallBack : TJSTypedArrayEvent; aThis : TObject); overload;\r\n    function includes(aElement : JSValue) : Boolean; overload;\r\n    function includes(aElement : JSValue; FromIndex : NativeInt) : Boolean; overload;\r\n    function indexOf(aElement : JSValue) : NativeInt; overload;\r\n    function indexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    function join : String; overload;\r\n    function join (aSeparator : string) : String; overload;\r\n    function lastIndexOf(aElement : JSValue) : NativeInt; overload;\r\n    function lastIndexOf(aElement : JSValue; FromIndex : NativeInt) : NativeInt; overload;\r\n    Function map(const aCallBack : TJSTypedArrayCallBack) : TJSTypedArray; overload;\r\n    Function map(const aCallBack : TJSTypedArrayEvent; aThis : TObject) : TJSTypedArray; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduce(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack) : JSValue; overload;\r\n    function reduceRight(const aCallBack : TJSTypedArrayReduceCallBack; initialValue : JSValue) : JSValue; overload;\r\n    Function reverse : TJSTypedArray;\r\n    procedure _set(anArray : TJSArray); external name 'set';\r\n    procedure _set(anArray : TJSArray; anOffset : NativeInt); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray); external name 'set';\r\n    procedure _set(anArray : TJSTypedArray; anOffset : NativeInt); external name 'set';\r\n    Function slice : TJSTypedArray; overload;\r\n    function slice(aBegin : NativeInt) : TJSTypedArray; overload;\r\n    function slice(aBegin,aEnd : NativeInt) : TJSTypedArray; overload;\r\n    Function some(const aCallback : TJSTypedArrayCallBack) : boolean; overload;\r\n    Function some(const aCallback : TJSTypedArrayEvent; aThis : TObject) : boolean; overload;\r\n    Function sort(const aCallback : TJSTypedArrayCompareCallBack) : TJSTypedArray; overload;\r\n    Function sort() : TJSTypedArray; overload;\r\n    function splice(aStart : NativeInt) : TJSTypedArray; overload;\r\n    function splice(aStart,aDeleteCount : NativeInt) : TJSTypedArray; varargs; overload;\r\n    function toLocaleString: String; overload;\r\n    function toLocaleString(locales : string) : String; overload;\r\n    function toLocaleString(locales : string; const Options : TLocaleCompareOptions) : String; overload;\r\n    function toString : String;\r\n    function unshift : NativeInt; varargs;\r\n    property buffer : TJSArrayBuffer read FBuffer;\r\n    property byteLength : NativeInt Read FByteLength;\r\n    property byteOffset : NativeInt Read FByteOffset;\r\n    property length : NativeInt Read FLength;\r\n    property values[Index : NativeInt] : JSValue Read getValue Write SetValue; default;\r\n  end;\r\n\r\n  { TJSInt8Array }\r\n\r\n  TJSInt8Array = class external name 'Int8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Shortint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Shortint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt8Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt8Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of ShortInt); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of ShortInt; anOffset : NativeInt); external name 'set';\r\n    property values[Index : NativeInt] : Shortint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8Array  = class external name 'Uint8Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt8Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint8ClampedArray  = class external name 'Uint8ClampedArray' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Byte; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Byte);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt8ClampedArray; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt8ClampedArray; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt8ClampedArray; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt8ClampedArray; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Byte); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Byte; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : Byte Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt16Array = class external name 'Int16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): smallint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Smallint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt16Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt16Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of SmallInt); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of SmallInt; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : SmallInt Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint16Array = class external name 'Uint16Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Word; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Word);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt16Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt16Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt16Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Word); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Word; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : Word Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSInt32Array = class external name 'Int32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): longint; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: longint);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSInt32Array; varargs;external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of LongInt; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : longint Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSUint32Array = class external name 'Uint32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): LongWord; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: LongWord);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSUInt32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSUInt32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSUInt32Array; varargs; external name 'of'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Cardinal; anOffset : NativeInt); external name 'set';\r\n    Property values[Index : NativeInt] : LongWord Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat32Array = class external name 'Float32Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float32; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float32);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat32Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat32Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat32Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    Property values[Index : NativeInt] : Float32 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSFloat64Array = class external name 'Float64Array' (TJSTypedArray)\r\n  private\r\n    function getTypedValue(Index : NativeInt): Float64; external name '[]';\r\n    procedure setTypedValue(Index : NativeInt; AValue: Float64);external name '[]';\r\n  public\r\n    constructor new (length : NativeInt);\r\n    constructor new (atypedArray : TJSTypedArray);\r\n    constructor new (aObject : TJSObject);\r\n    constructor new (buffer : TJSArrayBuffer);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset: NativeInt);\r\n    constructor new (buffer : TJSArrayBuffer; aByteOffset, aLength: NativeInt);\r\n    class function from(aValue : jsValue) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; Map : TJSTypedArrayMapCallBack) : TJSFloat64Array; reintroduce;\r\n    class function from(aValue : jsValue; aMap : TJSTypedArrayMapEvent) : TJSFloat64Array; reintroduce;\r\n    class function _of(aValue : jsValue) : TJSFloat64Array; varargs; reintroduce;\r\n    procedure _set(anArray : Array of Double); external name 'set'; reintroduce;\r\n    procedure _set(anArray : Array of Double; anOffset : NativeInt); external name 'set'; reintroduce;\r\n    Property values[Index : NativeInt] : Float64 Read getTypedValue Write setTypedValue; default;\r\n  end;\r\n\r\n  TJSDataView = Class external name 'DataView' (TJSBufferSource)\r\n  private\r\n    fBuffer : TJSArrayBuffer; external name 'buffer';\r\n    fLength : NativeInt; external name 'byteLength';\r\n    fOffset : NativeInt; external name 'byteOffset';\r\n  public\r\n    constructor new(aBuffer : TJSArrayBuffer); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset : NativeInt); overload;\r\n    constructor new(aBuffer : TJSArrayBuffer; aOffset,aByteLength : NativeInt); overload;\r\n    function getFloat32(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat32(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt) : double; overload;\r\n    function getFloat64(aByteOffset : NativeInt; aLittleEndian: Boolean) : double; overload;\r\n    function getInt8(aByteOffset : NativeInt) : ShortInt; \r\n    function getInt16(aByteOffset : NativeInt) : SmallInt; overload;\r\n    function getInt16(aByteOffset : NativeInt; aLittleEndian : Boolean) : SmallInt; overload;\r\n    function getInt32(aByteOffset : NativeInt) : Longint; overload;\r\n    function getInt32(aByteOffset : NativeInt; aLittleEndian : Boolean) : Longint; overload;\r\n    function getUint8(aByteOffset : NativeInt) : Byte; overload;\r\n    function getUint16(aByteOffset : NativeInt) : Word; overload;\r\n    function getUint16(aByteOffset : NativeInt; aLittleEndian : Boolean) : Word; overload;\r\n    function getUint32(aByteOffset : NativeInt) : LongWord; overload;\r\n    function getUint32(aByteOffset : NativeInt; aLittleEndian : Boolean) : LongWord; overload;\r\n\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat32(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double); overload;\r\n    procedure setFloat64(aByteOffset : NativeInt; aValue : double; aLittleEndian: Boolean); overload;\r\n    procedure setInt8(aByteOffset : NativeInt; aValue : ShortInt); \r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt); overload;\r\n    procedure setInt16(aByteOffset : NativeInt; aValue : SmallInt; aLittleEndian : Boolean); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint); overload;\r\n    procedure setInt32(aByteOffset : NativeInt; aValue : Longint; aLittleEndian : Boolean); overload;\r\n    procedure setUint8(aByteOffset : NativeInt; aValue : Byte); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word); overload;\r\n    procedure setUint16(aByteOffset : NativeInt; aValue : Word; aLittleEndian : Boolean); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue : LongWord); overload;\r\n    procedure setUint32(aByteOffset : NativeInt; aValue: LongWord; aLittleEndian : Boolean); overload;\r\n \r\n    Property byteLength : NativeInt Read fLength;\r\n    Property byteOffset : NativeInt read fOffset;\r\n    property buffer : TJSArrayBuffer Read fBuffer;\r\n  end;\r\n\r\n  TJSJSON = class external name 'JSON' (TJSObject)\r\n  Public\r\n    class function parse(aJSON : String) : JSValue;\r\n    // Use this only when you are sure you will get an object, no checking is done.\r\n    class function parseObject(aJSON : String) : TJSObject; external name 'parse';\r\n    class function stringify(aValue : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  NativeInt) : string;\r\n    class function stringify(aValue,aReplacer : JSValue; space:  String) : string;\r\n  end;\r\n\r\n  { TJSError }\r\n\r\n  TJSError = CLass external name 'Error'\r\n  private\r\n    FMessage: String; external name 'message';\r\n  Public\r\n    Constructor new;\r\n    Constructor new(Const aMessage : string);\r\n    Constructor new(Const aMessage,aFileName : string);\r\n    Constructor new(Const aMessage,aFileName : string; aLineNumber : NativeInt);\r\n    Property Message : String Read FMessage;\r\n  end;\r\n\r\n\r\n  TJSPromiseResolver = reference to function (aValue : JSValue) : JSValue;\r\n  TJSPromiseExecutor = reference to procedure (resolve,reject : TJSPromiseResolver);\r\n  TJSPromiseFinallyHandler = reference to procedure;\r\n  TJSPromise = Class;\r\n  TJSPromiseArray = array of TJSPromise;\r\n\r\n  TJSPromise = class external name 'Promise'\r\n    constructor new(Executor : TJSPromiseExecutor);\r\n    class function all(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function all(arg : JSValue) : TJSPromise; overload;\r\n    class function all(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function race(arg : Array of JSValue) : TJSPromise; overload;\r\n    class function race(arg : JSValue) : TJSPromise; overload;\r\n    class function race(arg : TJSPromiseArray) : TJSPromise; overload;\r\n    class function reject(reason : JSValue) : TJSPromise;\r\n    class function resolve(value : JSValue): TJSPromise; overload;\r\n    class function resolve : TJSPromise; overload;\r\n    function _then (onAccepted : TJSPromiseResolver) : TJSPromise; external name 'then';\r\n    function catch (onRejected : TJSPromiseResolver) : TJSPromise;\r\n    function _finally(value : TJSPromiseFinallyHandler): TJSPromise;\r\n  end;\r\n\r\n\r\nvar\r\n  // This can be used in procedures/functions to provide access to the 'arguments' array.\r\n  JSArguments: TJSValueDynArray; external name 'arguments';\r\n  // This can be used in all code to access the javascript 'this' object.\r\n  JSThis: TJSObject; external name 'this';\r\n  // This can be used in catch blocks to access the JS throw value\r\n  JSExceptValue: JSValue; external name '$e';\r\n\r\nFunction new(aElements: TJSValueDynArray) : TJSObject; overload;\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler; overload;\r\n\r\nfunction decodeURIComponent(encodedURI : String) : String; external name 'decodeURIComponent';\r\nfunction encodeURIComponent(str : String) : String; external name 'encodeURIComponent';\r\n\r\nfunction parseInt(s: String; Radix: NativeInt): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseInt(s: String): NativeInt; overload; external name 'parseInt'; // may result NaN\r\nfunction parseFloat(s: String): double; overload; external name 'parseFloat'; // may result NaN\r\n\r\nfunction hasString(const v: JSValue): boolean; external name 'rtl.hasString';// isString(v) and v<>''\r\nfunction hasValue(const v: JSValue): boolean; assembler; // returns the JS definition of if(v): v is not false, undefined, null, 0, NaN, or the empty string. Note: JS if(new Boolean(false)) returns true.\r\nfunction isArray(const v: JSValue): boolean; external name 'rtl.isArray';\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nfunction isClass(const v: JSValue): boolean; assembler; // is a Pascal class, e.g. a TClass\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;// is a Pascal class instance, e.g. a TObject\r\nfunction isFunction(const v: JSValue): boolean; external name 'rtl.isFunction';\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nfunction isModule(const v: JSValue): boolean; external name 'rtl.isModule';\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\nfunction isNumber(const v: JSValue): boolean; external name 'rtl.isNumber';\r\nfunction isObject(const v: JSValue): boolean; external name 'rtl.isObject'; // true if not null and a JS Object\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nfunction isString(const v: JSValue): boolean; external name 'rtl.isString';\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nfunction isExt(const InstanceOrClass, aClass: JSValue): boolean; external name 'rtl.isExt'; // aClass can be a JS object or function\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue): String; assembler;\r\nfunction jsTypeOf(const v: JSValue): String; external name 'typeof';\r\nfunction jsIsNaN(const v: JSValue): boolean; external name 'isNaN';// true if value cannot be converted to a number. e.g. True on NaN, undefined, {}, '123'. False on true, null, '', ' ', '1A'\r\nfunction toNumber(const v: JSValue): double; assembler; // if not possible, returns NaN\r\nfunction toInteger(const v: JSValue): NativeInt; // if v is not an integer, returns 0\r\nfunction toObject(Value: JSValue): TJSObject; // If Value is not a Javascript object, returns Nil\r\nfunction toArray(Value: JSValue): TJSArray; // If Value is not a Javascript array, returns Nil\r\nfunction toBoolean(Value: JSValue): Boolean; // If Value is not a Boolean, returns False\r\nfunction toString(Value: JSValue): String; // If Value is not a string, returns ''\r\n\r\nType\r\n  TJSValueType = (jvtNull,jvtBoolean,jvtInteger,jvtFloat,jvtString,jvtObject,jvtArray);\r\n\r\nFunction GetValueType(JS : JSValue) : TJSValueType;\r\nfunction URLToArrayOfString(URL: string): TJSStringDynArray;\r\n\r\nVar\r\n  Null : JSValue; external name 'null';\r\n  Undefined : JSValue; external name 'undefined';\r\n\r\nimplementation\r\n\r\nfunction new(aElements: TJSValueDynArray): TJSObject;\r\n\r\n  function toString(I : Integer): string; external name 'String';\r\n\r\nVar\r\n  L,I : integer;\r\n  S : String;\r\n\r\nbegin\r\n  L:=length(aElements);\r\n  if (L mod 2)=1 then\r\n    raise EJS.Create('Number of arguments must be even');\r\n  I:=0;\r\n  // Check all arguments;\r\n  While (i<L) do\r\n    begin\r\n    if Not isString(aElements[i]) then\r\n      begin\r\n      S:=ToString(I);\r\n      raise EJS.Create('Argument '+S+' must be a string.');\r\n      end;\r\n    inc(I,2);\r\n    end;\r\n  I:=0;\r\n  Result:=TJSObject.New;\r\n  While (i<L) do\r\n    begin\r\n    S:=String(aElements[i]);\r\n    Result.Properties[S]:=aElements[i+1];\r\n    inc(I,2);\r\n    end;\r\nend;\r\n\r\nfunction JSDelete(const Obj: JSValue; const PropName: string): boolean; assembler;\r\nasm\r\n  return delete Obj[PropName];\r\nend;\r\n\r\nfunction hasValue(const v: JSValue): boolean; assembler;\r\nasm\r\n  if(v){ return true; } else { return false; };\r\nend;\r\n\r\nfunction isBoolean(const v: JSValue): boolean; assembler;\r\nasm\r\n  return typeof(v) == 'boolean';\r\nend;\r\n\r\nfunction isCallback(const v: JSValue): boolean; assembler;\r\nasm\r\n  return rtl.isObject(v) && rtl.isObject(v.scope) && (rtl.isString(v.fn) || rtl.isFunction(v.fn));\r\nend;\r\n\r\nfunction isChar(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)!=\"string\") && (v.length==1);\r\nend;\r\n\r\nfunction isClass(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == v);\r\nend;\r\n\r\nfunction isClassInstance(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"object\") && (v!=null) && (v.$class == Object.getPrototypeOf(v));\r\nend;\r\n\r\nfunction isInteger(const v: JSValue): boolean; assembler;\r\nasm\r\n  return Math.floor(v)===v;\r\nend;\r\n\r\nfunction isNull(const v: JSValue): boolean; assembler;\r\n// Note: use identity, \"==\" would fit undefined\r\nasm\r\n  return v === null;\r\nend;\r\n\r\nfunction isRecord(const v: JSValue): boolean; assembler;\r\nasm\r\n  return (typeof(v)==\"function\") && (typeof(v.$create) == \"function\");\r\nend;\r\n\r\nfunction isUndefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return v == undefined;\r\nend;\r\n\r\nfunction isDefined(const v: JSValue): boolean; assembler;\r\nasm\r\n  return !(v == undefined);\r\nend;\r\n\r\nfunction isUTF16Char(const v: JSValue): boolean; assembler;\r\nasm\r\n  if (typeof(v)!=\"string\") return false;\r\n  if ((v.length==0) || (v.length>2)) return false;\r\n  var code = v.charCodeAt(0);\r\n  if (code < 0xD800){\r\n    if (v.length == 1) return true;\r\n  } else if (code <= 0xDBFF){\r\n    if (v.length==2){\r\n      code = v.charCodeAt(1);\r\n      if (code >= 0xDC00 && code <= 0xDFFF) return true;\r\n    };\r\n  };\r\n  return false;\r\nend;\r\n\r\nfunction jsInstanceOf(const aFunction, aFunctionWithPrototype: JSValue\r\n  ): String; assembler;\r\nasm\r\n  return aFunction instanceof aFunctionWithPrototype;\r\nend;\r\n\r\nfunction toNumber(const v: JSValue): double; assembler;\r\nasm\r\n  return v-0;\r\nend;\r\n\r\nfunction toInteger(const v: JSValue): NativeInt;\r\nbegin\r\n  if IsInteger(v) then\r\n    Result:=NativeInt(v)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction toObject(Value: JSValue): TJSObject;\r\n\r\nbegin\r\n  if IsObject(Value) then\r\n    Result:=TJSObject(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toArray(Value: JSValue): TJSArray; // If not possible, returns Nil\r\n\r\nbegin\r\n  if IsArray(Value) then\r\n    Result:=TJSArray(Value)\r\n  else\r\n    Result:=Nil;\r\nend;\r\n\r\nfunction toBoolean(Value: JSValue): Boolean; // If not possible, returns False\r\n\r\nbegin\r\n  if isBoolean(Value) then\r\n    Result:=Boolean(Value)\r\n  else\r\n    Result:=False;\r\nend;\r\n\r\nfunction toString(Value: JSValue): String; // If not possible, returns ''\r\n\r\nbegin\r\n  if IsString(Value) then\r\n    Result:=String(Value)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ EJS }\r\n\r\nconstructor EJS.Create(const Msg: String);\r\nbegin\r\n  FMessage:=Msg;\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction URLToArrayOfString(URL: string): TJSStringDynArray;\r\nvar\r\n  a: TJSStringDynArray;\r\n  cors_api_url: string;\r\nbegin\r\n  cors_api_url := '';//'https://cors-anywhere.herokuapp.com/';\r\n  asm\r\n    var xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", cors_api_url + URL, false);\r\n    xhr.send();\r\n\r\n    if (xhr.status==200)\r\n    {\r\n      var obj = xhr.responseText.split(/\\r\\n|\\n/);\r\n      for (var i = 0; i < obj.length; i++) {\r\n        a.push(obj[i]);\r\n      }\r\n    }\r\n  end;\r\n\r\n  Result := a;\r\nend;\r\n{$HINTS ON}\r\n\r\nFunction GetValueType(JS : JSValue) : TJSValueType;\r\n\r\nVar\r\n  t : string;\r\n\r\nbegin\r\n  if isNull(js) then   // null reported as object\r\n    result:=jvtNull\r\n  else\r\n    begin\r\n    t:=jsTypeOf(js);\r\n    if (t='string') then\r\n      Result:=jvtString\r\n    else if (t='boolean') then\r\n      Result:=jvtBoolean\r\n    else if (t='object') then\r\n      begin\r\n      if IsArray(JS) then\r\n        Result:=jvtArray\r\n      else\r\n        Result:=jvtObject;\r\n      end\r\n    else if (t='number') then\r\n      if isInteger(JS) then\r\n        result:=jvtInteger\r\n      else\r\n        result:=jvtFloat\r\n    end;\r\nend;\r\n\r\nend.\r\n\r\n","\r\n{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit SysUtils;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, js;\r\n\r\nprocedure FreeAndNil(var Obj);\r\n\r\ntype\r\n  TProcedure = procedure;\r\n\r\n {*****************************************************************************\r\n                              Various types\r\n  *****************************************************************************}\r\n\r\ntype\r\n  { TFloatRec }\r\n  TFloatRec = Record\r\n     Exponent: Integer;\r\n     Negative: Boolean;\r\n     Digits: Array Of Char;\r\n  End;\r\n  TEndian = (Little,Big);\r\n  TFileName = String;\r\n  TByteArray = array [0..32767] of Byte;\r\n  TWordArray = array [0..16383] of Word;\r\n  TBytes = Array of byte;\r\n  TStringArray = array of string;\r\n\r\n  TMonthNameArray = array [1..12] of string;\r\n  TDayTable = array [1..12] of Word;\r\n  TWeekNameArray = array [1..7] of string;\r\n  TMonthNames = TMonthNameArray;\r\n  TDayNames = array[1..7] of string;\r\n  Currency = Double;\r\n\r\n{*****************************************************************************\r\n                            Exception handling\r\n*****************************************************************************}\r\n\r\n  { Exception }\r\n\r\n  Exception = class(TObject)\r\n  private\r\n    fMessage: String;\r\n    fHelpContext: Integer;\r\n  public\r\n    constructor Create(const Msg: String); reintroduce;\r\n    constructor CreateFmt(const Msg: string; const Args: array of jsvalue);\r\n    constructor CreateHelp(const Msg: String; AHelpContext: Integer);\r\n    constructor CreateFmtHelp(const Msg: string; const Args: array of jsvalue; AHelpContext: Integer);\r\n    function ToString: String; override;\r\n    property HelpContext: Integer read fHelpContext write fHelpContext;\r\n    property Message: String read fMessage write fMessage;\r\n  end;\r\n\r\n  ExceptClass = class of Exception;\r\n\r\n  EExternal = class(Exception);\r\n\r\n  { General math errors }\r\n  EMathError  = class(EExternal);\r\n  EInvalidOp  = class(EMathError);\r\n  EZeroDivide = class(EMathError);\r\n  EOverflow   = class(EMathError);\r\n  EUnderflow  = class(EMathError);\r\n\r\n  EAbort           = class(Exception);\r\n  EInvalidCast     = class(Exception);\r\n  EAssertionFailed = class(Exception);\r\n  EObjectCheck     = class(Exception);\r\n\r\n  { String conversion errors }\r\n  EConvertError = class(Exception);\r\n  EFormatError = class(Exception);\r\n\r\n\r\n  { integer math exceptions }\r\n  EIntError    = Class(EExternal);\r\n  EDivByZero   = Class(EIntError);\r\n  ERangeError  = Class(EIntError);\r\n  EIntOverflow = Class(EIntError);\r\n\r\n  { General math errors }\r\n\r\n  { Run-time and I/O Errors }\r\n  EInOutError = class(Exception)\r\n  public\r\n    ErrorCode : Integer;\r\n  end;\r\n\r\n  EHeapMemoryError = class(Exception);\r\n  EHeapException = EHeapMemoryError;\r\n\r\n  EExternalException = class(EExternal);\r\n  EInvalidPointer  = Class(EHeapMemoryError);\r\n  EOutOfMemory     = Class(EHeapMemoryError);\r\n\r\n  { EVariantError }\r\n\r\n  EVariantError = Class(Exception)\r\n    ErrCode : longint;\r\n    Constructor CreateCode(Code : Longint);\r\n  end;\r\n\r\n  EAccessViolation = Class(EExternal);\r\n  EBusError = Class(EAccessViolation);\r\n  EPrivilege = class(EExternal);\r\n  EStackOverflow = class(EExternal);\r\n  EControlC = class(EExternal);\r\n\r\n  { String conversion errors }\r\n\r\n  { Other errors }\r\n  EAbstractError   = Class(Exception);\r\n\r\n  EPropReadOnly = class(Exception);\r\n  EPropWriteOnly = class(Exception);\r\n\r\n  EIntfCastError = class(Exception);\r\n  EInvalidContainer = class(Exception);\r\n  EInvalidInsert = class(Exception);\r\n\r\n  EPackageError = class(Exception);\r\n\r\n  EOSError = class(Exception)\r\n  public\r\n    ErrorCode: Longint;\r\n  end;\r\n\r\n  ESafecallException = class(Exception);\r\n  ENoThreadSupport = Class(Exception);\r\n  ENoWideStringSupport = Class(Exception);\r\n  ENotImplemented = class(Exception);\r\n\r\n  EArgumentException = class(Exception);\r\n  EArgumentOutOfRangeException = class(EArgumentException);\r\n  EArgumentNilException = class(EArgumentException);\r\n\r\n  EPathTooLongException = class(Exception);\r\n  ENotSupportedException = class(Exception);\r\n  EDirectoryNotFoundException = class(Exception);\r\n  EFileNotFoundException = class(Exception);\r\n  EPathNotFoundException = class(Exception);\r\n\r\n  ENoConstructException = class(Exception);\r\n\r\n\r\n//function GetTickCount: Integer;\r\n\r\n\r\n{*****************************************************************************\r\n                            String function\r\n*****************************************************************************}\r\n\r\nConst\r\n   EmptyStr = '';\r\n   EmptyWideStr = ''; // No difference here.\r\n   HexDisplayPrefix: string = '$';\r\n   LeadBytes = [] unimplemented;\r\n\r\nFunction CharInSet(Ch: Char;Const CSet : array of char) : Boolean;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nfunction TrimLeft(const S: String): String; assembler;\r\nfunction TrimRight(const S: String): String; assembler;\r\n\r\nfunction UpperCase(const s: String): String; assembler; overload;\r\nfunction LowerCase(const s: String): String; assembler; overload;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nfunction Format(const Fmt: String; const Args: array of JSValue): String;\r\n\r\n// JavaScript built-in functions\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler; overload;\r\nfunction NormalizeStr(const S: String; const Norm: String = 'NFC'): String; assembler; overload; // not in IE\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\n\r\nType\r\n  TStringReplaceFlag = (rfReplaceAll, rfIgnoreCase);\r\n  TReplaceFlag = TStringReplaceFlag;\r\n  TStringReplaceFlags = set of TStringReplaceFlag;\r\n  TReplaceFlags = TStringReplaceFlags;\r\n\r\nfunction StringReplace(aOriginal, aSearch, aReplace : string; Flags : TStringReplaceFlags) : String;\r\nfunction QuoteString(aOriginal : String; AQuote : Char) : String;\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nfunction AdjustLineBreaks(const S: string): string;\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\nfunction WrapText(const Line, BreakStr: string; const BreakChars: Array of char;  MaxCol: Integer): string;\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\n{ *****************************************************************************\r\n  Integer conversions\r\n  *****************************************************************************}\r\n\r\nfunction IntToStr(const Value: Integer): string;\r\nFunction TryStrToInt(const S : String; Out res : Integer) : Boolean;\r\nFunction TryStrToInt(const S : String; Out res : NativeInt) : Boolean;\r\nFunction StrToIntDef(const S : String; Const aDef : Integer) : Integer;\r\nFunction StrToIntDef(const S : String; Const aDef : NativeInt) : NativeInt;\r\nFunction StrToInt(const S : String) : Integer;\r\nFunction StrToNativeInt(const S : String) : NativeInt;\r\n// For compatibility\r\nFunction StrToInt64(const S : String) : NativeLargeInt;\r\nFunction StrToInt64Def(const S : String; ADefault : NativeLargeInt) : NativeLargeInt;\r\nFunction TryStrToInt64(const S : String; Out res : NativeLargeInt) : Boolean;\r\nFunction StrToQWord(const S : String) : NativeLargeUInt;\r\nFunction StrToQWordDef(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToQWord(const S : String; Out res : NativeLargeUInt) : Boolean;\r\nFunction StrToUInt64(const S : String) : NativeLargeUInt;\r\nFunction StrToUInt64Def(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\nFunction TryStrToUInt64(const S : String; Out res : NativeLargeUInt) : Boolean;\r\nFunction StrToDWord(const S : String) : DWord;\r\nFunction StrToDWordDef(const S : String; ADefault : DWord) : DWord;\r\nFunction TryStrToDWord(const S : String; Out res : DWord) : Boolean;\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: integer): string;\r\n\r\n{ *****************************************************************************\r\n  Float conversions\r\n  *****************************************************************************}\r\n\r\nconst\r\n  // Note: Currency is internally a double, multiplied by 10000 and truncated.\r\n  // The below values are the safe limits, within every step exists.\r\n  // Since currency is a double it can take much larger values, but the result\r\n  // may differ from Delphi/FPC\r\n  MaxCurrency: Currency =  450359962737.0495; // fpc: 922337203685477.5807;\r\n  MinCurrency: Currency = -450359962737.0496; // fpc: -922337203685477.5808;\r\n\r\nType\r\n  TFloatFormat = (ffFixed,ffGeneral,ffExponent,ffNumber,ffCurrency);\r\n\r\nFunction FloatToDecimal(Value : double; Precision, Decimals : integer) :  TFloatRec;\r\nFunction FloatToStr(Value: Double): String;\r\nFunction FloatToStrF(const Value : double; format: TFloatFormat; Precision, Digits: Integer): String;\r\nFunction TryStrToFloat(const S : String; Out res : Double) : Boolean; overload;\r\nFunction StrToFloatDef(const S : String; Const aDef : Double) : Double;\r\nFunction StrToFloat(const S : String) : Double;\r\nFunction FormatFloat (Fmt : String; aValue : Double) : String;\r\n\r\n{ *****************************************************************************\r\n  Boolean conversions\r\n  *****************************************************************************}\r\n\r\nVar\r\n  TrueBoolStrs, FalseBoolStrs : Array of String;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nfunction BoolToStr(B: Boolean; UseBoolStrs:Boolean=False): string;\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\n\r\n\r\n{*****************************************************************************\r\n                              OS/Environment\r\n*****************************************************************************}\r\n\r\nConst\r\n  ConfigExtension : String = '.cfg';\r\n  SysConfigDir    : String = '';\r\n\r\ntype\r\n  TOnGetEnvironmentVariable = function(Const EnvVar: String): String;\r\n  TOnGetEnvironmentString = function(Index: Integer): String;\r\n  TOnGetEnvironmentVariableCount = function: Integer;\r\nvar\r\n  OnGetEnvironmentVariable: TOnGetEnvironmentVariable;\r\n  OnGetEnvironmentString: TOnGetEnvironmentString;\r\n  OnGetEnvironmentVariableCount: TOnGetEnvironmentVariableCount;\r\n\r\nfunction GetEnvironmentVariable(Const EnvVar: String): String;\r\nfunction GetEnvironmentVariableCount: Integer;\r\nfunction GetEnvironmentString(Index: Integer): String;\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer);\r\nProcedure Abort;\r\n\r\n{*****************************************************************************\r\n                               Events\r\n*****************************************************************************}\r\nType\r\n  TEventType = (etCustom,etInfo,etWarning,etError,etDebug);\r\n  TEventTypes = Set of TEventType;\r\n\r\n\r\nvar\r\n  TimeSeparator : char;\r\n  DateSeparator : char;\r\n  ShortDateFormat : string;\r\n  LongDateFormat : string;\r\n  ShortTimeFormat : string;\r\n  LongTimeFormat : string;\r\n  DecimalSeparator : string;\r\n  ThousandSeparator : string;\r\n  TimeAMString : string;\r\n  TimePMString : string;\r\n\r\nconst\r\n\r\n  HoursPerDay = 24;\r\n  MinsPerHour = 60;\r\n  SecsPerMin  = 60;\r\n  MSecsPerSec = 1000;\r\n  MinsPerDay  = HoursPerDay * MinsPerHour;\r\n  SecsPerDay  = MinsPerDay * SecsPerMin;\r\n  MSecsPerDay = SecsPerDay * MSecsPerSec;\r\n  MaxDateTime: TDateTime =  2958465.99999999;\r\n  MinDateTime: TDateTime =  -693593.99999999;\r\n\r\n  JulianEpoch = TDateTime(-2415018.5);\r\n  UnixEpoch = JulianEpoch + TDateTime(2440587.5);\r\n\r\n  DateDelta = 693594;        // Days between 1/1/0001 and 12/31/1899\r\n  UnixDateDelta = 25569;\r\n\r\n  { True=Leapyear }\r\n\r\nvar\r\n  MonthDays : array [Boolean] of TDayTable;\r\n  ShortMonthNames : TMonthNames;\r\n  LongMonthNames : TMonthNames;\r\n  ShortDayNames : TDayNames;\r\n  LongDayNames : TDayNames;\r\n\r\ntype\r\n  // Stub, for easier porting of FPC/Delphi code.\r\n  // Reading/Writing the properties will actually set the global variables\r\n\r\n  { TFormatSettings }\r\n\r\n  TFormatSettings = class(TObject)\r\n  private\r\n    function GetCurrencyDecimals: Byte;\r\n    function GetCurrencyFormat: Byte;\r\n    function GetCurrencyString: String;\r\n    function GetDateSeparator: char;\r\n    function GetDecimalSeparator: string;\r\n    function GetLongDateFormat: string;\r\n    function GetLongDayNames: TDayNames;\r\n    function GetLongMonthNames: TMonthNames;\r\n    function GetLongTimeFormat: string;\r\n    function GetNegCurrFormat: Byte;\r\n    function GetShortDateFormat: string;\r\n    function GetShortDayNames: TDayNames;\r\n    function GetShortMonthNames: TMonthNames;\r\n    function GetShortTimeFormat: string;\r\n    function GetThousandSeparator: string;\r\n    function GetTimeAMString: string;\r\n    function GetTimePMString: string;\r\n    function GetTimeSeparator: char;\r\n    procedure SetCurrencyFormat(AValue: Byte);\r\n    procedure SetCurrencyString(AValue: String);\r\n    procedure SetDateSeparator(const Value: char);\r\n    procedure SetDecimalSeparator(const Value: string);\r\n    procedure SetLongDateFormat(const Value: string);\r\n    procedure SetLongDayNames(AValue: TDayNames);\r\n    procedure SetLongMonthNames(AValue: TMonthNames);\r\n    procedure SetLongTimeFormat(const Value: string);\r\n    procedure SetNegCurrFormat(AValue: Byte);\r\n    procedure SetShortDateFormat(const Value: string);\r\n    procedure SetShortDayNames(AValue: TDayNames);\r\n    procedure SetShortMonthNames(AValue: TMonthNames);\r\n    procedure SetShortTimeFormat(const Value: string);\r\n    procedure SetCurrencyDecimals(AValue: Byte);\r\n    procedure SetThousandSeparator(const Value: string);\r\n    procedure SetTimeAMString(const Value: string);\r\n    procedure SetTimePMString(const Value: string);\r\n    procedure SetTimeSeparator(const Value: char);\r\n  public\r\n    Property ShortMonthNames : TMonthNames Read GetShortMonthNames Write SetShortMonthNames;\r\n    Property LongMonthNames : TMonthNames Read GetLongMonthNames Write SetLongMonthNames;\r\n    Property ShortDayNames : TDayNames Read GetShortDayNames Write SetShortDayNames;\r\n    Property LongDayNames : TDayNames Read GetLongDayNames Write SetLongDayNames;\r\n    property TimeSeparator : char read GetTimeSeparator write SetTimeSeparator;\r\n    property DateSeparator : char read GetDateSeparator write SetDateSeparator;\r\n    property ShortDateFormat : string read GetShortDateFormat write SetShortDateFormat;\r\n    property LongDateFormat : string read GetLongDateFormat write SetLongDateFormat;\r\n    property ShortTimeFormat : string read GetShortTimeFormat write SetShortTimeFormat;\r\n    property LongTimeFormat : string read GetLongTimeFormat write SetLongTimeFormat;\r\n    property DecimalSeparator : string read GetDecimalSeparator write SetDecimalSeparator;\r\n    property ThousandSeparator : string read GetThousandSeparator write SetThousandSeparator;\r\n    property TimeAMString : string read GetTimeAMString write SetTimeAMString;\r\n    property TimePMString : string read GetTimePMString write SetTimePMString;\r\n    Property CurrencyFormat : Byte read GetCurrencyFormat Write SetCurrencyFormat;\r\n    Property NegCurrFormat : Byte read GetNegCurrFormat Write SetNegCurrFormat;\r\n    Property CurrencyDecimals : Byte Read GetCurrencyDecimals Write SetCurrencyDecimals;\r\n    Property CurrencyString : String Read GetCurrencyString Write SetCurrencyString;\r\n  end;\r\n\r\nvar\r\n  FormatSettings: TFormatSettings;\r\n\r\n  TwoDigitYearCenturyWindow : word ;\r\n                             { Threshold to be subtracted from year before age-detection.}\r\n\r\n\r\nfunction DateTimeToJSDate(aDateTime : TDateTime) : TJSDate;\r\nfunction JSDateToDateTime(aDate : TJSDate) : TDateTime;\r\n\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nfunction TryEncodeDate(Year, Month, Day: Word; out Date: TDateTime): Boolean;\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec: Word; out Time: TDateTime): Boolean;\r\nfunction EncodeDate(Year, Month, Day :word): TDateTime;\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word): TDateTime;\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nfunction Date: TDateTime;\r\nfunction Time: TDateTime;\r\nfunction Now: TDateTime;\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nfunction IsLeapYear(Year: Word): boolean;\r\nfunction DateToStr(Date: TDateTime): string;\r\n// function DateToStr(Date: TDateTime; const FormatSettings: TFormatSettings): string;\r\nfunction TimeToStr(Time: TDateTime): string;\r\n// function TimeToStr(Time: TDateTime; const FormatSettings: TFormatSettings): string;\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;\r\n// function DateTimeToStr(DateTime: TDateTime; const FormatSettings: TFormatSettings; ForceTimeIfZero : Boolean = False): string;\r\nfunction StrToDate(const S: String): TDateTime;\r\nfunction StrToDate(const S: String; separator : char): TDateTime;\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime;\r\n//function StrToDate(const S: string; FormatSettings : TFormatSettings): TDateTime;\r\nfunction StrToTime(const S: String): TDateTime;\r\nfunction StrToTime(const S: String; separator : char): TDateTime;\r\n// function StrToTime(const S: string; FormatSettings : TFormatSettings): TDateTime;\r\nfunction StrToDateTime(const S: String): TDateTime;\r\n//function StrToDateTime(const s: ShortString; const FormatSettings : TFormatSettings): TDateTime;\r\nfunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime): string;\r\n// function FormatDateTime(const FormatStr: string; DateTime: TDateTime; const FormatSettings: TFormatSettings; Options : TFormatDateTimeOptions = []): string;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; const useformat : string; separator : char): Boolean;\r\n// function TryStrToDate(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean;\r\n// function TryStrToTime(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\n// function TryStrToDateTime(const S: string; out Value: TDateTime; const FormatSettings: TFormatSettings): Boolean;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nfunction CurrentYear:Word;\r\nprocedure ReplaceTime(var dati: TDateTime; NewTime : TDateTime);\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\nFunction FloatToDateTime (Const Value : Extended) : TDateTime;\r\n\r\n{ *****************************************************************************\r\n  Currency support\r\n  *****************************************************************************}\r\n\r\nVar\r\n  CurrencyFormat : Byte = 0;\r\n  NegCurrFormat : Byte = 0;\r\n  CurrencyDecimals : Byte = 2;\r\n  CurrencyString : String = '$';\r\n\r\nFunction FloattoCurr (Const Value : Extended) : Currency;\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nFunction CurrToStr(Value: Currency): string;\r\n//Function CurrToStr(Value: Currency; Const FormatSettings: TFormatSettings): string;\r\nfunction StrToCurr(const S: string): Currency;\r\n//function StrToCurr(const S: string; Const FormatSettings: TFormatSettings): Currency;\r\nfunction TryStrToCurr(const S: string;Out Value : Currency): Boolean;\r\n//function TryStrToCurr(const S: string;Out Value : Currency; Const FormatSettings: TFormatSettings): Boolean;\r\nfunction StrToCurrDef(const S: string; Default : Currency): Currency;\r\n//function StrToCurrDef(const S: string; Default : Currency; Const FormatSettings: TFormatSettings): Currency;\r\n\r\n{*****************************************************************************\r\n                               File Paths\r\n*****************************************************************************}\r\ntype\r\n  PathStr = String;\r\n//function ExtractFilePath(const FileName: PathStr): PathStr;\r\n\r\n{*****************************************************************************\r\n                               Interfaces\r\n*****************************************************************************}\r\n\r\nconst\r\n  GUID_NULL: TGuid = '{00000000-0000-0000-0000-000000000000}';\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid; out Intf): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf): Boolean; overload;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean; overload;\r\nfunction Supports(const Instance: IInterface; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuid): Boolean; overload;\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean; overload;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGuid): Boolean;\r\nfunction StringToGUID(const S: string): TGuid;\r\nfunction GUIDToString(const guid: TGuid): string; reintroduce;\r\nfunction IsEqualGUID(const guid1, guid2: TGuid): Boolean;\r\nfunction GuidCase(const guid: TGuid; const List: array of TGuid): Integer;\r\n\r\nimplementation\r\n\r\nprocedure ShowException(ExceptObject: TObject; ExceptAddr: Pointer);\r\n\r\nVar\r\n  S : String;\r\n\r\nbegin\r\n  S:='Application raised an exception '+ExceptObject.ClassName;\r\n  if ExceptObject is Exception then\r\n    S:=S+' : '+Exception(ExceptObject).Message;\r\n{$IFDEF BROWSER}\r\n  asm\r\n    window.alert(S);\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF NODEJS}\r\n  Writeln(S);\r\n{$ENDIF}\r\n  if ExceptAddr=nil then;\r\nend;\r\n\r\nConst\r\n  SAbortError = 'Operation aborted';\r\n\r\nprocedure Abort;\r\nbegin\r\n  Raise EAbort.Create(SAbortError);\r\nend;\r\n\r\n\r\nFunction CharInSet(Ch: Char;Const CSet : array of char) : Boolean;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  Result:=False;\r\n  I:=Length(CSet)-1;\r\n  While (Not Result) and (I>=0) do\r\n    begin\r\n    Result:=(Ch=CSet[i]);\r\n    Dec(I);\r\n    end;\r\nend;\r\n\r\nfunction LeftStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  return (Count>0) ? S.substr(0,Count) : \"\";\r\nend;\r\n\r\nfunction RightStr(const S: string; Count: Integer): String; assembler;\r\nasm\r\n  var l = S.length;\r\n  return (Count<1) ? \"\" : ( Count>=l ? S : S.substr(l-Count));\r\nend;\r\n\r\nfunction Trim(const S: String): String; assembler;\r\nasm\r\n  return S.trim();\r\nend;\r\n\r\nfunction TrimLeft(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/^[\\s\\uFEFF\\xA0\\x00-\\x1f]+/,'');\r\nend;\r\n\r\nfunction TrimRight(const S: String): String; assembler;\r\nasm\r\n  return S.replace(/[\\s\\uFEFF\\xA0\\x00-\\x1f]+$/,'');\r\nend;\r\n\r\nfunction IntToStr(const Value: Integer): string;\r\nbegin\r\n  Result:=str(Value);\r\nend;\r\n\r\nFunction FloatToDecimal(Value : double; Precision, Decimals : integer) :  TFloatRec;\r\n\r\nConst\r\n  Rounds = '234567890';\r\n\r\nvar\r\n  Buffer: String;  //Though str func returns only 25 chars, this might change in the future\r\n  InfNan: string;\r\n  Error, N, L, Start, C: Integer;\r\n  GotNonZeroBeforeDot, BeforeDot : boolean;\r\n\r\nbegin\r\n  if Value=0 then ;\r\n  SetLength(Result.Digits,19);\r\n  asm\r\n    Buffer=Value.toPrecision(21); // Double precision\r\n  end;\r\n  N := 1;\r\n  L := Length(Buffer);\r\n  while Buffer[N]=' ' do\r\n    Inc(N);\r\n  Result.Negative := (Buffer[N] = '-');\r\n  if Result.Negative then\r\n    Inc(N)\r\n  else if (Buffer[N] = '+') then\r\n    inc(N);\r\n  { special cases for Inf and Nan }\r\n  if (L>=N+2) then\r\n    begin\r\n      InfNan:=copy(Buffer,N,3);\r\n      if (InfNan='Inf') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=32767;\r\n          exit\r\n        end;\r\n      if (InfNan='Nan') then\r\n        begin\r\n          Result.Digits[0]:=#0;\r\n          Result.Exponent:=-32768;\r\n          exit\r\n        end;\r\n    end;\r\n  Start := N;  //Start of digits\r\n  Result.Exponent := 0; BeforeDot := true;\r\n  GotNonZeroBeforeDot := false;\r\n  while (L>=N) and (Buffer[N]<>'E') do\r\n    begin\r\n      if Buffer[N]='.' then\r\n        BeforeDot := false\r\n      else\r\n        begin\r\n          if BeforeDot then\r\n            begin  // Currently this is always 1 char\r\n              Inc(Result.Exponent);\r\n              Result.Digits[N-Start] := Buffer[N];\r\n              if Buffer[N] <> '0' then\r\n                GotNonZeroBeforeDot := true;\r\n            end\r\n          else\r\n            Result.Digits[N-Start-1] := Buffer[N]\r\n        end;\r\n      Inc(N);\r\n    end;\r\n    Inc(N); // Pass through 'E'\r\n    if N<=L then\r\n      begin\r\n        Val(Copy(Buffer, N, L-N+1), C, Error); // Get exponent after 'E'\r\n        Inc(Result.Exponent, C);\r\n      end;\r\n    // Calculate number of digits we have from str\r\n    if BeforeDot then\r\n      N := N - Start - 1\r\n    else\r\n      N := N - Start - 2;\r\n    L := Length(Result.Digits);\r\n    if N<L then\r\n\r\n      Result.Digits[N]:='0';  //Zero remaining space\r\n    if Decimals + Result.Exponent < Precision Then //After this it is the same as in FloatToDecimal\r\n      N := Decimals + Result.Exponent\r\n    Else\r\n      N := Precision;\r\n    if N >= L Then\r\n      N := L-1;\r\n  if N = 0 Then\r\n    begin\r\n      if Result.Digits[0] >= '5' Then\r\n        begin\r\n          Result.Digits[0] := '1';\r\n          Result.Digits[1] := #0;\r\n          Inc(Result.Exponent);\r\n        end\r\n      Else\r\n        Result.Digits[0] := #0;\r\n    end  //N=0\r\n  Else if N > 0 Then\r\n    begin\r\n      if Result.Digits[N] >= '5' Then\r\n        begin\r\n          Repeat\r\n            Result.Digits[N] := #0;\r\n            Dec(N);\r\n            // Writeln(N,': ',Result.Digits[N],', Rounding to : ',Rounds[StrToInt(Result.Digits[N])]);\r\n            Result.Digits[N]:=Rounds[StrToInt(Result.Digits[N])];\r\n          Until (N = 0) Or (Result.Digits[N] < ':');\r\n          If Result.Digits[0] = ':' Then\r\n            begin\r\n              Result.Digits[0] := '1';\r\n              Inc(Result.Exponent);\r\n            end;\r\n        end\r\n      Else\r\n        begin\r\n          Result.Digits[N] := '0';\r\n          While (N > -1) And (Result.Digits[N] = '0') Do\r\n            begin\r\n              Result.Digits[N] := #0;\r\n              Dec(N);\r\n            end;\r\n        end;\r\n      end //N>0\r\n  Else\r\n    Result.Digits[0] := #0;\r\n  if (Result.Digits[0] = #0) and\r\n     not GotNonZeroBeforeDot then\r\n    begin\r\n      Result.Exponent := 0;\r\n      Result.Negative := False;\r\n    end;\r\nend;\r\n\r\n\r\nfunction FloatToStr(Value: Double): String;\r\nbegin\r\n  Result := FloatToStrF(Value,ffGeneral,15,0);\r\nend;\r\n\r\nFunction TryStrToFloat(const S : String; Out res : Double) : Boolean;\r\n\r\nVar\r\n  J : JSValue;\r\n  N : String;\r\n\r\nbegin\r\n  N:=S;\r\n  // Delocalize\r\n  if (ThousandSeparator <>'') then\r\n    N:=StringReplace(N,ThousandSeparator,'',[rfReplaceAll]);\r\n  if (DecimalSeparator<>'.') then\r\n    N:=StringReplace(N,DecimalSeparator,'.',[]);\r\n  J:=parseFloat(N);\r\n  Result:=Not jsIsNaN(J);\r\n  if Result then\r\n    Res:=Double(J);\r\nend;\r\n\r\nFunction StrToFloatDef(const S : String; Const aDef : Double) : Double;\r\n\r\nbegin\r\n  if not TryStrToFloat(S,Result) then\r\n    Result:=aDef;\r\nend;\r\n\r\nFunction StrToFloat(const S : String) : Double;\r\nbegin\r\n  if not TryStrToFloat(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidFloat,[S]);\r\nend;\r\n\r\nfunction FormatFloat(Fmt: String; aValue: Double): String;\r\n\r\nType\r\n  TPosArray = Array of Integer;\r\n\r\nconst\r\n  MaxPrecision = 18;  // Extended precision\r\n\r\nvar\r\n  // Input in usable format\r\n  E : Extended;              // Value as extended.\r\n  FV: TFloatRec;             // Value as floatrec.\r\n  Section : String;          // Format can contain 3 sections, semicolon separated: Pos;Neg;Zero. This is the one to use.\r\n  SectionLength : Integer;   // Length of section.\r\n  // Calculated based on section. Static during output\r\n  ThousandSep: Boolean;      // Thousands separator detected in format ?\r\n  IsScientific: Boolean;     // Use Scientific notation ? (E detected in format)\r\n  DecimalPos: Integer;       // Position of decimal point in pattern.\r\n  FirstDigit: Integer;       // First actual digit in input (# or 0), relative to decimal point\r\n  LastDigit: Integer;        // Last required (0) digit, relative to decimal point\r\n  RequestedDigits: Integer;  // Number of requested digits, # and 0 alike\r\n  ExpSize : Integer;         // Number of digits in exponent\r\n  Available: Integer;        // Available digits in FV.\r\n  // These change during output loop\r\n  Current: Integer;          // Current digit in available digits\r\n  PadZeroes: Integer;        // Difference in requested digits before comma and exponent, needs to be padded with zeroes.\r\n  DistToDecimal: Integer;    // Place of current digit, relative to decimal point taking in account PadZeroes!\r\n\r\n  Procedure InitVars;\r\n\r\n  begin\r\n    E:=aValue;\r\n    Section:='';\r\n    SectionLength:=0;\r\n    ThousandSep:=false;\r\n    IsScientific:=false;\r\n    DecimalPos:=0;\r\n    FirstDigit:=MaxInt;\r\n    LastDigit:=0;\r\n    RequestedDigits:=0;\r\n    ExpSize:=0;\r\n    Available:=-1;\r\n  end;\r\n\r\n  procedure ToResult(const AChar: Char);\r\n  begin\r\n    Result:=Result+AChar;\r\n  end;\r\n\r\n  procedure AddToResult(const AStr: String);\r\n\r\n  begin\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure WriteDigit(ADigit: Char);\r\n\r\n  // Write a digit to result, prepend with decimalseparator or append with 1000 separator\r\n\r\n  begin\r\n    if ADigit=#0 then exit;\r\n    // Writeln('WriteDigit: ',ADigit,', DistToDecimal: ',DistToDecimal);\r\n    Dec(DistToDecimal);\r\n    // -1 -> we've arrived behind the decimal\r\n    if (DistToDecimal=-1) then\r\n      begin\r\n      AddToResult(DecimalSeparator);\r\n      ToResult(ADigit);\r\n      end\r\n    else\r\n      begin\r\n      // We're still before the decimal.\r\n      ToResult(ADigit);\r\n      if ThousandSep and ((DistToDecimal mod 3)=0) and (DistToDecimal>1) then\r\n        AddToResult(ThousandSeparator);\r\n      end;\r\n  end;\r\n\r\n  Function GetDigit : Char;\r\n\r\n  // Return next digit from available digits.\r\n  // May return #0 if none available.\r\n  // Will return '0' if applicable.\r\n\r\n  begin\r\n    // Writeln(' DistToDecimal <= LastDigit : ',DistToDecimal,' <  ',LastDigit,' have digit: ',Current<=Available, '(',Current,')');\r\n    Result:=#0;\r\n    if (Current<=Available) then\r\n      begin\r\n      Result:=FV.Digits[Current];\r\n      Inc(Current);\r\n      end\r\n    else if (DistToDecimal <= LastDigit) then\r\n      Dec(DistToDecimal)\r\n    else\r\n      Result:='0';\r\n    //  Writeln('GetDigit ->: ',Result);\r\n  end;\r\n\r\n  procedure CopyDigit;\r\n\r\n  // Copy a digit (#, 0) to the output with the correct value\r\n\r\n  begin\r\n    // Writeln('CopyDigit ');\r\n    if (PadZeroes=0) then\r\n      WriteDigit(GetDigit) // No shift needed, just copy what is available.\r\n    else if (PadZeroes<0) then\r\n      begin\r\n      // We must prepend zeroes\r\n      Inc(PadZeroes);\r\n      if (DistToDecimal<=FirstDigit) then\r\n        WriteDigit('0')\r\n      else\r\n        Dec(DistToDecimal);\r\n      end\r\n    else\r\n      begin\r\n      // We must append zeroes\r\n      while PadZeroes > 0 do\r\n        begin\r\n        WriteDigit(GetDigit);\r\n        Dec(PadZeroes);\r\n        end;\r\n      WriteDigit(GetDigit);\r\n      end;\r\n  end;\r\n\r\n  Function GetSections(Var SP : TPosArray) : Integer;\r\n\r\n  var\r\n    FL : Integer;\r\n    i : Integer;\r\n    C,Q : Char;\r\n    inQuote : Boolean;\r\n\r\n  begin\r\n    Result:=1;\r\n    SP[1]:=-1;\r\n    SP[2]:=-1;\r\n    SP[3]:=-1;\r\n    inQuote:=False;\r\n    Q:=#0;\r\n    I:=1;\r\n    FL:=Length(Fmt);\r\n    while (I<=FL) do\r\n      begin\r\n      C:=Fmt[I];\r\n      case C of\r\n      ';':\r\n        begin\r\n        if not InQuote then\r\n          begin\r\n          if Result>3 then\r\n            Raise Exception.Create('Invalid float format');\r\n          SP[Result]:=I+1;\r\n          Inc(Result);\r\n          end;\r\n        end;\r\n      '\"','''':\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end;\r\n      end;\r\n      Inc(I);\r\n      end;\r\n    if SP[Result]=-1 then\r\n      SP[Result]:=FL+1;\r\n  end;\r\n\r\n  Procedure AnalyzeFormat;\r\n\r\n  var\r\n    I,Len: Integer;\r\n    Q,C: Char;\r\n    InQuote : Boolean;\r\n\r\n  begin\r\n    Len:=Length(Section);\r\n    I:=1;\r\n    InQuote:=False;\r\n    Q:=#0;\r\n    while (I<=Len) do\r\n      begin\r\n      C:=Section[i];\r\n      if C in ['\"',''''] then\r\n        begin\r\n        if InQuote then\r\n          InQuote:=C<>Q\r\n        else\r\n          begin\r\n          InQuote:=True;\r\n          Q:=C;\r\n          end;\r\n        end\r\n      else if not InQuote then\r\n        case C of\r\n        '.':\r\n          if (DecimalPos=0) then\r\n            DecimalPos:=RequestedDigits+1;\r\n        ',':\r\n            ThousandSep:=ThousandSeparator<>#0;\r\n        'e', 'E':\r\n            begin\r\n            Inc(I);\r\n            if (I<Len) then\r\n              begin\r\n              C:=Section[i];\r\n              IsScientific:=C in ['-','+'];\r\n              if IsScientific then\r\n                while (I<Len) and (Section[i+1]='0') do\r\n                  begin\r\n                  Inc(ExpSize);\r\n                  Inc(I);\r\n                  end;\r\n              if ExpSize>4 then\r\n                ExpSize:=4;\r\n              end;\r\n            end;\r\n        '#':\r\n            Inc(RequestedDigits);\r\n        '0':\r\n            begin\r\n            if RequestedDigits<FirstDigit then\r\n              FirstDigit:=RequestedDigits+1;\r\n            Inc(RequestedDigits);\r\n            LastDigit:=RequestedDigits+1;\r\n            end;\r\n        end;\r\n      Inc(I);\r\n      end;\r\n    if DecimalPos=0 then\r\n      DecimalPos:=RequestedDigits+1;\r\n    // Writeln('LastDigit: ',DecimalPos,'-',LastDigit);\r\n    LastDigit:=DecimalPos-LastDigit;\r\n    if LastDigit>0 then\r\n      LastDigit:=0;\r\n    // Writeln('FirstDigit: ',DecimalPos,'-',FirstDigit);\r\n    FirstDigit:=DecimalPos-FirstDigit;\r\n    if FirstDigit<0 then\r\n      FirstDigit:=0;\r\n  end;\r\n\r\n  Function ValueOutSideScope : Boolean;\r\n  begin\r\n    With FV do\r\n     Result:=((Exponent >= 18) and (not IsScientific)) or (Exponent = $7FF) or (Exponent = $800)\r\n  end;\r\n\r\n  Procedure CalcRunVars;\r\n\r\n  Var\r\n    D,P: Integer;\r\n\r\n  begin\r\n    if IsScientific then\r\n      begin\r\n      P:=RequestedDigits;\r\n      D:=9999;\r\n      end\r\n    else\r\n      begin\r\n      P:=MaxPrecision;\r\n      D:=RequestedDigits-DecimalPos+1;\r\n      end;\r\n    FV:=FloatToDecimal(aValue,P,D);\r\n    DistToDecimal:=DecimalPos-1;\r\n    if IsScientific then\r\n      PadZeroes:=0 // No padding.\r\n    else\r\n      begin\r\n      PadZeroes:=FV.Exponent-(DecimalPos-1);\r\n      if (PadZeroes>=0) then\r\n        DistToDecimal:=FV.Exponent\r\n      end;\r\n    // Writeln('PadZeroes : ',PadZeroes, ', DistToDecimal : ',DistToDecimal);\r\n    Available:=-1;\r\n    while (Available<High(FV.Digits)) and (FV.Digits[Available+1]<>#0) do\r\n      Inc(Available);\r\n    // Writeln('Available: ',Available);\r\n  end;\r\n\r\n  Function FormatExponent(ASign: Char; aExponent: Integer) : String;\r\n\r\n  begin\r\n    Result:=IntToStr(aExponent);\r\n    Result:=StringOfChar('0',ExpSize-Length(Result))+Result;\r\n    if (aExponent<0) then\r\n      Result:='-'+Result\r\n    else if (aExponent>0) and (aSign='+') then\r\n      Result:=aSign+Result;\r\n  end;\r\n\r\nvar\r\n  I,S : Integer;\r\n  C,Q : Char;\r\n  PA : TPosArray;\r\n  InLiteral : Boolean;\r\n\r\nbegin\r\n  SetLength(PA,4);\r\n  Result:='';\r\n  Initvars;\r\n  // What section to use ?\r\n  if (E>0) then\r\n    S:=1\r\n  else if (E<0) then\r\n    S:=2\r\n  else\r\n    S:=3;\r\n  PA[0]:=0;\r\n  I:=GetSections(PA);\r\n  if (I<S) or (PA[S]-PA[S-1]=0) then\r\n    S:=1;\r\n  // Extract correct section\r\n  SectionLength:=PA[S]-PA[S-1]-1;\r\n  Section:=Copy(Fmt,PA[S-1]+1,SectionLength);\r\n  SetLength(Section,SectionLength);\r\n  // Writeln('Section ',I,' : \"',Section,'\" ',SectionLength);\r\n  AnalyzeFormat;\r\n  // Writeln('RequestedDigits: ',RequestedDigits,', DecimalPos : ',DecimalPos,', LastDigit: ',LastDigit,', FirstDigit: ',FirstDigit);\r\n  CalcRunVars;\r\n  // If we cannot process value using current settings, fallback\r\n  if (SectionLength=0) or ValueOutSideScope then\r\n    begin\r\n    asm\r\n     Section=E.toPrecision(15);\r\n    end;\r\n    Result:=Section;\r\n    end;\r\n  // Get Started\r\n  I:=1;\r\n  Current:=0;\r\n  Q:=' ';\r\n  InLiteral:=False;\r\n  if (FV.Negative) and (S=1) then\r\n    ToResult('-');\r\n  while (I<=SectionLength) do\r\n    begin\r\n    C:=Section[i];\r\n    // Writeln('Analyzing pos ',I,': \"',C,'\"');\r\n    If (C in ['\"', '''']) then\r\n      begin\r\n      if InLiteral then\r\n        InLiteral:=C<>Q\r\n      else\r\n        begin\r\n        inLiteral:=True;\r\n        Q:=C;\r\n        end;\r\n      end\r\n    else if InLiteral then\r\n      ToResult(C)\r\n    else\r\n      case C of\r\n      '0', '#':\r\n        CopyDigit;\r\n      '.', ',':\r\n        ; // Do nothing, handled by CopyDigit\r\n      'e', 'E':\r\n        begin\r\n        ToResult(C); // Always needed\r\n        Inc(I);\r\n        if I<=Length(Section) then\r\n          begin\r\n          C:=Section[I];\r\n          if (C in ['+','-']) then\r\n            begin\r\n            AddToResult(FormatExponent(C,FV.Exponent-DecimalPos+1));\r\n            // Skip rest\r\n            while (I<SectionLength) and (Section[i+1]='0') do\r\n              Inc(I);\r\n            end;\r\n          end;\r\n        end;\r\n      else\r\n        ToResult(C);\r\n      end;\r\n    Inc(i);\r\n    end;\r\nend;\r\n\r\nfunction StrToBool(const S: String): Boolean;\r\nbegin\r\n  if not(TryStrToBool(S,Result)) then\r\n    raise EConvertError.CreateFmt(SInvalidBoolean,[S]);\r\nend;\r\n\r\nprocedure CheckBoolStrs;\r\nbegin\r\n  if Length(TrueBoolStrs)=0 then\r\n  begin\r\n    SetLength(TrueBoolStrs,1);\r\n    TrueBoolStrs[0]:='True';\r\n  end;\r\n  if Length(FalseBoolStrs)=0 then\r\n  begin\r\n    SetLength(FalseBoolStrs,1);\r\n    FalseBoolStrs[0]:='False';\r\n  end;\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; UseBoolStrs: Boolean): string;\r\nbegin\r\n  if UseBoolStrs Then\r\n  begin\r\n    CheckBoolStrs;\r\n    if B then\r\n      Result:=TrueBoolStrs[0]\r\n    else\r\n      Result:=FalseBoolStrs[0];\r\n  end else\r\n    if B then\r\n      Result:='-1'\r\n    else\r\n      Result:='0';\r\nend;\r\n\r\nfunction BoolToStr(B: Boolean; const TrueS, FalseS: String): string;\r\nbegin\r\n  if B then Result:=TrueS else Result:=FalseS;\r\nend;\r\n\r\nfunction StrToBoolDef(const S: String; Default: Boolean): Boolean;\r\nbegin\r\n  if not TryStrToBool(S,Result) then\r\n    Result:=Default;\r\nend;\r\n\r\nfunction TryStrToBool(const S: String; out Value: Boolean): Boolean;\r\nVar\r\n  Temp : String;\r\n  I    : Longint;\r\n  D : Double;\r\n  Code: integer;\r\nbegin\r\n  Temp:=uppercase(S);\r\n  Val(Temp,D,code);\r\n  Result:=true;\r\n  If Code=0 then\r\n    Value:=(D<>0.0)\r\n  else\r\n    begin\r\n      CheckBoolStrs;\r\n      for I:=low(TrueBoolStrs) to High(TrueBoolStrs) do\r\n        if Temp=uppercase(TrueBoolStrs[I]) then\r\n          begin\r\n            Value:=true;\r\n            exit;\r\n          end;\r\n      for I:=low(FalseBoolStrs) to High(FalseBoolStrs) do\r\n        if Temp=uppercase(FalseBoolStrs[I]) then\r\n          begin\r\n            Value:=false;\r\n            exit;\r\n          end;\r\n      Result:=false;\r\n    end;\r\nend;\r\n\r\nfunction UpperCase(const s: String): String; assembler;\r\nasm\r\n  return s.toUpperCase();\r\nend;\r\n\r\nfunction LowerCase(const s: String): String; assembler;\r\nasm\r\n  return s.toLowerCase();\r\nend;\r\n\r\nfunction CompareStr(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.length;\r\n  var l2 = s2.length;\r\n  if (l1<=l2){\r\n    var s = s2.substr(0,l1);\r\n    if (s1<s){ return -1;\r\n    } else if (s1>s){ return 1;\r\n    } else { return l1<l2 ? -1 : 0; };\r\n  } else {\r\n    var s = s1.substr(0,l2);\r\n    if (s<s2){ return -1;\r\n    } else { return 1; };\r\n  };\r\nend;\r\n\r\nfunction SameStr(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1 == s2;\r\nend;\r\n\r\nfunction CompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  var l1 = s1.toLowerCase();\r\n  var l2 = s2.toLowerCase();\r\n  if (l1>l2){ return 1;\r\n  } else if (l1<l2){ return -1;\r\n  } else { return 0; }\r\nend;\r\n\r\nfunction SameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.toLowerCase() == s2.toLowerCase();\r\nend;\r\n\r\nfunction AnsiCompareText(const s1, s2: String): Integer; assembler;\r\nasm\r\n  return s1.localeCompare(s2);\r\nend;\r\n\r\nfunction AnsiSameText(const s1, s2: String): Boolean; assembler;\r\nasm\r\n  return s1.localeCompare(s2) == 0;\r\nend;\r\n\r\nfunction AnsiCompareStr(const s1, s2: String): Integer;\r\nbegin\r\n  {$IFDEF ECMAScript6}\r\n  Result:=CompareText(TJSString(s1).normalize(),TJSString(s1).normalize());\r\n  {$ELSE}\r\n  Result:=CompareText(s1,s2);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure AppendStr(var Dest: String; const S: string);\r\n\r\nbegin\r\n  Dest:=Dest+S;\r\nend;\r\n\r\n\r\nConst\r\n  feInvalidFormat   = 1;\r\n  feMissingArgument = 2;\r\n  feInvalidArgIndex = 3;\r\n\r\nProcedure DoFormatError (ErrCode : Longint;const fmt: String);\r\n\r\n\r\nbegin\r\n  //!! must be changed to contain format string...\r\n  Case ErrCode of\r\n   feInvalidFormat : raise EConvertError.Createfmt(SInvalidFormat,[Fmt]);\r\n   feMissingArgument : raise EConvertError.Createfmt(SArgumentMissing,[Fmt]);\r\n   feInvalidArgIndex : raise EConvertError.Createfmt(SInvalidArgIndex,[Fmt]);\r\n  end;\r\nend;\r\n\r\nConst\r\n  maxdigits = 15;\r\n\r\nFunction ReplaceDecimalSep(S: String; Const DS : string) : string;\r\n\r\nVar\r\n  P : Integer;\r\n\r\nbegin\r\n  P:=Pos('.',S);\r\n  if P>0 then\r\n    Result:=Copy(S,1,P-1)+DS+Copy(S,P+1,Length(S)-P)\r\n  else\r\n    Result:=S;\r\nend;\r\n\r\nfunction FormatGeneralFloat(Value : double; Precision : Integer; DS : String) : string;\r\n\r\nVar\r\n  P, PE, Q, Exponent: Integer;\r\n\r\nBegin\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n     Precision := maxdigits;\r\n  { First convert to scientific format, with correct precision }\r\n  Str(Value:precision+7, Result);\r\n  { Delete leading spaces }\r\n  Result:=TrimLeft(Result);\r\n  P:=Pos('.',Result);\r\n  if P=0 then\r\n    exit;\r\n   { Consider removing exponent }\r\n  PE:=Pos('E',Result);\r\n  if PE=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  { Read exponent }\r\n  Q:=PE+2;\r\n  Exponent := 0;\r\n  while (Q <= Length(Result)) do\r\n    begin\r\n    Exponent := Exponent*10 + Ord(Result[Q])-Ord('0');\r\n    Inc(Q);\r\n    end;\r\n  if Result[PE+1] = '-' then\r\n    Exponent := -Exponent;\r\n  if (P+Exponent < PE) and (Exponent > -6) then\r\n    begin\r\n    { OK to remove exponent }\r\n    SetLength(Result,PE-1); { Trim exponent }\r\n    if Exponent >= 0 then\r\n      begin\r\n        { Shift point to right }\r\n      for Q := 0 to Exponent-1 do\r\n        begin\r\n        Result[P] := Result[P+1];\r\n        Inc(P);\r\n        end;\r\n      Result[P] := '.';\r\n      P := 1;\r\n      if Result[P] = '-' then\r\n        Inc(P);\r\n      while (Result[P] = '0') and (P < Length(Result)) and (Copy(Result,P+1,Length(DS))<>DS) do\r\n          { Trim leading zeros; conversion above should not give any, but occasionally does\r\n            because of rounding }\r\n          System.Delete(Result,P,1);\r\n      end\r\n    else\r\n      begin\r\n      { Add zeros at start }\r\n      Insert(Copy('00000',1,-Exponent),Result,P-1);\r\n      Result[P-Exponent] := Result[P-Exponent-1]; { Copy leading digit }\r\n      Result[P] := '.';\r\n      if Exponent <> -1 then\r\n        Result[P-Exponent-1] := '0';\r\n      end;\r\n    { Remove trailing zeros }\r\n    Q := Length(Result);\r\n    while (Q > 0) and (Result[Q] = '0') do\r\n      Dec(Q);\r\n    if Result[Q] = '.' then\r\n      Dec(Q); { Remove trailing decimal point }\r\n    if (Q = 0) or ((Q=1) and (Result[1] = '-')) then\r\n      Result := '0'\r\n    else\r\n      SetLength(Result,Q);\r\n    end\r\n  else\r\n    begin\r\n    { Need exponent, but remove superfluous characters }\r\n    { Delete trailing zeros }\r\n    while Result[PE-1] = '0' do\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { If number ends in decimal point, remove it }\r\n    if Result[PE-1] = DS then\r\n      begin\r\n      System.Delete(Result,PE-1,1);\r\n      Dec(PE);\r\n      end;\r\n    { delete superfluous + in exponent }\r\n    if Result[PE+1]='+' then\r\n      System.Delete(Result,PE+1,1)\r\n    else\r\n      Inc(PE);\r\n    while Result[PE+1] = '0' do\r\n      { Delete leading zeros in exponent }\r\n      System.Delete(Result,PE+1,1)\r\n    end;\r\n  Result:=ReplaceDecimalSep(Result,DS)\r\nend;\r\n\r\nfunction FormatExponentFloat(Value : double; Precision,Digits : Integer;DS : String) : string;\r\n\r\nVar\r\n  P: Integer;\r\nBegin\r\n  DS:=DecimalSeparator;\r\n  If (Precision = -1) Or (Precision > maxdigits) Then\r\n    Precision := maxdigits;\r\n  Str(Value:Precision+7, Result);\r\n  { Delete leading spaces }\r\n  while Result[1] = ' ' do\r\n    System.Delete(Result, 1, 1);\r\n  P:=Pos('E',Result);\r\n  if P=0 then\r\n    begin\r\n    Result:=ReplaceDecimalSep(Result,DS);\r\n    exit;\r\n    end;\r\n  Inc(P, 2);\r\n  if Digits > 4 then\r\n    Digits:=4;\r\n  Digits:=Length(Result) - P - Digits + 1;\r\n  if Digits < 0 then\r\n    insert(copy('0000',1,-Digits),Result,P)\r\n  else\r\n    while (Digits > 0) and (Result[P] = '0') do\r\n      begin\r\n      System.Delete(Result, P, 1);\r\n      if P > Length(Result) then\r\n        begin\r\n        System.Delete(Result, P - 2, 2);\r\n        break;\r\n        end;\r\n      Dec(Digits);\r\n      end;\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nEnd;\r\n\r\nfunction FormatFixedFloat(Value : double; Digits : Integer; DS : String) : string;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  Else If Digits > 18 Then\r\n    Digits := 18;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\nend;\r\n\r\n\r\nfunction FormatNumberFloat(Value : double; Digits : Integer; DS,TS : String) : string;\r\n\r\nVar\r\n  P : integer;\r\n\r\nBegin\r\n  If Digits = -1 Then\r\n    Digits := 2\r\n  else If Digits > maxdigits Then\r\n    Digits := maxdigits;\r\n  Str(Value:0:Digits, Result);\r\n  if (Result<>'') and (Result[1]=' ') then\r\n    Delete(Result,1,1);\r\n  P:=Pos('.',Result);\r\n  Result:=ReplaceDecimalSep(Result,DS);\r\n  Dec(P,3);\r\n  if (TS<>'') and (TS<>#0) then\r\n    While (P>1) Do\r\n      Begin\r\n      If (Result[P-1] <> '-')  Then\r\n        Insert(TS, Result, P);\r\n      Dec(P, 3);\r\n      End;\r\nEnd;\r\n\r\nfunction RemoveLeadingNegativeSign(var AValue: String; DS : String): Boolean;\r\n\r\n// removes negative sign in case when result is zero eg. -0.00\r\n\r\nvar\r\n  i: PtrInt;\r\n  TS: String;\r\n  StartPos: PtrInt;\r\n\r\nbegin\r\n  Result:=False;\r\n  StartPos := 2;\r\n  TS := ThousandSeparator;\r\n  for i :=StartPos to length(AValue) do\r\n    begin\r\n    Result := (AValue[i] in ['0', DS, 'E', '+']) or (aValue=TS);\r\n    if not Result then\r\n      break;\r\n    end;\r\n  if (Result) then\r\n    Delete(AValue, 1, 1);\r\nend;\r\n\r\nFunction FormatNumberCurrency(const Value : Currency; Digits : Integer; DS,TS : String) : string;\r\n\r\nVar\r\n  Negative: Boolean;\r\n  P : Integer;\r\n\r\nBegin\r\n   If Digits = -1 Then\r\n     Digits := CurrencyDecimals\r\n   Else If Digits > 18 Then\r\n     Digits := 18;\r\n   Str(Value:0:Digits, Result);\r\n   Negative:=Result[1] = '-';\r\n   if Negative then\r\n     System.Delete(Result, 1, 1);\r\n   P := Pos('.', Result);\r\n   If P <> 0 Then\r\n     Result:=ReplaceDecimalSep(Result,DS)\r\n   else\r\n     P := Length(Result)+1;\r\n   Dec(P, 3);\r\n   While (P > 1) Do\r\n   Begin\r\n     If ThousandSeparator<>#0 Then\r\n       Insert(FormatSettings.ThousandSeparator, Result, P);\r\n     Dec(P, 3);\r\n   End;\r\n   if (length(Result) > 1) and Negative then\r\n     Negative := not RemoveLeadingNegativeSign(Result,DS);\r\n   If Not Negative Then\r\n     Case CurrencyFormat Of\r\n       0: Result := CurrencyString + Result;\r\n       1: Result := Result + CurrencyString;\r\n       2: Result := CurrencyString + ' ' + Result;\r\n       3: Result := Result + ' ' + CurrencyString;\r\n     end\r\n   else\r\n     Case NegCurrFormat Of\r\n       0: Result := '(' + CurrencyString + Result + ')';\r\n       1: Result := '-' + CurrencyString + Result;\r\n       2: Result := CurrencyString + '-' + Result;\r\n       3: Result := CurrencyString + Result + '-';\r\n       4: Result := '(' + Result + CurrencyString + ')';\r\n       5: Result := '-' + Result + CurrencyString;\r\n       6: Result := Result + '-' + CurrencyString;\r\n       7: Result := Result + CurrencyString + '-';\r\n       8: Result := '-' + Result + ' ' + CurrencyString;\r\n       9: Result := '-' + CurrencyString + ' ' + Result;\r\n       10: Result := Result + ' ' + CurrencyString + '-';\r\n       11: Result := CurrencyString + ' ' + Result + '-';\r\n       12: Result := CurrencyString + ' ' + '-' + Result;\r\n       13: Result := Result + '-' + ' ' + CurrencyString;\r\n       14: Result := '(' + CurrencyString + ' ' + Result + ')';\r\n       15: Result := '(' + Result + ' ' + CurrencyString + ')';\r\n     end;\r\n   if TS='' then ;\r\nend;\r\n\r\nFunction FloatToStrF(const Value : double; format: TFloatFormat; Precision, Digits: Integer): String;\r\n\r\nVar\r\n  DS: string;\r\n\r\nBegin\r\n  DS:=DecimalSeparator;\r\n  Case format Of\r\n    ffGeneral:\r\n      Result:=FormatGeneralFloat(Value,Precision,DS);\r\n    ffExponent:\r\n      Result:=FormatExponentFloat(Value,Precision,Digits,DS);\r\n    ffFixed:\r\n      Result:=FormatFixedFloat(Value,Digits,DS);\r\n    ffNumber:\r\n      Result:=FormatNumberFloat(Value,Digits,DS,ThousandSeparator);\r\n    ffCurrency:\r\n     Result:=FormatNumberCurrency(Value,Digits,DS,ThousandSeparator);\r\n  end;\r\n  if (Format<>ffCurrency) and (length(Result)>1) and (Result[1]='-') then\r\n    RemoveLeadingNegativeSign(Result,DS);\r\nend;\r\n\r\nfunction Format (const Fmt: String; const Args: array of jsvalue): String;\r\n\r\nVar ChPos,OldPos,ArgPos,DoArg,Len : SizeInt;\r\n    Hs,ToAdd : String;\r\n    Index : SizeInt;\r\n    Width,Prec : Longint;\r\n    Left : Boolean;\r\n    Fchar : char;\r\n    vq : nativeint;\r\n\r\n  {\r\n    ReadFormat reads the format string. It returns the type character in\r\n    uppercase, and sets index, Width, Prec to their correct values,\r\n    or -1 if not set. It sets Left to true if left alignment was requested.\r\n    In case of an error, DoFormatError is called.\r\n  }\r\n\r\n  Function ReadFormat : Char;\r\n\r\n  Var Value : NativeInt;\r\n\r\n    Procedure ReadInteger;\r\n\r\n    var\r\n      Code: integer;\r\n      ArgN: SizeInt;\r\n    begin\r\n      If Value<>-1 then exit; // Was already read.\r\n      OldPos:=ChPos;\r\n      While (ChPos<=Len) and\r\n            (Fmt[ChPos]<='9') and (Fmt[ChPos]>='0') do inc(ChPos);\r\n      If ChPos>len then\r\n        DoFormatError(feInvalidFormat,Fmt);\r\n      If Fmt[ChPos]='*' then\r\n        begin\r\n\r\n        if Index=-1 then\r\n          ArgN:=Argpos\r\n        else\r\n        begin\r\n          ArgN:=Index;\r\n          Inc(Index);\r\n        end;\r\n\r\n        If (ChPos>OldPos) or (ArgN>High(Args)) then\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n\r\n        ArgPos:=ArgN+1;\r\n\r\n        if IsNumber(Args[ArgN]) and IsInteger(Args[ArgN]) then\r\n          Value:=Integer(Args[ArgN])\r\n        else\r\n          DoFormatError(feInvalidFormat,Fmt);\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        begin\r\n        If (OldPos<ChPos) Then\r\n          begin\r\n          Val (Copy(Fmt,OldPos,ChPos-OldPos),value,code);\r\n          // This should never happen !!\r\n          If Code>0 then DoFormatError (feInvalidFormat,Fmt);\r\n          end\r\n        else\r\n          Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadIndex;\r\n\r\n    begin\r\n      If Fmt[ChPos]<>':' then\r\n        ReadInteger\r\n      else\r\n        value:=0; // Delphi undocumented behaviour, assume 0, #11099\r\n      If Fmt[ChPos]=':' then\r\n        begin\r\n        If Value=-1 then DoFormatError(feMissingArgument,Fmt);\r\n        Index:=Value;\r\n        Value:=-1;\r\n        Inc(ChPos);\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadLeft;\r\n\r\n    begin\r\n      If Fmt[ChPos]='-' then\r\n        begin\r\n        left:=True;\r\n        Inc(ChPos);\r\n        end\r\n      else\r\n        Left:=False;\r\n    end;\r\n\r\n    Procedure ReadWidth;\r\n\r\n    begin\r\n      ReadInteger;\r\n      If Value<>-1 then\r\n        begin\r\n        Width:=Value;\r\n        Value:=-1;\r\n        end;\r\n    end;\r\n\r\n    Procedure ReadPrec;\r\n\r\n    begin\r\n      If Fmt[ChPos]='.' then\r\n        begin\r\n        inc(ChPos);\r\n          ReadInteger;\r\n        If Value=-1 then\r\n         Value:=0;\r\n        prec:=Value;\r\n        end;\r\n    end;\r\n\r\n\r\n  begin\r\n    Index:=-1;\r\n    Width:=-1;\r\n    Prec:=-1;\r\n    Value:=-1;\r\n    inc(ChPos);\r\n    If Fmt[ChPos]='%' then\r\n      begin\r\n      Result:='%';\r\n      exit;                           // VP fix\r\n      end;\r\n    ReadIndex;\r\n    ReadLeft;\r\n    ReadWidth;\r\n    ReadPrec;\r\n    Result:=Upcase(Fmt[ChPos]);\r\n  end;\r\n\r\n\r\n  function Checkarg (AT : TJSValueType; err:boolean):boolean;\r\n  {\r\n    Check if argument INDEX is of correct type (AT)\r\n    If Index=-1, ArgPos is used, and argpos is augmented with 1\r\n    DoArg is set to the argument that must be used.\r\n  }\r\n  begin\r\n    result:=false;\r\n    if Index=-1 then\r\n      DoArg:=Argpos\r\n    else\r\n      DoArg:=Index;\r\n    ArgPos:=DoArg+1;\r\n    If (Doarg>High(Args)) or (GetValueTYpe(Args[Doarg])<>AT) then\r\n     begin\r\n       if err then\r\n        DoFormatError(feInvalidArgindex,Fmt);\r\n       dec(ArgPos);\r\n       exit;\r\n     end;\r\n    result:=true;\r\n  end;\r\n\r\nbegin\r\n  Result:='';\r\n  Len:=Length(Fmt);\r\n  ChPos:=1;\r\n  OldPos:=1;\r\n  ArgPos:=0;\r\n  While ChPos<=len do\r\n    begin\r\n    While (ChPos<=Len) and (Fmt[ChPos]<>'%') do\r\n      inc(ChPos);\r\n    If ChPos>OldPos Then\r\n      Result:=Result+Copy(Fmt,OldPos,ChPos-Oldpos);\r\n    If ChPos<Len then\r\n      begin\r\n      FChar:=ReadFormat;\r\n{$ifdef fmtdebug}\r\n      DumpFormat(FCHar);\r\n{$endif}\r\n      Case FChar of\r\n        'D' : begin\r\n              Checkarg(jvtinteger,true);\r\n              toAdd:=IntToStr(NativeInt(Args[DoArg]));\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              If ToAdd[1]<>'-' then\r\n                ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              else\r\n                // + 1 to accomodate for - sign in length !!\r\n                Insert(StringOfChar('0',Index+1),toadd,2);\r\n              end;\r\n        'U' : begin\r\n              Checkarg(jvtinteger,True);\r\n              if NativeInt(Args[Doarg])<0 then\r\n                DoFormatError(feInvalidArgindex,Fmt);\r\n              Toadd:=IntToStr(NativeInt(Args[Doarg]));\r\n              Width:=Abs(width);\r\n              Index:=Prec-Length(ToAdd);\r\n              ToAdd:=StringOfChar('0',Index)+ToAdd\r\n              end;\r\n        'E' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffFixed,9999,Prec);\r\n              end;\r\n        'F' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffFixed,9999,Prec);\r\n              end;\r\n        'G' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffGeneral,Prec,3);\r\n              end;\r\n        'N' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffNumber,9999,Prec);\r\n              end;\r\n        'M' : begin\r\n              if CheckArg(jvtFloat,false) or CheckArg(jvtInteger,True) then\r\n                ToAdd:=FloatToStrF(Double(Args[doarg]),ffCurrency,9999,Prec);\r\n              end;\r\n        'S' : begin\r\n              CheckArg(jvtString,true);\r\n              hs:=String(Args[doarg]);\r\n              Index:=Length(hs);\r\n              If (Prec<>-1) and (Index>Prec) then\r\n                Index:=Prec;\r\n              ToAdd:=Copy(hs,1,Index);\r\n              end;\r\n        'P' : Begin\r\n              CheckArg(jvtInteger,true);\r\n              ToAdd:=IntToHex(NativeInt(Args[DoArg]),31);\r\n              end;\r\n        'X' : begin\r\n              Checkarg(jvtinteger,true);\r\n              vq:=nativeInt(Args[Doarg]);\r\n              index:=31; // May need to adjust to NativeInt\r\n              If Prec>index then\r\n                ToAdd:=IntToHex(vq,index)\r\n              else\r\n                begin\r\n                // determine minimum needed number of hex digits.\r\n                Index:=1;\r\n                While (NativeInt(1) shl (Index*4)<=vq) and (index<16) do\r\n                  inc(Index);\r\n                If Index>Prec then\r\n                  Prec:=Index;\r\n                ToAdd:=IntToHex(vq,Prec);\r\n                end;\r\n              end;\r\n        '%': ToAdd:='%';\r\n      end;\r\n      If Width<>-1 then\r\n        If Length(ToAdd)<Width then\r\n          If not Left then\r\n            ToAdd:=StringOfChar(' ',Width-Length(ToAdd))+ToAdd\r\n          else\r\n            ToAdd:=ToAdd+StringOfChar(' ',Width-Length(ToAdd));\r\n      Result:=Result+ToAdd;\r\n      end;\r\n    inc(ChPos);\r\n    Oldpos:=ChPos;\r\n    end;\r\nend;\r\n\r\nfunction LocaleCompare(const s1, s2, locales: String): Boolean; assembler;\r\nasm\r\n  return s1.localeCompare(s2,locales) == 0;\r\nend;\r\n\r\nfunction NormalizeStr(const S: String; const Norm: String): String; assembler;\r\nasm\r\n  return S.normalize(Norm);\r\nend;\r\n\r\nfunction IsValidIdent(const Ident: string; AllowDots: Boolean = False; StrictDots: Boolean = False): Boolean;\r\nconst\r\n  Alpha = ['A'..'Z', 'a'..'z', '_'];\r\n  AlphaNum = Alpha + ['0'..'9'];\r\n  Dot = '.';\r\nvar\r\n  First: Boolean;\r\n  I, Len: Integer;\r\nbegin\r\n  Len := Length(Ident);\r\n  if Len < 1 then\r\n    Exit(False);\r\n  First := True;\r\n  Result:=false;\r\n  I:=1;\r\n  While I<=len do\r\n    begin\r\n    if First then\r\n    begin\r\n      if not (Ident[I] in Alpha) then exit;\r\n      First := False;\r\n    end\r\n    else if AllowDots and (Ident[I] = Dot) then\r\n    begin\r\n      if StrictDots then\r\n      begin\r\n        if I >= Len then exit;\r\n        First := True;\r\n      end;\r\n    end\r\n    else\r\n      if not (Ident[I] in AlphaNum) then exit;\r\n    I:=I+1;\r\n    end;\r\n  Result:=true;\r\nend;\r\n\r\nprocedure FreeAndNil(var Obj);\r\nvar\r\n  o: TObject;\r\nbegin\r\n  o:=TObject(Obj);\r\n  if o=nil then exit;\r\n  TObject(Obj):=nil;\r\n  o.Destroy;\r\nend;\r\n\r\n{ EVariantError }\r\n\r\nconstructor EVariantError.CreateCode(Code: Longint);\r\nbegin\r\n  ErrCode:=Code;\r\nend;\r\n\r\n{ Exception }\r\n\r\nconstructor Exception.Create(const Msg: String);\r\nbegin\r\n  fMessage:=Msg;\r\nend;\r\n\r\nconstructor Exception.CreateFmt(const Msg: string; const Args: array of JSValue);\r\nbegin\r\n  //writeln('Exception.CreateFmt START ',ClassName,' \"',Msg,'\" Args=',Args);\r\n  fMessage:=Format(Msg,Args);\r\n  //writeln('Exception.CreateFmt END ',ClassName,' \"',Msg,'\" fMessage=',fMessage);\r\nend;\r\n\r\nconstructor Exception.CreateHelp(const Msg: String; AHelpContext: Integer);\r\nbegin\r\n  fMessage:=Msg;\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nconstructor Exception.CreateFmtHelp(const Msg: string;\r\n  const Args: array of JSValue; AHelpContext: Integer);\r\nbegin\r\n  fMessage:=Format(Msg,Args);\r\n  fHelpContext:=AHelpContext;\r\nend;\r\n\r\nfunction Exception.ToString: String;\r\nbegin\r\n  Result:=ClassName+': '+Message;\r\nend;\r\n\r\nConst\r\n  RESpecials = '([\\[\\]\\(\\)\\\\\\.\\*])';\r\n\r\nFunction StringReplace(aOriginal, aSearch, aReplace : string; Flags : TStringReplaceFlags) : String;\r\n\r\nVar\r\n  REFlags : String;\r\n  REString : String;\r\n\r\nbegin\r\n  REFlags:='';\r\n  if rfReplaceAll in flags then\r\n    ReFlags:='g';\r\n  if rfIgnoreCase in flags then\r\n    ReFlags:=ReFlags+'i';\r\n  REString:=TJSString(aSearch).replace(TJSRegexp.new(RESpecials,'g'),'\\$1');\r\n  Result:=TJSString(aOriginal).replace(TJSRegexp.new(REString,REFlags),aReplace);\r\nend;\r\n\r\nFunction QuoteString(aOriginal : String; AQuote : Char) : String;\r\n\r\nVar\r\n  REString : String;\r\n\r\nbegin\r\n  REString:=TJSString(aQuote).replace(TJSRegexp.new(aOriginal,'g'),'\\\\$1');\r\n  Result:=AQuote+TJSString(aOriginal).replace(TJSRegexp.new(REString,'g'),'$1\\$1')+AQuote;\r\nend;\r\n\r\nfunction IsDelimiter(const Delimiters, S: string; Index: Integer): Boolean;\r\nbegin\r\n  Result:=False;\r\n  if (Index>0) and (Index<=Length(S)) then\r\n    Result:=Pos(S[Index],Delimiters)<>0; // Note we don't do MBCS yet\r\nend;\r\n\r\nfunction AdjustLineBreaks(const S: string): string;\r\n\r\nbegin\r\n  Result:=AdjustLineBreaks(S,DefaultTextLineBreakStyle);\r\nend;\r\n\r\nfunction AdjustLineBreaks(const S: string; Style: TTextLineBreakStyle): string;\r\n\r\nvar\r\n  I,L: Longint;\r\n  Res : String;\r\n\r\n  Procedure Add(C  : Char);\r\n  begin\r\n    Res:=Res+C;\r\n  end;\r\n\r\nbegin\r\n  I:=0;\r\n  L:=Length(S);\r\n  Result:='';\r\n  While (I<=L) do\r\n    case S[I] of\r\n      #10: begin\r\n          if Style in [tlbsCRLF,tlbsCR] then\r\n            Add(#13);\r\n          if Style=tlbsCRLF then\r\n            Add(#10);\r\n          Inc(I);\r\n          end;\r\n     #13: begin\r\n          if Style=tlbsCRLF then\r\n            Add(#13);\r\n          Add(#10);\r\n          Inc(I);\r\n          if S[I]=#10 then\r\n            Inc(I);\r\n          end;\r\n    else\r\n      Add(S[i]);\r\n      Inc(I);\r\n    end;\r\n  Result:=Res;\r\nend;\r\n\r\nfunction WrapText(const Line, BreakStr: string; const BreakChars: Array of char;  MaxCol: Integer): string;\r\n\r\nconst\r\n  Quotes = ['''', '\"'];\r\n\r\nVar\r\n  L : String;\r\n  C,LQ,BC : Char;\r\n  P,BLen,Len : Integer;\r\n  HB,IBC : Boolean;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=Line;\r\n  Blen:=Length(BreakStr);\r\n  If (BLen>0) then\r\n    BC:=BreakStr[1]\r\n  else\r\n    BC:=#0;\r\n  Len:=Length(L);\r\n  While (Len>0) do\r\n    begin\r\n    P:=1;\r\n    LQ:=#0;\r\n    HB:=False;\r\n    IBC:=False;\r\n    While ((P<=Len) and ((P<=MaxCol) or not IBC)) and ((LQ<>#0) or Not HB) do\r\n      begin\r\n      C:=L[P];\r\n      If (C=LQ) then\r\n        LQ:=#0\r\n      else If (C in Quotes) then\r\n        LQ:=C;\r\n      If (LQ<>#0) then\r\n        Inc(P)\r\n      else\r\n        begin\r\n        HB:=((C=BC) and (BreakStr=Copy(L,P,BLen)));\r\n        If HB then\r\n          Inc(P,Blen)\r\n        else\r\n          begin\r\n          If (P>=MaxCol) then\r\n            IBC:=CharInSet(C,BreakChars);\r\n          Inc(P);\r\n          end;\r\n        end;\r\n//      Writeln('\"',C,'\" : IBC : ',IBC,' HB  : ',HB,' LQ  : ',LQ,' P>MaxCol : ',P>MaxCol);\r\n      end;\r\n    Result:=Result+Copy(L,1,P-1);\r\n    Delete(L,1,P-1);\r\n    Len:=Length(L);\r\n    If (Len>0) and Not HB then\r\n      Result:=Result+BreakStr;\r\n    end;\r\nend;\r\n\r\nfunction WrapText(const Line: string; MaxCol: Integer): string;\r\n\r\nbegin\r\n  Result:=WrapText(Line,sLineBreak, [' ', '-', #9], MaxCol);\r\nend;\r\n\r\n\r\nfunction GetEnvironmentVariable(const EnvVar: String): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariable) then\r\n    Result:=OnGetEnvironmentVariable(EnvVar)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction GetEnvironmentVariableCount: Integer;\r\nbegin\r\n  if Assigned(OnGetEnvironmentVariableCount) then\r\n    Result:=OnGetEnvironmentVariableCount()\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction GetEnvironmentString(Index: Integer): String;\r\nbegin\r\n  if Assigned(OnGetEnvironmentString) then\r\n    Result:=OnGetEnvironmentString(Index)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\n{ Date/Time routines}\r\n\r\nFunction DoEncodeDate(Year, Month, Day: Word): longint;\r\n\r\nVar\r\n  D : TDateTime;\r\n\r\nbegin\r\n  If TryEncodeDate(Year,Month,Day,D) then\r\n    Result:=Trunc(D)\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nfunction DoEncodeTime(Hour, Minute, Second, MilliSecond: word): TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Result:=0;\r\nend;\r\n\r\nFunction DateTimeToJSDate(aDateTime : TDateTime) : TJSDate;\r\n\r\nVar\r\n  Y,M,D,h,n,s,z : Word;\r\n\r\nbegin\r\n  DecodeDate(Trunc(aDateTime),Y,M,D);\r\n  DecodeTime(Frac(aDateTime),H,N,S,Z);\r\n  Result:=TJSDate.New(Y,M,D,h,n,s,z);\r\nend;\r\n\r\nFunction JSDatetoDateTime(ADate: TJSDate) : TDateTime;\r\n\r\nbegin\r\n  Result:=EncodeDate(ADate.FullYear,ADate.Month+1,ADate.Date) +\r\n          EncodeTime(ADate.Hours,ADate.Minutes,ADate.Seconds,ADate.Milliseconds);\r\nend;\r\n\r\n\r\n{   ComposeDateTime converts a Date and a Time into one TDateTime   }\r\nfunction ComposeDateTime(Date,Time : TDateTime) : TDateTime;\r\n\r\nbegin\r\n  if Date < 0 then\r\n    Result := trunc(Date) - Abs(frac(Time))\r\n  else\r\n    Result := trunc(Date) + Abs(frac(Time));\r\nend;\r\n\r\nFunction TryEncodeDate(Year,Month,Day : Word; Out Date : TDateTime) : Boolean;\r\n\r\nvar\r\n  c, ya: LongWord;\r\nbegin\r\n  Result:=(Year>0) and (Year<10000) and\r\n          (Month >= 1) and (Month<=12) and\r\n          (Day>0) and (Day<=MonthDays[IsleapYear(Year),Month]);\r\n If Result then\r\n   begin\r\n     if month > 2 then\r\n      Dec(Month,3)\r\n     else\r\n      begin\r\n        Inc(Month,9);\r\n        Dec(Year);\r\n      end;\r\n     c:= Year DIV 100;\r\n     ya:= Year - 100*c;\r\n     Date := (146097*c) SHR 2 + (1461*ya) SHR 2 + (153*LongWord(Month)+2) DIV 5 + LongWord(Day);\r\n     // Note that this line can't be part of the line above, since TDateTime is\r\n     // signed and c and ya are not\r\n     Date := Date - 693900;\r\n   end\r\nend;\r\n\r\nfunction TryEncodeTime(Hour, Min, Sec, MSec:word; Out Time : TDateTime) : boolean;\r\n\r\nbegin\r\n  Result:=(Hour<24) and (Min<60) and (Sec<60) and (MSec<1000);\r\n  If Result then\r\n    Time:=TDateTime(LongWord(Hour)*3600000+LongWord(Min)*60000+LongWord(Sec)*1000+MSec)/MSecsPerDay;\r\nend;\r\n\r\n{   EncodeDate packs three variables Year, Month and Day into a\r\n    TDateTime value the result is the number of days since 12/30/1899   }\r\n\r\nfunction EncodeDate(Year, Month, Day: word): TDateTime;\r\n\r\nbegin\r\n  If Not TryEncodeDate(Year,Month,Day,Result) then\r\n    Raise EConvertError.CreateFmt('%s-%s-%s is not a valid date specification',\r\n                              [IntToStr(Year),IntToStr(Month),IntToStr(Day)]);\r\nend;\r\n\r\n{   EncodeTime packs four variables Hour, Minute, Second and MilliSecond into\r\n    a TDateTime value     }\r\n\r\nfunction EncodeTime(Hour, Minute, Second, MilliSecond:word):TDateTime;\r\n\r\nbegin\r\n  If not TryEncodeTime(Hour,Minute,Second,MilliSecond,Result) then\r\n    Raise EConvertError.CreateFmt('%s:%s:%s.%s is not a valid time specification',\r\n                              [IntToStr(Hour),IntToStr(Minute),IntToStr(Second),IntToStr(MilliSecond)]);\r\nend;\r\n\r\n\r\n{   DecodeDate unpacks the value Date into three values:\r\n    Year, Month and Day   }\r\n\r\nprocedure DecodeDate(Date: TDateTime; out Year, Month, Day: word);\r\nvar\r\n  ly,ld,lm,j : LongWord;\r\nbegin\r\n  if Date <= -datedelta then  // If Date is before 1-1-1 then return 0-0-0\r\n    begin\r\n    Year := 0;\r\n    Month := 0;\r\n    Day := 0;\r\n    end\r\n  else\r\n    begin\r\n    if Date>0 then\r\n      Date:=(Date+(1/(msecsperday*2)))\r\n    else\r\n      Date:=Date-(1/(msecsperday*2));\r\n    if Date>MaxDateTime then\r\n      Date:=MaxDateTime;\r\n//       Raise EConvertError.CreateFmt('%f is not a valid TDatetime encoding, maximum value is %f.',[Date,MaxDateTime]);\r\n    j := ((Trunc(Date) + 693900) SHL 2)-1;\r\n    ly:= j DIV 146097;\r\n    j:= j - 146097 * LongWord(ly);\r\n    ld := j SHR 2;\r\n    j:=(ld SHL 2 + 3) DIV 1461;\r\n    ld:= ((ld SHL 2) + 7 - 1461*j) SHR 2;\r\n    lm:=(5 * ld-3) DIV 153;\r\n    ld:= (5 * ld +2 - 153*lm) DIV 5;\r\n    ly:= 100 * LongWord(ly) + j;\r\n    if lm < 10 then\r\n     inc(lm,3)\r\n    else\r\n      begin\r\n        dec(lm,9);\r\n        inc(ly);\r\n      end;\r\n    year:=ly;\r\n    month:=lm;\r\n    day:=ld;\r\n    end;\r\nend;\r\n\r\n\r\nfunction DecodeDateFully(const DateTime: TDateTime; out Year, Month, Day, DOW: Word): Boolean;\r\nbegin\r\n  DecodeDate(DateTime,Year,Month,Day);\r\n  DOW:=DayOfWeek(DateTime);\r\n  Result:=IsLeapYear(Year);\r\nend;\r\n  {   DateTimeToTimeStamp converts DateTime to a TTimeStamp   }\r\n\r\nfunction DateTimeToTimeStamp(DateTime: TDateTime): TTimeStamp;\r\n\r\nVar\r\n  D : Double;\r\nbegin\r\n  D:=DateTime * Double(MSecsPerDay);\r\n  if D<0 then\r\n    D:=D-0.5\r\n  else\r\n    D:=D+0.5;\r\n  result.Time := Trunc(Abs(Trunc(D)) Mod MSecsPerDay);\r\n  result.Date := DateDelta + (Trunc(D) div MSecsPerDay);\r\nend;\r\n\r\n{   TimeStampToDateTime converts TimeStamp to a TDateTime value   }\r\n\r\nfunction TimeStampToDateTime(const TimeStamp: TTimeStamp): TDateTime;\r\nbegin\r\n  Result := ComposeDateTime(TimeStamp.Date - DateDelta,TimeStamp.Time/MSecsPerDay)\r\nend;\r\n\r\n{   MSecsToTimeStamp   }\r\n\r\nfunction MSecsToTimeStamp(MSecs: NativeInt): TTimeStamp;\r\nbegin\r\n  result.Date := Trunc(msecs/msecsperday);\r\n  msecs:= msecs-NativeInt(result.date)*msecsperday;\r\n  result.Time := Round(MSecs);\r\nend;\r\n\r\nfunction TimeStampToMSecs(const TimeStamp: TTimeStamp): NativeInt;\r\nbegin\r\n  result := TimeStamp.Time + (timestamp.date*msecsperday);\r\nend ;\r\n\r\n\r\n\r\n{   DecodeTime unpacks Time into four values:\r\n    Hour, Minute, Second and MilliSecond    }\r\n\r\nprocedure DecodeTime(Time: TDateTime; out Hour, Minute, Second, MilliSecond: word);\r\nVar\r\n  l : LongWord;\r\nbegin\r\n  l := DateTimeToTimeStamp(Time).Time;\r\n  Hour   := l div 3600000;\r\n  l := l mod 3600000;\r\n  Minute := l div 60000;\r\n  l := l mod 60000;\r\n  Second := l div 1000;\r\n  l := l mod 1000;\r\n  MilliSecond := l;\r\nend;\r\n\r\n{   DateTimeToSystemTime converts DateTime value to SystemTime   }\r\n\r\nprocedure DateTimeToSystemTime(DateTime: TDateTime; out SystemTime: TSystemTime);\r\nbegin\r\n  DecodeDateFully(DateTime, SystemTime.Year, SystemTime.Month, SystemTime.Day,SystemTime.DayOfWeek);\r\n  DecodeTime(DateTime, SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond);\r\n  Dec(SystemTime.DayOfWeek);\r\nend ;\r\n\r\n{   SystemTimeToDateTime converts SystemTime to a TDateTime value   }\r\n\r\nfunction SystemTimeToDateTime(const SystemTime: TSystemTime): TDateTime;\r\nbegin\r\n  result := ComposeDateTime(DoEncodeDate(SystemTime.Year, SystemTime.Month, SystemTime.Day),\r\n                            DoEncodeTime(SystemTime.Hour, SystemTime.Minute, SystemTime.Second, SystemTime.MilliSecond));\r\nend ;\r\n\r\nfunction DayOfWeek(DateTime: TDateTime): integer;\r\nbegin\r\n  Result := 1 + ((Trunc(DateTime) - 1) mod 7);\r\n  If (Result<=0) then\r\n    Inc(Result,7);\r\nend;\r\n\r\n\r\n\r\nfunction Now: TDateTime;\r\nbegin\r\n  Result:=JSDateToDateTime(TJSDate.New());\r\nend;\r\n\r\nfunction Date: TDateTime;\r\n\r\nbegin\r\n  Result:=Trunc(Now);\r\nend;\r\n\r\nfunction Time: TDateTime;\r\nbegin\r\n  Result:=Now-Date;\r\nend ;\r\n\r\n{   IncMonth increments DateTime with NumberOfMonths months,\r\n    NumberOfMonths can be less than zero   }\r\n\r\nfunction IncMonth(const DateTime: TDateTime; NumberOfMonths: integer = 1 ): TDateTime;\r\nvar\r\n  Year, Month, Day : word;\r\nbegin\r\n  DecodeDate(DateTime, Year, Month, Day);\r\n  IncAMonth(Year, Month, Day, NumberOfMonths);\r\n  result := ComposeDateTime(DoEncodeDate(Year, Month, Day), DateTime);\r\nend ;\r\n\r\n{   IncAMonth is the same as IncMonth, but operates on decoded date  }\r\n\r\nprocedure IncAMonth(var Year, Month, Day: Word; NumberOfMonths: Integer = 1);\r\nvar\r\n  TempMonth, S: Integer;\r\nbegin\r\n  If NumberOfMonths>=0 then\r\n    s:=1\r\n  else\r\n    s:=-1;\r\n  inc(Year,(NumberOfMonths div 12));\r\n  TempMonth:=Month+(NumberOfMonths mod 12)-1;\r\n  if (TempMonth>11) or\r\n     (TempMonth<0) then\r\n   begin\r\n     Dec(TempMonth, S*12);\r\n     Inc(Year, S);\r\n   end;\r\n  Month:=TempMonth+1;          {   Months from 1 to 12   }\r\n  If (Day>MonthDays[IsLeapYear(Year)][Month]) then\r\n    Day:=MonthDays[IsLeapYear(Year)][Month];\r\nend;\r\n\r\n{  IsLeapYear returns true if Year is a leap year   }\r\n\r\nfunction IsLeapYear(Year: Word): boolean;\r\nbegin\r\n  Result := (Year mod 4 = 0) and ((Year mod 100 <> 0) or (Year mod 400 = 0));\r\nend;\r\n\r\n{  DateToStr returns a string representation of Date using ShortDateFormat   }\r\n\r\nfunction DateToStr(Date: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('ddddd', Date);\r\nend ;\r\n\r\n{  TimeToStr returns a string representation of Time using LongTimeFormat   }\r\n\r\nfunction TimeToStr(Time: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('tt',Time);\r\nend ;\r\n\r\n{   DateTimeToStr returns a string representation of DateTime using LongDateTimeFormat   }\r\n\r\nVar\r\n  DateTimeToStrFormat : Array[Boolean] of string = ('c','f');\r\n\r\nfunction DateTimeToStr(DateTime: TDateTime; ForceTimeIfZero : Boolean = False): string;\r\nbegin\r\n  Result:=FormatDateTime(DateTimeToStrFormat[ForceTimeIfZero], DateTime)\r\nend ;\r\n\r\n\r\n{   StrToDate converts the string S to a TDateTime value\r\n    if S does not represent a valid date value\r\n    an EConvertError will be raised   }\r\n\r\nfunction IntStrToDate(Out ErrorMsg : String; const S: String; const useformat : string; separator : char): TDateTime;\r\n\r\nConst\r\n  WhiteSpace = ' '#8#9#10#12#13;\r\n  Digits = '0123456789';\r\n\r\n  procedure FixErrorMsg(const errmarg : String);\r\n\r\n  begin\r\n    ErrorMsg:=Format(SInvalidDateFormat,[errmarg]);\r\n  end;\r\n\r\nvar\r\n   df:string;\r\n   d,m,y,ly,ld,lm:word;\r\n   n,i,len:longint;\r\n   c: integer;\r\n   dp,mp,yp,which : Byte;\r\n   s1:string;\r\n   values: array of integer;\r\n   YearMoreThenTwoDigits : boolean;\r\n\r\nbegin\r\n  SetLength(values,4);\r\n  Result:=0;\r\n  Len:=Length(S);\r\n  ErrorMsg:='';\r\n  While (Len>0) and (Pos(S[Len],WhiteSpace)>0) do\r\n    Dec(len);\r\n  if (Len=0) then\r\n    begin\r\n    FixErrorMsg(S);\r\n    exit;\r\n    end;\r\n  YearMoreThenTwoDigits := False;\r\n  if separator = #0 then\r\n    if (DateSeparator<>#0) then\r\n      separator := DateSeparator\r\n    else\r\n      separator:='-';\r\n  // Writeln('Separator: ',Separator);\r\n  df := UpperCase(useFormat);\r\n  { Determine order of D,M,Y }\r\n  yp:=0;\r\n  mp:=0;\r\n  dp:=0;\r\n  Which:=0;\r\n  i:=0;\r\n  while (i<Length(df)) and (Which<3) do\r\n   begin\r\n     inc(i);\r\n     Case df[i] of\r\n       'Y' :\r\n         if yp=0 then\r\n          begin\r\n            Inc(Which);\r\n            yp:=which;\r\n          end;\r\n       'M' :\r\n         if mp=0 then\r\n          begin\r\n            Inc(Which);\r\n            mp:=which;\r\n          end;\r\n       'D' :\r\n         if dp=0 then\r\n          begin\r\n            Inc(Which);\r\n            dp:=which;\r\n          end;\r\n     end;\r\n   end;\r\n  // Writeln('YP: ',Yp,', MP: ',Mp,', DP: ',DP);\r\n  for i := 1 to 3 do\r\n    values[i] := 0;\r\n  s1 := '';\r\n  n := 0;\r\n  for i := 1 to len do\r\n     begin\r\n     if Pos(s[i],Digits)>0 then\r\n       s1 := s1 + s[i];\r\n     { space can be part of the shortdateformat, and is defaultly in slovak\r\n       windows, therefor it shouldn't be taken as separator (unless so specified)\r\n       and ignored }\r\n     if (Separator <> ' ') and (s[i] = ' ') then\r\n       Continue;\r\n     if (s[i] = separator) or ((i = len) and (Pos(s[i],Digits)>0)) then\r\n      begin\r\n        inc(n);\r\n        if n>3 then\r\n          begin\r\n//            Writeln('More than 3 separators');\r\n            FixErrorMsg(S);\r\n            exit;\r\n          end;\r\n         // Check if the year has more then two digits (if n=yp, then we are evaluating the year.)\r\n        if (n=yp) and (length(s1)>2) then YearMoreThenTwoDigits := True;\r\n        val(s1, values[n], c);\r\n        if c<>0 then\r\n          begin\r\n//            Writeln('S1 not a number ',S1);\r\n            FixErrorMsg(s);\r\n            Exit;\r\n          end;\r\n        s1 := '';\r\n      end\r\n     else if (Pos(s[i],Digits)=0) then\r\n       begin\r\n//       Writeln('Not a number at pos ',I,' ',S[i]);\r\n       FixErrorMsg(s);\r\n       Exit;\r\n       end;\r\n   end ;\r\n//   Writeln('Which : ',Which,' N : ',N);\r\n   if (Which<3) and (N>Which) then\r\n    begin\r\n    FixErrorMsg(s);\r\n    Exit;\r\n    end;\r\n  // Fill in values.\r\n  DecodeDate(Date,Ly,LM,LD);\r\n  If N=3 then\r\n   begin\r\n     y:=values[yp];\r\n     m:=values[mp];\r\n     d:=values[dp];\r\n   end\r\n  Else\r\n  begin\r\n    Y:=ly;\r\n    If n<2 then\r\n     begin\r\n       d:=values[1];\r\n       m := LM;\r\n     end\r\n    else\r\n     If dp<mp then\r\n      begin\r\n        d:=values[1];\r\n        m:=values[2];\r\n      end\r\n    else\r\n      begin\r\n        d:=values[2];\r\n        m:=values[1];\r\n      end;\r\n  end;\r\n  if (y >= 0) and (y < 100) and not YearMoreThenTwoDigits then\r\n    begin\r\n    ly := ly - TwoDigitYearCenturyWindow;\r\n    Inc(Y, ly div 100 * 100);\r\n    if (TwoDigitYearCenturyWindow > 0) and (Y < ly) then\r\n      Inc(Y, 100);\r\n    end;\r\n  if not TryEncodeDate(y, m, d, result) then\r\n    errormsg:=SErrInvalidDate;\r\nend;\r\n\r\nfunction StrToDate(const S: String; const useformat : string; separator : char): TDateTime;\r\nVar\r\n  MSg : String;\r\nbegin\r\n  Result:=IntStrToDate(Msg,S,useFormat,Separator);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToDate(const S: String; separator : char): TDateTime;\r\nbegin\r\n    result := StrToDate(S,ShortDateFormat,separator)\r\nend;\r\n\r\nfunction StrToDate(const S: String): TDateTime;\r\nbegin\r\n  result := StrToDate(S,ShortDateFormat,#0);\r\nend;\r\n\r\n{   StrToTime converts the string S to a TDateTime value\r\n    if S does not represent a valid time value an\r\n    EConvertError will be raised   }\r\n\r\n\r\nfunction IntStrToTime(Out ErrorMsg : String; const S: String; Len : integer; separator : char): TDateTime;\r\n\r\nconst\r\n  AMPM_None = 0;\r\n  AMPM_AM = 1;\r\n  AMPM_PM = 2;\r\n  tiHour = 0;\r\n  tiMin = 1;\r\n  tiSec = 2;\r\n  tiMSec = 3;\r\n\r\ntype\r\n  TTimeValues = array of Word;\r\n\r\nvar\r\n   AmPm: integer;\r\n   TimeValues: TTimeValues;\r\n\r\n\r\n   function SplitElements(out TimeValues: TTimeValues; out AmPm: Integer): Boolean;\r\n   //Strict version. It does not allow #32 as Separator, it will treat it as whitespace always\r\n   const\r\n     Digits = '0123456789';\r\n   var\r\n      Cur, Offset, ElemLen, Err, TimeIndex, FirstSignificantDigit: Integer;\r\n      Value: Integer;\r\n      DigitPending, MSecPending: Boolean;\r\n      AmPmStr: String;\r\n      CurChar: Char;\r\n      I : Integer;\r\n      allowedchars : string;\r\n\r\n   begin\r\n     Result := False;\r\n     AmPm := AMPM_None; //No Am or PM in string found yet\r\n     MSecPending := False;\r\n     TimeIndex := 0; //indicating which TTimeValue must be filled next\r\n     For I:=tiHour to tiMSec do\r\n      TimeValues[i]:=0;\r\n     Cur := 1;\r\n     //skip leading blanks\r\n     While (Cur < Len) and (S[Cur] =#32) do Inc(Cur);\r\n     Offset := Cur;\r\n     //First non-blank cannot be Separator or DecimalSeparator\r\n     if (Cur > Len - 1) or (S[Cur] = Separator) or (S[Cur] = Decimalseparator) then\r\n       begin\r\n       // Writeln('Error in sep S[Cur]',S[Cur],' ',separator,' ',GetDecimalSeparator);\r\n       Exit;\r\n       end;\r\n     DigitPending := (Pos(S[Cur],Digits)>0);\r\n     While (Cur <= Len) do\r\n     begin\r\n       //writeln;\r\n       // writeln('Main While loop:  Cur = ',Cur,' S[Cur] = \"',S[Cur],'\" Len = ',Len,' separator : ',Separator);\r\n       CurChar := S[Cur];\r\n       if Pos(CurChar,Digits)>0 then\r\n       begin//Digits\r\n         //HH, MM, SS, or Msec?\r\n         // writeln('Digit: ', CurChar);\r\n         //Digits are only allowed after starting Am/PM or at beginning of string or after Separator\r\n         //and TimeIndex must be <= tiMSec\r\n         //Uncomment \"or (#32 = Separator)\" and it will allllow #32 as separator\r\n         if (not (DigitPending {or (#32 = Separator)})) or (TimeIndex > tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending',ElemLen);\r\n            Exit;\r\n            end;\r\n         OffSet := Cur;\r\n         if (CurChar <> '0') then FirstSignificantDigit := OffSet else FirstSignificantDigit := -1;\r\n         while (Cur < Len) and (Pos(S[Cur + 1],Digits)>0) do\r\n         begin\r\n           //Mark first Digit that is not '0'\r\n           if (FirstSignificantDigit = -1) and (S[Cur] <> '0') then FirstSignificantDigit := Cur;\r\n           Inc(Cur);\r\n         end;\r\n         if (FirstSignificantDigit = -1) then FirstSignificantDigit := Cur;\r\n         ElemLen := 1+ Cur - FirstSignificantDigit;\r\n         // writeln('  S[FirstSignificantDigit] = ',S[FirstSignificantDigit], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[Offset], ElemLen);\r\n         // writeln('  Cur = ',Cur);\r\n         //this way we know that Val() will never overflow Value !\r\n         if (ElemLen <= 2) or ((ElemLen <= 3) and (TimeIndex = tiMSec) ) then\r\n         begin\r\n           Val(Copy(S,FirstSignificantDigit, ElemLen), Value, Err);\r\n           // writeln('  Value = ',Value,' HH = ',TimeValues[0],' MM = ',TimeValues[1],' SS = ',TimeValues[2],' MSec = ',Timevalues[3]);\r\n           //This is safe now, because we know Value < High(Word)\r\n           TimeValues[TimeIndex] := Value;\r\n           Inc(TimeIndex);\r\n           DigitPending := False;\r\n         end\r\n         else\r\n           begin\r\n           // Writeln('Wrong elemlen: ',ElemLen, ' timeIndex: ',timeindex);\r\n           Exit; //Value to big, so it must be a wrong timestring\r\n           end;\r\n       end//Digits\r\n       else if (CurChar = #32) then\r\n       begin\r\n         //writeln('#32');\r\n         //just skip, but we must adress this, or it will be parsed by either AM/PM or Separator\r\n       end\r\n       else if (CurChar = Separator) then\r\n       begin\r\n         // writeln('Separator ',Separator);\r\n         if DigitPending or (TimeIndex > tiSec) then\r\n           begin\r\n           // Writeln ('DigitPending ',DigitPending,' or (TimeIndex',Timeindex,' > tiSec,', tiSec,')');\r\n           Exit;\r\n           end;\r\n         DigitPending := True;\r\n         MSecPending := False;\r\n       end\r\n       else if (CurChar = DecimalSeparator) then\r\n       begin\r\n         //writeln('DecimalSeparator');\r\n         if DigitPending or MSecPending or (TimeIndex <> tiMSec) then\r\n            begin\r\n            // Writeln('DigitPending ',DigitPending,' or MSecPending ',MSecPending,' (',TimeIndex,',Timeindex, >', tiMSec,'  tiSec)');\r\n            Exit;\r\n            end;\r\n         DigitPending := True;\r\n         MSecPending := True;\r\n       end\r\n       else\r\n       begin//AM/PM?\r\n         //None of the above, so this char _must_ be the start of AM/PM string\r\n         //If we already have found AM/PM or we expect a digit then then timestring must be wrong at this point\r\n         //writeln('AM/PM?');\r\n         if (AmPm <> AMPM_None) or DigitPending then\r\n           begin\r\n           // Writeln('AmPm <> AMPM_None) or DigitPending');\r\n           Exit;\r\n           end;\r\n         OffSet := Cur;\r\n         allowedchars:=DecimalSeparator+' ';\r\n         if Separator<>#0 then\r\n           allowedchars:=allowedchars+Separator;\r\n         while (Cur < Len -1) and (Pos(S[Cur + 1],AllowedChars)=0)\r\n           and (Pos(S[Cur + 1],Digits)=0) do Inc(Cur);\r\n         ElemLen := 1 + Cur - OffSet;\r\n         // writeln('  S[Offset] = ',S[1+Offset], ' S[Cur] = ',S[Cur],' ElemLen = ',ElemLen,' -> ', S[1+Offset], ElemLen);\r\n         // writeln('  Cur = ',Cur, 'S =',S);\r\n         AmPmStr := Copy(S,1+OffSet, ElemLen);\r\n\r\n         // writeln('AmPmStr = ',ampmstr,' (',length(ampmstr),')');\r\n         //We must compare to TimeAMString before hardcoded 'AM' for delphi compatibility\r\n         //Also it is perfectly legal, though insane to have TimeAMString = 'PM' and vice versa\r\n         if (CompareText(AmPmStr, TimeAMString) = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, TimePMString) = 0) then AmPm := AMPM_PM\r\n         else if (CompareText(AmPmStr, 'AM') = 0) then AmPm := AMPM_AM\r\n         else if (CompareText(AmPmStr, 'PM') = 0) then AmPm := AMPM_PM\r\n         else\r\n           begin\r\n           // Writeln('No timestring ',AmPmStr);\r\n           Exit; //If text does not match any of these, timestring must be wrong;\r\n           end;\r\n         //if AM/PM is at beginning of string, then a digit is mandatory after it\r\n         if (TimeIndex = tiHour) then\r\n         begin\r\n           DigitPending := True;\r\n         end\r\n         //otherwise, no more TimeValues allowed after this\r\n         else\r\n         begin\r\n           TimeIndex := tiMSec + 1;\r\n           DigitPending := False;\r\n         end;\r\n       end;//AM/PM\r\n       Inc(Cur)\r\n     end;//while\r\n\r\n     //If we arrive here, parsing the elements has been successfull\r\n     //if not at least Hours specified then input is not valid\r\n     //when am/pm is specified Hour must be <= 12 and not 0\r\n     if (TimeIndex = tiHour) or ((AmPm <> AMPM_None) and ((TimeValues[tiHour] > 12) or (TimeValues[tiHour] = 0))) or DigitPending then\r\n       Exit;\r\n     Result := True;\r\n   end;\r\n\r\nbegin\r\n  setlength(timevalues,4);\r\n  if separator = #0 then\r\n     if (TimeSeparator<>#0) then\r\n       separator := TimeSeparator\r\n      else\r\n       separator:=':';\r\n  AmPm := AMPM_None;\r\n  if not SplitElements(TimeValues, AmPm) then\r\n  begin\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\n    Exit;\r\n  end;\r\n  if (AmPm=AMPM_PM) and (TimeValues[tiHour]<>12) then Inc(TimeValues[tiHour], 12)\r\n  else if (AmPm=AMPM_AM) and (TimeValues[tiHour]=12) then TimeValues[tiHour]:=0;\r\n  // Writeln(      TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec]);\r\n  if not TryEncodeTime(TimeValues[tiHour], TimeValues[tiMin], TimeValues[tiSec], TimeValues[tiMSec], result) Then\r\n\r\n    ErrorMsg:=Format(SErrInvalidTimeFormat,[S]);\r\nend ;\r\n\r\nfunction StrToTime(const s: String; separator : char): TDateTime;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=IntStrToTime(Msg,S,Length(S),Separator);\r\n  If (Msg<>'') then\r\n    Raise EConvertError.Create(Msg);\r\nend;\r\n\r\nfunction StrToTime(const s: String): TDateTime;\r\nbegin\r\n   result:= StrToTime(s, TimeSeparator);\r\nend;\r\n\r\n{   StrToDateTime converts the string S to a TDateTime value\r\n    if S does not represent a valid date and/or time value\r\n    an EConvertError will be raised   }\r\n\r\nfunction SplitDateTimeStr(DateTimeStr: String; out DateStr, TimeStr: String): Integer;\r\n\r\n{ Helper function for StrToDateTime\r\n  Pre-condition\r\n    Date is before Time\r\n    If either Date or Time is omitted then see what fits best, a time or a date (issue #0020522)\r\n    Date and Time are separated by whitespace (space Tab, Linefeed or carriage return)\r\n    FS.DateSeparator can be the same as FS.TimeSeparator (issue #0020522)\r\n    If they are both #32 and TrimWhite(DateTimeStr) contains a #32 a date is assumed.\r\n  Post-condition\r\n    DateStr holds date as string or is empty\r\n    TimeStr holds time as string or is empty\r\n    Result = number of strings returned, 0 = error\r\n}\r\nconst\r\n  WhiteSpace = #9#10#13#32;\r\n\r\nvar\r\n  p: Integer;\r\n  DummyDT: TDateTime;\r\nbegin\r\n  Result := 0;\r\n  DateStr := '';\r\n  TimeStr := '';\r\n  DateTimeStr := Trim(DateTimeStr);\r\n  if Length(DateTimeStr) = 0 then exit;\r\n  if (DateSeparator = #32) and (TimeSeparator = #32) and (Pos(#32, DateTimeStr) > 0) then\r\n    begin\r\n    DateStr:=DateTimeStr;\r\n    {\r\n      Assume a date: dd [mm [yy]].\r\n      Really fancy would be counting the number of whitespace occurrences and decide\r\n      and split accordingly\r\n    }\r\n    Exit(1);\r\n    end;\r\n  p:=1;\r\n  //find separator\r\n  if (DateSeparator<>#32) then\r\n    begin\r\n    while (p<Length(DateTimeStr)) and (not (Pos(DateTimeStr[p+1],WhiteSpace)>0)) do\r\n      Inc(p);\r\n    end\r\n  else\r\n    begin\r\n    p:=Pos(TimeSeparator, DateTimeStr);\r\n    if (p<>0) then\r\n      repeat\r\n        Dec(p);\r\n      until (p=0) or (Pos(DateTimeStr[p],WhiteSpace)>0);\r\n    end;\r\n  //Always fill DateStr, it eases the algorithm later\r\n  if (p=0) then\r\n    p:=Length(DateTimeStr);\r\n  DateStr:=Copy(DateTimeStr,1,p);\r\n  TimeStr:=Trim(Copy(DateTimeStr,p+1,100));\r\n  if (Length(TimeStr)<>0) then\r\n    Result:=2\r\n  else\r\n    begin\r\n    Result:=1; //found 1 string\r\n    // 2 cases when DateTimeStr only contains a time:\r\n    // Date/time separator differ, and string contains a timeseparator\r\n    // Date/time separators are equal, but transformation to date fails.\r\n    if ((DateSeparator<>TimeSeparator) and (Pos(TimeSeparator,DateStr) > 0))\r\n       or ((DateSeparator=TimeSeparator) and (not TryStrToDate(DateStr, DummyDT)))  then\r\n      begin\r\n      TimeStr := DateStr;\r\n      DateStr := '';\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction StrToDateTime(const s: String): TDateTime;\r\n\r\nvar\r\n  TimeStr, DateStr: String;\r\n  PartsFound: Integer;\r\nbegin\r\n  PartsFound := SplitDateTimeStr(S, DateStr, TimeStr);\r\n  case PartsFound of\r\n    0: Result:=StrToDate('');\r\n    1: if (Length(DateStr) > 0) then\r\n         Result := StrToDate(DateStr,ShortDateFormat,DateSeparator)\r\n       else\r\n         Result := StrToTime(TimeStr);\r\n    2: Result := ComposeDateTime(StrTodate(DateStr,ShortDateFormat,DateSeparator),\r\n                                  StrToTime(TimeStr));\r\n  end;\r\nend;\r\n\r\nFunction FormatDateTime(const FormatStr: string; const DateTime: TDateTime) : String;\r\n\r\n  procedure StoreStr(APos,Len: Integer);\r\n  begin\r\n//    Writeln('StoreStr: ',Result,'+',Copy(FormatStr,APos,Len));\r\n    Result:=Result+Copy(FormatStr,APos,Len);\r\n  end;\r\n\r\n  procedure StoreString(const AStr: string);\r\n\r\n  begin\r\n//    Writeln('StoreString: ',Result,'+',AStr);\r\n    Result:=Result+AStr;\r\n  end;\r\n\r\n  procedure StoreInt(Value, Digits: Integer);\r\n  var\r\n    S: string;\r\n\r\n  begin\r\n    S:=IntToStr(Value);\r\n    While (Length(S)<Digits) do\r\n      S:='0'+S;\r\n    StoreString(S);\r\n  end;\r\n\r\nvar\r\n  Year, Month, Day, DayOfWeek, Hour, Minute, Second, MilliSecond: word;\r\n\r\n  procedure StoreFormat(const FormatStr: string; Nesting: Integer; TimeFlag: Boolean);\r\n  var\r\n    Token, lastformattoken, prevlasttoken: char;\r\n    Count: integer;\r\n    Clock12: boolean;\r\n    tmp: integer;\r\n    isInterval: Boolean;\r\n    P,FormatCurrent,FormatEnd : Integer;\r\n  begin\r\n    if Nesting > 1 then  // 0 is original string, 1 is included FormatString\r\n      Exit;\r\n    FormatCurrent := 1;\r\n    FormatEnd := Length(FormatStr);\r\n    Clock12 := false;\r\n    isInterval := false;\r\n    // look for unquoted 12-hour clock token\r\n    P:=1;\r\n    while P<=FormatEnd do\r\n      begin\r\n      Token := FormatStr[P];\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          Inc(P);\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n        end;\r\n        'A', 'a':\r\n        begin\r\n          if (CompareText(Copy(FormatStr,P,3),'A/P')=0) or\r\n             (CompareText(Copy(FormatStr,P,4),'AMPM')=0) or\r\n             (CompareText(Copy(FormatStr,P,5),'AM/PM')=0) then\r\n          begin\r\n            Clock12 := true;\r\n            break;\r\n          end;\r\n        end;\r\n      end;  // case\r\n      Inc(P);\r\n    end ;\r\n    token := #255;\r\n    lastformattoken := ' ';\r\n    prevlasttoken := 'H';\r\n    while FormatCurrent <= FormatEnd do\r\n    begin\r\n      Token := UpperCase(FormatStr[FormatCurrent])[1];\r\n     //  Writeln('Treating token at pos ',FormatCurrent,', : ',Token,' (',FormatStr,')');\r\n      Count := 1;\r\n      P := FormatCurrent + 1;\r\n      case Token of\r\n        '''', '\"':\r\n        begin\r\n          while (P < FormatEnd) and (FormatStr[P]<>Token) do\r\n            Inc(P);\r\n          Inc(P);\r\n          Count := P - FormatCurrent;\r\n          StoreStr(FormatCurrent + 1, Count - 2);\r\n        end ;\r\n        'A':\r\n        begin\r\n          if CompareText(Copy(FormatStr,FormatCurrent,4), 'AMPM') = 0 then\r\n          begin\r\n            Count := 4;\r\n            if Hour < 12 then\r\n              StoreString(TimeAMString)\r\n            else\r\n              StoreString(TimePMString);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,5), 'AM/PM') = 0 then\r\n          begin\r\n            Count := 5;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 2)\r\n                         else StoreStr(FormatCurrent+3, 2);\r\n          end\r\n          else if CompareText(Copy(FormatStr,FormatCurrent,3), 'A/P') = 0 then\r\n          begin\r\n            Count := 3;\r\n            if Hour < 12 then StoreStr(FormatCurrent, 1)\r\n            else StoreStr(FormatCurrent+2, 1);\r\n          end\r\n          else\r\n            raise EConvertError.Create('Illegal character in format string');\r\n        end ;\r\n        '/':\r\n          begin\r\n           //  Writeln('Detected date separator');\r\n          StoreString(DateSeparator);\r\n          end;\r\n        ':': StoreString(TimeSeparator);\r\n        ' ', 'C', 'D', 'H', 'M', 'N', 'S', 'T', 'Y', 'Z', 'F' :\r\n        begin\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          while (P <= FormatEnd) and (UpperCase(FormatStr[P]) = Token) do\r\n            Inc(P);\r\n          Count := P - FormatCurrent;\r\n          // Writeln(FormatCurrent,' Special Token: ',Token,', Count: ',Count,', P: ',P);\r\n          case Token of\r\n            ' ': StoreStr(FormatCurrent, Count);\r\n            'Y': begin\r\n              if Count > 2 then\r\n                StoreInt(Year, 4)\r\n              else\r\n                StoreInt(Year mod 100, 2);\r\n            end;\r\n            'M': begin\r\n\t      if isInterval and ((prevlasttoken = 'H') or TimeFlag) then\r\n\t        StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t      else\r\n              if (lastformattoken = 'H') or TimeFlag then\r\n              begin\r\n                if Count = 1 then\r\n                  StoreInt(Minute, 0)\r\n                else\r\n                  StoreInt(Minute, 2);\r\n              end\r\n              else\r\n              begin\r\n                case Count of\r\n                  1: StoreInt(Month, 0);\r\n                  2: StoreInt(Month, 2);\r\n                  3: StoreString(ShortMonthNames[Month]);\r\n                else\r\n                  StoreString(LongMonthNames[Month]);\r\n                end;\r\n              end;\r\n            end;\r\n            'D': begin\r\n              case Count of\r\n                1: StoreInt(Day, 0);\r\n                2: StoreInt(Day, 2);\r\n                3: StoreString(ShortDayNames[DayOfWeek]);\r\n                4: StoreString(LongDayNames[DayOfWeek]);\r\n                5: StoreFormat(ShortDateFormat, Nesting+1, False);\r\n              else\r\n                StoreFormat(LongDateFormat, Nesting+1, False);\r\n              end ;\r\n            end ;\r\n            'H':\r\n\t      if isInterval then\r\n\t        StoreInt(Hour + trunc(abs(DateTime))*24, 0)\r\n\t      else\r\n\t      if Clock12 then\r\n              begin\r\n                tmp := hour mod 12;\r\n                if tmp=0 then tmp:=12;\r\n                if Count = 1 then\r\n                  StoreInt(tmp, 0)\r\n                else\r\n                  StoreInt(tmp, 2);\r\n              end\r\n              else begin\r\n                if Count = 1 then\r\n\t\t  StoreInt(Hour, 0)\r\n                else\r\n                  StoreInt(Hour, 2);\r\n              end;\r\n            'N': if isInterval then\r\n\t           StoreInt(Minute + (Hour + trunc(abs(DateTime))*24)*60, 0)\r\n\t\t else\r\n\t\t if Count = 1 then\r\n                   StoreInt(Minute, 0)\r\n                 else\r\n                   StoreInt(Minute, 2);\r\n            'S': if isInterval then\r\n\t           StoreInt(Second + (Minute + (Hour + trunc(abs(DateTime))*24)*60)*60, 0)\r\n\t         else\r\n\t         if Count = 1 then\r\n                   StoreInt(Second, 0)\r\n                 else\r\n                   StoreInt(Second, 2);\r\n            'Z': if Count = 1 then\r\n                   StoreInt(MilliSecond, 0)\r\n                 else\r\n\t\t   StoreInt(MilliSecond, 3);\r\n            'T': if Count = 1 then\r\n\t\t   StoreFormat(ShortTimeFormat, Nesting+1, True)\r\n                 else\r\n\t           StoreFormat(LongTimeFormat, Nesting+1, True);\r\n            'C': begin\r\n                   StoreFormat(ShortDateFormat, Nesting+1, False);\r\n                   if (Hour<>0) or (Minute<>0) or (Second<>0) then\r\n                     begin\r\n                      StoreString(' ');\r\n                      StoreFormat(LongTimeFormat, Nesting+1, True);\r\n                     end;\r\n                 end;\r\n            'F': begin\r\n                   StoreFormat(ShortDateFormat, Nesting+1, False);\r\n                   StoreString(' ');\r\n                   StoreFormat(LongTimeFormat, Nesting+1, True);\r\n                 end;\r\n          end;\r\n\t  prevlasttoken := lastformattoken;\r\n          lastformattoken := token;\r\n        end;\r\n        else\r\n          StoreString(Token);\r\n      end ;\r\n      Inc(FormatCurrent, Count);\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  DecodeDateFully(DateTime, Year, Month, Day, DayOfWeek);\r\n  DecodeTime(DateTime, Hour, Minute, Second, MilliSecond);\r\n  // Writeln(DateTime,'->',Year,',', Month, ',',Day, ',',DayOfWeek,',',Hour, ',',Minute, ',',Second, ',',MilliSecond);\r\n  if FormatStr <> '' then\r\n    StoreFormat(FormatStr, 0, False)\r\n  else\r\n    StoreFormat('C', 0, False);\r\nend ;\r\n\r\n\r\n\r\nfunction CurrentYear: Word;\r\n\r\nbegin\r\n  Result:=TJSDate.New().FullYear;\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  Result:=TryStrToDate(S,Value,ShortDateFormat,#0);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime; separator : char): Boolean;\r\n\r\nbegin\r\n  Result:=TryStrToDate(S,Value,ShortDateFormat,Separator);\r\nend;\r\n\r\nfunction TryStrToDate(const S: String; out Value: TDateTime;\r\n                    const useformat : string; separator : char = #0): Boolean;\r\n\r\nVar\r\n  Msg : String;\r\n\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n    Value:=IntStrToDate(Msg,S,useformat,Separator);\r\n    Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\n\r\n\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime; separator : char): Boolean;\r\nVar\r\n  Msg : String;\r\nbegin\r\n  Result:=Length(S)<>0;\r\n  If Result then\r\n    begin\r\n      Value:=IntStrToTime(Msg,S,Length(S),Separator);\r\n      Result:=(Msg='');\r\n    end;\r\nend;\r\n\r\nfunction TryStrToTime(const S: String; out Value: TDateTime): Boolean;\r\nbegin\r\n  result:=TryStrToTime(S,Value,#0);\r\nend;\r\n\r\nfunction TryStrToDateTime(const S: String; out Value: TDateTime): Boolean;\r\n\r\nvar\r\n  I: integer;\r\n  dtdate, dttime :TDateTime;\r\nbegin\r\n  result:=false;\r\n  I:=Pos(TimeSeparator,S);\r\n  If (I>0) then\r\n    begin\r\n      While (I>0) and (S[I]<>' ') do\r\n        Dec(I);\r\n      If I>0 then\r\n        begin\r\n          if not TryStrToDate(Copy(S,1,I-1),dtdate) then\r\n            exit;\r\n          if not TryStrToTime(Copy(S,i+1, Length(S)-i),dttime) then\r\n            exit;\r\n          Value:=ComposeDateTime(dtdate,dttime);\r\n          result:=true;\r\n        end\r\n      else\r\n         result:=TryStrToTime(s,Value);\r\n    end\r\n  else\r\n    result:=TryStrToDate(s,Value);\r\nend;\r\n\r\n\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToDateDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n   result := StrToTimeDef(S,DefValue,#0);\r\nend;\r\n\r\nfunction StrToDateTimeDef(const S: String; const Defvalue : TDateTime): TDateTime;\r\nbegin\r\n  if not TryStrToDateTime(s,Result) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToDateDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToDate(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nfunction StrToTimeDef(const S: String; const Defvalue : TDateTime; separator : char): TDateTime;\r\nbegin\r\n  if not TryStrToTime(s,Result, separator) Then\r\n    result:=defvalue;\r\nend;\r\n\r\nprocedure ReplaceTime(var dati:TDateTime; NewTime : TDateTime);\r\nbegin\r\n  dati:= ComposeDateTime(dati, newtime);\r\nend;\r\n\r\nprocedure ReplaceDate(var DateTime: TDateTime; const NewDate: TDateTime);\r\nvar\r\n  tmp : TDateTime;\r\nbegin\r\n  tmp:=NewDate;\r\n  ReplaceTime(tmp,DateTime);\r\n  DateTime:=tmp;\r\nend;\r\n\r\nFunction FloatToDateTime (Const Value : Extended) : TDateTime;\r\nbegin\r\n  If (Value<MinDateTime) or (Value>MaxDateTime) then\r\n    Raise EConvertError.CreateFmt (SInvalidDateTime,[FloatToStr(Value)]);\r\n  Result:=Value;\r\nend;\r\n\r\nfunction FloattoCurr(const Value: Extended): Currency;\r\nbegin\r\n  if not TryFloatToCurr(Value, Result) then\r\n    Raise EConvertError.CreateFmt(SInvalidCurrency, [FloatToStr(Value)]);\r\nend;\r\n\r\nfunction TryFloatToCurr(const Value: Extended; var AResult: Currency): Boolean;\r\nbegin\r\n  Result:=(Value>=MinCurrency) and (Value<=MaxCurrency);\r\n  if Result then\r\n    AResult := Value;\r\nend;\r\n\r\nfunction CurrToStr(Value: Currency): string;\r\nbegin\r\n  Result:=FloatToStrF(Value,ffGeneral,-1,0);\r\nend;\r\n\r\n(*\r\nfunction CurrToStr(Value: Currency; const FormatSettings: TFormatSettings): string;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction StrToCurr(const S: string): Currency;\r\n\r\nbegin\r\n  if not TryStrToCurr(S,Result) then\r\n    Raise EConvertError.createfmt(SInvalidCurrency,[S]);\r\nend;\r\n\r\n(*\r\nfunction StrToCurr(const S: string; const FormatSettings: TFormatSettings): Currency;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction TryStrToCurr(const S: string; out Value: Currency): Boolean;\r\n\r\nVar\r\n  D : Double;\r\n\r\nbegin\r\n  Result:=TryStrToFloat(S,D);\r\n  if Result then\r\n    Value:=D;\r\nend;\r\n\r\n(*\r\nfunction TryStrToCurr(const S: string; out Value: Currency; const FormatSettings: TFormatSettings): Boolean;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\nfunction StrToCurrDef(const S: string; Default: Currency): Currency;\r\n\r\nVar\r\n  R : Currency;\r\n\r\nbegin\r\n  if TryStrToCurr(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=Default;\r\nend;\r\n\r\n(*\r\nfunction StrToCurrDef(const S: string; Default: Currency; const FormatSettings: TFormatSettings): Currency;\r\nbegin\r\n\r\nend;\r\n*)\r\n\r\n{ ---------------------------------------------------------------------\r\n  Interface related\r\n  ---------------------------------------------------------------------}\r\nfunction Supports(const Instance: IInterface; const AClass: TClass; out Obj\r\n  ): Boolean;\r\nbegin\r\n  Result := (Instance<>nil) and (Instance.QueryInterface(IObjectInstance,Obj)=S_OK)\r\n     and (TObject(Obj).InheritsFrom(AClass));\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGUID; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and (Instance.QueryInterface(IID,Intf)=S_OK);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGUID; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterface(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString; out Intf\r\n  ): Boolean;\r\nbegin\r\n  Result:=(Instance<>nil) and Instance.GetInterfaceByStr(IID,Intf);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const AClass: TClass): Boolean;\r\nvar\r\n  Temp: TObject;\r\nbegin\r\n  Result:=Supports(Instance,AClass,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: IInterface; const IID: TGUID): Boolean;\r\nvar\r\n  Temp: IInterface;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGUID): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const Instance: TObject; const IID: TGuidString): Boolean;\r\nvar\r\n  Temp: TJSObject;\r\nbegin\r\n  Result:=Supports(Instance,IID,Temp);\r\n  asm\r\n    if (Temp && Temp.$kind==='com') Temp._Release();\r\n  end;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGUID): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[GUIDToString(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction Supports(const AClass: TClass; const IID: TGuidString): Boolean;\r\nvar\r\n  maps: JSValue;\r\nbegin\r\n  if AClass=nil then exit(false);\r\n  maps := TJSObject(AClass)['$intfmaps'];\r\n  if not maps then exit(false);\r\n  if TJSObject(maps)[uppercase(IID)] then exit(true);\r\n  Result:=false;\r\nend;\r\n\r\nfunction TryStringToGUID(const s: string; out Guid: TGUID): Boolean;\r\nvar\r\n  re: TJSRegexp;\r\nbegin\r\n  if Length(s)<>38 then Exit(False);\r\n  re:=TJSRegexp.new('^\\{[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}\\}$');\r\n  Result:=re.test(s);\r\n  if not Result then\r\n    begin\r\n    Guid.D1:=0;\r\n    exit;\r\n    end;\r\n  asm\r\n    rtl.strToGUIDR(s,Guid.get());\r\n  end;\r\n  Result:=true;\r\nend;\r\n\r\nfunction StringToGUID(const S: string): TGUID;\r\nbegin\r\n  if not TryStringToGUID(S, Result) then\r\n    raise EConvertError.CreateFmt(SInvalidGUID, [S]);\r\nend;\r\n\r\nfunction GUIDToString(const guid: TGUID): string;\r\nbegin\r\n  Result:=System.GUIDToString(guid);\r\nend;\r\n\r\nfunction IsEqualGUID(const guid1, guid2: TGUID): Boolean;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if (guid1.D1<>guid2.D1) or (guid1.D2<>guid2.D2) or (guid1.D3<>guid2.D3) then\r\n    exit(false);\r\n  for i:=0 to 7 do if guid1.D4[i]<>guid2.D4[i] then exit(false);\r\n  Result:=true;\r\nend;\r\n\r\nfunction GuidCase(const guid: TGUID; const List: array of TGuid): Integer;\r\nbegin\r\n  for Result := High(List) downto 0 do\r\n    if IsEqualGUID(guid, List[Result]) then\r\n      Exit;\r\n  Result := -1;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Integer/Ordinal related\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction TryStrToInt(const S : String; Out res : Integer) : Boolean;\r\n\r\nVar\r\n  NI : NativeInt;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,NI);\r\n  if Result then\r\n    res:=NI;\r\nend;\r\n\r\nFunction TryStrToInt(const S : String; Out res : NativeInt) : Boolean;\r\n\r\nVar\r\n  Radix : Integer = 10;\r\n  F,N : String;\r\n  J : JSValue;\r\n\r\nbegin\r\n  N:=S;\r\n  F:=Copy(N,1,1);\r\n  if (F='$') then\r\n    Radix:=16\r\n  else if (F='&') then\r\n    Radix:=8\r\n  else if (F='%') then\r\n    Radix:=2;\r\n  If Radix<>10 then\r\n    Delete(N,1,1);\r\n  J:=parseInt(N,Radix);\r\n  Result:=Not jsIsNan(j);\r\n  if Result then\r\n    res:=NativeInt(J);\r\nend;\r\n\r\nFunction StrToIntDef(const S : String; Const aDef : Integer) : Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nFunction StrToIntDef(const S : String; Const aDef : NativeInt) : NativeInt;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if TryStrToInt(S,R) then\r\n    Result:=R\r\n  else\r\n    Result:=aDef;\r\nend;\r\n\r\nFunction StrToInt(const S : String) : Integer;\r\n\r\nVar\r\n  R : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,R) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=R;\r\nend;\r\n\r\nFunction StrToNativeInt(const S : String) : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\nFunction StrToInt64(const S : String) : NativeLargeInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if not TryStrToInt(S,N) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nFunction TryStrToInt64(const S : String; Out res : NativeLargeInt) : Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nFunction StrToInt64Def(const S : String; ADefault : NativeLargeInt) : NativeLargeInt;\r\n\r\n\r\nbegin\r\n  if TryStrToInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nFunction StrToQWord(const S : String) : NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nFunction TryStrToQWord(const S : String; Out res : NativeLargeUInt) : Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nFunction StrToQWordDef(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\n\r\nbegin\r\n  if Not TryStrToQword(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\n\r\nFunction StrToUInt64(const S : String) : NativeLargeUInt;\r\n\r\nVar\r\n  N : NativeInt;\r\n\r\nbegin\r\n  if (not TryStrToInt(S,N)) or (N<0) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\n  Result:=N;\r\nend;\r\n\r\nFunction TryStrToUInt64(const S : String; Out res : NativeLargeUInt) : Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0);\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nFunction StrToUInt64Def(const S : String; ADefault : NativeLargeUInt) : NativeLargeUInt;\r\n\r\n\r\nbegin\r\n  if Not TryStrToUInt64(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\nFunction TryStrToDWord(const S : String; Out res : DWord) : Boolean;\r\n\r\nVar\r\n  R : nativeint;\r\n\r\nbegin\r\n  Result:=TryStrToInt(S,R) and (R>=0) and (R<=DWord($FFFFFFFF));\r\n  If Result then\r\n    Res:=R;\r\nend;\r\n\r\nFunction StrToDWord(const S : String) : DWord;\r\n\r\nbegin\r\n  if not TryStrToDWord(S,Result) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidInteger,[S]);\r\nend;\r\n\r\n\r\nFunction StrToDWordDef(const S : String; ADefault : DWord) : DWord;\r\n\r\nbegin\r\n  if Not TryStrToDWord(S,Result) then\r\n    Result:=ADefault;\r\nend;\r\n\r\n\r\nfunction IntToHex(Value: NativeInt; Digits: integer): string;\r\nconst\r\n  HexDigits = '0123456789ABCDEF';\r\nbegin\r\n  If Digits=0 then\r\n    Digits:=1;\r\n  Result:='';\r\n  While Value>0 do\r\n    begin\r\n    result:=HexDigits[(value and 15)+1]+Result;\r\n    value := value shr 4;\r\n    end ;\r\n  while (Length(Result)<Digits) do\r\n    Result:='0'+Result;\r\nend;\r\n\r\n{ TFormatSettings }\r\n\r\nfunction TFormatSettings.GetCurrencyDecimals: Byte;\r\nbegin\r\n  Result:=Sysutils.CurrencyDecimals;\r\nend;\r\n\r\nfunction TFormatSettings.GetCurrencyFormat: Byte;\r\nbegin\r\n  Result:=Sysutils.CurrencyFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetCurrencyString: String;\r\nbegin\r\n  Result:=Sysutils.CurrencyString;\r\nend;\r\n\r\nfunction TFormatSettings.GetDateSeparator: char;\r\nbegin\r\n  Result := SysUtils.DateSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetDecimalSeparator: string;\r\nbegin\r\n  Result := SysUtils.DecimalSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongDateFormat: string;\r\nbegin\r\n  Result := SysUtils.LongDateFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongDayNames: TDayNames;\r\nbegin\r\n  Result:=Sysutils.LongDayNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongMonthNames: TMonthNames;\r\nbegin\r\n Result:=Sysutils.LongMonthNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetLongTimeFormat: string;\r\nbegin\r\n  Result := SysUtils.LongTimeFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetNegCurrFormat: Byte;\r\nbegin\r\n  Result:=Sysutils.NegCurrFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortDateFormat: string;\r\nbegin\r\n  Result := SysUtils.ShortDateFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortDayNames: TDayNames;\r\nbegin\r\n Result:=Sysutils.ShortDayNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortMonthNames: TMonthNames;\r\nbegin\r\n Result:=Sysutils.ShortMonthNames;\r\nend;\r\n\r\nfunction TFormatSettings.GetShortTimeFormat: string;\r\nbegin\r\n  Result := SysUtils.ShortTimeFormat;\r\nend;\r\n\r\nfunction TFormatSettings.GetThousandSeparator: string;\r\nbegin\r\n  Result := SysUtils.ThousandSeparator;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimeAMString: string;\r\nbegin\r\n  Result := SysUtils.TimeAMString;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimePMString: string;\r\nbegin\r\n  Result := SysUtils.TimePMString;\r\nend;\r\n\r\nfunction TFormatSettings.GetTimeSeparator: char;\r\nbegin\r\n  Result := SysUtils.TimeSeparator;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyFormat(AValue: Byte);\r\nbegin\r\n  Sysutils.CurrencyFormat:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyString(AValue: String);\r\nbegin\r\n  Sysutils.CurrencyString:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetDateSeparator(const Value: char);\r\nbegin\r\n  SysUtils.DateSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetDecimalSeparator(const Value: string);\r\nbegin\r\n  SysUtils.DecimalSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongDateFormat(const Value: string);\r\nbegin\r\n  SysUtils.LongDateFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongDayNames(AValue: TDayNames);\r\nbegin\r\n  SysUtils.LongDayNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongMonthNames(AValue: TMonthNames);\r\nbegin\r\n  SysUtils.LongMonthNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetLongTimeFormat(const Value: string);\r\nbegin\r\n  SysUtils.LongTimeFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetNegCurrFormat(AValue: Byte);\r\nbegin\r\n  Sysutils.NegCurrFormat:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortDateFormat(const Value: string);\r\nbegin\r\n  SysUtils.ShortDateFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortDayNames(AValue: TDayNames);\r\nbegin\r\n  SysUtils.ShortDayNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortMonthNames(AValue: TMonthNames);\r\nbegin\r\n  SysUtils.ShortMonthNames:=AValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetShortTimeFormat(const Value: string);\r\nbegin\r\n  SysUtils.ShortTimeFormat := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetCurrencyDecimals(AValue: Byte);\r\nbegin\r\n  Sysutils.CurrencyDecimals:=aValue;\r\nend;\r\n\r\nprocedure TFormatSettings.SetThousandSeparator(const Value: string);\r\nbegin\r\n  SysUtils.ThousandSeparator := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimeAMString(const Value: string);\r\nbegin\r\n  SysUtils.TimeAMString := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimePMString(const Value: string);\r\nbegin\r\n  SysUtils.TimePMString := Value;\r\nend;\r\n\r\nprocedure TFormatSettings.SetTimeSeparator(const Value: char);\r\nbegin\r\n  SysUtils.TimeSeparator := Value;\r\nend;\r\n\r\n\r\ninitialization\r\n  FormatSettings := TFormatSettings.Create;\r\n  //RTLEInvalidCast:=EInvalidCast;\r\n  LongDayNames[1] := 'Sunday';\r\n  LongDayNames[2] := 'Monday';\r\n  LongDayNames[3] := 'Tuesday';\r\n  LongDayNames[4] := 'Wednesday';\r\n  LongDayNames[5] := 'Thursday';\r\n  LongDayNames[6] := 'Friday';\r\n  LongDayNames[7] := 'Saturday';\r\n  ShortDayNames[1] := 'Sun';\r\n  ShortDayNames[2] := 'Mon';\r\n  ShortDayNames[3] := 'Tue';\r\n  ShortDayNames[4] := 'Wed';\r\n  ShortDayNames[5] := 'Thu';\r\n  ShortDayNames[6] := 'Fri';\r\n  ShortDayNames[7] := 'Sat';\r\n  ShortMonthNames[1] := 'Jan';\r\n  ShortMonthNames[2] := 'Feb';\r\n  ShortMonthNames[3] := 'Mar';\r\n  ShortMonthNames[4] := 'Apr';\r\n  ShortMonthNames[5] := 'May';\r\n  ShortMonthNames[6] := 'Jun';\r\n  ShortMonthNames[7] := 'Jul';\r\n  ShortMonthNames[8] := 'Aug';\r\n  ShortMonthNames[9] := 'Sep';\r\n  ShortMonthNames[10] := 'Oct';\r\n  ShortMonthNames[11] := 'Nov';\r\n  ShortMonthNames[12] := 'Dec';\r\n  LongMonthNames[1] := 'January';\r\n  LongMonthNames[2] := 'February';\r\n  LongMonthNames[3] := 'March';\r\n  LongMonthNames[4] := 'April';\r\n  LongMonthNames[5] := 'May';\r\n  LongMonthNames[6] := 'June';\r\n  LongMonthNames[7] := 'July';\r\n  LongMonthNames[8] := 'August';\r\n  LongMonthNames[9] := 'September';\r\n  LongMonthNames[10] := 'October';\r\n  LongMonthNames[11] := 'November';\r\n  LongMonthNames[12] := 'December';\r\n  MonthDays[True][1] := 31;\r\n  MonthDays[True][2] := 29;\r\n  MonthDays[True][3] := 31;\r\n  MonthDays[True][4] := 30;\r\n  MonthDays[True][5] := 31;\r\n  MonthDays[True][6] := 30;\r\n  MonthDays[True][7] := 31;\r\n  MonthDays[True][8] := 31;\r\n  MonthDays[True][9] := 30;\r\n  MonthDays[True][10] := 31;\r\n  MonthDays[True][11] := 30;\r\n  MonthDays[True][12] := 31;\r\n  MonthDays[False][1] := 31;\r\n  MonthDays[False][2] := 28;\r\n  MonthDays[False][3] := 31;\r\n  MonthDays[False][4] := 30;\r\n  MonthDays[False][5] := 31;\r\n  MonthDays[False][6] := 30;\r\n  MonthDays[False][7] := 31;\r\n  MonthDays[False][8] := 31;\r\n  MonthDays[False][9] := 30;\r\n  MonthDays[False][10] := 31;\r\n  MonthDays[False][11] := 30;\r\n  MonthDays[False][12] := 31;\r\n  DateTimeToStrFormat[False] := 'c';\r\n  DateTimeToStrFormat[True] := 'f';\r\n  //RTLEInvalidCast := EInvalidCast;\r\n  DateSeparator := '-';\r\n  TimeSeparator := ':';\r\n  ShortDateFormat := 'yyyy-mm-dd';\r\n  LongDateFormat := 'ddd, yyyy-mm-dd';\r\n  ShortTimeFormat := 'hh:nn';\r\n  LongTimeFormat := 'hh:nn:ss';\r\n  DecimalSeparator := '.';\r\n  ThousandSeparator := ',';\r\n  TimeAMString := 'AM';\r\n  TimePMString := 'PM';\r\n  TwoDigitYearCenturyWindow:=50;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Classes;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  RTLConsts, Types, SysUtils;\r\n\r\ntype\r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n\r\n  // Notification operations :\r\n  // Observer has changed, is freed, item added to/deleted from list, custom event.\r\n  TFPObservedOperation = (ooChange,ooFree,ooAddItem,ooDeleteItem,ooCustom);\r\n\r\n  EListError = class(Exception);\r\n  EStringListError = class(EListError);\r\n  EComponentError = class(Exception);\r\n\r\n  TListAssignOp = (laCopy, laAnd, laOr, laXor, laSrcUnique, laDestUnique);\r\n  TListSortCompare = function(Item1, Item2: JSValue): Integer;\r\n  TListCallback = Types.TListCallback;\r\n  TListStaticCallback = Types.TListStaticCallback;\r\n  TAlignment = (taLeftJustify, taRightJustify, taCenter);\r\n\r\n  { TFPListEnumerator }\r\n  TFPList = Class;\r\n\r\n  TFPListEnumerator = class\r\n  private\r\n    FList: TFPList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TFPList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TFPList }\r\n\r\n  TFPList = class(TObject)\r\n  private\r\n    FList: TJSValueDynArray;\r\n    FCount: Integer;\r\n    FCapacity: Integer;\r\n    procedure CopyMove(aList: TFPList);\r\n    procedure MergeMove(aList: TFPList);\r\n    procedure DoCopy(ListA, ListB: TFPList);\r\n    procedure DoSrcUnique(ListA, ListB: TFPList);\r\n    procedure DoAnd(ListA, ListB: TFPList);\r\n    procedure DoDestUnique(ListA, ListB: TFPList);\r\n    procedure DoOr(ListA, ListB: TFPList);\r\n    procedure DoXOr(ListA, ListB: TFPList);\r\n  protected\r\n    function Get(Index: Integer): JSValue; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Put(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    procedure SetCount(NewCount: Integer);\r\n    Procedure RaiseIndexError(Index: Integer);\r\n  public\r\n    //Type\r\n    //  TDirection = (FromBeginning, FromEnd);\r\n    destructor Destroy; override;\r\n    procedure AddList(AList: TFPList);\r\n    function Add(Item: JSValue): Integer; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    procedure Clear;\r\n    procedure Delete(Index: Integer); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    class procedure Error(const Msg: string; const Data: String);\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TFPList; {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TFPListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    function IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue); {$ifdef CLASSESINLINE} inline; {$endif CLASSESINLINE}\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TFPList; AOperator: TListAssignOp=laCopy; ListB: TFPList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    procedure ForEachCall(const proc2call: TListCallback; const arg: JSValue);\r\n    procedure ForEachCall(const proc2call: TListStaticCallback; const arg: JSValue);\r\n    property Capacity: Integer read FCapacity write SetCapacity;\r\n    property Count: Integer read FCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read FList;\r\n  end;\r\n\r\n  TListNotification = (lnAdded, lnExtracted, lnDeleted);\r\n  TList = class;\r\n\r\n  { TListEnumerator }\r\n\r\n  TListEnumerator = class\r\n  private\r\n    FList: TList;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AList: TList); reintroduce;\r\n    function GetCurrent: JSValue;\r\n    function MoveNext: Boolean;\r\n    property Current: JSValue read GetCurrent;\r\n  end;\r\n\r\n  { TList }\r\n\r\n  TList = class(TObject)\r\n  private\r\n    FList: TFPList;\r\n    procedure CopyMove (aList : TList);\r\n    procedure MergeMove (aList : TList);\r\n    procedure DoCopy(ListA, ListB : TList);\r\n    procedure DoSrcUnique(ListA, ListB : TList);\r\n    procedure DoAnd(ListA, ListB : TList);\r\n    procedure DoDestUnique(ListA, ListB : TList);\r\n    procedure DoOr(ListA, ListB : TList);\r\n    procedure DoXOr(ListA, ListB : TList);\r\n  protected\r\n    function Get(Index: Integer): JSValue;\r\n    procedure Put(Index: Integer; Item: JSValue);\r\n    procedure Notify(aValue: JSValue; Action: TListNotification); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer);\r\n    function GetCapacity: integer;\r\n    procedure SetCount(NewCount: Integer);\r\n    function GetCount: integer;\r\n    function GetList: TJSValueDynArray;\r\n    property FPList : TFPList Read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Procedure AddList(AList : TList);\r\n    function Add(Item: JSValue): Integer;\r\n    procedure Clear; virtual;\r\n    procedure Delete(Index: Integer);\r\n    class procedure Error(const Msg: string; Data: String); virtual;\r\n    procedure Exchange(Index1, Index2: Integer);\r\n    function Expand: TList;\r\n    function Extract(Item: JSValue): JSValue;\r\n    function First: JSValue;\r\n    function GetEnumerator: TListEnumerator;\r\n    function IndexOf(Item: JSValue): Integer;\r\n    procedure Insert(Index: Integer; Item: JSValue);\r\n    function Last: JSValue;\r\n    procedure Move(CurIndex, NewIndex: Integer);\r\n    procedure Assign (ListA: TList; AOperator: TListAssignOp=laCopy; ListB: TList=nil);\r\n    function Remove(Item: JSValue): Integer;\r\n    procedure Pack;\r\n    procedure Sort(const Compare: TListSortCompare);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property Items[Index: Integer]: JSValue read Get write Put; default;\r\n    property List: TJSValueDynArray read GetList;\r\n  end;\r\n\r\n  { TPersistent }\r\n\r\n  TPersistent = class(TObject)\r\n  private\r\n    //FObservers : TFPList;\r\n    procedure AssignError(Source: TPersistent);\r\n  protected\r\n    procedure AssignTo(Dest: TPersistent); virtual;\r\n    function GetOwner: TPersistent; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); virtual;\r\n    //procedure FPOAttachObserver(AObserver : TObject);\r\n    //procedure FPODetachObserver(AObserver : TObject);\r\n    //procedure FPONotifyObservers(ASender : TObject; AOperation: TFPObservedOperation; Data: TObject);\r\n    function GetNamePath: string; virtual;\r\n  end;\r\n  TPersistentClass = Class of TPersistent;\r\n\r\n\r\n  { TInterfacedPersistent }\r\n\r\n  TInterfacedPersistent = class(TPersistent, IInterface)\r\n  private\r\n    FOwnerInterface: IInterface;\r\n  protected\r\n    function _AddRef: Integer;\r\n    function _Release: Integer;\r\n  public\r\n    function QueryInterface(const IID: TGUID; out Obj): integer; virtual;\r\n    procedure AfterConstruction; override;\r\n  end;\r\n\r\n  TStrings = Class;\r\n  { TStringsEnumerator class }\r\n\r\n  TStringsEnumerator = class\r\n  private\r\n    FStrings: TStrings;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AStrings: TStrings); reintroduce;\r\n    function GetCurrent: String;\r\n    function MoveNext: Boolean;\r\n    property Current: String read GetCurrent;\r\n  end;\r\n\r\n\r\n  { TStrings class }\r\n  TStrings = class(TPersistent)\r\n  private\r\n    FSpecialCharsInited : boolean;\r\n    FAlwaysQuote: Boolean;\r\n    FQuoteChar : Char;\r\n    FDelimiter : Char;\r\n    FNameValueSeparator : Char;\r\n    FUpdateCount: Integer;\r\n    FLBS : TTextLineBreakStyle;\r\n    FSkipLastLineBreak : Boolean;\r\n    FStrictDelimiter : Boolean;\r\n    FLineBreak : String;\r\n    function GetCommaText: string;\r\n    function GetName(Index: Integer): string;\r\n    function GetValue(const Name: string): string;\r\n    Function GetLBS : TTextLineBreakStyle;\r\n    Procedure SetLBS (AValue : TTextLineBreakStyle);\r\n    procedure SetCommaText(const Value: string);\r\n    procedure SetValue(const Name, Value: string);\r\n    procedure SetDelimiter(c:Char);\r\n    procedure SetQuoteChar(c:Char);\r\n    procedure SetNameValueSeparator(c:Char);\r\n    procedure DoSetTextStr(const Value: string; DoClear : Boolean);\r\n    Function GetDelimiter : Char;\r\n    Function GetNameValueSeparator : Char;\r\n    Function GetQuoteChar: Char;\r\n    Function GetLineBreak : String;\r\n    procedure SetLineBreak(const S : String);\r\n    Function GetSkipLastLineBreak : Boolean;\r\n    procedure SetSkipLastLineBreak(const AValue : Boolean);\r\n  protected\r\n    procedure Error(const Msg: string; Data: Integer);\r\n    function Get(Index: Integer): string; virtual; abstract;\r\n    function GetCapacity: Integer; virtual;\r\n    function GetCount: Integer; virtual; abstract;\r\n    function GetObject(Index: Integer): TObject; virtual;\r\n    function GetTextStr: string; virtual;\r\n    procedure Put(Index: Integer; const S: string); virtual;\r\n    procedure PutObject(Index: Integer; AObject: TObject); virtual;\r\n    procedure SetCapacity(NewCapacity: Integer); virtual;\r\n    procedure SetTextStr(const Value: string); virtual;\r\n    procedure SetUpdateState(Updating: Boolean); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; virtual;\r\n    Function GetDelimitedText: string;\r\n    Procedure SetDelimitedText(Const AValue: string);\r\n    Function GetValueFromIndex(Index: Integer): string;\r\n    Procedure SetValueFromIndex(Index: Integer; const Value: string);\r\n    Procedure CheckSpecialChars;\r\n//    Class Function GetNextLine (Const Value : String; Var S : String; Var P : Integer) : Boolean;\r\n    Function GetNextLinebreak (Const Value : String; Out S : String; Var P : Integer) : Boolean;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    function Add(const S: string): Integer; virtual; overload;\r\n//    function AddFmt(const Fmt : string; const Args : Array of const): Integer; overload;\r\n    function AddObject(const S: string; AObject: TObject): Integer; virtual; overload;\r\n//    function AddObject(const Fmt: string; Args : Array of const; AObject: TObject): Integer; overload;\r\n    procedure Append(const S: string);\r\n    procedure AddStrings(TheStrings: TStrings); overload; virtual;\r\n    procedure AddStrings(TheStrings: TStrings; ClearFirst : Boolean); overload;\r\n    procedure AddStrings(const TheStrings: array of string); overload; virtual;\r\n    procedure AddStrings(const TheStrings: array of string; ClearFirst : Boolean); overload;\r\n    function AddPair(const AName, AValue: string): TStrings; overload;\r\n    function AddPair(const AName, AValue: string; AObject: TObject): TStrings; overload;\r\n    Procedure AddText(Const S : String); virtual;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate;\r\n    procedure Clear; virtual; abstract;\r\n    procedure Delete(Index: Integer); virtual; abstract;\r\n    procedure EndUpdate;\r\n    function Equals(Obj: TObject): Boolean; override; overload;\r\n    function Equals(TheStrings: TStrings): Boolean; overload;\r\n    procedure Exchange(Index1, Index2: Integer); virtual;\r\n    function GetEnumerator: TStringsEnumerator;\r\n    function IndexOf(const S: string): Integer; virtual;\r\n    function IndexOfName(const Name: string): Integer; virtual;\r\n    function IndexOfObject(AObject: TObject): Integer; virtual;\r\n    procedure Insert(Index: Integer; const S: string); virtual; abstract;\r\n    procedure InsertObject(Index: Integer; const S: string; AObject: TObject);\r\n    procedure LoadFromFile(const FileName: string); overload; virtual;\r\n    procedure Move(CurIndex, NewIndex: Integer); virtual;\r\n    procedure GetNameValue(Index : Integer; Out AName,AValue : String);\r\n    function  ExtractName(Const S:String):String;\r\n    Property TextLineBreakStyle : TTextLineBreakStyle Read GetLBS Write SetLBS;\r\n    property Delimiter: Char read GetDelimiter write SetDelimiter;\r\n    property DelimitedText: string read GetDelimitedText write SetDelimitedText;\r\n    property LineBreak : string Read GetLineBreak write SetLineBreak;\r\n    Property StrictDelimiter : Boolean Read FStrictDelimiter Write FStrictDelimiter;\r\n    property AlwaysQuote: Boolean read FAlwaysQuote write FAlwaysQuote;\r\n    property QuoteChar: Char read GetQuoteChar write SetQuoteChar;\r\n    Property NameValueSeparator : Char Read GetNameValueSeparator Write SetNameValueSeparator;\r\n    property ValueFromIndex[Index: Integer]: string read GetValueFromIndex write SetValueFromIndex;\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property CommaText: string read GetCommaText write SetCommaText;\r\n    property Count: Integer read GetCount;\r\n    property Names[Index: Integer]: string read GetName;\r\n    property Objects[Index: Integer]: TObject read GetObject write PutObject;\r\n    property Values[const Name: string]: string read GetValue write SetValue;\r\n    property Strings[Index: Integer]: string read Get write Put; default;\r\n    property Text: string read GetTextStr write SetTextStr;\r\n    Property SkipLastLineBreak : Boolean Read GetSkipLastLineBreak Write SetSkipLastLineBreak;\r\n  end;\r\n\r\n  { TStringList}\r\n  TStringItem = record\r\n     FString: string;\r\n     FObject: TObject;\r\n   end;\r\n\r\n  TStringItemArray = Array of TStringItem;\r\n\r\n  TStringList = class;\r\n  TStringListSortCompare = function(List: TStringList; Index1, Index2: Integer): Integer;\r\n\r\n  TStringsSortStyle = (sslNone,sslUser,sslAuto);\r\n  TStringsSortStyles = Set of TStringsSortStyle;\r\n\r\n  TStringList = class(TStrings)\r\n  private\r\n    FList: TStringItemArray;\r\n    FCount: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    FOnChanging: TNotifyEvent;\r\n    FDuplicates: TDuplicates;\r\n    FCaseSensitive : Boolean;\r\n    FForceSort : Boolean;\r\n    FOwnsObjects : Boolean;\r\n    FSortStyle: TStringsSortStyle;\r\n    procedure ExchangeItemsInt(Index1, Index2: Integer);\r\n    function GetSorted: Boolean;\r\n    procedure Grow;\r\n    procedure InternalClear(FromIndex : Integer = 0; ClearOnly : Boolean = False);\r\n    procedure QuickSort(L, R: Integer; CompareFn: TStringListSortCompare);\r\n    procedure SetSorted(Value: Boolean);\r\n    procedure SetCaseSensitive(b : boolean);\r\n    procedure SetSortStyle(AValue: TStringsSortStyle);\r\n  protected\r\n    Procedure CheckIndex(AIndex : Integer);\r\n    procedure ExchangeItems(Index1, Index2: Integer); virtual;\r\n    procedure Changed; virtual;\r\n    procedure Changing; virtual;\r\n    function Get(Index: Integer): string; override;\r\n    function GetCapacity: Integer; override;\r\n    function GetCount: Integer; override;\r\n    function GetObject(Index: Integer): TObject; override;\r\n    procedure Put(Index: Integer; const S: string); override;\r\n    procedure PutObject(Index: Integer; AObject: TObject); override;\r\n    procedure SetCapacity(NewCapacity: Integer); override;\r\n    procedure SetUpdateState(Updating: Boolean); override;\r\n    procedure InsertItem(Index: Integer; const S: string); virtual;\r\n    procedure InsertItem(Index: Integer; const S: string; O: TObject); virtual;\r\n    Function DoCompareText(const s1,s2 : string) : PtrInt; override;\r\n    function CompareStrings(const s1,s2 : string) : Integer; virtual;\r\n  public\r\n    destructor Destroy; override;\r\n    function Add(const S: string): Integer; override;\r\n    procedure Clear; override;\r\n    procedure Delete(Index: Integer); override;\r\n    procedure Exchange(Index1, Index2: Integer); override;\r\n    function Find(const S: string; Out Index: Integer): Boolean; virtual;\r\n    function IndexOf(const S: string): Integer; override;\r\n    procedure Insert(Index: Integer; const S: string); override;\r\n    procedure Sort; virtual;\r\n    procedure CustomSort(CompareFn: TStringListSortCompare); virtual;\r\n    property Duplicates: TDuplicates read FDuplicates write FDuplicates;\r\n    property Sorted: Boolean read GetSorted write SetSorted;\r\n    property CaseSensitive: Boolean read FCaseSensitive write SetCaseSensitive;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnChanging: TNotifyEvent read FOnChanging write FOnChanging;\r\n    property OwnsObjects : boolean read FOwnsObjects write FOwnsObjects;\r\n    Property SortStyle : TStringsSortStyle Read FSortStyle Write SetSortStyle;\r\n  end;\r\n\r\n  TCollection = class;\r\n\r\n  { TCollectionItem }\r\n\r\n  TCollectionItem = class(TPersistent)\r\n  private\r\n    FCollection: TCollection;\r\n    FID: Integer;\r\n    FUpdateCount: Integer;\r\n    function GetIndex: Integer;\r\n  protected\r\n    procedure SetCollection(Value: TCollection);virtual;\r\n    procedure Changed(AllItems: Boolean);\r\n    function GetOwner: TPersistent; override;\r\n    function GetDisplayName: string; virtual;\r\n    procedure SetIndex(Value: Integer); virtual;\r\n    procedure SetDisplayName(const Value: string); virtual;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n  public\r\n    constructor Create(ACollection: TCollection); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    function GetNamePath: string; override;\r\n    property Collection: TCollection read FCollection write SetCollection;\r\n    property ID: Integer read FID;\r\n    property Index: Integer read GetIndex write SetIndex;\r\n    property DisplayName: string read GetDisplayName write SetDisplayName;\r\n  end;\r\n\r\n  TCollectionEnumerator = class\r\n  private\r\n    FCollection: TCollection;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(ACollection: TCollection); reintroduce;\r\n    function GetCurrent: TCollectionItem;\r\n    function MoveNext: Boolean;\r\n    property Current: TCollectionItem read GetCurrent;\r\n  end;\r\n\r\n  TCollectionItemClass = class of TCollectionItem;\r\n  TCollectionNotification = (cnAdded, cnExtracting, cnDeleting);\r\n  TCollectionSortCompare = function (Item1, Item2: TCollectionItem): Integer;\r\n\r\n  TCollection = class(TPersistent)\r\n  private\r\n    FItemClass: TCollectionItemClass;\r\n    FItems: TFpList;\r\n    FUpdateCount: Integer;\r\n    FNextID: Integer;\r\n    FPropName: string;\r\n    function GetCount: Integer;\r\n    function GetPropName: string;\r\n    procedure InsertItem(Item: TCollectionItem);\r\n    procedure RemoveItem(Item: TCollectionItem);\r\n    procedure DoClear;\r\n  protected\r\n    { Design-time editor support }\r\n    function GetAttrCount: Integer; virtual;\r\n    function GetAttr(Index: Integer): string; virtual;\r\n    function GetItemAttr(Index, ItemIndex: Integer): string; virtual;\r\n    procedure Changed;\r\n    function GetItem(Index: Integer): TCollectionItem;\r\n    procedure SetItem(Index: Integer; Value: TCollectionItem);\r\n    procedure SetItemName(Item: TCollectionItem); virtual;\r\n    procedure SetPropName; virtual;\r\n    procedure Update(Item: TCollectionItem); virtual;\r\n    procedure Notify(Item: TCollectionItem;Action: TCollectionNotification); virtual;\r\n    property PropName: string read GetPropName write FPropName;\r\n    property UpdateCount: Integer read FUpdateCount;\r\n    property FPList : TFPList Read FItems;\r\n  public\r\n    constructor Create(AItemClass: TCollectionItemClass); reintroduce;\r\n    destructor Destroy; override;\r\n    function Owner: TPersistent;\r\n    function Add: TCollectionItem;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual;\r\n    procedure Clear;\r\n    procedure EndUpdate; virtual;\r\n    procedure Delete(Index: Integer);\r\n    function GetEnumerator: TCollectionEnumerator;\r\n    function GetNamePath: string; override;\r\n    function Insert(Index: Integer): TCollectionItem;\r\n    function FindItemID(ID: Integer): TCollectionItem;\r\n    procedure Exchange(Const Index1, index2: integer);\r\n    procedure Sort(Const Compare : TCollectionSortCompare);\r\n    property Count: Integer read GetCount;\r\n    property ItemClass: TCollectionItemClass read FItemClass;\r\n    property Items[Index: Integer]: TCollectionItem read GetItem write SetItem;\r\n  end;\r\n\r\n  TOwnedCollection = class(TCollection)\r\n  private\r\n    FOwner: TPersistent;\r\n  protected\r\n    Function GetOwner: TPersistent; override;\r\n  public\r\n    Constructor Create(AOwner: TPersistent; AItemClass: TCollectionItemClass); reintroduce;\r\n  end;\r\n\r\n  TComponent = Class;\r\n\r\n  TOperation = (opInsert, opRemove);\r\n\r\n  TComponentStateItem = ( csLoading, csReading, csWriting,  csDestroying,\r\n    csDesigning, csAncestor, csUpdating, csFixups, csFreeNotification,\r\n    csInline, csDesignInstance);\r\n  TComponentState = set of TComponentStateItem;\r\n  TComponentStyleItem = (csInheritable, csCheckPropAvail, csSubComponent, csTransient);\r\n  TComponentStyle = set of TComponentStyleItem;\r\n\r\n  TGetChildProc = procedure (Child: TComponent) of object;\r\n\r\n  TComponentName = string;\r\n\r\n  { TComponentEnumerator }\r\n\r\n  TComponentEnumerator = class\r\n  private\r\n    FComponent: TComponent;\r\n    FPosition: Integer;\r\n  public\r\n    constructor Create(AComponent: TComponent); reintroduce;\r\n    function GetCurrent: TComponent;\r\n    function MoveNext: Boolean;\r\n    property Current: TComponent read GetCurrent;\r\n  end;\r\n\r\n  TComponent = class(TInterfacedPersistent)\r\n  private\r\n    FOwner: TComponent;\r\n    FName: TComponentName;\r\n    FTag: Ptrint;\r\n    FComponents: TFpList;\r\n    FFreeNotifies: TFpList;\r\n    FDesignInfo: Longint;\r\n    FComponentState: TComponentState;\r\n    function GetComponent(AIndex: Integer): TComponent;\r\n    function GetComponentCount: Integer;\r\n    function GetComponentIndex: Integer;\r\n    procedure Insert(AComponent: TComponent);\r\n    procedure Remove(AComponent: TComponent);\r\n    procedure RemoveNotification(AComponent: TComponent);\r\n    procedure SetComponentIndex(Value: Integer);\r\n  protected\r\n    FComponentStyle: TComponentStyle;\r\n    FLeft: Integer;\r\n    FTop: Integer;\r\n    procedure ChangeName(const NewName: TComponentName);\r\n    procedure GetChildren(Proc: TGetChildProc; Root: TComponent); virtual;\r\n    function GetChildOwner: TComponent; virtual;\r\n    function GetChildParent: TComponent; virtual;\r\n    function GetOwner: TPersistent; override;\r\n    function GetLeft: Integer; virtual;\r\n    function GetTop: Integer; virtual;\r\n    procedure Loaded; virtual;\r\n    procedure Loading; virtual;\r\n    procedure Notification(AComponent: TComponent;  Operation: TOperation); virtual;\r\n    procedure PaletteCreated; virtual;\r\n    procedure SetAncestor(Value: Boolean);\r\n    procedure SetDesigning(Value: Boolean; SetChildren : Boolean = True);\r\n    procedure SetDesignInstance(Value: Boolean);\r\n    procedure SetInline(Value: Boolean);\r\n    procedure SetName(const NewName: TComponentName); virtual;\r\n    procedure SetChildOrder(Child: TComponent; Order: Integer); virtual;\r\n    procedure SetLeft(AValue: Integer); virtual;\r\n    procedure SetTop(AValue: Integer); virtual;\r\n    procedure Updating; virtual;\r\n    procedure Updated; virtual;\r\n    procedure ValidateRename(AComponent: TComponent;  const CurName, NewName: string); virtual;\r\n    procedure ValidateContainer(AComponent: TComponent); virtual;\r\n    procedure ValidateInsert(AComponent: TComponent); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); virtual; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure BeforeDestruction; override;\r\n    procedure DestroyComponents;\r\n    procedure Destroying;\r\n    procedure AfterLoadDFMValues; virtual;\r\n    procedure BeforeLoadDFMValues; virtual;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n//    function ExecuteAction(Action: TBasicAction): Boolean; virtual;\r\n    function FindComponent(const AName: string): TComponent;\r\n    procedure FreeNotification(AComponent: TComponent);\r\n    procedure RemoveFreeNotification(AComponent: TComponent);\r\n    function GetNamePath: string; override;\r\n    function GetParentComponent: TComponent; virtual;\r\n    function HasParent: Boolean; virtual;\r\n    procedure InsertComponent(AComponent: TComponent);\r\n    procedure RemoveComponent(AComponent: TComponent);\r\n    procedure SetParentComponent(Value: TComponent); virtual;\r\n    procedure SetSubComponent(ASubComponent: Boolean);\r\n    function GetEnumerator: TComponentEnumerator;\r\n//    function UpdateAction(Action: TBasicAction): Boolean; dynamic;\r\n    property Components[Index: Integer]: TComponent read GetComponent;\r\n    property ComponentCount: Integer read GetComponentCount;\r\n    property ComponentIndex: Integer read GetComponentIndex write SetComponentIndex;\r\n    property ComponentState: TComponentState read FComponentState;\r\n    property ComponentStyle: TComponentStyle read FComponentStyle;\r\n    property DesignInfo: Longint read FDesignInfo write FDesignInfo;\r\n    property Owner: TComponent read FOwner;\r\n    property Left: Integer read GetLeft write SetLeft;\r\n    property Top: Integer read GetTop write SetTop;\r\n  published\r\n    property Name: TComponentName read FName write SetName stored False;\r\n    property Tag: PtrInt read FTag write FTag {default 0};\r\n  end;\r\n\r\n\r\nProcedure RegisterClass(AClass : TPersistentClass);\r\nFunction GetClass(AClassName : string) : TPersistentClass;\r\n\r\nimplementation\r\n\r\nuses\r\n  JS;\r\n\r\n\r\n{ TInterfacedPersistent }\r\n\r\nfunction TInterfacedPersistent._AddRef: Integer;\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._AddRef;\r\nend;\r\n\r\nfunction TInterfacedPersistent._Release: Integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  if Assigned(FOwnerInterface) then\r\n    Result:=FOwnerInterface._Release;\r\nend;\r\n\r\nfunction TInterfacedPersistent.QueryInterface(const IID: TGUID; out Obj): integer;\r\nbegin\r\n  Result:=E_NOINTERFACE;\r\n  if GetInterface(IID, Obj)  then\r\n    Result:=0;\r\nend;\r\n\r\nprocedure TInterfacedPersistent.AfterConstruction;\r\nbegin\r\n  inherited AfterConstruction;\r\n  if (GetOwner<>nil) then\r\n    GetOwner.GetInterface(IInterface, FOwnerInterface);\r\nend;\r\n\r\n{ TComponentEnumerator }\r\n\r\nconstructor TComponentEnumerator.Create(AComponent: TComponent);\r\nbegin\r\n  inherited Create;\r\n  FComponent := AComponent;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TComponentEnumerator.GetCurrent: TComponent;\r\nbegin\r\n  Result := FComponent.Components[FPosition];\r\nend;\r\n\r\nfunction TComponentEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FComponent.ComponentCount;\r\nend;\r\n\r\n{ TListEnumerator }\r\n\r\nconstructor TListEnumerator.Create(AList: TList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPListEnumerator }\r\n\r\nconstructor TFPListEnumerator.Create(AList: TFPList);\r\nbegin\r\n  inherited Create;\r\n  FList := AList;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TFPListEnumerator.GetCurrent: JSValue;\r\nbegin\r\n  Result := FList[FPosition];\r\nend;\r\n\r\nfunction TFPListEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FList.Count;\r\nend;\r\n\r\n{ TFPList }\r\n\r\nprocedure TFPList.CopyMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.MergeMove(aList: TFPList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TFPList.DoCopy(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoSrcUnique(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoAnd(ListA, ListB: TFPList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoDestUnique(ListA, ListB: TFPList);\r\n\r\n  procedure MoveElements(Src, Dest: TFPList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        self.Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    Dest := TFPList.Create;\r\n    try\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.DoOr(ListA, ListB: TFPList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TFPList.DoXOr(ListA, ListB: TFPList);\r\nvar\r\n  r : integer;\r\n  l : TFPList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    begin\r\n    l := TFPList.Create;\r\n    try\r\n      l.CopyMove(Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\n    end;\r\nend;\r\n\r\nfunction TFPList.Get(Index: Integer): JSValue;\r\nbegin\r\n  If (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  Result:=FList[Index];\r\nend;\r\n\r\nprocedure TFPList.Put(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index >= FCount) then\r\n    RaiseIndexError(Index);\r\n  FList[Index] := Item;\r\nend;\r\n\r\nprocedure TFPList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  If (NewCapacity < FCount) then\r\n     Error (SListCapacityError, str(NewCapacity));\r\n  if NewCapacity = FCapacity then\r\n    exit;\r\n  SetLength(FList,NewCapacity);\r\n  FCapacity := NewCapacity;\r\nend;\r\n\r\nprocedure TFPList.SetCount(NewCount: Integer);\r\nbegin\r\n  if (NewCount < 0) then\r\n    Error(SListCountError, str(NewCount));\r\n  If NewCount > FCount then\r\n    begin\r\n    If NewCount > FCapacity then\r\n      SetCapacity(NewCount);\r\n    end;\r\n  FCount := NewCount;\r\nend;\r\n\r\nprocedure TFPList.RaiseIndexError(Index: Integer);\r\nbegin\r\n  Error(SListIndexError, str(Index));\r\nend;\r\n\r\ndestructor TFPList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TFPList.AddList(AList: TFPList);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  If (Capacity<Count+AList.Count) then\r\n    Capacity:=Count+AList.Count;\r\n  For I:=0 to AList.Count-1 do\r\n    Add(AList[i]);\r\nend;\r\n\r\nfunction TFPList.Add(Item: JSValue): Integer;\r\nbegin\r\n  if FCount = FCapacity then\r\n    Expand;\r\n  FList[FCount] := Item;\r\n  Result := FCount;\r\n  Inc(FCount);\r\nend;\r\n\r\nprocedure TFPList.Clear;\r\nbegin\r\n  if Assigned(FList) then\r\n  begin\r\n    SetCount(0);\r\n    SetCapacity(0);\r\n  end;\r\nend;\r\n\r\nprocedure TFPList.Delete(Index: Integer);\r\nbegin\r\n  If (Index<0) or (Index>=FCount) then\r\n    Error (SListIndexError, str(Index));\r\n  FCount := FCount-1;\r\n  System.Delete(FList,Index,1);\r\n  Dec(FCapacity);\r\nend;\r\n\r\nclass procedure TFPList.Error(const Msg: string; const Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TFPList.Exchange(Index1, Index2: Integer);\r\nvar\r\n  Temp : JSValue;\r\nbegin\r\n  If (Index1 >= FCount) or (Index1 < 0) then\r\n    Error(SListIndexError, str(Index1));\r\n  If (Index2 >= FCount) or (Index2 < 0) then\r\n    Error(SListIndexError, str(Index2));\r\n  Temp := FList[Index1];\r\n  FList[Index1] := FList[Index2];\r\n  FList[Index2] := Temp;\r\nend;\r\n\r\nfunction TFPList.Expand: TFPList;\r\nvar\r\n  IncSize : Integer;\r\nbegin\r\n  if FCount < FCapacity then exit(self);\r\n  IncSize := 4;\r\n  if FCapacity > 3 then IncSize := IncSize + 4;\r\n  if FCapacity > 8 then IncSize := IncSize+8;\r\n  if FCapacity > 127 then Inc(IncSize, FCapacity shr 2);\r\n  SetCapacity(FCapacity + IncSize);\r\n  Result := Self;\r\nend;\r\n\r\nfunction TFPList.Extract(Item: JSValue): JSValue;\r\nvar\r\n  i : Integer;\r\nbegin\r\n  i := IndexOf(Item);\r\n  if i >= 0 then\r\n  begin\r\n    Result := Item;\r\n    Delete(i);\r\n  end\r\n  else\r\n    Result := nil;\r\nend;\r\n\r\nfunction TFPList.First: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := Nil\r\n  else\r\n    Result := Items[0];\r\nend;\r\n\r\nfunction TFPList.GetEnumerator: TFPListEnumerator;\r\nbegin\r\n  Result:=TFPListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TFPList.IndexOf(Item: JSValue): Integer;\r\n\r\nVar\r\n  C : Integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  C:=Count;\r\n  while (Result<C) and (FList[Result]<>Item) do\r\n    Inc(Result);\r\n  If Result>=C then\r\n    Result:=-1;\r\n\r\nend;\r\n\r\nfunction TFPList.IndexOfItem(Item: JSValue; Direction: TDirection): Integer;\r\n\r\nbegin\r\n  if Direction=fromBeginning then\r\n    Result:=IndexOf(Item)\r\n  else\r\n    begin\r\n    Result:=Count-1;\r\n    while (Result >=0) and (Flist[Result]<>Item) do\r\n      Result:=Result - 1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TFPList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  if (Index < 0) or (Index > FCount )then\r\n    Error(SlistIndexError, str(Index));\r\n  TJSArray(FList).splice(Index, 0, Item);\r\n  inc(FCapacity);\r\n  inc(FCount);\r\nend;\r\n\r\nfunction TFPList.Last: JSValue;\r\nbegin\r\n  If FCount = 0 then\r\n    Result := nil\r\n  else\r\n    Result := Items[FCount - 1];\r\nend;\r\n\r\nprocedure TFPList.Move(CurIndex, NewIndex: Integer);\r\nvar\r\n  Temp: JSValue;\r\nbegin\r\n  if (CurIndex < 0) or (CurIndex > Count - 1) then\r\n    Error(SListIndexError, str(CurIndex));\r\n  if (NewIndex < 0) or (NewIndex > Count -1) then\r\n    Error(SlistIndexError, str(NewIndex));\r\n  if CurIndex=NewIndex then exit;\r\n  Temp:=FList[CurIndex];\r\n  // ToDo: use TJSArray.copyWithin if available\r\n  TJSArray(FList).splice(CurIndex,1);\r\n  TJSArray(FList).splice(NewIndex,0,Temp);\r\nend;\r\n\r\nprocedure TFPList.Assign(ListA: TFPList; AOperator: TListAssignOp;\r\n  ListB: TFPList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TFPList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  If Result <> -1 then\r\n    Delete(Result);\r\nend;\r\n\r\nprocedure TFPList.Pack;\r\nvar\r\n  Dst, i: Integer;\r\n  V: JSValue;\r\nbegin\r\n  Dst:=0;\r\n  for i:=0 to Count-1 do\r\n    begin\r\n    V:=FList[i];\r\n    if not Assigned(V) then continue;\r\n    FList[Dst]:=V;\r\n    inc(Dst);\r\n    end;\r\nend;\r\n\r\n// Needed by Sort method.\r\n\r\nProcedure QuickSort(aList: TJSValueDynArray; L, R : Longint;\r\n                    const Compare: TListSortCompare);\r\nvar\r\n  I, J : Longint;\r\n  P, Q : JSValue;\r\nbegin\r\n  repeat\r\n    I := L;\r\n    J := R;\r\n    P := aList[ (L + R) div 2 ];\r\n    repeat\r\n      while Compare(P, aList[i]) > 0 do\r\n        I := I + 1;\r\n      while Compare(P, aList[J]) < 0 do\r\n        J := J - 1;\r\n      If I <= J then\r\n      begin\r\n        Q := aList[I];\r\n        aList[I] := aList[J];\r\n        aList[J] := Q;\r\n        I := I + 1;\r\n        J := J - 1;\r\n      end;\r\n    until I > J;\r\n    // sort the smaller range recursively\r\n    // sort the bigger range via the loop\r\n    // Reasons: memory usage is O(log(n)) instead of O(n) and loop is faster than recursion\r\n    if J - L < R - I then\r\n    begin\r\n      if L < J then\r\n        QuickSort(aList, L, J, Compare);\r\n      L := I;\r\n    end\r\n    else\r\n    begin\r\n      if I < R then\r\n        QuickSort(aList, I, R, Compare);\r\n      R := J;\r\n    end;\r\n  until L >= R;\r\nend;\r\n\r\nprocedure TFPList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  if Not Assigned(FList) or (FCount < 2) then exit;\r\n  QuickSort(Flist, 0, FCount-1, Compare);\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListCallback; const arg: JSValue\r\n  );\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\nprocedure TFPList.ForEachCall(const proc2call: TListStaticCallback;\r\n  const arg: JSValue);\r\nvar\r\n  i : integer;\r\n  v : JSValue;\r\nbegin\r\n  For I:=0 To Count-1 Do\r\n    begin\r\n      v:=FList[i];\r\n      if Assigned(v) then\r\n        proc2call(v,arg);\r\n    end;\r\nend;\r\n\r\n{ TList }\r\n\r\nprocedure TList.CopyMove(aList: TList);\r\nvar\r\n  r : integer;\r\nbegin\r\n  Clear;\r\n  for r := 0 to aList.count-1 do\r\n    Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.MergeMove(aList: TList);\r\nvar r : integer;\r\nbegin\r\n  For r := 0 to aList.count-1 do\r\n    if IndexOf(aList[r]) < 0 then\r\n      Add(aList[r]);\r\nend;\r\n\r\nprocedure TList.DoCopy(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    CopyMove(ListB)\r\n  else\r\n    CopyMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoSrcUnique(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) >= 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoAnd(ListA, ListB: TList);\r\nvar r : integer;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) >= 0 then\r\n        Add(ListA[r]);\r\n    end\r\n  else\r\n    begin\r\n    for r := Count-1 downto 0 do\r\n      if ListA.IndexOf(Self[r]) < 0 then\r\n        Delete(r);\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoDestUnique(ListA, ListB: TList);\r\n\r\n  procedure MoveElements(Src, Dest : TList);\r\n  var r : integer;\r\n  begin\r\n    Clear;\r\n    for r := 0 to Src.Count-1 do\r\n      if Dest.IndexOf(Src[r]) < 0 then\r\n        Add(Src[r]);\r\n  end;\r\n\r\nvar Dest : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    MoveElements(ListB, ListA)\r\n  else\r\n    try\r\n      Dest := TList.Create;\r\n      Dest.CopyMove(Self);\r\n      MoveElements(ListA, Dest)\r\n    finally\r\n      Dest.Destroy;\r\n    end;\r\nend;\r\n\r\nprocedure TList.DoOr(ListA, ListB: TList);\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    CopyMove(ListA);\r\n    MergeMove(ListB);\r\n    end\r\n  else\r\n    MergeMove(ListA);\r\nend;\r\n\r\nprocedure TList.DoXOr(ListA, ListB: TList);\r\nvar\r\n  r : integer;\r\n  l : TList;\r\nbegin\r\n  if Assigned(ListB) then\r\n    begin\r\n    Clear;\r\n    for r := 0 to ListA.Count-1 do\r\n      if ListB.IndexOf(ListA[r]) < 0 then\r\n        Add(ListA[r]);\r\n    for r := 0 to ListB.Count-1 do\r\n      if ListA.IndexOf(ListB[r]) < 0 then\r\n        Add(ListB[r]);\r\n    end\r\n  else\r\n    try\r\n      l := TList.Create;\r\n      l.CopyMove (Self);\r\n      for r := Count-1 downto 0 do\r\n        if listA.IndexOf(Self[r]) >= 0 then\r\n          Delete(r);\r\n      for r := 0 to ListA.Count-1 do\r\n        if l.IndexOf(ListA[r]) < 0 then\r\n          Add(ListA[r]);\r\n    finally\r\n      l.Destroy;\r\n    end;\r\nend;\r\n\r\nfunction TList.Get(Index: Integer): JSValue;\r\nbegin\r\n  Result := FList.Get(Index);\r\nend;\r\n\r\nprocedure TList.Put(Index: Integer; Item: JSValue);\r\nvar V : JSValue;\r\nbegin\r\n  V := Get(Index);\r\n  FList.Put(Index, Item);\r\n  if Assigned(V) then\r\n    Notify(V, lnDeleted);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Notify(aValue: JSValue; Action: TListNotification);\r\nbegin\r\n  if Assigned(aValue) then ;\r\n  if Action=lnExtracted then ;\r\nend;\r\n\r\nprocedure TList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.SetCapacity(NewCapacity);\r\nend;\r\n\r\nfunction TList.GetCapacity: integer;\r\nbegin\r\n  Result := FList.Capacity;\r\nend;\r\n\r\nprocedure TList.SetCount(NewCount: Integer);\r\nbegin\r\n  if NewCount < FList.Count then\r\n    while FList.Count > NewCount do\r\n      Delete(FList.Count - 1)\r\n  else\r\n    FList.SetCount(NewCount);\r\nend;\r\n\r\nfunction TList.GetCount: integer;\r\nbegin\r\n  Result := FList.Count;\r\nend;\r\n\r\nfunction TList.GetList: TJSValueDynArray;\r\nbegin\r\n  Result := FList.List;\r\nend;\r\n\r\nconstructor TList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList := TFPList.Create;\r\nend;\r\n\r\ndestructor TList.Destroy;\r\nbegin\r\n  if Assigned(FList) then\r\n    Clear;\r\n  FreeAndNil(FList);\r\nend;\r\n\r\nprocedure TList.AddList(AList: TList);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  { this only does FList.AddList(AList.FList), avoiding notifications }\r\n  FList.AddList(AList.FList);\r\n\r\n  { make lnAdded notifications }\r\n  for I := 0 to AList.Count - 1 do\r\n    if Assigned(AList[I]) then\r\n      Notify(AList[I], lnAdded);\r\nend;\r\n\r\nfunction TList.Add(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.Add(Item);\r\n  if Assigned(Item) then\r\n    Notify(Item, lnAdded);\r\nend;\r\n\r\nprocedure TList.Clear;\r\nbegin\r\n  While (FList.Count>0) do\r\n    Delete(Count-1);\r\nend;\r\n\r\nprocedure TList.Delete(Index: Integer);\r\n\r\nvar V : JSValue;\r\n\r\nbegin\r\n  V:=FList.Get(Index);\r\n  FList.Delete(Index);\r\n  if assigned(V) then\r\n    Notify(V, lnDeleted);\r\nend;\r\n\r\nclass procedure TList.Error(const Msg: string; Data: String);\r\nbegin\r\n  Raise EListError.CreateFmt(Msg,[Data]);\r\nend;\r\n\r\nprocedure TList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nfunction TList.Expand: TList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nfunction TList.Extract(Item: JSValue): JSValue;\r\nvar c : integer;\r\nbegin\r\n  c := FList.Count;\r\n  Result := FList.Extract(Item);\r\n  if c <> FList.Count then\r\n    Notify (Result, lnExtracted);\r\nend;\r\n\r\nfunction TList.First: JSValue;\r\nbegin\r\n  Result := FList.First;\r\nend;\r\n\r\nfunction TList.GetEnumerator: TListEnumerator;\r\nbegin\r\n  Result:=TListEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TList.IndexOf(Item: JSValue): Integer;\r\nbegin\r\n  Result := FList.IndexOf(Item);\r\nend;\r\n\r\nprocedure TList.Insert(Index: Integer; Item: JSValue);\r\nbegin\r\n  FList.Insert(Index, Item);\r\n  if Assigned(Item) then\r\n    Notify(Item,lnAdded);\r\nend;\r\n\r\nfunction TList.Last: JSValue;\r\nbegin\r\n  Result := FList.Last;\r\nend;\r\n\r\nprocedure TList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nprocedure TList.Assign(ListA: TList; AOperator: TListAssignOp; ListB: TList);\r\nbegin\r\n  case AOperator of\r\n    laCopy      : DoCopy (ListA, ListB);      // replace dest with src\r\n    laSrcUnique : DoSrcUnique (ListA, ListB); // replace dest with src that are not in dest\r\n    laAnd       : DoAnd (ListA, ListB);       // remove from dest that are not in src\r\n    laDestUnique: DoDestUnique (ListA, ListB);// remove from dest that are in src\r\n    laOr        : DoOr (ListA, ListB);        // add to dest from src and not in dest\r\n    laXOr       : DoXOr (ListA, ListB);       // add to dest from src and not in dest, remove from dest that are in src\r\n  end;\r\nend;\r\n\r\nfunction TList.Remove(Item: JSValue): Integer;\r\nbegin\r\n  Result := IndexOf(Item);\r\n  if Result <> -1 then\r\n    Self.Delete(Result);\r\nend;\r\n\r\nprocedure TList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nprocedure TList.Sort(const Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\n{ TPersistent }\r\n\r\nprocedure TPersistent.AssignError(Source: TPersistent);\r\nvar\r\n  SourceName: String;\r\nbegin\r\n  if Source<>Nil then\r\n    SourceName:=Source.ClassName\r\n  else\r\n    SourceName:='Nil';\r\n  raise EConvertError.Create('Cannot assign a '+SourceName+' to a '+ClassName+'.');\r\nend;\r\n\r\nprocedure TPersistent.AssignTo(Dest: TPersistent);\r\nbegin\r\n  Dest.AssignError(Self);\r\nend;\r\n\r\nfunction TPersistent.GetOwner: TPersistent;\r\nbegin\r\n  Result:=nil;\r\nend;\r\n\r\nprocedure TPersistent.Assign(Source: TPersistent);\r\nbegin\r\n  If Source<>Nil then\r\n    Source.AssignTo(Self)\r\n  else\r\n    AssignError(Nil);\r\nend;\r\n\r\nfunction TPersistent.GetNamePath: string;\r\nvar\r\n  OwnerName: String;\r\n  TheOwner: TPersistent;\r\nbegin\r\n  Result:=ClassName;\r\n  TheOwner:=GetOwner;\r\n  if TheOwner<>Nil then\r\n  begin\r\n    OwnerName:=TheOwner.GetNamePath;\r\n    if OwnerName<>'' then Result:=OwnerName+'.'+Result;\r\n  end;\r\nend;\r\n\r\n{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{****************************************************************************}\r\n{*                        TStringsEnumerator                                *}\r\n{****************************************************************************}\r\n\r\nconstructor TStringsEnumerator.Create(AStrings: TStrings);\r\nbegin\r\n  inherited Create;\r\n  FStrings := AStrings;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TStringsEnumerator.GetCurrent: String;\r\nbegin\r\n  Result := FStrings[FPosition];\r\nend;\r\n\r\nfunction TStringsEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FStrings.Count;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TStrings                                     *}\r\n{****************************************************************************}\r\n\r\n// Function to quote text. Should move maybe to sysutils !!\r\n// Also, it is not clear at this point what exactly should be done.\r\n\r\n{ //!! is used to mark unsupported things. }\r\n\r\n(*\r\nFunction QuoteString (Const S : String; Const Quote : String) : String;\r\nVar\r\n  I,J : Integer;\r\nbegin\r\n  J:=0;\r\n  Result:=S;\r\n  for i:=1 to length(s) do\r\n   begin\r\n     inc(j);\r\n     if S[i]=Quote then\r\n      begin\r\n        Insert(Quote,Result,J);\r\n        inc(j);\r\n      end;\r\n   end;\r\n  Result:=Quote+Result+Quote;\r\nend;\r\n*)\r\n\r\n{\r\n  For compatibility we can't add a Constructor to TSTrings to initialize\r\n  the special characters. Therefore we add a routine which is called whenever\r\n  the special chars are needed.\r\n}\r\n\r\nProcedure Tstrings.CheckSpecialChars;\r\n\r\nbegin\r\n  If Not FSpecialCharsInited then\r\n    begin\r\n    FQuoteChar:='\"';\r\n    FDelimiter:=',';\r\n    FNameValueSeparator:='=';\r\n    FLBS:=DefaultTextLineBreakStyle;\r\n    FSpecialCharsInited:=true;\r\n    FLineBreak:=sLineBreak;\r\n    end;\r\nend;\r\n\r\nFunction TStrings.GetSkipLastLineBreak : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FSkipLastLineBreak;\r\nend;\r\n\r\nprocedure TStrings.SetSkipLastLineBreak(const AValue : Boolean);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSkipLastLineBreak:=AValue;\r\nend;\r\n\r\nFunction TStrings.GetLBS : TTextLineBreakStyle;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLBS;\r\nend;\r\n\r\nProcedure TStrings.SetLBS (AValue : TTextLineBreakStyle);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLBS:=AValue;\r\nend;\r\n\r\nprocedure TStrings.SetDelimiter(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FDelimiter:=c;\r\nend;\r\n\r\nFunction TStrings.GetDelimiter : Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FDelimiter;\r\nend;\r\n\r\nprocedure TStrings.SetLineBreak(Const S : String);\r\nbegin\r\n  CheckSpecialChars;\r\n  FLineBreak:=S;\r\nend;\r\n\r\nFunction TStrings.GetLineBreak : String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FLineBreak;\r\nend;\r\n\r\n\r\nprocedure TStrings.SetQuoteChar(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FQuoteChar:=c;\r\nend;\r\n\r\nFunction TStrings.GetQuoteChar :Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FQuoteChar;\r\nend;\r\n\r\nprocedure TStrings.SetNameValueSeparator(c:Char);\r\nbegin\r\n  CheckSpecialChars;\r\n  FNameValueSeparator:=c;\r\nend;\r\n\r\nFunction TStrings.GetNameValueSeparator :Char;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=FNameValueSeparator;\r\nend;\r\n\r\n\r\nfunction TStrings.GetCommaText: string;\r\n\r\nVar\r\n  C1,C2 : Char;\r\n  FSD : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  FSD:=StrictDelimiter;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  StrictDelimiter:=False;\r\n  Try\r\n    Result:=GetDelimitedText;\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n    StrictDelimiter:=FSD;\r\n  end;\r\nend;\r\n\r\n\r\nFunction TStrings.GetDelimitedText: string;\r\n\r\nVar\r\n  I: integer;\r\n  RE : string;\r\n  S : String;\r\n  doQuote : Boolean;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  result:='';\r\n  RE:=QuoteChar+'|'+Delimiter;\r\n  if not StrictDelimiter then\r\n    RE:=' |'+RE;\r\n  RE:='/'+RE+'/';\r\n  // Check for break characters and quote if required.\r\n  For i:=0 to count-1 do\r\n    begin\r\n    S:=Strings[i];\r\n    doQuote:=FAlwaysQuote or (TJSString(s).search(RE)=-1);\r\n    if DoQuote then\r\n      Result:=Result+QuoteString(S,QuoteChar)\r\n    else\r\n      Result:=Result+S;\r\n    if I<Count-1 then\r\n      Result:=Result+Delimiter;\r\n    end;\r\n  // Quote empty string:\r\n  If (Length(Result)=0) and (Count=1) then\r\n    Result:=QuoteChar+QuoteChar;\r\nend;\r\n\r\nprocedure TStrings.GetNameValue(Index : Integer; Out AName,AValue : String);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  AValue:=Strings[Index];\r\n  L:=Pos(FNameValueSeparator,AValue);\r\n  If L<>0 then\r\n    begin\r\n    AName:=Copy(AValue,1,L-1);\r\n    //    System.Delete(AValue,1,L);\r\n    AValue:=Copy(AValue,L+1,length(AValue)-L);\r\n    end\r\n  else\r\n    AName:='';\r\nend;\r\n\r\nfunction TStrings.ExtractName(const s:String):String;\r\nvar\r\n  L: Longint;\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=Pos(FNameValueSeparator,S);\r\n  If L<>0 then\r\n    Result:=Copy(S,1,L-1)\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nfunction TStrings.GetName(Index: Integer): string;\r\n\r\nVar\r\n  V : String;\r\n\r\nbegin\r\n  GetNameValue(Index,Result,V);\r\nend;\r\n\r\nFunction TStrings.GetValue(const Name: string): string;\r\n\r\nVar\r\n  L : longint;\r\n  N : String;\r\n\r\nbegin\r\n  Result:='';\r\n  L:=IndexOfName(Name);\r\n  If L<>-1 then\r\n    GetNameValue(L,N,Result);\r\nend;\r\n\r\nFunction TStrings.GetValueFromIndex(Index: Integer): string;\r\n\r\nVar\r\n  N : String;\r\n\r\nbegin\r\n  GetNameValue(Index,N,Result);\r\nend;\r\n\r\nProcedure TStrings.SetValueFromIndex(Index: Integer; const Value: string);\r\n\r\nbegin\r\n  If (Value='') then\r\n    Delete(Index)\r\n  else\r\n    begin\r\n    If (Index<0) then\r\n      Index:=Add('');\r\n    CheckSpecialChars;\r\n    Strings[Index]:=GetName(Index)+FNameValueSeparator+Value;\r\n    end;\r\nend;\r\n\r\nProcedure TStrings.SetDelimitedText(const AValue: string);\r\nvar i,j:integer;\r\n    aNotFirst:boolean;\r\nbegin\r\n CheckSpecialChars;\r\n BeginUpdate;\r\n\r\n i:=1;\r\n j:=1;\r\n aNotFirst:=false;\r\n\r\n { Paraphrased from Delphi XE2 help:\r\n Strings must be separated by Delimiter characters or spaces.\r\n They may be enclosed in QuoteChars.\r\n QuoteChars in the string must be repeated to distinguish them from the QuoteChars enclosing the string.\r\n }\r\n try\r\n  Clear;\r\n  If StrictDelimiter then\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end\r\n  else\r\n    begin\r\n    while i<=length(AValue) do begin\r\n     // skip delimiter\r\n     if aNotFirst and (i<=length(AValue)) and (AValue[i]=FDelimiter) then inc(i);\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     // read next string\r\n     if i<=length(AValue) then begin\r\n      if AValue[i]=FQuoteChar then begin\r\n       // next string is quoted\r\n       j:=i+1;\r\n       while (j<=length(AValue)) and\r\n             ( (AValue[j]<>FQuoteChar) or\r\n               ( (j+1<=length(AValue)) and (AValue[j+1]=FQuoteChar) ) ) do begin\r\n        if (j<=length(AValue)) and (AValue[j]=FQuoteChar) then inc(j,2)\r\n                                                          else inc(j);\r\n       end;\r\n       // j is position of closing quote\r\n       Add( StringReplace (Copy(AValue,i+1,j-i-1),\r\n                           FQuoteChar+FQuoteChar,FQuoteChar, [rfReplaceAll]));\r\n       i:=j+1;\r\n      end else begin\r\n       // next string is not quoted; read until control character/space/delimiter\r\n       j:=i;\r\n       while (j<=length(AValue)) and\r\n             (Ord(AValue[j])>Ord(' ')) and\r\n             (AValue[j]<>FDelimiter) do inc(j);\r\n       Add( Copy(AValue,i,j-i));\r\n       i:=j;\r\n      end;\r\n     end else begin\r\n      if aNotFirst then Add('');\r\n     end;\r\n\r\n     // skip spaces\r\n     while (i<=length(AValue)) and (Ord(AValue[i])<=Ord(' ')) do inc(i);\r\n\r\n     aNotFirst:=true;\r\n    end;\r\n    end;\r\n finally\r\n   EndUpdate;\r\n end;\r\nend;\r\n\r\nProcedure TStrings.SetCommaText(const Value: string);\r\n\r\nVar\r\n  C1,C2 : Char;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  C1:=Delimiter;\r\n  C2:=QuoteChar;\r\n  Delimiter:=',';\r\n  QuoteChar:='\"';\r\n  Try\r\n    SetDelimitedText(Value);\r\n  Finally\r\n    Delimiter:=C1;\r\n    QuoteChar:=C2;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.SetValue(const Name, Value: string);\r\n\r\nVar L : longint;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  L:=IndexOfName(Name);\r\n  if L=-1 then\r\n   Add (Name+FNameValueSeparator+Value)\r\n  else\r\n   Strings[L]:=Name+FNameValueSeparator+value;\r\nend;\r\n\r\n\r\nProcedure TStrings.Error(const Msg: string; Data: Integer);\r\nbegin\r\n  Raise EStringListError.CreateFmt(Msg,[IntToStr(Data)]);\r\nend;\r\n\r\nFunction TStrings.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  if Index=0 then ;\r\n  Result:=Nil;\r\nend;\r\n\r\nFunction TStrings.GetTextStr: string;\r\n\r\nVar\r\n  I : Longint;\r\n  S,NL : String;\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  // Determine needed place\r\n  if FLineBreak<>sLineBreak then\r\n    NL:=FLineBreak\r\n  else\r\n    Case FLBS of\r\n      tlbsLF   : NL:=#10;\r\n      tlbsCRLF : NL:=#13#10;\r\n      tlbsCR   : NL:=#13;\r\n    end;\r\n  Result:='';\r\n  For i:=0 To count-1 do\r\n    begin\r\n    S:=Strings[I];\r\n    Result:=Result+S;\r\n    if (I<Count-1) or Not SkipLastLineBreak then\r\n      Result:=Result+NL;\r\n    end;\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.Put(Index: Integer; const S: string);\r\n\r\nVar Obj : TObject;\r\n\r\nbegin\r\n  Obj:=Objects[Index];\r\n  Delete(Index);\r\n  InsertObject(Index,S,Obj);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  // Empty.\r\n  if Index=0 then exit;\r\n  if AObject=nil then exit;\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  // Empty.\r\n  if NewCapacity=0 then ;\r\nend;\r\n\r\nFunction TStrings.GetNextLineBreak (Const Value : String; Out S : String; Var P : Integer) : Boolean;\r\n\r\nVar\r\n  PP : Integer;\r\n\r\nbegin\r\n  S:='';\r\n  Result:=False;\r\n  If ((Length(Value)-P)<0) then\r\n    exit;\r\n  PP:=TJSString(Value).IndexOf(LineBreak,P-1)+1;\r\n  if (PP<1) then\r\n    PP:=Length(Value)+1;\r\n  S:=Copy(Value,P,PP-P);\r\n  P:=PP+length(LineBreak);\r\n  Result:=True;\r\nend;\r\n\r\nProcedure TStrings.DoSetTextStr(const Value: string; DoClear : Boolean);\r\n\r\nVar\r\n  S : String;\r\n  P : Integer;\r\n\r\nbegin\r\n  Try\r\n    BeginUpdate;\r\n    if DoClear then\r\n      Clear;\r\n    P:=1;\r\n    While GetNextLineBreak (Value,S,P) do\r\n      Add(S);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.SetTextStr(const Value: string);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(Value,True);\r\nend;\r\n\r\nProcedure TStrings.AddText(const S: string);\r\n\r\nbegin\r\n  CheckSpecialChars;\r\n  DoSetTextStr(S,False);\r\nend;\r\n\r\nProcedure TStrings.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  // FPONotifyObservers(Self,ooChange,Nil);\r\n  if Updating then ;\r\nend;\r\n\r\n\r\n\r\ndestructor TSTrings.Destroy;\r\n\r\nbegin\r\n  inherited destroy;\r\nend;\r\n\r\n\r\nconstructor TStrings.Create;\r\nbegin\r\n  inherited Create;\r\n  FAlwaysQuote:=False;\r\nend;\r\n\r\nFunction TStrings.Add(const S: string): Integer;\r\n\r\nbegin\r\n  Result:=Count;\r\n  Insert (Count,S);\r\nend;\r\n\r\n(*\r\nfunction TStrings.AddFmt(const Fmt : string; const Args : Array of const): Integer;\r\n\r\nbegin\r\n  Result:=Add(Format(Fmt,Args));\r\nend;\r\n*)\r\n\r\nFunction TStrings.AddObject(const S: string; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=Add(S);\r\n  Objects[result]:=AObject;\r\nend;\r\n\r\n(*\r\nfunction TStrings.AddObject(const Fmt: string; Args : Array of const; AObject: TObject): Integer;\r\n\r\nbegin\r\n  Result:=AddObject(Format(Fmt,Args),AObject);\r\nend;\r\n*)\r\n\r\nProcedure TStrings.Append(const S: string);\r\n\r\nbegin\r\n  Add (S);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.AddStrings(TheStrings: TStrings; ClearFirst : Boolean);\r\n\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nProcedure TStrings.AddStrings(TheStrings: TStrings);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  For Runner:=0 to TheStrings.Count-1 do\r\n    self.AddObject (Thestrings[Runner],TheStrings.Objects[Runner]);\r\nend;\r\n\r\nProcedure TStrings.AddStrings(const TheStrings: array of string);\r\n\r\nVar Runner : longint;\r\nbegin\r\n  if Count + High(TheStrings)+1 > Capacity then\r\n    Capacity := Count + High(TheStrings)+1;\r\n  For Runner:=Low(TheStrings) to High(TheStrings) do\r\n    self.Add(Thestrings[Runner]);\r\nend;\r\n\r\n\r\nProcedure TStrings.AddStrings(const TheStrings: array of string; ClearFirst : Boolean);\r\n\r\nbegin\r\n  beginupdate;\r\n  try\r\n    if ClearFirst then\r\n      Clear;\r\n    AddStrings(TheStrings);\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string): TStrings;\r\n\r\nbegin\r\n  Result:=AddPair(AName,AValue,Nil);\r\nend;\r\n\r\nfunction TStrings.AddPair(const AName, AValue: string; AObject: TObject): TStrings;\r\n\r\nbegin\r\n  Result := Self;\r\n  AddObject(AName+NameValueSeparator+AValue, AObject);\r\nend;\r\n\r\n\r\nProcedure TStrings.Assign(Source: TPersistent);\r\n\r\nVar\r\n  S : TStrings;\r\n\r\nbegin\r\n  If Source is TStrings then\r\n    begin\r\n    S:=TStrings(Source);\r\n    BeginUpdate;\r\n    Try\r\n      clear;\r\n      FSpecialCharsInited:=S.FSpecialCharsInited;\r\n      FQuoteChar:=S.FQuoteChar;\r\n      FDelimiter:=S.FDelimiter;\r\n      FNameValueSeparator:=S.FNameValueSeparator;\r\n      FLBS:=S.FLBS;\r\n      FLineBreak:=S.FLineBreak;\r\n      AddStrings(S);\r\n    finally\r\n      EndUpdate;\r\n    end;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.BeginUpdate;\r\n\r\nbegin\r\n   if FUpdateCount = 0 then SetUpdateState(true);\r\n   inc(FUpdateCount);\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.EndUpdate;\r\n\r\nbegin\r\n  If FUpdateCount>0 then\r\n     Dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    SetUpdateState(False);\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.Equals(Obj: TObject): Boolean;\r\n\r\nbegin\r\n  if Obj is TStrings then\r\n    Result := Equals(TStrings(Obj))\r\n  else\r\n    Result := inherited Equals(Obj);\r\nend;\r\n\r\n\r\n\r\nFunction TStrings.Equals(TheStrings: TStrings): Boolean;\r\n\r\nVar Runner,Nr : Longint;\r\n\r\nbegin\r\n  Result:=False;\r\n  Nr:=Self.Count;\r\n  if Nr<>TheStrings.Count then exit;\r\n  For Runner:=0 to Nr-1 do\r\n    If Strings[Runner]<>TheStrings[Runner] then exit;\r\n  Result:=True;\r\nend;\r\n\r\n\r\n\r\nProcedure TStrings.Exchange(Index1, Index2: Integer);\r\n\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\n\r\nbegin\r\n  beginUpdate;\r\n  Try\r\n    Obj:=Objects[Index1];\r\n    Str:=Strings[Index1];\r\n    Objects[Index1]:=Objects[Index2];\r\n    Strings[Index1]:=Strings[Index2];\r\n    Objects[Index2]:=Obj;\r\n    Strings[Index2]:=Str;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nfunction TStrings.GetEnumerator: TStringsEnumerator;\r\nbegin\r\n  Result:=TStringsEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nFunction TStrings.DoCompareText(const s1,s2 : string) : PtrInt;\r\nbegin\r\n  result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOf(const S: string): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<Count) and (DoCompareText(Strings[Result],S)<>0) do Result:=Result+1;\r\n  if Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOfName(const Name: string): Integer;\r\nVar\r\n  len : longint;\r\n  S : String;\r\nbegin\r\n  CheckSpecialChars;\r\n  Result:=0;\r\n  while (Result<Count) do\r\n    begin\r\n    S:=Strings[Result];\r\n    len:=pos(FNameValueSeparator,S)-1;\r\n    if (len>=0) and (DoCompareText(Name,Copy(S,1,Len))=0) then\r\n      exit;\r\n    inc(result);\r\n    end;\r\n  result:=-1;\r\nend;\r\n\r\n\r\nFunction TStrings.IndexOfObject(AObject: TObject): Integer;\r\nbegin\r\n  Result:=0;\r\n  While (Result<count) and (Objects[Result]<>AObject) do Result:=Result+1;\r\n  If Result=Count then Result:=-1;\r\nend;\r\n\r\n\r\nProcedure TStrings.InsertObject(Index: Integer; const S: string;\r\n  AObject: TObject);\r\n\r\nbegin\r\n  Insert (Index,S);\r\n  Objects[Index]:=AObject;\r\nend;\r\n\r\nprocedure TStrings.LoadFromFile(const FileName: string);\r\nvar\r\n  a: TJSStringDynArray;\r\nbegin\r\n  a := URLToArrayOfString(FileName);\r\n  AddStrings(a, True);\r\nend;\r\n\r\nProcedure TStrings.Move(CurIndex, NewIndex: Integer);\r\nVar\r\n  Obj : TObject;\r\n  Str : String;\r\nbegin\r\n  BeginUpdate;\r\n  Try\r\n    Obj:=Objects[CurIndex];\r\n    Str:=Strings[CurIndex];\r\n    Objects[CurIndex]:=Nil; // Prevent Delete from freeing.\r\n    Delete(Curindex);\r\n    InsertObject(NewIndex,Str,Obj);\r\n  finally\r\n    EndUpdate;\r\n    end;\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TStringList                                  *}\r\n{****************************************************************************}\r\n\r\n\r\nprocedure TStringList.ExchangeItemsInt(Index1, Index2: Integer);\r\n\r\nVar\r\n  S : String;\r\n  O : TObject;\r\n\r\nbegin\r\n  S:=Flist[Index1].FString;\r\n  O:=Flist[Index1].FObject;\r\n  Flist[Index1].Fstring:=Flist[Index2].Fstring;\r\n  Flist[Index1].FObject:=Flist[Index2].FObject;\r\n  Flist[Index2].Fstring:=S;\r\n  Flist[Index2].FObject:=O;\r\nend;\r\n\r\nfunction TStringList.GetSorted: Boolean;\r\nbegin\r\n  Result:=FSortStyle in [sslUser,sslAuto];\r\nend;\r\n\r\n\r\nprocedure TStringList.ExchangeItems(Index1, Index2: Integer);\r\nbegin\r\n  ExchangeItemsInt(Index1, Index2);\r\nend;\r\n\r\n\r\nprocedure TStringList.Grow;\r\n\r\nVar\r\n  NC : Integer;\r\n\r\nbegin\r\n  NC:=Capacity;\r\n  If NC>=256 then\r\n    NC:=NC+(NC Div 4)\r\n  else if NC=0 then\r\n    NC:=4\r\n  else\r\n    NC:=NC*4;\r\n  SetCapacity(NC);\r\nend;\r\n\r\nprocedure TStringList.InternalClear(FromIndex: Integer; ClearOnly: Boolean);\r\n\r\nVar\r\n  I: Integer;\r\n\r\nbegin\r\n  if FromIndex < FCount then\r\n    begin\r\n      if FOwnsObjects then\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            begin\r\n              Flist[I].FString:='';\r\n              freeandnil(Flist[i].FObject);\r\n            end;\r\n        end\r\n      else\r\n        begin\r\n          For I:=FromIndex to FCount-1 do\r\n            Flist[I].FString:='';\r\n        end;\r\n      FCount:=FromIndex;\r\n    end;\r\n  if Not ClearOnly then\r\n    SetCapacity(0);\r\nend;\r\n\r\n\r\nprocedure TStringList.QuickSort(L, R: Integer; CompareFn: TStringListSortCompare\r\n  );\r\n\r\n\r\nvar\r\n  Pivot, vL, vR: Integer;\r\n\r\nbegin\r\n  //if ExchangeItems is override call that, else call (faster) ExchangeItemsInt\r\n\r\n  if R - L <= 1 then begin // a little bit of time saver\r\n    if L < R then\r\n      if CompareFn(Self, L, R) > 0 then\r\n        ExchangeItems(L, R);\r\n\r\n    Exit;\r\n  end;\r\n\r\n  vL := L;\r\n  vR := R;\r\n\r\n  Pivot := L + Random(R - L); // they say random is best\r\n\r\n  while vL < vR do begin\r\n    while (vL < Pivot) and (CompareFn(Self, vL, Pivot) <= 0) do\r\n      Inc(vL);\r\n\r\n    while (vR > Pivot) and (CompareFn(Self, vR, Pivot) > 0) do\r\n      Dec(vR);\r\n\r\n    ExchangeItems(vL, vR);\r\n\r\n    if Pivot = vL then // swap pivot if we just hit it from one side\r\n      Pivot := vR\r\n    else if Pivot = vR then\r\n      Pivot := vL;\r\n  end;\r\n\r\n  if Pivot - 1 >= L then\r\n    QuickSort(L, Pivot - 1, CompareFn);\r\n  if Pivot + 1 <= R then\r\n    QuickSort(Pivot + 1, R, CompareFn);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string);\r\nbegin\r\n  InsertItem(Index, S, nil);\r\nend;\r\n\r\n\r\nprocedure TStringList.InsertItem(Index: Integer; const S: string; O: TObject);\r\n\r\nVar\r\n  It : TStringItem;\r\n  \r\nbegin\r\n  Changing;\r\n  If FCount=Capacity then Grow;\r\n  it.FString:=S;\r\n  it.FObject:=O;\r\n  TJSArray(FList).Splice(Index,0,It);\r\n  Inc(FCount);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TStringList.SetSorted(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    SortStyle:=sslAuto\r\n  else\r\n    SortStyle:=sslNone\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changed;\r\n\r\nbegin\r\n  If (FUpdateCount=0) Then\r\n   begin\r\n   If Assigned(FOnChange) then\r\n     FOnchange(Self);\r\n   end;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Changing;\r\n\r\nbegin\r\n  If FUpdateCount=0 then\r\n    if Assigned(FOnChanging) then\r\n      FOnchanging(Self);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Get(Index: Integer): string;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FString;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCapacity: Integer;\r\n\r\nbegin\r\n  Result:=Length(FList);\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FCount;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.GetObject(Index: Integer): TObject;\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Result:=Flist[Index].FObject;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Put(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If Sorted then\r\n    Error(SSortedListError,0);\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FString:=S;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.PutObject(Index: Integer; AObject: TObject);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  Flist[Index].FObject:=AObject;\r\n  Changed;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetCapacity(NewCapacity: Integer);\r\n\r\nbegin\r\n  If (NewCapacity<0) then\r\n     Error (SListCapacityError,NewCapacity);\r\n  If NewCapacity<>Capacity then\r\n    SetLength(FList,NewCapacity)\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.SetUpdateState(Updating: Boolean);\r\n\r\nbegin\r\n  If Updating then\r\n    Changing\r\n  else\r\n    Changed\r\nend;\r\n\r\n\r\n\r\ndestructor TStringList.Destroy;\r\n\r\nbegin\r\n  InternalClear;\r\n  Inherited destroy;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.Add(const S: string): Integer;\r\n\r\nbegin\r\n  If Not (SortStyle=sslAuto) then\r\n    Result:=FCount\r\n  else\r\n    If Find (S,Result) then\r\n      Case DUplicates of\r\n        DupIgnore : Exit;\r\n        DupError : Error(SDuplicateString,0)\r\n      end;\r\n   InsertItem (Result,S);\r\nend;\r\n\r\nprocedure TStringList.Clear;\r\n\r\nbegin\r\n  if FCount = 0 then Exit;\r\n  Changing;\r\n  InternalClear;\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Delete(Index: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index);\r\n  Changing;\r\n  if FOwnsObjects then\r\n    FreeAndNil(Flist[Index].FObject);\r\n  TJSArray(FList).splice(Index,1);  \r\n  FList[Count-1].FString:='';\r\n  Flist[Count-1].FObject:=Nil;\r\n  Dec(FCount);\r\n  Changed;\r\nend;\r\n\r\nprocedure TStringList.Exchange(Index1, Index2: Integer);\r\n\r\nbegin\r\n  CheckIndex(Index1);\r\n  CheckIndex(Index2);\r\n  Changing;\r\n  ExchangeItemsInt(Index1,Index2);\r\n  changed;\r\nend;\r\n\r\nprocedure TStringList.SetCaseSensitive(b : boolean);\r\nbegin\r\n  if b=FCaseSensitive then\r\n    Exit;\r\n  FCaseSensitive:=b;\r\n  if FSortStyle=sslAuto then\r\n    begin\r\n    FForceSort:=True;\r\n    try\r\n      Sort;\r\n    finally\r\n      FForceSort:=False;\r\n    end;\r\n    end;\r\nend;\r\n\r\nprocedure TStringList.SetSortStyle(AValue: TStringsSortStyle);\r\nbegin\r\n  if FSortStyle=AValue then Exit;\r\n  if (AValue=sslAuto) then\r\n    Sort;\r\n  FSortStyle:=AValue;\r\nend;\r\n\r\nprocedure TStringList.CheckIndex(AIndex: Integer);\r\nbegin\r\n  If (AIndex<0) or (AIndex>=FCount) then\r\n    Error(SListIndexError,AIndex);\r\nend;\r\n\r\n\r\nfunction TStringList.DoCompareText(const s1, s2: string): PtrInt;\r\nbegin\r\n  if FCaseSensitive then\r\n    result:=CompareStr(s1,s2)\r\n  else\r\n    result:=CompareText(s1,s2);\r\nend;\r\n\r\n\r\nfunction TStringList.CompareStrings(const s1,s2 : string) : Integer;\r\nbegin\r\n  Result := DoCompareText(s1, s2);\r\nend;\r\n\r\n\r\nfunction TStringList.Find(const S: string; out Index: Integer): Boolean;\r\n\r\nvar\r\n  L, R, I: Integer;\r\n  CompareRes: PtrInt;\r\nbegin\r\n  Result := false;\r\n  Index:=-1;\r\n  if Not Sorted then\r\n    Raise EListError.Create(SErrFindNeedsSortedList);\r\n  // Use binary search.\r\n  L := 0;\r\n  R := Count - 1;\r\n  while (L<=R) do\r\n  begin\r\n    I := L + (R - L) div 2;\r\n    CompareRes := DoCompareText(S, Flist[I].FString);\r\n    if (CompareRes>0) then\r\n      L := I+1\r\n    else begin\r\n      R := I-1;\r\n      if (CompareRes=0) then begin\r\n         Result := true;\r\n         if (Duplicates<>dupAccept) then\r\n            L := I; // forces end of while loop\r\n      end;\r\n    end;\r\n  end;\r\n  Index := L;\r\nend;\r\n\r\n\r\n\r\nfunction TStringList.IndexOf(const S: string): Integer;\r\n\r\nbegin\r\n  If Not Sorted then\r\n    Result:=Inherited indexOf(S)\r\n  else\r\n    // faster using binary search...\r\n    If Not Find (S,Result) then\r\n      Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TStringList.Insert(Index: Integer; const S: string);\r\n\r\nbegin\r\n  If SortStyle=sslAuto then\r\n    Error (SSortedListError,0)\r\n  else\r\n    begin\r\n    If (Index<0) or (Index>FCount) then\r\n      Error(SListIndexError,Index); // Cannot use CheckIndex, because there >= FCount...\r\n    InsertItem (Index,S);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TStringList.CustomSort(CompareFn: TStringListSortCompare);\r\n\r\nbegin\r\n  If (FForceSort or (Not (FSortStyle=sslAuto))) and (FCount>1) then\r\n    begin\r\n    Changing;\r\n    QuickSort(0,FCount-1, CompareFn);\r\n    Changed;\r\n    end;\r\nend;\r\n\r\nfunction StringListAnsiCompare(List: TStringList; Index1, Index: Integer): Integer;\r\n\r\nbegin\r\n  Result := List.DoCompareText(List.FList[Index1].FString,\r\n                               List.FList[Index].FString);\r\nend;\r\n\r\nprocedure TStringList.Sort;\r\n\r\nbegin\r\n  CustomSort(@StringListAnsiCompare);\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TCollectionItem                              *}\r\n{****************************************************************************}\r\n\r\n\r\nfunction TCollectionItem.GetIndex: Integer;\r\n\r\nbegin\r\n  if FCollection<>nil then\r\n    Result:=FCollection.FItems.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetCollection(Value: TCollection);\r\n\r\nbegin\r\n  IF Value<>FCollection then\r\n    begin\r\n    If FCollection<>Nil then FCollection.RemoveItem(Self);\r\n    if Value<>Nil then Value.InsertItem(Self);\r\n    end;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.Changed(AllItems: Boolean);\r\n\r\nbegin\r\n If (FCollection<>Nil) and (FCollection.UpdateCount=0) then\r\n  begin\r\n  If AllItems then\r\n    FCollection.Update(Nil)\r\n  else\r\n    FCollection.Update(Self);\r\n  end;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetNamePath: string;\r\n\r\nbegin\r\n  If FCollection<>Nil then\r\n    Result:=FCollection.GetNamePath+'['+IntToStr(Index)+']'\r\n  else\r\n    Result:=ClassName;\r\nend;\r\n\r\n\r\nfunction TCollectionItem.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FCollection;\r\nend;\r\n\r\n\r\n\r\nfunction TCollectionItem.GetDisplayName: string;\r\n\r\nbegin\r\n  Result:=ClassName;\r\nend;\r\n\r\n\r\n\r\nprocedure TCollectionItem.SetIndex(Value: Integer);\r\n\r\nVar Temp : Longint;\r\n\r\nbegin\r\n  Temp:=GetIndex;\r\n  If (Temp>-1) and (Temp<>Value) then\r\n    begin\r\n    FCollection.FItems.Move(Temp,Value);\r\n    Changed(True);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollectionItem.SetDisplayName(const Value: string);\r\n\r\nbegin\r\n  Changed(False);\r\n  if Value='' then ;\r\nend;\r\n\r\n\r\n\r\nconstructor TCollectionItem.Create(ACollection: TCollection);\r\n\r\nbegin\r\n  Inherited Create;\r\n  SetCollection(ACollection);\r\nend;\r\n\r\n\r\n\r\ndestructor TCollectionItem.Destroy;\r\n\r\nbegin\r\n  SetCollection(Nil);\r\n  Inherited Destroy;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                          TCollectionEnumerator                           *}\r\n{****************************************************************************}\r\n\r\nconstructor TCollectionEnumerator.Create(ACollection: TCollection);\r\nbegin\r\n  inherited Create;\r\n  FCollection := ACollection;\r\n  FPosition := -1;\r\nend;\r\n\r\nfunction TCollectionEnumerator.GetCurrent: TCollectionItem;\r\nbegin\r\n  Result := FCollection.Items[FPosition];\r\nend;\r\n\r\nfunction TCollectionEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Inc(FPosition);\r\n  Result := FPosition < FCollection.Count;\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TCollection                                  *}\r\n{****************************************************************************}\r\n\r\nfunction TCollection.Owner: TPersistent;\r\nbegin\r\n  result:=getowner;\r\nend;\r\n\r\n\r\nfunction TCollection.GetCount: Integer;\r\n\r\nbegin\r\n  Result:=FItems.Count;\r\nend;\r\n\r\n\r\nProcedure TCollection.SetPropName;\r\n\r\n{\r\nVar\r\n  TheOwner : TPersistent;\r\n  PropList : PPropList;\r\n  I, PropCount : Integer;\r\n}\r\nbegin\r\n  FPropName:='';\r\n{\r\n  TheOwner:=GetOwner;\r\n  // TODO: This needs to wait till Mattias finishes typeinfo.\r\n  // It's normally only used in the designer so should not be a problem currently.\r\n  if (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) Then Exit;\r\n  // get information from the owner RTTI\r\n  PropCount:=GetPropList(TheOwner, PropList);\r\n  Try\r\n    For I:=0 To PropCount-1 Do\r\n      If (PropList^[i]^.PropType^.Kind=tkClass) And\r\n         (GetObjectProp(TheOwner, PropList^[i], ClassType)=Self) Then\r\n        Begin\r\n          FPropName:=PropList^[i]^.Name;\r\n          Exit;\r\n        End;\r\n  Finally\r\n    FreeMem(PropList);\r\n  End;\r\n}\r\nend;\r\n\r\n\r\nfunction TCollection.GetPropName: string;\r\n\r\n{Var\r\n  TheOwner : TPersistent;}\r\n\r\nbegin\r\n  Result:=FPropNAme;\r\n//  TheOwner:=GetOwner;\r\n//  If (Result<>'') or (TheOwner=Nil) Or (TheOwner.Classinfo=Nil) then exit;\r\n  SetPropName;\r\n  Result:=FPropName;\r\nend;\r\n\r\n\r\nprocedure TCollection.InsertItem(Item: TCollectionItem);\r\nbegin\r\n  If Not(Item Is FitemClass) then\r\n    exit;\r\n  FItems.add(Item);\r\n  Item.FCollection:=Self;\r\n  Item.FID:=FNextID;\r\n  inc(FNextID);\r\n  SetItemName(Item);\r\n  Notify(Item,cnAdded);\r\n  Changed;\r\nend;\r\n\r\n\r\nprocedure TCollection.RemoveItem(Item: TCollectionItem);\r\n\r\nVar\r\n  I : Integer;\r\n\r\nbegin\r\n  Notify(Item,cnExtracting);\r\n  I:=FItems.IndexOfItem(Item,fromEnd);\r\n  If (I<>-1) then\r\n    FItems.Delete(I);\r\n  Item.FCollection:=Nil;\r\n  Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttrCount: Integer;\r\nbegin\r\n  Result:=0;\r\nend;\r\n\r\n\r\nfunction TCollection.GetAttr(Index: Integer): string;\r\nbegin\r\n  Result:='';\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetItemAttr(Index, ItemIndex: Integer): string;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[ItemIndex]).DisplayName;\r\n  if Index=0 then ;\r\nend;\r\n\r\n\r\nfunction TCollection.GetEnumerator: TCollectionEnumerator;\r\nbegin\r\n  Result := TCollectionEnumerator.Create(Self);\r\nend;\r\n\r\n\r\nfunction TCollection.GetNamePath: string;\r\nvar o : TPersistent;\r\nbegin\r\n  o:=getowner;\r\n  if assigned(o) and (propname<>'') then\r\n     result:=o.getnamepath+'.'+propname\r\n   else\r\n     result:=classname;\r\nend;\r\n\r\n\r\nprocedure TCollection.Changed;\r\nbegin\r\n  if FUpdateCount=0 then\r\n    Update(Nil);\r\nend;\r\n\r\n\r\nfunction TCollection.GetItem(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=TCollectionItem(FItems.Items[Index]);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItem(Index: Integer; Value: TCollectionItem);\r\nbegin\r\n  TCollectionItem(FItems.items[Index]).Assign(Value);\r\nend;\r\n\r\n\r\nprocedure TCollection.SetItemName(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\nprocedure TCollection.Update(Item: TCollectionItem);\r\nbegin\r\n  if Item=nil then ;\r\nend;\r\n\r\n\r\nconstructor TCollection.Create(AItemClass: TCollectionItemClass);\r\nbegin\r\n  inherited create;\r\n  FItemClass:=AItemClass;\r\n  FItems:=TFpList.Create;\r\nend;\r\n\r\n\r\ndestructor TCollection.Destroy;\r\nbegin\r\n  FUpdateCount:=1; // Prevent OnChange\r\n  try\r\n    DoClear;\r\n  Finally\r\n    FUpdateCount:=0;\r\n  end;\r\n  if assigned(FItems) then\r\n    FItems.Destroy;\r\n  Inherited Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Add: TCollectionItem;\r\nbegin\r\n  Result:=FItemClass.Create(Self);\r\nend;\r\n\r\n\r\nprocedure TCollection.Assign(Source: TPersistent);\r\nVar I : Longint;\r\nbegin\r\n  If Source is TCollection then\r\n    begin\r\n    Clear;\r\n    For I:=0 To TCollection(Source).Count-1 do\r\n     Add.Assign(TCollection(Source).Items[I]);\r\n    exit;\r\n    end\r\n  else\r\n    Inherited Assign(Source);\r\nend;\r\n\r\n\r\nprocedure TCollection.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\n\r\nprocedure TCollection.Clear;\r\nbegin\r\n  if FItems.Count=0 then\r\n    exit; // Prevent Changed\r\n  BeginUpdate;\r\n  try\r\n    DoClear;\r\n  finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TCollection.DoClear;\r\nvar\r\n  Item: TCollectionItem;\r\nbegin\r\n  While FItems.Count>0 do\r\n    begin\r\n    Item:=TCollectionItem(FItems.Last);\r\n    if Assigned(Item) then\r\n      Item.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TCollection.EndUpdate;\r\nbegin\r\n  if FUpdateCount>0 then\r\n    dec(FUpdateCount);\r\n  if FUpdateCount=0 then\r\n    Changed;\r\nend;\r\n\r\n\r\nfunction TCollection.FindItemID(ID: Integer): TCollectionItem;\r\nVar\r\n          I : Longint;\r\nbegin\r\n  For I:=0 to Fitems.Count-1 do\r\n   begin\r\n     Result:=TCollectionItem(FItems.items[I]);\r\n     If Result.Id=Id then\r\n       exit;\r\n   end;\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nprocedure TCollection.Delete(Index: Integer);\r\nVar\r\n  Item : TCollectionItem;\r\nbegin\r\n  Item:=TCollectionItem(FItems[Index]);\r\n  Notify(Item,cnDeleting);\r\n  If assigned(Item) then\r\n    Item.Destroy;\r\nend;\r\n\r\n\r\nfunction TCollection.Insert(Index: Integer): TCollectionItem;\r\nbegin\r\n  Result:=Add;\r\n  Result.Index:=Index;\r\nend;\r\n\r\n\r\nprocedure TCollection.Notify(Item: TCollectionItem;Action: TCollectionNotification);\r\nbegin\r\n  if Item=nil then ;\r\n  if Action=cnAdded then ;\r\nend;\r\n\r\nprocedure TCollection.Sort(Const Compare : TCollectionSortCompare);\r\n\r\nbegin\r\n  BeginUpdate;\r\n  try\r\n    FItems.Sort(TListSortCompare(Compare));\r\n  Finally\r\n    EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TCollection.Exchange(Const Index1, index2: integer);\r\n\r\nbegin\r\n  FItems.Exchange(Index1,Index2);\r\nend;\r\n\r\n\r\n{****************************************************************************}\r\n{*                             TOwnedCollection                             *}\r\n{****************************************************************************}\r\n\r\n\r\n\r\nConstructor TOwnedCollection.Create(AOwner: TPersistent; AItemClass: TCollectionItemClass);\r\n\r\nBegin\r\n  FOwner := AOwner;\r\n  inherited Create(AItemClass);\r\nend;\r\n\r\nFunction TOwnedCollection.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n{****************************************************************************}\r\n{*                             TComponent                                   *}\r\n{****************************************************************************}\r\n\r\n\r\nFunction  TComponent.GetComponent(AIndex: Integer): TComponent;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    Result:=Nil\r\n  else\r\n    Result:=TComponent(FComponents.Items[Aindex]);\r\nend;\r\n\r\nFunction  TComponent.GetComponentCount: Integer;\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    result:=0\r\n  else\r\n    Result:=FComponents.Count;\r\nend;\r\n\r\n\r\nFunction  TComponent.GetComponentIndex: Integer;\r\n\r\nbegin\r\n  If Assigned(FOwner) and Assigned(FOwner.FComponents) then\r\n    Result:=FOWner.FComponents.IndexOf(Self)\r\n  else\r\n    Result:=-1;\r\nend;\r\n\r\n\r\nProcedure TComponent.Insert(AComponent: TComponent);\r\n\r\nbegin\r\n  If not assigned(FComponents) then\r\n    FComponents:=TFpList.Create;\r\n  FComponents.Add(AComponent);\r\n  AComponent.FOwner:=Self;\r\nend;\r\n\r\n\r\nProcedure TComponent.Remove(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.FOwner:=Nil;\r\n  If assigned(FCOmponents) then\r\n    begin\r\n    FComponents.Remove(AComponent);\r\n    IF FComponents.Count=0 then\r\n      begin\r\n      FComponents.Destroy;\r\n      FComponents:=Nil;\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nProcedure TComponent.RemoveNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  if FFreeNotifies<>nil then\r\n    begin\r\n    FFreeNotifies.Remove(AComponent);\r\n    if FFreeNotifies.Count=0 then\r\n      begin\r\n      FFreeNotifies.Destroy;\r\n      FFreeNotifies:=nil;\r\n      Exclude(FComponentState,csFreeNotification);\r\n      end;\r\n    end;\r\nend;\r\n\r\n\r\nProcedure TComponent.SetComponentIndex(Value: Integer);\r\n\r\nVar Temp,Count : longint;\r\n\r\nbegin\r\n  If Not assigned(Fowner) then exit;\r\n  Temp:=getcomponentindex;\r\n  If temp<0 then exit;\r\n  If value<0 then value:=0;\r\n  Count:=Fowner.FComponents.Count;\r\n  If Value>=Count then value:=count-1;\r\n  If Value<>Temp then\r\n    begin\r\n    FOWner.FComponents.Delete(Temp);\r\n    FOwner.FComponents.Insert(Value,Self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.BeginUpdate;\r\nbegin\r\n\r\nend;\r\n\r\nProcedure TComponent.ChangeName(const NewName: TComponentName);\r\n\r\nbegin\r\n  FName:=NewName;\r\nend;\r\n\r\n\r\nProcedure TComponent.GetChildren(Proc: TGetChildProc; Root: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if Proc=nil then ;\r\n  if Root=nil then ;\r\nend;\r\n\r\n\r\nFunction  TComponent.GetChildOwner: TComponent;\r\n\r\nbegin\r\n Result:=Nil;\r\nend;\r\n\r\n\r\nFunction  TComponent.GetChildParent: TComponent;\r\n\r\nbegin\r\n  Result:=Self;\r\nend;\r\n\r\n\r\nFunction  TComponent.GetNamePath: string;\r\n\r\nbegin\r\n  Result:=FName;\r\nend;\r\n\r\n\r\nFunction  TComponent.GetOwner: TPersistent;\r\n\r\nbegin\r\n  Result:=FOwner;\r\nend;\r\n\r\n\r\nfunction TComponent.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\nend;\r\n\r\nfunction TComponent.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\nend;\r\n\r\nProcedure TComponent.Loaded;\r\n\r\nbegin\r\n  Exclude(FComponentState,csLoading);\r\nend;\r\n\r\nProcedure TComponent.Loading;\r\n\r\nbegin\r\n  Include(FComponentState,csLoading);\r\nend;\r\n\r\n\r\nProcedure TComponent.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\n\r\nVar\r\n  C : Longint;\r\n\r\nbegin\r\n  If (Operation=opRemove) then\r\n    RemoveFreeNotification(AComponent);\r\n  If Not assigned(FComponents) then\r\n    exit;\r\n  C:=FComponents.Count-1;\r\n  While (C>=0) do\r\n    begin\r\n    TComponent(FComponents.Items[C]).Notification(AComponent,Operation);\r\n    Dec(C);\r\n    if C>=FComponents.Count then\r\n      C:=FComponents.Count-1;\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.PaletteCreated;\r\nbegin\r\nend;\r\n\r\n\r\n\r\nProcedure TComponent.SetAncestor(Value: Boolean);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csAncestor)\r\n  else\r\n    Exclude(FCOmponentState,csAncestor);\r\n  if Assigned(FComponents) then\r\n    For Runner:=0 To FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).SetAncestor(Value);\r\nend;\r\n\r\n\r\nProcedure TComponent.SetDesigning(Value: Boolean; SetChildren : Boolean = True);\r\n\r\nVar Runner : Longint;\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesigning)\r\n  else\r\n    Exclude(FComponentState,csDesigning);\r\n  if Assigned(FComponents) and SetChildren then\r\n    For Runner:=0 To FComponents.Count - 1 do\r\n      TComponent(FComponents.items[Runner]).SetDesigning(Value);\r\nend;\r\n\r\nProcedure TComponent.SetDesignInstance(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csDesignInstance)\r\n  else\r\n    Exclude(FComponentState,csDesignInstance);\r\nend;\r\n\r\nProcedure TComponent.SetInline(Value: Boolean);\r\n\r\nbegin\r\n  If Value then\r\n    Include(FComponentState,csInline)\r\n  else\r\n    Exclude(FComponentState,csInline);\r\nend;\r\n\r\n\r\nProcedure TComponent.SetName(const NewName: TComponentName);\r\n\r\nbegin\r\n  If FName=NewName then exit;\r\n  If (NewName<>'') and not IsValidIdent(NewName) then\r\n    Raise EComponentError.CreateFmt(SInvalidName,[NewName]);\r\n  If Assigned(FOwner) Then\r\n    FOwner.ValidateRename(Self,FName,NewName)\r\n  else\r\n    ValidateRename(Nil,FName,NewName);\r\n  ChangeName(NewName);\r\nend;\r\n\r\n\r\nProcedure TComponent.SetChildOrder(Child: TComponent; Order: Integer);\r\n\r\nbegin\r\n  // does nothing\r\n  if Child=nil then ;\r\n  if Order=0 then ;\r\nend;\r\n\r\n\r\nprocedure TComponent.SetLeft(AValue: Integer);\r\nbegin\r\n  FLeft := AValue;\r\nend;\r\n\r\nprocedure TComponent.SetTop(AValue: Integer);\r\nbegin\r\n  FTop := AValue;\r\nend;\r\n\r\nProcedure TComponent.SetParentComponent(Value: TComponent);\r\n\r\nbegin\r\n  // Does nothing\r\n  if Value=nil then ;\r\nend;\r\n\r\nProcedure TComponent.Updating;\r\n\r\nbegin\r\n  Include (FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nProcedure TComponent.Updated;\r\n\r\nbegin\r\n  Exclude(FComponentState,csUpdating);\r\nend;\r\n\r\n\r\nProcedure TComponent.ValidateRename(AComponent: TComponent;\r\n  const CurName, NewName: string);\r\n\r\nbegin\r\n//!! This contradicts the Delphi manual.\r\n  If (AComponent<>Nil) and (CompareText(CurName,NewName)<>0) and (AComponent.Owner = Self) and\r\n     (FindComponent(NewName)<>Nil) then\r\n      raise EComponentError.Createfmt(SDuplicateName,[newname]);\r\n  If (csDesigning in FComponentState) and (FOwner<>Nil) then\r\n    FOwner.ValidateRename(AComponent,Curname,Newname);\r\nend;\r\n\r\n\r\nProcedure TComponent.ValidateContainer(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateInsert(Self);\r\nend;\r\n\r\n\r\nProcedure TComponent.ValidateInsert(AComponent: TComponent);\r\n\r\nbegin\r\n  // Does nothing.\r\n  if AComponent=nil then ;\r\nend;\r\n\r\n\r\nConstructor TComponent.Create(AOwner: TComponent);\r\n\r\nbegin\r\n  FComponentStyle:=[csInheritable];\r\n  If Assigned(AOwner) then AOwner.InsertComponent(Self);\r\nend;\r\n\r\n\r\nDestructor TComponent.Destroy;\r\n\r\nVar\r\n  I : Integer;\r\n  C : TComponent;\r\n\r\nbegin\r\n  Destroying;\r\n  If Assigned(FFreeNotifies) then\r\n    begin\r\n    I:=FFreeNotifies.Count-1;\r\n    While (I>=0) do\r\n      begin\r\n      C:=TComponent(FFreeNotifies.Items[I]);\r\n      // Delete, so one component is not notified twice, if it is owned.\r\n      FFreeNotifies.Delete(I);\r\n      C.Notification (self,opRemove);\r\n      If (FFreeNotifies=Nil) then\r\n        I:=0\r\n      else if (I>FFreeNotifies.Count) then\r\n        I:=FFreeNotifies.Count;\r\n      dec(i);\r\n      end;\r\n    FreeAndNil(FFreeNotifies);\r\n    end;\r\n  DestroyComponents;\r\n  If FOwner<>Nil Then FOwner.RemoveComponent(Self);\r\n  inherited destroy;\r\nend;\r\n\r\n\r\nprocedure TComponent.AfterLoadDFMValues;\r\nbegin\r\n  EndUpdate;\r\nend;\r\n\r\nProcedure TComponent.BeforeDestruction;\r\nbegin\r\n  if not(csDestroying in FComponentstate) then\r\n    Destroying;\r\nend;\r\n\r\nprocedure TComponent.BeforeLoadDFMValues;\r\nbegin\r\n  BeginUpdate;\r\nend;\r\n\r\nProcedure TComponent.DestroyComponents;\r\n\r\nVar acomponent: TComponent;\r\n\r\nbegin\r\n  While assigned(FComponents) do\r\n    begin\r\n    aComponent:=TComponent(FComponents.Last);\r\n    Remove(aComponent);\r\n    Acomponent.Destroy;\r\n    end;\r\nend;\r\n\r\n\r\nProcedure TComponent.Destroying;\r\n\r\nVar Runner : longint;\r\n\r\nbegin\r\n  If csDestroying in FComponentstate Then Exit;\r\n  include (FComponentState,csDestroying);\r\n  If Assigned(FComponents) then\r\n    for Runner:=0 to FComponents.Count-1 do\r\n      TComponent(FComponents.Items[Runner]).Destroying;\r\nend;\r\n\r\n\r\nprocedure TComponent.EndUpdate;\r\nbegin\r\n\r\nend;\r\n\r\nFunction  TComponent.FindComponent(const AName: string): TComponent;\r\n\r\nVar I : longint;\r\n\r\nbegin\r\n  Result:=Nil;\r\n  If (AName='') or Not assigned(FComponents) then exit;\r\n  For i:=0 to FComponents.Count-1 do\r\n    if (CompareText(TComponent(FComponents[I]).Name,AName)=0) then\r\n      begin\r\n      Result:=TComponent(FComponents.Items[I]);\r\n      exit;\r\n      end;\r\nend;\r\n\r\n\r\nProcedure TComponent.FreeNotification(AComponent: TComponent);\r\n\r\nbegin\r\n  If (Owner<>Nil) and (AComponent=Owner) then exit;\r\n  If not (Assigned(FFreeNotifies)) then\r\n    FFreeNotifies:=TFpList.Create;\r\n  If FFreeNotifies.IndexOf(AComponent)=-1 then\r\n    begin\r\n    FFreeNotifies.Add(AComponent);\r\n    AComponent.FreeNotification (self);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TComponent.RemoveFreeNotification(AComponent: TComponent);\r\nbegin\r\n  RemoveNotification(AComponent);\r\n  AComponent.RemoveNotification (self);\r\nend;\r\n\r\n\r\nFunction  TComponent.GetParentComponent: TComponent;\r\n\r\nbegin\r\n  Result:=Nil;\r\nend;\r\n\r\n\r\nFunction  TComponent.HasParent: Boolean;\r\n\r\nbegin\r\n  Result:=False;\r\nend;\r\n\r\n\r\nProcedure TComponent.InsertComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  AComponent.ValidateContainer(Self);\r\n  ValidateRename(AComponent,'',AComponent.FName);\r\n  Insert(AComponent);\r\n  If csDesigning in FComponentState then\r\n    AComponent.SetDesigning(true);\r\n  Notification(AComponent,opInsert);\r\nend;\r\n\r\n\r\nProcedure TComponent.RemoveComponent(AComponent: TComponent);\r\n\r\nbegin\r\n  Notification(AComponent,opRemove);\r\n  Remove(AComponent);\r\n  Acomponent.Setdesigning(False);\r\n  ValidateRename(AComponent,AComponent.FName,'');\r\nend;\r\n\r\nprocedure TComponent.SetSubComponent(ASubComponent: Boolean);\r\nbegin\r\n  if ASubComponent then\r\n    Include(FComponentStyle, csSubComponent)\r\n  else\r\n    Exclude(FComponentStyle, csSubComponent);\r\nend;\r\n\r\nfunction TComponent.GetEnumerator: TComponentEnumerator;\r\nbegin\r\n  Result:=TComponentEnumerator.Create(Self);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n  Global routines\r\n  ---------------------------------------------------------------------}\r\n\r\nvar\r\n  ClassList : TJSObject;\r\n  \r\nProcedure RegisterClass(AClass : TPersistentClass);\r\n\r\nbegin\r\n  ClassList[AClass.ClassName]:=AClass;\r\nend;\r\n\r\nFunction GetClass(AClassName : string) : TPersistentClass;\r\n\r\nbegin\r\n  Result:=nil;\r\n  if AClassName='' then exit;\r\n  //if not ClassList.hasOwnProperty(AClassName) then exit;\r\n  Result:=TPersistentClass(ClassList[AClassName]);\r\nend;\r\n\r\ninitialization\r\n  ClassList:=TJSObject.create(nil);\r\nend.\r\n\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\nunit Web;\r\n\r\ninterface\r\n\r\nuses Types, JS;\r\n\r\nType\r\n  // Forward definitions\r\n  TJSWindow = class;\r\n  TJSDOMTokenList = class;\r\n  TJSXPathResult = CLass;\r\n  TJSNodeList = class;\r\n  TJSDocument = class;\r\n  TJSElement = class;\r\n  TJSCSSStyleSheet = Class;\r\n  TJSNodeFilter = Class;\r\n  TJSIDBObjectStore = Class;\r\n  TIDBDatabase = class;\r\n  TJSIDBRequest = class;\r\n  TJSEventTarget = class;\r\n  TJSMouseEvent = Class;\r\n  TJSWheelEvent = Class;\r\n  TJSKeyBoardEvent = class;\r\n  TJSPointerEvent = Class;\r\n  TJSUIEvent = class;\r\n  TJSTouchEvent = Class;\r\n  TJSMessageEvent = class;\r\n\r\n  TJSAttr = class external name 'Attr'\r\n  Private\r\n    fLocalName : String; external name 'localName';\r\n    fNameSpaceURI : String external name 'namespaceURI';\r\n    fPrefix : string; external name 'prefix';\r\n    fName : string; external name 'name';\r\n  public\r\n    value : JSValue;\r\n    property localName : String Read fLocalName;\r\n    property namespaceURI : string Read fNameSpaceURI;\r\n    property prefix : string read fPrefix;\r\n    property name : string Read fName;\r\n  end;\r\n\r\n\r\n  { TEventListenerEvent }\r\n\r\n  TEventListenerEvent = class external name 'EventListener_Event'\r\n  private\r\n    FTarget: TJSEventTarget; external name 'target';\r\n  public\r\n    Property target: TJSEventTarget Read FTarget;\r\n  end;\r\n\r\n  TJSEventHandler = reference to function(Event: TEventListenerEvent): boolean;\r\n\r\n  TJSEventTarget = class external name 'EventTarget'\r\n  public\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    function dispatchEvent(event : JSValue) : Boolean;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n  end;\r\n\r\n  TJSNode = class external name 'Node' (TJSEventTarget)\r\n  Private\r\n    FBaseURI : String; external name 'baseURI';\r\n    FChildNodes: TJSNodeList; external name 'childNodes';\r\n    FFirstChild : TJSNode; external name 'firstChild';\r\n    FNextSibling : TJSNode; external name 'nextSibling';\r\n    FNodeName : String; external name 'nodeName';\r\n    FNodeType : NativeInt; external name 'nodeType';\r\n    FOwnerDocument : TJSDocument; external name 'ownerDocument';\r\n    FParentElement : TJSElement; external name 'parentElement';\r\n    FParentNode : TJSNode; external name 'parentNode';\r\n    FPreviousSibling : TJSNode; external name 'previousSibling';\r\n  Public \r\n    Const\r\n      ELEMENT_NODE \t=1;\r\n      TEXT_NODE \t=3;\r\n      PROCESSING_INSTRUCTION_NODE = \t7;\r\n      COMMENT_NODE \t=8;\r\n      DOCUMENT_NODE \t=9;\r\n      DOCUMENT_TYPE_NODE \t= 10;\r\n      DOCUMENT_FRAGMENT_NODE  = 11;\r\n\r\n      DOCUMENT_POSITION_DISCONNECTED \t= 1;\r\n      DOCUMENT_POSITION_PRECEDING \t= 2;\r\n      DOCUMENT_POSITION_FOLLOWING \t= 4;\r\n      DOCUMENT_POSITION_CONTAINS \t= 8;\r\n      DOCUMENT_POSITION_CONTAINED_BY \t= 16;\r\n      DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC = 32;\r\n  Public  \r\n    nodeValue: string;\r\n    innerText : string;\r\n    textContent : string;\r\n    function appendChild(aChild : TJSNode) : TJSNode;\r\n    function cloneNode(deep:  boolean): TJSNode;\r\n    function compareDocumentPosition(aNode : TJSNode) : NativeInt;\r\n    function contains(aNode : TJSNode) : boolean;\r\n    function hasChildNodes : boolean;\r\n    function insertBefore(newNode, referenceNode : TJSNode) : TJSNode;\r\n    function isDefaultNameSpace(aNameSpaceURI : String) : Boolean;\r\n    function isEqualNode(aNode : TJSNode) : boolean;\r\n    function isSameNode(aNode : TJSNode) : boolean;\r\n    function lookupNamespaceURI(aPrefix : string) : string;\r\n    function lookupPrefix(aPrefix : string) : string;\r\n    procedure normalize;\r\n    function removeChild(aChild: TJSNode) : TJSNode;\r\n    function replaceChild(aNewChild, aOldChild : TJSNode) : TJSNode;\r\n    property baseURI : string read FBaseURI;\r\n    property childNodes : TJSNodeList read FChildNodes;\r\n    property firstChild : TJSNode Read FFirstChild;\r\n    property nextSibling : TJSNode Read FNextSibling;\r\n    property nodeName : String Read FNodeName;\r\n    property nodeType : NativeInt Read FNodeType;\r\n    property ownerDocument : TJSDocument read FOwnerDocument;    \r\n    property parentElement : TJSElement read FParentElement;\r\n    property parentNode : TJSNode read FParentNode;\r\n    property previousSibling : TJSNode Read FPreviousSibling;\r\n  end;\r\n\r\n  TJSNodeListCallBack = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList);\r\n  TJSNodeListEvent = procedure (currentValue : TJSNode; currentIndex: NativeInt; list : TJSNodeList) of object;\r\n  \r\n  TJSNodeList = class external name 'NodeList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    procedure forEach(const aCallBack : TJSNodeListCallBack);\r\n    procedure forEach(const aCallBack : TJSNodeListEvent);\r\n    function item(aIndex : NativeInt) : TJSNode;\r\n    Property length : NativeInt Read FLength;\r\n    Property Nodes [aIndex : NativeInt] : TJSNode Read item; default;\r\n  end;\r\n  \r\n  TJSNamedNodeMap = class external name 'NamedNodeMap'\r\n  Public\r\n    function getNamedItem(aName : string) : TJSAttr;\r\n    Property Attrs[aIndex : String] : TJSattr Read getNamedItem; default;\r\n  end;\r\n  \r\n  TJSHTMLCollection = class external name 'HTMLCollection'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Function item(aIndex : Integer) : TJSNode;\r\n    Function namedItem(aName : string) : TJSNode;\r\n    property Items[aIndex : Integer] : TJSNode Read item; default;\r\n    property NamedItems[aName : String] : TJSNode Read namedItem; \r\n    Property length : NativeInt Read FLength;\r\n  end;  \r\n  \r\n  TJSDOMString = String;\r\n\r\n  TDOMTokenlistCallBack = Procedure (Current : JSValue; currentIndex : NativeInt; list : TJSDOMTokenList);\r\n  \r\n  // Interface\r\n  TJSDOMTokenList = class external name 'DOMTokenList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  public\r\n    Procedure add(aToken : TJSDOMString); varargs;\r\n    Procedure remove(aToken : TJSDOMString); varargs;\r\n    function item(aIndex : NativeInt) : String;\r\n    function contains(aToken : TJSDOMString) : Boolean;\r\n    Procedure replace(aOldToken, ANewToken : TJSDOMString);\r\n    function supports(aToken : TJSDOMString) : Boolean;\r\n    function toggle(aToken : TJSDOMString) : Boolean;\r\n    // entries,keys, values\r\n    procedure forEach(const callback: TDOMTokenlistCallBack);\r\n    property length : NativeInt read FLength;\r\n  end;\r\n\r\n  TJSDOMRect = class external name 'DOMRect'\r\n  public\r\n    left,top,right,bottom,x,y,width,height : double;\r\n    {$IFDEF FIREFOX}\r\n    constructor New;\r\n    {$ENDIF}\r\n  end;\r\n  TJSClientRect = record\r\n    left,top,right,bottom : double;\r\n    {$IFDEF FIREFOX}\r\n    width, height: double;\r\n    {$ENDIF}\r\n  end;\r\n  \r\n  TJSClientRectArray = array of TJSClientRect;\r\n  \r\n  TJSElement = class external name 'Element' (TJSNode)\r\n  Private\r\n    FAttributes : TJSNamedNodeMap; external name 'attributes';\r\n    FChildElementCount : NativeInt; external name 'childElementCount';\r\n    FChildren : TJSHTMLCollection; external name 'children';\r\n    FClassList : TJSDOMTokenList; external name 'classList';\r\n    FCLientHeight : NativeInt; external name 'clientHeight';\r\n    FCLientLeft : NativeInt; external name 'clientLeft';\r\n    FCLientTop : NativeInt; external name 'clientTop';\r\n    FCLientWidth : NativeInt; external name 'clientWidth';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLocalName : string; external name 'localName';\r\n    FNameSpaceURI : String; external name 'namespaceURI';\r\n    FNextElementSibling : TJSElement; external name 'nextElementSibling';\r\n    FPreviousElementSibling : TJSElement; external name 'previousElementSibling';\r\n    FPrefix : String; external name 'prefix';\r\n    FScrollHeight : NativeInt; external name 'scrollHeight';\r\n{$IFDEF FIREFOX}\r\n    FScrollLeftMax : NativeInt; external name 'scrollLeftMax';\r\n    FScrollTopMax : NativeInt; external name 'scrollTopMax';\r\n{$endif}\r\n    FScrollWidth : NativeInt; external name 'scrollWidth';\r\n    FTagName : string; external name 'tagName';\r\n  Public\r\n    name : string;\r\n    className : string;\r\n    id : string;\r\n    innerHTML : String;\r\n    outerHTML : string;\r\n    scrollLeft : NativeInt;\r\n    scrollTop : NativeInt;\r\n    procedure append(aText : String); overload;\r\n    procedure append(aNode : TJSElement); overload;\r\n    procedure append(aText : String; aNode : TJSElement); varargs; overload;\r\n    procedure append(aNode1,aNode2: TJSElement); varargs; overload;\r\n    function getAttribute(aName : string) : string;\r\n    function getAttributeNode(aName : string) : TJSAttr;\r\n    function getAttributeNodeNS(aNameSpace, aName : string) : TJSAttr;\r\n    function getAttributeNS(aNameSpace, aName : string) : string;\r\n    function getBoundingClientRect : TJSDOMRect;\r\n    function getClientRects : TJSClientRectArray;\r\n    function getElementsByClassName(aClassName: string) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace, aTagName : String): TJSHTMLCollection;\r\n    function getElementsByTagName(aTagName : String): TJSHTMLCollection;\r\n    function hasAttribute(aName : String) : Boolean;\r\n    function hasAttributeNS(aNameSpace,aName : String) : Boolean;\r\n    function hasAttributes : Boolean;\r\n    function insertAdjacentElement(aPosition : string; aElement : TJSElement) : TJSElement;\r\n    procedure insertAdjacentHTML(aPosition,aHTML : string);\r\n    procedure insertAdjacentText(aPosition,aText : string);\r\n    function matches(aSelectorString : String) : Boolean;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure releasePointerCapture(evID : JSValue);\r\n    procedure removeAttribute(aName: string);\r\n    procedure removeAttributeNS(aNameSpace,aName: string);\r\n    function removeAttributeNode(aAttr : TJSAttr) : TJSAttr;\r\n    procedure setAttribute(aName : string; AValue : String);\r\n    function setAttributeNode(aNode: TJSAttr) : TJSAttr;\r\n    function setAttributeNodeNS(aNode: TJSAttr) : TJSAttr;\r\n    procedure setAttributeNS(aNameSpace,aName : string; AValue : String);\r\n    procedure setCapture(retargetToElement : Boolean);\r\n    procedure setPointerCapture(pointerID : JSValue);\r\n    procedure requestFullScreen;    \r\n    Property attributes : TJSNamedNodeMap read FAttributes;\r\n    Property childElementCount : NativeInt Read FChildElementCount;\r\n    Property children : TJSHTMLCollection Read FChildren;\r\n    Property classList : TJSDOMTokenList read FClassList;\r\n    property clientHeight : NativeInt read FClientHeight;\r\n    property clientLeft : NativeInt read FClientLeft;\r\n    property clientTop : NativeInt read FClientTop;\r\n    property clientWidth : NativeInt read FClientWidth;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property localName : string Read FLocalName;\r\n    property namespaceURI : String read FNameSpaceURI;\r\n    property nextElementSibling : TJSElement Read FNextElementSibling;\r\n    property previousElementSibling : TJSElement Read FPreviousElementSibling;\r\n    property prefix : String read FPrefix;\r\n    property scrollHeight : NativeInt Read FScrollHeight;\r\n{$IFDEF FIREFOX}\r\n    property scrollLeftMax  : NativeInt Read FScrollLeftMax;\r\n    property scrollTopMax  : NativeInt Read FScrollTopMax;\r\n{$ENDIF}\r\n    property scrollWidth : NativeInt Read FScrollWidth;\r\n    property tagName : String read FTagName;\r\n    Property Attrs[aName : string] : String read getAttribute write setAttribute; default;\r\n  end;\r\n   \r\n  TJSElementCreationOptions = record\r\n    named : string;\r\n  end;\r\n \r\n  TJSDocumentType = class external name 'DocumentType' (TJSNode)\r\n  private\r\n    FName : String; external name 'name';\r\n    FPublicID : String; external name 'publicId';\r\n    FSystemID : String; external name 'systemId';\r\n  public\r\n    property name : String read FName;\r\n    property publicId : String Read FPublicID;\r\n    property systemId : String read FSystemID;\r\n  end;\r\n\r\n  TJSDOMImplementation  = class external name 'DocumentImplementation'\r\n  Public  \r\n    function createDocument(aNamespaceURI, aQualifiedNameStr : String; aDocumentType : TJSDocumentType) : TJSDocument;\r\n    function createDocumentType(aQualifiedNameStr,aPublicId,aSystemId : String) : TJSDocumentType;\r\n    function createHTMLDocument(aTitle : String) : TJSDocument;\r\n  end;\r\n\r\n  TJSLocation = class external name 'Location'\r\n  Private\r\n    FOrigin : string;\r\n  Public\r\n    hash : string;\r\n    host : string;\r\n    hostname : string;\r\n    href : string;\r\n    password : string;\r\n    pathname : string;\r\n    port : string;\r\n    protocol : string;\r\n    search : string;\r\n    username : string;\r\n    procedure assign(aURL : String);\r\n    procedure reload(aForce : Boolean);\r\n    procedure replace(aURL : String);\r\n    function toString : String;\r\n    property origin : string read FOrigin;\r\n  end;\r\n  \r\n  TJSStyleSheet = class external name 'StyleSheet' (TJSEventTarget)\r\n  Private\r\n    FHRef : String; external name 'href';\r\n    FOwnerNode : TJSNode; external name 'ownerNode';\r\n    FParentStyleSheet : TJSStyleSheet; external name 'parentStyleSheet';\r\n    FTitle : String; external name 'title';\r\n    FType : String; external name 'type';\r\n  Public\r\n    disabled : String;\r\n    Property href : String read FHRef;\r\n    property ownerNode : TJSNode Read FOwnerNode;\r\n    property parentStyleSheet : TJSStyleSheet read FParentStyleSheet;\r\n    property title : string Read FTitle;\r\n    property _type : String read FType;\r\n  end;\r\n\r\n\r\n  TJSCSSRule = class external name 'CSSRule'\r\n  Private\r\n    FCSSText : String; external name 'cssText';\r\n    FParentStyleSheet : TJSCSSStyleSheet; external name 'parentStyleSheet';\r\n    FparentRule : TJSCSSRule; external name 'parentRule';\r\n  Public\r\n    property cssText : String Read FCSSText;\r\n    property parentRule : TJSCSSRule read FparentRule;\r\n    property parentStyleSheet : TJSCSSStyleSheet Read FParentStyleSheet;\r\n  end;\r\n  \r\n  TJSCSSRuleList = Class external name 'CSSRuleList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSCSSRule;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSCSSRule read item; default;\r\n  end;\r\n  \r\n  \r\n  TJSCSSStyleSheet = class external name 'CSSStyleSheet' (TJSStyleSheet)\r\n  Private\r\n    FCSSRules : TJSCSSRuleList; external name 'cssRules';\r\n  Public\r\n    procedure deleteRule(aIndex : NativeInt);\r\n    function insertRule(aRule : String; aIndex : NativeInt) : NativeInt;\r\n    Property cssRules : TJSCSSRuleList read FCSSRules;\r\n  end;\r\n\r\n  TJSStyleSheetList = Class external name 'StyleSheetList'\r\n  Private\r\n    FLength : NativeInt; external name 'length';\r\n  Public\r\n    function item(index : NativeInt) : TJSStyleSheet;\r\n    property length : NativeInt Read FLength;\r\n    Property items[aIndex : NativeInt] : TJSStyleSheet read item; default;\r\n  end;\r\n\r\n  { TJSDocumentFragment }\r\n\r\n  TJSDocumentFragment = Class external name 'DocumentFragment' (TJSNode)\r\n  private\r\n    FchildElementCount: Integer; external name 'childElementCount';\r\n    Fchildren: TJSHTMLCollection; external name 'children';\r\n    FfirstElementChild: TJSElement; external name 'firstElementChild';\r\n    FlastElementChild: TJSElement; external name 'lastElementChild';\r\n  public\r\n    constructor new;\r\n    function querySelector(aSelector : String) : TJSElement;\r\n    function querySelectorAll(aSelector : String) : TJSNodeList;\r\n    property childElementCount : Integer read FchildElementCount;\r\n    property children : TJSHTMLCollection read Fchildren;\r\n    property firstElementChild : TJSElement read FfirstElementChild;\r\n    property lastElementChild : TJSElement read FlastElementChild;\r\n  end;\r\n\r\n  TJSEventInit = record\r\n    bubbles : boolean;\r\n    cancelable : boolean;\r\n    scoped : boolean;\r\n    composed : boolean;\r\n  end;\r\n\r\n  TJSEvent = class external name 'Event'\r\n  Private\r\n    FBubbles : Boolean; external name 'bubbles';\r\n    FCancelable : Boolean; external name 'cancelable';\r\n    FComposed : Boolean; external name 'composed';\r\n    FCurrentTarget : TJSElement; external name 'currentTarget';\r\n    FdefaultPrevented : Boolean; external name 'defaultPrevented';\r\n    FEventPhase : NativeInt; external name 'eventPhase';\r\n    FTarget : TJSElement; external name 'target';\r\n    FTimeStamp : NativeInt; external name 'timestamp';\r\n    FType : String; external name 'type';\r\n    FIsTrusted : Boolean; external name 'isTrusted';\r\n  Public\r\n    Const\r\n      NONE = 0;\r\n      CAPTURING_PHASE = 1;\r\n      AT_TARGET  = 2;\r\n      BUBBLING_PHASE = 3;\r\n  public    \r\n    cancelBubble : Boolean;\r\n    constructor new (aType : String; const aInit : TJSEventInit); overload;\r\n    procedure preventDefault;\r\n    procedure stopImmediatePropagation;\r\n    procedure stopPropagation;\r\n    Property bubbles : Boolean Read FBubbles;\r\n    Property cancelable : Boolean Read FCancelable;\r\n    Property composed : Boolean Read FComposed;\r\n    property currentTarget : TJSElement Read FCurrentTarget;\r\n    property defaultPrevented : Boolean Read FdefaultPrevented;\r\n    property eventPhase : NativeInt Read FEventPhase;\r\n    property target : TJSElement Read FTarget;\r\n    Property timestamp : NativeInt Read FTimeStamp;\r\n    property _type : string read FType;\r\n    property isTrusted : Boolean Read FIsTrusted;\r\n  end;\r\n\r\n\r\n  TJSXPathExpression = class external name 'XPathExpression'\r\n  Public\r\n    function evaluate(contextNode : TJSNode; aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function evaluateWithContext(contextNode : TJSNode; aPosition, aSize, aType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n  end;\r\n\r\n  TJSXPathNSResolver = class external name 'XPathNSResolver'\r\n  Public\r\n    function lookupNamespaceURI(prefix : string) : string;\r\n  end;\r\n\r\n  { TJSCharacterData }\r\n\r\n  TJSCharacterData = class external name 'CharacterData' (TJSNode)\r\n  private\r\n    FnextElementSibling: TJSElement; external name 'nextElementSibling';\r\n    FpreviousElementSibling: TJSElement; external name 'previousElementSibling';\r\n  public\r\n    property nextElementSibling : TJSElement read FnextElementSibling;\r\n    property previousElementSibling : TJSElement read FpreviousElementSibling;\r\n  end;\r\n\r\n  TJSProcessingInstruction = class external name 'ProcessingInstruction' (TJSCharacterData);\r\n\r\n  { TJSRange }\r\n\r\n  TJSRange = class external name 'Range'\r\n  private\r\n    FCollapsed: boolean; external name 'collapsed';\r\n    FcommonAncestorContainer: TJSNode; external name 'commonAncestorContainer';\r\n    FendContainer: TJSNode; external name 'endContainer';\r\n    FEndOffset: NativeInt; external name 'endOffset';\r\n    FstartContainer: TJSNode; external name 'startContainer';\r\n    FstartOffset: NativeInt; external name 'startOffset';\r\n  Public\r\n    const\r\n      END_TO_END     = 0;\r\n      END_TO_START   = 1;\r\n      START_TO_END   = 2;\r\n      START_TO_START = 3;\r\n  Public\r\n    constructor new;\r\n    function cloneContents : TJSDocumentFragment;\r\n    function cloneRange : TJSRange;\r\n    procedure collapse;\r\n    function compareBoundaryPoints(aHow : NativeInt) : NativeInt;\r\n    function createContextualFragment(aTagstring : String) : TJSDocumentFragment;\r\n    procedure deleteContents;\r\n    procedure detach;\r\n    function extractContents : TJSDocumentFragment;\r\n    procedure insertNode(aNode : TJSNode);\r\n    procedure selectNode(aNode : TJSNode);\r\n    procedure selectNodeContents(aNode : TJSNode);\r\n    procedure setEnd(aEndNode : TJSNode; aEndOffset : NativeInt); \r\n    procedure setEndAfter(aEndNode : TJSNode);\r\n    procedure setEndBefore(aEndNode : TJSNode);\r\n    procedure setStart(aStartNode : TJSNode; aStartOffset : NativeInt); \r\n    procedure setStartAfter(aStartNode : TJSNode);\r\n    procedure setStartBefore(aStartNode : TJSNode);\r\n    procedure surroundContents(aNode : TJSNode);\r\n    function toString : string;\r\n    property collapsed : boolean read FCollapsed;\r\n    property commonAncestorContainer : TJSNode read FcommonAncestorContainer ;\r\n    property endContainer : TJSNode read FendContainer;\r\n    property endOffset : NativeInt Read FEndOffset;\r\n    property startContainer : TJSNode read FstartContainer;\r\n    property startOffset : NativeInt Read FstartOffset;\r\n  end;\r\n\r\n\r\n  { TJSTreeWalker }\r\n\r\n  TJSTreeWalker = class external name 'TreeWalker'\r\n  private\r\n    FCurrentNode: TJSNode; external name 'currentNode';\r\n    FexpandEntityReference: Boolean; external name 'expandEntityReference';\r\n    FFilter: TJSNodeFilter; external name 'filter';\r\n    FRoot: TJSNode; external name 'root';\r\n    FWhatToShow: NativeInt; external name 'whatToShow';\r\n  Public\r\n    function firstChild : TJSNode;\r\n    function lastChild : TJSNode;\r\n    function nextNode : TJSNode;\r\n    function nextSibling : TJSNode;\r\n    function parentNode : TJSNode;\r\n    function previousNode : TJSNode;\r\n    function previousSibling : TJSNode;\r\n\r\n    property root : TJSNode read FRoot;\r\n    property whatToShow : NativeInt read FWhatToShow;\r\n    property filter : TJSNodeFilter Read FFilter;\r\n    property expandEntityReference : Boolean Read FexpandEntityReference;\r\n    property currentNode : TJSNode Read FCurrentNode;\r\n  end;\r\n\r\n  TJSNodeFilter = class external name 'NodeFilter'\r\n    const\r\n      SHOW_ALL                    = -1;\r\n      SHOW_ATTRIBUTE              = 2;\r\n      SHOW_CDATA_SECTION          = 8;\r\n      SHOW_COMMENT                = 128;\r\n      SHOW_DOCUMENT               = 256;\r\n      SHOW_DOCUMENT_FRAGMENT      = 1024;\r\n      SHOW_DOCUMENT_TYPE          = 512;\r\n      SHOW_ELEMENT                = 1;\r\n      SHOW_ENTITY                 = 32;\r\n      SHOW_ENTITY_REFERENCE       = 16;\r\n      SHOW_NOTATION               = 2048;\r\n      SHOW_PROCESSING_INSTRUCTION = 64;\r\n      SHOW_TEXT                   = 4;\r\n    function acceptNode (aNode : TJSNode) : NativeInt;\r\n  end;\r\n\r\n  TJSXPathResult = class external name 'XPathResult'\r\n  private\r\n    FBooleanValue : Boolean; external name 'booleanValue';\r\n    FNumberValue : Double; external name 'numberValue';\r\n    FResultType : NativeInt; external name 'resultType';\r\n    FSingleNodeValue : TJSNode;  external name 'singleNodeValue';\r\n    FSnaphotLength : NativeInt; external name 'snapshotLength';\r\n    FStringValue : String; external name 'stringValue';\r\n  public  \r\n    Function iterateNext : TJSNode;\r\n    Function snapshotItem(Index: NativeInt) : TJSNode;\r\n    Property booleanValue : Boolean Read FBooleanValue;\r\n    Property numberValue : Double Read FNumberValue;\r\n    property resultType : NativeInt Read FResultType;\r\n    Property singleNodeValue : TJSNode Read FSingleNodeValue;\r\n    property snapshotLength : NativeInt read FSnaphotLength;\r\n    property stringValue : String Read FStringValue;\r\n  end;\r\n\r\n  TJSSelection = class external name 'Selection'\r\n  Private\r\n    FanchorNode : TJSNode ; external name 'anchorNode';\r\n    FanchorOffset : NativeInt ; external name 'anchorOffset';\r\n    FfocusNode : TJSNode ; external name 'focusNode';\r\n    FfocusOffset : NativeInt ; external name 'focusOffset';\r\n    FisCollapsed : Boolean ; external name 'isCollapsed';\r\n    FrangeCount : NativeInt ; external name 'rangeCount';\r\n    Ftype : String ; external name 'type';\r\n  Public\r\n    function getRangeAt(aIndex : NativeInt) : TJSRange;\r\n    procedure collapse(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure extend(aParentNode : TJSNode; Offset : NativeInt);\r\n    procedure collapseToStart;\r\n    procedure collapseToEnd;\r\n    procedure selectAllChildren(aParentNode : TJSNode);\r\n    procedure addRange(aRange : TJSRange);\r\n    procedure removeRange(aRange : TJSRange);\r\n    procedure removeAllRanges;\r\n    procedure deleteFromDocument;\r\n    function containsNode(aNode : TJSNode; aPartlyContained : Boolean) : Boolean;\r\n    procedure setBaseAndExtent(aAnchorNode : TJSNode; aAnchorOffset : NativeInt; aFocusNode : TJSNode; aFocusOffset : NativeInt);\r\n    function toString : String;\r\n    property anchorNode : TJSNode read FAnchorNode;\r\n    property anchorOffset : NativeInt read FAnchorOffset;\r\n    property focusNode : TJSNode read FFocusNode;\r\n    property focusOffset : NativeInt read FFocusOffset;\r\n    property isCollapsed : Boolean read FIsCollapsed;\r\n    property rangeCount : NativeInt read FRangeCount;\r\n    property _type : String Read FType;\r\n  end;\r\n  TJSNameSpaceMapperCallback = function (aNameSpace : string ) : String;\r\n\r\n  TJSHTMLFile = class;\r\n  TJSHTMLFileList = Class;\r\n\r\n  { TJSDataTransferItem }\r\n\r\n  TJSDataTransferItemCallBack = reference to Procedure(aData : String);\r\n\r\n  TJSDataTransferItem = class external name 'DataTransferItem'\r\n  private\r\n    FKind: String; external name 'kind';\r\n    FType: string; external name 'type';\r\n  Public\r\n    function getAsFile : TJSHTMLFile;\r\n    Procedure getAsString(aCallBack : TJSDataTransferItemCallBack);\r\n    property Kind : String read FKind;\r\n    property _Type : string read FType;\r\n  end;\r\n\r\n  TJSDataTransferItemList = class external name 'DataTransferItemList'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    function getitem(aIndex : nativeInt) : TJSDataTransferItem ; external name '[]';\r\n  Public\r\n    Function add(aData : string; AType: string) : TJSDataTransferItem; overload;\r\n    Function add(aFile : TJSHTMLFile) : TJSDataTransferItem; overload;\r\n    Procedure clear;\r\n    procedure remove(aIndex : integer);\r\n    property length : NativeInt read FLength;\r\n    property Items[aIndex : NativeInt] : TJSDataTransferItem Read getitem; default;\r\n  end;\r\n\r\n  { TDataTransfer }\r\n\r\n  TJSDataTransfer = class external name 'DataTransfer'\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FItems: TJSDataTransferItemList; external name 'items';\r\n    FTypes: TJSStringDynArray; external name 'types';\r\n  Public\r\n    dropEffect : string;\r\n    effectAllowed : string;\r\n    Procedure clearData; overload;\r\n    Procedure clearData(aFormat : string); overload;\r\n    function getData(aFormat : string) : String;\r\n    procedure setData(aFormat : String; aData : String);\r\n    procedure setDragImage(aImage: TJSElement; xOffset,yOffset : integer);\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property items : TJSDataTransferItemList read FItems;\r\n    property types : TJSStringDynArray read FTypes;\r\n  end;\r\n\r\n  { TJSDragEvent }\r\n\r\n  TJSDragEvent = class external name 'DragEvent' (TJSEvent)\r\n  Private\r\n    FDataTransfer: TJSDataTransfer; external name 'dataTransfer';\r\n    FrelatedTarget : TJSEventTarget external name 'relatedTarget';\r\n    FscreenX : NativeInt external name 'screenX';\r\n    FscreenY : NativeInt external name 'screenY';\r\n    FclientX : NativeInt external name 'clientX';\r\n    FclientY : NativeInt external name 'clientY';\r\n    Fbutton : NativeInt external name 'button';\r\n    Fbuttons : NativeInt external name 'buttons';\r\n    FctrlKey : Boolean external name 'ctrlKey';\r\n    FshiftKey : Boolean external name 'shiftKey';\r\n    FaltKey  : Boolean external name 'altKey';\r\n    FmetaKey  : Boolean external name 'metaKey';\r\n  Public\r\n    Property relatedTarget : TJSEventTarget Read FRelatedTarget;\r\n    Property screenX : NativeInt Read FScreenX;\r\n    Property screenY : NativeInt Read FScreenY;\r\n    Property clientX : NativeInt Read FClientX;\r\n    Property clientY : NativeInt Read FClientY;\r\n    Property button : NativeInt Read FButton;\r\n    Property buttons : NativeInt Read FButtons;\r\n    Property ctrlKey : Boolean Read FctrlKey;\r\n    Property shiftKey : Boolean Read FshiftKey;\r\n    Property altKey  : Boolean Read FaltKey;\r\n    Property metaKey  : Boolean Read FmetaKey;\r\n    property dataTransfer : TJSDataTransfer Read FDataTransfer;\r\n  end;\r\n  TJSDragDropEventHandler = reference to function(aEvent: TJSDragEvent) : Boolean;\r\n  THTMLClickEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  { Various events }\r\n\r\n{$IFNDEF FIREFOX}\r\n  TJSFocusEvent = TJSEvent;\r\n{$ELSE}\r\n  TJSFocusEvent = Class(TJSEvent)\r\n  private\r\n    FrelatedTarget : TJSElement external name 'relatedTarget';\r\n  public\r\n    property relatedTarget : TJSElement Read FrelatedTarget;\r\n  end;\r\n{$ENDIF}\r\n  TJSAnimationEvent = Class(TJSEvent);\r\n  TJSLoadEvent = Class(TJSEvent);\r\n\r\n  TJSErrorEvent = class external name 'ErrorEvent' (TJSEvent)\r\n  Private\r\n    Fmessage : String external name 'message';\r\n    Ffilename : string external name 'filename';\r\n    Flineno : integer external name 'lineno';\r\n    Fcolno : integer external name 'colno';\r\n    Ferror : TJSObject external name 'error';\r\n  Public\r\n    Property message : String read FMessage;\r\n    property filename : string Read FFileName;\r\n    property lineno : integer read FLineNo;\r\n    Property colno : integer read FColNo;\r\n    Property error : TJSObject read FError;\r\n  end;\r\n\r\n  TJsPageTransitionEvent = class(TJSEvent)\r\n  end;\r\n\r\n  TJSHashChangeEvent = class external name 'HashChangeEvent' (TJSEvent)\r\n  Private\r\n    FnewURL : String external name 'newURL';\r\n    FoldURL : String external name 'oldURL';\r\n  public\r\n    property newURL : String Read FNewURL;\r\n    property oldURL : String Read FOldURL;\r\n  end;\r\n\r\n  TJSPopStateEvent = class external name 'PopStateEvent'  (TJSEvent)\r\n  Private\r\n    FState : JSValue; external name 'state';\r\n  Public\r\n    property state : JSValue read FState;\r\n  end;\r\n\r\n  TJSStorageEvent = class external name 'StorageEvent' (TJSEvent)\r\n  private\r\n    Fkey : String external name 'key';\r\n    FoldValue : String external name 'oldValue';\r\n    FnewValue : String external name 'newValue';\r\n    Furl : String external name 'url';\r\n    FstorageArea : String external name 'storageArea';\r\n  public\r\n    Property key : String Read FKey;\r\n    Property oldValue : String Read FOldValue;\r\n    Property newValue : String Read FNewValue;\r\n    Property url : String Read FURL;\r\n    Property storageArea : String Read FstorageArea;\r\n  end;\r\n\r\n  { TJSProgressEvent }\r\n\r\n  TJSProgressEvent = class external name 'ProgressEvent' (TJSEvent)\r\n  Private\r\n    FlengthComputable : Boolean external name 'lengthComputable';\r\n    Floaded : NativeUINT external name 'loaded';\r\n    FTotal : NativeUINT external name 'Total';\r\n  Public\r\n    property lengthComputable : Boolean Read FlengthComputable;\r\n    property loaded : NativeUINT Read FLoaded;\r\n    property Total : NativeUINT Read FTotal;\r\n  end;\r\n\r\n  TJSPageTransitionEventHandler = reference to function(aEvent : TJsPageTransitionEvent) : boolean;\r\n  TJSHashChangeEventhandler = reference to function(aEvent : TJSHashChangeEvent) : boolean;\r\n  TJSMouseWheelEventHandler = reference to function(aEvent : TJSWheelEvent) : boolean;\r\n  TJSMouseEventHandler = reference to function(aEvent : TJSMouseEvent) : boolean;\r\n  THTMLAnimationEventHandler = reference to function(aEvent : TJSAnimationEvent) : boolean;\r\n  TJSErrorEventHandler = reference to function(aEvent : TJSErrorEvent) : boolean;\r\n  TJSFocusEventHandler = reference to function(aEvent : TJSFocusEvent) : boolean;\r\n  TJSKeyEventhandler = reference to function (aEvent : TJSKeyBoardEvent) : boolean;\r\n  TJSLoadEventhandler = reference to function (aEvent : TJSLoadEvent) : boolean;\r\n  TJSPointerEventHandler = reference to function(aEvent : TJSPointerEvent) : boolean;\r\n  TJSUIEventHandler = reference to function(aEvent : TJSUIEvent) : Boolean;\r\n  TJSPopStateEventHandler = reference to function(aEvent : TJSPopStateEvent) : Boolean;\r\n  TJSStorageEventHandler = reference to function(aEvent : TJSStorageEvent) : Boolean;\r\n  TJSProgressEventhandler =  reference to function(aEvent : TJSProgressEvent) : Boolean;\r\n  TJSTouchEventHandler = reference to function(aEvent : TJSTouchEvent) : boolean;\r\n\r\n  TJSDocument = class external name 'Document' (TJSNode)\r\n  Private\r\n    fActiveElement : TJSElement; external name 'activeElement';\r\n    FCharacterSet: String; external name 'characterSet';\r\n    FChildElementCount: NativeInt; external name 'childElementCount';\r\n    FCompatMode: String; external name 'compatMode';\r\n    FCurrentScript: TJSElement; external name 'currentScript';\r\n    FDefaultView: TJSWindow; external name 'defaultView';\r\n    FDocType: TJSDocumentType; external name 'docrype';\r\n    FDocumentElement: TJSElement; external name 'documentElement';\r\n    FDocumentURI: String; external name 'documentURI';\r\n    FEmbeds: TJSHTMLCollection; external name 'embeds';\r\n    FFirstElementChild : TJSElement; external name 'firstElementChild';\r\n    FForms: TJSHTMLCollection; external name 'forms';\r\n    FFullScreenElement: TJSElement; external name 'fullscreenElement';\r\n    FFullscreenEnabled: Boolean; external name 'fullscreenEnabled';\r\n    FHead: TJSElement; external name 'head';\r\n    FHidden: Boolean; external name 'hidden';\r\n    FImages: TJSHTMLCollection; external name 'images';\r\n    FImplementation: TJSDOMImplementation; external name 'implementation';\r\n    FLastElementChild : TJSElement; external name 'lastElementChild';\r\n    FLastModified: String; external name 'lastModified';\r\n    FLastStyleSheetSet: String; external name 'lastStyleSheetSet';\r\n    FLinks: TJSHTMLCollection; external name 'links';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationString: String; external name 'location';\r\n    FPlugins: TJSHTMLCollection; external name 'plugins';\r\n    FPointerLockElement: TJSElement; external name 'pointerLockElement';\r\n    FPreferredStyleSheetSet: String; external name 'preferredStyleSheetSet';\r\n    FReadyState: String; external name 'readyState';\r\n    FReferrer: String; external name 'referrer';\r\n    FScripts: TJSHTMLCollection; external name 'scripts';\r\n    FStyleSheets: TJSStyleSheetList; external name 'styleSheets';\r\n    FStyleSheetSets: TJSValueDynArray; external name 'styleSheetSets';\r\n    FURL: String; external name 'URL';\r\n    FVisibilityState: string; external name 'visibilityState';\r\n  Public\r\n    function adoptNode(aExternalNode : TJSNode) : TJSNode;\r\n    procedure close;\r\n    function createAttribute(aName : string) : TJSAttr;\r\n    function createCDATASection(S : String) : TJSNode;\r\n    function createComment(S : String) : TJSNode;\r\n    function createDocumentFragment : TJSDocumentFragment;\r\n    function createElement(tagName : string) : TJSElement; overload;\r\n    function createElement(tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string) : TJSElement; overload;\r\n    function createElementNS(aNameSpace,tagName : string; const options : TJSElementCreationOptions) : TJSElement; overload;\r\n    function createEvent(aType : string) : TJSEvent;\r\n    function createExpression(xPathText : String; aNameSpaceMapper: TJSNameSpaceMapperCallback) : TJSXPathExpression;\r\n    function createNSResolver(aNode : TJSNode) : TJSXPathNSResolver;\r\n    function createProcessingInstruction(target, data : String) : TJSProcessingInstruction;\r\n    function createRange : TJSRange;\r\n    function createTextNode(S : String) : TJSNode;\r\n    function createTreeWalker(root : TJSNode; whatToShow : NativeInt; filter : TJSNodeFilter) : TJSTreeWalker;\r\n    function elementFromPoint(x,y : integer) : TJSElement;\r\n    procedure enableStyleSheetsForSet(aSet : String);\r\n    function evaluate(xpathExpression : String; ContextNode : TJSNode; NameSpaceResolver : TJSNamespaceMapperCallBack; resultType : NativeInt; aResult : TJSXPathResult) : TJSXPathResult;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean; AValueArgument : String) : boolean; overload;\r\n    function execCommand(aCommandName : String; aShowDefaultUI : Boolean) : boolean; overload;\r\n    Procedure exitFullScreen;\r\n    function getElementById(aID : String) : TJSElement;\r\n    function getElementsyClassName(aNames : string) : TJSHTMLCollection;\r\n    function getElementsByName(aName : String) : TJSNodeList;\r\n    function getElementsByTagName(aName : String) : TJSHTMLCollection;\r\n    function getElementsByTagNameNS(aNameSpace,aName : String) : TJSHTMLCollection;\r\n    function getSelection : TJSSelection;\r\n    function hasFocus : boolean;\r\n    function importNode(aExternalNode : TJSNode; Deep: boolean) : TJSNode;\r\n    function querySelector(aSelectors : String) : TJSElement;\r\n    function querySelectorAll(aSelectors : String) : TJSNodeList;\r\n    procedure open;\r\n    procedure releaseCapture;\r\n    procedure write(aLine : string);\r\n    procedure writeln(aLine : String);\r\n  Public\r\n    body : TJSElement;\r\n    designMode : string;\r\n    dir : string;\r\n    domain : string;\r\n    selectedStyleSheetSet : string;\r\n    title : string;\r\n    onabort : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    oncuechange : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSProgressEventhandler;\r\n    onloadstart : TJSProgressEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSEventHandler;\r\n    onplay : TJSEventHandler;\r\n    onplaying : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onreset : TJSUIEventHandler;\r\n    onratechange : TJSEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onseekend : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onsshow : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Property activeElement : TJSElement Read FActiveElement;\r\n    Property characterSet : String Read FCharacterSet;\r\n    property childElementCount : NativeInt Read FChildElementCount;\r\n    property compatMode : String Read FCompatMode;\r\n    property currentScript : TJSElement Read FCurrentScript;\r\n    property defaultView : TJSWindow Read FDefaultView;\r\n    property doctype : TJSDocumentType read FDocType;\r\n    property documentElement : TJSElement read FDocumentElement;\r\n    property documentURI : String Read FDocumentURI;\r\n    property embeds : TJSHTMLCollection Read FEmbeds;\r\n    property firstElementChild : TJSElement Read FFirstElementChild;\r\n    property lastElementChild : TJSElement Read FLastElementChild;\r\n    property Forms : TJSHTMLCollection Read FForms;\r\n    property fullscreenElement : TJSElement Read FFullScreenElement;\r\n    property fullscreenEnabled : Boolean Read FFullscreenEnabled;\r\n    property head : TJSElement read FHead;\r\n    Property hidden : Boolean read FHidden;\r\n    property images : TJSHTMLCollection Read FImages;\r\n    property _implementation : TJSDOMImplementation Read FImplementation;\r\n    property lastModified : String Read FLastModified;\r\n    property lastStyleSheetSet : String read FLastStyleSheetSet;\r\n    property links : TJSHTMLCollection Read FLinks;\r\n    property location : TJSLocation read FLocation;\r\n    Property LocationString : String Read FURL Write FLocationString; // On purpose\r\n    property plugins : TJSHTMLCollection Read FPlugins;\r\n    property pointerLockElement : TJSElement Read FPointerLockElement;\r\n    property preferredStyleSheetSet : String Read FPreferredStyleSheetSet;\r\n    Property readyState : String Read FReadyState;\r\n    Property referrer : String Read FReferrer;\r\n    property scripts : TJSHTMLCollection Read FScripts;\r\n    property styleSheets : TJSStyleSheetList Read FStyleSheets;\r\n    property styleSheetSets : TJSValueDynArray Read FStyleSheetSets; // No type documented ?\r\n    Property URL : String Read FURL;\r\n    property visibilityState : string read FVisibilityState;\r\n  end;\r\n\r\n  TJSConsole = class external name 'Console'\r\n  Public\r\n    procedure assert(anAssertion : string; Obj1 : JSValue); varargs;\r\n    Procedure clear;  \r\n    procedure count; overload;\r\n    procedure count(aCounter : String);\r\n    procedure error(Obj1 : JSValue); varargs;\r\n    procedure group; overload;\r\n    procedure group(aLabel : String); overload;\r\n    procedure groupCollapsed; overload;\r\n    procedure groupCollapsed(aLabel : String);overload;\r\n    procedure groupEnd;\r\n    procedure info(Obj1 : JSValue); varargs;\r\n    procedure log(Obj1 : JSValue); varargs;\r\n    procedure table(args: array of JSValue); overload;\r\n    procedure table(args: array of JSValue; Columns : Array of string);\r\n    procedure table(args: TJSObject); overload;\r\n    procedure table(args: TJSObject; Columns : Array of string); overload;\r\n    procedure time(aName : string);\r\n    procedure timeEnd(aName : string);\r\n    procedure trace;\r\n    procedure warn(Obj1 : JSValue); varargs;\r\n  end;\r\n\r\n  { TJSCryptoKey }\r\n\r\n  TJSCryptoKey = class external name 'CryptoKey'\r\n  private\r\n    FAlgorithm: JSValue; external name 'algorithm';\r\n    FExtractable: Boolean; external name 'extractable';\r\n    FType: string; external name 'type';\r\n    FUsages: TStringDynArray; external name 'usages';\r\n  Public\r\n    property _type : string read FType;\r\n    property extractable: Boolean read FExtractable;\r\n    property algorithm : JSValue read FAlgorithm;\r\n    property usages : TStringDynArray Read FUsages;\r\n  end;\r\n  \r\n  { TJSSubtleCrypto }\r\n\r\n//  TJSBufferSource = class external name 'BufferSource' end;\r\n//  TJSTypedArray = class external name 'TypedArray' end;\r\n\r\n  TJSSubtleCrypto = class external name 'SubtleCrypto'\r\n  Public\r\n    function decrypt(algorithm : JSValue; aKey : TJSCryptoKey; aData : TJSBufferSource) : TJSPromise;\r\n    function deriveKey(algorithm : JSValue; aMasterKey : TJSCryptoKey; aDerivedAlgo : JSValue; extractable : Boolean; Usages : TStringDynArray) : TJSPromise;\r\n    function digest(algorithm : string; Buffer : TJSArrayBuffer) : TJSPromise; overload;\r\n    function digest(algorithm : string; Buffer : TJSTypedArray) : TJSPromise; overload;\r\n    function encrypt(algorithm : JSValue; aKey : TJSCryptoKey; aData : TJSBufferSource) : TJSPromise;\r\n    function exportKey(algorithm : String; AKey : TJSCryptoKey) : TJSPromise;\r\n    function generateKey(algorithm : JSValue; extractable : Boolean; Usages : TStringDynArray) : TJSPromise;\r\n    function importKey(format : String; KeyData : TJSArrayBuffer; algorithm : String; extractable : Boolean; Usages : TStringDynArray) : TJSPromise;\r\n    function sign(algorithm : string; Key : TJSCryptoKey; aText : TJSArrayBuffer) : TJSPromise; overload;\r\n    function unwrapKey(algorithm : string; wrappedKey : TJSArrayBuffer; Key: TJSCryptoKey;\r\n                       unwrapAlgo : string; unwrappedKeyAlgo : string; \r\n                       extractable : Boolean; Usages : TStringDynArray) : TJSPromise;\r\n   function verify(algorithm : String; key : TJSCryptoKey; Signature : TJSArrayBuffer; \r\n                   textToVerify : TJSArrayBuffer): TJSPromise;\r\n   function wrapKey(aFormat : string; Key,WrappingKey : TJSCryptoKey; WrapAlgorithm : String) : TJSPromise;                   \r\n  end;\r\n  \r\n  { TJSCrypto }\r\n\r\n  TJSCrypto = class external name 'Crypto'\r\n  private\r\n    FsubtleCrypto: TJSSubtleCrypto;\r\n  Public\r\n    procedure getRandomValues (anArray : TJSTypedArray);\r\n    property subtleCrypto : TJSSubtleCrypto Read FsubtleCrypto;\r\n  end;\r\n  \r\n  { TJSHistory }\r\n\r\n  TJSHistory = class external name 'History'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n{$IFDEF FIREFOX}\r\n    FState : JSValue; external name 'state';\r\n{$ENDIF}\r\n  Public\r\n    procedure back;\r\n    procedure forward;\r\n    procedure go(aIndex : NativeInt);\r\n    procedure go;\r\n    procedure pushState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure pushState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String; AURL : String);\r\n    procedure replaceState(aState : jsValue; aTitle : String);\r\n    procedure replaceState(aState : jsValue);\r\n{$IFDEF FIREFOX}\r\n    property state : JSValue read FState;\r\n{$ENDIF}\r\n    property length: NativeInt read FLength;\r\n  end;\r\n\r\n  TJSIDBTransactionMode = class\r\n  const\r\n    readonly = 'readonly';\r\n    readwrite = 'readwrite';\r\n    versionchange = 'versionchange';\r\n  end;\r\n\r\n\r\n  { TJSIDBTransaction }\r\n\r\n  TJSIDBTransaction = class external name 'IDBTransaction'  (TJSEventTarget)\r\n  private\r\n    FDB : TIDBDatabase; external name 'db';\r\n    FError: JSValue; external name 'error';\r\n    FMode: String; external name 'mode';\r\n    FObjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n  public\r\n    procedure abort;\r\n    function objectStore(aName : String) : TJSIDBObjectStore;\r\n    property db : TIDBDatabase read FDB;\r\n    property mode : String read FMode;\r\n    property objectStoreNames : TStringDynArray read FObjectStoreNames;\r\n    property error : JSValue read FError;\r\n  end;\r\n\r\n\r\n  { TJSIDBKeyRange }\r\n\r\n  TJSIDBKeyRange = class external name 'IDBKeyRange'\r\n  private\r\n    FLower: JSValue;\r\n    FLowerOpen: Boolean;\r\n    FUpper: JSValue;\r\n    FUpperOpen: Boolean;\r\n  Public\r\n    Class Function bound(aLower,aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function bound(aLower,aUpper : JSValue; aLowerOpen,aUpperOpen : Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function lowerBound(aLower : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    Class Function only(aValue : JSValue) : TJSIDBKeyRange;\r\n    Class Function upperBound(aUpper : JSValue) : TJSIDBKeyRange; overload;\r\n    Class Function upperBound(aUpper : JSValue; aOpen: Boolean) : TJSIDBKeyRange; overload;\r\n    function includes (aValue : JSValue) : Boolean;\r\n    property lower : JSValue read FLower;\r\n    property lowerOpen : Boolean read FLowerOpen;\r\n    property upper : JSValue read FUpper;\r\n    property upperOpen : Boolean read FUpperOpen;\r\n  end;\r\n\r\n  TJSIDBIndexParameters = record\r\n    unique : boolean;\r\n    multiEntry : boolean;\r\n    locale : string;\r\n  end;\r\n\r\n\r\n  { TJSIDBIndex }\r\n\r\n  TJSIDBIndex = class external name 'IDBIndex'\r\n  private\r\n    FKeyPath: JSValue; external name 'keyPath';\r\n    FMultiEntry: Boolean; external name 'multiEntry';\r\n    FObjectStore: TJSIDBObjectStore; external name 'objectStore';\r\n    FUnique: boolean; external name 'unique';\r\n  public\r\n    name : string;\r\n    function count : TJSIDBRequest;\r\n    function get(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function get(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : jsValue; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : TJSIDBKeyRange; ACount : NativeInt) : TJSIDBRequest; overload;\r\n    function getKey(aKey : jsValue) : TJSIDBRequest;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    function openKeyCursor : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; ADirection : String) : TJSIDBRequest;overload;\r\n    Property keyPath : JSValue Read FKeyPath;\r\n    property multiEntry : Boolean read FMultiEntry;\r\n    property objectStore : TJSIDBObjectStore read FObjectStore;\r\n    property unique : boolean read FUnique;\r\n  end;\r\n\r\n  TJSIDBCursorDirection = class external name 'IDBCursorDirection'\r\n  Const\r\n    next = 'next';\r\n    nextUnique = 'nextUnique';\r\n    prev = 'prev';\r\n    prevUnique = 'prevUnique';\r\n  end;\r\n\r\n\r\n  { TJSIDBCursor }\r\n\r\n  TJSIDBCursor = class external name 'IDBCursor'\r\n  private\r\n    FDirection: string; external name 'direction';\r\n    FKey: JSValue; external name 'key';\r\n    FPrimaryKey: JSValue; external name 'primaryKey';\r\n    FSource: JSValue; external name 'source';\r\n    FSourceAsIndex: TJSIDBIndex; external name 'source';\r\n    FSourceAsStore: TJSIDBObjectStore; external name 'source';\r\n  Public\r\n    procedure advance(aCount : NativeInt); overload;\r\n    procedure advance(aKey : JSValue); overload;\r\n    procedure continue(aKey : JSValue); overload;\r\n    procedure continue; overload;\r\n    procedure continuePrimaryKey(aKey : JSValue); overload;\r\n    procedure continuePrimaryKey(aKey,aPrimaryKey : JSValue); overload;\r\n    procedure delete;\r\n    procedure update(aValue : JSValue);\r\n    property source : JSValue read FSource;\r\n    property sourceAsStore : TJSIDBObjectStore read FSourceAsStore;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceAsIndex;\r\n    property key : JSValue read FKey;\r\n    property primaryKey : JSValue read FPrimaryKey;\r\n    property direction : string read FDirection;\r\n  end;\r\n\r\n  TJSIDBObjectStore = class external name 'IDBObjectStore'  (TJSEventTarget)\r\n  public\r\n    function add(aValue : JSValue; aKey : String) : TJSIDBRequest;\r\n    function add(aValue : JSValue) : TJSIDBRequest;\r\n    function clear : TJSIDBRequest;\r\n    function delete(aKey : string) : TJSIDBRequest;\r\n    function delete(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest;\r\n    function get(aKey : string) : TJSIDBRequest; overload;\r\n    function get(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getKey(aKey : string) : TJSIDBRequest; overload;\r\n    function getKey(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll : TJSIDBRequest; overload;\r\n    function getAll(aKey : String) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAll(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAll(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKey : String; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function getAllKeys(aKeyRange : TJSIDBKeyRange; aCount: NativeInt) : TJSIDBRequest; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String)  : TJSIDBIndex; overload;\r\n    function createIndex (aIndexName : String; KeyPath : Array of String; Options : TJSIDBIndexParameters)  : TJSIDBIndex; overload;\r\n    Procedure deleteIndex (aIndexName : String);\r\n    function index (aIndexName : String)  : TJSIDBIndex;\r\n    function put(aValue : JSValue; aKey : String) : TJSIDBRequest; overload;\r\n    function put(aValue : JSValue) : TJSIDBRequest; overload;\r\n    function openCursor : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKey : String; aDirection : string) : TJSIDBRequest; overload;\r\n    function openKeyCursor(aKeyRange : TJSIDBKeyRange; aDirection : string) : TJSIDBRequest; overload;\r\n    function count : TJSIDBRequest; overload;\r\n    function count(aKey : String) : TJSIDBRequest; overload;\r\n    function count(aKeyRange : TJSIDBKeyRange) : TJSIDBRequest; overload;\r\n    property Indexes [aIndexName : String] : TJSIDBIndex read index;\r\n  end;\r\n\r\n  { TJSIDBRequest }\r\n\r\n  TJSIDBRequest = class external name 'IDBRequest'  (TJSEventTarget)\r\n  private\r\n    Ferror : JSValue; external name 'error'; // standards are not quite clear on this one\r\n    FReadyState: string; external name 'readyState';\r\n    FResult: JSValue; external name 'result';\r\n    FResultDatabase: TIDBDatabase; external name 'result';\r\n    FResultIndex: TJSIDBIndex; external name 'result';\r\n    FResultObjectStore : TJSIDBObjectStore; external name 'result';\r\n    FResultCursor : TJSIDBCursor; external name 'result';\r\n    FSourceDatabase: TIDBDatabase; external name 'source';\r\n    FSourceIndex: TJSIDBIndex; external name 'source';\r\n    FSourceObjectStore : TJSIDBObjectStore; external name 'source';\r\n    FSourceCursor : TJSIDBCursor; external name 'source';\r\n    FSource: JSValue; external name 'source';\r\n    FTransaction: TJSIDBTransaction; external name 'transaction';\r\n  Public\r\n    onerror : TJSEventHandler;\r\n    onsuccess : TJSEventHandler;\r\n    Property error : JSValue read FError;\r\n    property readyState : string read FReadyState;\r\n\r\n    property result : JSValue read FResult;\r\n    property resultAsObjectStore : TJSIDBObjectStore read FResultObjectStore;\r\n    property resultAsCursor : TJSIDBCursor read FResultCursor;\r\n    property resultAsIndex : TJSIDBIndex read FResultIndex;\r\n    property resultAsDatabase : TIDBDatabase read FResultDatabase;\r\n\r\n    property source : JSValue read FSource;\r\n    property sourceAsObjectStore : TJSIDBObjectStore read FSourceObjectStore;\r\n    property sourceAsCursor : TJSIDBCursor read FSourceCursor;\r\n    property sourceAsIndex : TJSIDBIndex read FSourceIndex;\r\n    property sourceAsDatabase : TIDBDatabase read FSourceDatabase;\r\n\r\n    property transaction : TJSIDBTransaction read FTransaction;\r\n  end;\r\n\r\n  TJSIDBOpenDBRequest = class external name 'IDBOpenDBRequest' (TJSIDBRequest)\r\n  Public\r\n    onblocked : TJSEventHandler;\r\n    onupgradeneeded : TJSEventHandler;\r\n  end;\r\n\r\n  TJSCreateObjectStoreOptions = record\r\n    keyPath : jsValue;\r\n    autoIncrement : boolean;\r\n  end;\r\n\r\n  { TIDBDatabase }\r\n\r\n  TIDBDatabase = class external name 'IDBDatabase' (TJSEventTarget)\r\n  private\r\n    FName: string; external name 'name';\r\n    FobjectStoreNames: TStringDynArray; external name 'objectStoreNames';\r\n    FVersion: integer; external name 'version';\r\n  public\r\n    procedure close;\r\n    function createObjectStore(aName : string) : TJSIDBObjectStore; overload;\r\n    function createObjectStore(aName : string; Options: TJSCreateObjectStoreOptions) : TJSIDBObjectStore; overload;\r\n    procedure deleteObjectStore(aName : string);\r\n    function transaction(aStoreNames : array of string) : TJSIDBTransaction; overload;\r\n    function transaction(aStoreNames : array of string; aMode : string) : TJSIDBTransaction; overload;\r\n    property name : string read FName;\r\n    property version : integer read FVersion;\r\n    property objectStoreNames : TStringDynArray read FobjectStoreNames;\r\n  end;\r\n\r\n  TJSIDBFactory = class external name 'IDBFactory' (TJSEventTarget)\r\n  public\r\n    function open(aName : string) : TJSIDBOpenDBRequest;\r\n    function open(aName : string; aVersion : Integer) : TJSIDBOpenDBRequest;\r\n    function deleteDatabase(aName : string) : TJSIDBOpenDBRequest;\r\n    function cmp (a,b : jsValue) : NativeInt;\r\n  end;\r\n  \r\n  { TJSStorage }\r\n\r\n  TJSStorage = class external name 'Storage' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  public\r\n    function key(aIndex : Integer) : String;\r\n    function getItem(aKeyName : string) : string;\r\n    procedure setItem(aKeyName : string; aValue : string);\r\n    procedure removeItem(aKeyName : string);\r\n    procedure clear;\r\n    property Keys[AIndex : Integer] : String read key;\r\n    property Items[aKeyName: String] : String read getItem write setItem; default;\r\n    property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  // Fake object, used for objects whose visible can be checked\r\n  TJSVisibleItem = class external name 'IVisible'\r\n  Private\r\n    FVisible : boolean; external name 'visible';\r\n  Public\r\n    Property visible : boolean read FVisible;\r\n  end;\r\n  \r\n  TJSLocationBar = class external name 'LocationBar' (TJSVisibleItem);\r\n  TJSMenuBar = class external name 'MenuBar' (TJSVisibleItem);\r\n  TJSToolBar = class external name 'ToolBar' (TJSVisibleItem);\r\n  TJSPersonalBar = class external name 'PersonalBar' (TJSVisibleItem);\r\n  TJSScrollBars = class external name 'ScrollBars' (TJSVisibleItem);\r\n\r\n  TJSPositionError = record\r\n    code : integer;\r\n    message : string;\r\n  end;\r\n\r\n  TJSPositionOptions = record\r\n    enableHighAccuracy : boolean;\r\n    timeout : integer;\r\n    maximumAge : integer;\r\n  end;\r\n\r\n  TJSCoordinates = record\r\n    latitude : double;\r\n    longitude : double;\r\n    altitude : double;\r\n    accuracy : double;\r\n    altitudeAccuracy : double;\r\n    heading : double;\r\n    speed : double;\r\n  end;\r\n\r\n  TJSPosition = record\r\n    coords : TJSCoordinates;\r\n    timestamp : String;\r\n  end;\r\n\r\n  TJSGeoLocationCallback = procedure (aPosition : TJSPosition);\r\n  TJSGeoLocationEvent = procedure (aPosition : TJSPosition) of object;\r\n  TJSGeoLocationErrorCallback = procedure (aValue : TJSPositionError);\r\n  TJSGeoLocationErrorEvent = procedure (aValue : TJSPositionError) of object;\r\n\r\n  TJSGeoLocation  = class external name 'geolocation'\r\n  Public\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback); overload;\r\n    Procedure getCurrentPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions); overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback) : NativeInt; overload;\r\n    Function watchPosition(ASuccess : TJSGeoLocationCallback;aError : TJSGeoLocationErrorCallback; AOptions : TJSPositionOptions) : NativeInt; overload;\r\n    procedure clearWatch(AID : NativeInt);\r\n  end;\r\n\r\n  TJSMediaDevices = class external name 'MediaDevices' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSWorker = class external name 'Worker' (TJSEventTarget)\r\n  public\r\n    constructor new(aURL : string);\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure terminate;\r\n  end;\r\n\r\n  TJSMessagePort = class external name 'MessagePort' (TJSEventTarget)\r\n  Public\r\n    procedure close;\r\n    procedure postMessage(aValue : JSValue);\r\n    procedure postMessage(aValue : JSValue; aList : TJSValueDynArray);\r\n    procedure start;\r\n  end;\r\n\r\n  { TJSSharedWorker }\r\n\r\n  TJSSharedWorker = class external name 'SharedWorker' (TJSEventTarget)\r\n  private\r\n    FPort: TJSMessagePort; external name 'port';\r\n  Public\r\n    constructor new(aURL : String); overload;\r\n    constructor new(aURL : String; aName : string); overload;\r\n    property port : TJSMessagePort Read FPort;\r\n  end;\r\n\r\n  { TJSServiceWorker }\r\n\r\n  TJSServiceWorker = class external name 'ServiceWorker' (TJSWorker)\r\n  private\r\n    FscriptURL: String;  external name 'scriptURL';\r\n    FState: string;  external name 'state';\r\n  Public\r\n    property state : string read FState;\r\n    property scriptURL : String Read FscriptURL;\r\n  end;\r\n\r\n  { TJSServiceWorkerRegistration }\r\n\r\n  TJSServiceWorkerRegistration = class external name 'ServiceWorkerRegistration'\r\n  private\r\n    FActive: TJSServiceWorker; external name 'active';\r\n    FInstalling: TJSServiceWorker; external name 'installing';\r\n    FScope: string; external name 'scope';\r\n    FWaiting: TJSServiceWorker; external name 'waiting';\r\n  public\r\n    function unregister : TJSPromise;\r\n    procedure update;\r\n    property active : TJSServiceWorker read FActive;\r\n    property scope : string read FScope;\r\n    property waiting : TJSServiceWorker read FWaiting;\r\n    property installing : TJSServiceWorker read FInstalling;\r\n  end;\r\n\r\n  TJSServiceWorkerContainerOptions = record\r\n    scope : string;\r\n  end;\r\n\r\n  { TJSServiceWorkerContainer }\r\n\r\n  TJSServiceWorkerContainer = class external name 'ServiceWorkerContainer'\r\n  private\r\n    FController: TJSServiceWorker; external name 'controller';\r\n    FReady: TJSPromise; external name 'ready';\r\n  Public\r\n    function register(aURL : String) : TJSPromise; overload;\r\n    function register(aURL : String; aOptions : TJSServiceWorkerContainerOptions) : TJSPromise; overload;\r\n    function getRegistration(aURL : String) : TJSPromise; overload;\r\n    function getRegistration : TJSPromise; overload;\r\n    function getRegistrations : TJSPromise;\r\n    property controller : TJSServiceWorker read FController;\r\n    property ready : TJSPromise read FReady;\r\n  end;\r\n\r\n\r\n  { TJSNavigator }\r\n\r\n  TJSNavigator = class external name 'Navigator'\r\n{$IFDEF FIREFOX}\r\n    FbuildID : String ; external name 'buildID';\r\n    FOSCPU : String ; external name 'oscpu';\r\n    FproductSub : string; external name 'productSub';\r\n    FVendor : string; external name 'vendor';\r\n{$ENDIF}\r\n  private\r\n    FCookieEnabled: Boolean; external name 'cookieEnabled';\r\n    FGeoLocation: TJSGeoLocation; external name 'geoLocation';\r\n    FLanguage: String; external name 'language';\r\n    FMaxTouchPoints: NativeInt; external name 'maxTouchPoints';\r\n    FMediaDevices: TJSMediaDevices; external name 'mediaDevices';\r\n    FOnline: boolean; external name 'onLine';\r\n    FPlatform: string; external name 'platform';\r\n    FServiceWorker: TJSServiceWorkerContainer; external name 'serviceWorker';\r\n    FUserAgent: string; external name 'userAgent';\r\n  public\r\n    function getBattery : TJSPromise;\r\n    function requestMediaKeySystemAccess(aKeySystem : String; supportedConfigurations : TJSValueDynArray) : TJSPromise;\r\n    Procedure registerContentHandler(aMimeType,aURI,aTitle : string);\r\n    Procedure registerProtocolHandler(aProtocol,aURI,aTitle : string);\r\n    Procedure vibrate(aPattern : NativeInt);\r\n    Procedure vibrate(aPattern : Array of NativeInt);\r\n{$IFDEF FIREFOX}\r\n    property buildID : String read FBuildID;\r\n    property oscpu : string read FOSCPU;\r\n    property productSub: string read FproductSub;\r\n    property vendor : string read Fvendor;\r\n{$ENDIF}\r\n    property cookieEnabled : Boolean read FCookieEnabled;\r\n    property geoLocation : TJSGeoLocation Read FGeoLocation;\r\n    property language : String read FLanguage;\r\n    property maxTouchPoints : NativeInt read FMaxTouchPoints;\r\n    property mediaDevices : TJSMediaDevices read FMediaDevices;\r\n    property onLine : boolean read FOnline;\r\n    property platform : string read FPlatform;\r\n    property userAgent : string read FUserAgent;\r\n    property serviceWorker : TJSServiceWorkerContainer read FServiceWorker;\r\n  end;\r\n\r\n  { TJSTouchEvent }\r\n  TTouchCoord = longint;\r\n\r\n  TJSTouch = class external name 'Touch'\r\n  private\r\n    FClientX: TTouchCoord; external name 'clientX';\r\n    FClientY: TTouchCoord; external name 'clientY';\r\n    FIDentifier: longint; external name 'identifier';\r\n    FPageX: TTouchCoord; external name 'pageX';\r\n    FPageY: TTouchCoord; external name 'pageY';\r\n    FScreenX: TTouchCoord; external name 'screenX';\r\n    FScreenY: TTouchCoord; external name 'screenY';\r\n    FTarget: TJSElement; external name 'target';\r\n  Public\r\n    Property identifier : longint read FIDentifier;\r\n    Property ScreenX : TTouchCoord Read FScreenX;\r\n    Property ScreenY : TTouchCoord Read FScreenY;\r\n    Property ClientX : TTouchCoord Read FClientX;\r\n    Property ClientY : TTouchCoord Read FClientY;\r\n    Property PageX : TTouchCoord Read FPageX;\r\n    Property PageY : TTouchCoord Read FPageY;\r\n    Property Target : TJSElement Read FTarget;\r\n  end;\r\n\r\n  { TJSTouchList }\r\n\r\n  TJSTouchList = class external name 'TouchList'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item (aIndex : Integer) : TJSTouch;\r\n    property length : NativeInt Read FLength;\r\n    Property Touches[AIndex : Integer] : TJSTouch Read item; default;\r\n  end;\r\n\r\n\r\n  TJSPerformance = class external name 'Performance' (TJSObject);\r\n\r\n  TJSScreen = class external name 'Screen' (TJSObject);\r\n\r\n  TJSURL = class external name 'URL' (TJSObject);\r\n  \r\n  TJSCSSStyleDeclaration = class; // forward\r\n\r\n  TJSTimerCallBack = reference to procedure;\r\n\r\n  { TJSMediaQueryList }\r\n\r\n  TJSMediaQueryList = class external name 'MediaQueryList' (TJSObject)\r\n  private\r\n    FMatches: Boolean; external name 'matches';\r\n    FMedia: String; external name 'media';\r\n  Public\r\n    Property matches : Boolean Read FMatches;\r\n    Property media : String Read FMedia;\r\n  end;\r\n\r\n  { TJSWindow }\r\n  TJSDOMHighResTimeStamp = Double;\r\n  TFrameRequestCallback = procedure (aTime: TJSDOMHighResTimeStamp);\r\n\r\n  TJSWindowArray = Array of TJSWindow;\r\n  TJSWindow = class external name 'Window' (TJSObject)\r\n  Private\r\n    FClosed: boolean; external name 'closed';\r\n    FConsole : TJSConsole;  external name 'console';\r\n    FCrypto: TJSCrypto; external name 'crypto';\r\n    FDevicePixelRatio: Double; external name 'devicePixelRatio';\r\n    FDocument: TJSDocument; external name 'document';\r\n    FFrameElement: TJSElement; external name 'frameElement';\r\n    FFrames: TJSWindowArray; external name 'frames';\r\n    FHistory: TJSHistory; external name 'history';\r\n    FIndexedDB: TJSIDBFactory; external name 'indexedDB';\r\n    FInnerheight: NativeInt; external name 'innerHeight';\r\n    FInnerWidth: NativeInt; external name 'innerWidth';\r\n    FLength: NativeInt; external name 'length';\r\n    FLocalStorage: TJSStorage; external name 'localStorage';\r\n    FLocation: TJSLocation; external name 'location';\r\n    FLocationBar: TJSLocationBar; external name 'locationbar';\r\n    FLocationString: string; external name 'location';\r\n    FMenuBar: TJSMenuBar; external name 'menubar';\r\n    FNavigator: TJSNavigator; external name 'navigator';\r\n    FOpener: TJSWindow; external name 'opener';\r\n    FOuterheight: NativeInt; external name 'outerHeight';\r\n    FOuterWidth: NativeInt; external name 'outerWidth';\r\n    FParent: TJSWindow; external name 'parent';\r\n    FPerformance: TJSPerformance; external name 'Performance';\r\n    FPersonalBar: TJSPersonalBar; external name 'personalbar';\r\n    FScreen: TJSScreen; external name 'screen';\r\n    FScreenX: NativeInt; external name 'screenX';\r\n    FScreenY: NativeInt; external name 'screenY';\r\n    FScrollbar: TJSScrollBars; external name 'scrollbar';\r\n    FScrollX: NativeInt; external name 'scrollX';\r\n    FScrollY: NativeInt; external name 'scrollY';\r\n    FSelf: TJSWindow; external name 'self';\r\n    FSessionStorage: TJSStorage; external name 'sessionStorage';\r\n    FToolBar: TJSToolBar; external name 'toolbar';\r\n    FTop: TJSWindow; external name 'top';\r\n    FURL: TJSURL; external name 'URL';\r\n  Public\r\n    fullSreen : Boolean;   \r\n    name : string;\r\n    status : string;\r\n    onabort : TJSEventHandler;\r\n    onafterprint : TJSEventHandler;\r\n    onbeforeprint : TJSEventHandler;\r\n    onbeforeinstallprompt : TJSEventHandler;\r\n    onbeforeunloadprompt : TJSEventHandler;\r\n    onblur : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    onhashchange : TJSHashChangeEventhandler;\r\n    oninput : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onlanguagechange : TJSEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onmessage : TJSEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onoffline : TJSEventHandler;\r\n    ononline : TJSEventHandler;\r\n    onpagehide : TJSPageTransitionEventHandler;\r\n    onpageshow : TJSPageTransitionEventHandler;\r\n    onpaint : TJSEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onpopstate : TJSPopStateEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onstorage : TJSStorageEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onunload : TJSUIEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    procedure addEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure addEventListener(aname : string; aListener : JSValue);\r\n    Procedure alert(Const Msg : String);\r\n    Function atob(Const aValue : string) : string;\r\n    procedure blur;\r\n    Procedure clearInterval(aID: NativeInt);\r\n    Procedure clearTimeout(aID: NativeInt);\r\n    Function btoa(Const aValue : string) : string;\r\n    procedure cancelAnimationFrame(aHandle: Integer);\r\n    Procedure close;\r\n    Function confirm(Const aMsg : String) :  boolean;\r\n    procedure focus;\r\n    Function getComputedStyle(aElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    Function getComputedStyle(aElement,aPseudoElement : TJSElement) : TJSCSSStyleDeclaration; overload;\r\n    function matchMedia(aQuery : String) : TJSMediaQueryList;\r\n    procedure moveBy(x,y : NativeInt);\r\n    procedure moveTo(x,y : NativeInt);\r\n    function open : TJSWindow;\r\n    function open(Const aURL : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String) : TJSWindow; overload;\r\n    function open(Const aURL,aTarget : String; AOptions : TJSObject) : TJSWindow; overload;\r\n    procedure print;\r\n    function prompt(const aMessage : String) : String; overload;\r\n    function prompt(const aMessage,aDefault : String) : String; overload;\r\n    procedure removeEventListener(aname : string; aListener : TJSEventHandler);\r\n    procedure removeEventListener(aname : string; aListener : JSValue);\r\n    function requestAnimationFrame(aCallback: TFrameRequestCallback): Integer;\r\n    procedure resizeBy(aWidth,aHeight : NativeInt);\r\n    procedure resizeTo(aWidth,aHeight : NativeInt);\r\n    procedure scrollBy(x,y : NativeInt);\r\n    procedure scrollTo(x,y : NativeInt);\r\n    Function setInterval(ahandler : TJSTimerCallBack; aInterval : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack; aTimeout : NativeUInt) : NativeInt; varargs;\r\n    Function setTimeout(ahandler : TJSTimerCallBack) : NativeInt;\r\n    procedure stop;\r\n    { public methods }\r\n    property console : TJSConsole Read FConsole;\r\n    property closed : boolean read FClosed;\r\n    property crypto : TJSCrypto Read FCrypto;\r\n    property devicePixelRatio : Double read FDevicePixelRatio;\r\n    property document : TJSDocument read FDocument;\r\n    property frameElement : TJSElement Read FFrameElement;\r\n    Property frames  : TJSWindowArray read FFrames;\r\n    Property history : TJSHistory read FHistory;\r\n    Property indexedDB : TJSIDBFactory read FIndexedDB;\r\n    Property innerHeight : NativeInt Read FInnerheight;\r\n    Property innerWidth : NativeInt Read FInnerWidth;\r\n    Property length : NativeInt Read FLength;\r\n    Property localStorage : TJSStorage Read FLocalStorage; \r\n    property location : TJSLocation Read FLocation;\r\n    Property locationString : String read FLocationString write FLocationString;\r\n    property locationbar : TJSLocationBar Read FLocationBar;\r\n    property menubar : TJSMenuBar Read FMenuBar;\r\n    property navigator : TJSNavigator Read FNavigator;\r\n    property opener : TJSWindow read FOpener;\r\n    Property outerHeight : NativeInt Read FOuterheight;\r\n    Property outerWidth : NativeInt Read FOuterWidth;\r\n    Property parent : TJSWindow Read FParent;\r\n    Property Performance : TJSPerformance Read FPerformance;\r\n    property personalbar : TJSPersonalBar Read FPersonalBar;\r\n    property screen : TJSScreen read FScreen;\r\n    property screenX : NativeInt read FScreenX;\r\n    Property screenY : NativeInt read FScreenY;\r\n    Property scrollbar : TJSScrollBars Read FScrollbar;\r\n    property scrollX : NativeInt read FScrollX;\r\n    Property scrollY : NativeInt read FScrollY;\r\n    Property _Self : TJSWindow read FSelf;\r\n    Property sessionStorage : TJSStorage Read FSessionStorage; \r\n    property toolbar : TJSToolBar Read FToolBar;\r\n    property top : TJSWindow Read FTop;\r\n    property URL : TJSURL Read FURL; \r\n  end;\r\n\r\n  { TJSCSSStyleDeclaration }\r\n\r\n  TJSCSSStyleDeclaration = class external name 'CSSStyleDeclaration'\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n    FParentRule: TJSCSSRule; external name 'parentRule';\r\n  public\r\n    cssText : string;\r\n    function item(aIndex : Integer) : string;\r\n    function removeProperty(const aProperty : String) : string;\r\n    function getPropertyPriority(const aProperty : String) : string;\r\n    function getPropertyValue(const aProperty : String) : string;\r\n    procedure setProperty(const aProperty,aValue : String);overload;\r\n    procedure setProperty(const aProperty,aValue,aPriority : string); overload;\r\n    property length : NativeInt read FLength;\r\n    property parentRule : TJSCSSRule read FParentRule;\r\n  end;\r\n\r\n\r\n\r\n\r\n\r\n  { TJSHTMLElement }\r\n  TJSHTMLElement = class external name 'HTMLELement' (TJSElement)\r\n  private\r\n    FDataset: TJSObject ; external name 'dataset';\r\n    FIsContentEditable: Boolean ; external name 'isContentEditable';\r\n    FOffsetHeight: Double; external name 'offsetHeight';\r\n    FOffsetLeft: Double; external name 'offsetLeft';\r\n    FOffsetParent: TJSElement; external name 'offsetParent';\r\n    FOffsetTop: Double; external name 'offsetTop';\r\n    FOffsetWidth: Double; external name 'offsetWidth';\r\n  Public\r\n    accessKey : string;\r\n    contentEditable : string;\r\n    dir : string;\r\n    draggable : boolean;\r\n    hidden : boolean;\r\n    lang : string;\r\n    spellcheck : boolean;\r\n    style : TJSCSSStyleDeclaration;\r\n    tabIndex : Integer;\r\n    title: string;\r\n    onabort : TJSEventHandler;\r\n    onanimationcancel: THTMLAnimationEventHandler;\r\n    onanimationend: THTMLAnimationEventHandler;\r\n    onblur : TJSEventHandler;\r\n    oncancel : TJSEventHandler;\r\n    oncanplay : TJSEventHandler;\r\n    oncanplaythrough : TJSEventHandler;\r\n    onchange : TJSEventHandler;\r\n    onclick: THTMLClickEventHandler;\r\n    onclose : TJSEventHandler;\r\n    oncontextmenu : TJSEventHandler;\r\n    ondblclick : THTMLClickEventHandler;\r\n    ondrag : TJSDragDropEventHandler;\r\n    ondragend : TJSDragDropEventHandler;\r\n    ondragenter : TJSDragDropEventHandler;\r\n    ondragexit : TJSDragDropEventHandler;\r\n    ondragover : TJSDragDropEventHandler;\r\n    ondragleave : TJSDragDropEventHandler;\r\n    ondragstart: TJSDragDropEventHandler;\r\n    ondrop : TJSDragDropEventHandler;\r\n    onerror : TJSErrorEventHandler;\r\n    onfocus : TJSFocusEventhandler;\r\n    ondurationchange : TJSEventHandler;\r\n    onemptied : TJSEventHandler;\r\n    onended : TJSEventHandler;\r\n    ongotpointercapture : TJSPointerEventHandler;\r\n    oninput : TJSEventhandler;\r\n    oninvalid : TJSEventhandler;\r\n    onkeydown : TJSKeyEventhandler;\r\n    onkeypress : TJSKeyEventhandler;\r\n    onkeyup : TJSKeyEventhandler;\r\n    onload : TJSEventhandler;\r\n    onloadeddata : TJSEventhandler;\r\n    onloadedmetadata : TJSEventhandler;\r\n    onloadend : TJSLoadEventhandler;\r\n    onloadstart : TJSLoadEventhandler;\r\n    onlostpointercapture : TJSPointerEventHandler;\r\n    onmousedown : TJSMouseEventHandler;\r\n    onmouseenter : TJSMouseEventHandler;\r\n    onmouseleave : TJSMouseEventHandler;\r\n    onmousemove : TJSMouseEventHandler;\r\n    onmouseout : TJSMouseEventHandler;\r\n    onmouseover : TJSMouseEventHandler;\r\n    onmouseup : TJSMouseEventHandler;\r\n    onmousewheel : TJSMouseEventHandler;\r\n    onpause : TJSPointerEventHandler;\r\n    onplay : TJSPointerEventHandler;\r\n    onplaying : TJSPointerEventHandler;\r\n    onpointercancel : TJSPointerEventHandler;\r\n    onpointerdown : TJSPointerEventHandler;\r\n    onpointerenter : TJSPointerEventHandler;\r\n    onpointerleave : TJSPointerEventHandler;\r\n    onpointermove : TJSPointerEventHandler;\r\n    onpointerout : TJSPointerEventHandler;\r\n    onpointerover : TJSPointerEventHandler;\r\n    onpointerup : TJSPointerEventHandler;\r\n    onpointerlockchange : TJSPointerEventHandler;\r\n    onprogress : TJSProgressEventhandler;\r\n    onseeked : TJSEventHandler;\r\n    onseeking : TJSEventHandler;\r\n    onreset : TJSUIEventHandler;\r\n    onscroll : TJSUIEventHandler;\r\n    onselect : TJSEventHandler;\r\n    onselectstart : TJSEventHandler;\r\n    onselectionchange : TJSEventHandler;\r\n    onshow : TJSEventHandler;\r\n    onstalled : TJSEventHandler;\r\n    ontimeupdate : TJSEventHandler;\r\n    ontransitioncancel : TJSEventHandler;\r\n    ontransitionend : TJSEventHandler;\r\n    onvolumechange : TJSEventHandler;\r\n    onsubmit : TJSEventHandler;\r\n    onwheel : TJSMouseWheelEventHandler;\r\n    onwaiting : TJSEventHandler;\r\n    touchstart : TJSTouchEventHandler;\r\n    touchend : TJSTouchEventHandler;\r\n    touchmove : TJSTouchEventHandler;\r\n    touchcancel : TJSTouchEventHandler;\r\n    Procedure blur;\r\n    Procedure focus;\r\n    Procedure click;\r\n    property dataset : TJSObject read FDataset;\r\n    property isContentEditable : Boolean read FIsContentEditable;\r\n    property offsetHeight : Double Read FOffsetHeight;\r\n    property offsetLeft : Double Read FOffsetLeft;\r\n    property offsetTop : Double Read FOffsetTop;\r\n    property offsetWidth : Double Read FOffsetWidth;\r\n    property offsetParent : TJSElement Read FOffsetParent;\r\n  end;\r\n\r\n  TJSHTMLFormControlsCollection = class external name 'HTMLFormControlsCollection' (TJSHTMLCollection)\r\n  Public\r\n    function namedItem(S : String) : TJSElement; reintroduce; external name 'namedItem';\r\n    property Items[S : String] : TJSElement read namedItem; default;\r\n  end;\r\n\r\n  { TJSHTMLFormElement }\r\n\r\n  TJSHTMLFormElement = class external name 'HTMLFormElement' (TJSHTMLElement)\r\n  private\r\n    FElements: TJSHTMLFormControlsCollection; external name 'elements';\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    method : string;\r\n    target : string;\r\n    action : string;\r\n    encoding : string;\r\n    enctype : string;\r\n    acceptCharset :  string;\r\n    autocomplete : string;\r\n    noValidate : boolean;\r\n    property elements : TJSHTMLFormControlsCollection read FElements;\r\n    Property length : NativeInt Read FLength;\r\n  end;\r\n\r\n  { TJSValidityState }\r\n\r\n  TJSValidityState = class external name 'ValidityState'\r\n  private\r\n    FBadInput: Boolean; external name 'badInput';\r\n    FCustomError: Boolean; external name 'customError';\r\n    FPatternMismatch: Boolean; external name 'patternMisMatch';\r\n    FRangeOverflow: Boolean; external name 'rangeOverflow';\r\n    FRangeUnderflow: Boolean; external name 'rangeUnderflow';\r\n    FStepMismatch: Boolean; external name 'stepMismatch';\r\n    FTooLong: Boolean; external name 'tooLong';\r\n    FTooShort: Boolean; external name 'tooShort';\r\n    FTypeMismatch: Boolean; external name 'typeMisMatch';\r\n    FValid: Boolean; external name 'valid';\r\n    FValueMissing: Boolean; external name 'valueMissing';\r\n  public\r\n    property badInput : Boolean read FBadInput;\r\n    property customError : Boolean read FCustomError;\r\n    property patternMisMatch : Boolean read FPatternMismatch;\r\n    property rangeOverflow : Boolean read FRangeOverflow;\r\n    property rangeUnderflow : Boolean read FRangeUnderflow;\r\n    property stepMismatch : Boolean read FStepMismatch;\r\n    property tooLong : Boolean read FTooLong;\r\n    property tooShort : Boolean read FTooShort;\r\n    property typeMisMatch : Boolean read FTypeMismatch;\r\n    property valid : Boolean Read FValid;\r\n    property valueMissing : Boolean read FValueMissing;\r\n  end;\r\n\r\n  { TJSBlob }\r\n\r\n  TJSBlob = class external name 'Blob' (TJSEventTarget)\r\n  private\r\n    FSize: NativeInt; external name 'size';\r\n    FType: string; external name  'type';\r\n  Public\r\n    procedure close;\r\n    function slice : TJSBlob; overload;\r\n    function slice(aStart : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt) : TJSBlob; overload;\r\n    function slice(aStart,aEnd : NativeInt; AContentType : String) : TJSBlob; overload;\r\n    property size : NativeInt read FSize;\r\n    property _type : string read FType;\r\n  end;\r\n\r\n\r\n  { TJSHTMLFile }\r\n\r\n  TJSHTMLFile = class external name 'File' (TJSBlob)\r\n  private\r\n    FLastModified: NativeInt; external name 'lastModified';\r\n    FLastModifiedDate: TJSDate; external name 'lastModifiedDate';\r\n    FName: string; external name 'name';\r\n  Public\r\n    property name : string read FName;\r\n    property lastModified : NativeInt read FLastModified;\r\n    property lastModifiedDate : TJSDate read FLastModifiedDate;\r\n  end;\r\n\r\n  { TJSHTMLFileList }\r\n\r\n  TJSHTMLFileList = class external name 'FileList' (TJSEventTarget)\r\n  private\r\n    FLength: NativeInt; external name 'length';\r\n  Public\r\n    function item(aIndex : NativeInt) : TJSHTMLFile;\r\n    property length : NativeInt read FLength;\r\n    property Files[aIndex : NativeInt] : TJSHTMLFile Read item; default;\r\n  end;\r\n\r\n   { TJSHTMLInputElement }\r\n  // https://html.spec.whatwg.org/multipage/forms.html#the-input-element\r\n\r\n  TJSHTMLInputElement = class external name 'HTMLInputElement' (TJSHTMLElement)\r\n  private\r\n    FFiles: TJSHTMLFileList; external name 'files';\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FList: TJSHTMLElement; external name 'list';\r\n    FValidationmMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    FWillValidate: boolean; external name 'willValidate';\r\n  Public\r\n    procedure select;\r\n    procedure setCustomValidity(aText : string);\r\n    procedure stepUp; overload;\r\n    procedure stepUp(n : Integer); overload;\r\n    function checkValidity : Boolean;\r\n    function reportValidity : Boolean;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setSelectionRange(selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt) ; overload;\r\n    procedure setRangeText(aText : string; selectionStart, selectionEnd: NativeInt; Direction : string) ; overload;\r\n  Public\r\n    accept : string;\r\n    allowDirs : boolean;\r\n    align : string;\r\n    alt : string;\r\n    autofocus : boolean;\r\n    autocapitalize : string;\r\n    autocomplete : string;\r\n    defaultValue : string;\r\n    defaultChecked : string;\r\n    checked : boolean;\r\n    dirName : string;\r\n    disabled : boolean;\r\n    formAction : string;\r\n    formEncType : string;\r\n    formMethod : string;\r\n    formNoValidate : Boolean;\r\n    formTarget : string;\r\n    height : Boolean;\r\n    indeterminate : boolean;\r\n    inputMode : string;\r\n    max : string;\r\n    maxLength : NativeInt;\r\n    min : string;\r\n    minLength : NativeInt;\r\n    multiple : boolean;\r\n    pattern : string;\r\n    placeholder : string;\r\n    readOnly : boolean;\r\n    required : boolean;\r\n    size : NativeInt;\r\n    src : string;\r\n    step : string;\r\n    _type : string; external name 'type';\r\n    selectionStart : NativeInt;\r\n    selectionEnd : NativeInt;\r\n    selectionDirection : string;\r\n    useMap : string;\r\n    value : string;\r\n    width : NativeInt;\r\n    property files : TJSHTMLFileList Read FFiles;\r\n    property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList read FLabels;\r\n    property list : TJSHTMLElement Read FList;\r\n    property validationMessage : string read FValidationmMessage;\r\n    property willValidate : boolean read FWillValidate;\r\n    property validity : TJSValidityState read FValidity;\r\n  end;\r\n\r\n  { TJSHTMLOptionElement }\r\n\r\n  TJSHTMLOptionElement = class external name 'Option' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FIndex: NativeInt; external name 'index';\r\n  Public\r\n    Constructor New; overload;\r\n    Constructor New(aText : String); overload;\r\n    Constructor New(aText,aValue : String); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected : Boolean); overload;\r\n    Constructor New(aText,aValue : String; aDefaultSelected,Selected : Boolean); overload;\r\n  Public\r\n    defaultSelected : boolean;\r\n    disabled : boolean;\r\n    _label : string ; external name 'label';\r\n    selected : boolean;\r\n    text : string;\r\n    value : string;\r\n    property index : NativeInt Read FIndex;\r\n    property form : TJSHTMLFormElement Read FForm;\r\n  end;\r\n\r\n  TJSHTMLOptGroupElement = class external name 'HTMLOptGroupElement' (TJSHTMLElement)\r\n  end;\r\n\r\n  TJSHTMLOptionsCollection = class external name 'HTMLOptionsCollection' (TJSHTMLCollection)\r\n  end;\r\n\r\n  { TJSHTMLSelectElement }\r\n\r\n  TJSHTMLSelectElement = Class external name 'HTMLSelectElement' (TJSHTMLElement)\r\n  private\r\n    FForm: TJSHTMLFormElement; external name 'form';\r\n    FLabels: TJSNodeList; external name 'labels';\r\n    FLength: NativeInt; external name 'length';\r\n    FOptions: TJSHTMLOptionsCollection; external name 'options';\r\n    FSelectedOptions: TJSHTMLCollection; external name 'selectedOptions';\r\n    FType: String; external name 'type';\r\n    FValidationMessage: string; external name 'validationMessage';\r\n    FValidity: TJSValidityState; external name 'validity';\r\n    fwillValidate: Boolean; external name 'willValidate';\r\n  Public\r\n    Procedure add(anItem : TJSHTMLOptionElement); overload;\r\n    Procedure add(anItem, before : TJSHTMLOptionElement); overload;\r\n    function item(aIndex : NativeInt): TJSHTMLOptionElement;\r\n    function namedItem(aName : String): TJSHTMLOptionElement;\r\n    procedure remove(aIndex : NativeInt);\r\n    procedure checkValidity;\r\n    procedure setCustomValidity(aMessage : String);\r\n  Public\r\n    multiple : boolean;\r\n    required: boolean;\r\n    selectedIndex : NativeInt;\r\n    size : NativeInt;\r\n    value : string;\r\n    property length : NativeInt read FLength;\r\n    Property options : TJSHTMLOptionsCollection read FOptions;\r\n    Property selectedOptions : TJSHTMLCollection read FSelectedOptions;\r\n    Property form : TJSHTMLFormElement read FForm;\r\n    property labels : TJSNodeList Read FLabels;\r\n    property _type : String Read FType;\r\n    property validity : TJSValidityState Read FValidity;\r\n    property validationMessage : string Read FValidationMessage;\r\n    property willValidate : Boolean read fwillValidate;\r\n  end;\r\n\r\n  { TJSHTMLTableElement }\r\n\r\n  TJSHTMLTableSectionElement = class;\r\n  TJSHTMLTableRowElement = class;\r\n\r\n  TJSHTMLTableElement = Class external name 'HTMLTableElement'(TJSHTMLElement)\r\n  private\r\n    FAlign: String; external name 'align';\r\n    FBGColor: String; external name 'bgColor';\r\n    FBorder: String; external name 'border';\r\n    FCaption: TJSHTMLElement; external name 'caption';\r\n    FCellPadding: String; external name 'cellPadding';\r\n    FCellSpacing: String; external name 'cellSpacing';\r\n    FFrame: String; external name 'frame';\r\n    FRows: TJSHTMLCollection; external name 'rows';\r\n    FRules: String; external name 'rules';\r\n    FSummary: String; external name 'summary';\r\n    FTBodies: TJSHTMLCollection; external name 'tBodies';\r\n    FTfoot: TJSHTMLTableSectionElement; external name 'tfoot';\r\n    FTHead: TJSHTMLTableSectionElement; external name 'tHead';\r\n    FWidth: String; external name 'width';\r\n  public\r\n  { Methods }\r\n    function createCaption: TJSHTMLElement;\r\n    function createTFoot: TJSHTMLTableSectionElement;\r\n    function createTHead: TJSHTMLTableSectionElement;\r\n    procedure deleteCaption;\r\n    procedure deleteRow(index: Integer);\r\n    procedure deleteTFoot;\r\n    procedure deleteTHead;\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read FAlign write FAlign;\r\n    property bgColor: String read FBGColor write FBGColor;\r\n    property border: String read FBorder write FBorder;\r\n    property caption: TJSHTMLElement read FCaption;\r\n    property cellPadding: String read FCellPadding write FCellPadding;\r\n    property cellSpacing: String read FCellSpacing write FCellSpacing;\r\n    property frame: String read FFrame write FFrame;\r\n    property rows: TJSHTMLCollection read FRows;\r\n    property rules: String read FRules write FRules;\r\n    property summary: String read FSummary write FSummary;\r\n    property tBodies: TJSHTMLCollection read FTBodies;\r\n    property tfoot: TJSHTMLTableSectionElement read FTfoot;\r\n    property tHead: TJSHTMLTableSectionElement read FTHead;\r\n    property width: String read FWidth write FWidth;\r\n  end;\r\n\r\n  { TJSHTMLTableSectionElement }\r\n\r\n  TJSHTMLTableSectionElement = Class external name 'HTMLTableSectionElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    Frows: TJSHTMLCollection external name 'rows';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteRow(index: Integer);\r\n    function insertRow(index: Integer): TJSHTMLTableRowElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property rows: TJSHTMLCollection read Frows;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableCellElement }\r\n\r\n  TJSHTMLTableCellElement = Class external name 'HTMLTableCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n    Falign: String; external name 'align';\r\n    Faxis: String; external name 'axis';\r\n    FbgColor: String; external name 'bgColor';\r\n    FcellIndex: Integer; external name 'cellIndex';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FcolSpan: Integer; external name 'colSpan';\r\n    Fheaders: String; external name 'headers';\r\n    Fheight: String; external name 'height';\r\n    FnoWrap: Boolean; external name 'noWrap';\r\n    FrowSpan: Integer; external name 'rowSpan';\r\n    Fscope: String; external name 'scope';\r\n    FvAlign: String; external name 'vAlign';\r\n    Fwidth: String; external name 'width';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n    property align: String read Falign write Falign;\r\n    property axis: String read Faxis write Faxis;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cellIndex: Integer read FcellIndex;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property colSpan: Integer read FcolSpan write FcolSpan;\r\n    property headers: String read Fheaders write Fheaders;\r\n    property height: String read Fheight write Fheight;\r\n    property noWrap: Boolean read FnoWrap write FnoWrap;\r\n    property rowSpan: Integer read FrowSpan write FrowSpan;\r\n    property scope: String read Fscope write Fscope;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n    property width: String read Fwidth write Fwidth;\r\n  end;\r\n\r\n  { TJSHTMLTableRowElement }\r\n\r\n  TJSHTMLTableRowElement = Class external name 'HTMLTableRowElement' (TJSHTMLElement)\r\n  private\r\n    Falign: String; external name 'align';\r\n    FbgColor: String; external name 'bgColor';\r\n    Fcells: TJSHTMLCollection; external name 'cells';\r\n    Fch: String; external name 'ch';\r\n    FchOff: String; external name 'chOff';\r\n    FrowIndex: Integer; external name 'rowIndex';\r\n    FsectionRowIndex: Integer; external name 'sectionRowIndex';\r\n    FvAlign: String; external name 'vAlign';\r\n  public\r\n  { Methods }\r\n    procedure deleteCell(index: Integer);\r\n    function insertCell(index: Integer): TJSHTMLTableCellElement;\r\n  { Properties }\r\n    property align: String read Falign write Falign;\r\n    property bgColor: String read FbgColor write FbgColor;\r\n    property cells: TJSHTMLCollection read Fcells;\r\n    property ch: String read Fch write Fch;\r\n    property chOff: String read FchOff write FchOff;\r\n    property rowIndex: Integer read FrowIndex;\r\n    property sectionRowIndex: Integer read FsectionRowIndex;\r\n    property vAlign: String read FvAlign write FvAlign;\r\n  end;\r\n\r\n  { TJSHTMLTableDataCellElement }\r\n\r\n  TJSHTMLTableDataCellElement = Class external name 'HTMLTableDataCellElement' (TJSHTMLElement)\r\n  private\r\n    Fabbr: String; external name 'abbr';\r\n  public\r\n  { Properties }\r\n    property abbr: String read Fabbr write Fabbr;\r\n  end;\r\n\r\n\r\n  TJSCanvasRenderingContext2D = Class;\r\n\r\n  THTMLCanvasToBlobCallback = Reference to function (aBlob : TJSBlob) : boolean;\r\n\r\n  TJSHTMLCanvasElement = Class external name 'HTMLCanvasElement' (TJSHTMLElement)\r\n  Public\r\n    height : integer;\r\n    width : integer;\r\n    Function getContext(contextType : string) : TJSObject;\r\n    Function getContext(contextType : string; contextAttributes : TJSObject) : TJSObject;\r\n    Function getContextAs2DContext(contextType : string; contextAttributes : TJSObject) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Function getContextAs2DContext(contextType : string) : TJSCanvasRenderingContext2D; external name 'getContext';\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String); overload;\r\n    Procedure toBlob (aCallBack : THTMLCanvasToBlobCallback; aMimeType : String; aQuality : Double); overload;\r\n    Function toDataURL : String; overload;\r\n    Function toDataURL(aMimeType : String) : String; overload;\r\n    Function toDataURL(aMimeType : String; aQuality : Double) : String; overload;\r\n  end;\r\n\r\n  // Opaque objects\r\n  TJSCanvasGradient = class external name 'CanvasGradient'\r\n  end;\r\n\r\n  TJSCanvasPattern = class external name 'CanvasPattern'\r\n  end;\r\n\r\n  TJSPath2D = class external name 'Path2D'\r\n  end;\r\n\r\n  { TJSImageData }\r\n\r\n  TJSImageData = class external name 'ImageData'\r\n  private\r\n    FData: TJSUint8ClampedArray; external name 'data';\r\n    FHeight: Integer; external name 'height';\r\n    FWidth: Integer; external name 'width';\r\n  Public\r\n    constructor new(awidth,aheight : integer); overload;\r\n    constructor new(anArray :TJSUint8ClampedArray; awidth,aheight : integer); overload;\r\n    property data : TJSUint8ClampedArray read FData;\r\n    property height : Integer Read FHeight;\r\n    property width : Integer Read FWidth;\r\n  end;\r\n\r\n  TCanvasCoordType = double; // Is in fact a number.\r\n\r\n  TJSTextMetrics = record\r\n    width : TCanvasCoordType;\r\n    actualBoundingBoxLeft : TCanvasCoordType;\r\n    actualBoundingBoxRight : TCanvasCoordType;\r\n    fontBoundingBoxAscent : TCanvasCoordType;\r\n    fontBoundingBoxDescent : TCanvasCoordType;\r\n    actualBoundingBoxAscent : TCanvasCoordType;\r\n    actualBoundingBoxDescent : TCanvasCoordType;\r\n    emHeightAscent : TCanvasCoordType;\r\n    emHeightDescent : TCanvasCoordType;\r\n    hangingBaseline : TCanvasCoordType;\r\n    alphabeticBaseline : TCanvasCoordType;\r\n    ideographicBaseline : TCanvasCoordType;\r\n  end;\r\n\r\n  { TJSCanvasRenderingContext2D }\r\n  TJSCanvasRenderingContext2D = class external name 'CanvasRenderingContext2D'\r\n  private\r\n    FCanvas: TJSHTMLCanvasElement; external name 'canvas';\r\n    FfillStyleColor: String; external name 'fillStyle';\r\n    FfillStyleGradient: TJSCanvasGradient; external name 'fillStyle';\r\n    FfillStylePattern: TJSCanvasPattern; external name 'fillStyle';\r\n    FstrokeStyleColor: String; external name 'strokeStyle';\r\n    FstrokeStyleGradient: TJSCanvasGradient; external name 'strokeStyle';\r\n    FstrokeStylePattern: TJSCanvasPattern; external name 'strokeStyle';\r\n  Public\r\n    fillStyle : JSValue;\r\n    font : string;\r\n    globalAlpha : double;\r\n    globalCompositeOperation : String;\r\n    lineCap : string;\r\n    lineDashOffset : Double;\r\n    lineJoin : String;\r\n    lineWidth : Double;\r\n    miterLimit : Double;\r\n    shadowBlur : Double;\r\n    shadowColor : String;\r\n    shadowOffsetX : Double;\r\n    shadowOffsetY : Double;\r\n    strokeStyle : JSValue;\r\n    textAlign : String;\r\n    textBaseline : String;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType); overload;\r\n    procedure arc(x,y, radius,startAngle,endAngle : TCanvasCoordType; antiClockWise : boolean); overload;\r\n    procedure arcTo(x1,y1,x2,y2,radius : TCanvasCoordType); overload;\r\n    procedure beginPath;\r\n    procedure bezierCurveTo(cp1x,cp1y,cp2x,cp2y,x,y : TCanvasCoordType); overload;\r\n    procedure clearRect(x,y,width,height : TCanvasCoordType);\r\n    procedure clip; overload;\r\n    procedure clip(aFillRule : String); overload;\r\n    procedure clip(aPath : TJSPath2D); overload;\r\n    procedure closePath;\r\n    function createImageData(aWidth,aHeight : Integer) : TJSImageData; overload;\r\n    function createImageData(aImage : TJSImageData) : TJSImageData; overload;\r\n    function createLinearGradient(x0,y0,x1,y1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    function createPattern(aImage : TJSObject; repetition : string) : TJSCanvasPattern;\r\n    function createRadialGradient(x0,y0,r0,x1,y1,r1 : TCanvasCoordType) : TJSCanvasGradient;\r\n    procedure drawFocusIfNeeded(aElement : TJSElement); overload;\r\n    procedure drawFocusIfNeeded(aPath : TJSPath2D; aElement : TJSElement); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure drawImage(image : TJSObject; sx,sy,sWidth,sHeight,dx,dy,dwidth,dheight : TCanvasCoordType); overload;\r\n    procedure fill; overload;\r\n    procedure fill(aRule : String); overload;\r\n    procedure fill(aPath : TJSPath2D); overload;\r\n    procedure fill(aPath : TJSPath2D;aRule : String); overload;\r\n    procedure fillRect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure fillText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    function getImageData(x,y,awidth,aheight: TCanvasCoordType) : TJSImageData; overload;\r\n    function getLineDash : TJSArray;\r\n    function isPointInPath(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInPath(aPath : TJSPath2D; x,y : TCanvasCoordType; aFillRule : String) : Boolean; overload;\r\n    function isPointInStroke(x,y : TCanvasCoordType) : Boolean; overload;\r\n    function isPointInStroke(aPath : TJSPath2D; x,y : TCanvasCoordType) : Boolean; overload;\r\n    procedure lineTo(x,y : TCanvasCoordType);\r\n    function measureText(S : String) : TJSTextMetrics;\r\n    procedure moveTo(x,y : TCanvasCoordType);\r\n    procedure putImageData(aData : TJSImageData; x,y: TCanvasCoordType) ; overload;\r\n    procedure putImageData(aData : TJSImageData; x,y,dityX,dirtyY,dirtyWidth,dirtyHeight: TCanvasCoordType) ; overload;\r\n    procedure quadraticCurveTo(cpx,cpy,x,y : TCanvasCoordType);\r\n    procedure rect(x,y,awidth,aheight: TCanvasCoordType); overload;\r\n    procedure restore;\r\n    procedure rotate(anAngle : double);\r\n    procedure save;\r\n    procedure scale(x,y : double);\r\n    procedure setLineDash(segments : TJSArray); overload;\r\n    procedure setLineDash(segments : array of integer); overload;\r\n    procedure setTransform(a,b,c,d,e,f : double);\r\n    procedure stroke; overload;\r\n    procedure stroke(aPath : TJSPath2D); overload;\r\n    procedure strokeRect(x,y,awidth,aheight: TCanvasCoordType);\r\n    procedure strokeText(aText : string; x,y : TCanvasCoordType); overload;\r\n    procedure strokeText(aText : string; x,y, aMaxWidth : TCanvasCoordType); overload;\r\n    procedure transform(a,b,c,d,e,f : double);\r\n    procedure translate(x,y : TCanvasCoordType);\r\n\r\n    property canvas : TJSHTMLCanvasElement Read FCanvas;\r\n    property fillStyleAsColor : String Read FfillStyleColor Write FfillStyleColor;\r\n    property fillStyleAsGradient : TJSCanvasGradient Read FfillStyleGradient Write FfillStyleGradient;\r\n    property fillStyleAsPattern : TJSCanvasPattern Read FfillStylePattern Write FfillStylePattern;\r\n    property strokeStyleAsColor : String Read FstrokeStyleColor Write FstrokeStyleColor;\r\n    property strokeStyleAsGradient : TJSCanvasGradient Read FstrokeStyleGradient Write FstrokeStyleGradient;\r\n    property strokeStyleAsPattern : TJSCanvasPattern Read FstrokeStylePattern Write FstrokeStylePattern;\r\n  end;\r\n\r\n  { TJSHTMLIFrameElement }\r\n\r\n  TJSHTMLIFrameElement = Class external name 'HTMLIFrameElement' (TJSHTMLElement)\r\n  private\r\n    FAllowPaymentRequest: Boolean; external name 'allowPaymentRequest';\r\n    FContentDocument: TJSDocument; external name 'contentDocument';\r\n    FContentWindow: TJSWindow; external name 'contentWindow';\r\n    FSandbox: string; external name 'sandbox';\r\n  Public\r\n    height : string;\r\n    src : string;\r\n    srcdoc : string;\r\n    width : string;\r\n    Property allowPaymentRequest : Boolean Read FAllowPaymentRequest;\r\n    property contentWindow : TJSWindow Read FContentWindow;\r\n    property contentDocument : TJSDocument Read FContentDocument;\r\n    property sandbox : string read FSandbox;\r\n  end;\r\n\r\n  TJSHTMLScriptElement = Class external name 'HTMLScriptElement' (TJSHTMLElement)\r\n  Public\r\n    type_ : String;\r\n    src : String;\r\n    charset : string;\r\n    async : boolean;\r\n    defer : boolean;\r\n    text : string;\r\n    noModule : boolean;\r\n  end;\r\n\r\n\r\n\r\n  TJSXMLHttpRequestEventTarget = class external name 'XMLHttpRequestEventTarget' (TJSEventTarget)\r\n  end;\r\n\r\n  TJSXMLHttpRequestUpload = class external name 'XMLHttpRequestUpload' (TJSXMLHttpRequestEventTarget)\r\n  end;\r\n\r\n  { TJSXMLHttpRequest }\r\n  TJSOnReadyStateChangeHandler = reference to procedure;\r\n\r\n  TJSXMLHttpRequest = class external name 'XMLHttpRequest' (TJSXMLHttpRequestEventTarget)\r\n  private\r\n    FReadyState: NativeInt; external name 'readyState';\r\n    FResponse: JSValue; external name 'response';\r\n    FResponseText: string; external name 'responseText';\r\n    FResponseType: string; external name 'responseType';\r\n    FresponseURL: string; external name 'responseURL';\r\n    FresponseXML: TJSDocument; external name 'responseXML';\r\n    FUpload: TJSXMLHttpRequestUpload; external name 'upload';\r\n    FStatus : integer; external name 'status';\r\n    FStatusText : string; external name 'statusText';\r\n  public\r\n    const\r\n      UNSENT           = 0;\r\n      OPENED           = 1;\r\n      HEADERS_RECEIVED = 3;\r\n      LOADING          = 3;\r\n      DONE             = 4;\r\n  public\r\n    timeout : LongWord;\r\n    withCredentials : Boolean;\r\n    onreadystatechange : TJSOnReadyStateChangeHandler;\r\n    constructor new;\r\n    procedure abort;\r\n    function getResponseHeader(aName : string) : String;\r\n    function getAllResponseHeaders : String;\r\n    procedure open(aMethod,aURL : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame : String); overload;\r\n    procedure open(aMethod,aURL : String; Async : Boolean; AUserame,APassword : String); overload;\r\n    procedure overrideMimeType(aType : String);\r\n    procedure send(aBody : jsValue);overload;\r\n    procedure send;overload;\r\n    procedure setRequestHeader(aName, AValue : string);\r\n\r\n    property readyState : NativeInt read FReadyState;\r\n    property ResponseHeaders[aName : string] : string Read getResponseHeader;\r\n    property responseXML : TJSDocument read FresponseXML;\r\n    property responseURL : string read FresponseURL;\r\n    property responseType : string read FResponseType;\r\n    property response : JSValue Read FResponse;\r\n    property responseText : string read FResponseText;\r\n    property Status : integer read FStatus;\r\n    property StatusText : string read FStatusText;\r\n    property upload : TJSXMLHttpRequestUpload read FUpload;\r\n\r\n  end;\r\n\r\n  { TJSUIEvent }\r\n\r\n  TJSUIEvent = class external name 'UIEvent' (TJSEvent)\r\n  private\r\n    FDetail: NativeInt; external name 'detail';\r\n    FView: TJSWindow; external name 'view';\r\n  Public\r\n    property detail : NativeInt read FDetail;\r\n    property view : TJSWindow read FView;\r\n  end;\r\n\r\n  { TJSMouseEvent }\r\n\r\n  TJSMouseEvent = class external name 'MouseEvent' (TJSUIevent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FBUtton: NativeInt; external name 'button';\r\n    FBUttons: NativeInt; external name 'buttons';\r\n    FClientX: Double; external name 'clientX';\r\n    FClientY: Double; external name 'clientY';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FmovementX: Double; external name 'movementX';\r\n    FmovementY: Double; external name 'movementY';\r\n    FoffsetX: Double; external name 'offsetX';\r\n    FoffsetY: Double; external name 'offsetY';\r\n    FRegion: String; external name 'region';\r\n    FRelatedTarget: TJSEventTarget; external name 'relatedTarget';\r\n    FscreenX: Double; external name 'screenX';\r\n    FscreenY: Double; external name 'screenY';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(keyArg: String): boolean;\r\n    Property altKey : Boolean read FAltKey;\r\n    Property button: NativeInt read FBUtton;\r\n    Property buttons: NativeInt read FBUttons;\r\n    property clientX : Double read FClientX;\r\n    property clientY : Double read FClientY;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property movementX : Double read FmovementX;\r\n    property movementY : Double read FmovementY;\r\n    property offsetX : Double read FoffsetX;\r\n    property offsetY : Double read FoffsetY;\r\n{$IFDEF FIREFOX}\r\n    property pageX : Double read FpageX;\r\n    property pageY : Double read FpageY;\r\n{$ENDIF}\r\n    property region : String read FRegion;\r\n    property relatedTarget : TJSEventTarget read FRelatedTarget;\r\n    property screenX : Double read FscreenX;\r\n    property screenY : Double read FscreenY;\r\n    property shiftKey : Boolean read FShiftKey;\r\n    property x : Double read FClientX;\r\n    property y : Double read FClientY;\r\n  end;\r\n\r\n  { TJSWheelEvent }\r\n  TJSWheelEventInit = record\r\n    deltaX : Double;\r\n    deltaY : Double;\r\n    deltaZ : Double;\r\n    deltaMode : NativeInt;\r\n  end;\r\n\r\n  TJSWheelEvent = class external name 'WheelEvent' (TJSMouseEvent)\r\n  private\r\n    FDeltaMode: NativeInt; external name 'deltaMode';\r\n    FDeltaX: Double; external name 'deltaX';\r\n    FDeltaY: Double; external name 'deltaY';\r\n    FDeltaZ: Double; external name 'deltaZ';\r\n  Public\r\n    constructor new(atype : String); overload;\r\n    constructor new(atype : String; aInit : TJSWheelEventInit); overload;\r\n    Property deltaX : Double Read FDeltaX;\r\n    Property deltaY : Double Read FDeltaY;\r\n    Property deltaZ : Double Read FDeltaZ;\r\n    Property deltaMode : NativeInt Read FDeltaMode;\r\n  end;\r\n\r\n  TJSPointerEvent = Class external name 'PointerEvent' (TJSMouseEvent);\r\n\r\n  TJSTouchEvent = Class external name 'TouchEvent'(TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FChangedTouches: TJSTouchList; external name 'changedTouches';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n    FTargetTouches: TJSTouchList; external name 'targetTouches';\r\n    FTouches: TJSTouchList; external name 'touches';\r\n  Public\r\n    Property altKey : Boolean Read FAltKey;\r\n    Property ctrlKey : Boolean Read FCtrlKey;\r\n    Property metaKey : Boolean Read FMetaKey;\r\n    Property shiftKey : Boolean Read FShiftKey;\r\n    property changedTouches : TJSTouchList Read FChangedTouches;\r\n    property touches : TJSTouchList Read FTouches;\r\n    property targetTouches : TJSTouchList Read FTargetTouches;\r\n  end;\r\n\r\n\r\n  // Namespace for standard key names.\r\n  // See list at https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/key/Key_Values\r\n  TJSKeyNames = Class\r\n  Const\r\n    Alt = 'Alt';\r\n    AltGraph = 'AltGraph';\r\n    CapsLock = 'CapsLock';\r\n    Control = 'Control';\r\n    Fn = 'Fn';\r\n    FnLock = 'FnLock';\r\n    Hyper = 'Hyper';\r\n    Meta = 'Meta';\r\n    NumLock = 'NumLock';\r\n    ScrollLock = 'ScrollLock';\r\n    Shift = 'Shift';\r\n    Super = 'Super';\r\n    Symbol = 'Symbol';\r\n    SymbolLock = 'SymbolLock';\r\n    Enter = 'Enter';\r\n    Tab = 'Tab';\r\n    Space = ' ';\r\n    ArrowDown = 'ArrowDown';\r\n    ArrowLeft = 'ArrowLeft';\r\n    ArrowRight = 'ArrowRight';\r\n    ArrowUp = 'ArrowUp';\r\n    _End = 'End';\r\n    Home = 'Home';\r\n    PageDown = 'PageDown';\r\n    PageUp = 'PageUp';\r\n    BackSpace = 'Backspace';\r\n    Clear = 'Clear';\r\n    Copy = 'Copy';\r\n    CrSel = 'CrSel';\r\n    Cut = 'Cut';\r\n    Delete = 'Delete';\r\n    EraseEof = 'EraseEof';\r\n    ExSel = 'ExSel';\r\n    Insert = 'Insert';\r\n    Paste = 'Paste';\r\n    Redo = 'Redo';\r\n    Undo = 'Undo';\r\n    Accept = 'Accept';\r\n    Again = 'Again';\r\n    Attn = 'Attn';\r\n    Cancel = 'Cancel';\r\n    ContextMenu = 'Contextmenu';\r\n    Escape = 'Escape';\r\n    Execute = 'Execute';\r\n    Find = 'Find';\r\n    Finish = 'Finish';\r\n    Help = 'Help';\r\n    Pause = 'Pause';\r\n    Play = 'Play';\r\n    Props = 'Props';\r\n    Select = 'Select';\r\n    ZoomIn = 'ZoomIn';\r\n    ZoomOut = 'ZoomOut';\r\n    BrightnessDown = 'BrightnessDown';\r\n    BrightnessUp = 'BrightnessUp';\r\n    Eject = 'Eject';\r\n    LogOff = 'LogOff';\r\n    Power = 'Power';\r\n    PowerOff = 'PowerOff';\r\n    PrintScreen = 'PrintScreen';\r\n    Hibernate = 'Hibernate';\r\n    Standby = 'Standby';\r\n    WakeUp = 'WakeUp';\r\n    AllCandidates = 'AllCandidates';\r\n    Alphanumeric =  'Alphanumeric';\r\n    CodeInput = 'CodeInput';\r\n    Compose = 'Compose';\r\n    Convert = 'Convert';\r\n    Dead = 'Dead';\r\n    FinalMode = 'FinalMode';\r\n    GroupFirst = 'GroupFirst';\r\n    GroupLast = 'GroupLast';\r\n    GroupNext = 'GroupNext';\r\n    GroupPrevious = 'GroupPrevious';\r\n    ModelChange = 'ModelChange';\r\n    NextCandidate = 'NextCandidate';\r\n    NonConvert = 'NonConvert';\r\n    PreviousCandidate = 'PreviousCandidate';\r\n    Process = 'Process';\r\n    SingleCandidate = 'SingleCandidate';\r\n    HangulMode = 'HangulMode';\r\n    HanjaMode = 'HanjaMode';\r\n    JunjaMode = 'JunjaMode';\r\n    Eisu = 'Eisu';\r\n    Hankaku = 'Hankaku';\r\n    Hiranga = 'Hiranga';\r\n    HirangaKatakana = 'HirangaKatakana';\r\n    KanaMode = 'KanaMode';\r\n    Katakana = 'Katakana';\r\n    Romaji = 'Romaji';\r\n    Zenkaku = 'Zenkaku';\r\n    ZenkakuHanaku = 'ZenkakuHanaku';\r\n    F1 = 'F1';\r\n    F2 = 'F2';\r\n    F3 = 'F3';\r\n    F4 = 'F4';\r\n    F5 = 'F5';\r\n    F6 = 'F6';\r\n    F7 = 'F7';\r\n    F8 = 'F8';\r\n    F9 = 'F9';\r\n    F10 = 'F10';\r\n    F11 = 'F11';\r\n    F12 = 'F12';\r\n    F13 = 'F13';\r\n    F14 = 'F14';\r\n    F15 = 'F15';\r\n    F16 = 'F16';\r\n    F17 = 'F17';\r\n    F18 = 'F18';\r\n    F19 = 'F19';\r\n    F20 = 'F20';\r\n    Soft1 = 'Soft1';\r\n    Soft2 = 'Soft2';\r\n    Soft3 = 'Soft3';\r\n    Soft4 = 'Soft4';\r\n    Decimal = 'Decimal';\r\n    Key11 = 'Key11';\r\n    Key12 = 'Key12';\r\n    Multiply = 'Multiply';\r\n    Add = 'Add';\r\n    NumClear = 'Clear';\r\n    Divide = 'Divide';\r\n    Subtract = 'Subtract';\r\n    Separator = 'Separator';\r\n    AppSwitch = 'AppSwitch';\r\n    Call = 'Call';\r\n    Camera = 'Camera';\r\n    CameraFocus = 'CameraFocus';\r\n    EndCall = 'EndCall';\r\n    GoBack = 'GoBack';\r\n    GoHome = 'GoHome';\r\n    HeadsetHook = 'HeadsetHook';\r\n    LastNumberRedial = 'LastNumberRedial';\r\n    Notification = 'Notification';\r\n    MannerMode = 'MannerMode';\r\n    VoiceDial = 'VoiceDial';\r\n    // TODO : Multimedia keys\r\n    // TODO : Audio control keys\r\n    // TODO : TV control keys\r\n    // TODO : Media controller keys\r\n    // TODO : Speech recognition keys\r\n    // TODO : Document keys\r\n    // TODO : Application selector keys\r\n    // TODO : Browser Control keys\r\n  end;\r\n\r\n\r\n  { TJSKeyboardEvent }\r\n\r\n  TJSKeyboardEvent = class external name 'KeyboardEvent' (TJSUIEvent)\r\n  private\r\n    FAltKey: Boolean; external name 'altKey';\r\n    FCode: string; external name 'code';\r\n    FCtrlKey: Boolean; external name 'ctrlKey';\r\n    FIsComposing: Boolean;  external name 'isComposing';\r\n    FKey: String; external name 'key';\r\n    FLocale: string; external name 'locale';\r\n    FLocation: NativeInt; external name 'location';\r\n    FMetaKey: Boolean; external name 'metaKey';\r\n    FRepeat: Boolean; external name 'repeat';\r\n    FShiftKey: Boolean; external name 'shiftKey';\r\n  Public\r\n    function getModifierState(aKey : string) : Boolean;\r\n    property code : string read FCode;\r\n    Property altKey : Boolean read FAltKey;\r\n    property ctrlKey : Boolean read FCtrlKey;\r\n    property isComposing : Boolean read FIsComposing;\r\n    property Key : String read FKey;\r\n    property locale : string read FLocale;\r\n    property location : NativeInt read FLocation;\r\n    property metaKey : Boolean read FMetaKey;\r\n    property _repeat : Boolean read FRepeat;\r\n    property shiftKey : Boolean read FShiftKey;\r\n  end;\r\n\r\n  TJSMessageEvent = class external name 'MessageEvent' (TJSevent)\r\n  private\r\n    FOrigin: string; external name 'origin';\r\n    FData: TJSObject; external name 'data';\r\n  public\r\n    property origin : string read FOrigin;\r\n    property data: TJSObject read FData;\r\n  end;\r\n\r\nvar\r\n  document : TJSDocument; external name 'document';\r\n  window : TJSWindow; external name 'window';\r\n  console : TJSConsole; external name 'window.console';\r\n  \r\nimplementation\r\n    \r\nend.\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2017 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit Math;\r\n\r\n{$mode objfpc}\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils;\r\n\r\nconst\r\n  MinInteger = -$10000000000000;\r\n  MaxInteger = $fffffffffffff;\r\n  MinDouble  =  5.0e-324;\r\n  MaxDouble  =  1.7e+308;\r\n\r\n\r\nvar // ToDo: make these const\r\n  NaN: Double; external name 'NaN';\r\n  Infinity: Double; external name 'Infinity';\r\n  NegInfinity: Double; external name '-Infinity';\r\n\r\ntype\r\n  float = double;\r\n\r\n  //EInvalidArgument = class(EMathError);\r\n\r\nfunction Min(const a, b: Integer): Integer; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Integer): Integer; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: Double): Double; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: Double): Double; varargs; external name 'Math.max'; overload;\r\nfunction Min(const a, b: NativeLargeInt): Double; varargs; external name 'Math.min'; overload;\r\nfunction Max(const a, b: NativeLargeUInt): Double; varargs; external name 'Math.max'; overload;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler; overload;\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler; overload;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler; overload;\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler; overload;\r\n\r\ntype\r\n  TRoundToRange = -37..37;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange = -2): Double;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nconst\r\n  NegativeValue = -1;\r\n  ZeroValue = 0;\r\n  PositiveValue = 1;\r\n\r\nfunction Sign(const AValue: Integer): Integer; external name 'Math.sign'; overload;\r\nfunction Sign(const AValue: Double): Double; external name 'Math.sign'; overload;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean; overload;\r\nfunction IsZero(const d: Double): Boolean; overload;\r\n\r\nfunction IsNaN(const v: JSValue): boolean; external name {$IFDEF ECMAScript5}'isNaN'{$ELSE}'Number.isNan'{$ENDIF}; overload;\r\nfunction IsFinite(const d: JSValue): Boolean; external name 'isFinite'; overload;// false if NaN, positive or negative infinity\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler; overload; // negative or positive infinity\r\n{$IFDEF ECMAScript6}\r\nfunction IsInteger(const d: JSValue): Boolean; external name 'Number.isInteger'; // any integer representable by a double\r\nfunction IsSafeInteger(const d: JSValue): Boolean; external name 'Number.isSafeInteger'; // an integer between MinInteger and MaxInteger, inclusive\r\n{$ENDIF}\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double = 0.0): Boolean; overload;\r\n\r\n// function Abs is in System.pas\r\nfunction ArcCos(const A : Double): Double; external name 'Math.acos';\r\nfunction ArcCosH(const A: Double): Double; external name 'Math.acosh'; // not on IE\r\nfunction ArcSin(const A : Double): Double; external name 'Math.asin';\r\nfunction ArcSinH(const A : Double): Double; external name 'Math.asinh'; // not on IE\r\nfunction ArcTanH(const A: Double): Double; external name 'Math.atanh'; // not on IE\r\nfunction CosH(const A: Double): Double; external name 'Math.cosh'; // not on IE\r\nfunction ExpM1(const A: Double): Double; external name 'Math.expm1'; // not on IE\r\nfunction FRound(const A: Double): Double; overload; external name 'Math.fround'; // not on IE\r\nfunction FTrunc(const A: Double): double; overload; external name 'Math.trunc'; // not on IE\r\nfunction Hypot(const A : Double): Double; varargs; external name 'Math.hypot'; // not on IE\r\nfunction IMul(const A, B: Integer): Integer; external name 'Math.imul'; // not on IE\r\nfunction Log10(const A: Double): Double; external name 'Math.log10';\r\nfunction Log1p(const A: Double): Double; external name 'Math.log1p'; // not on IE\r\nfunction Log2(const A: Double): Double; external name 'Math.log2'; // not on IE\r\nfunction LogN(const A, Base: Double): Double; \r\nfunction Power(const Base, Exponent: Double): Double; external name 'Math.pow';\r\n// ln, round, sqrt, trunc, cos, sin, arctan, round, exp are in unit system\r\nfunction Ceil(const A: Double): Integer;\r\nfunction Floor(const A: Double): Integer;\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\nfunction ldexp(x : double;const p : Integer) : double;\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\nfunction lnxp1(x : double) : double;\r\n\r\nfunction IntPower(base : float;const exponent : Integer) : double;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: SmallInt);\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result, Remainder: LongInt);\r\n\r\n{ Angle conversion }\r\nfunction DegToRad(deg : double) : double;\r\nfunction RadToDeg(rad : double) : double;\r\nfunction GradToRad(grad : double) : double;\r\nfunction RadToGrad(rad : double) : double;\r\nfunction DegToGrad(deg : double) : double;\r\nfunction GradToDeg(grad : double) : double;\r\n{ one cycle are 2*Pi rad }\r\nfunction CycleToRad(cycle : double) : double;\r\nfunction RadToCycle(rad : double) : double;\r\nFunction DegNormalize(deg : double) : double;\r\n\r\nfunction Norm(const data : array of double) : double;\r\n\r\n// Statistical functions\r\nfunction Mean(const data : array of double) : double;\r\nfunction Sum(const data : array of double) : double;\r\nprocedure SumsAndSquares(const data : Array of Double; out Sum,SumOfSquares : double);\r\n\r\nfunction StdDev(const data : array of Double) : float;\r\nprocedure MeanAndStdDev(const data : array of Double; out Mean,StdDev : double);\r\nfunction Variance(const data : array of Double) : double;\r\nfunction TotalVariance(const data : array of Double) : double;\r\nfunction PopNStdDev(const data : array of Double) : double;\r\nfunction PopNVariance(const data : array of Double) : double;\r\nprocedure MomentSkewKurtosis(const data : array of Double; out m1,m2,m3,m4,skew,kurtosis : double);\r\n\r\n// Financial functions\r\n\r\nType\r\n  TPaymentTime = (ptEndOfPeriod,ptStartOfPeriod);\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\n\r\n// Miscellaneous\r\n\r\nfunction IfThen(val:boolean;const ifTrue:integer; const ifFalse:integer= 0) :integer; overload;\r\nfunction IfThen(val:boolean;const ifTrue:double ; const ifFalse:double =0.0):double; overload;\r\n\r\nType\r\n  TValueRelationship = -1..1;\r\n\r\nconst\r\n  EqualsValue = 0;\r\n  LessThanValue = Low(TValueRelationship);\r\n  GreaterThanValue = High(TValueRelationship);\r\n\r\nfunction CompareValue ( const A, B  : Integer) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B  : NativeLargeUInt) : TValueRelationship;\r\nfunction CompareValue ( const A, B : Double; delta : Double = 0.0) : TValueRelationship;\r\n\r\nimplementation\r\n\r\nfunction InRange(const AValue, AMin, AMax: Integer): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction InRange(const AValue, AMin, AMax: Double): Boolean; assembler;\r\nasm\r\n  return (AValue >= AMin) && (AValue <= AMax);\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Integer): Integer; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction EnsureRange(const AValue, AMin, AMax: Double): Double; assembler;\r\nasm\r\n  if (AValue<AMin){ return AMin;\r\n  } else if (AValue>AMax){ return AMax;\r\n  } else return AValue;\r\nend;\r\n\r\nfunction RoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV:=IntPower(10,Digits);\r\n  Result:=Round(AValue/RV)*RV;\r\nend;\r\n\r\nfunction SimpleRoundTo(const AValue: Double; const Digits: TRoundToRange): Double;\r\nvar\r\n  RV : Double;\r\n\r\nbegin\r\n  RV := IntPower(10, -Digits);\r\n  if AValue < 0 then\r\n    Result := Int((AValue*RV) - 0.5)/RV\r\n  else\r\n    Result := Int((AValue*RV) + 0.5)/RV;\r\nend;\r\n\r\nfunction randg(mean,stddev : float) : float;\r\n\r\nVar\r\n  U1,S2 : Float;\r\n\r\nbegin\r\n  repeat\r\n    u1:= 2*random-1;\r\n    S2:=Sqr(U1)+sqr(2*random-1);\r\n  until s2<1;\r\n  Result:=Sqrt(-2*ln(S2)/S2)*u1*stddev+Mean;\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: Integer): Integer;\r\nbegin\r\n  Result:=Random(Abs(aFrom-aTo))+Min(aTo,AFrom);\r\nend;\r\n\r\n\r\nfunction RandomRange(const aFrom, aTo: NativeLargeInt): NativeLargeInt;\r\n\r\nVar\r\n  m : NativeLargeInt;\r\nbegin\r\n  if aFrom<aTo then\r\n    M:=aFrom\r\n  else\r\n    M:=aTo;\r\n  Result:=Random(Abs(aFrom-aTo))+M;\r\nend;\r\n\r\nconst\r\n  DZeroResolution = 1E-12;\r\n\r\nfunction IsZero(const d: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if Epsilon=0 then\r\n    Epsilon:=DZeroResolution;\r\n  Result:=Abs(d)<=Epsilon;\r\nend;\r\n\r\nfunction IsZero(const d: Double): Boolean;\r\nbegin\r\n  Result:=Abs(d)<=DZeroResolution;\r\nend;\r\n\r\nfunction IsInfinite(const d: JSValue): Boolean; assembler;\r\nasm\r\n  return (d==Infinite) || (d==-Infinite);\r\nend;\r\n\r\nfunction SameValue(const A, B: Double; Epsilon: Double): Boolean;\r\nbegin\r\n  if (Epsilon=0.0) then\r\n    Epsilon:=Max(Min(Abs(A),Abs(B))*DZeroResolution,DZeroResolution);\r\n  if (A>B) then\r\n    Result:=((A-B)<=Epsilon)\r\n  else\r\n    Result:=((B-A)<=Epsilon);\r\nend;\r\n\r\nfunction JSFloor(const A: Double): Double; external name 'Math.floor';\r\nfunction JSCeil(const A: Double): Double; external name 'Math.ceil';\r\n\r\nfunction Ceil(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor(const A: Double): Integer;\r\n\r\nbegin\r\n  // TODO: add Range check ?\r\n  Result:=trunc(JSFloor(a));\r\nend;\r\n\r\nfunction Ceil64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nfunction Floor64(const A: Double): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=trunc(JSCeil(a));\r\nend;\r\n\r\nprocedure Frexp(X: double; out Mantissa: double; out Exponent: integer);\r\n\r\nbegin\r\n  Exponent:=0;\r\n  if (X<>0) then\r\n    if (abs(X)<0.5) then\r\n      repeat\r\n        X:=X*2;\r\n        Dec(Exponent);\r\n      until (abs(X)>=0.5)\r\n    else\r\n      while (abs(X)>=1) do\r\n        begin\r\n        X:=X/2;\r\n        Inc(Exponent);\r\n        end;\r\n  Mantissa:=X;\r\nend;\r\n\r\nfunction LogN(const A, Base: Double): Double; \r\n\r\nbegin\r\n  Result:=Ln(A)/Ln(Base);\r\nend;\r\n\r\nfunction lnxp1(x: double): double;\r\n\r\nvar\r\n  y: float;\r\n\r\nbegin\r\n  if (x>=4.0) then\r\n    result:=ln(1.0+x)\r\n  else\r\n    begin\r\n    y:=1.0+x;\r\n    if (y=1.0) then\r\n      result:=x\r\n    else\r\n      begin\r\n      result:=ln(y);     { lnxp1(-1) = ln(0) = -Inf }\r\n      if y>0.0 then\r\n        result:=result+(x-(y-1.0))/y;\r\n      end;\r\n    end;\r\nend;\r\n\r\nfunction ldexp(x : double;const p : Integer) : double;\r\n\r\nbegin\r\n   result:=x*intpower(2.0,p);\r\nend;\r\n\r\n\r\nfunction IntPower(base: float; const exponent: Integer): double;\r\n\r\nvar\r\n  i : longint;\r\n\r\nbegin\r\n  if (base = 0.0) and (exponent = 0) then\r\n    result:=1\r\n  else\r\n    begin\r\n    i:=abs(exponent);\r\n    Result:=1.0;\r\n    while i>0 do\r\n      begin\r\n      while (i and 1)=0 do\r\n        begin\r\n        i:=i shr 1;\r\n        base:=sqr(base);\r\n        end;\r\n      i:=i-1;\r\n      Result:=Result*base;\r\n      end;\r\n    if exponent<0 then\r\n      Result:=1.0/Result;\r\n    end;\r\nend;\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result, Remainder: Word);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: Word; out Result,\r\n  Remainder: SmallInt);\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: DWord; Divisor: DWord; out Result, Remainder: DWord);\r\nbegin\r\n  Result:=Dividend Div Divisor;\r\n  Remainder:=Dividend-(Result*Divisor);\r\nend;\r\n\r\n\r\nprocedure DivMod(Dividend: LongInt; Divisor: LongInt; out Result,\r\n  Remainder: LongInt);\r\n\r\nbegin\r\n  if Dividend < 0 then\r\n    begin\r\n    Dividend:=-Dividend;\r\n    Result:=-(Dividend Div Divisor);\r\n    Remainder:=-(Dividend+(Result*Divisor));\r\n    end\r\n  else\r\n    begin\r\n    Result:=Dividend Div Divisor;\r\n    Remainder:=Dividend-(Result*Divisor);\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Angle conversion\r\n  ---------------------------------------------------------------------}\r\nfunction DegToRad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(pi/180.0);\r\nend;\r\n\r\n\r\nfunction RadToDeg(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(180.0/pi);\r\nend;\r\n\r\n\r\nfunction GradToRad(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(pi/200.0);\r\nend;\r\n\r\n\r\nfunction RadToGrad(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(200.0/pi);\r\nend;\r\n\r\n\r\nfunction DegToGrad(deg: double): double;\r\n\r\nbegin\r\n  Result:=deg*(200.0/180.0);\r\nend;\r\n\r\n\r\nfunction GradToDeg(grad: double): double;\r\n\r\nbegin\r\n  Result:=grad*(180.0/200.0);\r\nend;\r\n\r\n\r\nfunction CycleToRad(cycle: double): double;\r\n\r\nbegin\r\n  Result:=(2*pi)*cycle;\r\nend;\r\n\r\n\r\nfunction RadToCycle(rad: double): double;\r\n\r\nbegin\r\n  Result:=rad*(1/(2*pi));\r\nend;\r\n\r\n\r\nfunction DegNormalize(deg: double): double;\r\n\r\nbegin\r\n  Result:=Deg-Int(Deg/360)*360;\r\n  If (Result<0) then Result:=Result+360;\r\nend;\r\n\r\nfunction sumofsquares(const data : array of double) : double;\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+sqr(data[i]);\r\nend;\r\n\r\nfunction Norm(const data: array of double): double;\r\nbegin\r\n  Result:=sqrt(sumofsquares(data));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Statistical functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction Sum(const data: array of double): double;\r\n\r\nvar\r\n  i,N : longint;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  Result:=0.0;\r\n  for i:=0 to N-1 do\r\n    Result:=Result+data[i];\r\nend;\r\n\r\nfunction Mean(const data: array of double): double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=Sum(Data)/N;\r\nend;\r\nprocedure SumsAndSquares(const data: array of Double; out Sum,\r\n  SumOfSquares: double);\r\n\r\nvar\r\n  i,n : Integer;\r\n  t,s,ss: double;\r\n\r\nbegin\r\n  n:=length(Data);\r\n  ss:=0.0; // Use local vars, var is very inefficient in js\r\n  s:=0.0;\r\n  for i:=0 to N-1 do\r\n    begin\r\n    t:=data[i];\r\n    ss:=ss+sqr(t);\r\n    s:=s+t;\r\n    end;\r\n  Sum:=s;\r\n  SumOfSquares:=ss;\r\nend;\r\n\r\nfunction StdDev(const data: array of Double): float;\r\n\r\nbegin\r\n  Result:=Sqrt(Variance(Data));\r\nend;\r\n\r\nfunction Variance(const data: array of Double): double;\r\n\r\nvar\r\n  n : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  If N=1 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/(N-1);\r\nend;\r\n\r\nfunction TotalVariance(const data: array of Double): double;\r\n\r\nvar\r\n  S,SS : Float;\r\n  N : integer;\r\nbegin\r\n  N:=Length(Data);\r\n  If Length(Data)=1 then\r\n    Result:=0\r\n  else\r\n    begin\r\n    SumsAndSquares(Data,S,SS);\r\n    Result := SS-Sqr(S)/N;\r\n    end;\r\nend;\r\n\r\nprocedure MeanAndStdDev(const data: array of Double; out Mean, StdDev: double);\r\n\r\nVar\r\n  I,N : longint;\r\n  M,S : Double;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  M:=0;\r\n  S:=0;\r\n  For I:=0 to N-1 do\r\n    begin\r\n    M:=M+Data[i];\r\n    S:=S+Sqr(Data[i]);\r\n    end;\r\n  M:=M/N;\r\n  S:=(S-N*Sqr(M));\r\n  If N>1 then\r\n    S:=Sqrt(S/(N-1))\r\n  else\r\n    S:=0;\r\n  Mean:=M;\r\n  StdDev:=S;\r\nend;\r\n\r\nfunction PopNStdDev(const data : array of Double) : double;\r\n\r\nbegin\r\n  Result:=Sqrt(PopnVariance(Data));\r\nend;\r\n\r\nfunction PopNVariance(const data : array of Double) : double;\r\n\r\nVar\r\n  N : integer;\r\n\r\nbegin\r\n  N:=Length(Data);\r\n  if N=0 then\r\n    Result:=0\r\n  else\r\n    Result:=TotalVariance(Data)/N;\r\nend;\r\n\r\nprocedure MomentSkewKurtosis(const data: array of Double; out m1, m2, m3, m4, skew, kurtosis: double);\r\n\r\nvar\r\n  i,N: integer;\r\n  deviation, deviation2: double;\r\n  reciprocalN: float;\r\n  // Use local vars for all calculations, var is very slow\r\n  lm1, lm2, lm3, lm4, lskew, lkurtosis: double;\r\n\r\nbegin\r\n  N:=length(Data);\r\n  lm1 := 0;\r\n  reciprocalN := 1/N;\r\n  for i := 0 to N-1 do\r\n    lm1 := lm1 + data[i];\r\n  lm1 := reciprocalN * lm1;\r\n\r\n  lm2 := 0;\r\n  lm3 := 0;\r\n  lm4 := 0;\r\n  for i := 0 to N-1 do\r\n    begin\r\n    deviation := (data[i]-lm1);\r\n    deviation2 := deviation * deviation;\r\n    lm2 := lm2 + deviation2;\r\n    lm3 := lm3 + deviation2 * deviation;\r\n    lm4 := lm4 + deviation2 * deviation2;\r\n    end;\r\n  lm2 := reciprocalN * lm2;\r\n  lm3 := reciprocalN * lm3;\r\n  lm4 := reciprocalN * lm4;\r\n\r\n  lskew := lm3 / (sqrt(lm2)*lm2);\r\n  lkurtosis := lm4 / (lm2 * lm2);\r\n\r\n  m1:=lm1;\r\n  m2:=lm2;\r\n  m3:=lm3;\r\n  m4:=lm4;\r\n  skew:=lskew;\r\n  kurtosis:=lkurtosis;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Financial functions\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction FutureValue(ARate: double; NPeriods: Integer;\r\n  APayment, APresentValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -APresentValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(APresentValue * qn + APayment*factor);\r\n  end;\r\nend;\r\n\r\nfunction InterestRate(NPeriods: Integer; APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ The interest rate cannot be calculated analytically. We solve the equation\r\n  numerically by means of the Newton method:\r\n  - guess value for the interest reate\r\n  - calculate at which interest rate the tangent of the curve fv(rate)\r\n    (straight line!) has the requested future vale.\r\n  - use this rate for the next iteration. }\r\nconst\r\n  DELTA = 0.001;\r\n  EPS = 1E-9;   // required precision of interest rate (after typ. 6 iterations)\r\n  MAXIT = 20;   // max iteration count to protect agains non-convergence\r\nvar\r\n  r1, r2, dr: double;\r\n  fv1, fv2: double;\r\n  iteration: Integer;\r\nbegin\r\n  iteration := 0;\r\n  r1 := 0.05;  // inital guess\r\n  repeat\r\n    r2 := r1 + DELTA;\r\n    fv1 := FutureValue(r1, NPeriods, APayment, APresentValue, APaymentTime);\r\n    fv2 := FutureValue(r2, NPeriods, APayment, APresentValue, APaymentTime);\r\n    dr := (AFutureValue - fv1) / (fv2 - fv1) * delta;  // tangent at fv(r)\r\n    r1 := r1 + dr;      // next guess\r\n    inc(iteration);\r\n  until (abs(dr) < EPS) or (iteration >= MAXIT);\r\n  Result := r1;\r\nend;\r\n\r\nfunction NumberOfPeriods(ARate, APayment, APresentValue, AFutureValue: double;\r\n  APaymentTime: TPaymentTime): double;\r\n{ Solve the cash flow equation (1) for q^n and take the logarithm }\r\nvar\r\n  q, x1, x2: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(APresentValue + AFutureValue) / APayment\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    if APaymentTime = ptStartOfPeriod then\r\n      APayment := APayment * q;\r\n    x1 := APayment - AFutureValue * ARate;\r\n    x2 := APayment + APresentValue * ARate;\r\n    if   (x2 = 0)                    // we have to divide by x2\r\n      or (sign(x1) * sign(x2) < 0)   // the argument of the log is negative\r\n    then\r\n      Result := Infinity\r\n    else begin\r\n      Result := ln(x1/x2) / ln(q);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction Payment(ARate: double; NPeriods: Integer;\r\n  APresentValue, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0 then\r\n    Result := -(AFutureValue + APresentValue) / NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APresentValue * qn) / factor;\r\n  end;\r\nend;\r\n\r\nfunction PresentValue(ARate: double; NPeriods: Integer;\r\n  APayment, AFutureValue: double; APaymentTime: TPaymentTime): double;\r\nvar\r\n  q, qn, factor: double;\r\nbegin\r\n  if ARate = 0.0 then\r\n    Result := -AFutureValue - APayment * NPeriods\r\n  else begin\r\n    q := 1.0 + ARate;\r\n    qn := power(q, NPeriods);\r\n    factor := (qn - 1) / (q - 1);\r\n    if APaymentTime = ptStartOfPeriod then\r\n      factor := factor * q;\r\n    Result := -(AFutureValue + APayment*factor) / qn;\r\n  end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n  Miscellaneous\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction IfThen(val: boolean; const ifTrue: integer; const ifFalse: integer): integer;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction IfThen(val: boolean; const ifTrue: double; const ifFalse: double): double;\r\n\r\nbegin\r\n  if val then result:=iftrue else result:=iffalse;\r\nend;\r\n\r\nfunction CompareValue(const A, B  : Integer): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: NativeLargeUInt): TValueRelationship;\r\n\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if a=b then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nfunction CompareValue(const A, B: Double; delta: Double): TValueRelationship;\r\nbegin\r\n  result:=GreaterThanValue;\r\n  if abs(a-b)<=delta then\r\n    result:=EqualsValue\r\n  else\r\n   if a<b then\r\n     result:=LessThanValue;\r\nend;\r\n\r\nend.\r\n\r\n","{\r\n    This file is part of the Free Component Library (FCL)\r\n    Copyright (c) 2002 by Florian Klaempfl\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n{$mode objfpc}\r\n\r\nunit contnrs;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes;\r\n\r\n\r\nType\r\n  TObjectListCallback = Reference to Procedure(data:TObject;arg:JSValue);\r\n\r\n  TFPObjectList = class(TObject)\r\n  private\r\n    FFreeObjects : Boolean;\r\n    FList: TFPList;\r\n    Function GetCount: integer;\r\n    Procedure SetCount(const AValue: integer);\r\n  protected\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n    Procedure SetCapacity(NewCapacity: Integer);\r\n    Function GetCapacity: integer;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : Boolean);\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AObject: TObject): Integer;\r\n    Procedure Delete(Index: Integer);\r\n    Procedure Exchange(Index1, Index2: Integer);\r\n    Function Expand: TFPObjectList;\r\n    Function Extract(Item: TObject): TObject;\r\n    Function Remove(AObject: TObject): Integer;\r\n    Function IndexOf(AObject: TObject): Integer;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject);\r\n    Function First: TObject;\r\n    Function Last: TObject;\r\n    Procedure Move(CurIndex, NewIndex: Integer);\r\n    Procedure Assign(Obj:TFPObjectList);\r\n    Procedure Pack;\r\n    Procedure Sort(Compare: TListSortCompare);\r\n    Procedure ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\n    property Capacity: Integer read GetCapacity write SetCapacity;\r\n    property Count: Integer read GetCount write SetCount;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n    property List: TFPList read FList;\r\n  end;\r\n\r\n\r\n  { TObjectList }\r\n\r\n  TObjectList = class(TList)\r\n  private\r\n    FFreeObjects : Boolean;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItem(Index: Integer): TObject;\r\n    Procedure SetItem(Index: Integer; AObject: TObject);\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor Create(FreeObjects : boolean);\r\n    Function Add(AObject: TObject): Integer; reintroduce;\r\n    Function Extract(Item: TObject): TObject; reintroduce;\r\n    Function Remove(AObject: TObject): Integer; reintroduce;\r\n    Function IndexOf(AObject: TObject): Integer; reintroduce;\r\n    Function FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt: Integer): Integer;\r\n    Procedure Insert(Index: Integer; AObject: TObject); reintroduce;\r\n    Function First: TObject; reintroduce;\r\n    Function Last: TObject; reintroduce;\r\n    property OwnsObjects: Boolean read FFreeObjects write FFreeObjects;\r\n    property Items[Index: Integer]: TObject read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TComponentList = class(TObjectList)\r\n  Private\r\n    FNotifier : TComponent;\r\n  Protected\r\n    Procedure Notify(Ptr: JSValue; Action: TListNotification); override;\r\n    Function GetItems(Index: Integer): TComponent;\r\n    Procedure SetItems(Index: Integer; AComponent: TComponent);\r\n    Procedure HandleFreeNotify(Sender: TObject; AComponent: TComponent);\r\n  public\r\n    destructor Destroy; override;\r\n    Function Add(AComponent: TComponent): Integer; reintroduce;\r\n    Function Extract(Item: TComponent): TComponent; reintroduce;\r\n    Function Remove(AComponent: TComponent): Integer; reintroduce;\r\n    Function IndexOf(AComponent: TComponent): Integer; reintroduce;\r\n    Function First: TComponent; reintroduce;\r\n    Function Last: TComponent; reintroduce;\r\n    Procedure Insert(Index: Integer; AComponent: TComponent); reintroduce;\r\n    property Items[Index: Integer]: TComponent read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TClassList = class(TList)\r\n  protected\r\n    Function GetItems(Index: Integer): TClass;\r\n    Procedure SetItems(Index: Integer; AClass: TClass);\r\n  public\r\n    Function Add(AClass: TClass): Integer; reintroduce;\r\n    Function Extract(Item: TClass): TClass; reintroduce;\r\n    Function Remove(AClass: TClass): Integer; reintroduce;\r\n    Function IndexOf(AClass: TClass): Integer; reintroduce;\r\n    Function First: TClass; reintroduce;\r\n    Function Last: TClass; reintroduce;\r\n    Procedure Insert(Index: Integer; AClass: TClass); reintroduce;\r\n    property Items[Index: Integer]: TClass read GetItems write SetItems; default;\r\n  end;\r\n\r\n  TOrderedList = class(TObject)\r\n  private\r\n    FList: TList;\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); virtual; abstract;\r\n    Function PopItem: JSValue; virtual;\r\n    Function PeekItem: JSValue; virtual;\r\n    property List: TList read FList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    destructor Destroy; override;\r\n    Function Count: Integer;\r\n    Function AtLeast(ACount: Integer): Boolean;\r\n    Function Push(AItem: JSValue): JSValue;\r\n    Function Pop: JSValue;\r\n    Function Peek: JSValue;\r\n  end;\r\n\r\n{ TStack class }\r\n\r\n  TStack = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectStack class }\r\n\r\n  TObjectStack = class(TStack)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ TQueue class }\r\n\r\n  TQueue = class(TOrderedList)\r\n  protected\r\n    Procedure PushItem(AItem: JSValue); override;\r\n  end;\r\n\r\n{ TObjectQueue class }\r\n\r\n  TObjectQueue = class(TQueue)\r\n  public\r\n    Function Push(AObject: TObject): TObject; reintroduce;\r\n    Function Pop: TObject; reintroduce;\r\n    Function Peek: TObject; reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, implemented by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  { Must return a Longword value in the range 0..TableSize,\r\n   usually via a mod operator;  }\r\n  THashFunction = Function(const S: string; const TableSize: Longword): Longword;\r\n\r\n\r\n  { THTNode }\r\n\r\n  THTCustomNode = class(TObject)\r\n  private\r\n    FKey: string;\r\n  public\r\n    constructor CreateWith(const AString: String);\r\n    Function HasKey(const AKey: string): boolean;\r\n    property Key: string read FKey;\r\n  end;\r\n  THTCustomNodeClass = Class of THTCustomNode;\r\n\r\n\r\n  { TFPCustomHashTable }\r\n\r\n  TFPCustomHashTable = class(TObject)\r\n  private\r\n    FHashTable: TFPObjectList;\r\n    FHashFunction: THashFunction;\r\n    FCount: Longword;\r\n    Function GetDensity: Longword;\r\n    Function GetNumberOfCollisions: Longword;\r\n    Procedure SetHashTableSize(const Value: Longword);\r\n    Procedure InitializeHashTable;\r\n    Function GetVoidSlots: Longword;\r\n    Function GetLoadFactor: double;\r\n    Function GetAVGChainLen: double;\r\n    Function GetMaxChainLength: Longword;\r\n  protected\r\n    FHashTableSize: Longword;\r\n    Function Chain(const index: Longword):TFPObjectList;\r\n    Function CreateNewNode(const aKey : string) : THTCustomNode; virtual; abstract;\r\n    Procedure AddNode(ANode : THTCustomNode); virtual; abstract;\r\n    Function ChainLength(const ChainIndex: Longword): Longword; virtual;\r\n    Function FindOrCreateNew(const aKey: string): THTCustomNode; virtual;\r\n    Procedure SetHashFunction(AHashFunction: THashFunction); virtual;\r\n    Function FindChainForAdd(Const aKey : String) : TFPObjectList;\r\n  public\r\n    constructor Create; reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction);\r\n    destructor Destroy; override;\r\n    Procedure ChangeTableSize(const ANewSize: Longword); virtual;\r\n    Procedure Clear; virtual;\r\n    Procedure Delete(const aKey: string); virtual;\r\n    Function Find(const aKey: string): THTCustomNode;\r\n    Function IsEmpty: boolean;\r\n    property HashFunction: THashFunction read FHashFunction write SetHashFunction;\r\n    property Count: Longword read FCount;\r\n    property HashTableSize: Longword read FHashTableSize write SetHashTableSize;\r\n    property HashTable: TFPObjectList read FHashTable;\r\n    property VoidSlots: Longword read GetVoidSlots;\r\n    property LoadFactor: double read GetLoadFactor;\r\n    property AVGChainLen: double read GetAVGChainLen;\r\n    property MaxChainLength: Longword read GetMaxChainLength;\r\n    property NumberOfCollisions: Longword read GetNumberOfCollisions;\r\n    property Density: Longword read GetDensity;\r\n  end;\r\n\r\n  { TFPDataHashTable : Hash table with simple data JSValues }\r\n\r\n  THTDataNode = Class(THTCustomNode)\r\n  Private\r\n    FData: JSValue;\r\n  public\r\n    property Data: JSValue read FData write FData;\r\n  end;\r\n  // For compatibility\r\n  THTNode = THTDataNode;\r\n\r\n  TDataIteratorMethod = Procedure(Item: JSValue; const Key: string; var Continue: Boolean) of object;\r\n  TDataIteratorCallBack = Procedure(Item: JSValue; const Key: string; var Continue: Boolean);\r\n\r\n  // For compatibility\r\n  TIteratorMethod = TDataIteratorMethod;\r\n\r\n  TFPDataHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TDataIteratorCallBack;\r\n    Procedure CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const index: string; const AValue: JSValue); virtual;\r\n    Function GetData(const index: string):JSValue; virtual;\r\n    Function ForEachCall(aMethod: TDataIteratorMethod): THTDataNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TDataIteratorMethod): JSValue; virtual;\r\n    Function Iterate(aMethod: TDataIteratorCallBack): JSValue; virtual;\r\n    Procedure Add(const aKey: string; AItem: JSValue); virtual;\r\n    property Items[const index: string]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n  THTStringNode = Class(THTCustomNode)\r\n  Private\r\n    FData : String;\r\n  public\r\n    property Data: String read FData write FData;\r\n  end;\r\n  \r\n  TStringIteratorMethod = Procedure(Item: String; const Key: string; var Continue: Boolean) of object;\r\n  TStringIteratorCallback = Procedure(Item: String; const Key: string; var Continue: Boolean);\r\n\r\n  TFPStringHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FIteratorCallBack: TStringIteratorCallback;\r\n    Procedure CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index, AValue: string); virtual;\r\n    Function GetData(const index: string): String; virtual;\r\n    Function ForEachCall(aMethod: TStringIteratorMethod): THTStringNode; virtual;\r\n  Public\r\n    Function Iterate(aMethod: TStringIteratorMethod): String; virtual;\r\n    Function Iterate(aMethod: TStringIteratorCallback): String; virtual;\r\n    Procedure Add(const aKey,aItem: string); virtual;\r\n    property Items[const index: string]: String read GetData write SetData; default;\r\n  end;\r\n\r\n  { TFPStringHashTable : Hash table with simple strings as data }\r\n\r\n\r\n  THTObjectNode = Class(THTCustomNode)\r\n  Private\r\n    FData : TObject;\r\n  public\r\n    property Data: TObject read FData write FData;\r\n  end;\r\n\r\n  THTOwnedObjectNode = Class(THTObjectNode)\r\n  public\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TObjectIteratorMethod = Procedure(Item: TObject; const Key: string; var Continue: Boolean) of object;\r\n  TObjectIteratorCallback = Procedure(Item: TObject; const Key: string; var Continue: Boolean);\r\n\r\n  TFPObjectHashTable = Class(TFPCustomHashTable)\r\n  Private\r\n    FOwnsObjects : Boolean;\r\n    FIteratorCallBack: TObjectIteratorCallback;\r\n    procedure CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\n  Protected\r\n    Function CreateNewNode(const aKey : String) : THTCustomNode; override;\r\n    Procedure AddNode(ANode : THTCustomNode); override;\r\n    Procedure SetData(const Index: string; AObject : TObject); virtual;\r\n    Function GetData(const index: string): TObject; virtual;\r\n    Function ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode; virtual;\r\n  Public\r\n    constructor Create(AOwnsObjects : Boolean = True); reintroduce;\r\n    constructor CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True); reintroduce;\r\n    Function Iterate(aMethod: TObjectIteratorMethod): TObject; virtual;\r\n    Function Iterate(aMethod: TObjectIteratorCallback): TObject; virtual;\r\n    Procedure Add(const aKey: string; AItem : TObject); virtual;\r\n    property Items[const index: string]: TObject read GetData write SetData; default;\r\n    Property OwnsObjects : Boolean Read FOwnsObjects;\r\n  end;\r\n\r\n  EDuplicate = class(Exception);\r\n  EKeyNotFound = class(Exception);\r\n\r\n  Function RSHash(const S: string; const TableSize: Longword): Longword;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Bucket lists as in Delphi\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nType\r\n  TBucketItem = record\r\n    Item, Data: JSValue;\r\n  end;\r\n  TBucketItemArray = array of TBucketItem;\r\n\r\n  TBucket = record\r\n    Count : Integer;\r\n    Items : TBucketItemArray;\r\n  end;\r\n  TBucketArray = array of TBucket;\r\n\r\n  TBucketProc = Reference to Procedure(AInfo, AItem, AData: JSValue; out AContinue: Boolean);\r\n\r\n{ ---------------------------------------------------------------------\r\n  TCustomBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TCustomBucketList }\r\n\r\n  TCustomBucketList = class(TObject)\r\n  private\r\n    FBuckets: TBucketArray;\r\n    Function GetBucketCount: Integer;\r\n    Function GetData(AItem: JSValue): JSValue;\r\n    Procedure SetData(AItem: JSValue; const AData: JSValue);\r\n    Procedure SetBucketCount(const Value: Integer);\r\n  protected\r\n    Procedure GetBucketItem(AItem: JSValue; out ABucket, AIndex: Integer);\r\n    Function AddItem(ABucket: Integer; AItem, AData: JSValue): JSValue; virtual;\r\n    Function BucketFor(AItem: JSValue): Integer; virtual; abstract;\r\n    Function DeleteItem(ABucket: Integer; AIndex: Integer): JSValue; virtual;\r\n    Procedure Error(Msg : String; Args : Array of JSValue);\r\n    Function FindItem(AItem: JSValue; out ABucket, AIndex: Integer): Boolean; virtual;\r\n    property Buckets: TBucketArray read FBuckets;\r\n    property BucketCount: Integer read GetBucketCount write SetBucketCount;\r\n  public\r\n    destructor Destroy; override;\r\n    Procedure Clear;\r\n    Function Add(AItem, AData: JSValue): JSValue;\r\n    Procedure Assign(AList: TCustomBucketList);\r\n    Function Exists(AItem: JSValue): Boolean;\r\n    Function Find(AItem: JSValue; out AData: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\n    Function ForEach(AProc: TBucketProc): Boolean;\r\n    Function Remove(AItem: JSValue): JSValue;\r\n    property Data[AItem: JSValue]: JSValue read GetData write SetData; default;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n  TBucketListSizes = (bl2, bl4, bl8, bl16, bl32, bl64, bl128, bl256);\r\n\r\n  { TBucketList }\r\n\r\n  TBucketList = class(TCustomBucketList)\r\n  private\r\n    FBucketMask: Byte;\r\n  protected\r\n    Function BucketFor(AItem: JSValue): Integer; override;\r\n  public\r\n    constructor Create(ABuckets: TBucketListSizes = bl16); reintroduce;\r\n  end;\r\n\r\n{ ---------------------------------------------------------------------\r\n  TObjectBucketList\r\n  ---------------------------------------------------------------------}\r\n\r\n  { TObjectBucketList }\r\n\r\n  TObjectBucketList = class(TBucketList)\r\n  protected\r\n    Function GetData(AItem: TObject): TObject; reintroduce;\r\n    Procedure SetData(AItem: TObject; const AData: TObject); reintroduce;\r\n  public\r\n    Function Add(AItem, AData: TObject): TObject; reintroduce;\r\n    Function Remove(AItem: TObject): TObject; reintroduce;\r\n    property Data[AItem: TObject]: TObject read GetData write SetData; default;\r\n  end;\r\n\r\n\r\nimplementation\r\n\r\nuses\r\n  js;\r\n\r\nResourceString\r\n  DuplicateMsg   = 'An item with key %0:s already exists';\r\n  //KeyNotFoundMsg = 'Method: %0:s key [''%1:s''] not found in container';\r\n  NotEmptyMsg    = 'Hash table not empty.';\r\n  SErrNoSuchItem = 'No item in list for %p';\r\n  SDuplicateItem = 'Item already exists in list: %p';\r\n\r\nconst\r\n  NPRIMES = 28;\r\n\r\n  PRIMELIST: array[0 .. NPRIMES-1] of Longword =\r\n  ( 53,         97,         193,       389,       769,\r\n    1543,       3079,       6151,      12289,     24593,\r\n    49157,      98317,      196613,    393241,    786433,\r\n    1572869,    3145739,    6291469,   12582917,  25165843,\r\n    50331653,   100663319,  201326611, 402653189, 805306457,\r\n    1610612741, 3221225473, 4294967291 );\r\n\r\nconstructor TFPObjectList.Create(FreeObjects : boolean);\r\nbegin\r\n  Create;\r\n  FFreeObjects:=Freeobjects;\r\nend;\r\n\r\ndestructor TFPObjectList.Destroy;\r\nbegin\r\n  if (FList <> nil) then\r\n  begin\r\n    Clear;\r\n    FList.Destroy;\r\n  end;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TFPObjectList.Clear;\r\nvar\r\n  i: integer;\r\n  O : TObject;\r\nbegin\r\n  if FFreeObjects then\r\n    for i:=FList.Count-1 downto 0 do\r\n      begin\r\n      O:=TObject(FList[i]);\r\n      FList[i]:=Nil;\r\n      O.Free;\r\n      end;\r\n  FList.Clear;\r\nend;\r\n\r\nconstructor TFPObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FList:=TFPList.Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nFunction TFPObjectList.GetCount: integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCount(const AValue: integer);\r\nbegin\r\n  if FList.Count <> AValue then\r\n    FList.Count:=AValue;\r\nend;\r\n\r\nFunction TFPObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(FList[Index]);\r\nend;\r\n\r\nProcedure TFPObjectList.SetItem(Index: Integer; AObject: TObject);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=AObject;\r\n    O.Free;\r\n    end\r\n  else\r\n    FList[index]:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectList.SetCapacity(NewCapacity: Integer);\r\nbegin\r\n  FList.Capacity:=NewCapacity;\r\nend;\r\n\r\nFunction TFPObjectList.GetCapacity: integer;\r\nbegin\r\n  Result:=FList.Capacity;\r\nend;\r\n\r\nFunction TFPObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.Add(AObject);\r\nend;\r\n\r\nProcedure TFPObjectList.Delete(Index: Integer);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if OwnsObjects then\r\n    begin\r\n    O:=TObject(FList[Index]);\r\n    FList[Index]:=Nil;\r\n    O.Free;\r\n    end;\r\n  FList.Delete(Index);\r\nend;\r\n\r\nProcedure TFPObjectList.Exchange(Index1, Index2: Integer);\r\nbegin\r\n  FList.Exchange(Index1, Index2);\r\nend;\r\n\r\nFunction TFPObjectList.Expand: TFPObjectList;\r\nbegin\r\n  FList.Expand;\r\n  Result:=Self;\r\nend;\r\n\r\nFunction TFPObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(FList.Extract(Item));\r\nend;\r\n\r\nFunction TFPObjectList.Remove(AObject: TObject): Integer;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  Result:=IndexOf(AObject);\r\n  if (Result <> -1) then\r\n    begin\r\n    if OwnsObjects then\r\n      begin\r\n      O:=TObject(FList[Result]);\r\n      FList[Result]:=Nil;\r\n      O.Free;\r\n      end;\r\n    FList.Delete(Result);\r\n    end;\r\nend;\r\n\r\nFunction TFPObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=FList.IndexOf(JSValue(AObject));\r\nend;\r\n\r\nFunction TFPObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean; AStartAt : Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\nProcedure TFPObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  FList.Insert(Index, JSValue(AObject));\r\nend;\r\n\r\nProcedure TFPObjectList.Move(CurIndex, NewIndex: Integer);\r\nbegin\r\n  FList.Move(CurIndex, NewIndex);\r\nend;\r\n\r\nProcedure TFPObjectList.Assign(Obj: TFPObjectList);\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Clear;\r\n  for i:=0 to Obj.Count - 1 do\r\n    Add(Obj[i]);\r\nend;\r\n\r\nProcedure TFPObjectList.Pack;\r\nbegin\r\n  FList.Pack;\r\nend;\r\n\r\nProcedure TFPObjectList.Sort(Compare: TListSortCompare);\r\nbegin\r\n  FList.Sort(Compare);\r\nend;\r\n\r\nFunction TFPObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(FList.First);\r\nend;\r\n\r\nFunction TFPObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(FList.Last);\r\nend;\r\n\r\nProcedure TFPObjectList.ForEachCall(proc2call:TObjectListCallback;arg:JSValue);\r\nbegin\r\n  FList.ForEachCall(TListCallBack(proc2call),arg);\r\nend;\r\n\r\n{ TObjectList }\r\n\r\nconstructor TObjectList.Create(FreeObjects: boolean);\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=FreeObjects;\r\nend;\r\n\r\nconstructor TObjectList.Create;\r\nbegin\r\n  inherited Create;\r\n  FFreeObjects:=True;\r\nend;\r\n\r\nProcedure TObjectList.Notify(Ptr: JSValue; Action: TListNotification);\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  if FFreeObjects then\r\n    if (Action=lnDeleted) then\r\n      begin\r\n      O:=TObject(Ptr);\r\n      O.Free;\r\n      end;\r\n  inherited Notify(Ptr,Action);\r\nend;\r\n\r\n\r\nFunction TObjectList.GetItem(Index: Integer): TObject;\r\nbegin\r\n  Result:=TObject(inherited Get(Index));\r\nend;\r\n\r\n\r\nProcedure TObjectList.SetItem(Index: Integer; AObject: TObject);\r\nbegin\r\n  // Put will take care of deleting old one in Notify.\r\n  Put(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Add(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.Extract(Item: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\n\r\nFunction TObjectList.Remove(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.IndexOf(AObject: TObject): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.FindInstanceOf(AClass: TClass; AExact: Boolean;\r\n  AStartAt: Integer): Integer;\r\nvar\r\n  I : Integer;\r\nbegin\r\n  I:=AStartAt;\r\n  Result:=-1;\r\n  if AExact then\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].ClassType=AClass then\r\n        Result:=I\r\n      else\r\n        Inc(I)\r\n  else\r\n    while (I<Count) and (Result=-1) do\r\n      if Items[i].InheritsFrom(AClass) then\r\n        Result:=I\r\n      else\r\n        Inc(I);\r\nend;\r\n\r\n\r\nProcedure TObjectList.Insert(Index: Integer; AObject: TObject);\r\nbegin\r\n  Inherited Insert(Index,JSValue(AObject));\r\nend;\r\n\r\n\r\nFunction TObjectList.First: TObject;\r\nbegin\r\n  Result:=TObject(inherited First);\r\nend;\r\n\r\n\r\nFunction TObjectList.Last: TObject;\r\nbegin\r\n  Result:=TObject(inherited Last);\r\nend;\r\n\r\n{ TListComponent }\r\n\r\ntype\r\n  TlistComponent = class(TComponent)\r\n  private\r\n    Flist : TComponentList;\r\n  public\r\n    Procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n  end;\r\n\r\nProcedure TlistComponent.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  if (Operation=opRemove) then\r\n    Flist.HandleFreeNotify(Self,AComponent);\r\n  inherited;\r\nend;\r\n\r\n{ TComponentList }\r\n\r\nFunction TComponentList.Add(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Add(AComponent);\r\nend;\r\n\r\ndestructor TComponentList.Destroy;\r\nbegin\r\n  inherited;\r\n  FreeAndNil(FNotifier);\r\nend;\r\n\r\nFunction TComponentList.Extract(Item: TComponent): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Extract(Item));\r\nend;\r\n\r\nFunction TComponentList.First: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited First);\r\nend;\r\n\r\nFunction TComponentList.GetItems(Index: Integer): TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Items[Index]);\r\nend;\r\n\r\nProcedure TComponentList.HandleFreeNotify(Sender: TObject;\r\n  AComponent: TComponent);\r\nbegin\r\n  Extract(AComponent);\r\n  if Sender=nil then ;\r\nend;\r\n\r\nFunction TComponentList.IndexOf(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.Insert(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  inherited Insert(Index,AComponent)\r\nend;\r\n\r\nFunction TComponentList.Last: TComponent;\r\nbegin\r\n  Result:=TComponent(inherited Last);\r\nend;\r\n\r\nProcedure TComponentList.Notify(Ptr: JSValue; Action: TListNotification);\r\nbegin\r\n  if FNotifier=nil then\r\n    begin\r\n    FNotifier:=TlistComponent.Create(nil);\r\n    TlistComponent(FNotifier).FList:=Self;\r\n    end;\r\n  if Assigned(Ptr) then\r\n    with TComponent(Ptr) do\r\n      case Action of\r\n        lnAdded : FreeNotification(FNotifier);\r\n        lnExtracted, lnDeleted: RemoveFreeNotification(FNotifier);\r\n      end;\r\n  inherited Notify(Ptr, Action);\r\nend;\r\n\r\nFunction TComponentList.Remove(AComponent: TComponent): Integer;\r\nbegin\r\n  Result:=inherited Remove(AComponent);\r\nend;\r\n\r\nProcedure TComponentList.SetItems(Index: Integer; AComponent: TComponent);\r\nbegin\r\n  Put(Index,AComponent);\r\nend;\r\n\r\n{ TClassList }\r\n\r\nFunction TClassList.Add(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Add(JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Extract(Item: TClass): TClass;\r\nbegin\r\n  Result:=TClass(inherited Extract(JSValue(Item)));\r\nend;\r\n\r\nFunction TClassList.First: TClass;\r\nbegin\r\n  Result:=TClass(inherited First);\r\nend;\r\n\r\nFunction TClassList.GetItems(Index: Integer): TClass;\r\nbegin\r\n  Result:=TClass(inherited Items[Index]);\r\nend;\r\n\r\nFunction TClassList.IndexOf(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited IndexOf(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.Insert(Index: Integer; AClass: TClass);\r\nbegin\r\n  inherited Insert(Index,JSValue(AClass));\r\nend;\r\n\r\nFunction TClassList.Last: TClass;\r\nbegin\r\n  Result:=TClass(inherited Last);\r\nend;\r\n\r\nFunction TClassList.Remove(AClass: TClass): Integer;\r\nbegin\r\n  Result:=inherited Remove(JSValue(AClass));\r\nend;\r\n\r\nProcedure TClassList.SetItems(Index: Integer; AClass: TClass);\r\nbegin\r\n  Put(Index,JSValue(AClass));\r\nend;\r\n\r\n{ TOrderedList }\r\n\r\nFunction TOrderedList.AtLeast(ACount: Integer): Boolean;\r\nbegin\r\n  Result:=(FList.Count>=Acount)\r\nend;\r\n\r\nFunction TOrderedList.Count: Integer;\r\nbegin\r\n  Result:=FList.Count;\r\nend;\r\n\r\nconstructor TOrderedList.Create;\r\nbegin\r\n  FList:=Tlist.Create;\r\nend;\r\n\r\ndestructor TOrderedList.Destroy;\r\nbegin\r\n  FList.Free;\r\nend;\r\n\r\nFunction TOrderedList.Peek: JSValue;\r\nbegin\r\n  if AtLeast(1) then\r\n    Result:=PeekItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PeekItem: JSValue;\r\n\r\nbegin\r\n  with Flist do\r\n    Result:=Items[Count-1]\r\nend;\r\n\r\nFunction TOrderedList.Pop: JSValue;\r\nbegin\r\n  If Atleast(1) then\r\n    Result:=PopItem\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.PopItem: JSValue;\r\nbegin\r\n  with FList do\r\n    if Count>0 then\r\n      begin\r\n      Result:=Items[Count-1];\r\n      Delete(Count-1);\r\n      end\r\n    else\r\n      Result:=nil;\r\nend;\r\n\r\nFunction TOrderedList.Push(AItem: JSValue): JSValue;\r\nbegin\r\n  PushItem(AItem);\r\n  Result:=AItem;\r\nend;\r\n\r\n{ TStack }\r\n\r\nProcedure TStack.PushItem(AItem: JSValue);\r\nbegin\r\n  FList.Add(AItem);\r\nend;\r\n\r\n{ TObjectStack }\r\n\r\nFunction TObjectStack.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectStack.Pop: TObject;\r\nbegin\r\n  Result:=TObject(Inherited Pop);\r\nend;\r\n\r\nFunction TObjectStack.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n{ TQueue }\r\n\r\nProcedure TQueue.PushItem(AItem: JSValue);\r\nbegin\r\n  with FList Do\r\n    Insert(0,AItem);\r\nend;\r\n\r\n{ TObjectQueue }\r\n\r\nFunction TObjectQueue.Peek: TObject;\r\nbegin\r\n  Result:=TObject(inherited Peek);\r\nend;\r\n\r\nFunction TObjectQueue.Pop: TObject;\r\nbegin\r\n  Result:=TObject(inherited Pop);\r\nend;\r\n\r\nFunction TObjectQueue.Push(AObject: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Push(JSValue(AObject)));\r\nend;\r\n\r\n\r\n{*****************************************************************************\r\n                            TFPHashList\r\n*****************************************************************************}\r\n(*\r\n    Function FPHash(const s:shortstring):LongWord;\r\n    var\r\n      p,pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      p:=@s[1];\r\n      pmax:=@s[length(s)+1];\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n    Function FPHash(P: PChar; Len: Integer): LongWord;\r\n    var\r\n      pmax : PChar;\r\n    begin\r\n{$push}\r\n{$Q-}\r\n      Result:=0;\r\n      pmax:=p+len;\r\n      while (p<pmax) do\r\n        begin\r\n          Result:=LongWord(LongInt(Result shl 5) - LongInt(Result)) xor LongWord(P^);\r\n          Inc(p);\r\n        end;\r\n{$pop}\r\n    end;\r\n\r\n*)\r\n\r\n{ ---------------------------------------------------------------------\r\n    Hash support, by Dean Zobec\r\n  ---------------------------------------------------------------------}\r\n\r\n{ Default hash Function }\r\n\r\nFunction RSHash(const S: string; const TableSize: Longword): Longword;\r\nconst\r\n  b = 378551;\r\nvar\r\n  a: Longword;\r\n  i: Longword;\r\nbegin\r\n  a:=63689;\r\n  Result:=0;\r\n  if length(s)>0 then\r\n    for i:=1 to Length(S) do\r\n      begin\r\n      Result:=Result * a + Ord(S[i]);\r\n      a:=a * b;\r\n      end;\r\n  Result:=(Result and $7FFFFFFF) mod TableSize;\r\nend;\r\n\r\n{ THTNode }\r\n\r\nconstructor THTCustomNode.CreateWith(const AString: string);\r\nbegin\r\n  inherited Create;\r\n  FKey:=AString;\r\nend;\r\n\r\nFunction THTCustomNode.HasKey(const AKey: string): boolean;\r\nbegin\r\n  Result:=(AKey=FKey);\r\nend;\r\n\r\n{ TFPCustomHashTable }\r\n\r\nconstructor TFPCustomHashTable.Create;\r\nbegin\r\n  CreateWith(196613,@RSHash);\r\nend;\r\n\r\nconstructor TFPCustomHashTable.CreateWith(AHashTableSize: Longword;\r\n  aHashFunc: THashFunction);\r\nbegin\r\n  inherited Create;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  HashTableSize:=AHashTableSize;\r\n  FHashFunction:=aHashFunc;\r\nend;\r\n\r\ndestructor TFPCustomHashTable.Destroy;\r\nbegin\r\n  FHashTable.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetDensity: Longword;\r\nbegin\r\n  Result:=FHashTableSize - VoidSlots\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetNumberOfCollisions: Longword;\r\nbegin\r\n  Result:=FCount -(FHashTableSize - VoidSlots)\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashTableSize(const Value: Longword);\r\nvar\r\n  i: Longword;\r\n  newSize: Longword;\r\nbegin\r\n  if Value <> FHashTableSize then\r\n    begin\r\n    i:=0;\r\n    while (PRIMELIST[i] < Value) and (i < 27) do\r\n     Inc(i);\r\n    newSize:=PRIMELIST[i];\r\n    if Count = 0 then\r\n      begin\r\n      FHashTableSize:=newSize;\r\n      InitializeHashTable;\r\n      end\r\n    else\r\n      ChangeTableSize(newSize);\r\n    end;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.InitializeHashTable;\r\nvar\r\n  i: LongWord;\r\nbegin\r\n  if FHashTableSize>0 Then\r\n    for i:=0 to FHashTableSize-1 do\r\n      FHashTable.Add(nil);\r\n  FCount:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.ChangeTableSize(const ANewSize: Longword);\r\nvar\r\n  SavedTable, List: TFPObjectList;\r\n  SavedTableSize: Longword;\r\n  i, j: Longword;\r\n  temp: THTCustomNode;\r\nbegin\r\n  SavedTable:=FHashTable;\r\n  SavedTableSize:=FHashTableSize;\r\n  FHashTableSize:=ANewSize;\r\n  FHashTable:=TFPObjectList.Create(True);\r\n  InitializeHashTable;\r\n  if SavedTableSize>0 Then\r\n    for i:=0 to SavedTableSize-1 do\r\n      begin\r\n      List:=TFPObjectList(SavedTable[i]);\r\n      if Assigned(List) then\r\n        for j:=0 to List.Count -1 do\r\n          begin\r\n          temp:=THTCustomNode(List[j]);\r\n          AddNode(temp);\r\n          end;\r\n      end;\r\n  SavedTable.Free;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.SetHashFunction(AHashFunction: THashFunction);\r\nbegin\r\n  if IsEmpty then\r\n    FHashFunction:=AHashFunction\r\n  else\r\n    raise Exception.Create(NotEmptyMsg);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Find(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          Exit(THTCustomNode(chn[i]));\r\n  Result:=nil;\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindChainForAdd(Const aKey : String) : TFPObjectList;\r\nvar\r\n  hashCode: Longword;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  Result:=Chain(hashCode);\r\n  if Assigned(Result)  then\r\n    begin\r\n    if Result.count>0 then\r\n      for i:=0 to Result.Count - 1 do\r\n        if (THTCustomNode(Result[i]).Key=aKey) then\r\n          raise EDuplicate.CreateFmt(DuplicateMsg, [aKey]);\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(True);\r\n    Result:=Chain(hashCode);\r\n    end;\r\n  Inc(FCount);\r\nend;\r\n\r\n\r\nProcedure TFPCustomHashTable.Delete(const aKey: string);\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn) then\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if THTCustomNode(chn[i]).Key=aKey then\r\n          begin\r\n          chn.Delete(i);\r\n          dec(FCount);\r\n          Exit;\r\n          end;\r\nend;\r\n\r\nFunction TFPCustomHashTable.IsEmpty: boolean;\r\nbegin\r\n  Result:=(FCount = 0);\r\nend;\r\n\r\nFunction TFPCustomHashTable.Chain(const index: Longword): TFPObjectList;\r\nbegin\r\n  Result:=TFPObjectList(FHashTable[index]);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetVoidSlots: Longword;\r\nvar\r\n  i: Longword;\r\n  num: Longword;\r\nbegin\r\n  num:=0;\r\n  if FHashTableSize>0 then\r\n    for i:= 0 to FHashTableSize-1 do\r\n      if not Assigned(Chain(i)) then\r\n        Inc(num);\r\n  Result:=num;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetLoadFactor: double;\r\nbegin\r\n  Result:=Count / FHashTableSize;\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetAVGChainLen: double;\r\nbegin\r\n  Result:=Count / (FHashTableSize - VoidSlots);\r\nend;\r\n\r\nFunction TFPCustomHashTable.GetMaxChainLength: Longword;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  Result:=0;\r\n  if FHashTableSize>0 Then\r\n   for i:=0 to FHashTableSize-1 do\r\n      if ChainLength(i) > Result then\r\n        Result:=ChainLength(i);\r\nend;\r\n\r\nFunction TFPCustomHashTable.FindOrCreateNew(const aKey: string): THTCustomNode;\r\nvar\r\n  hashCode: Longword;\r\n  chn: TFPObjectList;\r\n  i: Longword;\r\nbegin\r\n  hashCode:=FHashFunction(aKey, FHashTableSize);\r\n  chn:=Chain(hashCode);\r\n  if Assigned(chn)  then\r\n    begin\r\n    if chn.count>0 then\r\n      for i:=0 to chn.Count - 1 do\r\n        if (THTCustomNode(chn[i]).Key=aKey) then\r\n          Exit(THTNode(chn[i]));\r\n    end\r\n  else\r\n    begin\r\n    FHashTable[hashcode]:=TFPObjectList.Create(true);\r\n    chn:=Chain(hashcode);\r\n    end;\r\n  Inc(FCount);\r\n  Result:=CreateNewNode(aKey);\r\n  chn.Add(Result);\r\nend;\r\n\r\nFunction TFPCustomHashTable.ChainLength(const ChainIndex: Longword): Longword;\r\nbegin\r\n  if Assigned(Chain(ChainIndex)) then\r\n    Result:=Chain(ChainIndex).Count\r\n  else\r\n    Result:=0;\r\nend;\r\n\r\nProcedure TFPCustomHashTable.Clear;\r\nvar\r\n  i: Longword;\r\nbegin\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize - 1 do\r\n      if Assigned(Chain(i)) then\r\n        Chain(i).Clear;\r\n  FCount:=0;\r\nend;\r\n\r\n\r\n\r\n{ TFPDataHashTable }\r\n\r\nProcedure TFPDataHashTable.Add(const aKey: string; aItem: JSValue);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtDataNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtDataNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPDataHashTable.GetData(const Index: string): JSValue;\r\nvar\r\n  node: THTDataNode;\r\nbegin\r\n  node:=THTDataNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.SetData(const index: string; const AValue: JSValue);\r\nbegin\r\n  THTDataNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nFunction TFPDataHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\n\r\nbegin\r\n  Result:=THTDataNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorMethod): JSValue;\r\nvar\r\n  N : THTDataNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPDataHashTable.CallbackIterator(Item: JSValue; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPDataHashTable.Iterate(aMethod: TDataIteratorCallBack): JSValue;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPDataHashTable.ForEachCall(aMethod: TDataIteratorMethod): THTDataNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: Boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTDataNode(Chain(i)[j]).Data, THTDataNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTDataNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n           end;\r\nend;\r\n\r\nProcedure TFPDataHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTDataNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\n{ TFPStringHashTable }\r\n\r\nProcedure TFPStringHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  with THTStringNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPStringHashTable.GetData(const Index: string): String;\r\nvar\r\n  node: THTStringNode;\r\nbegin\r\n  node:=THTStringNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.SetData(const index, AValue: string);\r\nbegin\r\n  THTStringNode(FindOrCreateNew(index)).Data:=AValue;\r\nend;\r\n\r\nProcedure TFPStringHashTable.Add(const aKey, aItem: string);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THtStringNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THtStringNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPStringHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  Result:=THTStringNode.CreateWith(aKey);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorMethod): String;\r\nvar\r\n  N : THTStringNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:='';\r\nend;\r\n\r\nProcedure TFPStringHashTable.CallbackIterator(Item: String; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPStringHashTable.Iterate(aMethod: TStringIteratorCallback): String;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPStringHashTable.ForEachCall(aMethod: TStringIteratorMethod): THTStringNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=True;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n            begin\r\n            aMethod(THTStringNode(Chain(i)[j]).Data, THTStringNode(Chain(i)[j]).Key, continue);\r\n            if not continue then\r\n              begin\r\n              Result:=THTStringNode(Chain(i)[j]);\r\n              Exit;\r\n              end;\r\n            end;\r\nend;\r\n\r\n{ TFPObjectHashTable }\r\n\r\nProcedure TFPObjectHashTable.AddNode(ANode : THTCustomNode);\r\nbegin\r\n  With THTObjectNode(ANode) do\r\n    Add(Key,Data);\r\nend;\r\n\r\nFunction TFPObjectHashTable.GetData(const Index: string): TObject;\r\nvar\r\n  node: THTObjectNode;\r\nbegin\r\n  node:=THTObjectNode(Find(Index));\r\n  if Assigned(node) then\r\n    Result:=node.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.SetData(const index : string; AObject : TObject);\r\nbegin\r\n  THTObjectNode(FindOrCreateNew(index)).Data:=AObject;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.Add(const aKey: string; AItem : TObject);\r\nvar\r\n  chn: TFPObjectList;\r\n  NewNode: THTObjectNode;\r\nbegin\r\n  chn:=FindChainForAdd(akey);\r\n  NewNode:=THTObjectNode(CreateNewNode(aKey));\r\n  NewNode.Data:=aItem;\r\n  chn.Add(NewNode);\r\nend;\r\n\r\nFunction TFPObjectHashTable.CreateNewNode(const aKey : string) : THTCustomNode;\r\nbegin\r\n  if OwnsObjects then\r\n    Result:=THTOwnedObjectNode.CreateWith(aKey)\r\n  else\r\n    Result:=THTObjectNode.CreateWith(aKey);\r\nend;\r\n\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorMethod): TObject;\r\nvar\r\n  N : THTObjectNode;\r\nbegin\r\n  N:=ForEachCall(AMethod);\r\n  if Assigned(N) then\r\n    Result:=N.Data\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\nProcedure TFPObjectHashTable.CallbackIterator(Item: TObject; const Key: string; var Continue: Boolean);\r\nbegin\r\n  FIteratorCallBack(Item, Key, Continue);\r\nend;\r\n\r\nFunction TFPObjectHashTable.Iterate(aMethod: TObjectIteratorCallback): TObject;\r\nbegin\r\n  FIteratorCallBack := aMethod;\r\n  Result := Iterate(@CallbackIterator);\r\nend;\r\n\r\nFunction TFPObjectHashTable.ForEachCall(aMethod: TObjectIteratorMethod): THTObjectNode;\r\nvar\r\n  i, j: Longword;\r\n  continue: boolean;\r\nbegin\r\n  Result:=nil;\r\n  continue:=true;\r\n  if FHashTableSize>0 then\r\n    for i:=0 to FHashTableSize-1 do\r\n      if Assigned(Chain(i)) then\r\n        if Chain(i).Count>0 then\r\n          for j:=0 to Chain(i).Count-1 do\r\n           begin\r\n           aMethod(THTObjectNode(Chain(i)[j]).Data, THTObjectNode(Chain(i)[j]).Key, continue);\r\n           if not continue then\r\n             begin\r\n             Result:=THTObjectNode(Chain(i)[j]);\r\n             Exit;\r\n             end;\r\n           end;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.Create(AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited Create;\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\nconstructor TFPObjectHashTable.CreateWith(AHashTableSize: Longword; aHashFunc: THashFunction; AOwnsObjects : Boolean = True);\r\nbegin\r\n  inherited CreateWith(AHashTableSize,AHashFunc);\r\n  FOwnsObjects:=AOwnsObjects;\r\nend;\r\n\r\ndestructor THTOwnedObjectNode.Destroy;\r\nbegin\r\n  FreeAndNil(FData);\r\n  inherited;\r\nend;\r\n\r\n{ TCustomBucketList }\r\n\r\nFunction TCustomBucketList.GetData(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  Result:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.GetBucketCount: Integer;\r\nbegin\r\n  Result:=Length(FBuckets);\r\nend;\r\n\r\nProcedure TCustomBucketList.SetData(AItem: JSValue; const AData: JSValue);\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  GetBucketItem(AItem,B,I);\r\n  FBuckets[B].Items[I].Data:=AData;\r\nend;\r\n\r\nProcedure TCustomBucketList.SetBucketCount(const Value: Integer);\r\nbegin\r\n  if (Value<>GetBucketCount) then\r\n    SetLength(FBuckets,Value);\r\nend;\r\n\r\nProcedure TCustomBucketList.GetBucketItem(AItem: JSValue; out ABucket,\r\n  AIndex: Integer);\r\nbegin\r\n  if not FindItem(AItem,ABucket,AIndex) then\r\n    Error(SErrNoSuchItem,[AItem]);\r\nend;\r\n\r\nFunction TCustomBucketList.AddItem(ABucket: Integer; AItem, AData: JSValue\r\n  ): JSValue;\r\nvar\r\n  L : Integer;\r\nbegin\r\n  L:=Length(FBuckets[ABucket].Items);\r\n  if (FBuckets[ABucket].Count=L) then\r\n    begin\r\n    if L<8 then\r\n      L:=8\r\n    else\r\n      L:=L+L div 2;\r\n    SetLength(FBuckets[ABucket].Items,L);\r\n    end;\r\n  with FBuckets[ABucket] do\r\n    begin\r\n    Items[Count].Item:=AItem;\r\n    Items[Count].Data:=AData;\r\n    Result:=AData;\r\n    Inc(Count);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.DeleteItem(ABucket: Integer; AIndex: Integer): JSValue;\r\nvar\r\n  I,L : Integer;\r\nbegin\r\n  Result:=FBuckets[ABucket].Items[AIndex].Data;\r\n  if FBuckets[ABucket].Count=1 then\r\n    SetLength(FBuckets[ABucket].Items,0)\r\n  else\r\n    begin\r\n    L:=(FBuckets[ABucket].Count-AIndex-1);// No point in moving if last one...\r\n    For I:=0 to L-1 do\r\n      FBuckets[ABucket].Items[AIndex+I]:=FBuckets[ABucket].Items[AIndex+I+1];\r\n    end;\r\n  Dec(FBuckets[ABucket].Count);\r\nend;\r\n\r\nProcedure TCustomBucketList.Error(Msg: String; Args: array of JSValue);\r\nbegin\r\n  raise ElistError.CreateFmt(Msg,Args);\r\nend;\r\n\r\nFunction TCustomBucketList.FindItem(AItem: JSValue; out ABucket, AIndex: Integer\r\n  ): Boolean;\r\nvar\r\n  I : Integer;\r\n  B : TBucket;\r\nbegin\r\n  ABucket:=BucketFor(AItem);\r\n  B:=FBuckets[ABucket];\r\n  I:=B.Count-1;\r\n  while (I>=0) and (B.Items[I].Item<>AItem) do\r\n    Dec(I);\r\n  Result:=I>=0;\r\n  if Result then\r\n    AIndex:=I;\r\nend;\r\n\r\ndestructor TCustomBucketList.Destroy;\r\nbegin\r\n  Clear;\r\n  inherited Destroy;\r\nend;\r\n\r\nProcedure TCustomBucketList.Clear;\r\nvar\r\n  B : TBucket;\r\n  I,J : Integer;\r\nbegin\r\n  for I:=0 to Length(FBuckets)-1 do\r\n    begin\r\n    B:=FBuckets[I];\r\n    for J:=B.Count-1 downto 0 do\r\n      DeleteItem(I,J);\r\n    end;\r\n  SetLength(FBuckets,0);\r\nend;\r\n\r\nFunction TCustomBucketList.Add(AItem, AData: JSValue): JSValue;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    Error(SDuplicateItem,[AItem]);\r\n  Result:=AddItem(B,AItem,AData);\r\nend;\r\n\r\nProcedure TCustomBucketList.Assign(AList: TCustomBucketList);\r\nvar\r\n  I,J : Integer;\r\nbegin\r\n  Clear;\r\n  SetLength(FBuckets,Length(Alist.FBuckets));\r\n  for I:=0 to BucketCount-1 do\r\n    begin\r\n    SetLength(FBuckets[i].Items,Length(AList.Fbuckets[I].Items));\r\n    for J:=0 to AList.Fbuckets[I].Count-1 do\r\n      with AList.Fbuckets[I].Items[J] do\r\n        AddItem(I,Item,Data);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Exists(AItem: JSValue): Boolean;\r\nvar\r\n  B,I : Integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\nend;\r\n\r\nFunction TCustomBucketList.Find(AItem: JSValue; out AData: JSValue): Boolean;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  Result:=FindItem(AItem,B,I);\r\n  if Result then\r\n    AData:=FBuckets[B].Items[I].Data;\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc): Boolean;\r\nbegin\r\n  Result:=Foreach(aProc,Null);\r\nend;\r\n\r\nFunction TCustomBucketList.ForEach(AProc: TBucketProc; AInfo: JSValue): Boolean;\r\nvar\r\n  I,J,S : Integer;\r\n  Bu : TBucket;\r\nbegin\r\n  I:=0;\r\n  Result:=True;\r\n  S:=GetBucketCount;\r\n  while Result and (I<S) do\r\n    begin\r\n    J:=0;\r\n    Bu:=FBuckets[I];\r\n    while Result and (J<Bu.Count) do\r\n      begin\r\n      with Bu.Items[J] do\r\n        AProc(AInfo,Item,Data,Result);\r\n      Inc(J);\r\n      end;\r\n    Inc(I);\r\n    end;\r\nend;\r\n\r\nFunction TCustomBucketList.Remove(AItem: JSValue): JSValue;\r\nvar\r\n  B,I : integer;\r\nbegin\r\n  if FindItem(AItem,B,I) then\r\n    begin\r\n    Result:=FBuckets[B].Items[I].Data;\r\n    DeleteItem(B,I);\r\n    end\r\n  else\r\n    Result:=nil;\r\nend;\r\n\r\n{ TBucketList }\r\n\r\nFunction TBucketList.BucketFor(AItem: JSValue): Integer;\r\nbegin\r\n  // JSValues on average have a granularity of 4\r\n  Result:=(PtrInt(AItem) shr 2) and FBucketMask;\r\nend;\r\n\r\nconstructor TBucketList.Create(ABuckets: TBucketListSizes);\r\nvar\r\n  L : Integer;\r\nbegin\r\n  inherited Create;\r\n  L:=1 shl (Ord(Abuckets)+1);\r\n  SetBucketCount(L);\r\n  FBucketMask:=L-1;\r\nend;\r\n\r\n{ TObjectBucketList }\r\n\r\nFunction TObjectBucketList.GetData(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited GetData(AItem));\r\nend;\r\n\r\nProcedure TObjectBucketList.SetData(AItem: TObject; const AData: TObject);\r\nbegin\r\n  inherited SetData(JSValue(AItem),JSValue(AData));\r\nend;\r\n\r\nFunction TObjectBucketList.Add(AItem, AData: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Add(JSValue(AItem),JSValue(AData)));\r\nend;\r\n\r\nFunction TObjectBucketList.Remove(AItem: TObject): TObject;\r\nbegin\r\n  Result:=TObject(inherited Remove(JSValue(AItem)));\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Graphics;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, Types, Web, JS;\r\n\r\nconst\r\n  SysDefault = $20000000;\r\n\r\n  clNone = -1;\r\n  clBlack = $000000;\r\n  clMaroon = $000080;\r\n  clGreen = $008000;\r\n  clOlive = $008080;\r\n  clNavy = $800000;\r\n  clPurple = $800080;\r\n  clTeal = $008080;\r\n  clGray = $808080;\r\n  clSilver = $C0C0C0;\r\n  clRed = $0000FF;\r\n  clLime = $00FF00;\r\n  clYellow = $00FFFF;\r\n  clBlue = $FF0000;\r\n  clFuchsia = $FF00FF;\r\n  clAqua = $FFFF00;\r\n  clLtGray = $C0C0C0;\r\n  clDkGray = $808080;\r\n  clWhite = $FFFFFF;\r\n  clDefault = SysDefault;\r\n  clBtnFace = $F0F0F0;\r\n  clWindowText = clBlack;\r\n  clWindow = clWhite;\r\n  clHighlight = $D77800;\r\n  clHighlightText = clWhite;\r\n  clInfoText = clBlack;\r\n  clInfoBk = $E1FFFF;\r\n  clActiveCaption = $D1B499;\r\n  clHotLight = $CC6600;\r\n\r\n  clMoneyGreen = $C0DCC0;\r\n  clSkyBlue = $F0CAA6;\r\n  clCream = $F0FBFF;\r\n  clMedGray = $A0A0A0;\r\n\r\n  clWebAliceblue = $FFF8F0;\r\n  clWebAntiquewhite = $D7EBFA;\r\n  clWebAqua = $FFFF00;\r\n  clWebAquamarine = $D4FF7F;\r\n  clWebAzure = $FFFFF0;\r\n  clWebBeige = $DCF5F5;\r\n  clWebBisque = $C4E4FF;\r\n  clWebBlack = $000000;\r\n  clWebBlanchedalmond = $CDEBFF;\r\n  clWebBlue = $FF0000;\r\n  clWebBlueviolet = $E22B8A;\r\n  clWebBrown = $2A2AA5;\r\n  clWebBurlywood = $87B8DE;\r\n  clWebCadetblue = $A09E5F;\r\n  clWebChartreuse = $00FF7F;\r\n  clWebChocolate = $1E69D2;\r\n  clWebCoral = $507FFF;\r\n  clWebCornflowerblue = $ED9564;\r\n  clWebCornsilk = $DCF8FF;\r\n  clWebCrimson = $3C14DC;\r\n  clWebCyan = $FFFF00;\r\n  clWebDarkblue = $8B0000;\r\n  clWebDarkcyan = $8B8B00;\r\n  clWebDarkgoldenrod = $0B86B8;\r\n  clWebDarkgray = $A9A9A9;\r\n  clWebDarkgreen = $006400;\r\n  clWebDarkgrey = $A9A9A9;\r\n  clWebDarkkhaki = $6BB7BD;\r\n  clWebDarkmagenta = $8B008B;\r\n  clWebDarkolivegreen = $2F6B55;\r\n  clWebDarkorange = $008CFF;\r\n  clWebDarkorchid = $CC3299;\r\n  clWebDarkred = $00008B;\r\n  clWebDarksalmon = $7A96E9;\r\n  clWebDarkseagreen = $8FBC8F;\r\n  clWebDarkslateblue = $8B3D48;\r\n  clWebDarkslategray = $4F4F2F;\r\n  clWebDarkslategrey = $4F4F2F;\r\n  clWebDarkturquoise = $D1CE00;\r\n  clWebDarkviolet = $D30094;\r\n  clWebDeeppink = $9314FF;\r\n  clWebDeepskyblue = $FFBF00;\r\n  clWebDimgray = $696969;\r\n  clWebDimgrey = $696969;\r\n  clWebDodgerblue = $FF901E;\r\n  clWebFirebrick = $2222B2;\r\n  clWebFloralwhite = $F0FAFF;\r\n  clWebForestgreen = $228B22;\r\n  clWebFuchsia = $FF00FF;\r\n  clWebGainsboro = $DCDCDC;\r\n  clWebGhostwhite = $FFF8F8;\r\n  clWebGold = $00D7FF;\r\n  clWebGoldenrod = $20A5DA;\r\n  clWebGray = $808080;\r\n  clWebGreen = $008000;\r\n  clWebGreenyellow = $2FFFAD;\r\n  clWebGrey = $808080;\r\n  clWebHoneydew = $F0FFF0;\r\n  clWebHotpink = $B469FF;\r\n  clWebIndianred = $5C5CCD;\r\n  clWebIndigo = $82004B;\r\n  clWebIvory = $F0FFFF;\r\n  clWebKhaki = $8CE6F0;\r\n  clWebLavender = $FAE6E6;\r\n  clWebLavenderblush = $F5F0FF;\r\n  clWebLawngreen = $00FC7C;\r\n  clWebLemonchiffon = $CDFAFF;\r\n  clWebLightblue = $E6D8AD;\r\n  clWebLightcoral = $8080F0;\r\n  clWebLightcyan = $FFFFE0;\r\n  clWebLightgoldenrodyellow = $D2FAFA;\r\n  clWebLightgray = $D3D3D3;\r\n  clWebLightgreen = $90EE90;\r\n  clWebLightgrey = $D3D3D3;\r\n  clWebLightpink = $C1B6FF;\r\n  clWebLightsalmon = $7AA0FF;\r\n  clWebLightseagreen = $AAB220;\r\n  clWebLightskyblue = $FACE87;\r\n  clWebLightslategray = $998877;\r\n  clWebLightslategrey = $998877;\r\n  clWebLightsteelblue = $DEC4B0;\r\n  clWebLightyellow = $E0FFFF;\r\n  clWebLtGray = $C0C0C0;\r\n  clWebMedGray = $A4A0A0;\r\n  clWebDkGray = $808080;\r\n  clWebMoneyGreen = $C0DCC0;\r\n  clWebLegacySkyBlue = $F0CAA6;\r\n  clWebCream = $F0FBFF;\r\n  clWebLime = $00FF00;\r\n  clWebLimegreen = $32CD32;\r\n  clWebLinen = $E6F0FA;\r\n  clWebMagenta = $FF00FF;\r\n  clWebMaroon = $000080;\r\n  clWebMediumaquamarine = $AACD66;\r\n  clWebMediumblue = $CD0000;\r\n  clWebMediumorchid = $D355BA;\r\n  clWebMediumpurple = $DB7093;\r\n  clWebMediumseagreen = $71B33C;\r\n  clWebMediumslateblue = $EE687B;\r\n  clWebMediumspringgreen = $9AFA00;\r\n  clWebMediumturquoise = $CCD148;\r\n  clWebMediumvioletred = $8515C7;\r\n  clWebMidnightblue = $701919;\r\n  clWebMintcream = $FAFFF5;\r\n  clWebMistyrose = $E1E4FF;\r\n  clWebMoccasin = $B5E4FF;\r\n  clWebNavajowhite = $ADDEFF;\r\n  clWebNavy = $800000;\r\n  clWebOldlace = $E6F5FD;\r\n  clWebOlive = $008080;\r\n  clWebOlivedrab = $238E6B;\r\n  clWebOrange = $00A5FF;\r\n  clWebOrangered = $0045FF;\r\n  clWebOrchid = $D670DA;\r\n  clWebPalegoldenrod = $AAE8EE;\r\n  clWebPalegreen = $98FB98;\r\n  clWebPaleturquoise = $EEEEAF;\r\n  clWebPalevioletred = $9370DB;\r\n  clWebPapayawhip = $D5EFFF;\r\n  clWebPeachpuff = $B9DAFF;\r\n  clWebPeru = $3F85CD;\r\n  clWebPink = $CBC0FF;\r\n  clWebPlum = $DDA0DD;\r\n  clWebPowderblue = $E6E0B0;\r\n  clWebPurple = $800080;\r\n  clWebRed = $0000FF;\r\n  clWebRosybrown = $8F8FBC;\r\n  clWebRoyalblue = $E16941;\r\n  clWebSaddlebrown = $13458B;\r\n  clWebSalmon = $7280FA;\r\n  clWebSandybrown = $60A4F4;\r\n  clWebSeagreen = $578B2E;\r\n  clWebSeashell = $EEF5FF;\r\n  clWebSienna = $2D52A0;\r\n  clWebSilver = $C0C0C0;\r\n  clWebSkyblue = $EBCE87;\r\n  clWebSlateblue = $CD5A6A;\r\n  clWebSlategray = $908070;\r\n  clWebSlategrey = $908070;\r\n  clWebSnow = $FAFAFF;\r\n  clWebSpringgreen = $7FFF00;\r\n  clWebSteelblue = $B48246;\r\n  clWebTan = $8CB4D2;\r\n  clWebTeal = $808000;\r\n  clWebThistle = $D8BFD8;\r\n  clWebTomato = $4763FF;\r\n  clWebTurquoise = $D0E040;\r\n  clWebViolet = $EE82EE;\r\n  clWebWheat = $B3DEF5;\r\n  clWebWhite = $FFFFFF;\r\n  clWebWhitesmoke = $F5F5F5;\r\n  clWebYellow = $00FFFF;\r\n  clWebYellowgreen = $32CD9A;\r\n\r\n  ANSI_CHARSET = 0;\r\n  DEFAULT_CHARSET = 1;\r\n  SYMBOL_CHARSET = 2;\r\n  MAC_CHARSET = 77;\r\n  SHIFTJIS_CHARSET = 128;\r\n  HANGEUL_CHARSET = 129;\r\n  JOHAB_CHARSET = 130;\r\n  GB2312_CHARSET = 134;\r\n  CHINESEBIG5_CHARSET = 136;\r\n  GREEK_CHARSET = 161;\r\n  TURKISH_CHARSET = 162;\r\n  HEBREW_CHARSET = 177;\r\n  ARABIC_CHARSET = 178;\r\n  BALTIC_CHARSET = 186;\r\n  RUSSIAN_CHARSET = 204;\r\n  THAI_CHARSET = 222;\r\n  EASTEUROPE_CHARSET = 238;\r\n  OEM_CHARSET = 255;\r\n\r\ntype\r\n  Single = Double;\r\n  TColor = Integer;\r\n\r\n  TVerticalAlignment = (taAlignTop, taAlignBottom, taVerticalCenter);\r\n\r\n  TPenStyle = (psSolid, psDash, psDot, psDashDot, psDashDotDot, psClear,\r\n    psInsideFrame, psUserStyle, psAlternate);\r\n\r\n  TBrushStyle = (bsSolid, bsClear, bsHorizontal, bsVertical,\r\n    bsFDiagonal, bsBDiagonal, bsCross, bsDiagCross);\r\n\r\n  TFontStyle = (fsBold, fsItalic, fsStrikeOut, fsUnderline);\r\n\r\n  TFontStyles = set of TFontStyle;\r\n\r\n  TFontCharset = 0..255;\r\n\r\n  TCanvasPointF = record\r\n    X: Double;\r\n    Y: Double;\r\n  end;\r\n\r\n  TCanvasRectF = record\r\n    Left, Top, Right, Bottom: Double;\r\n  end;\r\n\r\n  TCanvasSizeF = record\r\n    cx: Double;\r\n    cy: Double;\r\n  end;\r\n  \r\n  TPen = class(TPersistent)\r\n  private\r\n    FWidth: Integer;\r\n    FColor: TColor;\r\n    FStyle: TPenStyle;\r\n    procedure SetColor(const Value: TColor);\r\n  public\r\n    constructor Create; reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Color: TColor read FColor write SetColor;\r\n    property Width: Integer read FWidth write FWidth;\r\n    property Style: TPenStyle read FStyle write FStyle;\r\n  end;\r\n\r\n  TBrush = class(TPersistent)\r\n  private\r\n    FColor: TColor;\r\n    FStyle: TBrushStyle;\r\n  public\r\n    constructor Create; reintroduce;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Color: TColor read FColor write FColor;\r\n    property Style: TBrushStyle read FStyle write FStyle;\r\n  end;\r\n\r\n  TFont = class(TPersistent)\r\n  private\r\n    FName: string;\r\n    FSize: Integer;\r\n    FColor: TColor;\r\n    FStyle: TFontStyles;\r\n    FOnChange: TNotifyEvent;\r\n    FHeight: Integer;\r\n    FCharset: TFontCharset;\r\n    procedure SetHeight(const Value: Integer);\r\n  protected\r\n    procedure SetName(const AName: string);\r\n    procedure SetSize(const ASize: Integer);\r\n    procedure SetColor(const AColor: TColor);\r\n    procedure SetStyle(const AStyle: TFontStyles);\r\n    procedure DoChange; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create; reintroduce;\r\n    function ToString: string; override;\r\n  published\r\n    property Charset: TFontCharset read FCharset write FCharset;\r\n    property Name: string read FName write SetName;\r\n    property Height: Integer read FHeight write SetHeight;\r\n    property Style: TFontStyles read FStyle write SetStyle;\r\n    property Color: TColor read FColor write SetColor;\r\n    property Size: Integer read FSize write SetSize;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TCanvas = class;\r\n\r\n  TStream = TObject;\r\n\r\n  TBitmap = class;\r\n\r\n  TGraphic = class(TObject)\r\n  private\r\n    FAddToQueue: Boolean;\r\n    FCanvasElement: TJSHTMLCanvasElement;\r\n    FEmpty: Boolean;\r\n    FData: string;\r\n    FCanvas: TCanvas;\r\n    FOnChange: TNotifyEvent;\r\n    FImage: TJSObject;\r\n    FBitmap: TBitmap;\r\n    FURL: String;\r\n    procedure SetHeight(const Value: Integer);\r\n    procedure SetWidth(const Value: Integer);\r\n    function GetCanvas: TCanvas;\r\n  protected\r\n    procedure DoChange;\r\n    procedure SetURL(const URL: string);\r\n    function GetWidth: Integer;\r\n    function GetHeight: Integer;\r\n    procedure RecreateCanvas;\r\n    procedure DoBeginScene(Sender: TObject);\r\n    procedure DoEndScene(Sender: TObject);\r\n    procedure AssignEvents;\r\n    procedure CreateImage;\r\n    procedure LoadFromCache(AData: String);\r\n  public\r\n    class function CreateFromResource(AResource: String): TGraphic; overload;\r\n    class function CreateFromResource(AResource: String; AInstance: NativeUInt): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String): TGraphic; overload;\r\n    class function CreateFromURL(AURL: String; AInstance: NativeUInt): TGraphic; overload;\r\n    function Image: TJSObject;\r\n    function Empty: Boolean;\r\n    function GetBase64Image: string;\r\n    constructor Create(URL: string); overload;\r\n    constructor Create(Img: TJSObject); overload;\r\n    constructor Create; overload; reintroduce;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    procedure CaptureCanvas; virtual;\r\n    procedure LoadFromCanvas(ACanvas: TCanvas); virtual;\r\n    procedure SetSize(AWidth, AHeight: Integer);\r\n    procedure Assign(Source: TGraphic); virtual;\r\n    procedure LoadFromURL(AURL: string); virtual; overload;\r\n    procedure LoadFromURL(AURL: string; AHInstance: Integer); virtual; overload;\r\n    procedure LoadFromFile(AFileName: string); virtual;\r\n    procedure LoadFromResource(AResource: string); virtual; overload;\r\n    procedure LoadFromResource(AResource: string; AHInstance: Integer); virtual; overload;\r\n    procedure LoadFromStream(AStream: TStream);\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property Bitmap: TBitmap read FBitmap;\r\n  published   \r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property URL: string read FURL write SetURL;\r\n  end;\r\n\r\n  TBitmap = class(TGraphic)\r\n  end;\r\n\r\n  TCanvas = class(TObject)\r\n  private\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FContext: TJSCanvasRenderingContext2D;\r\n    FPen: TPen;\r\n    FBrush: TBrush;\r\n    FFont: TFont;\r\n    FPathOpen: boolean;\r\n    FPathX, FPathY: Double;\r\n    FClipRect: TCanvasRectF;\r\n    FOnEndScene: TNotifyEvent;\r\n    FOnBeginScene: TNotifyEvent;\r\n    procedure SetClipRect(const Value: TCanvasRectF);\r\n  protected\r\n    function GetPixel(X,Y: Integer): TColor;\r\n    procedure SetPixel(X,Y: Integer; Clr: TColor);\r\n    procedure ApplyStroke;\r\n    procedure ApplyFill;\r\n    property OnBeginScene: TNotifyEvent read FOnBeginScene write FOnBeginScene;\r\n    property OnEndScene: TNotifyEvent read FOnEndScene write FOnEndScene;\r\n  public\r\n    constructor Create(AControl: TJSHTMLCanvasElement); overload; virtual;\r\n    constructor Create; overload; reintroduce;\r\n    destructor Destroy; override;\r\n    procedure SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Transform(m11, m12, m21, m22, dx, dy: Double);\r\n    procedure Rotate(Angle: Double);\r\n    procedure Translate(X, Y: Double);\r\n    procedure AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double); overload;\r\n    procedure AngleArc(X, Y: Double; Radius: Double; StartAngle, SweepAngle: Double); overload;\r\n    procedure MoveTo(X, Y: Integer); overload;\r\n    procedure MoveTo(X, Y: Double); overload;\r\n    procedure LineTo(X, Y: Integer); overload;\r\n    procedure LineTo(X, Y: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Rectangle(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Rectangle(const Rect: TRect); overload;\r\n    procedure Rectangle(const Rect: TCanvasRectF); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Integer); overload;\r\n    procedure RoundRect(X1, Y1, X2, Y2, X3, Y3: Double); overload;\r\n    procedure RoundRect(const Rect: TRect; CX, CY: Integer); overload;\r\n    procedure RoundRect(const Rect: TCanvasRectF; CX, CY: Double); overload;\r\n    procedure FillRect(const Rect: TRect); overload;\r\n    procedure FillRect(const Rect: TCanvasRectF); overload;\r\n    procedure Ellipse(X1, Y1, X2, Y2: Integer); overload;\r\n    procedure Ellipse(X1, Y1, X2, Y2: Double); overload;\r\n    procedure Ellipse(const Rect: TRect); overload;\r\n    procedure Ellipse(const Rect: TCanvasRectF); overload;\r\n    procedure Polyline(const Points: array of TPoint); overload;\r\n    procedure Polyline(const Points: array of TCanvasPointF); overload;\r\n    procedure Polygon(const Points: array of TPoint); overload;\r\n    procedure Polygon(const Points: array of TCanvasPointF); overload;\r\n    procedure TextOut(X, Y: Integer; const Text: string); overload;\r\n    procedure TextOut(X, Y: Double; const Text: string); overload;\r\n    procedure Draw(X, Y: Integer; Graphic: TGraphic); overload;\r\n    procedure Draw(X, Y: Double; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TRect; Graphic: TGraphic); overload;\r\n    procedure StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic); overload;\r\n    procedure DrawFocusRect(const Rect: TRect); overload;\r\n    procedure DrawFocusRect(const Rect: TCanvasRectF); overload;\r\n    procedure BeginScene;\r\n    procedure EndScene;\r\n    procedure Save;\r\n    procedure Clip;\r\n    procedure Restore;\r\n    procedure Refresh;\r\n    procedure Clear; overload;\r\n    procedure Clear(AColor: TColor); overload;\r\n    function TextExtent(const Text: string): TCanvasSizeF;\r\n    function TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect; overload;\r\n    function TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF; overload;\r\n    function TextWidth(const Text: string): Double; overload;\r\n    function TextHeight(const Text: string): Double; overload;\r\n    property Element: TJSHTMLCanvasElement read FElementCanvas;\r\n    property Pen: TPen read FPen;\r\n    property Brush: TBrush read FBrush;\r\n    property Font: TFont read FFont;\r\n    property Pixels[X, Y: Integer]: TColor read GetPixel write SetPixel;\r\n    property ClipRect: TCanvasRectF read FClipRect write SetClipRect;\r\n    property Context: TJSCanvasRenderingContext2D read FContext;\r\n  end;\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nfunction ColorToHex(c: TColor): string;\r\nfunction ColorToHTML(c: TColor): string;\r\nfunction FontSizeToHTML(sz: Double): string;\r\nfunction HTMLChar(h: string): integer;\r\nfunction HexToColor(h: string): TColor;\r\nfunction FontSizeToPx(sz: Double): Double;\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nfunction RGB(r, g, b: Byte): TColor;\r\nfunction CSSFont(Font: TFont): string;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, Math, SysUtils, Contnrs;\r\n\r\ntype\r\n  TGraphicCache = class\r\n  private\r\n    FImage: TJSObject;\r\n    FID: string;\r\n  public\r\n    constructor Create(AImage: TJSObject; AID: string); reintroduce;\r\n    property Image: TJSObject read FImage;\r\n    property ID: string read FID;\r\n  end;\r\n\r\n  TGraphicCacheList = class(TObjectList)\r\n  public\r\n    function Find(AID: string; var FImage: TJSObject): Boolean; virtual;\r\n    function Exists(AID: string): Boolean; virtual;\r\n  end;\r\n\r\nvar\r\n  FCache: TGraphicCacheList;\r\n  FQueue: TStringList;\r\n  FCacheCount: Integer = 0;\r\n\r\nfunction RGB(r, g, b: Byte): TColor;\r\nbegin\r\n  Result := (r or (g shl 8) or (b shl 16));\r\nend;\r\n\r\nfunction CSSFont(Font: TFont): string;\r\nvar\r\n  res,fs: string;\r\nbegin\r\n  res := 'font-family:'+ Font.Name+';';\r\n  res := res + 'font-style: normal;';\r\n\r\n  if fsBold in Font.Style then\r\n    res := res + 'font-weight: bold;';\r\n\r\n  if fsItalic in Font.Style then\r\n    res := res + 'font-style: italic;';\r\n\r\n  fs := '';\r\n\r\n  if fsUnderline in Font.Style then\r\n    fs := fs + ' underline';\r\n\r\n  if fsStrikeOut in Font.Style then\r\n     fs:= fs + ' line-through';\r\n\r\n  if (fs <> '') then\r\n    res := res + 'text-decoration:' + fs+';';\r\n\r\n  res := res + 'font-size:'+ IntToStr(Font.Size) + 'pt;';\r\n\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction CreateCanvasRectF(Left, Top, Right, Bottom: Double): TCanvasRectF;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Right;\r\n  Result.Bottom := Bottom;\r\nend;\r\n\r\nfunction CreateCanvasPointF(X, Y: Double): TCanvasPointF;\r\nbegin\r\n  Result.X := X;\r\n  Result.Y := Y;\r\nend;\r\n\r\nfunction CreateCanvasSizeF(cx, cy: Double): TCanvasSizeF;\r\nbegin\r\n  Result.cx := cx;\r\n  Result.cy := cy;\r\nend;\r\n\r\nfunction GetRValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte(rgb and $FF);\r\nend;\r\n\r\nfunction GetGValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 8) and $FF);\r\nend;\r\n\r\nfunction GetBValue(rgb: NativeInt): Byte;\r\nbegin\r\n  Result := Byte((rgb shr 16) and $FF);\r\nend;\r\n\r\nfunction ColorToRGB(Color: TColor): Longint;\r\nbegin\r\n  Result := Color;\r\nend;\r\n\r\nfunction ColorToHex(c: TColor): string;\r\nvar\r\n  s: string;\r\nbegin\r\n  asm\r\n    s = c.toString(16);\r\n\r\n    while (s.length < 6)\r\n    {\r\n      s = \"0\" + s;\r\n    }\r\n  end;\r\n\r\n  Result := Copy(s,5,2) + Copy(s,3,2) + Copy(s,1,2);\r\nend;\r\n\r\nfunction ColorToHTML(c: TColor): string;\r\nbegin\r\n  Result := '#' + ColorToHex(c);\r\nend;\r\n\r\nfunction HexToColor(h: string): TColor;\r\nvar\r\n  s: string;\r\nbegin\r\n  h := StringReplace(h, '#', '', []);\r\n  h := StringReplace(h, '$', '', []);\r\n  s := '$' + Copy(h,5,2) + Copy(h,3,2) + Copy(h,1,2);\r\n  Result := StrToInt64(s);\r\nend;\r\n\r\nfunction HTMLChar(h: string): integer;\r\nbegin\r\n  // fmt &#xABCD;\r\n  Delete(h,1,3);\r\n  Delete(h,Length(h) - 1, 1);\r\n  Result := StrToInt('0x' + h);\r\nend;\r\n\r\nfunction FontSizeToHTML(sz: Double): string;\r\nbegin\r\n  Result := FloatToStr(sz)+'px';\r\n  Result := StringReplace(Result, ',', '.', [rfReplaceAll]);\r\nend;\r\n\r\n{ TPen }\r\n\r\nprocedure TPen.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TPen) then\r\n  begin\r\n    FColor := (Source as TPen).Color;\r\n    FStyle := (Source as TPen).Style;\r\n    FWidth := (Source as TPen).Width;\r\n  end;\r\nend;\r\n\r\nconstructor TPen.Create;\r\nbegin\r\n  FColor := clBlack;\r\n  FWidth := 1;\r\n  FStyle := psSolid;\r\nend;\r\n\r\nprocedure TPen.SetColor(const Value: TColor);\r\nbegin\r\n  FColor := Value;\r\nend;\r\n\r\n{ TBrush }\r\n\r\nprocedure TBrush.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TBrush) then\r\n  begin\r\n    FColor := (Source as TBrush).Color;\r\n    FStyle := (Source as TBrush).Style;\r\n  end;\r\nend;\r\n\r\nfunction FontSizeToPx(sz: Double): Double;\r\nbegin\r\n  Result := sz * 96 / 72;\r\nend;\r\n\r\nconstructor TBrush.Create;\r\nbegin\r\n  FColor := clWhite;\r\n  FStyle := bsSolid;\r\nend;\r\n\r\n{ TFont }\r\n\r\nprocedure TFont.Assign(Source: TPersistent); \r\nbegin\r\n  if (Source is TFont) then\r\n  begin\r\n    FName := (Source as TFont).Name;\r\n    FColor := (Source as TFont).Color;\r\n    FSize := (Source as TFont).Size;\r\n    FStyle := (Source as TFont).Style;\r\n  end;\r\nend;\r\n\r\nfunction TFont.ToString: string;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  if fsBold in FStyle then\r\n    s := 'Bold ';\r\n  if fsItalic in FStyle then\r\n    s := 'Italic ';\r\n\r\n  Result := s + FontSizeToHTML(FontSizeToPx(Size)) + ' ' + Name;\r\nend;\r\n\r\nprocedure TFont.SetName(const AName: string);\r\nbegin\r\n  if (FName <> AName) then\r\n  begin\r\n    FName := AName;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetSize(const ASize: Integer);\r\nbegin\r\n  if (FSize <> ASize) then\r\n  begin\r\n    FSize := ASize;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetColor(const AColor: TColor);\r\nbegin\r\n  if (FColor <> AColor) then\r\n  begin\r\n    FColor := AColor;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TFont.SetHeight(const Value: Integer);\r\nvar\r\n  d: double;\r\nbegin\r\n  FHeight := Value;\r\n  d := -FHeight * 72/96;\r\n  FSize := Round(d);\r\n  DoChange;\r\nend;\r\n\r\nprocedure TFont.SetStyle(const AStyle: TFontStyles);\r\nbegin\r\n  FStyle := AStyle;\r\n  DoChange;\r\nend;\r\n\r\nconstructor TFont.Create;\r\nbegin\r\n  inherited;\r\n  FName := 'Tahoma';\r\n  FSize := 8;\r\n  FStyle := [];\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TFont.DoChange;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{ TCanvas }\r\n\r\nprocedure TCanvas.AngleArc(X, Y, Radius: Double; StartAngle,\r\n  SweepAngle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    FContext.arc(X, Y, Radius, StartAngle, StartAngle + SweepAngle);\r\n    FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.ApplyFill;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.fillStyle := ColorToHtml(Brush.Color);\r\nend;\r\n\r\nprocedure TCanvas.ApplyStroke;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.lineWidth := Pen.Width;\r\n    FContext.strokeStyleAsColor := ColorToHtml(Pen.Color);\r\n    case Pen.Style of\r\n      psSolid: FContext.setlinedash([]);\r\n      psDot: FContext.setlinedash([1,2]);\r\n      psDash: FContext.setlinedash([8,2]);\r\n      psDashDot: FContext.setlinedash([6,2,2,2]);\r\n      psDashDotDot: FContext.setlinedash([6,2,2,2,2,2]);\r\n      psClear: FContext.setlinedash([0, $FFFF]);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.BeginScene;\r\nbegin\r\n  if Assigned(OnBeginScene) then\r\n    OnBeginScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.Clear;\r\nbegin\r\n  if Assigned(FContext) and Assigned(FElementCanvas) then\r\n    FContext.clearRect(0, 0, FElementCanvas.width, FElementCanvas.height);\r\nend;\r\n\r\nprocedure TCanvas.Clear(AColor: TColor);\r\nvar\r\n  c: TColor;\r\n  s: TBrushStyle;\r\nbegin\r\n  Clear;\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    c := Brush.Color;\r\n    s := Brush.Style;\r\n    Brush.Color := AColor;\r\n    Brush.Style := bsSolid;\r\n    FillRect(Rect(0, 0, FElementCanvas.width, FElementCanvas.height));\r\n    Brush.Color := c;\r\n    Brush.Style := s;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Clip;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.clip;\r\nend;\r\n\r\nconstructor TCanvas.Create;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  Create(FElementCanvas);\r\nend;\r\n\r\nconstructor TCanvas.Create(AControl: TJSHTMLCanvasElement);\r\nbegin\r\n  FElementCanvas := AControl;\r\n  FContext := AControl.getContextAs2DContext('2d');\r\n  FPen := TPen.Create;\r\n  FBrush := TBrush.Create;\r\n  FPathOpen := false;\r\n  FFont := TFont.Create;\r\nend;\r\n\r\nprocedure TCanvas.AngleArc(X, Y: Integer; Radius: Cardinal; StartAngle, SweepAngle: Double);\r\nbegin\r\n  AngleArc(Double(X), Double(Y), Double(Radius), Double(StartAngle), Double(SweepAngle));\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X,Y: Integer);\r\nbegin\r\n  MoveTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.LineTo(X,Y: Integer);\r\nbegin\r\n  LineTo(Double(X), Double(Y));\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TRect); \r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    FContext.rect(X1, Y1, X2 - X1, Y2 - Y1);\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Refresh;\r\nbegin\r\nend;\r\n\r\nprocedure TCanvas.Restore;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.restore();\r\nend;\r\n\r\nprocedure TCanvas.Rectangle(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Rectangle(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TRect);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1,Y1,X2,Y2,X3,Y3: Integer);\r\nbegin\r\n  RoundRect(Double(X1), Double(Y1), Double(X2), Double(Y2), Double(X3), Double(Y3));\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TRect; CX, CY: Integer);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(X1, Y1, X2, Y2, X3, Y3: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    FContext.moveTo(X1 + X3/2, Y1);\r\n    FContext.lineTo(X2 - X3/2, Y1);\r\n    FContext.quadraticCurveTo(X2,Y1, X2, Y1 + Y3/2);\r\n    FContext.lineTo(X2, Y2 - Y3/2);\r\n    FContext.quadraticCurveTo(X2, Y2, X2 - X3/2, Y2);\r\n    FContext.lineTo(X1 + X3/2, Y2);\r\n    FContext.quadraticCurveTo(X1, Y2, X1, Y2 - Y3/2);\r\n    FContext.lineTo(X1, Y1 + Y3/2);\r\n    FContext.quadraticCurveTo(X1, Y1, X1 + X3/2, Y1);\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Integer);\r\nbegin\r\n  Ellipse(Double(X1), Double(Y1), Double(X2), Double(Y2));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TRect); \r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TPoint);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextExtent(const Text: string): TCanvasSizeF;\r\nbegin\r\n  Result.cx := TextWidth(Text);\r\n  Result.cy := TextHeight(Text);\r\nend;\r\n\r\nfunction TCanvas.TextHeight(const Text: string): Double;\r\nbegin\r\n  Result := FontSizeToPx(Font.Size);\r\nend;\r\n\r\nprocedure TCanvas.MoveTo(X, Y: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FPathOpen := true;\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    FContext.moveTo(X,Y);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X, Y: Double; const Text: string);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Font.Color);\r\n    FContext.font := Font.ToString;\r\n    FContext.textBaseline := 'hanging';\r\n    FContext.fillText(Text, X, Y + 0.5);\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TCanvasRectF; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TCanvasRectF;\r\nvar\r\n  i: Integer;\r\n  s, sn, st: string;\r\n  l: Integer;\r\n  w, mw: Double;\r\n  f: Boolean;\r\n  p: Integer;\r\n  tw: Double;\r\n  th: Double;\r\n  lcnt: Integer;\r\n  rs: TCanvasRectF;\r\n  fws: Double;\r\n  ths: Double;\r\n  ww, wwx, fx: Boolean;\r\n\r\n  procedure DrawText(AText: string; AWidth, AHeight: Single);\r\n  begin\r\n    if ww then\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n        taLeftJustify: TextOut(ARect.Left, ARect.Top, AText);\r\n        taRightJustify: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      case AHorizontalAlignment of\r\n        taCenter:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left + (ARect.Right - ARect.Left - AWidth) / 2, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taLeftJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Left, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Left, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Left, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n        taRightJustify:\r\n        begin\r\n          case AVerticalAlignment of\r\n            taAlignTop: TextOut(ARect.Right - AWidth, ARect.Top, AText);\r\n            taVerticalCenter: TextOut(ARect.Right - AWidth, ARect.Top + (ARect.Bottom - ARect.Top - AHeight) / 2, AText);\r\n            taAlignBottom: TextOut(ARect.Right - AWidth, ARect.Bottom - AHeight, AText);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  function FindNextWord(Text: String; var APos: Integer): String;\r\n  var\r\n    l: Integer;\r\n    i: Integer;\r\n  begin\r\n    Result := '';\r\n\r\n    l := Length(Text);\r\n    if APos > l then\r\n      Exit;\r\n\r\n    i := APos;\r\n    while True do\r\n    begin\r\n      if ((Text[i] = #10) and (Text[i - 1] = #13)) or ((Text[i] = #13) and (Text[i - 1] = #10)) or (Text[i] = ' ') then\r\n      begin\r\n        if Text[i] = ' ' then\r\n          Result := Copy(Text, APos, i - (APos - 1))\r\n        else\r\n          Result := Copy(Text, APos, i - APos);\r\n\r\n        Break;\r\n      end\r\n      else if (Text[i] = #10) or (Text[i] = #13) or (Text[i] = ' ') then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else if i >= l then\r\n      begin\r\n        result := Copy(Text, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else\r\n        inc(i);\r\n    end;\r\n\r\n    APos := i + 1;\r\n  end;\r\nbegin\r\n  ww := WordWrap or (Pos(#13, Text) > 0) or (Pos(#10, Text) > 0);\r\n  wwx := not WordWrap and ((Pos(#13, Text) > 0) or (Pos(#10, Text) > 0));\r\n    \r\n  if not ww then\r\n  begin\r\n    w := TextWidth(Text);\r\n    th := TextHeight(Text);\r\n    if not Calculate then\r\n      DrawText(Text, w, th);\r\n\r\n    Result := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Left + w, ARect.Top + th);\r\n  end\r\n  else\r\n  begin\r\n    rs := ARect;\r\n\r\n    mw := 0;\r\n    i := 1;\r\n    ths := FFont.Size * 0.5;\r\n    lcnt := 0;\r\n    fws := 0;\r\n    tw := 0;\r\n    s := FindNextWord(Text, i);\r\n    w := TextWidth(s);\r\n    th := TextHeight(s) + ths;\r\n\r\n    mw := mw + w;\r\n    if (Length(s) > 0) and (s[Length(s)] = ' ') then\r\n      mw := mw + fws;\r\n\r\n    fx := False;\r\n    while i <= Length(Text) do\r\n    begin\r\n      l := Length(s);\r\n      if (l >= 2) and (((s[l] = #10) and (s[l - 1] = #13)) or ((s[l] = #13) and (s[l - 1] = #10))) then\r\n      begin\r\n        s := Copy(s, 1, l - 2);\r\n        f := True;\r\n      end\r\n      else if (l >= 1) and ((s[l] = #10) or (s[l] = #13)) then\r\n      begin\r\n        s := Copy(s, 1, l - 1);\r\n        f := True;\r\n      end\r\n      else\r\n        f := False;\r\n\r\n      sn := FindNextWord(Text, i);\r\n      w := TextWidth(sn);\r\n      th := Max(th, TextHeight(sn) + ths);\r\n\r\n      if (ARect.Left + mw + w > ARect.Right) or f then\r\n      begin\r\n        if (s <> '') and not fx then\r\n        begin\r\n          p := Length(s);\r\n\r\n          st := Copy(s, 1, p);\r\n\r\n          Inc(lcnt);\r\n          if mw > tw then\r\n            tw := mw;\r\n\r\n          if not Calculate then\r\n            DrawText(st, mw, th);\r\n\r\n          mw := 0;\r\n        end;\r\n\r\n        s := '';\r\n\r\n        fx := False;\r\n        if (wwx and f) or not wwx then\r\n          ARect.Top := ARect.Top + th\r\n        else if (wwx and not f) then\r\n          fx := True;\r\n\r\n        if (Trunc(ARect.Top) > Trunc(ARect.Bottom - th)) and not Calculate then\r\n          Break;\r\n      end;\r\n\r\n      mw := mw + w;\r\n      if (Length(sn) > 0) and (sn[Length(sn)] = ' ') then\r\n        mw := mw + fws;\r\n      s := s + sn;\r\n    end;\r\n\r\n    if s <> '' then\r\n    begin\r\n      p := Length(s);\r\n      st := Copy(s, 1, p);\r\n      Inc(lcnt);\r\n      if mw > tw then\r\n        tw := mw;\r\n\r\n      if not Calculate then\r\n        DrawText(st, mw, th);\r\n    end;\r\n\r\n    Result := CreateCanvasRectF(rs.Left, rs.Top, rs.Left + tw, rs.Top + lcnt * th);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.TextOut(X,Y: Integer; const Text: string);\r\nbegin\r\n  TextOut(Double(X), Double(Y), Text);\r\nend;\r\n\r\nfunction TCanvas.TextRect(ARect: TRect; const Text: String; const WordWrap: Boolean = False; const Calculate: Boolean = False; const AHorizontalAlignment: TAlignment = taLeftJustify; const AVerticalAlignment: TVerticalAlignment = taAlignTop): TRect;\r\nvar\r\n  r: TCanvasRectF;\r\nbegin\r\n  r := TextRect(CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom), Text, WordWrap, Calculate, AHorizontalAlignment, AVerticalAlignment);\r\n  Result := Rect(Round(r.Left), Round(r.Top), Round(r.Right), Round(r.Bottom));\r\nend;\r\n\r\nfunction TCanvas.TextWidth(const Text: string): Double;\r\nvar\r\n  f: string;\r\n  tm: TJSTextMetrics;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    f := Font.ToString;\r\n    FContext.font := f;\r\n    tm := FContext.measureText(Text);\r\n    Result := tm.width;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Transform(m11, m12, m21, m22, dx, dy: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.transform(m11, m12, m21, m22, dx, dy);\r\nend;\r\n\r\nprocedure TCanvas.Translate(X, Y: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.translate(X, Y);\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Integer; Graphic: TGraphic);\r\nbegin\r\n  Draw(Double(X), Double(Y), Graphic);\r\nend;\r\n\r\ndestructor TCanvas.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCanvas.Draw(X, Y: Double; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n    FContext.drawImage(img, X, Y);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TCanvasRectF);\r\nvar\r\n  ps: TPenStyle;\r\nbegin\r\n  ps := Pen.Style;\r\n  Pen.Style := psDot;\r\n  Pen.Width := 1;\r\n  Pen.Color := clBlack;\r\n\r\n  MoveTo(Rect.Left, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Top);\r\n  LineTo(Rect.Right, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Bottom);\r\n  LineTo(Rect.Left, Rect.Top);\r\n\r\n  Pen.Style := ps;\r\nend;\r\n\r\nprocedure TCanvas.DrawFocusRect(const Rect: TRect);\r\nbegin\r\n  DrawFocusRect(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom));\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(X1, Y1, X2, Y2: Double);\r\nvar\r\n  w, h: Double;\r\n  kappa: Double;\r\n  ox, oy, xe, ye, xm, ym: Double;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    w := x2 - x1;\r\n    h := y2 - y1;\r\n\r\n    kappa := 0.5522848;\r\n\r\n    ox := (w / 2) * kappa;\r\n    oy := (h / 2) * kappa;\r\n    xe := x1 + w;\r\n    ye := y1 + h;\r\n    xm := x1 + w / 2;\r\n    ym := y1 + h / 2;\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    FContext.moveTo(x1, ym);\r\n    FContext.bezierCurveTo(x1, ym - oy, xm - ox, y1, xm, y1);\r\n    FContext.bezierCurveTo(xm + ox, y1, xe, ym - oy, xe, ym);\r\n    FContext.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);\r\n    FContext.bezierCurveTo(xm - ox, ye, x1, ym + oy, x1, ym);\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nfunction TCanvas.GetPixel(X,Y: Integer): TColor;\r\nvar\r\n  imgd: TJSImageData;\r\nbegin\r\n  Result := clNone;\r\n  if Assigned(FContext) then\r\n  begin\r\n    imgd := FContext.getImageData(x, y, 1, 1);\r\n    Result := RGB(imgd.data[0], imgd.data[1], imgd.data[2]);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.LineTo(X, Y: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    if not FPathOpen then\r\n    begin\r\n      FContext.beginPath();\r\n      ApplyStroke;\r\n      FContext.moveTo(FPathX, FPathY);\r\n    end;\r\n\r\n    FContext.lineTo(X,Y);\r\n    FContext.stroke();\r\n    FPathX := X;\r\n    FPathY := Y;\r\n\r\n    FPathOpen := false;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Save;\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.save();\r\nend;\r\n\r\nprocedure TCanvas.SetClipRect(const Value: TCanvasRectF);\r\nbegin\r\n  FClipRect := Value;\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.beginPath;\r\n    FContext.rect(FClipRect.Left, FClipRect.Top, FClipRect.Right - FClipRect.Left, FClipRect.Bottom - FClipRect.Top);\r\n    FContext.clip;\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetPixel(X,Y: Integer; Clr: TColor);\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    FContext.fillStyle := ColorToHtml(Clr);;\r\n    FContext.fillRect(x,y, 1+0.5, 1+0.5);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.SetTransform(m11, m12, m21, m22, dx, dy: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.setTransform(m11, m12, m21, m22, dx, dy);\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TCanvasRectF; Graphic: TGraphic);\r\nvar\r\n  img: TJSObject;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    img := Graphic.Image;\r\n    FContext.drawImage(img, 0, 0, Graphic.width, Graphic.height, Rect.Left, Rect.Top, Rect.Right - Rect.Left, Rect.Bottom - Rect.Top);\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.StretchDraw(Rect: TRect; Graphic: TGraphic);\r\nbegin\r\n  StretchDraw(CreateCanvasRectF(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom), Graphic);\r\nend;\r\n\r\nprocedure TCanvas.Polygon(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    ApplyFill;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    FContext.closePath();\r\n\r\n    if Brush.Style <> bsClear then\r\n      FContext.fill();\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Polyline(const Points: array of TCanvasPointF);\r\nvar\r\n  l, i: Integer;\r\nbegin\r\n  if Assigned(FContext) then\r\n  begin\r\n    l := Length(Points);\r\n\r\n    FContext.beginPath();\r\n    ApplyStroke;\r\n    i := 0;\r\n    FContext.moveTo(Points[i].X, Points[i].Y);\r\n\r\n    while (i < l - 1) do\r\n    begin\r\n      inc(i);\r\n      FContext.lineTo(Points[i].X, Points[i].Y);\r\n    end;\r\n\r\n    if Pen.Style <> psClear then\r\n      FContext.stroke();\r\n  end;\r\nend;\r\n\r\nprocedure TCanvas.Ellipse(const Rect: TCanvasRectF);\r\nbegin\r\n  Ellipse(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.EndScene;\r\nbegin\r\n  if Assigned(OnEndScene) then\r\n    OnEndScene(Self);\r\nend;\r\n\r\nprocedure TCanvas.FillRect(const Rect: TCanvasRectF);\r\nbegin\r\n  Rectangle(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom);\r\nend;\r\n\r\nprocedure TCanvas.Rotate(Angle: Double);\r\nbegin\r\n  if Assigned(FContext) then\r\n    FContext.rotate(Angle);\r\nend;\r\n\r\nprocedure TCanvas.RoundRect(const Rect: TCanvasRectF; CX, CY: Double);\r\nbegin\r\n  RoundRect(Rect.Left, Rect.Top, Rect.Right, Rect.Bottom, CX, CY);\r\nend;\r\n\r\n{ TGraphic }\r\n\r\nconstructor TGraphic.Create(Img: TJSObject);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  FURL := '';\r\n  FImage := Img;\r\nend;\r\n\r\nprocedure TGraphic.AssignEvents;\r\nbegin\r\n  asm\r\n    var me = this;\r\n    this.FImage.onload = function() {\r\n       me.DoChange();\r\n      };\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.CaptureCanvas;\r\nbegin\r\n  if Assigned(FCanvas) and Assigned(FCanvas.Element) then\r\n    LoadFromResource(FCanvas.Element.toDataURL());\r\nend;\r\n\r\nconstructor TGraphic.Create;\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  CreateImage;\r\n  AssignEvents;\r\nend;\r\n\r\nconstructor TGraphic.Create(URL: string);\r\nbegin\r\n  FAddToQueue := True;\r\n  FEmpty := True;\r\n  FData := '';\r\n  Create;\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.Assign(Source: TGraphic);\r\nvar\r\n  s: string;\r\nbegin\r\n  if Assigned(Source) and Assigned(Source.FCanvas) then\r\n    LoadFromCanvas(Source.FCanvas)\r\n  else if Assigned(Source) and Assigned(Source.FImage) and not Source.Empty then\r\n  begin\r\n    asm\r\n      s = Source.FImage.src;\r\n    end;\r\n\r\n    LoadFromURL(s);\r\n  end;\r\nend;\r\n\r\nfunction TGraphic.Image: TJSObject;\r\nbegin\r\n  Result := FImage;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCache(AData: String);\r\nvar\r\n  dt: string;\r\n  o: TJSObject;\r\n  b: Boolean;\r\n  s: string;\r\n  l: Boolean;\r\nbegin\r\n  FData := AData;\r\n  dt := AData;\r\n  if (dt <> '') and not FCache.Find(dt, o) then\r\n  begin\r\n    b := False;\r\n    s := '';\r\n    asm\r\n      s = this.FImage.src;\r\n      b = (s != '');\r\n    end;\r\n\r\n    l := b and (dt <> s);\r\n    if l then\r\n    begin\r\n      CreateImage;\r\n      AssignEvents;\r\n    end;\r\n\r\n    if (not l and (FQueue.IndexOf(dt) = -1)) or l then\r\n    begin\r\n      asm\r\n        this.FImage.src = dt;\r\n      end;\r\n\r\n      Inc(FCacheCount);\r\n      if FAddToQueue then\r\n        FQueue.Add(dt);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    FImage := o;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromCanvas(ACanvas: TCanvas);\r\nbegin\r\n  if Assigned(ACanvas) and Assigned(ACanvas.Element) then\r\n    LoadFromResource(ACanvas.Element.toDataURL());\r\nend;\r\n\r\nprocedure TGraphic.LoadFromFile(AFileName: string);\r\nbegin\r\n  LoadFromURL(AFileName);\r\nend;\r\n\r\nfunction TGraphic.GetBase64Image: string;\r\nbegin\r\n  Result := '';\r\n  if Assigned(FCanvas) and Assigned(FCanvas.Element) then\r\n    Result := FCanvas.Element.toDataURL();\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string; AHInstance: Integer);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AResource);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromResource(AResource: string);\r\nbegin\r\n  LoadFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromStream(AStream: TStream);\r\nbegin\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string; AHInstance: Integer);\r\nbegin\r\n  FEmpty := True;\r\n  LoadFromCache(AURL);\r\nend;\r\n\r\nprocedure TGraphic.LoadFromURL(AURL: string);\r\nbegin\r\n  LoadFromURL(AURL, 0);\r\nend;\r\n\r\nprocedure TGraphic.RecreateCanvas;\r\nbegin\r\n  if not Assigned(FCanvasElement) then\r\n    FCanvasElement := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n\r\n  if Assigned(FCanvasElement) then\r\n  begin\r\n    FCanvasElement.height := Height;\r\n    FCanvasElement.width := Width;\r\n    if not Assigned(FCanvas) then\r\n    begin\r\n      FCanvas := TCanvas.Create(FCanvasElement);\r\n      FCanvas.OnBeginScene := DoBeginScene;\r\n      FCanvas.OnEndScene := DoEndScene;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromResource(AResource);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String): TGraphic;\r\nbegin\r\n  Result := CreateFromURL(AURL, 0);\r\nend;\r\n\r\nclass function TGraphic.CreateFromURL(AURL: String;\r\n  AInstance: NativeUInt): TGraphic;\r\nbegin\r\n  Result := TGraphic.Create;\r\n  Result.LoadFromURL(AURL);\r\nend;\r\n\r\nclass function TGraphic.CreateFromResource(AResource: string): TGraphic;\r\nbegin\r\n  Result := CreateFromResource(AResource, 0);\r\nend;\r\n\r\nprocedure TGraphic.CreateImage;\r\nbegin\r\n  asm\r\n    this.FImage = new Image();\r\n  end;\r\nend;\r\n\r\nprocedure TGraphic.DoBeginScene(Sender: TObject);\r\nbegin\r\n  FCanvas.Clear;\r\nend;\r\n\r\nprocedure TGraphic.DoChange;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  FEmpty := (Width = 0) and (Height = 0);\r\n  if not FEmpty and (FData <> '') and not FCache.Exists(FData) then\r\n  begin\r\n    FCache.Add(TGraphicCache.Create(FImage, FData));\r\n    i := FQueue.IndexOf(FData);\r\n    if (i >= 0) and (i <= FQueue.Count - 1) then\r\n      FQueue.Delete(i);\r\n\r\n    Dec(FCacheCount);\r\n    if FCacheCount = 0 then\r\n    begin\r\n      if Assigned(Application.OnImageCacheReady) then\r\n        Application.OnImageCacheReady(Application);\r\n    end;\r\n  end;\r\n\r\n  if Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\nprocedure TGraphic.DoEndScene(Sender: TObject);\r\nbegin\r\n  FAddToQueue := False;\r\n  CaptureCanvas;\r\n  FAddToQueue := True;\r\nend;\r\n\r\nfunction TGraphic.Empty: Boolean;\r\nbegin\r\n  Result := FEmpty;\r\nend;\r\n\r\nprocedure TGraphic.SetHeight(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.height = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nprocedure TGraphic.SetSize(AWidth, AHeight: Integer);\r\nbegin\r\n  Width := AWidth;\r\n  Height := AHeight;\r\nend;\r\n\r\nprocedure TGraphic.SetURL(const URL: string);\r\nbegin\r\n  LoadFromURL(URL);\r\nend;\r\n\r\nprocedure TGraphic.SetWidth(const Value: Integer);\r\nbegin\r\n  asm\r\n    this.FImage.width = Value;\r\n  end;\r\n  RecreateCanvas;\r\n  DoChange;\r\nend;\r\n\r\nfunction TGraphic.GetWidth: Integer;\r\nvar\r\n  w: integer;\r\nbegin\r\n  asm\r\n    w = this.FImage.width;\r\n  end;\r\n  Result := w;\r\nend;\r\n\r\nfunction TGraphic.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n    RecreateCanvas;\r\n\r\n  Result := FCanvas;\r\nend;\r\n\r\nfunction TGraphic.GetHeight: Integer;\r\nvar\r\n  h: integer;\r\nbegin\r\n  asm\r\n    h = this.FImage.height;\r\n  end;\r\n  Result := h;\r\nend;\r\n\r\n{ TGraphicCache }\r\n\r\nconstructor TGraphicCache.Create(AImage: TJSObject; AID: string);\r\nbegin\r\n  FImage := AImage;\r\n  FID := AID;\r\nend;\r\n\r\n{ TGraphicCacheList }\r\n\r\nfunction TGraphicCacheList.Exists(AID: string): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TGraphicCacheList.Find(AID: string; var FImage: TJSObject): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TGraphicCache;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I] as TGraphicCache;\r\n    if (it.ID = AID) and Assigned(it.Image) then\r\n    begin\r\n      FImage := it.Image;\r\n      Result := True;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\ninitialization\r\nbegin\r\n  FCache := TGraphicCacheList.Create;\r\n  FQueue := TStringList.Create;\r\nend;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.StdCtrls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, SysUtils, Web, WEBLib.Graphics, Types;\r\n\r\ntype\r\n  Single = Double;\r\n  TEditCharCase = (wecLowerCase, wecNormal, wecMixedCase, wecUpperCase);\r\n  TCheckBoxState = (cbChecked, cbGrayed, cbUnchecked);\r\n  TDateTimeKind = (dtkDate, dtkTime);\r\n  TEllipsisPosition = (epEndEllipsis, epNone);\r\n  TTextLayout = (tlTop, tlCenter, tlBottom);\r\n  TSysLinkType = (sltID, sltURL);\r\n\r\n  TLinkClickEvent = procedure(Sender: TObject; Link: string; LinkType: TSysLinkType) of object;\r\n\r\n  TCustomLabel = class(TCustomControl)\r\n  private\r\n    FContent: TJSElement;\r\n    FAutoSize: boolean;\r\n    FCaption: string;\r\n    FEllipsisPosition: TEllipsisPosition;\r\n    FWordWrap: Boolean;\r\n    FAlignment: TAlignment;\r\n    FLayout: TTextLayout;\r\n    FTransparent: boolean;\r\n    procedure SetLayout(const Value: TTextLayout);\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    function GetContentHandle: TJSHTMLElement;\r\n  protected\r\n    function GetOuterWidth: integer; override;\r\n    function GetOuterHeight: integer; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetDisplayText: string; virtual;\r\n    function CanShowFocus: boolean; override;\r\n    procedure BindElement; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure SetAutoSize(AValue: boolean);\r\n    procedure SetCaption(AValue: string); virtual;\r\n    procedure SetEllipsisPosition(AValue: TEllipsisPosition);\r\n    property ContentHandle: TJSHTMLElement read GetContentHandle;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment;\r\n    property AutoSize: boolean read FAutoSize write SetAutoSize;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property EllipsisPosition: TEllipsisPosition read FEllipsisPosition write SetEllipsisPosition;\r\n    property Layout: TTextLayout read FLayout write SetLayout;\r\n    property Transparent: boolean read FTransparent write FTransparent;\r\n    property WordWrap: Boolean read FWordWrap write FWordWrap;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TLabel = class(TCustomLabel)\r\n  published\r\n    property Align;\r\n    property Alignment;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property Caption;\r\n    property Color;\r\n    property EllipsisPosition;\r\n    property Enabled;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Layout;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property Top;\r\n    property Transparent;\r\n    property Visible;\r\n    property Width;\r\n    property WordWrap;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TWebLabel = class(TLabel);\r\n\r\n  TCustomInput = class(TCustomControl)\r\n  private\r\n  protected\r\n    function GetInputType: string; virtual;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementVisual; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TCustomEdit = class(TCustomInput)\r\n  private\r\n    FCharCase: TEditCharCase;\r\n    FMaxLength: integer;\r\n    FReadOnly: Boolean;\r\n    FText: string;\r\n    FTextHint: string;\r\n    FSelStart: Integer;\r\n    FAlignment: TAlignment;\r\n    FHideSelection: Boolean;\r\n    FPasswordChar: Char;\r\n    FOnChange: TNotifyEvent;\r\n    FAutoSize: Boolean;\r\n    FAutoSelect: Boolean;\r\n    FSelLength: Integer;\r\n    FNumeric: Boolean;\r\n    procedure SetAlignment(const Value: TAlignment);\r\n    procedure SetHideSelection(const Value: Boolean);\r\n    procedure SetAutoSelect(const Value: Boolean);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetPasswordChar(const Value: Char);\r\n    procedure SetNumeric(const Value: Boolean);\r\n  protected\r\n    function GetInputType: string; override;\r\n    procedure PersistinHTML; override;\r\n    procedure DisableTab; override;\r\n    function GetText: string;\r\n    function GetDisplayText: string; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function IsReadOnly: boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure SetCharCase(AValue: TEditCharCase); virtual;\r\n    procedure SetMaxLength(AValue: integer);\r\n    procedure SetReadOnly(AValue: boolean);\r\n    procedure SetText(AValue: string);\r\n    procedure SetTextHint(AValue: string);\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property HideSelection: Boolean read FHideSelection write SetHideSelection;\r\n    property CharCase: TEditCharCase read FCharCase write SetCharCase;\r\n    property MaxLength: integer read FMaxLength write SetMaxLength;\r\n    property Numeric: Boolean read FNumeric write SetNumeric;\r\n    property PasswordChar: Char read FPasswordChar write SetPasswordChar;\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly;\r\n    property Text: string read GetText write SetText;\r\n    property TextHint: string read FTextHint write SetTextHint;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize;\r\n    property AutoSelect: Boolean read FAutoSelect write SetAutoSelect;\r\n    property Alignment: TAlignment read FAlignment write SetAlignment;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property SelStart: Integer read FSelStart write SetSelStart;\r\n    property SelLength: Integer read FSelLength write SetSelLength;\r\n    procedure Clear;\r\n    procedure ClearSelection;\r\n    procedure Change; virtual;\r\n    procedure SelectAll;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  end;\r\n\r\n  TEdit = class(TCustomEdit)\r\n  published\r\n    property Alignment;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property AutoSelect;\r\n    property BorderStyle;\r\n    property CharCase;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property HideSelection;\r\n    property Left;\r\n    property PasswordChar;\r\n    property Margins;\r\n    property MaxLength;\r\n    property ReadOnly;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property TextHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebEdit = class(TEdit);\r\n\r\n  TSpinEdit = class(TCustomInput)\r\n  private\r\n    FIncrement: integer;\r\n    FMaxValue: integer;\r\n    FMinValue: integer;\r\n    FValue: integer;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n  protected\r\n    procedure PersistinHTML; override;\r\n    procedure DisableTab; override;\r\n    function GetInputType: string; override;\r\n    procedure UpdateElementData; override;\r\n    function GetValue: integer;\r\n    procedure SetIncrement(AValue: integer);\r\n    procedure SetMaxValue(AValue: integer);\r\n    procedure SetMinValue(AValue: integer);\r\n    procedure SetValue(AValue: integer);\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function IsReadOnly: boolean; virtual;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property Text: string read GetText write SetText;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize: Boolean read FAutoSize write FAutoSize;\r\n    property BorderStyle;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Increment: integer read FIncrement write SetIncrement;\r\n    property Left;\r\n    property Margins;\r\n    property MaxValue: integer read FMaxValue write SetMaxValue;\r\n    property MinValue: integer read FMinValue write SetMinValue;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property Value: integer read GetValue write SetValue;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebSpinEdit = class(TSpinEdit);\r\n\r\n  TDateTimePicker = class(TCustomInput)\r\n  private\r\n    FDate: TDateTime;\r\n    FKind: TDateTimeKind;\r\n    FTime: TDateTime;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetDate(AValue: TDateTime);\r\n    function GetDate: TDateTime;\r\n    procedure SetTime(AValue: TDateTime);\r\n    function GetTime: TDateTime;\r\n    procedure SetKind(AValue: TDateTimeKind);\r\n    procedure SetText(const Value: String);\r\n    function GetText: String;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetInputType: string; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property Color;\r\n    property Date: TDateTime read GetDate write SetDate;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Kind: TDateTimeKind read FKind write SetKind;\r\n    property Left;\r\n    property Margins;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabStop;\r\n    property TabOrder;\r\n    property Text: String read GetText write SetText;\r\n    property Time: TDateTime read GetTime write SetTime;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebDateTimePicker = class(TDateTimePicker);\r\n\r\n  TButton = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetCaption(AValue: string);\r\n    procedure DisableTab; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebButton = class(TButton);\r\n\r\n  TCheckBox = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n    FChecked: boolean;\r\n    FState: TCheckBoxState;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementSize; override;\r\n    procedure PersistinHTML; override;\r\n    procedure DisableTab; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetState(AValue: TCheckBoxState);\r\n    function GetState: TCheckBoxState;\r\n    procedure SetCaption(AValue: string);\r\n    procedure SetEnabled(Value: boolean); override;\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure Click; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Checked: boolean read GetChecked write SetChecked;\r\n    property Color;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property State: TCheckBoxState read GetState write SetState;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebCheckBox = class(TCheckBox);\r\n\r\n  TRadioButton = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n    FChecked: boolean;\r\n    FGroupName: string;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure PersistInHTML; override;\r\n    procedure DisableTab; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetChecked(AValue: boolean);\r\n    function GetChecked: boolean;\r\n    procedure SetEnabled(Value: boolean); override;\r\n    procedure SetCaption(AValue: string);\r\n    procedure SetGroupName(AValue: string);\r\n    function HandleLabelClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure UpdateElementSize; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Checked: boolean read GetChecked write SetChecked;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property GroupName: string read FGroupName write SetGroupName;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebRadioButton = class(TRadioButton);\r\n\r\n  TListBox = class(TCustomControl)\r\n  private\r\n    FItems: TStringList;\r\n    FItemIndex: integer;\r\n    FMultiSelect: boolean;\r\n    FSelected: TList;\r\n    FItemHeight: Integer;\r\n    FSorted: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetItemHeight(const Value: Integer);\r\n    procedure SetSorted(const Value: Boolean);\r\n    function GetCount: Integer;\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n    function GetSelCount: integer;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoUpdateList; virtual;\r\n    procedure PersistinHTML; override;\r\n    procedure DisableTab; override;\r\n    function GetItemIndex: integer;\r\n    function CreateElement: TJSElement; override;\r\n    function GetSelected(AIndex: integer): boolean;\r\n    procedure SetSelected(AIndex: Integer; AValue: boolean);\r\n    procedure SetItems(AItems: TStringList);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure SetMultiSelect(AValue: boolean);\r\n    procedure Loaded; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure BindEvents; override;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure ClearSelection;\r\n    procedure SelectAll;\r\n    property Sorted: Boolean read FSorted write SetSorted;\r\n    property Count: Integer read GetCount;\r\n    property SelCount: integer read GetSelCount;\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property BorderStyle;\r\n    property Color;\r\n    property Font;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property Hint;\r\n    property ItemHeight: Integer read FItemHeight write SetItemHeight;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property Left;\r\n    property MultiSelect: boolean read FMultiSelect write SetMultiSelect;\r\n    property Selected[i: Integer]: boolean read GetSelected write SetSelected;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebListBox = class(TListBox);\r\n\r\n  TComboBoxStyle = (csDropDown, csSimple, csDropDownList, csOwnerDrawFixed,\r\n    csOwnerDrawVariable);\r\n\r\n  TCustomComboBox = class(TCustomControl)\r\n  private\r\n    FItems: TStringList;\r\n    FItemIndex: integer;\r\n    FStyle: TComboBoxStyle;\r\n    FDroppedDown: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    function GetText: string;\r\n    procedure SetText(const Value: string);\r\n    procedure SetStyle(const Value: TComboBoxStyle);\r\n    procedure SetDroppedDown(const Value: Boolean);\r\n    function GetElementSelectHandle: TJSHTMLSelectElement;\r\n  protected\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    procedure DoItemsChange(Sender: TObject);\r\n    procedure DoUpdateList; virtual;\r\n    function GetItemIndex: integer;\r\n    function CreateElement: TJSElement; override;\r\n    procedure DisableTab; override;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure SetItems(AItems: TStringList);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure Loaded; override;\r\n    procedure Change; virtual;\r\n    procedure PersistinHTML; override;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text: string read GetText write SetText;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    procedure Clear;\r\n    procedure AddItem(Item: string; AObject: TObject);\r\n    property ElementSelectHandle: TJSHTMLSelectElement read GetElementSelectHandle;\r\n    property Style: TComboBoxStyle read FStyle write SetStyle;\r\n    property DroppedDown: Boolean read FDroppedDown write SetDroppedDown;\r\n  end;\r\n\r\n  TComboBox = class(TCustomComboBox)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Items;\r\n    property Left;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebComboBox = class(TComboBox);\r\n\r\n  TFontPicker = class(TCustomComboBox)\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebFontPicker = class(TFontPicker);\r\n\r\n  TFontSizePickerMode = (fmPointSize, fmRelativeSize);\r\n\r\n  TFontSizePicker = class(TCustomComboBox)\r\n  private\r\n    FPickerMode: TFontSizePickerMode;\r\n    procedure SetPickerMode(const AValue: TFontSizePickerMode);\r\n  protected\r\n    procedure Init; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property Items;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property ItemIndex;\r\n    property Left;\r\n    property PickerMode: TFontSizePickerMode read FPickerMode write SetPickerMode;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebFontSizePicker = class(TFontSizePicker);\r\n\r\n\r\n  TCaretPosition = TPoint;\r\n\r\n  TCustomMemo = class(TCustomControl)\r\n  private\r\n    FWordWrap: Boolean;\r\n    FBlockChange: Boolean;\r\n    FLines: TStringList;\r\n    FSelStart: Integer;\r\n    FSelLength: Integer;\r\n    FCaretPosition: TCaretPosition;\r\n    FAutoSize: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    FReadOnly: boolean;\r\n    function GetText: String;\r\n    procedure SetText(const Value: String);\r\n    procedure SetSelLength(const Value: Integer);\r\n    procedure SetSelStart(const Value: Integer);\r\n    procedure SetAutoSize(const Value: Boolean);\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    procedure SetReadOnly(const Value: boolean);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function DoHandleInput(Event: TEventListenerEvent): Boolean; virtual;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean; virtual;\r\n    function IsReadOnly: boolean; virtual;\r\n    procedure PersistinHTML; override;\r\n    function GetDisplayText: string; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure SetLines(ALines: TStringList);\r\n    procedure DoLinesChange(Sender: TObject);\r\n    property Text: String read GetText write SetText;\r\n    property Font;\r\n    property Color;\r\n    property BorderStyle;\r\n    property AutoSize: Boolean read FAutoSize write SetAutoSize;\r\n    property Lines: TStringList read FLines write SetLines;\r\n    property ReadOnly: boolean read FReadOnly write SetReadOnly;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    procedure Change; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    property CaretPosition: TCaretPosition read FCaretPosition write FCaretPosition;\r\n    property SelStart: Integer read FSelStart write SetSelStart;\r\n    property SelLength: Integer read FSelLength write SetSelLength;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n    property WordWrap: Boolean read FWordWrap write FWordWrap;\r\n  end;\r\n\r\n  TMemo = class(TCustomMemo)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property BorderStyle;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property Lines;\r\n    property ReadOnly;\r\n    property SelStart;\r\n    property SelLength;\r\n    property ShowFocus;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Text;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseLeave;\r\n    property OnMouseEnter;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TWebMemo = class(TMemo);\r\n\r\n  TRadioGroup = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n    FColumns: integer;\r\n    FItems: TStringList;\r\n    FItemIndex: integer;\r\n    FOldItemIndex: integer;\r\n    FOnChange: TNotifyEvent;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    function GetItemIndex: integer;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure DoRadioClick(Sender: TObject);\r\n    procedure SetCaption(AValue: string);\r\n    procedure SetColumns(AValue: integer);\r\n    procedure SetItems(AItems: TStringList);\r\n    procedure SetItemIndex(AIndex: integer);\r\n    procedure DoUpdateList; virtual;\r\n    procedure Change; virtual;\r\n    procedure Loaded; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Columns: integer read FColumns write SetColumns;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property ItemIndex: integer read GetItemIndex write SetItemIndex;\r\n    property Visible;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebRadioGroup = class(TRadioGroup);\r\n\r\n  TProgressBar = class(TCustomControl)\r\n  private\r\n    FMax: integer;\r\n    FMin: integer;\r\n    FPosition: integer;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetMax(AValue: integer);\r\n    procedure SetMin(AValue: integer);\r\n    procedure SetPosition(AValue: integer);\r\n    procedure DoUpdate; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Height;\r\n    property Left;\r\n    property Max: integer read FMax write SetMax;\r\n    property Min: integer read FMin write SetMin;\r\n    property Position: integer read FPosition write SetPosition;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n  end;\r\n\r\n  TWebProgressBar = class(TProgressBar);\r\n\r\n  TColorPicker = class(TCustomInput)\r\n  private\r\n    FColor: TColor;\r\n    FOnSelect: TNotifyEvent;\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n  protected\r\n    procedure UpdateElementVisual; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    function GetInputType: string; override;\r\n    function GetColor: TColor;\r\n    procedure SetColor(AValue: TColor); reintroduce;\r\n    procedure BindEvents; override;\r\n    procedure Select; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  published\r\n    property Color: TColor read GetColor write SetColor;\r\n    property Enabled;\r\n    property Height;\r\n    property Left;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnSelect: TNotifyEvent read FOnSelect write FOnSelect;\r\n  end;\r\n\r\n  TWebColorPicker = class(TColorPicker);\r\n\r\n  TScrollBarContent = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TScrollBarKind = (sbHorizontal, sbVertical);\r\n  TScrollBarInc = Integer;\r\n\r\n  TScrollBar = class(TCustomControl)\r\n  private\r\n    FScrolling: Boolean;\r\n    FContent: TScrollBarContent;\r\n    FKind: TScrollBarKind;\r\n    FPosition: Integer;\r\n    FSmallChange: TScrollBarInc;\r\n    FMax: Integer;\r\n    FMin: Integer;\r\n    FLargeChange: TScrollBarInc;\r\n    FPageSize: Integer;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetKind(const Value: TScrollBarKind);\r\n    procedure SetPosition(const Value: Integer);\r\n    procedure SetMax(const Value: Integer);\r\n    procedure SetMin(const Value: Integer);\r\n    procedure SetPageSize(const Value: Integer);\r\n    function GetPosition: Integer;\r\n    function GetPageSize: Integer;\r\n  protected\r\n    function GetValue(XYPos: Double): Double;\r\n    function CreateElement: TJSElement; override;\r\n    function DoScroll(Event: TJSUIEvent): Boolean; virtual;\r\n    procedure BindEvents; override;\r\n    procedure UpdateElementVisual; override;\r\n    procedure UpdateContent; virtual;\r\n    procedure Loaded; override;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Height;\r\n    property Kind: TScrollBarKind read FKind write SetKind;\r\n    property Position: Integer read GetPosition write SetPosition;\r\n    property Left;\r\n    property SmallChange: TScrollBarInc read FSmallChange write FSmallChange;\r\n    property LargeChange: TScrollBarInc read FLargeChange write FLargeChange;\r\n    property Max: Integer read FMax write SetMax;\r\n    property Min: Integer read FMin write SetMin;\r\n    property PageSize: Integer read GetPageSize write SetPageSize;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebScrollBar = class(TScrollBar);\r\n\r\nimplementation\r\n\r\n{ TCustomLabel }\r\n\r\nprocedure TCustomLabel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoSize := true;\r\n  FLayout := tlTop;\r\n  FCaption := '';\r\n  FEllipsisPosition := epNone;\r\n  FTransparent := True;\r\n  Color := clWhite;\r\n  FAlignment := taLeftJustify;\r\n  TabStop := false;\r\nend;\r\n\r\nfunction TCustomLabel.CanShowFocus: boolean;\r\nbegin\r\n  Result := false;\r\nend;\r\n\r\nfunction TCustomLabel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\n  FContent := document.createElement('SPAN');\r\n  Result.appendChild(FContent);\r\nend;\r\n\r\nprocedure TCustomLabel.BindElement;\r\nbegin\r\n  FContent := Container.firstElementChild;\r\nend;\r\n\r\nfunction TCustomLabel.GetContentHandle: TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(FContent);\r\nend;\r\n\r\nfunction TCustomLabel.GetDisplayText: string;\r\nbegin\r\n  Result := Caption;\r\nend;\r\n\r\nfunction TCustomLabel.GetOuterHeight: integer;\r\nbegin\r\n  Result := Height;\r\n  if AutoSize then  // take 1px inner border in account\r\n    Result := Result + 4;\r\nend;\r\n\r\nfunction TCustomLabel.GetOuterWidth: integer;\r\nbegin\r\n  Result := Width;\r\n//  if AutoSize then  // take 1px inner border in account\r\n    Result := Result + 4;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAutoSize(AValue: boolean);\r\nbegin\r\n  if FAutoSize <> AValue then\r\n  begin\r\n    FAutoSize := AValue;\r\n    if FAutoSize then\r\n    begin\r\n      Width := -1;\r\n      Height := -1;\r\n      FEllipsisPosition := epNone;\r\n    end;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetCaption(AValue: string);\r\nbegin\r\n  if FCaption <> AValue then\r\n  begin\r\n    FCaption := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetEllipsisPosition(AValue: TEllipsisPosition);\r\nbegin\r\n  if FEllipsisPosition <> AValue then\r\n  begin\r\n    FEllipsisPosition := AValue;\r\n    if FEllipsisPosition <> epNone then\r\n      FAutoSize := False;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetLayout(const Value: TTextLayout);\r\nbegin\r\n  if FLayout <> Value then\r\n  begin\r\n    FLayout := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  if FAlignment <> Value then\r\n  begin\r\n    FAlignment := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ContentHandle) then\r\n    ContentHandle.innerHTML := GetDisplayText\r\n  else\r\n    ElementHandle.innerHTML := GetDisplayText;\r\nend;\r\n\r\nprocedure TCustomLabel.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('display', 'table');\r\n    if AutoSize then\r\n      ElementHandle.style.setProperty('overflow', '')\r\n    else\r\n      ElementHandle.style.setProperty('overflow', 'hidden');\r\n  end;\r\n\r\n  if Assigned(ContentHandle) then\r\n  begin\r\n    case Layout of\r\n      tlTop: ContentHandle.style.setProperty('vertical-align', 'top');\r\n      tlCenter: ContentHandle.style.setProperty('vertical-align', 'middle');\r\n      tlBottom: ContentHandle.style.setProperty('vertical-align', 'bottom');\r\n    end;\r\n\r\n    case Alignment of\r\n    taCenter: ContentHandle['align'] := 'center';\r\n    taRightJustify: ContentHandle['align'] := 'right';\r\n    end;\r\n\r\n    if not Transparent then\r\n      ContentHandle.style.setProperty('background-color', ColorToHTML(Color));\r\n\r\n    ContentHandle.style.setProperty('display', 'table-cell');\r\n\r\n    if Enabled then\r\n      ContentHandle.style.setProperty('color', ColorToHtml(Font.Color));\r\n\r\n    if ElementFont = efProperty then\r\n      SetHTMLElementFont(ContentHandle, Font);\r\n\r\n    if FEllipsisPosition = epNone then\r\n      ContentHandle.style.setProperty('text-overflow', 'clip')\r\n    else\r\n      ContentHandle.style.setProperty('text-overflow', 'ellipsis');\r\n\r\n    if WordWrap then\r\n      ContentHandle.style.setProperty('white-space', 'normal')\r\n    else\r\n      ContentHandle.style.setProperty('white-space', 'nowrap');\r\n  end;\r\nend;\r\n\r\n{ TCustomInput }\r\n\r\nfunction TCustomInput.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('INPUT');\r\n  Result['type'] := GetInputType;\r\nend;\r\n\r\nprocedure TCustomInput.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    if Color <> clWindow then\r\n      TJSHTMLInputElement(Container).style.setProperty('background-Color',ColorToHTML(Color));\r\n\r\n    TJSHTMLInputElement(Container).style.setProperty('-moz-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('-webkit-box-sizing', 'border-box');\r\n    TJSHTMLInputElement(Container).style.setProperty('box-sizing', 'border-box');\r\n  end;\r\nend;\r\n\r\nprocedure TCustomInput.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TCustomInput.GetInputType: string;\r\nbegin\r\n   Result := 'EDIT';\r\nend;\r\n\r\n{ TCustomEdit }\r\n\r\nprocedure TCustomEdit.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.Change;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n    FText := ElementInputHandle.value;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomEdit.Clear;\r\nbegin\r\n  Text := '';\r\nend;\r\n\r\nprocedure TCustomEdit.ClearSelection;\r\nvar\r\n  s: string;\r\nbegin\r\n  s := Text;\r\n  Text := Copy(s, 1, SelStart) + Copy(s, SelStart + SelLength, Length(s));\r\nend;\r\n\r\nprocedure TCustomEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FText := '';\r\n  FCharCase := wecNormal;\r\n  FMaxLength := 0;\r\n  FReadOnly := false;\r\n  FTextHint := '';\r\nend;\r\n\r\nprocedure TCustomEdit.DisableTab;\r\nbegin\r\n  inherited;\r\n  Container.setAttribute('tabindex','-1');\r\nend;\r\n\r\nfunction TCustomEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomEdit.SetReadOnly(AValue: Boolean);\r\nbegin\r\n  FReadOnly := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelLength(const Value: Integer);\r\nbegin\r\n  FSelLength := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetSelStart(const Value: Integer);\r\nbegin\r\n  FSelStart := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetPasswordChar(const Value: Char);\r\nbegin\r\n  FPasswordChar := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetNumeric(const Value: Boolean);\r\nbegin\r\n  FNumeric := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetText(AValue: string);\r\nbegin\r\n  FText := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCustomEdit.GetText: string;\r\nbegin\r\n  Result := FText;\r\n  if Assigned(ElementInputHandle) then\r\n    Result := ElementInputHandle.value;\r\nend;\r\n\r\nfunction TCustomEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := ReadOnly;\r\nend;\r\n\r\nprocedure TCustomEdit.SetTextHint(AValue: string);\r\nbegin\r\n  FTextHint := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    case CharCase of\r\n      wecUpperCase: ElementInputHandle.style.setProperty('text-transform', 'uppercase');\r\n      wecLowerCase: ElementInputHandle.style.setProperty('text-transform', 'lowercase');\r\n      wecMixedCase: ElementInputHandle.style.setProperty('text-transform', 'capitalize');\r\n      wecNormal: ElementInputHandle.style.setProperty('text-transform', 'initial');\r\n    end;\r\n\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n    ElementInputHandle.placeholder := TextHint;\r\n    ElementInputHandle['type'] := GetInputType;\r\n\r\n    if MaxLength <= 0 then\r\n      ElementInputHandle.removeAttribute('maxLength')\r\n    else\r\n      ElementInputHandle.maxLength := MaxLength;\r\n\r\n    ElementInputHandle.value := GetDisplayText;\r\n\r\n    if not Numeric then\r\n      ElementInputHandle.setSelectionRange(SelStart, SelStart + SelLength);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomEdit.SelectAll;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n    ElementInputHandle.select;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAlignment(const Value: TAlignment);\r\nbegin\r\n  FAlignment := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSelect(const Value: Boolean);\r\nbegin\r\n  FAutoSelect := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  FAutoSize := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetCharCase(AValue: TEditCharCase);\r\nbegin\r\n  FCharcase := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetHideSelection(const Value: Boolean);\r\nbegin\r\n  FHideSelection := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomEdit.SetMaxLength(AValue: integer);\r\nbegin\r\n  FMaxLength := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCustomEdit.GetDisplayText: string;\r\nbegin\r\n  Result := FText;\r\nend;\r\n\r\nfunction TCustomEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TCustomEdit.GetInputType: string;\r\nbegin\r\n  if PasswordChar <> '' then\r\n    Result := 'PASSWORD'\r\n  else if Numeric then\r\n    Result := 'NUMBER'\r\n  else\r\n    Result := 'TEXT';\r\nend;\r\n\r\nprocedure TCustomEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value', Text);\r\nend;\r\n\r\n{ TSpinEdit }\r\n\r\nprocedure TSpinEdit.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIncrement := 1;\r\n  FMaxValue := 0;\r\n  FMinValue := 0;\r\n  ShowFocus := true;\r\nend;\r\n\r\nprocedure TSpinEdit.BindEvents; \r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nfunction TSpinEdit.GetDisplayText: string;\r\nbegin\r\n  Result := IntToStr(FValue);\r\nend;\r\n\r\nfunction TSpinEdit.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TSpinEdit.DisableTab;\r\nbegin\r\n  inherited;\r\n  Container.setAttribute('tabindex','-1');\r\nend;\r\n\r\nfunction TSpinEdit.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TSpinEdit.Change;\r\nbegin\r\n  FValue := GetValue;\r\n\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TSpinEdit.GetInputType: string;\r\nbegin\r\n  Result := 'NUMBER';\r\nend;\r\n\r\nfunction TSpinEdit.GetText: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TSpinEdit.GetValue: integer;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FValue;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  s := TJSHTMLInputElement(Container).value;\r\n  if (s <> '') then\r\n    Result := StrToInt(s);\r\nend;\r\n\r\nfunction TSpinEdit.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TSpinEdit.SetIncrement(AValue: integer);\r\nbegin\r\n  FIncrement := AValue;\r\n  if Assigned(Container) then\r\n    Container['step'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMaxValue(AValue: integer);\r\nbegin\r\n  FMaxValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['max'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetMinValue(AValue: integer);\r\nbegin\r\n  FMinValue := AValue;\r\n  if Assigned(Container) then\r\n    Container['min'] := IntToStr(AValue);\r\nend;\r\n\r\nprocedure TSpinEdit.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TSpinEdit.SetText(const Value: string);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TSpinEdit.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.setAttribute('value',IntToStr(Value));\r\nend;\r\n\r\nprocedure TSpinEdit.SetValue(AValue: integer);\r\nbegin\r\n  FValue := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TSpinEdit.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    Container['inputmode'] := 'numeric';\r\n    Container['pattern'] := '[0-9]*';\r\n    TJSHTMLInputElement(Container).value := GetDisplayText;\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n  end;\r\nend;\r\n\r\n{ TDateTimePicker }\r\n\r\nfunction TDateTimePicker.GetInputType: string; \r\nbegin\r\n   if FKind = dtkDate then\r\n    Result := 'DATE'\r\n  else\r\n    Result := 'TIME';\r\nend;\r\n\r\nprocedure TDateTimePicker.SetDate(AValue: TDateTime);\r\nbegin\r\n  if FDate <> AValue then\r\n  begin\r\n    FDate := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n  begin\r\n    TJSHTMLInputElement(Container).oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.Change;\r\nbegin\r\n  FTime := GetTime;\r\n  FDate := GetDate;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TDateTimePicker.CreateElement: TJSElement;\r\nbegin\r\n  Result := inherited CreateElement;\r\n  if Assigned(Container) then\r\n    Container['step'] := '1';\r\nend;\r\n\r\nprocedure TDateTimePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Date := now;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TDateTimePicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nfunction TDateTimePicker.GetDate: TDateTime;\r\nvar\r\n  str: string;\r\n  ye,mo,da: string;\r\nbegin\r\n  Result := FTime;\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(Container).value;\r\n\r\n  ye := copy(str,1,4);\r\n  mo := copy(str,6,2);\r\n  da := copy(str,9,2);\r\n\r\n  Result := EncodeDate(StrToInt(ye), StrToInt(mo), StrToInt(da));\r\nend;\r\n\r\nprocedure TDateTimePicker.SetText(const Value: String);\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n // TJSHTMLInputElement(Container).value := Value;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetTime(AValue: TDateTime);\r\nbegin\r\n  if FTime <> AValue then\r\n  begin\r\n    FTime := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimePicker.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    case Kind of\r\n      dtkTime: TJSHTMLInputElement(Container).value := FormatDateTime(LongTimeFormat, FTime);\r\n      dtkDate: TJSHTMLInputElement(Container).value := FormatDateTime('yyyy-MM-dd', FDate);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TDateTimePicker.GetText: String;\r\nbegin\r\n  Result := '';\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Result := TJSHTMLInputElement(Container).value;\r\nend;\r\n\r\nfunction TDateTimePicker.GetTime: TDateTime;\r\nvar\r\n  str: string;\r\n  d: TDateTime;\r\nbegin\r\n  Result := FTime;\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  str := TJSHTMLInputElement(Container).value;\r\n  if TryStrToTime(str, d) then\r\n    Result := d;\r\nend;\r\n\r\nprocedure TDateTimePicker.SetKind(AValue: TDateTimeKind);\r\nbegin\r\n  FKind := AValue;\r\n  if Assigned(Container) then\r\n  begin\r\n    if AValue = dtkDate then\r\n      Container['type'] := 'DATE'\r\n    else\r\n      Container['type'] := 'TIME';\r\n  end;\r\nend;\r\n\r\n{ TButton }\r\n\r\nprocedure TButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FCaption := ElementID;\r\nend;\r\n\r\nprocedure TButton.DisableTab;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    Container.setAttribute('tabindex','-1');\r\nend;\r\n\r\nfunction TButton.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('BUTTON');\r\n  Result['type'] := 'BUTTON';\r\nend;\r\n\r\nprocedure TButton.SetCaption(AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n  if Assigned(Container) then\r\n  begin\r\n    ElementHandle.innerHTML := AValue;\r\n  end;\r\nend;\r\n\r\n{ TCheckBox }\r\n\r\nprocedure TCheckBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FCaption := ElementID;\r\n  ShowFocus := true;\r\nend;\r\n\r\nprocedure TCheckBox.DisableTab;\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(Container.firstElementChild);\r\n  cb.setAttribute('tabindex','-1');\r\nend;\r\n\r\nprocedure TCheckBox.Click;\r\nbegin\r\n  inherited;\r\n  FChecked := GetChecked;\r\nend;\r\n\r\nfunction TCheckBox.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n\r\n  btn['TYPE'] := 'CHECKBOX';\r\n  btn['id'] := GetID;\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  TJSHTMLElement(btn).style.setProperty('vertical-align','middle');\r\n  TJSHTMLElement(lbl).style.setProperty('vertical-align','middle');\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\nend;\r\n\r\nfunction TCheckBox.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    chk := TJSHTMLInputElement(Container.firstElementChild);\r\n    chk.checked := not chk.checked;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCheckBox.Loaded;\r\nvar\r\n  lbl: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    lbl := TJSHTMLInputElement(Container.children[1]);\r\n    lbl.OnClick := @HandleLabelClick;\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementData;\r\nvar\r\n  chk: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    chk := TJSHTMLInputElement(Container.firstElementChild);\r\n    chk.disabled := not Enabled;\r\n    chk.checked := FChecked;\r\n    chk.indeterminate := (State = cbGrayed);\r\n  end;\r\nend;\r\n\r\nprocedure TCheckBox.UpdateElementSize;\r\nbegin\r\n  inherited;\r\n   if (HeightStyle = ssAbsolute) and Assigned(ElementHandle) then\r\n   begin\r\n     ElementHandle.style.setProperty('height','');\r\n   end;\r\nend;\r\n\r\nprocedure TCheckBox.SetCaption(AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n  if Assigned(Container) then\r\n    Container.lastElementChild.innerHTML := AValue;\r\nend;\r\n\r\nprocedure TCheckBox.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container.firstElementChild).disabled := not Value;\r\nend;\r\n\r\nprocedure TCheckBox.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetChecked: boolean;\r\nbegin\r\n  if Assigned(Container) then\r\n    FChecked := TJSHTMLInputElement(Container.firstElementChild).checked;\r\n\r\n  Result := FChecked;\r\nend;\r\n\r\nprocedure TCheckBox.SetState(AValue: TCheckBoxState);\r\nbegin\r\n  FState := AValue;\r\n  FChecked := FState = cbChecked;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TCheckBox.GetState: TCheckBoxState;\r\nbegin\r\n  Result := FState;\r\nend;\r\n\r\nprocedure TCheckBox.PersistinHTML;\r\nvar\r\n  cb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  cb := TJSHTMLInputElement(Container.firstElementChild);\r\n\r\n  if (cb.checked) then\r\n    cb.setAttribute('checked','checked')\r\n  else\r\n    cb.removeAttribute('checked');\r\nend;\r\n\r\n\r\n{ TRadioButton }\r\n\r\nprocedure TRadioButton.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FCaption := ElementID;\r\n  FGroupName := '';\r\n  ShowFocus := true;\r\nend;\r\n\r\nprocedure TRadioButton.DisableTab;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(Container.firstElementChild);\r\n  rb.setAttribute('tabindex','-1');\r\nend;\r\n\r\nfunction TRadioButton.CreateElement: TJSElement;\r\nvar\r\n  btn, lbl: TJSElement;\r\nbegin\r\n  Result := document.createElement('LABEL');\r\n  btn := document.createElement('INPUT');\r\n  lbl := document.createElement('SPAN');\r\n  btn['TYPE'] := 'RADIO';\r\n  btn['id'] := GetID + 'rd';\r\n  btn['name'] := GroupName;\r\n\r\n  TJSHTMLInputElement(btn).disabled := not Enabled;\r\n  TJSHTMLInputElement(btn).style.setProperty('vertical-align','middle');\r\n\r\n  TJSHTMLInputElement(btn).style.setProperty('margin-top','-2px');\r\n\r\n  lbl['id'] := GetID + 'lbl';\r\n  lbl['value'] := GetID;\r\n\r\n  Result.appendChild(btn);\r\n  Result.appendChild(lbl);\r\nend;\r\n\r\nfunction TRadioButton.HandleLabelClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    rb := TJSHTMLInputElement(Container.firstElementChild);\r\n    rb.checked := true;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TRadioButton.Loaded;\r\nvar\r\n  lbl: TJSHTMLInputElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    lbl := TJSHTMLInputElement(Container.children[1]);\r\n    if Assigned(lbl) then\r\n      lbl.OnClick := @HandleLabelClick;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetCaption(AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n  if Assigned(Container) then\r\n    Container.lastElementChild.innerHTML := AValue;\r\nend;\r\n\r\nprocedure TRadioButton.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container.firstElementChild).disabled := not Value;\r\nend;\r\n\r\nprocedure TRadioButton.SetGroupName(AValue: string);\r\nbegin\r\n  FGroupName := AValue;\r\n  if Assigned(Container) then\r\n    Container.firstElementChild['name'] := AValue;\r\nend;\r\n\r\nprocedure TRadioButton.UpdateElementSize;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  inherited;\r\n  el := document.getElementById(GetID + 'rd');\r\n  if Assigned(el) then\r\n  begin\r\n    TJSHTMLElement(el).style.setProperty('height',InttoStr(Height)+'px');\r\n  end;\r\nend;\r\n\r\nprocedure TRadioButton.SetChecked(AValue: boolean);\r\nbegin\r\n  FChecked := AValue;\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container.firstElementChild).checked := AValue;\r\nend;\r\n\r\nfunction TRadioButton.GetChecked: boolean;\r\nbegin\r\n  Result := FChecked;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLInputElement(Container.firstElementChild).checked;\r\nend;\r\n\r\nprocedure TRadioButton.PersistInHTML;\r\nvar\r\n  rb: TJSHTMLInputElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  rb := TJSHTMLInputElement(Container.firstElementChild);\r\n  if (rb.checked) then\r\n    rb.setAttribute('checked','checked')\r\n  else\r\n    rb.removeAttribute('checked');\r\nend;\r\n\r\n{ TListBox }\r\n\r\nprocedure TListBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  FItems.OnChange := DoItemsChange;\r\n  FMultiSelect := false;\r\n  FSelected := TList.Create;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TListBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SELECT');\r\n  Result['Size'] := '2';\r\nend;\r\n\r\ndestructor TListBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  FSelected.Free;\r\n  inherited;\r\nend;\r\n\r\n\r\nprocedure TListBox.DisableTab;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    Container.setAttribute('tabindex','-1');\r\nend;\r\n\r\nfunction TListBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TListBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TListBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.onchange := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TListBox.ClearSelection;\r\nvar\r\n  i: integer;\r\nbegin\r\n  ItemIndex := -1;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;  \r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := false;\r\nend;\r\n\r\nprocedure TListBox.SelectAll;\r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;  \r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    Selected[i] := true;\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected := true;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItems(AItems: TStringList);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nfunction TListBox.GetCount: Integer;\r\nbegin\r\n  Result := FItems.Count;\r\nend;\r\n\r\nfunction TListBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TListBox.GetItemIndex: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLSelectElement(Container).selectedIndex;\r\nend;\r\n\r\nprocedure TListBox.PersistinHTML; \r\nvar\r\n  i: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for i := 0 to TJSHTMLSelectElement(Container).options.length - 1 do\r\n  begin\r\n    if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).setAttribute('selected','selected')\r\n    else\r\n      TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).removeAttribute('selected');\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetItemHeight(const Value: Integer);\r\nbegin\r\n  FItemHeight := Value;\r\nend;\r\n\r\nprocedure TListBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.SetMultiSelect(AValue: boolean);\r\nbegin\r\n  FMultiSelect := AValue;\r\n  if Assigned(Container) then\r\n    TJSHTMLSelectElement(Container).multiple := AValue;\r\nend;\r\n\r\nfunction TListBox.GetSelCount: integer;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := 0;\r\n\r\n  if Assigned(Container) then\r\n  begin\r\n    for i := 0 to FItems.Count - 1 do\r\n    begin\r\n      if TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[i]).selected then\r\n        inc(Result);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TListBox.GetSelected(AIndex: integer): boolean;\r\nbegin\r\n  if (AIndex < FSelected.Count) then\r\n    Result := boolean(FSelected.Items[AIndex])\r\n  else\r\n    Result := False;\r\n\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected;\r\nend;\r\n\r\n\r\nprocedure TListBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TListBox.SetSelected(AIndex: integer; AValue: boolean);\r\nbegin  \r\n  while (AIndex >= FSelected.Count) do\r\n    FSelected.Add(false);\r\n\r\n  FSelected.Items[AIndex] := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLOptionElement(TJSHTMLSelectElement(Container).options[Aindex]).selected := AValue;\r\nend;\r\n\r\nprocedure TListBox.SetSorted(const Value: Boolean);\r\nbegin\r\n  FSorted := Value;\r\n  Items.Sort;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n  begin\r\n    ElementSelectHandle.style.setProperty('overflow', 'auto');\r\n    ElementSelectHandle.selectedIndex := FItemIndex;\r\n  end;\r\nend;\r\n\r\nprocedure TListBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Color <> clWindow then\r\n    ElementHandle.style.setProperty('background-Color',ColorToHTML(Color));\r\nend;\r\n\r\nprocedure TListBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TListBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  opt: TJSHTMLOptionElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    opt := TJSHTMLOptionElement.New(FItems[i]);\r\n    TJSHTMLSelectElement(Container).add(opt);\r\n    Selected[i] := false;\r\n  end;\r\nend;\r\n\r\n{ TCustomComboBox }\r\n\r\nprocedure TCustomComboBox.AddItem(Item: string; AObject: TObject);\r\nbegin\r\n  FItems.AddObject(Item, AObject);\r\nend;\r\n\r\nprocedure TCustomComboBox.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.onchange := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.Clear;\r\nbegin\r\n  Items.Clear;\r\nend;\r\n\r\nprocedure TCustomComboBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FItems := TStringList.Create;\r\n  FItems.OnChange := DoItemsChange;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TCustomComboBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SELECT');\r\nend;\r\n\r\ndestructor TCustomComboBox.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomComboBox.DisableTab;\r\nbegin\r\n  inherited;\r\n  if Assigned(Container) then\r\n    Container.setAttribute('tabindex','-1');\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItems(AItems: TStringList);\r\nbegin\r\n  FItems.Assign(AItems);\r\nend;\r\n\r\nprocedure TCustomComboBox.SetStyle(const Value: TComboBoxStyle);\r\nbegin\r\n  FStyle := Value;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetText(const Value: string);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if Value = Items[I] then\r\n      ItemIndex := I;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementSelectHandle) then\r\n    ElementSelectHandle.selectedIndex := FItemIndex;\r\nend;\r\n\r\nfunction TCustomComboBox.GetElementSelectHandle: TJSHTMLSelectElement;\r\nbegin\r\n  Result := TJSHTMLSelectElement(Container);\r\nend;\r\n\r\nfunction TCustomComboBox.GetItemIndex: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n  if Assigned(Container) then\r\n    Result := TJSHTMLSelectElement(Container).selectedIndex;\r\nend;\r\n\r\nfunction TCustomComboBox.GetText: string;\r\nbegin\r\n  if ItemIndex >= 0 then\r\n    Result := Items[ItemIndex]\r\n  else\r\n    Result := '';\r\nend;\r\n\r\nprocedure TCustomComboBox.Change;\r\nbegin\r\n  FItemIndex := GetItemIndex;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TCustomComboBox.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomComboBox.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.PersistinHTML;\r\nvar\r\n  sel: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  sel := TJSHTMLElement(ElementHandle.children[ItemIndex]);\r\n  sel.setAttribute('selected','selected');\r\nend;\r\n\r\nprocedure TCustomComboBox.SetDroppedDown(const Value: Boolean);\r\nbegin\r\n  FDroppedDown := Value;\r\nend;\r\n\r\nprocedure TCustomComboBox.SetItemIndex(AIndex: integer);\r\nbegin\r\n  if FItemIndex <> AIndex then\r\n  begin\r\n    FItemIndex := AIndex;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoItemsChange(Sender: TObject);\r\nbegin\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TCustomComboBox.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  opt: TJSElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  for i := TJSHTMLSelectElement(Container).options.length - 1 downto 0 do\r\n    TJSHTMLSelectElement(Container).remove(i);\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    s := FItems[i];\r\n    opt := document.createElement('OPTION');\r\n    opt['value'] := s;\r\n    opt.innerHTML := s;\r\n    Container.appendChild(opt);\r\n  end;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\n\r\n{ TFontPicker }\r\n\r\nprocedure TFontPicker.CreateInitialize;\r\nvar\r\n  tst: boolean;\r\n  \r\n  procedure Add(s: string);\r\n  begin\r\n    asm\r\n      tst = d.detect(s);\r\n    end;\r\n    if tst then\r\n      Self.Items.Add(s);\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  asm\r\n    var Detector = function() {\r\n    // a font will be compared against all the three default fonts.\r\n    // and if it doesn't match all 3 then that font is not available.\r\n    var baseFonts = ['monospace', 'sans-serif', 'serif'];\r\n\r\n    //we use m or w because these two characters take up the maximum width.\r\n    // And we use a LLi so that the same matching fonts can get separated\r\n    var testString = \"mmmmmmmmmmlli\";\r\n\r\n    //we test using 72px font size, we may use any size. I guess larger the better.\r\n    var testSize = '72px';\r\n\r\n    var h = document.getElementsByTagName(\"body\")[0];\r\n\r\n    // create a SPAN in the document to get the width of the text we use to test\r\n    var s = document.createElement(\"span\");\r\n    s.style.fontSize = testSize;\r\n    s.innerHTML = testString;\r\n    var defaultWidth = {};\r\n    var defaultHeight = {};\r\n    for (var index in baseFonts) {\r\n        //get the default width for the three base fonts\r\n        s.style.fontFamily = baseFonts[index];\r\n        h.appendChild(s);\r\n        defaultWidth[baseFonts[index]] = s.offsetWidth; //width for the default font\r\n        defaultHeight[baseFonts[index]] = s.offsetHeight; //height for the defualt font\r\n        h.removeChild(s);\r\n    }\r\n\r\n    function detect(font) {\r\n        var detected = false;\r\n        for (var index in baseFonts) {\r\n            s.style.fontFamily = font + ',' + baseFonts[index]; // name of the font along with the base font for fallback.\r\n            h.appendChild(s);\r\n            var matched = (s.offsetWidth != defaultWidth[baseFonts[index]] || s.offsetHeight != defaultHeight[baseFonts[index]]);\r\n            h.removeChild(s);\r\n            detected = detected || matched;\r\n        }\r\n        return detected;\r\n    }\r\n\r\n    this.detect = detect;\r\n    };\r\n\r\n    var d = new Detector();\r\n    //tst = d.detect(\"Arial\");\r\n  end;\r\n\r\n  Add('Arial');\r\n  Add('Arial Black');\r\n  Add('Arial Narrow');\r\n  Add('Courier');\r\n  Add('Courier New');\r\n  Add('Georgia');\r\n  Add('Lucida Console');\r\n  Add('Modena');\r\n  Add('Monotype Corsiva');\r\n  Add('Papyrus');\r\n  Add('Tahoma');\r\n  Add('Times');\r\n  Add('Times New Roman');\r\n  Add('Trebuchet MS');\r\n  Add('Verdana');\r\n  Add('Verona');\r\nend;\r\n\r\n{ TFontSizePicker }\r\n\r\nprocedure TFontSizePicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  PickerMode := fmPointSize;\r\nend;\r\n\r\nprocedure TFontSizePicker.Init;\r\nbegin\r\n  Items.Clear;\r\n\r\n  case PickerMode of\r\n    fmPointSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('11');\r\n      Items.Add('12');\r\n      Items.Add('14');\r\n      Items.Add('16');\r\n      Items.Add('18');\r\n      Items.Add('20');\r\n      Items.Add('22');\r\n      Items.Add('24');\r\n      Items.Add('26');\r\n      Items.Add('28');\r\n      Items.Add('36');\r\n      Items.Add('48');\r\n      Items.Add('72');\r\n    end;\r\n    fmRelativeSize:\r\n    begin\r\n      Items.Add('8');\r\n      Items.Add('9');\r\n      Items.Add('10');\r\n      Items.Add('14');\r\n      Items.Add('18');\r\n      Items.Add('24');\r\n      Items.Add('36');\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TFontSizePicker.SetPickerMode(const AValue: TFontSizePickerMode);\r\nbegin\r\n  FPickerMode := AValue;\r\n  Init;\r\nend;\r\n\r\n\r\n{ TCustomMemo }\r\n\r\nfunction TCustomMemo.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomMemo.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n    ElementInputHandle.oninput := DoHandleInput;\r\n\r\n  if Assigned(ElementInputHandle) then\r\n    ElementInputHandle.onchange := DoHandleChange;\r\nend;\r\n\r\nprocedure TCustomMemo.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nprocedure TCustomMemo.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FLines := TStringList.Create;\r\n  FLines.OnChange := DoLinesChange;\r\n  ShowFocus := true;\r\nend;\r\n\r\nfunction TCustomMemo.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('TEXTAREA');\r\nend;\r\n\r\ndestructor TCustomMemo.Destroy;\r\nbegin\r\n  FLines.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomMemo.DoHandleInput(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  GetText;\r\n  Change;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomMemo.DoLinesChange(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TCustomMemo.SetAutoSize(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetLines(ALines: TStringList);\r\nbegin\r\n  FLines.Assign(ALines);\r\nend;\r\n\r\nprocedure TCustomMemo.SetReadOnly(const Value: boolean);\r\nbegin\r\n  if (FReadOnly <> Value) then\r\n  begin\r\n    FReadOnly := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelLength(const Value: Integer);\r\nbegin\r\n  if FSelLength <> Value then\r\n  begin\r\n    FSelLength := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetSelStart(const Value: Integer);\r\nbegin\r\n  if FSelStart <> Value then\r\n  begin\r\n    FSelStart := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.SetText(const Value: String);\r\nbegin\r\n  FLines.Text := Value;\r\nend;\r\n\r\nprocedure TCustomMemo.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.value := GetDisplayText;\r\n    ElementInputHandle.setSelectionRange(SelStart, SelStart + SelLength);\r\n    ElementInputHandle.style.setProperty('resize', 'none');\r\n    ElementInputHandle.readOnly := IsReadOnly;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomMemo.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) and not FBlockChange then\r\n  begin\r\n    ElementInputHandle.style.setProperty('overflow', '');\r\n  end;\r\n\r\nend;\r\n\r\nfunction TCustomMemo.GetText: String;\r\nbegin\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    FBlockChange := True;\r\n    FLines.Text := ElementInputHandle.value;\r\n    FBlockChange := False;\r\n  end;\r\n\r\n  Result := FLines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.IsReadOnly: boolean;\r\nbegin\r\n  Result := FReadOnly;\r\nend;\r\n\r\nprocedure TCustomMemo.PersistinHTML;\r\nbegin\r\n  ElementInputHandle.innerHTML := Lines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetDisplayText: string;\r\nbegin\r\n  Result := FLines.Text;\r\nend;\r\n\r\nfunction TCustomMemo.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\n{ TRadioGroup }\r\n\r\nprocedure TRadioGroup.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FCaption := '';\r\n  FColumns := 1;\r\n  FItems := TStringList.Create;\r\n  FItemIndex := -1;\r\n  BorderWidth := 2;\r\nend;\r\n\r\nprocedure TRadioGroup.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nfunction TRadioGroup.CreateElement: TJSElement;\r\nvar\r\n  legend: TJSElement;\r\nbegin\r\n  Result := document.createElement('FIELDSET');\r\n  legend := document.createElement('LEGEND');\r\n  Result.appendChild(legend);\r\n  legend.innerHTML := Caption;\r\n  if Caption = '' then\r\n    TJSHTMLElement(legend).style.setProperty('display', 'none')\r\n  else\r\n    TJSHTMLElement(legend).style.setProperty('display', '');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('display', 'inline-block');\r\n\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-before','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-after','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-end','0px');\r\n  TJSHTMLElement(Result).style.setProperty('-webkit-padding-start','0px');\r\nend;\r\n\r\ndestructor TRadioGroup.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TRadioGroup.Loaded;\r\nbegin\r\n  inherited;\r\n  DoUpdateList;\r\nend;\r\n\r\nprocedure TRadioGroup.SetCaption(AValue: string);\r\nbegin\r\n  FCaption := AValue;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Container.firstElementChild.innerHTML := AValue;\r\n\r\n  if AValue = '' then\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('display', 'none')\r\n  else\r\n    TJSHTMLElement(Container.firstElementChild).style.setProperty('display', '');\r\nend;\r\n\r\nprocedure TRadioGroup.SetColumns(AValue: integer);\r\nbegin\r\n  if (FColumns > 0) and (FColumns <> AValue) then\r\n  begin\r\n    FColumns := AValue;\r\n    DoUpdateList;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioGroup.SetItems(AItems: TStringList);\r\nbegin\r\n  FItems.Assign(AItems);\r\n  DoUpdateList;  \r\nend;\r\n\r\nfunction TRadioGroup.GetItemIndex: integer;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  Result := FItemIndex;\r\n\r\n  for i := 0 to FItems.Count -1 do\r\n  begin\r\n    el := document.getElementByID(GetID + IntToStr(i) + 'rd');\r\n    if Assigned(el) then\r\n    begin\r\n      if TJSHTMLInputElement(el).checked then\r\n        Result := i;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TRadioGroup.SetItemIndex(AIndex: integer);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  FItemIndex := AIndex;\r\n\r\n  el := document.getElementByID(GetID + IntToStr(AIndex) + 'rd');\r\n  if Assigned(el) then\r\n    TJSHTMLInputElement(el).checked := True;\r\nend;\r\n\r\nfunction TRadioGroup.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  Change;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TRadioGroup.DoRadioClick(Sender: TObject);\r\nbegin\r\n  if ItemIndex = FOldItemIndex then\r\n    Exit;\r\n\r\n  Change;\r\n\r\n  FOldItemIndex := ItemIndex;\r\nend;\r\n\r\nprocedure TRadioGroup.DoUpdateList;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  rd: TRadioButton;\r\n  dx,dy,col,row: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  if FItems.Count = 0 then\r\n    Exit;\r\n\r\n  dy := Height div (FItems.Count div Columns);\r\n  dx := Width div FColumns;\r\n  col := 0;\r\n  row := 0;\r\n\r\n  for i := 0 to FItems.Count - 1 do\r\n  begin\r\n    s := FItems[i];\r\n    rd := TRadioButton.Create(GetID + IntToStr(i));\r\n    rd.Parent := Parent;\r\n    rd.Caption := s;\r\n    rd.GroupName := GetID;\r\n    rd.Top := 16 + row * dy;\r\n    rd.Left := 4 + col * dx;\r\n    rd.WidthStyle := ssPercent;\r\n    rd.WidthPercent := 100;\r\n    rd.ElementPosition := epAbsolute;\r\n    rd.OnClick := DoRadioClick;\r\n\r\n    if FItemIndex = i then\r\n      rd.Checked := true;\r\n\r\n    TJSHTMLElement(rd.Container).style.setProperty('float', 'left');\r\n    TJSHTMLElement(rd.Container).style.setProperty('width',  IntToStr(Trunc(100 / FColumns)) + '%');\r\n\r\n    if i mod FColumns = 0 then\r\n      TJSHTMLElement(rd.Container).style.setProperty('clear', 'left');\r\n\r\n    Container.appendChild(rd.Container);\r\n\r\n    if col < FColumns - 1 then\r\n      inc(col)\r\n    else\r\n    begin\r\n      col := 0;\r\n      inc(row);\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TProgressBar }\r\n\r\nprocedure TProgressBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMax := 100;\r\n  FMin := 0;\r\n  FPosition := 0;\r\nend;\r\n\r\nfunction TProgressBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('PROGRESS');\r\nend;\r\n\r\nprocedure TProgressBar.SetMax(AValue: integer);\r\nbegin\r\n  FMax := AValue;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TProgressBar.SetMin(AValue: integer);\r\nbegin\r\n  FMin := AValue;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TProgressBar.DoUpdate;\r\nvar\r\n  value: integer;\r\n  maxvalue: integer;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  value := FPosition - FMin;  \r\n  maxvalue := FMax - FMin;\r\n  Container['max'] := IntToStr(maxvalue);\r\n  Container['value'] := IntToStr(value);\r\nend;\r\n\r\nprocedure TProgressBar.SetPosition(AValue: integer);\r\nbegin\r\n  FPosition := AValue;\r\n  DoUpdate;\r\nend;\r\n\r\n{ TColorPicker }\r\n\r\nprocedure TColorPicker.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FColor := clBlack;\r\nend;\r\n\r\nprocedure TColorPicker.BindEvents; \r\nbegin\r\n  inherited;\r\n  if Assigned(ElementInputHandle) then\r\n  begin\r\n    ElementInputHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nprocedure TColorPicker.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('padding','0px'); \r\n    ElementHandle.style.setProperty('width', IntToStr(Width - 2) + 'px');\r\n    ElementHandle.style.setProperty('height',IntToStr(Height - 2) + 'px');\r\n  end;\r\nend;\r\n\r\nfunction TColorPicker.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nbegin   \r\n  Select;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TColorPicker.Select;\r\nbegin\r\n  if Assigned(OnSelect) then\r\n    OnSelect(Self);\r\nend;\r\n\r\nfunction TColorPicker.GetColor: TColor;\r\nbegin\r\n  Result := FColor;\r\n\r\n  if Assigned(Container) then\r\n    Result := HexToColor(TJSHTMLInputElement(Container).value);\r\nend;\r\n\r\nprocedure TColorPicker.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n\r\n  if Assigned(Container) then\r\n    TJSHTMLInputElement(Container).value := ColorToHTML(AValue);\r\nend;\r\n\r\nfunction TColorPicker.GetInputType: string;\r\nbegin \r\n  Result := 'COLOR';\r\nend;\r\n\r\n{ TScrollBar }\r\n\r\nprocedure TScrollBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  TabStop := True;\r\n  FKind := sbHorizontal;\r\n  FPosition := 0;\r\n  FMin := 0;\r\n  FMax := 100;\r\n  FSmallChange := 1;\r\n  FLargeChange := 1;\r\n\r\n  FContent := TScrollBarContent.Create(Self);\r\n  FContent.Parent := Self;\r\n  FContent.Width := 121;\r\n  FContent.Height := 17;\r\n\r\n  Width := 121;\r\n  Height := 17;\r\n\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.onscroll := @DoScroll;\r\nend;\r\n\r\nfunction TScrollBar.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\ndestructor TScrollBar.Destroy;\r\nbegin\r\n  FContent.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TScrollBar.DoScroll(Event: TJSUIEvent): Boolean;\r\nbegin\r\n  FScrolling := True;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\n\r\n  FScrolling := False;\r\n  Result := True;\r\nend;\r\n\r\nfunction TScrollBar.GetPageSize: Integer;\r\nbegin\r\n  Result := FPageSize;\r\n  if Result = 0 then\r\n    Result := 25;\r\nend;\r\n\r\nfunction TScrollBar.GetValue(XYPos: Double): Double;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(FContent) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal: Result := (XYPos / FContent.Width) * (Max - Min);\r\n      sbVertical: Result := (XYPos / FContent.Height) * (Max - Min);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TScrollBar.GetPosition: Integer;\r\nbegin\r\n  Result := 0;\r\n  if Assigned(Element) then\r\n  begin\r\n    case Kind of\r\n      sbHorizontal: Result := Round(GetValue(Element.scrollLeft));\r\n      sbVertical: Result := Round(GetValue(Element.scrollTop));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  inherited;\r\n  UpdateContent;\r\nend;\r\n\r\nprocedure TScrollBar.SetKind(const Value: TScrollBarKind);\r\nbegin\r\n  if FKind <> Value then\r\n  begin\r\n    FKind := Value;\r\n//    if not (csLoading in ComponentState) then\r\n    begin\r\n      case Kind of\r\n        sbHorizontal:\r\n        begin\r\n          SetBounds(Left, Top, Height, 17)\r\n        end;\r\n        sbVertical:\r\n        begin\r\n          SetBounds(Left, Top, 17, Width)\r\n        end;\r\n      end;\r\n    end;\r\n    UpdateElement;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMax(const Value: Integer);\r\nbegin\r\n  if FMax <> Value then\r\n  begin\r\n    FMax := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetMin(const Value: Integer);\r\nbegin\r\n  if FMin <> Value then\r\n  begin\r\n    FMin := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPageSize(const Value: Integer);\r\nbegin\r\n  if FPageSize <> Value then\r\n  begin\r\n    FPageSize := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.SetPosition(const Value: Integer);\r\nbegin\r\n  if FPosition <> Value then\r\n  begin\r\n    FPosition := Value;\r\n    UpdateContent;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\n    case Kind of\r\n      sbHorizontal:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', 'hidden');\r\n        ElementHandle.style.setProperty('overflow-x', '');\r\n      end;\r\n      sbVertical:\r\n      begin\r\n        ElementHandle.style.setProperty('overflow-y', '');\r\n        ElementHandle.style.setProperty('overflow-x', 'hidden');\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TScrollBar.UpdateContent;\r\nvar\r\n  x, y, w, h: Integer;\r\n  ps: Integer;\r\n  v: Single;\r\nbegin\r\n  if not Assigned(FContent) or not Assigned(ElementHandle) or (csLoading in ComponentState) or FScrolling then\r\n    Exit;\r\n\r\n  ps := PageSize;\r\n  v := (Max - Min) / ps;\r\n\r\n  case Kind of\r\n    sbHorizontal:\r\n    begin\r\n      y := 0;\r\n      h := Height;\r\n      w := Round(v * Width);\r\n      x := Round(((FPosition - Min) / (Max - Min)) * w);\r\n    end;\r\n    sbVertical:\r\n    begin\r\n      x := 0;\r\n      w := Width;\r\n      h := Round(v * Height);\r\n      y := Round(((FPosition - Min) / (Max - Min)) * h);\r\n    end;\r\n  end;\r\n\r\n  FContent.SetBounds(0, 0, w, h);\r\n  ElementHandle.scrollLeft := x;\r\n  ElementHandle.scrollTop := y;\r\nend;\r\n\r\n{ TScrollBarContent }\r\n\r\nfunction TScrollBarContent.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Controls;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Graphics, Types, SysUtils, Web;\r\n\r\nconst\r\n  VK_CANCEL = 3;\r\n  VK_BACK = 8;\r\n  VK_TAB = 9;\r\n  VK_RETURN = 13;\r\n  VK_SHIFT = 16;\r\n  VK_CONTROL = 17;\r\n  VK_MENU = 18;\r\n  VK_PAUSE = 19;\r\n  VK_CAPITAL = 20;\r\n  VK_ESCAPE = 27;\r\n  VK_SPACE = 32;\r\n  VK_PRIOR = 33;\r\n  VK_NEXT = 34;\r\n  VK_END = 35;\r\n  VK_HOME = 36;\r\n  VK_LEFT = 37;\r\n  VK_UP = 38;\r\n  VK_RIGHT = 39;\r\n  VK_DOWN = 40;\r\n  VK_PRINT = 42;\r\n  VK_SNAPSHOT = 44;\r\n  VK_INSERT = 45;\r\n  VK_DELETE = 46;\r\n  VK_HELP = 47;\r\n  VK_LWIN = 91;\r\n  VK_RWIN = 92;\r\n  VK_NUMPAD0 = 96;\r\n  VK_NUMPAD1 = 97;\r\n  VK_NUMPAD2 = 98;\r\n  VK_NUMPAD3 = 99;\r\n  VK_NUMPAD4 = 100;\r\n  VK_NUMPAD5 = 101;\r\n  VK_NUMPAD6 = 102;\r\n  VK_NUMPAD7 = 103;\r\n  VK_NUMPAD8 = 104;\r\n  VK_NUMPAD9 = 105;\r\n  VK_MULTIPLY = 106;\r\n  VK_ADD = 107;\r\n  VK_SEPARATOR = 108;\r\n  VK_SUBTRACT = 109;\r\n  VK_DECIMAL = 110;\r\n  VK_DIVIDE = 111;\r\n  VK_F1 = 112;\r\n  VK_F2 = 113;\r\n  VK_F3 = 114;\r\n  VK_F4 = 115;\r\n  VK_F5 = 116;\r\n  VK_F6 = 117;\r\n  VK_F7 = 118;\r\n  VK_F8 = 119;\r\n  VK_F9 = 120;\r\n  VK_F10 = 121;\r\n  VK_F11 = 122;\r\n  VK_F12 = 123;\r\n  VK_F13 = 124;\r\n  VK_F14 = 125;\r\n  VK_F15 = 126;\r\n  VK_F16 = 127;\r\n  VK_F17 = 128;\r\n  VK_F18 = 129;\r\n  VK_F19 = 130;\r\n  VK_F20 = 131;\r\n  VK_F21 = 132;\r\n  VK_F22 = 133;\r\n  VK_F23 = 134;\r\n  VK_F24 = 135;\r\n  VK_NUMLOCK = 144;\r\n\r\ntype\r\n  TCursor = Integer;\r\nconst\r\n  crDefault     = 0;\r\n  crNone        = 1;\r\n  crArrow       = 2;\r\n  crCross       = 3;\r\n  crIBeam       = 4;\r\n  crSize        = 22;\r\n  crSizeNESW    = 6;\r\n  crSizeNS      = 7;\r\n  crSizeNWSE    = 8;\r\n  crSizeWE      = 9;\r\n  crUpArrow     = 10;\r\n  crHourGlass   = 11;\r\n  crDrag        = 12;\r\n  crNoDrop      = 13;\r\n  crHSplit      = 14;\r\n  crVSplit      = 15;\r\n  crMultIDrag   = 16;\r\n  crSQLWait     = 17;\r\n  crNo          = 18;\r\n  crAppStart    = 19;\r\n  crHelp        = 20;\r\n  crHandPoint   = 21;\r\n  crSizeAll     = 22;\r\n\r\ntype\r\n  TCSSCodeManager = class;\r\n  Single = Double;\r\n  TDragState = (dsDragEnter, dsDragLeave, dsDragMove);\r\n  TDragObject = class(TObject);\r\n\r\n  TAlign = (alNone, alTop, alBottom, alLeft, alRight, alClient, alCustom);\r\n  TMouseButton = (mbLeft, mbRight, mbMiddle);\r\n  TBorderStyle = (bsNone, bsSingle);\r\n//  TControlPosition = (cpAbsolute, cpRelative, cpNone);\r\n  TSizeStyle = (ssPercent, ssAbsolute, ssAuto);\r\n  TScrollStyle = (ssNone, ssHorizontal, ssVertical, ssBoth);\r\n\r\n  TAnchorKind = (akLeft, akTop, akRight, akBottom);\r\n  TAnchors = set of TAnchorKind;\r\n\r\n  TMaterialGlyph = string;\r\n\r\n  TElementClassName = string;\r\n  TElementID = string;\r\n  TElementFont = (efProperty, efCSS);\r\n  TElementPosition = (epAbsolute, epRelative, epNone);\r\n\r\n  // Classes\r\n  TShiftState = set of (ssShift, ssAlt, ssCtrl,\r\n    ssLeft, ssRight, ssMIDdle, ssDouble, ssTouch, ssPen, ssCommand);\r\n  \r\n  TNotifyEvent = procedure(Sender: TObject) of object;\r\n  TMouseEvent = procedure(Sender: TObject; Button: TMouseButton; Shift: TShiftState; X,Y: Integer) of object;\r\n  TMouseWheelEvent = procedure(Sender: TObject; Shift: TShiftState; WheelDelta: Integer; MousePos: TPoint; var Handled: Boolean) of object;\r\n  TMouseMoveEvent = procedure(Sender: TObject; Shift: TShiftState; X,Y: Integer) of object;\r\n  TKeyEvent = procedure(Sender: TObject; var AKey: Word; Shift: TShiftState) of object;\r\n  TKeyPressEvent = procedure(Sender: TObject; var AChar: Char) of object;\r\n  TTouchEvent = procedure(Sender: TObject; X,Y: integer) of object;\r\n\r\n  TDragOverEvent = procedure(Sender, Source: TObject; X, Y: Integer; State: TDragState; var Accept: Boolean) of object;\r\n  TDragDropEvent = procedure(Sender, Source: TObject; X, Y: Integer) of object;\r\n  TStartDragEvent = procedure(Sender: TObject; var DragObject: TDragObject) of object;\r\n  TEndDragEvent = procedure(Sender, Target: TObject; X, Y: Integer) of object;\r\n\r\n  TControlStyleValue = (csAcceptsControls);\r\n  TControlStyle = set of TControlStyleValue;\r\n\r\n  TMargins = class(TPersistent)\r\n  private \r\n    FOnChange: TNotifyEvent;\r\n    FLeft, FTop, FRight, FBottom: Integer;\r\n  protected\r\n    procedure SetLeft(const Value: integer);\r\n    procedure SetTop(const Value: integer);\r\n    procedure SetRight(const Value: integer);\r\n    procedure SetBottom(const Value: integer);\r\n    procedure DoChange; virtual;\r\n  public\r\n    constructor Create; reintroduce;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  published\r\n    property Left: Integer read FLeft write SetLeft default 3;\r\n    property Top: Integer read FTop write SetTop default 3;\r\n    property Right: Integer read FRight write SetRight default 3;\r\n    property Bottom: Integer read FBottom write SetBottom default 3;\r\n  end;\r\n\r\n  TPercentSize = 0..100;\r\n\r\n  TControl = class(TComponent)\r\n  private\r\n    FMouseInsideLayer: Boolean;\r\n    FLayer: TJSElement;\r\n    FCaptured: Boolean;\r\n    FControlCreated: Boolean;\r\n    FUpdateCount: integer;\r\n    FBlockUpdateElement: Boolean;\r\n    FElement: TJSElement;\r\n    FID: string;\r\n    FNew: Boolean;\r\n    FContainer: TJSElement;\r\n    FElementEvent: TJSEvent;\r\n    \r\n    FElementClassName: string;\r\n    FColor: TColor;    \r\n    FFont: TFont;\r\n    FParent, FPrevParent: TControl;\r\n    FControls: array of TControl;\r\n\r\n    FOnDragOver: TDragOverEvent;\r\n    FOnDragDrop: TDragDropEvent;\r\n    FOnStartDrag: TStartDragEvent;\r\n    FonEndDrag: TEndDragEvent;\r\n    FOnClick: TNotifyEvent;\r\n    FOnDblClick: TNotifyEvent;\r\n    FOnMouseDown: TMouseEvent;\r\n    FOnMouseUp: TMouseEvent;\r\n    FOnMouseMove: TMouseMoveEvent;\r\n    FOnKeyDown: TKeyEvent;\r\n    FOnKeyUp: TKeyEvent;\r\n    FOnKeyPress: TKeyPressEvent;\r\n    FOnEnter: TNotifyEvent;\r\n    FOnExit: TNotifyEvent;\r\n    FEnabled: Boolean;\r\n    FHint: string;\r\n    FShowHint: Boolean;\r\n    FTabOrder: Integer;\r\n    FTabStop: Boolean;\r\n    FVisible: Boolean;\r\n    FWidth: Integer;\r\n    FHeight: Integer;\r\n    FTag: Integer;\r\n//    FControlPosition: TControlPosition;\r\n    FAlign: TAlign;\r\n    FAnchors: TAnchors;\r\n    FAlignWithMargins: boolean;\r\n    FIsAligning: boolean;\r\n    FOnMouseEnter: TNotifyEvent;\r\n    FOnMouseLeave: TNotifyEvent;\r\n    FCursor: TCursor;\r\n    FDoubleBuffered: Boolean;\r\n    FControlStyle: TControlStyle;\r\n    FMargins: TMargins;\r\n    FOnMouseWheel: TMouseWheelEvent;\r\n    FParentDoubleBuffered: Boolean;\r\n    FParentColor: Boolean;\r\n    FParentFont: Boolean;\r\n    FOnTouchMove: TTouchEvent;\r\n    FOnTouchStart: TTouchEvent;\r\n    FOnTouchEnd: TTouchEvent;\r\n    FLinkTouchEvents: Boolean;\r\n    FWidthStyle: TSizeStyle;\r\n    FHeightStyle: TSizeStyle;\r\n    FWidthPercent: TPercentSize;\r\n    FHeightPercent: TPercentSize;\r\n    FOrigRect: TRect;\r\n    FOrigParentRect: TRect;\r\n    FIsResizing: boolean;\r\n    FShowFocus: boolean;\r\n    FBorderWidth: integer;\r\n    FOrigTop: integer;\r\n    FOrigLeft: integer;\r\n    FUpdateTopLeft: boolean;\r\n    FEnablePropagation: Boolean;\r\n    FParentShowHint: Boolean;\r\n    FScriptLoaded: Boolean;\r\n    FControlScriptCount: Integer;\r\n    FControlScriptCountLoaded: Integer;\r\n    FRequiredScripts: TStringList;\r\n    FElementFont: TElementFont;\r\n    FElementPosition: TElementPosition;\r\n    function GetControlsCount: Integer;\r\n    function GetControls(Index: Integer): TControl;\r\n    procedure SetVisible(AValue: Boolean);\r\n    procedure SetWidth(AValue: Integer); virtual;\r\n    procedure SetHeight(AValue: Integer); virtual;\r\n//    procedure SetControlPosition(AValue: TControlPosition); virtual;\r\n    procedure SetHint(AValue: string);\r\n    procedure SetShowHint(AValue: Boolean);\r\n    procedure SetTabOrder(AValue: Integer);\r\n    procedure SetTabStop(AValue: Boolean);\r\n    procedure SetAlign(const Value: TAlign);\r\n    procedure SetAlignWithMargins(const Value: boolean);\r\n    procedure SetCursor(const Value: TCursor);\r\n    function GetBoundsRect: TRect;\r\n    procedure SetBoundsRect(const Value: TRect);\r\n    procedure SetID(const Value: string);\r\n    procedure SetMargins(const Value: TMargins);\r\n    procedure SetAnchors(const Value: TAnchors);\r\n    function GetElementEvent: TJSEvent;\r\n    function GetClientOrigin: TPoint;\r\n    procedure SetHeightStyle(const Value: TSizeStyle);\r\n    procedure SetWidthStyle(const Value: TSizeStyle);\r\n    procedure SetHeightPercent(const Value: TPercentSize);\r\n    procedure SetWidthPercent(const Value: TPercentSize);\r\n    procedure SetShowFocus(const Value: boolean);\r\n    procedure SetBorderWidth(const Value: integer);\r\n    function GetIsLinked: boolean;\r\n    procedure SetScriptLoaded(const Value: boolean);\r\n    procedure SetRequiredScripts(const Value: TStringList);\r\n    procedure SetElementFont(const Value: TElementFont);\r\n    procedure SetElementPosition(const Value: TElementPosition);\r\n  protected\r\n    procedure SetEnabled(Value: Boolean); virtual;\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Integer); virtual;\r\n    procedure RecreateCanvas; virtual;\r\n    procedure VisibleChanging; virtual;\r\n    function GetWidth: Integer; virtual;\r\n    function GetHeight: Integer; virtual;\r\n    function GetOuterWidth: integer; virtual;\r\n    function GetOuterHeight: integer; virtual;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function HandleAllocated: Boolean; virtual;\r\n    function CreateElement: TJSElement; virtual;\r\n    function ContainerElement: TJSElement; virtual;\r\n    procedure RecreateElement; virtual;\r\n    procedure BindElement; virtual;\r\n    procedure CreateInitialize; virtual;\r\n    procedure ClearControls; virtual;\r\n    function GetMouseEventButton(Event: TJSMouseEvent): TMouseButton; virtual;\r\n    function GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState; virtual;\r\n    function GetKeyBoardEventShiftState(Event: TJSKeyBoardEvent): TShiftState; virtual;\r\n    function GetMouseWheelEventShiftState(Event: TJSWheelEvent): TShiftState; virtual;\r\n    function GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoWheel(Event: TJSWheelEvent): Boolean; virtual;\r\n    function HandleDoDblClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseDown(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoMouseEnter(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n    function HandleDoExit(Event: TEventListenerEvent): Boolean; virtual;\r\n    function HandleDoEnter(Event: TJSFocusEvent): Boolean; virtual;\r\n    function HandleDoTouchStart(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchMove(Event: TJSTouchEvent): Boolean; virtual;\r\n    function HandleDoTouchEnd(Event: TJSTouchEvent): Boolean; virtual;\r\n    procedure HandleFontChanged(Sender: TObject);\r\n    procedure DoExit; virtual;\r\n    procedure DoEnter; virtual;\r\n    procedure Click; virtual;\r\n    procedure UpdateElement; virtual;\r\n    procedure UpdateElementSize; virtual;\r\n    procedure UpdateElementVisual; virtual;\r\n    procedure UpdateElementData; virtual;\r\n    procedure UpdateParent; virtual;\r\n    procedure InternalUpdateParent; virtual;\r\n    procedure UpdateChildren(AControl: TControl); virtual;\r\n    procedure PersistinHTML; virtual;\r\n    procedure InitFromHTML; virtual;\r\n    procedure DisableTab; virtual;\r\n\r\n    procedure SetElementClassName(AValue: string);\r\n    procedure SetColor(AValue: TColor); virtual;\r\n    procedure SetFont(AValue: TFont); virtual;\r\n    procedure SetParent(AValue: TControl); virtual;\r\n    procedure RegisterParent(AValue: TControl); virtual;\r\n    procedure UnRegisterParent(AValue: TControl); virtual;\r\n\r\n    procedure SetLeft(AValue: Integer); override;\r\n    procedure SetTop(AValue: Integer); override;\r\n\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); virtual;\r\n    procedure MouseMove(Shift: TShiftState; X,Y: Integer); virtual;\r\n\r\n    procedure TouchStart(X,Y: Integer); virtual;\r\n    procedure TouchMove(X,Y: Integer); virtual;\r\n    procedure TouchEnd(X,Y: Integer); virtual;\r\n\r\n    procedure DoMouseEnter; virtual;\r\n    procedure DoMouseLeave; virtual;\r\n    procedure MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); virtual;\r\n    procedure DblClick; virtual;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure KeyPress(var Key: Char); virtual;\r\n    procedure KeyUp(var Key: Word; Shift: TShiftState); virtual;\r\n    procedure SetFocus; virtual;\r\n    procedure DoMarginsChanged(Sender: TObject); virtual;\r\n    procedure DoRealign; virtual;\r\n    procedure DoBoundsChange; virtual;\r\n    procedure DoEndDrag(Target: TObject; X, Y: Integer); virtual;\r\n    procedure DoStartDrag(var DragObject: TDragObject); virtual;\r\n    procedure DragOver(Source: TObject; X, Y: Integer; State: TDragState;\r\n      var Accept: Boolean); virtual;\r\n    function IsFocused: Boolean; virtual;\r\n    function Focused: Boolean; virtual;\r\n    function GetID: string;\r\n    function GetElementHandle: TJSHTMLElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; virtual;\r\n    function GetElement: TJSElement;\r\n    function GetKeyCode(AValue: string): Integer;\r\n    function IsKeyCharacter(AValue: string): Boolean;\r\n    function GetClientRect: TRect;\r\n    property Container: TJSElement read FContainer write FContainer;\r\n    property ElementBindHandle: TJSEventTarget read GetElementBindHandle;\r\n    property Element: TJSElement read GetElement;\r\n    property ElementEvent: TJSEvent read GetElementEvent;\r\n\r\n    procedure CreateControl; virtual;\r\n    procedure BindEvents; virtual;\r\n    procedure UnbindEvents; virtual;\r\n    procedure SetHTMLElementFont(he: TJSHTMLElement; Font: TFont); virtual;\r\n    procedure AlignControls(AControl: TControl; var Rect: TRect); virtual;\r\n    procedure AlignControl(AControl: TControl); virtual;\r\n    procedure InitAnchoring; virtual;\r\n    procedure InitScript; virtual;\r\n    procedure Realign; virtual;\r\n    procedure Loaded; override;\r\n    procedure InternalResize; virtual;\r\n    procedure FontChanged; virtual;\r\n    procedure DisposeOf;\r\n\r\n    property Color: TColor read FColor write SetColor;\r\n    property Font: TFont read FFont write SetFont;\r\n    property ClientOrigin: TPoint read GetClientOrigin;\r\n    property OrigRect: TRect read FOrigRect;\r\n\r\n    property OnClick: TNotifyEvent read FOnClick write FOnClick;\r\n    property OnDblClick: TNotifyEvent read FOnDblClick write FOnDblClick;\r\n    property ControlStyle: TControlStyle read FControlStyle write FControlStyle;\r\n    procedure HookElement;\r\n    procedure CreateWithID(AID: string); virtual;\r\n    procedure AddInstanceStyle(const css: string); virtual;\r\n    procedure AddControlStyle(const css: string); virtual;\r\n    procedure AddControlLink(const linkid, link: string); virtual;\r\n    procedure AddControlScript(const link: string); virtual;\r\n    function AddRequiredScripts: boolean;\r\n    procedure AddRequiredScript(const link: string); virtual;\r\n    procedure UpdateAnchoring; virtual;\r\n    procedure UpdateChildAnchoring; virtual;\r\n    function GetWebClassName: string; virtual;\r\n    function GetCSSManager: TCSSCodeManager; virtual;\r\n    function IsUpdating: boolean;\r\n    function CanShowFocus: boolean; virtual;\r\n    procedure RequiredScriptLoaded; virtual;\r\n    procedure InjectCSS; virtual;\r\n    property LinkTouchEvents: Boolean read FLinkTouchEvents write FLinkTouchEvents;\r\n    property OnTouchStart: TTouchEvent read FOnTouchStart write FOnTouchStart;\r\n    property OnTouchMove: TTouchEvent read FOnTouchMove write FOnTouchMove;\r\n    property OnTouchEnd: TTouchEvent read FOnTouchEnd write FOnTouchEnd;\r\n    property ShowFocus: boolean read FShowFocus write SetShowFocus;\r\n    property BorderWidth: integer read FBorderWidth write SetBorderWidth;\r\n    property ControlScriptCount: integer read FControlScriptCount write FControlScriptCount;\r\n    property ControlScriptCountLoaded: integer read FControlScriptCountLoaded write FControlScriptCountLoaded;\r\n    property RequiredScripts: TStringList read FRequiredScripts write SetRequiredScripts;\r\n    function RequiredBaseURL: string; virtual;\r\n  public\r\n    constructor Create(ID: string); virtual; overload;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure DragDrop(Source: TObject; X, Y: Integer); virtual;\r\n    procedure Resize; virtual;\r\n    procedure Capture;\r\n    procedure ReleaseCapture;\r\n    procedure BringToFront;\r\n    procedure SendToBack;\r\n    procedure PreventDefault;\r\n    procedure StopPropagation;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure Invalidate; virtual;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    function Captured: Boolean; virtual;\r\n    function MakeScreenshot: TBitmap; virtual;\r\n    function ClientToScreen(const Point: TPoint): TPoint; virtual;\r\n    function ScreenToClient(const Point: TPoint): TPoint; virtual;\r\n    function CanFocus: Boolean; virtual;\r\n    property Controls[Index: Integer]: TControl read GetControls;\r\n    property ControlCount: Integer read GetControlsCount;\r\n    property Parent: TControl read FParent write SetParent;\r\n    property BoundsRect: TRect read GetBoundsRect write SetBoundsRect;\r\n//    property ControlPosition: TControlPosition read FControlPosition write SetControlPosition;\r\n    property DoubleBuffered: Boolean read FDoubleBuffered write FDoubleBuffered;\r\n    property ParentDoubleBuffered: Boolean read FParentDoubleBuffered write FParentDoubleBuffered;\r\n    property ParentColor: boolean read FParentColor write FParentColor;\r\n    property ParentFont: boolean read FParentFont write FParentFont;\r\n    property Align: TAlign read FAlign write SetAlign;\r\n    property AlignWithMargins: boolean read FAlignWithMargins write SetAlignWithMargins;\r\n    property ElementHandle: TJSHTMLElement read GetElementHandle;\r\n    property ElementClassName: string read FElementClassName write SetElementClassName;\r\n    property ElementFont: TElementFont read FElementFont write SetElementFont default efProperty;\r\n    property ElementPosition: TElementPosition read FElementPosition write SetElementPosition default epAbsolute;\r\n    property ElementID: string read GetID write SetID;\r\n    property Margins: TMargins read FMargins write SetMargins;\r\n    property ClientRect: TRect read GetClientRect;\r\n    property EnablePropagation: Boolean read FEnablePropagation write FEnablePropagation default False;\r\n    property ScriptLoaded: boolean read FScriptLoaded write SetScriptLoaded;\r\n\r\n    property Anchors: TAnchors read FAnchors write SetAnchors;\r\n    property Cursor: TCursor read FCursor write SetCursor;\r\n    property Enabled: Boolean read FEnabled write SetEnabled;\r\n    property HeightStyle: TSizeStyle read FHeightStyle write SetHeightStyle;\r\n    property Height: Integer read GetHeight write SetHeight;\r\n    property HeightPercent: TPercentSize read FHeightPercent write SetHeightPercent;\r\n    property Hint: string read FHint write SetHint;\r\n    property IsLinked: boolean read GetIsLinked;\r\n    property ShowHint: Boolean read FShowHint write SetShowHint;\r\n    property ParentShowHint: Boolean read FParentShowHint write FParentShowHint;\r\n    property TabOrder: Integer read FTabOrder write SetTabOrder;\r\n    property TabStop: Boolean read FTabStop write SetTabStop;\r\n    property Tag: Integer read FTag write FTag;\r\n    property Visible: Boolean read FVisible write SetVisible;\r\n    property WidthStyle: TSizeStyle read FWidthStyle write SetWidthStyle;\r\n    property Width: Integer read GetWidth write SetWidth;\r\n    property WidthPercent: TPercentSize read FWidthPercent write SetWidthPercent;\r\n\r\n    property OnDragOver: TDragOverEvent read FOnDragOver write FOnDragOver;\r\n    property OnDragDrop: TDragDropEvent read FOnDragDrop write FOnDragDrop;\r\n    property OnStartDrag: TStartDragEvent read FOnStartDrag write FOnStartDrag;\r\n    property OnEndDrag: TEndDragEvent read FOnEndDrag write FOnEndDrag;\r\n\r\n    property OnMouseWheel: TMouseWheelEvent read FOnMouseWheel write FOnMouseWheel;\r\n    property OnMouseDown: TMouseEvent read FOnMouseDown write FOnMouseDown;\r\n    property OnMouseUp: TMouseEvent read FOnMouseUp write FOnMouseUp;\r\n    property OnMouseMove: TMouseMoveEvent read FOnMouseMove write FOnMouseMove;\r\n    property OnMouseEnter: TNotifyEvent read FOnMouseEnter write FOnMouseEnter;\r\n    property OnMouseLeave: TNotifyEvent read FOnMouseLeave write FOnMouseLeave;\r\n    property OnKeyUp: TKeyEvent read FOnKeyUp write FOnKeyUp;\r\n    property OnKeyDown: TKeyEvent read FOnKeyDown write FOnKeyDown;\r\n    property OnKeyPress: TKeyPressEvent read FOnKeyPress write FOnKeyPress;\r\n    property OnEnter: TNotifyEvent read FOnEnter write FOnEnter;\r\n    property OnExit: TNotifyEvent read FOnExit write FOnExit;\r\n  end;\r\n\r\n  TWinControl = class(TControl)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Cursor;\r\n    property ElementClassName;\r\n    property Enabled;\r\n    property Height;\r\n    property HeightStyle;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Tag;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WidthStyle;\r\n\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnMouseMove;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnKeyUp;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnEnter;\r\n    property OnExit;\r\n  end;\r\n\r\n  TCustomControl = class(TWinControl)\r\n  private\r\n    FPixelRatio: Single;\r\n    FPainting: boolean;\r\n    FCanvas: TCanvas;\r\n    FElementCanvas: TJSHTMLCanvasElement;\r\n    FBorderStyle: TBorderStyle;\r\n    FBorderColor: TColor;\r\n    FCustomBorder: boolean;\r\n    function GetCanvas: TCanvas;\r\n  protected\r\n    function GetPixelRatio: Single;\r\n    procedure BlockDocumentTouch(Event: TJSTouchEvent);\r\n    procedure RecreateCanvas; override;\r\n    procedure SetBorderStyle(AValue: TBorderStyle); virtual;\r\n    procedure SetBorderColor(AValue: TColor); virtual;\r\n    procedure CreateControl; override;\r\n    procedure Loaded; override;\r\n    procedure UpdateElementVisual; override;\r\n    function CreateElement: TJSElement; override;\r\n    function GetCanvasHeightOffset: Integer; virtual;\r\n    function GetCanvasWidthOffset: Integer; virtual;\r\n    property BorderStyle: TBorderStyle read FBorderStyle write SetBorderStyle default bsSingle;\r\n    property BorderColor: TColor read FBorderColor write SetBorderColor default clSilver;\r\n    procedure BindEvents; override;\r\n    procedure Paint; virtual;\r\n    property CustomBorder: boolean read FCustomBorder write FCustomBorder;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n    function MakeScreenShot: TBitmap; override;\r\n    procedure Resize; override;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property ElementCanvas: TJSHTMLCanvasElement read FElementCanvas;\r\n    procedure Invalidate; override;\r\n  end;\r\n\r\n  TjQueryCustomControl = class(TWinControl)\r\n  private\r\n    FIsInitialized: boolean;\r\n    procedure InitJQueryOnce;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure Loaded; override;\r\n    procedure SetParent(AValue: TControl); override;\r\n    function GetJQID: string;\r\n    procedure InitJQuery; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Visible;\r\n  end;\r\n\r\n  TGraphicControl = class(TCustomControl);\r\n\r\n  TScrollingGraphicControl = class(TCustomControl)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  public\r\n    procedure UpdateElement; override;\r\n  end;\r\n\r\n  TControlManager = class(TComponent)\r\n  private\r\n    FInstanceCount: integer;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    function GetInstanceNumber: integer;\r\n    procedure Reset;\r\n  end;\r\n\r\n  TCSSCodeFragment = class(TCollectionItem)\r\n  private\r\n    FControlClassname: string;\r\n    FCSS: TStringList;\r\n    procedure SetCSS(const Value: TStringList);\r\n  public\r\n    constructor Create(Collection: TCollection); override;\r\n    destructor Destroy; override;\r\n  published\r\n    property ControlClassname: string read FControlClassname write FControlClassname;\r\n    property CSS: TStringList read FCSS write SetCSS;\r\n  end;\r\n\r\n  TCSSCodeFragments = class(TOwnedCollection)\r\n  private\r\n    function GetItemEx(Index: integer): TCSSCodeFragment;\r\n    procedure SetItemEx(Index: integer; const Value: TCSSCodeFragment);\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TCSSCodeFragment; reintroduce;\r\n    function Insert(Index: integer): TCSSCodeFragment; reintroduce;\r\n    property Items[Index: integer]: TCSSCodeFragment read GetItemEx write SetItemEx;\r\n  end;\r\n\r\n  TCSSCodeManager = class(TComponent)\r\n  private\r\n    FCSSFragments: TCSSCodeFragments;\r\n    procedure SetCSSFragments(const Value: TCSSCodeFragments);\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetClassFragment(AClassname: string): TCSSCodeFragment;\r\n    function GetClassCSS(AClassname: string): string;\r\n  published\r\n    property CSSFragments: TCSSCodeFragments read FCSSFragments write SetCSSFragments;\r\n  end;\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, WEBLib.StdCtrls;\r\n\r\nvar\r\n  ControlManager: TControlManager;\r\n\r\nfunction FindGlobalComponent(const Name: string): TComponent;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction FindUniqueName(const Name: string): string;\r\nbegin\r\n  Result := Name + IntToStr(ControlManager.GetInstanceNumber);\r\nend;\r\n\r\n{ TMargins }\r\n\r\nprocedure TMargins.SetLeft(const Value: integer);\r\nbegin\r\n  if (Value <> FLeft) then\r\n  begin\r\n    FLeft := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetTop(const Value: integer);\r\nbegin\r\n  if (Value <> FTop) then\r\n  begin\r\n    FTop := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetRight(const Value: integer);\r\nbegin\r\n  if (Value <> FRight) then\r\n  begin\r\n    FRight := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.SetBottom(const Value: integer);\r\nbegin\r\n  if (Value <> FBottom) then\r\n  begin\r\n    FBottom := Value;\r\n    DoChange;\r\n  end;\r\nend;\r\n\r\nprocedure TMargins.DoChange; \r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n\r\n{ TControl }\r\n\r\nfunction TControl.MakeScreenshot: TBitmap;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.MouseDown(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.MouseMove(Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.MouseUp(Button: TMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.MouseWheel(Shift: TShiftState; WheelDelta: Integer;\r\n  var Handled: Boolean);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.DoMouseLeave;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.DoMouseEnter;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.AlignControls(AControl: TControl; var Rect: TRect);\r\nvar\r\n  j: Integer;\r\n\r\n  procedure DoPosition(Control: TControl; AAlign: TAlign);\r\n  var\r\n    dl, dt, dr, db: integer;\r\n  begin\r\n    Control.FUpdateTopLeft := true;\r\n\r\n    if Control.AlignWithMargins then\r\n    begin\r\n      dl := Control.Margins.Left;\r\n      dt := Control.Margins.Top;\r\n      db := Control.Margins.Bottom;\r\n      dr := Control.Margins.Right;\r\n    end\r\n    else\r\n    begin\r\n      dl := 0;\r\n      dt := 0;\r\n      db := 0;\r\n      dr := 0;\r\n    end;\r\n\r\n    case AAlign of\r\n      alTop:\r\n      begin\r\n        Control.Width := Rect.Right - Rect.Left - dl - dr;\r\n        Control.Top := Rect.Top + dt;\r\n        Control.Left := Rect.Left + dl;\r\n        Rect.Top := Rect.Top + Control.Height + dt + db;\r\n      end;\r\n      alBottom:\r\n      begin\r\n        Control.Width := Rect.Right - Rect.Left - dl - dr - 1;\r\n        Control.Top := Rect.Bottom - Control.Height - db - 1;\r\n        Control.Left := Rect.Left + dl;\r\n        Rect.Bottom := Rect.Bottom - Control.Height - dt - db;\r\n      end;\r\n      alLeft:\r\n      begin\r\n        Control.Height := Rect.Bottom - Rect.Top - dt - db;\r\n        Control.Left := Rect.Left + dl;\r\n        Control.Top := Rect.Top + dt;\r\n        Rect.Left := Rect.Left + Control.Width + dl + dr;\r\n      end;\r\n      alRight:\r\n      begin\r\n        Control.Height := Rect.Bottom - Rect.Top - db - dt - 1;\r\n        Control.Left := Rect.Right - Control.Width - dr - 2;\r\n        Control.Top := Rect.Top + dt;\r\n        Rect.Right := Rect.Right - Control.Width - dr - dl;\r\n      end;\r\n      alClient:\r\n      begin\r\n        Control.Top := Rect.Top + dt;\r\n        Control.Left := Rect.Left + dl;\r\n        Control.Width := Rect.Right - Rect.Left - dl - dr;\r\n        Control.Height := Rect.Bottom - Rect.Top - db - dt;\r\n        Rect.Left := 0;\r\n        Rect.Top := 0;\r\n        Rect.Right := 0;\r\n        Rect.Bottom := 0;\r\n      end;\r\n    end;\r\n    Control.FUpdateTopLeft := false;\r\n  end;\r\n\r\n  procedure DoAlign(AAlign: TAlign);\r\n  var\r\n    i,j,ins: Integer;\r\n    il: TList;\r\n  begin\r\n    il := TList.Create;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n    begin\r\n      if (Controls[i].Align = AAlign) and (Controls[i].Visible) then\r\n      begin\r\n        ins := il.Count;\r\n\r\n        for j := il.Count - 1 downto 0 do\r\n        begin\r\n          case AAlign of\r\n          alTop:\r\n            if Controls[i].FOrigTop < TControl(il.Items[j]).FOrigTop then\r\n              ins := j;\r\n          alLeft:\r\n            if Controls[i].FOrigLeft < TControl(il.Items[j]).FOrigLeft then\r\n              ins := j;\r\n          alRight:\r\n            if Controls[i].FOrigLeft + Controls[i].Width > TControl(il.Items[j]).FOrigLeft + TControl(il.Items[j]).Width then\r\n              ins := j;\r\n          alBottom:\r\n            if Controls[i].FOrigTop + Controls[i].Height > TControl(il.Items[j]).FOrigTop + TControl(il.Items[j]).Height then\r\n              ins := j;\r\n          end;\r\n        end;\r\n        il.Insert(ins, Controls[i]);\r\n      end;\r\n    end;\r\n\r\n    for i := 0 to il.Count - 1 do\r\n    begin\r\n      DoPosition(TControl(il.Items[i]), AAlign);\r\n    end;\r\n\r\n    il.Free;\r\n  end;\r\n\r\nbegin\r\n  DoAlign(alTop);\r\n  DoAlign(alBottom);\r\n  DoAlign(alLeft);\r\n  DoAlign(alRight);\r\n  DoAlign(alClient);\r\n  DoAlign(alCustom);\r\n\r\n  for j := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[j].AlignControl(Controls[j]);\r\n  end;\r\nend;\r\n\r\nconstructor TControl.Create(ID: string);\r\nbegin\r\n  CreateWithID(ID);\r\nend;\r\n\r\nprocedure TControl.HookElement;\r\nvar\r\n  el: TJSElement;\r\n  i: integer;\r\nbegin\r\n  el := document.getElementByID(FID);\r\n  Container := el;\r\n  BindElement;\r\n  BindEvents;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].HookElement;\r\nend;\r\n\r\nfunction TControl.CanFocus: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.CanShowFocus: boolean;\r\nbegin\r\n  Result := FShowFocus;\r\nend;\r\n\r\nprocedure TControl.Capture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if Captured then\r\n    ReleaseCapture;\r\n\r\n  FMouseInsideLayer := true;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.addEventListener('mouseenter',@LayerHandleDoMouseEnter);\r\n  eh.addEventListener('mouseleave',@LayerHandleDoMouseLeave);\r\n  eh.addEventListener('mousedown',@HandleDoMouseDown);\r\n  eh.addEventListener('mouseup',@HandleDoMouseUp);\r\n  eh.addEventListener('mousemove',@HandleDoMouseMove);\r\n\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  FCaptured := True;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.Captured: Boolean;\r\nbegin\r\n  Result := FCaptured and Assigned(FLayer);\r\nend;\r\n\r\nprocedure TControl.ClearControls;\r\nbegin\r\n  SetLength(FControls, 0);\r\nend;\r\n\r\nprocedure TControl.Click;\r\nbegin\r\n  if Assigned(OnClick) then\r\n    OnClick(Self);\r\nend;\r\n\r\nfunction TControl.ClientToScreen(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X + Origin.X;\r\n  Result.Y := Point.Y + Origin.Y;\r\nend;\r\n\r\nfunction TControl.ContainerElement: TJSElement;\r\nbegin\r\n  Result := document.body;\r\nend;\r\n\r\nfunction TControl.RequiredBaseURL: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nprocedure TControl.RequiredScriptLoaded;\r\nbegin\r\n  inc(FControlScriptCountLoaded);\r\nend;\r\n\r\nconstructor TControl.Create(AOwner: TComponent);\r\nvar\r\n  s,prefix: String;\r\n  frm: TCustomForm;\r\n\r\nbegin\r\n  inherited Create(AOwner);\r\n\r\n  FScriptLoaded := false;\r\n  FElementFont := efProperty;\r\n  FElementPosition := epAbsolute;\r\n\r\n  s := ClassName;\r\n  Delete(s, 1, 1);\r\n\r\n  prefix := '';\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n    prefix := frm.ClassName;\r\n\r\n  CreateWithID(prefix+'_'+FindUniqueName(s));\r\nend;\r\n\r\nprocedure TControl.CreateControl;\r\nbegin\r\n  if not Assigned(FElement) then\r\n  begin\r\n    FElement := CreateElement;\r\n    if Assigned(FElement) then\r\n    begin\r\n      FControlCreated := True;\r\n      Container := FElement;\r\n      Container['id'] := ElementID;\r\n      Container['zindex'] := '0';\r\n      BindEvents;\r\n      UpdateElement;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nprocedure TControl.CreateInitialize;\r\nbegin\r\n  FRequiredScripts := TStringList.Create;\r\nend;\r\n\r\nprocedure TControl.CreateWithID(AID: string);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  FUpdateCount := 0;\r\n\r\n  FControlCreated := False;\r\n  FLinkTouchEvents := True;\r\n  FIsResizing := false;\r\n\r\n  if (Assigned(Owner) and (csLoading in Owner.ComponentState)) or not Assigned(Owner) then\r\n    Loading;\r\n\r\n  FElementPosition := epAbsolute;\r\n  FWidthStyle := ssAbsolute;\r\n  FHeightStyle := ssAbsolute;\r\n\r\n  el := document.getElementByID(AID);\r\n\r\n  if not Assigned(el) then\r\n  begin\r\n    Container := nil;\r\n    FNew := True;\r\n  end\r\n  else\r\n  begin\r\n    Container := el;\r\n    FNew := False;\r\n    FControlCreated := true;\r\n    FElementPosition := epRelative;\r\n    BindElement;\r\n    BindEvents;\r\n  end;\r\n\r\n  FID := AID;\r\n  FFont := TFont.Create;\r\n  FFont.OnChange := HandleFontChanged;\r\n  FEnabled := True;\r\n  FVisible := True;\r\n  FLeft := 0;\r\n  FTop := 0;\r\n  FTabStop := true;\r\n  FAlign := alNone;\r\n  FAlignWithMargins := false;\r\n  FIsAligning := false;\r\n  ParentFont := true;\r\n  FAnchors := [akLeft, akTop];\r\n  FOrigRect := Rect(-1,-1,-1,-1);\r\n  FShowFocus := false;\r\n  FBorderWidth := 0;\r\n  FEnablePropagation := False;\r\n\r\n  FColor := clWhite;\r\n\r\n  FMargins := TMargins.Create;\r\n  FMargins.OnChange := DoMarginsChanged;\r\n\r\n  FParent := nil;\r\n  FPrevParent := nil;\r\n\r\n  ClearControls;\r\n  CreateInitialize;\r\nend;\r\n\r\nprocedure TControl.BindElement;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.AddControlLink(const linkid, link: string);\r\nbegin\r\n  asm\r\n    function writeLinkOnce(linkName, linkText) {\r\n        var linkElement = document.getElementById(linkName);\r\n        if (linkElement)\r\n          return;\r\n        linkElement = document.createElement('link');\r\n        linkElement.id = linkName;\r\n        linkElement.setAttribute('rel', 'stylesheet');\r\n        linkElement.setAttribute('type', 'text/css');\r\n        linkElement.setAttribute('href', linkText);\r\n        document.getElementsByTagName('head')[0].appendChild(linkElement);\r\n    }\r\n    writeLinkOnce(linkid,link);\r\n  end;\r\n\r\nend;\r\n\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.AddControlScript(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  id := ClassName;\r\n\r\n  if not Assigned(document.getElementById(id)) then\r\n  begin\r\n    script := TJSHTMLScriptElement(document.createElement('script'));\r\n    script.id := id;\r\n    script.src := link;\r\n    script.type_ := 'text/javascript';\r\n    document.head.appendChild(script);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddControlStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := ClassName;\r\n\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n          styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(cssname,css);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddInstanceStyle(const css: string);\r\nvar\r\n  cssname: string;\r\nbegin\r\n  cssname := Name;\r\n\r\n  asm\r\n    function writeStylesOnce(styleName, cssText) {\r\n        var styleElement = document.getElementById(styleName);\r\n        if (styleElement) {\r\n          styleElement.innerHTML = cssText;\r\n          return;\r\n          }\r\n        styleElement = document.createElement('style');\r\n        styleElement.type = 'text/css';\r\n        styleElement.id = styleName;\r\n        styleElement.innerHTML = cssText;\r\n        document.getElementsByTagName('head')[0].appendChild(styleElement);\r\n    }\r\n    writeStylesOnce(cssname,css);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.AddRequiredScript(const link: string);\r\nvar\r\n  id: string;\r\n  script: TJSHTMLScriptElement;\r\n\r\nbegin\r\n  script := TJSHTMLScriptElement(document.createElement('script'));\r\n  script.src := link;\r\n  script.type_ := 'text/javascript';\r\n  script.addEventListener('load', @RequiredScriptLoaded);\r\n  document.head.appendChild(script);\r\nend;\r\n\r\nfunction TControl.AddRequiredScripts: boolean;\r\nvar\r\n  i,j: integer;\r\n  el: TJSElement;\r\n  scr: TJSHTMLScriptElement;\r\n  s: string;\r\n  found: boolean;\r\nbegin\r\n  FControlScriptCount := 0;\r\n\r\n  for j := 0 to RequiredScripts.Count - 1 do\r\n  begin\r\n    found := false;\r\n\r\n    for i := 0 to document.head.children.length - 1 do\r\n    begin\r\n      el := TJSElement(document.head.children[i]);\r\n      if (el.tagName = 'SCRIPT') then\r\n      begin\r\n        scr := TJSHTMLScriptElement(el);\r\n        if (pos(RequiredScripts[j], scr.src) > 0) then\r\n        begin\r\n          found := true;\r\n          break;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if not found then\r\n    begin\r\n      s := RequiredScripts[j];\r\n      inc(FControlScriptCount);\r\n      AddRequiredScript( RequiredBaseURL + RequiredScripts[j]);\r\n    end;\r\n  end;\r\n\r\n  Result := (FControlScriptCount > 0);\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\n\r\nprocedure TControl.AlignControl(AControl: TControl);\r\nvar\r\n  r: TRect;\r\n  cr: TJSDOMRect;\r\n  ovf, ovfx, ovfy: string;\r\n  eh: TJSHTMLElement;\r\n  el: TJSElement;\r\n  frm: TCustomForm;\r\n  ctop: integer;\r\nbegin\r\n  if FIsAligning then\r\n    Exit;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) and frm.IsUpdating then\r\n    Exit;\r\n\r\n  ctop := 0;\r\n\r\n  if Assigned(frm) and (frm.FormContainer <> '') and (AControl is TCustomForm) then\r\n  begin\r\n    el := document.getElementById(frm.FormContainer);\r\n    if Assigned(el) then\r\n    begin\r\n      cr := el.getBoundingClientRect;\r\n      ctop := Round(cr.Top);\r\n    end;\r\n  end;\r\n\r\n  FIsAligning := true;\r\n\r\n  if not Assigned(AControl) then\r\n    Exit;\r\n\r\n  eh := AControl.ElementHandle;\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    ovf := eh.style.getPropertyValue('overflow');\r\n    ovfx := eh.style.getPropertyValue('overflow-x');\r\n    ovfy := eh.style.getPropertyValue('overflow-y');\r\n    eh.style.setProperty('overflow', 'hidden');\r\n  end;\r\n\r\n  r := GetClientRect;\r\n\r\n  if r.Bottom + ctop > window.innerHeight then\r\n    r.Bottom := window.innerHeight - ctop;\r\n\r\n  AlignControls(AControl, r);\r\n\r\n  if Assigned(eh) then\r\n  begin\r\n    eh.style.setProperty('overflow', ovf);\r\n    eh.style.setProperty('overflow-x', ovfx);\r\n    eh.style.setProperty('overflow-y', ovfy);\r\n  end;\r\n\r\n  FIsAligning := false;\r\nend;\r\n\r\nprocedure TControl.DblClick;\r\nbegin\r\n  if Assigned(OnDblClick) then\r\n    OnDblClick(Self);\r\nend;\r\n\r\ndestructor TControl.Destroy;\r\nvar\r\n  i: integer;\r\n  ctrl: TControl;\r\nbegin\r\n  UnbindEvents;\r\n\r\n  for i := ControlCount - 1 downto 0 do\r\n  begin\r\n    ctrl := Controls[i];\r\n    ctrl.Free;\r\n  end;\r\n\r\n  if Assigned(Container) and Assigned(Parent) and Assigned(Parent.Container) then\r\n  begin\r\n    Parent.Container.removeChild(Container);\r\n    Container := nil;\r\n    FControlCreated := False;\r\n  end;\r\n\r\n  FRequiredScripts.Free;\r\n  FMargins.Free;\r\n  FFont.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TControl.DisableTab;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].DisableTab;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DisposeOf;\r\nvar\r\n  t: TControl;\r\nbegin\r\n  t := Self;\r\n  t.Free;\r\nend;\r\n\r\nprocedure TControl.Assign(Source: TPersistent);\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetElement: TJSElement;\r\nbegin\r\n  Result := document.getElementByID(GetID);\r\nend;\r\n\r\nfunction TControl.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  Result := TJSEventTarget(GetElementHandle);\r\nend;\r\n\r\nfunction TControl.GetElementEvent: TJSEvent;\r\nbegin\r\n  Result := FElementEvent;\r\nend;\r\n\r\nprocedure TControl.SetEnabled(Value: Boolean);\r\nbegin\r\n  if (FEnabled <> Value) then\r\n  begin\r\n    FEnabled := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetVisible(AValue: Boolean);\r\nbegin\r\n  if (FVisible <> AValue) then\r\n  begin\r\n    VisibleChanging;\r\n    FVisible := AValue;\r\n    UpdateElement;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidth(AValue: Integer);\r\nbegin\r\n  if (FWidth <> AValue) then\r\n  begin\r\n    FWidth := AValue;\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FWidthPercent <> Value) then\r\n  begin\r\n    FWidthPercent := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetWidthStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FWidthStyle <> Value) then\r\n  begin\r\n    FWidthStyle := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.StopPropagation;\r\nbegin\r\n  if Assigned(ElementEvent) and not EnablePropagation then\r\n    ElementEvent.stopPropagation;\r\nend;\r\n\r\nprocedure TControl.TouchEnd(X, Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.TouchMove(X, Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.TouchStart(X, Y: Integer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.SetHeight(AValue: Integer);\r\nvar\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if FHeight <> AValue then\r\n  begin\r\n    if (Align in [alLeft, alRight, alClient]) and Assigned(ElementHandle) then\r\n    begin\r\n      dr := ElementHandle.getBoundingClientRect;\r\n      if dr.top + AValue >= window.innerHeight then\r\n      begin\r\n        AValue := Round(window.innerHeight - dr.top);\r\n\r\n        if AlignWithMargins then\r\n          AValue := AValue - Margins.Bottom - Margins.Top;\r\n      end;\r\n    end;\r\n\r\n    FHeight := AValue;\r\n\r\n    DoBoundsChange;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightPercent(const Value: TPercentSize);\r\nbegin\r\n  if (FHeightPercent <> Value) then\r\n  begin\r\n    FHeightPercent := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHeightStyle(const Value: TSizeStyle);\r\nbegin\r\n  if (FHeightStyle <> Value) then\r\n  begin\r\n    FHeightStyle := Value;\r\n    UpdateElementSize;\r\n  end;\r\nend;\r\n\r\n(*\r\nprocedure TControl.SetControlPosition(AValue: TControlPosition);\r\nbegin\r\n  if FControlPosition <> AValue then\r\n  begin\r\n    FControlPosition := AValue;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n  end;\r\nend;\r\n*)\r\n\r\nprocedure TControl.SetLeft(AValue: Integer);\r\nbegin\r\n  if FLeft <> AValue then\r\n  begin\r\n    FLeft := AValue;\r\n    if not FUpdateTopLeft then\r\n      FOrigLeft := AValue;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetMargins(const Value: TMargins);\r\nbegin\r\n  FMargins.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.SetTop(AValue: Integer);\r\nbegin\r\n  if FTop <> AValue then\r\n  begin\r\n    FTop := AValue;\r\n    if not FUpdateTopLeft then\r\n      FOrigTop := AValue;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetScriptLoaded(const Value: boolean);\r\nbegin\r\n  FScriptLoaded := Value;\r\nend;\r\n\r\nprocedure TControl.SetShowFocus(const Value: boolean);\r\nbegin\r\n  if (FShowFocus <> Value) then\r\n  begin\r\n    FShowFocus := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetShowHint(AValue: Boolean);\r\nbegin\r\n  if FShowHint <> AValue then\r\n  begin\r\n    FShowHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHint(AValue: string);\r\nbegin\r\n  if FHint <> AValue then\r\n  begin\r\n    FHint := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetID(const Value: string);\r\nbegin\r\n  FID := Value;\r\n  if Assigned(FContainer) then\r\n    FContainer['id'] := Value;\r\nend;\r\n\r\nprocedure TControl.SetTabOrder(AValue: Integer);\r\nbegin\r\n  if FTabOrder <> AValue then\r\n  begin\r\n    FTabOrder := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetTabStop(AValue: Boolean);\r\nbegin\r\n  if FTabStop <> AValue then\r\n  begin\r\n    FTabStop := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.ScreenToClient(const Point: TPoint): TPoint;\r\nvar\r\n  Origin: TPoint;\r\nbegin\r\n  Origin := ClientOrigin;\r\n  Result.X := Point.X - Origin.X;\r\n  Result.Y := Point.Y - Origin.Y;\r\nend;\r\n\r\nprocedure TControl.SendToBack;\r\nbegin\r\n//  if Assigned(ElementHandle) then\r\n//    ElementHandle.style.setProperty('z-index', '-1');\r\nend;\r\n\r\nprocedure TControl.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TControl.Invalidate;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.EndUpdate;\r\nbegin\r\n  if (FUpdateCount > 0) then\r\n  begin\r\n    dec(FUpdateCount);\r\n\r\n    if FUpdateCount = 0 then\r\n      UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsUpdating: boolean;\r\nbegin\r\n  Result := FUpdateCount > 0;\r\nend;\r\n\r\nprocedure TControl.SetAlign(const Value: TAlign);\r\nbegin\r\n  if FAlign <> Value then\r\n  begin\r\n    FAlign := Value;\r\n    DoRealign;  \r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAlignWithMargins(const Value: boolean);\r\nbegin\r\n  if FAlignWithMargins <> Value then\r\n  begin\r\n    FAlignWithMargins := Value;\r\n    DoRealign;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.DoMarginsChanged(Sender: TObject);\r\nbegin\r\n  DoRealign;\r\nend;\r\n\r\nprocedure TControl.DoRealign;\r\nbegin\r\n  if Assigned(Parent) and not Parent.IsUpdating then\r\n  begin\r\n    Parent.AlignControl(Parent);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetAnchors(const Value: TAnchors);\r\nbegin\r\n  if (FAnchors <> Value) then\r\n  begin\r\n    FAnchors := Value;\r\n    UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBorderWidth(const Value: integer);\r\nbegin\r\n  if (FBorderWidth <> Value) then\r\n  begin\r\n    FBorderWidth := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBounds(X, Y, AWidth, AHeight: Integer);\r\nbegin\r\n  if (X <> Left) or (Y <> Top) or (AWidth <> Width) or (AHeight <> Height) then\r\n  begin\r\n    FBlockUpdateElement := True;\r\n    Left := X;\r\n    Top := Y;\r\n    Width := AWidth;\r\n    Height := AHeight;\r\n    Realign;\r\n    FBlockUpdateElement := False;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetBoundsRect(const Value: TRect);\r\nbegin\r\n  SetBounds(Value.Left, Value.Top, Value.Right - Value.Left, Value.Bottom - Value.Top);\r\nend;\r\n\r\nprocedure TControl.SetElementClassName(AValue: string);\r\nbegin\r\n  FElementClassName := AValue;\r\n  if Assigned(FContainer) then\r\n    FContainer['class'] := AValue;\r\nend;\r\n\r\nprocedure TControl.SetElementFont(const Value: TElementFont);\r\nbegin\r\n  if (FElementFont <> Value) then\r\n  begin\r\n    FElementFont := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetElementPosition(const Value: TElementPosition);\r\nbegin\r\n  if (FElementPosition <> Value) then\r\n  begin\r\n    FElementPosition := Value;\r\n    UpdateElementSize;\r\n    RecreateCanvas;\r\n    InternalResize;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetHTMLElementFont(he: TJSHTMLElement; Font: TFont);\r\nvar\r\n  s: string;\r\nbegin\r\n  he.style.setProperty('font-family', Font.Name);\r\n\r\n  he.style.setProperty('font-style', 'normal');\r\n\r\n  if fsBold in Font.Style then\r\n    he.style.setProperty('font-weight', 'bold')\r\n  else\r\n    he.style.setProperty('font-weight', '');\r\n\r\n  if fsItalic in Font.Style then\r\n     he.style.setProperty('font-style', 'italic');\r\n\r\n  s := '';\r\n\r\n  if fsUnderline in Font.Style then\r\n    s := 'underline';\r\n\r\n  if fsStrikeOut in Font.Style then\r\n  begin\r\n    if s <> ''  then\r\n       s := s + ' ';\r\n     s:= s + 'line-through';\r\n  end;\r\n\r\n  if (s <> '') then\r\n    he.style.setProperty('text-decoration', s);\r\n\r\n  he.style.setProperty('font-size', IntToStr(Font.Size) + 'pt');\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TControl.SetFocus;\r\nvar\r\n  e: TJSHTMLElement;\r\nbegin\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    e := ElementHandle;\r\n    asm\r\n      setTimeout(function() {e.focus();}, 1);\r\n    end;\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TControl.SetFont(AValue: TFont);\r\nbegin\r\n  FFont.Name := AValue.Name;\r\n  FFont.Size := AValue.Size;\r\n  FFont.Style := AValue.Style;\r\n  FFont.Color := AValue.Color;\r\nend;\r\n\r\nprocedure TControl.SetColor(AValue: TColor);\r\nbegin\r\n  FColor := AValue;\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure TControl.SetCursor(const Value: TCursor);\r\nbegin\r\n  FCursor := Value;\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.GetID: string;\r\nbegin\r\n  Result := FID;\r\nend;\r\n\r\nfunction TControl.GetIsLinked: boolean;\r\nbegin\r\n  Result := not FNew;\r\nend;\r\n\r\nfunction TControl.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(FContainer) and FControlCreated then\r\n    Result := TJSHTMLElement(FContainer);\r\nend;\r\n\r\nfunction TControl.GetMouseEventButton(Event: TJSMouseEvent): TMouseButton;\r\nbegin\r\n  Result := mbLeft;\r\n  case Event.button of\r\n    0: Result := mbLeft;\r\n    1: Result := mbMiddle;\r\n    2: Result := mbRight;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetMouseEventShiftState(Event: TJSMouseEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetMouseWheelEventShiftState(\r\n  Event: TJSWheelEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetOuterHeight: integer;\r\nbegin\r\n  Result := FHeight - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetOuterWidth: integer;\r\nbegin\r\n  Result := FWidth - FBorderWidth;\r\nend;\r\n\r\nfunction TControl.GetKeyboardEventShiftState(Event: TJSKeyboardEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nprocedure TControl.BindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n\r\n    eh.addEventListener('wheel',@HandleDoWheel);\r\n    eh.addEventListener('click',@HandleDoClick);\r\n    eh.addEventListener('dblclick',@HandleDoDblClick);\r\n    eh.addEventListener('mousedown',@HandleDoMouseDown);\r\n    eh.addEventListener('mouseup',@HandleDoMouseUp);\r\n    eh.addEventListener('mousemove',@HandleDoMouseMove);\r\n    eh.addEventListener('mouseleave',@HandleDoMouseLeave);\r\n    eh.addEventListener('mouseenter',@HandleDoMouseEnter);\r\n    eh.addEventListener('keydown',@HandleDoKeyDown);\r\n    eh.addEventListener('keyup',@HandleDoKeyUp);\r\n    eh.addEventListener('keypress',@HandleDoKeyPress);\r\n    eh.addEventListener('focus',@HandleDoEnter);\r\n    eh.addEventListener('blur',@HandleDoExit);\r\n\r\n    eh.addEventListener('touchstart', @HandleDoTouchStart);\r\n    eh.addEventListener('touchmove', @HandleDoTouchMove);\r\n    eh.addEventListener('touchend', @HandleDoTouchEnd);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.BringToFront;\r\nbegin\r\n//  if Assigned(ElementHandle) then\r\n//    ElementHandle.style.setProperty('z-index', '999999');\r\nend;\r\n\r\nfunction TControl.GetClientOrigin: TPoint;\r\nvar\r\n  r: TJSDomRect;\r\nbegin\r\n  Result := Point(0, 0);\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    r := ElementHandle.getBoundingClientRect;\r\n    Result := Point(Round(r.Left), Round(r.Top));\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetClientRect: TRect;\r\nbegin\r\n  Result := Rect(0, 0, GetWidth, GetHeight);\r\nend;\r\n\r\nfunction TControl.GetKeyCode(AValue: string): Integer;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  i := -1;\r\n\r\n  case AValue of\r\n    'Up': i := 38;\r\n    'Down': i := 40;\r\n    'Left': i := 37;\r\n    'Right': i := 39;\r\n    TJSKeyNames.BackSpace: i := 8;\r\n    TJSKeyNames.Tab: i := 9;\r\n    TJSKeyNames.Enter: i := 13;\r\n    TJSKeyNames.Shift: i := 16;\r\n    TJSKeyNames.Control: i := 17;\r\n    TJSKeyNames.Alt: i := 18;\r\n    TJSKeyNames.Pause: i := 19;\r\n    TJSKeyNames.CapsLock: i := 20;\r\n    TJSKeyNames.Escape: i := 27;\r\n    TJSKeyNames.PageUp: i := 33;\r\n    TJSKeyNames.PageDown: i := 34;\r\n    TJSKeyNames._End: i := 35;\r\n    TJSKeyNames.Home: i := 36;\r\n    TJSKeyNames.ArrowLeft: i := 37;\r\n    TJSKeyNames.ArrowUp: i := 38;\r\n    TJSKeyNames.ArrowRight: i := 39;\r\n    TJSKeyNames.ArrowDown: i := 40;\r\n    TJSKeyNames.Insert: i := 45;\r\n    TJSKeyNames.Delete: i := 46;\r\n\r\n    TJSKeyNames.F1: i := 112;\r\n    TJSKeyNames.F2: i := 113;\r\n    TJSKeyNames.F3: i := 114;\r\n    TJSKeyNames.F4: i := 115;\r\n    TJSKeyNames.F5: i := 116;\r\n    TJSKeyNames.F6: i := 117;\r\n    TJSKeyNames.F7: i := 118;\r\n    TJSKeyNames.F8: i := 119;\r\n    TJSKeyNames.F9: i := 120;\r\n    TJSKeyNames.F10: i := 121;\r\n    TJSKeyNames.F11: i := 122;\r\n    TJSKeyNames.F12: i := 123;\r\n    TJSKeyNames.F13: i := 124;\r\n    TJSKeyNames.F14: i := 125;\r\n    TJSKeyNames.F15: i := 126;\r\n    TJSKeyNames.F16: i := 127;\r\n    TJSKeyNames.F17: i := 128;\r\n    TJSKeyNames.F18: i := 129;\r\n    TJSKeyNames.F19: i := 130;\r\n    TJSKeyNames.F20: i := 131;\r\n    else\r\n      i := Ord(AValue[1]);\r\n  end;\r\n\r\n  Result := i;\r\nend;\r\n\r\nfunction TControl.GetLeft: Integer;\r\nbegin\r\n  Result := FLeft;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetLeft);\r\nend;\r\n\r\nfunction TControl.GetTop: Integer;\r\nbegin\r\n  Result := FTop;\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n    Result := Round(ElementHandle.offsetTop);\r\nend;\r\n\r\nfunction TControl.GetTouchEventShiftState(Event: TJSTouchEvent): TShiftState;\r\nbegin\r\n  Result := [];\r\n  if Event.shiftKey then\r\n    Result := Result + [ssShift];\r\n  if Event.ctrlKey then\r\n    Result := Result + [ssCtrl];\r\n  if Event.altKey then\r\n    Result := Result + [ssAlt];\r\nend;\r\n\r\nfunction TControl.GetWebClassName: string;\r\nbegin\r\n  Result := ClassName;\r\n  Delete(Result, 1, 1);\r\n  Result := 'TWeb' + Result;\r\nend;\r\n\r\nfunction TControl.GetWidth: Integer;\r\nbegin\r\n  Result := FWidth;\r\n\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    Result := Round(ElementHandle.offsetWidth);\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetHeight: Integer;\r\nbegin\r\n  Result := FHeight;\r\n\r\n  if (Result = -1) and Assigned(ElementHandle) and not (csLoading in ComponentState) then\r\n  begin\r\n    Result := Round(ElementHandle.offsetHeight);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.KeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.KeyPress(var Key: Char);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.KeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if (Event.buttons = 0) and Captured and not FMouseInsideLayer then\r\n  begin\r\n    ReleaseCapture;\r\n    HandleDoMouseUp(Event);\r\n    HandleDoMouseLeave(Event);\r\n  end;\r\n  FMouseInsideLayer := True;\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.LayerHandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FMouseInsideLayer := False;\r\n  Result := true;\r\nend;\r\n\r\nprocedure TControl.Loaded;\r\nvar\r\n  i: integer;\r\nbegin\r\n  inherited;\r\n  \r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].Loaded;\r\n\r\n  case Align of\r\n    alClient:\r\n    begin\r\n      if Assigned(Parent) then\r\n        SetBounds(0, 0, Parent.FWidth, Parent.FHeight);\r\n    end;\r\n  end;\r\n\r\n  Resize;\r\n\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.HandleAllocated: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n  Click;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoDblClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n  DblClick;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseDown(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  p: TControl;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  l := Event.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n  t := Event.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n    l := l - p.Left;\r\n    t := t - p.Top;\r\n    p := p.Parent;\r\n  end;\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseDown(mb, ss, Trunc(l), Trunc(t));\r\n  if Assigned(OnMouseDown) then\r\n    OnMouseDown(Self, mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  p: TControl;\r\n  ss: TShiftState;\r\n  mb: TMouseButton;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  l := Event.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n  t := Event.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n    l := l - p.Left;\r\n    t := t - p.Top;\r\n    p := p.Parent;\r\n  end;\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n  mb := GetMouseEventButton(Event);\r\n\r\n  MouseUp(mb, ss, Trunc(l), Trunc(t));\r\n  if Assigned(OnMouseUp) then\r\n    OnMouseUp(Self, mb, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoWheel(Event: TJSWheelEvent): Boolean;\r\nvar\r\n  ss: TShiftState;\r\n  h: Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  ss := GetMouseWheelEventShiftState(Event);\r\n\r\n  h := True;\r\n  MouseWheel(ss, Trunc(-Event.deltay), h);\r\n  if Assigned(OnMouseWheel) then\r\n    OnMouseWheel(Self, ss, Trunc(-Event.deltay), Point(0, 0), h);\r\n  Result := h;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nprocedure TControl.HandleFontChanged(Sender: TObject);\r\nvar\r\n  i: integer;\r\nbegin\r\n  if (FUpdateCount = 0) then\r\n  begin\r\n    ParentFont := false;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n      begin\r\n        if Controls[i].ParentFont then\r\n        begin\r\n          Controls[i].Font.Assign(Font);\r\n          Controls[i].FontChanged;\r\n        end;\r\n      end;\r\n  end;\r\n\r\n  FontChanged;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchStart(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  p: TControl;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n\r\n  StopPropagation;\r\n  if IsFocused then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    l := touch.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    t := touch.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n    p := Parent;\r\n    while Assigned(p) do\r\n    begin\r\n      l := l - p.Left;\r\n      t := t - p.Top;\r\n      p := p.Parent;\r\n    end;\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseDown(mbLeft, ss, Trunc(l), Trunc(t));\r\n      if Assigned(OnMouseDown) then\r\n        OnMouseDown(Self, mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchStart(Trunc(l), Trunc(t));\r\n\r\n    if Assigned(OnTouchStart) then\r\n      OnTouchStart(Self,Trunc(l), Trunc(t));\r\n  end;\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchMove(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  p: TControl;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n\r\n  StopPropagation;\r\n  if IsFocused then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n\r\n    l := touch.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    t := touch.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n    p := Parent;\r\n    while Assigned(p) do\r\n    begin\r\n      l := l - p.Left;\r\n      t := t - p.Top;\r\n      p := p.Parent;\r\n    end;\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseMove(ss, Trunc(l), Trunc(t));\r\n      if Assigned(OnMouseMove) then\r\n        OnMouseMove(Self, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchMove(Trunc(l), Trunc(t));\r\n    if Assigned(OnTouchMove) then\r\n      OnTouchMove(Self,Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nfunction TControl.HandleDoTouchEnd(Event: TJSTouchEvent): Boolean;\r\nvar\r\n  l,t: single;\r\n  touch: TJSTouch;\r\n  p: TControl;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n\r\n  StopPropagation;\r\n  if IsFocused then\r\n    PreventDefault;\r\n\r\n  if Event.Touches.length > 0 then\r\n  begin\r\n    touch := Event.touches.Touches[0];\r\n    l := touch.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n    t := touch.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n    p := Parent;\r\n    while Assigned(p) do\r\n    begin\r\n      l := l - p.Left;\r\n      t := t - p.Top;\r\n      p := p.Parent;\r\n    end;\r\n\r\n    ss := GetTouchEventShiftState(Event);\r\n\r\n    if LinkTouchEvents then\r\n    begin\r\n      MouseUp(mbLeft, ss, Trunc(l), Trunc(t));\r\n      if Assigned(OnMouseUp) then\r\n        OnMouseUp(Self, mbLeft, ss, Trunc(l), Trunc(t));\r\n    end;\r\n\r\n    TouchEnd(Trunc(l), Trunc(t));\r\n    if Assigned(OnTouchEnd) then\r\n      OnTouchEnd(Self,Trunc(l), Trunc(t));\r\n  end;\r\n  FElementEvent := nil;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.DragDrop(Source: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnDragDrop) then\r\n    OnDragDrop(Self, Source, X, Y);\r\nend;\r\n\r\nprocedure TControl.DragOver(Source: TObject; X, Y: Integer;\r\n  State: TDragState; var Accept: Boolean);\r\nbegin\r\n  if Assigned(OnDragOver) then\r\n    OnDragOver(Self, Source, X, Y, State, Accept);\r\nend;\r\n\r\nprocedure TControl.DoBoundsChange;\r\nvar\r\n  b: boolean;\r\n  frm: TCustomForm;\r\nbegin\r\n  UpdateElementSize;\r\n  RecreateCanvas;\r\n\r\n  if FIsResizing then\r\n    Exit;\r\n\r\n  FIsResizing := true;\r\n\r\n  InternalResize;\r\n\r\n  DoRealign;\r\n\r\n  b := false;\r\n\r\n  frm := GetParentForm(Self);\r\n  if Assigned(frm) then\r\n  begin\r\n    b := frm.IsResizing;\r\n    b := b or (TControl(frm).FUpdateCount > 0);\r\n   // b := b or TControl(frm).FIsAligning;\r\n  end;\r\n\r\n  b := b or (FUpdateCount > 0);\r\n\r\n  b := b or FIsAligning;\r\n\r\n  if not b then\r\n    UpdateChildAnchoring;\r\n\r\n  FIsResizing := false;\r\nend;\r\n\r\nprocedure TControl.DoEndDrag(Target: TObject; X, Y: Integer);\r\nbegin\r\n  if Assigned(OnEndDrag) then\r\n    OnEndDrag(Self, Target, X, Y);\r\nend;\r\n\r\nprocedure TControl.DoStartDrag(var DragObject: TDragObject); \r\nbegin\r\n  if Assigned(OnStartDrag) then\r\n    OnStartDrag(Self, DragObject);\r\nend;\r\n\r\nfunction TControl.Focused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\n\r\nprocedure TControl.FontChanged;\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseLeave(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseLeave;\r\n  if Assigned(OnMouseLeave) then\r\n    OnMouseLeave(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseEnter(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  if Captured then\r\n    Exit;\r\n\r\n  Event.stopPropagation;\r\n  DoMouseEnter;\r\n  if Assigned(OnMouseEnter) then\r\n    OnMouseEnter(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TControl.HandleDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  l, t: Single;\r\n  p: TControl;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  l := Event.clientX - Left + document.body.scrollLeft + document.documentElement.scrollLeft;\r\n  t := Event.clientY - Top + document.body.scrollTop + document.documentElement.scrollTop;\r\n\r\n  p := Parent;\r\n  while Assigned(p) do\r\n  begin\r\n    l := l - p.Left;\r\n    t := t - p.Top;\r\n    p := p.Parent;\r\n  end;\r\n\r\n  ss := GetMouseEventShiftState(Event);\r\n\r\n  MouseMove(ss, Trunc(l), Trunc(t));\r\n  if Assigned(OnMouseMove) then\r\n    OnMouseMove(Self, ss, Trunc(l), Trunc(t));\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  k := GetKeyCode(Event.Key);\r\n\r\n  ss := GetKeyboardEventShiftState(Event);\r\n\r\n  KeyDown(k, ss);\r\n  if Assigned(OnKeyDown) then\r\n    OnKeyDown(Self, k, ss);\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyUp(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\n  ss: TShiftState;\r\n  c: Char;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  k := GetKeyCode(Event.Key);\r\n\r\n\r\n  ss := GetKeyboardEventShiftState(Event);\r\n\r\n  // #27 is not send as char in the browser\r\n  if (k = 27) then\r\n  begin\r\n    c := #27;\r\n    if Assigned(OnKeyPress) then\r\n      OnKeyPress(Self, c);\r\n  end;\r\n\r\n  KeyUp(k, ss);\r\n  if Assigned(OnKeyUp) then\r\n    OnKeyUp(Self, k, ss);\r\n  Result := True;\r\n  FelementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoKeyPress(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  c: Char;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  if IsKeyCharacter(Event.Key) then\r\n  begin\r\n    c := Chr(GetKeyCode(Event.Key));\r\n    KeyPress(c);\r\n    if Assigned(OnKeyPress) then\r\n      OnKeyPress(Self, c);\r\n  end;\r\n\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoEnter(Event: TJSFocusEvent): Boolean;\r\nbegin\r\n  FElementEvent := Event;\r\n  StopPropagation;\r\n\r\n  DoEnter;\r\n  if Assigned(OnEnter) then\r\n    OnEnter(Self);\r\n\r\n  Result := True;\r\n  FElementEvent := nil;\r\nend;\r\n\r\nfunction TControl.HandleDoExit(Event: TEventListenerEvent): Boolean;\r\nbegin\r\n  DoExit;\r\n  if Assigned(OnExit) then\r\n    OnExit(Self);\r\n  Result := True;\r\nend;\r\n\r\nprocedure TControl.SetParent(AValue: TControl);\r\nbegin\r\n  if FParent <> AValue then\r\n  begin\r\n    if Assigned(FParent) then\r\n      FParent.UnRegisterParent(Self);\r\n\r\n    FPrevParent := FParent;\r\n    FParent := AValue;\r\n\r\n    if Assigned(FParent) then\r\n      FParent.RegisterParent(Self);\r\n\r\n    UpdateParent;\r\n    UpdateElement;\r\n    InitScript;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.SetParentComponent(Value: TComponent);\r\nbegin\r\n  if (Parent <> Value) and (Value is TControl) then\r\n   SetParent(TControl(Value));\r\nend;\r\n\r\nprocedure TControl.SetRequiredScripts(const Value: TStringList);\r\nbegin\r\n  FRequiredScripts.Assign(Value);\r\nend;\r\n\r\nprocedure TControl.Realign;\r\nbegin\r\n  AlignControl(Self);\r\nend;\r\n\r\nprocedure TControl.RecreateCanvas;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.RecreateElement;\r\nbegin\r\n  if Assigned(Container) then\r\n  begin\r\n    UnbindEvents;\r\n    Container.parentNode.removeChild(Container);\r\n    FElement := nil;\r\n    CreateControl;\r\n    if Assigned(Parent) and Assigned(Parent.Container) then\r\n      Parent.Container.appendChild(Container);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.RegisterParent(AValue: TControl);\r\nbegin\r\n  SetLength(FControls, Length(FControls) + 1);\r\n  FControls[Length(FControls) - 1] := AValue;\r\nend;\r\n\r\nprocedure TControl.ReleaseCapture;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if FCaptured and Assigned(FLayer) then\r\n  begin\r\n    eh := TJSHTMLElement(FLayer);\r\n    eh.removeEventListener('mouseenter',@LayerHandleDoMouseEnter);\r\n    eh.removeEventListener('mouseleave',@LayerHandleDoMouseLeave);\r\n    eh.removeEventListener('mousedown',@HandleDoMouseDown);\r\n    eh.removeEventListener('mouseup',@HandleDoMouseUp);\r\n    eh.removeEventListener('mousemove',@HandleDoMouseMove);\r\n    document.body.removeChild(eh);\r\n    FCaptured := False;\r\n    FLayer := nil;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.Resize;\r\nbegin\r\nend;\r\n\r\nprocedure TControl.InitAnchoring;\r\nvar\r\n  i: integer;\r\nbegin\r\n  FOrigRect := BoundsRect;\r\n\r\n  if Assigned(Parent) then\r\n    FOrigParentRect := Parent.BoundsRect;\r\n\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitAnchoring;\r\nend;\r\n\r\nprocedure TControl.InjectCSS;\r\nvar\r\n  cssname,css: string;\r\n  cssmgr: TCSSCodeManager;\r\nbegin\r\n  cssname := GetWebClassname;\r\n\r\n  css := '';\r\n\r\n  cssmgr := GetCSSManager;\r\n\r\n  if Assigned(cssmgr) then\r\n    css := cssmgr.GetClassCSS(cssname);\r\n\r\n  if (css <> '') then\r\n    AddControlStyle(css);\r\nend;\r\n\r\nprocedure TControl.InternalResize;\r\nbegin\r\n  if csLoading in ComponentState then\r\n    Exit;\r\n\r\n  Resize;\r\nend;\r\n\r\nprocedure TControl.InternalUpdateParent;\r\nvar\r\n  p: TControl;\r\nbegin\r\n  p := FPrevParent;\r\n  if FNew then\r\n  begin\r\n    CreateControl;\r\n\r\n    if Assigned(Container) then\r\n    begin\r\n      if Assigned(Parent) and not Assigned(Parent.Container) then\r\n        Parent.CreateControl;\r\n\r\n      if (Parent <> p) and Assigned(p) and Assigned(p.Container) then\r\n        p.Container.removeChild(Container);\r\n\r\n      if Assigned(Parent) and Assigned(Parent.Container) then\r\n        Parent.Container.appendChild(Container);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.IsFocused: Boolean;\r\nbegin\r\n  Result := FContainer = document.activeElement;\r\nend;\r\n\r\nfunction TControl.IsKeyCharacter(AValue: string): Boolean;\r\nbegin\r\n  case AValue of\r\n    'Up',\r\n    'Down',\r\n    'Left',\r\n    'Right',\r\n    TJSKeyNames.Shift,\r\n    TJSKeyNames.Control,\r\n    TJSKeyNames.Alt,\r\n    TJSKeyNames.Pause,\r\n    TJSKeyNames.CapsLock,\r\n    TJSKeyNames.PageUp,\r\n    TJSKeyNames.PageDown,\r\n    TJSKeyNames._End,\r\n    TJSKeyNames.Home,\r\n    TJSKeyNames.ArrowLeft,\r\n    TJSKeyNames.ArrowUp,\r\n    TJSKeyNames.ArrowRight,\r\n    TJSKeyNames.ArrowDown,\r\n    TJSKeyNames.Insert,\r\n    TJSKeyNames.Delete,\r\n    TJSKeyNames.F1,\r\n    TJSKeyNames.F2,\r\n    TJSKeyNames.F3,\r\n    TJSKeyNames.F4,\r\n    TJSKeyNames.F5,\r\n    TJSKeyNames.F6,\r\n    TJSKeyNames.F7,\r\n    TJSKeyNames.F8,\r\n    TJSKeyNames.F9,\r\n    TJSKeyNames.F10,\r\n    TJSKeyNames.F11,\r\n    TJSKeyNames.F12,\r\n    TJSKeyNames.F13,\r\n    TJSKeyNames.F14,\r\n    TJSKeyNames.F15,\r\n    TJSKeyNames.F16,\r\n    TJSKeyNames.F17,\r\n    TJSKeyNames.F18,\r\n    TJSKeyNames.F19,\r\n    TJSKeyNames.F20: Result := False;\r\n    else\r\n      Result := True;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UnbindEvents;\r\nvar\r\n  eh: TJSEventTarget;\r\nbegin\r\n  if Assigned(ElementBindHandle) then\r\n  begin\r\n    eh := ElementBindHandle;\r\n\r\n    eh.removeEventListener('wheel',@HandleDoWheel);\r\n    eh.removeEventListener('click',@HandleDoClick);\r\n    eh.removeEventListener('dblclick',@HandleDoDblClick);\r\n    eh.removeEventListener('mousedown',@HandleDoMouseDown);\r\n    eh.removeEventListener('mouseup',@HandleDoMouseUp);\r\n    eh.removeEventListener('mousemove',@HandleDoMouseMove);\r\n    eh.removeEventListener('mouseleave',@HandleDoMouseLeave);\r\n    eh.removeEventListener('mouseenter',@HandleDoMouseEnter);\r\n    eh.removeEventListener('keydown',@HandleDoKeyDown);\r\n    eh.removeEventListener('keyup',@HandleDoKeyUp);\r\n    eh.removeEventListener('keypress',@HandleDoKeyPress);\r\n    eh.removeEventListener('focus',@HandleDoEnter);\r\n    eh.removeEventListener('blur',@HandleDoExit);\r\n\r\n    eh.removeEventListener('touchstart', @HandleDoTouchStart);\r\n    eh.removeEventListener('touchmove', @HandleDoTouchMove);\r\n    eh.removeEventListener('touchend', @HandleDoTouchEnd);\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UnRegisterParent(AValue: TControl);\r\nvar\r\n  i: Integer;\r\n  flg: Boolean;\r\nbegin\r\n  flg := false;\r\n\r\n  for i := 0 to Length(FControls) - 1 do\r\n  begin\r\n    if (FControls[i] = AValue) then\r\n    begin\r\n      flg := True;\r\n    end;\r\n\r\n    if (flg) and (i < Length(FControls) - 1) then\r\n      FControls[i] := FControls[i+1];\r\n  end;\r\n\r\n  if flg then\r\n    SetLength(FControls, Length(FControls) - 1);\r\nend;\r\n\r\nprocedure TControl.UpdateAnchoring;\r\nvar\r\n  dxr,dyr: integer;\r\n  dxo,dyo: integer;\r\n  dxw,dyw: integer;\r\n  br,r: TRect;\r\nbegin\r\n  if (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if not FControlCreated then\r\n    Exit;\r\n\r\n  if Align <> alNone then\r\n    Exit;\r\n\r\n  if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n    InitAnchoring;\r\n\r\n  if Assigned(Parent) and not (Self is TForm) then\r\n  begin\r\n    r := Parent.BoundsRect;\r\n\r\n    dxr := (r.Right - r.Left) - (FOrigParentRect.Right - FOrigParentRect.Left);\r\n    dyr := (r.Bottom - r.Top) - (FOrigParentRect.Bottom - FOrigParentRect.Top);\r\n\r\n    br := FOrigRect;\r\n\r\n    dxo := 0;\r\n    dyo := 0;\r\n    dxw := 0;\r\n    dyw := 0;\r\n\r\n    if (akRight in Anchors) then\r\n    begin\r\n      if (akLeft in Anchors) then\r\n        dxw := dxr\r\n      else\r\n        dxo := dxr;\r\n    end;\r\n\r\n    if (akBottom in Anchors) then\r\n    begin\r\n      if (akTop in Anchors) then\r\n        dyw := dyr\r\n      else\r\n        dyo := dyr;\r\n    end;\r\n\r\n    if (akBottom in Anchors) or (akRight in Anchors) then\r\n      SetBounds(br.Left + dxo, br.Top + dyo, br.Right - br.Left + dxw, br.Bottom - br.Top  + dyw);\r\n  end;\r\n\r\n  UpdateChildAnchoring;\r\nend;\r\n\r\nprocedure TControl.UpdateChildAnchoring;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n  begin\r\n    Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateChildren(AControl: TControl);\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  if Assigned(AControl) then\r\n  begin\r\n    AControl.DoRealign;\r\n    if AControl is TCustomControl then\r\n    begin\r\n      (AControl as TCustomControl).RecreateCanvas;\r\n      (AControl as TCustomControl).Invalidate;\r\n    end;\r\n\r\n    for I := 0 to AControl.ControlCount - 1 do\r\n    begin\r\n      c := AControl.Controls[I];\r\n      UpdateChildren(c);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.PersistinHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].PersistinHTML;\r\nend;\r\n\r\nprocedure TControl.InitFromHTML;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to ControlCount - 1 do\r\n    Controls[i].InitFromHTML;\r\nend;\r\n\r\nprocedure TControl.InitScript;\r\nbegin\r\n  // script to initialize any javascript control\r\nend;\r\n\r\nprocedure TControl.PreventDefault;\r\nbegin\r\n  if Assigned(ElementEvent) then\r\n    ElementEvent.preventDefault;\r\nend;\r\n\r\nprocedure TControl.UpdateElement;\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) and not IsUpdating then\r\n  begin\r\n    if not IsLinked then\r\n      UpdateElementVisual;\r\n\r\n    UpdateElementData;\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementData;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  eh := ElementHandle;\r\n\r\n  if Visible then\r\n    eh.style.setProperty('visibility', '')\r\n  else\r\n    eh.style.setProperty('visibility', 'hidden');\r\n\r\n  if TabStop then\r\n    FContainer['tabindex'] := IntToStr(TabOrder + 1)\r\n  else\r\n    FContainer['tabindex'] := '';\r\n\r\n  if Enabled then\r\n    FContainer.removeAttribute('disabled')\r\n  else\r\n    FContainer.setAttribute('disabled','disabled');\r\n\r\n\r\n  if ShowHint and (Hint <> '') then\r\n     FContainer['title'] := Hint\r\n  else\r\n     FContainer['title'] := '';\r\nend;\r\n\r\nprocedure TControl.UpdateElementSize;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if FBlockUpdateElement or (FUpdateCount > 0) then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) and (ElementHandle <> ContainerElement) then\r\n  begin\r\n    eh := ElementHandle;\r\n\r\n    if (ElementPosition = epAbsolute) then\r\n    begin\r\n      if FTop <> -1 then\r\n        eh.style.setProperty('top', IntToStr(FTop) + 'px')\r\n      else\r\n        eh.style.setProperty('top', '');\r\n\r\n      if FLeft <> -1 then\r\n        eh.style.setProperty('left', IntToStr(FLeft) + 'px')\r\n      else\r\n        eh.style.setProperty('left', '');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAbsolute) then\r\n    begin\r\n      if FWidth <> -1 then\r\n        eh.style.setProperty('width', IntToStr(GetOuterWidth) + 'px')\r\n      else\r\n        eh.style.setProperty('width', '');\r\n    end;\r\n\r\n    if (FWidthStyle = ssAuto) then\r\n    begin\r\n      eh.style.setProperty('width', '');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAbsolute) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        eh.style.setProperty('height', IntToStr(GetOuterHeight) + 'px')\r\n      else\r\n        eh.style.setProperty('height', '');\r\n    end;\r\n\r\n    if (FHeightStyle = ssAuto) then\r\n    begin\r\n      eh.style.setProperty('height', '');\r\n    end;\r\n\r\n    if (FWidthStyle = ssPercent) then\r\n    begin\r\n      if FWidth <> -1 then\r\n        eh.style.setProperty('width', IntToStr(FWidthPercent) + '%')\r\n      else\r\n        eh.style.setProperty('width', '');\r\n    end;\r\n\r\n    if (FHeightStyle = ssPercent) then\r\n    begin\r\n      if FHeight <> -1 then\r\n        eh.style.setProperty('height', IntToStr(FHeightPercent) + '%')\r\n      else\r\n        eh.style.setProperty('height', '');\r\n    end;\r\n\r\n    if FElementPosition = epAbsolute then\r\n      eh.style.setProperty('position', 'absolute')\r\n    else if FElementPosition = epRelative then\r\n      eh.style.setProperty('position', 'relative')\r\n    else\r\n      eh.style.setProperty('position', '');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateElementVisual;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  eh := ElementHandle;\r\n\r\n  if ParentFont and Assigned(Parent) then\r\n    Font.Assign(Parent.Font);\r\n\r\n  eh.style.setProperty('overflow', 'hidden');\r\n\r\n  case Cursor of\r\n    crDefault: eh.style.setProperty('cursor', 'default');\r\n    crArrow: eh.style.setProperty('cursor', 'auto');\r\n    crNone: eh.style.setProperty('cursor', 'none');\r\n    crCross: eh.style.setProperty('cursor', 'crosshair');\r\n    crIBeam: eh.style.setProperty('cursor', 'text');\r\n    crSizeNESW: eh.style.setProperty('cursor', 'nesw-resize');\r\n    crSizeNS: eh.style.setProperty('cursor', 'ns-resize');\r\n    crSizeNWSE: eh.style.setProperty('cursor', 'nwse-resize');\r\n    crSizeWE: eh.style.setProperty('cursor', 'ew-resize');\r\n    crUpArrow: eh.style.setProperty('cursor', '');\r\n    crHourGlass: eh.style.setProperty('cursor', 'wait');\r\n    crDrag: eh.style.setProperty('cursor', '');\r\n    crNoDrop: eh.style.setProperty('cursor', 'no-drop');\r\n    crHSplit: eh.style.setProperty('cursor', 'col-resize');\r\n    crVSplit: eh.style.setProperty('cursor', 'row-resize');\r\n    crMultIDrag: eh.style.setProperty('cursor', '');\r\n    crSQLWait: eh.style.setProperty('cursor', 'progress');\r\n    crNo: eh.style.setProperty('cursor', 'not-allowed');\r\n    crAppStart: eh.style.setProperty('cursor', 'wait');\r\n    crHelp: eh.style.setProperty('cursor', 'help');\r\n    crHandPoint: eh.style.setProperty('cursor', 'pointer');\r\n    crSizeAll: eh.style.setProperty('cursor', 'move');\r\n  end;\r\n\r\n  if Captured then\r\n    TJSHTMLElement(FLayer).style.setProperty('cursor', eh.style.getPropertyValue('cursor'));\r\n\r\n  if (ElementClassName <> '') or CanShowFocus then\r\n    eh.style.setProperty('outline', '')\r\n  else\r\n    eh.style.setProperty('outline', 'none');\r\n\r\n  UpdateElementSize;\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n\r\n  if (ElementClassName = '') and (ElementFont = efProperty) then\r\n  begin\r\n    if Enabled then\r\n      eh.style.setProperty('color', ColorToHtml(Font.Color));\r\n\r\n    SetHTMLElementFont(eh, Font);\r\n  end\r\n  else\r\n  begin\r\n    eh.style.setProperty('color', '');\r\n    eh.style.setProperty('font-family', '');\r\n    eh.style.setProperty('font-style', '');\r\n    eh.style.setProperty('font-size', '');\r\n  end;\r\nend;\r\n\r\nprocedure TControl.UpdateParent;\r\nbegin\r\n  InternalUpdateParent;\r\n  if (csLoading in ComponentState) and Assigned(Parent) and not (csLoading in Parent.ComponentState) then\r\n    Loaded;\r\n  UpdateChildren(FPrevParent);\r\n  UpdateChildren(Parent);\r\nend;\r\n\r\nprocedure TControl.VisibleChanging;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TControl.GetBoundsRect: TRect;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Right := Left + Width;\r\n  Result.Bottom := Top + Height;\r\nend;\r\n\r\nfunction TControl.GetControlsCount: Integer;\r\nbegin\r\n  Result := Length(FControls);\r\nend;\r\n\r\nfunction TControl.GetCSSManager: TCSSCodeManager;\r\nvar\r\n  frm: TCustomForm;\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n\r\n  frm := GetParentForm(Self);\r\n\r\n  if Assigned(frm) then\r\n  begin\r\n    for i := 0 to frm.ComponentCount - 1 do\r\n    begin\r\n      if frm.Components[i] is TCSSCodeManager then\r\n      begin\r\n        Result := frm.Components[i] as TCSSCodeManager;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TControl.GetControls(Index: Integer): TControl;\r\nbegin\r\n  Result := FControls[Index];\r\nend;\r\n\r\nprocedure TControl.DoEnter;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TControl.DoExit;\r\nbegin\r\n\r\nend;\r\n\r\n{ TCustomControl }\r\n\r\nprocedure TCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FBorderStyle := bsSingle;\r\n  FBorderColor := clSilver;\r\n  FPainting := false;\r\n  FWidth := 100;\r\n  FHeight := 25;\r\n  FWidthPercent := 100;\r\n  FHeightPercent := 100;\r\n  FCustomBorder := false;\r\nend;\r\n\r\nprocedure TCustomControl.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n//  document.body.addEventListener('touchstart', @BlockDocumentTouch);\r\n//  document.body.addEventListener('touchmove', @BlockDocumentTouch);\r\n//  document.body.addEventListener('touchend', @BlockDocumentTouch);\r\nend;\r\n\r\nprocedure TCustomControl.BlockDocumentTouch(Event: TJSTouchEvent);\r\nbegin\r\n//  if (Event.target = FElementCanvas) then\r\n//    Event.preventDefault();\r\nend;\r\n\r\nprocedure TCustomControl.CreateControl;\r\nbegin\r\n  inherited;\r\n  RecreateCanvas;\r\nend;\r\n\r\nfunction TCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  FElementCanvas := TJSHTMLCanvasElement(document.createElement('CANVAS'));\r\n  if csAcceptsControls in ControlStyle then\r\n  begin\r\n    Result := document.createElement('SPAN');\r\n    Result.appendChild(FElementCanvas);\r\n    FElementCanvas['id'] := ElementID + '_Canvas';\r\n    FElementCanvas['zindex'] := '-1';\r\n  end\r\n  else\r\n    Result := FElementCanvas;\r\nend;\r\n\r\ndestructor TCustomControl.Destroy;\r\nbegin\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvas: TCanvas;\r\nbegin\r\n  if not Assigned(FCanvas) then\r\n    CreateControl;\r\n  Result := FCanvas;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasHeightOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetCanvasWidthOffset: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction TCustomControl.GetPixelRatio: Single;\r\nvar\r\n  res: single;\r\nbegin\r\n  asm\r\n    var ctx = document.createElement(\"canvas\").getContext(\"2d\"),\r\n        dpr = window.devicePixelRatio || 1,\r\n        bsr = ctx.webkitBackingStorePixelRatio ||\r\n              ctx.mozBackingStorePixelRatio ||\r\n              ctx.msBackingStorePixelRatio ||\r\n              ctx.oBackingStorePixelRatio ||\r\n              ctx.backingStorePixelRatio || 1;\r\n    res = dpr / bsr\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure TCustomControl.Invalidate;\r\nvar\r\n  px: Single;\r\nbegin\r\n  inherited;\r\n  if Parent = nil then\r\n    Exit;\r\n\r\n  px := GetPixelRatio;\r\n  if (px <> FPixelRatio) then\r\n    RecreateCanvas;\r\n\r\n  FPixelRatio := GetPixelRatio;\r\n\r\n  FPainting := true;\r\n\r\n  if Assigned(FCanvas) then\r\n    FCanvas.Clear;\r\n\r\n  Paint;\r\n  FPainting := false;\r\nend;\r\n\r\nprocedure TCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nfunction TCustomControl.MakeScreenShot: TBitmap;\r\nbegin\r\n  Result := TBitmap.Create;\r\n  Result.LoadFromCanvas(Canvas);\r\nend;\r\n\r\nprocedure TCustomControl.Paint;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomControl.RecreateCanvas;\r\nvar\r\n  px: Single;\r\n  el: TJSHTMLCanvasElement;\r\n  h, w: Integer;\r\nbegin\r\n  if Assigned(FElementCanvas) then\r\n  begin\r\n    if not FPainting then\r\n    begin\r\n      el := TJSHTMLCanvasElement(document.getElementByID(GetID+'_Canvas'));\r\n\r\n      // it is already found\r\n      if Assigned(el) then\r\n      begin\r\n        FElementCanvas := el;\r\n        FCanvas.Free;\r\n        FCanvas := nil;\r\n      end;\r\n\r\n      px := GetPixelRatio;\r\n      h := Height - GetCanvasHeightOffset;\r\n      w := Width - GetCanvasWidthOffset;\r\n\r\n      FElementCanvas.style.setProperty('height', IntToStr(h) + 'px');\r\n      FElementCanvas.style.setProperty('width', IntToStr(w) + 'px');\r\n      FElementCanvas.height := Round(h * px);\r\n      FElementCanvas.width := Round(w * px);\r\n\r\n      FElementCanvas.getContextAs2DContext('2d').scale(px, px);\r\n    end;\r\n\r\n    if not Assigned(FCanvas) then\r\n      FCanvas := TCanvas.Create(FElementCanvas);\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.Resize;\r\nbegin\r\n  inherited;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderColor(AValue: TColor);\r\nbegin\r\n  if (FBorderColor <> AValue) then\r\n  begin\r\n    FBorderColor := AValue;\r\n    UpdateElement;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TCustomControl.SetBorderStyle(AValue: TBorderStyle);\r\nbegin\r\n  if FBorderStyle <> AValue then\r\n  begin\r\n    FBorderStyle := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomControl.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if BorderStyle = bsSingle then // default border style\r\n    begin\r\n      if CustomBorder then\r\n      begin\r\n        ElementHandle.style.setProperty('border-style', 'solid');\r\n        ElementHandle.style.setProperty('border-width', '1px');\r\n        ElementHandle.style.setProperty('border-color', ColorToHTML(BorderColor));\r\n      end\r\n      else\r\n        ElementHandle.style.setProperty('border-style', '')\r\n    end\r\n    else\r\n      ElementHandle.style.setProperty('border-style', 'none');\r\n  end;\r\nend;\r\n\r\n{ TScrollingGraphicControl }\r\n\r\nprocedure TScrollingGraphicControl.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\nend;\r\n\r\n\r\nfunction TScrollingGraphicControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TMargins }\r\n\r\nconstructor TMargins.Create;\r\nbegin\r\n  FLeft := 3;\r\n  FTop := 3;\r\n  FBottom := 3;\r\n  FRight := 3;\r\nend;\r\n\r\n{ TControlManager }\r\n\r\nconstructor TControlManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FInstanceCount := 0;\r\nend;\r\n\r\nfunction TControlManager.GetInstanceNumber: integer;\r\nbegin\r\n  Inc(FInstanceCount);\r\n  Result := FInstanceCount;\r\nend;\r\n\r\nprocedure TControlManager.Reset;\r\nbegin\r\n  FInstanceCount := 0;\r\nend;\r\n\r\n{ TCSSCodeFragment }\r\n\r\nconstructor TCSSCodeFragment.Create(Collection: TCollection);\r\nbegin\r\n  inherited;\r\n  FCSS := TStringList.Create;\r\nend;\r\n\r\ndestructor TCSSCodeFragment.Destroy;\r\nbegin\r\n  FCSS.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TCSSCodeFragment.SetCSS(const Value: TStringList);\r\nbegin\r\n  FCSS.Assign(Value);\r\nend;\r\n\r\n{ TCSSCodeFragments }\r\n\r\nfunction TCSSCodeFragments.Add: TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Add);\r\nend;\r\n\r\nconstructor TCSSCodeFragments.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TCSSCodeFragment);\r\nend;\r\n\r\nfunction TCSSCodeFragments.GetItemEx(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Items[Index]);\r\nend;\r\n\r\nfunction TCSSCodeFragments.Insert(Index: integer): TCSSCodeFragment;\r\nbegin\r\n  Result := TCSSCodeFragment(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TCSSCodeFragments.SetItemEx(Index: integer;\r\n  const Value: TCSSCodeFragment);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TCSSCodeManager }\r\n\r\nconstructor TCSSCodeManager.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FCSSFragments := TCSSCodeFragments.Create(Self);\r\nend;\r\n\r\ndestructor TCSSCodeManager.Destroy;\r\nbegin\r\n  FCSSFragments.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassCSS(AClassname: string): string;\r\nvar\r\n  CSSCodeFragment: TCSSCodeFragment;\r\nbegin\r\n  Result := '';\r\n\r\n  CSSCodeFragment := GetClassFragment(AClassName);\r\n\r\n  if Assigned(CSSCodeFragment) then\r\n    Result := CSSCodeFragment.CSS.Text;\r\nend;\r\n\r\nfunction TCSSCodeManager.GetClassFragment(AClassname: string): TCSSCodeFragment;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n  for i := 0 to CSSFragments.Count - 1 do\r\n  begin\r\n    if CSSFragments.Items[i].ControlClassName = AClassname then\r\n      Result := CSSFragments.Items[i];\r\n  end;\r\nend;\r\n\r\nprocedure TCSSCodeManager.SetCSSFragments(const Value: TCSSCodeFragments);\r\nbegin\r\n  FCSSFragments.Assign(Value);\r\nend;\r\n\r\n{ TjQueryCustomContol }\r\n\r\nfunction TjQueryCustomControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\nprocedure TjQueryCustomControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FIsInitialized := false;\r\nend;\r\n\r\nfunction TjQueryCustomControl.GetJQID: string;\r\nbegin\r\n  Result := '#' + GetID;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQuery;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TjQueryCustomControl.InitJQueryOnce;\r\nbegin\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if FIsInitialized then\r\n    Exit;\r\n\r\n  FIsInitialized := true;\r\n  InitJQuery;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.Loaded;\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\nprocedure TjQueryCustomControl.SetParent(AValue: TControl);\r\nbegin\r\n  inherited;\r\n  InitJQueryOnce;\r\nend;\r\n\r\ninitialization\r\n  ControlManager := TControlManager.Create(nil);\r\n\r\nend.\r\n","unit WEBLib.Lang;\r\n\r\ninterface\r\n\r\ntype\r\n\r\n  TUILanguage = (\r\n        lNone,\r\n        lAfar,\r\n        lAbkhazian,\r\n        lAvestan,\r\n        lAfrikaans,\r\n        lAkan,\r\n        lAmharic,\r\n        lAragonese,\r\n        lArabic,\r\n        lAssamese,\r\n        lAvaric,\r\n        lAymara,\r\n        lAzerbaijani,\r\n        lBashkir,\r\n        lBelarusian,\r\n        lBulgarian,\r\n        lBihari,\r\n        lBislama,\r\n        lBambara,\r\n        lBengali,\r\n        lTibetan,\r\n        lBreton,\r\n        lBosnian,\r\n        lCatalan,\r\n        lChechen,\r\n        lChamorro,\r\n        lCorsican,\r\n        lCree,\r\n        lCzech,\r\n        lOldSlavic,\r\n        lChuvash,\r\n        lWelsh,\r\n        lDanish,\r\n        lGerman,\r\n        lDivehi,\r\n        lDzongkha,\r\n        lEwe,\r\n        lEnglish,\r\n        lEsperanto,\r\n        lSpanish,\r\n        lEstonian,\r\n        lBasque,\r\n        lPersian,\r\n        lFulah,\r\n        lFinnish,\r\n        lFijian,\r\n        lFaroese,\r\n        lFrench,\r\n        lWesternFrisian,\r\n        lIrish,\r\n        lGaelic,\r\n        lGalician,\r\n        lGuarani,\r\n        lGujarati,\r\n        lManx,\r\n        lHausa,\r\n        lHebrew,\r\n        lHindi,\r\n        lHiriMotu,\r\n        lCroatian,\r\n        lHaitian,\r\n        lHungarian,\r\n        lArmenian,\r\n        lHerero,\r\n        lInterlingua,\r\n        lIndonesian,\r\n        lInterlingue,\r\n        lIgbo,\r\n        lSichuanYi,\r\n        lInupiaq,\r\n        lIdo,\r\n        lIcelandic,\r\n        lItalian,\r\n        lInuktitut,\r\n        lJapanese,\r\n        lJavanese,\r\n        lGeorgian,\r\n        lKongo,\r\n        lKikuyu,\r\n        lKuanyama,\r\n        lKazakh,\r\n        lKalaallisut,\r\n        lCentralKhmer,\r\n        lKannada,\r\n        lKorean,\r\n        lKanuri,\r\n        lKashmiri,\r\n        lKurdish,\r\n        lKomi,\r\n        lCornish,\r\n        lKirghiz,\r\n        lLatin,\r\n        lLuxembourgish,\r\n        lGanda,\r\n        lLimburgan,\r\n        lLingala,\r\n        lLao,\r\n        lLithuanian,\r\n        lLubaKatanga,\r\n        lLatvian,\r\n        lMalagasy,\r\n        lMarshallese,\r\n        lMaori,\r\n        lMacedonian,\r\n        lMalayalam,\r\n        lMongolian,\r\n        lMarathi,\r\n        lMalay,\r\n        lMaltese,\r\n        lBurmese,\r\n        lNauru,\r\n        lNdebele,\r\n        lNepali,\r\n        lNdonga,\r\n        lDutch,\r\n        lNorwegian,\r\n        lNavajo,\r\n        lChichewa,\r\n        lOccitan,\r\n        lOjibwa,\r\n        lOromo,\r\n        lOriya,\r\n        lOssetian,\r\n        lPanjabi,\r\n        lPali,\r\n        lPolish,\r\n        lPushto,\r\n        lPortuguese,\r\n        lQuechua,\r\n        lRomansh,\r\n        lRundi,\r\n        lRomanian,\r\n        lRussian,\r\n        lKinyarwanda,\r\n        lSanskrit,\r\n        lSardinian,\r\n        lSindhi,\r\n        lNorthernSami,\r\n        lSango,\r\n        lSinhala,\r\n        lSlovak,\r\n        lSlovenian,\r\n        lSamoan,\r\n        lShona,\r\n        lSomali,\r\n        lAlbanian,\r\n        lSerbian,\r\n        lSwati,\r\n        lSotho,\r\n        lSundanese,\r\n        lSwedish,\r\n        lSwahili,\r\n        lTamil,\r\n        lTelugu,\r\n        lTajik,\r\n        lThai,\r\n        lTigrinya,\r\n        lTurkmen,\r\n        lTagalog,\r\n        lTswana,\r\n        lTonga,\r\n        lTurkish,\r\n        lTsonga,\r\n        lTatar,\r\n        lTwi,\r\n        lTahitian,\r\n        lUighur,\r\n        lUkrainian,\r\n        lUrdu,\r\n        lUzbek,\r\n        lVenda,\r\n        lVietnamese,\r\n        lWalloon,\r\n        lWolof,\r\n        lXhosa,\r\n        lYiddish,\r\n        lYoruba,\r\n        lZhuang,\r\n        lChinese,\r\n        lZulu);\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\n\r\nimplementation\r\n\r\nfunction GetLanguageISO639_1Code(ALang: TUILanguage): string;\r\nbegin\r\n  case ALang of\r\n    lNone: Result := '';\r\n    lAfar: Result := 'aa';\r\n    lAbkhazian: Result := 'ab';\r\n    lAvestan: Result := 'ae';\r\n    lAfrikaans: Result := 'af';\r\n    lAkan: Result := 'ak';\r\n    lAmharic: Result := 'am';\r\n    lAragonese: Result := 'an';\r\n    lArabic: Result := 'ar';\r\n    lAssamese: Result := 'as';\r\n    lAvaric: Result := 'av';\r\n    lAymara: Result := 'ay';\r\n    lAzerbaijani: Result := 'az';\r\n    lBashkir: Result := 'ba';\r\n    lBelarusian: Result := 'be';\r\n    lBulgarian: Result := 'bg';\r\n    lBihari: Result := 'bh';\r\n    lBislama: Result := 'bi';\r\n    lBambara: Result := 'bm';\r\n    lBengali: Result := 'bn';\r\n    lTibetan: Result := 'bo';\r\n    lBreton: Result := 'br';\r\n    lBosnian: Result := 'bd';\r\n    lCatalan: Result := 'ca';\r\n    lChechen: Result := 'ce';\r\n    lChamorro: Result := 'ch';\r\n    lCorsican: Result := 'co';\r\n    lCree: Result := 'cr';\r\n    lCzech: Result := 'cs';\r\n    lOldSlavic: Result := 'cu';\r\n    lChuvash: Result := 'cv';\r\n    lWelsh: Result := 'cy';\r\n    lDanish: Result := 'da';\r\n    lGerman: Result := 'de';\r\n    lDivehi: Result := 'dv';\r\n    lDzongkha: Result := 'dz';\r\n    lEwe: Result := 'ee';\r\n    lEnglish: Result := 'en';\r\n    lEsperanto: Result := 'eo';\r\n    lSpanish: Result := 'es';\r\n    lEstonian: Result := 'et';\r\n    lBasque: Result := 'eu';\r\n    lPersian: Result := 'fa';\r\n    lFulah: Result := 'ff';\r\n    lFinnish: Result := 'fi';\r\n    lFijian: Result := 'fj';\r\n    lFaroese: Result := 'fo';\r\n    lFrench: Result := 'fr';\r\n    lWesternFrisian: Result := 'fy';\r\n    lIrish: Result := 'ga';\r\n    lGaelic: Result := 'gd';\r\n    lGalician: Result := 'gl';\r\n    lGuarani: Result := 'gn';\r\n    lGujarati: Result := 'gu';\r\n    lManx: Result := 'gv';\r\n    lHausa: Result := 'ha';\r\n    lHebrew: Result := 'he';\r\n    lHindi: Result := 'hi';\r\n    lHiriMotu: Result := 'ho';\r\n    lCroatian: Result := 'hr';\r\n    lHaitian: Result := 'ht';\r\n    lHungarian: Result := 'hu';\r\n    lArmenian: Result := 'hy';\r\n    lHerero: Result := 'hz';\r\n    lInterlingua: Result := 'ia';\r\n    lIndonesian: Result := 'id';\r\n    lInterlingue: Result := 'ie';\r\n    lIgbo: Result := 'ig';\r\n    lSichuanYi: Result := 'ii';\r\n    lInupiaq: Result := 'ik';\r\n    lIdo: Result := 'id';\r\n    lIcelandic: Result := 'is';\r\n    lItalian: Result := 'it';\r\n    lInuktitut: Result := 'iu';\r\n    lJapanese: Result := 'ja';\r\n    lJavanese: Result := 'jv';\r\n    lGeorgian: Result := 'ka';\r\n    lKongo: Result := 'kg';\r\n    lKikuyu: Result := 'ki';\r\n    lKuanyama: Result := 'kj';\r\n    lKazakh: Result := 'kk';\r\n    lKalaallisut: Result := 'kl';\r\n    lCentralKhmer: Result := 'km';\r\n    lKannada: Result := 'kn';\r\n    lKorean: Result := 'ko';\r\n    lKanuri: Result := 'kr';\r\n    lKashmiri: Result := 'ks';\r\n    lKurdish: Result := 'ku';\r\n    lKomi: Result := 'kv';\r\n    lCornish: Result := 'kw';\r\n    lKirghiz: Result := 'ky';\r\n    lLatin: Result := 'la';\r\n    lLuxembourgish: Result := 'lb';\r\n    lGanda: Result := 'lg';\r\n    lLimburgan: Result := 'li';\r\n    lLingala: Result := 'ln';\r\n    lLao: Result := 'lo';\r\n    lLithuanian: Result := 'lt';\r\n    lLubaKatanga: Result := 'lu';\r\n    lLatvian: Result := 'lv';\r\n    lMalagasy: Result := 'mg';\r\n    lMarshallese: Result := 'mh';\r\n    lMaori: Result := 'mi';\r\n    lMacedonian: Result := 'mk';\r\n    lMalayalam: Result := 'ml';\r\n    lMongolian: Result := 'mn';\r\n    lMarathi: Result := 'mr';\r\n    lMalay: Result := 'ms';\r\n    lMaltese: Result := 'mt';\r\n    lBurmese: Result := 'my';\r\n    lNauru: Result := 'na';\r\n    lNdebele: Result := 'nb';\r\n    lNepali: Result := 'nd';\r\n    lNdonga: Result := 'ng';\r\n    lDutch: Result := 'nl';\r\n    lNorwegian: Result := 'no';\r\n    lNavajo: Result := 'nv';\r\n    lChichewa: Result := 'ny';\r\n    lOccitan: Result := 'oc';\r\n    lOjibwa: Result := 'oj';\r\n    lOromo: Result := 'om';\r\n    lOriya: Result := 'or';\r\n    lOssetian: Result := 'os';\r\n    lPanjabi: Result := 'pa';\r\n    lPali: Result := 'pi';\r\n    lPolish: Result := 'pl';\r\n    lPushto: Result := 'ps';\r\n    lPortuguese: Result := 'pt';\r\n    lQuechua: Result := 'qu';\r\n    lRomansh: Result := 'rm';\r\n    lRundi: Result := 'rn';\r\n    lRomanian: Result := 'ro';\r\n    lRussian: Result := 'ru';\r\n    lKinyarwanda: Result := 'rw';\r\n    lSanskrit: Result := 'sa';\r\n    lSardinian: Result := 'sc';\r\n    lSindhi: Result := 'sd';\r\n    lNorthernSami: Result := 'se';\r\n    lSango: Result := 'sg';\r\n    lSinhala: Result := 'si';\r\n    lSlovak: Result := 'sk';\r\n    lSlovenian: Result := 'sl';\r\n    lSamoan: Result := 'sm';\r\n    lShona: Result := 'sn';\r\n    lSomali: Result := 'so';\r\n    lAlbanian: Result := 'sq';\r\n    lSerbian: Result := 'sr';\r\n    lSwati: Result := 'ss';\r\n    lSotho: Result := 'st';\r\n    lSundanese: Result := 'su';\r\n    lSwedish: Result := 'sv';\r\n    lSwahili: Result := 'sw';\r\n    lTamil: Result := 'ta';\r\n    lTelugu: Result := 'te';\r\n    lTajik: Result := 'tg';\r\n    lThai: Result := 'th';\r\n    lTigrinya: Result := 'ti';\r\n    lTurkmen: Result := 'tk';\r\n    lTagalog: Result := 'tl';\r\n    lTswana: Result := 'tn';\r\n    lTonga: Result := 'to';\r\n    lTurkish: Result := 'tr';\r\n    lTsonga: Result := 'ts';\r\n    lTatar: Result := 'tt';\r\n    lTwi: Result := 'tw';\r\n    lTahitian: Result := 'ty';\r\n    lUighur: Result := 'ug';\r\n    lUkrainian: Result := 'uk';\r\n    lUrdu: Result := 'ur';\r\n    lUzbek: Result := 'uz';\r\n    lVenda: Result := 've';\r\n    lVietnamese: Result := 'vi';\r\n    lWalloon: Result := 'wa';\r\n    lWolof: Result := 'wo';\r\n    lXhosa: Result := 'xh';\r\n    lYiddish: Result := 'yi';\r\n    lYoruba: Result := 'yo';\r\n    lZhuang: Result := 'za';\r\n    lChinese: Result := 'zh';\r\n    lZulu: Result := 'zu';\r\n  end;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.ExtCtrls;\r\n\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, Types, WEBLib.Controls, WEBLib.StdCtrls, WEBLib.Graphics,\r\n  Web;\r\n\r\ntype\r\n  TCustomLinkLabel = class(TCustomLabel)\r\n  private\r\n    FDisplText: string;\r\n    FCaption: string;\r\n    FOnLinkClick: TLinkClickEvent;\r\n    FWidthStyle: TSizeStyle;\r\n    FHeightPercent: TPercentSize;\r\n    FHeightStyle: TSizeStyle;\r\n    FWidthPercent: TPercentSize;\r\n    procedure SetHeightPercent(const Value: TPercentSize); reintroduce;\r\n    procedure SetHeightStyle(const Value: TSizeStyle); reintroduce;\r\n    procedure SetWidthPercent(const Value: TPercentSize); reintroduce;\r\n    procedure SetWidthStyle(const Value: TSizeStyle); reintroduce;\r\n  protected\r\n    function GetOuterWidth: integer; override;\r\n    function GetOuterHeight: integer; override;\r\n    function GetDisplayText: string; override;\r\n\r\n    procedure SetCaption(AValue: string); override;\r\n    procedure BindEvents; override;\r\n    function DoLinkClick(Event: TJSMouseEvent): boolean;\r\n    property Caption;\r\n  public\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n  published\r\n    property Align;\r\n    property Alignment;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property Color;\r\n    property EllipsisPosition;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Font;\r\n    property Height;\r\n    property Hint;\r\n    property Layout;\r\n    property Left;\r\n    property Margins;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property WordWrap;\r\n\r\n    property HeightStyle: TSizeStyle read FHeightStyle write SetHeightStyle default ssAbsolute;\r\n    property WidthStyle: TSizeStyle read FWidthStyle write SetWidthStyle default ssAbsolute;\r\n    property HeightPercent: TPercentSize read FHeightPercent write SetHeightPercent default 100;\r\n    property WidthPercent: TPercentSize read FWidthPercent write SetWidthPercent default 100;\r\n\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnLinkClick: TLinkClickEvent read FOnLinkClick write FOnLinkClick;\r\n  end;\r\n\r\n  TLinkLabel = class(TCustomLinkLabel)\r\n  published\r\n    property Caption;\r\n  end;\r\n\r\n  TWebLinkLabel = class(TLinkLabel);\r\n\r\n  TTrackBar = class(TCustomInput)\r\n  private\r\n    FMax: integer;\r\n    FMin: integer;\r\n    FPosition: integer;\r\n    FOnChange: TNotifyEvent;\r\n  protected\r\n    function GetElementInputHandle: TJSHTMLInputElement;\r\n    function GetInputType: string; override;\r\n    function DoHandleChange(Event: TEventListenerEvent): Boolean;\r\n    procedure BindEvents; override;\r\n    procedure SetMax(AValue: integer);\r\n    procedure SetMin(AValue: integer);\r\n    procedure SetPosition(AValue: integer);\r\n    function GetPosition: integer;\r\n    procedure DoUpdate;\r\n    procedure Change; virtual;\r\n    procedure CreateControl; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ElementInputHandle: TJSHTMLInputElement read GetElementInputHandle;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property Left;\r\n    property Margins;\r\n    property Max: integer read FMax write SetMax;\r\n    property Min: integer read FMin write SetMin;\r\n    property Position: integer read GetPosition write SetPosition;\r\n    property ShowHint;\r\n    property TabOrder;\r\n    property TabStop;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TWebTrackBar = class(TTrackBar);\r\n\r\n  TTimer = class(TCustomControl)\r\n  private\r\n    FInterval: integer;\r\n    FTimerID: integer;\r\n    FOnTimer: TNotifyEvent;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetEnabled(Value: Boolean); override;\r\n    procedure SetInterval(AValue: integer);\r\n\r\n    procedure DoTimer;\r\n    procedure DoUpdateTimer;\r\n    procedure DoClearTimer;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property Enabled;\r\n    property Interval: integer read FInterval write SetInterval;\r\n    property OnTimer: TNotifyEvent read FOnTimer write FOnTimer;\r\n  end;\r\n\r\n  TWebTimer = class(TTimer);\r\n\r\n  TGeolocationEvent = procedure(Sender: TObject; Lat,Lon,Alt:double) of object;\r\n\r\n  TGeoLocation = class(TCustomControl)\r\n  private\r\n    FOnGeolocation: TGeolocationEvent;\r\n  protected\r\n    procedure DoHandleGeolocation(APosition: TJSPosition);\r\n  public\r\n    function HasGeolocation: boolean;\r\n    procedure GetGeolocation;\r\n  published\r\n    property OnGeolocation: TGeolocationEvent read FOnGeolocation write FOnGeolocation;\r\n  end;\r\n\r\n  TWebGeoLocation = class(TGeoLocation);\r\n\r\n  TPaintBox = class(TGraphicControl)\r\n  private\r\n    FOnPaint: TNotifyEvent;\r\n  protected\r\n    procedure Paint; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Height;\r\n    property Left;\r\n    property Margins;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseMove;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n    property OnPaint: TNotifyEvent read FOnPaint write FOnPaint;\r\n    property OnTouchStart;\r\n    property OnTouchMove;\r\n    property OnTouchEnd;\r\n  end;\r\n\r\n  TWebPaintBox = class(TPaintBox);\r\n\r\n  TURLPicture = class(TPersistent)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    FFilename: string;\r\n  protected\r\n  public\r\n    procedure LoadFromFile(AFileName: string);\r\n    property Filename: string read FFilename;\r\n  published\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TCustomImageControl = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FPicture: TURLPicture;\r\n    FAutoSize: boolean;\r\n    procedure SetURL(AURL: string);\r\n  protected\r\n    function HandleDoDrag(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragEnd(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragExit(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragOver(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragStart(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDrop(aEvent: TJSDragEvent): boolean; virtual;\r\n\r\n    procedure SetPicture(const Value: TURLPicture);\r\n    procedure PictureChanged(Sender: TObject);\r\n    procedure BindEvents; override;\r\n    function CreateElement: TJSElement; override;\r\n    property Picture: TURLPicture read FPicture write SetPicture;\r\n    property URL: string read FURL write SetURL;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize: boolean read FAutoSize write FAutoSize;\r\n    property Hint;\r\n    property ShowHint;\r\n    property Visible;\r\n  end;\r\n\r\n  TImageControl = class(TCustomImageControl)\r\n  published\r\n    property Picture;\r\n    property URL;\r\n  end;\r\n\r\n  TWebImageControl = class(TImageControl);\r\n\r\n  TCustomPanel = class(TCustomControl)\r\n  private\r\n    FAutoSize: Boolean;\r\n    FCaption: string;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure SetBorderStyle(AValue: TBorderStyle); override;\r\n    procedure SetAutoSize(AValue: boolean);\r\n    procedure UpdateElementVisual; override;\r\n    property AutoSize: boolean read FAutoSize write SetAutoSize;\r\n    property Caption: string read FCaption write FCaption;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TPanel = class(TCustomPanel)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoSize;\r\n    property BorderColor;\r\n    property BorderStyle;\r\n    property Caption;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property ElementFont;\r\n    property ElementPosition;\r\n    property Enabled;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TDivPanel = class(TPanel)\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n  end;\r\n\r\n  TWebPanel = class(TPanel);\r\n\r\n  TCustomGroupBox = class(TCustomControl)\r\n  private\r\n    FCaption: string;\r\n    FCaptionSpan: TJSHTMLElement;\r\n    FControlSpan: TJSHTMLElement;\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElementData; override;\r\n    procedure UpdateElementVisual; override;\r\n    property Caption: string read FCaption write FCaption;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  end;\r\n\r\n  TGroupBox = class(TCustomGroupBox)\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property Caption;\r\n    property Color;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property Enabled;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TWebGroupBox = class(TGroupBox);\r\n\r\n  TScrollBox = class(TCustomPanel)\r\n  private\r\n    FAutoScroll: boolean;\r\n    function GetScrollLeft: integer;\r\n    function GetScrollTop: integer;\r\n    procedure SetScrollLeft(const Value: integer);\r\n    procedure SetScrollTop(const Value: integer);\r\n  protected\r\n    procedure UpdateElement; override;\r\n    procedure SetAutoScroll(AValue: boolean);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    property ScrollLeft: integer read GetScrollLeft write SetScrollLeft;\r\n    property ScrollTop: integer read GetScrollTop write SetScrollTop;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoScroll: boolean read FAutoScroll write SetAutoScroll;\r\n    property BorderStyle;\r\n    property ElementClassName;\r\n    property ElementID;\r\n    property Height;\r\n    property Hint;\r\n    property Left;\r\n    property ShowHint;\r\n    property Top;\r\n    property Visible;\r\n    property Width;\r\n    property OnClick;\r\n    property OnDblClick;\r\n  end;\r\n\r\n  TWebScrollBox = class(TScrollBox);\r\n\r\n  TCustomDragControl = class(TCustomControl)\r\n  private\r\n    FText: string;\r\n    procedure SetText(const AValue: string);\r\n  protected\r\n    function HandleDoDrag(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragEnd(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragExit(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragOver(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDragStart(aEvent: TJSDragEvent): boolean; virtual;\r\n    function HandleDoDrop(aEvent: TJSDragEvent): boolean; virtual;\r\n\r\n    procedure BindEvents; override;\r\n    procedure Paint; override;\r\n  published\r\n    property Text: string read FText write SetText;\r\n  end;\r\n\r\n  TSplitter = class(TCustomControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FFirstMove: boolean;\r\n    FSplitControl: TControl;\r\n    FSizing: boolean;\r\n    FSizingX,FSizingY: double;\r\n    FOriginalWidth,FOriginalHeight: integer;\r\n    FGripColor: TColor;\r\n    FOnMoved: TNotifyEvent;\r\n    FOnMove: TNotifyEvent;\r\n    procedure SetGripColor(const Value: TColor);\r\n  protected\r\n    function HandleDocDoMouseMove(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleDocDoMouseUp(Event: TJSMouseEvent): Boolean; virtual;\r\n    procedure DoMouseEnter; override;\r\n\r\n    procedure MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer); override;\r\n    procedure Paint; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n  published\r\n    property GripColor: TColor read FGripColor write SetGripColor;\r\n    property OnClick;\r\n    property OnMove: TNotifyEvent read FOnMove write FOnMove;\r\n    property OnMoved: TNotifyEvent read FOnMoved write FOnMoved;\r\n  end;\r\n\r\n  TWebSplitter = class(TSplitter);\r\n\r\n  TVerticalAlignment = (vaTop, vaCenter, vaBottom);\r\n  TGridPanelExpandStyle = (esAddRows, esAddColumns);\r\n\r\n  TGridPanelRow = class(TCollectionItem)\r\n  private\r\n    FSizeStyle: TSizeStyle;\r\n    FValue: integer;\r\n    FMarginBottom: integer;\r\n    FMarginTop: integer;\r\n    FAlignment: TVerticalAlignment;\r\n    FElementClassName: string;\r\n  protected\r\n    function HeightAttribute: string;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Alignment: TVerticalAlignment read FAlignment write FAlignment;\r\n    property ElementClassName: string read FElementClassName write FElementClassName;\r\n    property MarginTop: integer read FMarginTop write FMarginTop;\r\n    property MarginBottom: integer read FMarginBottom write FMarginBottom;\r\n    property SizeStyle: TSizeStyle read FSizeStyle write FSizeStyle;\r\n    property Value: integer read FValue write FValue;\r\n  end;\r\n\r\n  TGridPanelRows = class(TOwnedCollection)\r\n  private\r\n    function GetItem(Index: integer): TGridPanelRow; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TGridPanelRow); reintroduce;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TGridPanelRow; reintroduce;\r\n    function Insert(Index: integer): TGridPanelRow; reintroduce;\r\n    property Items[Index: integer]: TGridPanelRow read GetItem write SetItem;\r\n  end;\r\n\r\n  TGridPanelColumn = class(TCollectionItem)\r\n  private\r\n    FSizeStyle: TSizeStyle;\r\n    FValue: integer;\r\n    FMarginLeft: integer;\r\n    FAlignment: TAlignment;\r\n    FMarginRight: integer;\r\n    FElementClassName: string;\r\n  protected\r\n    function WidthAttribute: string;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Alignment: TAlignment read FAlignment write FAlignment;\r\n    property ElementClassName: string read FElementClassName write FElementClassName;\r\n    property MarginLeft: integer read FMarginLeft write FMarginLeft;\r\n    property MarginRight: integer read FMarginRight write FMarginRight;\r\n    property SizeStyle: TSizeStyle read FSizeStyle write FSizeStyle;\r\n    property Value: integer read FValue write FValue;\r\n  end;\r\n\r\n  TGridPanelColumns = class(TOwnedCollection)\r\n  private\r\n    function GetItem(Index: integer): TGridPanelColumn; reintroduce;\r\n    procedure SetItem(Index: integer; const Value: TGridPanelColumn); reintroduce;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TGridPanelColumn; reintroduce;\r\n    function Insert(Index: integer): TGridPanelColumn; reintroduce;\r\n    property Items[Index: integer]: TGridPanelColumn read GetItem write SetItem;\r\n  end;\r\n\r\n  TControlCollectionItem = class(TCollectionItem)\r\n  private\r\n    FControl: TWinControl;\r\n    FRow: integer;\r\n    FColumn: integer;\r\n\r\n  published\r\n    property Column: integer read FColumn write FColumn;\r\n    property Row: integer read FRow write FRow;\r\n    property Control: TWinControl read FControl write FControl;\r\n  end;\r\n\r\n  TControlCollection = class(TOwnedCollection)\r\n  private\r\n    function GetItem(Index: Integer): TControlCollectionItem; reintroduce;\r\n    procedure SetItem(Index: Integer; const Value: TControlCollectionItem); reintroduce;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    function Add: TControlCollectionItem; reintroduce;\r\n    function Insert(Index: Integer): TControlCollectionItem; reintroduce;\r\n    property Items[Index: Integer]: TControlCollectionItem read GetItem write SetItem;\r\n  end;\r\n\r\n  TGridPanel = class(TCustomControl)\r\n  private\r\n    FUpdateTable: boolean;\r\n    FRowCollection: TGridPanelRows;\r\n    FColumnCollection: TGridPanelColumns;\r\n    FControlCollection: TControlCollection;\r\n    FGridLineWidth: integer;\r\n    FGridLineColor: TColor;\r\n    FExpandStyle: TGridPanelExpandStyle;\r\n    procedure SetColumnCollection(const Value: TGridPanelColumns);\r\n    procedure SetRowCollection(const Value: TGridPanelRows);\r\n    procedure SetControlCollection(const Value: TControlCollection);\r\n  protected\r\n    function CreateTable: TJSElement; virtual;\r\n    procedure UpdateTable;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property ControlCollection: TControlCollection read FControlCollection write SetControlCollection;\r\n    property ColumnCollection: TGridPanelColumns read FColumnCollection write SetColumnCollection;\r\n    property ExpandStyle: TGridPanelExpandStyle read FExpandStyle write FExpandStyle;\r\n    property GridLineWidth: integer read FGridLineWidth write FGridLineWidth;\r\n    property GridLineColor: TColor read FGridLineColor write FGridLineColor;\r\n    property RowCollection: TGridPanelRows read FRowCollection write SetRowCollection;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseMove;\r\n    property OnMouseDown;\r\n    property OnMouseUp;\r\n  end;\r\n\r\n  TWebGridPanel = class(TGridPanel);\r\n\r\n  TMultiMediaType = (mtVideo, mtAudio);\r\n\r\n  TMultiMediaVolume = 0..100;\r\n\r\n  TMultimediaPlayer = class(TCustomControl)\r\n  private\r\n    FURL: string;\r\n    FMultimediaType: TMultimediaType;\r\n    FAutoPlay: boolean;\r\n    FControls: boolean;\r\n    FMuted: boolean;\r\n    FLoop: boolean;\r\n    FVolume: TMultiMediaVolume;\r\n    FPlaybackRate: double;\r\n    procedure SetAutoPlay(const Value: boolean);\r\n    procedure SetControls(const Value: boolean);\r\n    procedure SetMuted(const Value: boolean);\r\n    procedure SetLoop(const Value: boolean);\r\n    procedure SetURL(const Value: string);\r\n    procedure SetVolume(const Value: TMultiMediaVolume);\r\n    function GetCurrentTime: double;\r\n    procedure SetCurrentTime(const Value: double);\r\n    function GetDuration: double;\r\n    function GetEnded: boolean;\r\n    function GetPaused: boolean;\r\n    procedure SetPlaybackRate(const Value: double);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Play;\r\n    procedure Pause;\r\n    procedure ReLoad;\r\n    property CurrentTime: double read GetCurrentTime write SetCurrentTime;\r\n    property Duration: double read GetDuration;\r\n    property Ended: boolean read GetEnded;\r\n    property Paused: boolean read GetPaused;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property AutoPlay: boolean read FAutoPlay write SetAutoPlay;\r\n    property Controls: boolean read FControls write SetControls;\r\n    property Loop: boolean read FLoop write SetLoop;\r\n    property MultimediaType: TMultimediaType read FMultiMediaType write FMultiMediaType;\r\n    property Muted: boolean read FMuted write SetMuted;\r\n    property PlaybackRate: double read FPlaybackRate write SetPlaybackRate;\r\n    property URL: string read FURL write SetURL;\r\n    property Volume: TMultiMediaVolume read FVolume write SetVolume;\r\n    property Visible;\r\n  end;\r\n\r\n  TWebMultiMediaPlayer = class(TMultiMediaPlayer);\r\n\r\n  THTMLContainer = class(TCustomControl)\r\n  private\r\n    FHTML: TStringList;\r\n    FScrollStyle: TScrollStyle;\r\n    procedure SetHTML(const Value: TStringList);\r\n  protected\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    procedure HTMLChanged(Sender: TObject); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); reintroduce;\r\n    destructor Destroy; override;\r\n  published\r\n    property Align;\r\n    property AlignWithMargins;\r\n    property Anchors;\r\n    property HTML: TStringList read FHTML write SetHTML;\r\n    property ScrollStyle: TScrollStyle read FScrollStyle write FScrollStyle;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnMouseDown;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n  end;\r\n\r\n  TWebHTMLContainer = class(THTMLContainer);\r\n\r\n\r\nimplementation\r\n\r\nvar\r\n  geolocation : TJSGeoLocation; external name 'navigator.geolocation';\r\n\r\n\r\n{ TCustomLinkLabel }\r\n\r\nprocedure TCustomLinkLabel.SetCaption(AValue: string);\r\nvar\r\n  iopen, iopena, iopeni, iopenend, iopenendt, iclose: integer;\r\n  scaption, shref, stext, sanchor, sid, stype: string;\r\n  anchor, span, contentelement: TJSElement;\r\nbegin\r\n  FCaption := AValue;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  contentelement := ContentHandle;\r\n\r\n  if ElementID <> '' then\r\n    contentelement := document.getElementById(ElementID);\r\n\r\n\r\n  contentelement.innerHTML := '';\r\n\r\n  scaption := FCaption;\r\n\r\n  sanchor := '<a href=\"';\r\n  sid := '<a id=\"';\r\n\r\n  if Assigned(FOnLinkClick) and ((pos(sanchor, scaption) > 0) or (pos(sid, scaption) > 0)) then\r\n  begin\r\n    while (Pos(sanchor, scaption) > 0) or (Pos(sid, scaption) > 0) do\r\n    begin\r\n      //find first link in string\r\n      iopena := pos(sanchor, scaption);\r\n      iopeni := pos(sid, scaption);\r\n\r\n      if ((iopena < iopeni) or (iopeni <= 0)) and (iopena > 0) then\r\n      begin\r\n        stype := '#url#';\r\n        iopen := iopena + length(sanchor);\r\n      end\r\n      else\r\n      begin\r\n        stype := '#id#';\r\n        iopen := iopeni + length(sid);\r\n      end;\r\n\r\n      iopenend := pos('\">', scaption);\r\n      iopenendt := pos('\" ', scaption);\r\n      if (iopenendt > 0) and (iopenendt < iopenend) then\r\n        iopenend := iopenendt;\r\n\r\n      iclose := pos('</a>', scaption);\r\n      shref := copy(scaption, iopen, iopenend - iopen);\r\n\r\n      iopenend := pos('\">', scaption);\r\n      iclose := pos('</a>', scaption);\r\n      stext := copy(scaption, iopenend + 2, iclose - (iopenend + 2));\r\n\r\n      //add prefix text\r\n      span := document.createElement('SPAN');\r\n      span.innerHTML := copy(scaption, 0, iopen);\r\n      contentelement.appendChild(span);\r\n\r\n      //add link\r\n      anchor := document.createElement('A');\r\n      anchor['href'] := '#';\r\n      anchor['id'] := stype + shref;\r\n      anchor.innerHTML := stext;\r\n      TJSHTMLElement(anchor).onclick := DoLinkClick;\r\n      contentelement.appendChild(anchor);\r\n\r\n      //remove prefix + link\r\n      Delete(scaption, 1, Pos('</a>', scaption) + 3);\r\n    end;\r\n\r\n    //suffix text\r\n    span := document.createElement('SPAN');\r\n    span.innerHTML := scaption;\r\n    contentelement.appendChild(span);\r\n    FDisplText := scaption;\r\n  end\r\n  else\r\n  begin\r\n    FDisplText := StringReplace(AValue, '> <', '>&nbsp;<', [rfReplaceAll]);\r\n    contentelement.innerHTML := FDisplText;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetHeightPercent(const Value: TPercentSize);\r\nbegin\r\n  FHeightPercent := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetHeightStyle(const Value: TSizeStyle);\r\nbegin\r\n  FHeightStyle := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetWidthPercent(const Value: TPercentSize);\r\nbegin\r\n  FWidthPercent := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.SetWidthStyle(const Value: TSizeStyle);\r\nbegin\r\n  FWidthStyle := Value;\r\nend;\r\n\r\nprocedure TCustomLinkLabel.BindEvents;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nconstructor TCustomLinkLabel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FWidthStyle := ssAbsolute;\r\n  FWidthPercent := 100;\r\n  FHeightStyle := ssAbsolute;\r\n  FHeightPercent := 100;\r\n  Transparent := false;\r\nend;\r\n\r\nfunction TCustomLinkLabel.DoLinkClick(Event: TJSMouseEvent): boolean;\r\nvar\r\n slink, stype, svalue: string;\r\n ltype: TSysLinkType;\r\nbegin\r\n  svalue := event.target['id'];\r\n  stype := '#url#';\r\n  ltype := sltURL;\r\n\r\n  if not (pos(stype, svalue) > 0) then\r\n  begin\r\n    stype := '#id#';\r\n    ltype := sltID;\r\n  end;\r\n\r\n  slink := StringReplace(svalue, stype, '', []);\r\n\r\n  if Assigned(FOnLinkClick) then\r\n    FOnLinkClick(Self, slink, ltype);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomLinkLabel.GetDisplayText: string;\r\nbegin\r\n  Result := FDisplText;\r\nend;\r\n\r\nfunction TCustomLinkLabel.GetOuterHeight: integer;\r\nbegin\r\n  Result := Height;\r\n  if AutoSize then\r\n    Result := Result + 4;\r\nend;\r\n\r\nfunction TCustomLinkLabel.GetOuterWidth: integer;\r\nbegin\r\n  Result := Width;\r\n  if AutoSize then\r\n    Result := Result + 4;\r\nend;\r\n\r\n{ TTrackBar }\r\n\r\nfunction TTrackBar.GetElementInputHandle: TJSHTMLInputElement;\r\nbegin\r\n  Result := TJSHTMLInputElement(Container);\r\nend;\r\n\r\nfunction TTrackBar.GetInputType: string;\r\nbegin\r\n  Result := 'range';\r\nend;\r\n\r\nprocedure TTrackBar.Change;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n{$HINTS OFF}\r\nfunction TTrackBar.DoHandleChange(Event: TEventListenerEvent): Boolean;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  el := ElementHandle;\r\n  asm\r\n    this.FPosition = el.value;\r\n  end;\r\n\r\n  Change;\r\n  Result := True;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TTrackBar.BindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.oninput := DoHandleChange;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.CreateControl;\r\nbegin\r\n  inherited;\r\n  DoUpdate;\r\nend;\r\n\r\nprocedure TTrackBar.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FMax := 100;\r\n  FMin := 0;\r\n  FPosition := 0;\r\nend;\r\n\r\nprocedure TTrackBar.SetMax(AValue: integer);\r\nbegin\r\n  if (FMax <> AValue) then\r\n  begin\r\n    FMax := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TTrackBar.SetMin(AValue: integer);\r\nbegin\r\n  if (FMin <> AValue) then\r\n  begin\r\n    FMin := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TTrackBar.DoUpdate;\r\nvar\r\n  el: TJSHTMLElement;\r\nbegin\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  Container['max'] := IntToStr(FMax);\r\n  Container['min'] := IntToStr(FMin);\r\n\r\n  el := ElementHandle;\r\n\r\n  asm\r\n    el.value = this.FPosition;\r\n    el.setAttribute('value',this.FPosition);\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TTrackBar.SetPosition(AValue: integer);\r\nbegin\r\n  if (FPosition <> AValue) then\r\n  begin\r\n    FPosition := AValue;\r\n    DoUpdate;\r\n  end;\r\nend;\r\n\r\nfunction TTrackBar.GetPosition: integer;\r\nvar\r\n  s: string;\r\nbegin\r\n  Result := FPosition;\r\n\r\n  if not Assigned(Container) then\r\n    Exit;\r\n\r\n  s := TJSHTMLInputElement(Container).value;\r\n  if (s <> '') then\r\n    Result := StrToInt(s);\r\nend;\r\n\r\n{ TTimer }\r\n\r\nprocedure TTimer.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FInterval := 1000;\r\n  FTimerID := -1;\r\n  Enabled := True;\r\nend;\r\n\r\nfunction TTimer.CreateElement: TJSElement;\r\nbegin\r\n  Result := nil;\r\n  DoUpdateTimer;\r\nend;\r\n\r\nprocedure TTimer.SetEnabled(Value: boolean);\r\nbegin\r\n  inherited SetEnabled(Value);\r\n  DoUpdateTimer;\r\nend;\r\n\r\nprocedure TTimer.SetInterval(AValue: integer);\r\nbegin\r\n  FInterval := AValue;\r\n  DoUpdateTimer;\r\nend;\r\n\r\nprocedure TTimer.DoTimer;\r\nbegin\r\n  if Assigned(FOnTimer) then\r\n    FOnTimer(Self);\r\nend;\r\n\r\nprocedure TTimer.DoClearTimer;\r\nbegin\r\n  window.ClearInterval(FTimerID);\r\nend;\r\n\r\nprocedure TTimer.DoUpdateTimer;\r\nbegin\r\n  DoClearTimer;\r\n\r\n  if Enabled then\r\n    FTimerID := window.setInterval(@DoTimer, FInterval);\r\nend;\r\n\r\n{ TPaintBox }\r\n\r\nprocedure TPaintBox.Paint;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnPaint) then\r\n    OnPaint(Self);\r\nend;\r\n\r\n{ TScrollBox }\r\n\r\nprocedure TScrollBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoScroll := true;\r\nend;\r\n\r\nprocedure TScrollBox.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) and not IsUpdating then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'auto');\r\n    ElementHandle.style.setProperty('display', 'inline-block');\r\n  end;\r\nend;\r\n\r\nfunction TScrollBox.GetScrollLeft: integer;\r\nbegin\r\n  Result := ElementHandle.scrollLeft;\r\nend;\r\n\r\nfunction TScrollBox.GetScrollTop: integer;\r\nbegin\r\n  Result := ElementHandle.scrollTop;\r\nend;\r\n\r\nprocedure TScrollBox.SetAutoScroll(AValue: boolean);\r\nbegin\r\n  FAutoScroll := AValue;\r\nend;\r\n\r\nprocedure TScrollBox.SetScrollLeft(const Value: integer);\r\nbegin\r\n  ElementHandle.scrollLeft := Value;\r\nend;\r\n\r\nprocedure TScrollBox.SetScrollTop(const Value: integer);\r\nbegin\r\n  ElementHandle.scrollTop := Value;\r\nend;\r\n\r\n{ TCustomImageControl }\r\n\r\nprocedure TCustomImageControl.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    Container['draggable'] := 'true';\r\n    Container['droppable'] := 'true';\r\n    ElementHandle.ondrag := HandleDoDrag;\r\n    ElementHandle.ondragend := HandleDoDragEnd;\r\n    ElementHandle.ondragexit := HandleDoDragExit;\r\n    ElementHandle.ondragover := HandleDoDragOver;\r\n    ElementHandle.ondragstart := HandleDoDragStart;\r\n    ElementHandle.ondrop := HandleDoDrop;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomImageControl.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FPicture := TURLPicture.Create;\r\n  FPicture.OnChange := PictureChanged;\r\n  Color := clNone;\r\n  TabStop := false;\r\nend;\r\n\r\ndestructor TCustomImageControl.Destroy;\r\nbegin\r\n  FPicture.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\n\r\nfunction TCustomImageControl.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('IMG');\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDrag(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragEnd(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\n\r\nfunction TCustomImageControl.HandleDoDragExit(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragOver(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDragStart(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  obj: TDragObject;\r\n\r\nbegin\r\n  AEvent.dataTransfer.effectAllowed := 'copy';\r\n  AEvent.dataTransfer.dropEffect := 'copy';\r\n  AEvent.dataTransfer.setData('text', 'Hello World');\r\n\r\n  DoStartDrag(obj);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomImageControl.HandleDoDrop(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  DragDrop(nil, aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomImageControl.SetURL(AURL: string);\r\nbegin\r\n  Container['src'] := AURL;\r\nend;\r\n\r\nprocedure TCustomImageControl.SetPicture(const Value: TURLPicture);\r\nbegin\r\n  FPicture.Assign(Value);\r\nend;\r\n\r\nprocedure TCustomImageControl.PictureChanged(Sender: TObject);\r\nbegin\r\n  SetURL(Picture.FileName);\r\nend;\r\n\r\n{ TCustomDragControl }\r\n\r\nprocedure TCustomDragControl.BindEvents;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    Container['draggable'] := 'true';\r\n    ElementHandle.ondragend := HandleDoDragEnd;\r\n    ElementHandle.ondragexit := HandleDoDragExit;\r\n    ElementHandle.ondragover := HandleDoDragOver;\r\n    ElementHandle.ondragstart := HandleDoDragStart;\r\n    ElementHandle.ondrop := HandleDoDrop;\r\n  end;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDrag(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //OutputDebugString('do drag');\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragEnd(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  DoEndDrag(Self, aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragExit(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  //OutputDebugString('do drag exit');\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragOver(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  Accept: boolean;\r\nbegin\r\n  aEvent.preventDefault();\r\n  //OutputDebugString('do drag over');\r\n  Accept := true;\r\n  DragOver(Self, aEvent.clientX, aEvent.clientY, dsDragMove, Accept);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDragStart(aEvent: TJSDragEvent): boolean;\r\nvar\r\n  obj: TDragObject;\r\nbegin\r\n  aEvent.dataTransfer.setData('text',  Text);\r\n  DoStartDrag(obj);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomDragControl.HandleDoDrop(aEvent: TJSDragEvent): boolean;\r\nbegin\r\n  aEvent.preventDefault();\r\n  Text := aEvent.dataTransfer.getData('text');\r\n  DragDrop(Self, aEvent.clientX, aEvent.clientY);\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomDragControl.Paint;\r\nbegin\r\n  Canvas.Pen.Color := clRed;\r\n  Canvas.Pen.Width := 1;\r\n  Canvas.Pen.Style := psSolid;\r\n  Canvas.Brush.Style := bsSolid;\r\n  Canvas.Brush.Color := clYellow;\r\n  Canvas.Rectangle(ClientRect);\r\n\r\n  Canvas.TextOut(10,10,FText);\r\nend;\r\n\r\nprocedure TCustomDragControl.SetText(const AValue: string);\r\nbegin\r\n  if (FText <> AValue) then\r\n  begin\r\n    FText := AValue;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\n{ TSplitter }\r\n\r\nprocedure TSplitter.CreateInitialize;\r\n begin\r\n   inherited;\r\n   Cursor := crHSplit;\r\n   Width := 6;\r\n   Height := 100;\r\n   Align := alLeft;\r\n   FSplitControl := nil;\r\n   GripColor := clWhite;\r\n end;\r\n\r\n procedure TSplitter.Paint;\r\n var\r\n   xofs,dx: integer;\r\n   yofs,dy: integer;\r\n   i: integer;\r\n begin\r\n   Canvas.Brush.Color := Color;\r\n   Canvas.Pen.Color := Color;\r\n   Canvas.Brush.Style := bsSolid;\r\n   Canvas.Rectangle(ClientRect);\r\n\r\n   if (Align in [alLeft, alRight]) then\r\n   begin\r\n     dx := 0;\r\n     dy := 6;\r\n     yofs := (Height div 2) - 9;\r\n     xofs := (Width div 2);\r\n   end;\r\n\r\n   if (Align in [alTop, alBottom]) then\r\n   begin\r\n     dx := 6;\r\n     dy := 0;\r\n     xofs := (Width div 2) - 9;\r\n     yofs := (Height div 2) - 1;\r\n   end;\r\n\r\n   Canvas.Brush.Color := GripColor;\r\n   Canvas.Pen.Color := GripColor;\r\n\r\n   for i := 0 to 2 do\r\n   begin\r\n     Canvas.Rectangle(xofs, yofs, xofs + 2, yofs + 2);\r\n     xofs := xofs + dx;\r\n     yofs := yofs + dy;\r\n   end;\r\n end;\r\n\r\nprocedure TSplitter.SetGripColor(const Value: TColor);\r\nbegin\r\n  if (FGripColor <> Value) then\r\n  begin\r\n    FGripColor := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TSplitter.MouseUp(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nbegin\r\n  inherited;\r\n  FSizing := false;\r\n  FSplitControl := nil;\r\n  ReleaseCapture;\r\nend;\r\n\r\nprocedure TSplitter.MouseDown(Button: TMouseButton; Shift: TShiftState; X,Y: Integer);\r\nvar\r\n  r,rc: TRect;\r\n  i: integer;\r\n  c: TControl;\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  inherited;\r\n\r\n  FSizing := true;\r\n\r\n  r := Rect(Left, Top, Left + Width, Top + Height);\r\n\r\n  if Assigned(Parent) then\r\n  begin\r\n    for i := 0 to Parent.ControlCount - 1 do\r\n    begin\r\n      c := Parent.Controls[i];\r\n\r\n      if (c.Align = Align) and (c <> Self) then\r\n      begin\r\n        rc := Rect(c.Left, c.Top, c.Left + c.Width, c.Top + c.Height);\r\n\r\n        //OutputDebugString(c.GetID+':'+inttostr(rc.Right)+':'+inttostr(r.Left));\r\n\r\n        if (Align = alLeft) and (rc.Right - r.Left < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalWidth := FSplitControl.Width;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('left:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alRight) and (rc.Left - r.Right < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalWidth := FSplitControl.Width;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('left:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alTop) and (rc.Bottom - r.Top < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalHeight := FSplitControl.Height;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('top:'+c.GetID);\r\n        end;\r\n\r\n        if (Align = alBottom) and (rc.Top - r.Bottom < 4) then\r\n        begin\r\n          FSplitControl := c;\r\n          FOriginalHeight := FSplitControl.Height;\r\n          FSizing := true;\r\n          FSizingX := X;\r\n          FSizingY := Y;\r\n          break;\r\n          //OutputDebugString('top:'+c.GetID);\r\n        end;\r\n\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  if (Align in [alLeft, alRight]) then\r\n    eh.style.setProperty('cursor', 'col-resize');\r\n\r\n  if (Align in [alTop, alBottom]) then\r\n    eh.style.setProperty('cursor', 'row-resize');\r\n\r\n  FFirstMove := true;\r\n\r\n  eh.addEventListener('mousemove',@HandleDocDoMouseMove);\r\n  eh.addEventListener('mouseup',@HandleDocDoMouseUp);\r\n\r\n  //Capture;\r\nend;\r\n\r\n\r\nprocedure TSplitter.DoMouseEnter;\r\nbegin\r\n  inherited;\r\n  if (Align in [alLeft, alRight]) then\r\n    Cursor := crHSplit;\r\n\r\n  if (Align in [alTop, alBottom]) then\r\n    Cursor := crVSplit;\r\nend;\r\n\r\nfunction TSplitter.HandleDocDoMouseMove(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  dx,dy: integer;\r\nbegin\r\n\r\n  if FSizing and Assigned(FSplitControl) then\r\n  begin\r\n    if FFirstMove then\r\n    begin\r\n      FSizingX := Event.clientX;\r\n      FSizingY := Event.clientY;\r\n      FFirstMove := false;\r\n    end\r\n    else\r\n    begin\r\n      dx := Round(Event.clientX - FSizingX);\r\n      dy := Round(Event.clientY - FSizingY);\r\n\r\n      if Align = alLeft then\r\n        FSplitControl.Width := FOriginalWidth + dx;\r\n\r\n      if Align = alRight then\r\n        FSplitControl.Width := FOriginalWidth - dx;\r\n\r\n      if Align = alTop then\r\n        FSplitControl.Height := FOriginalHeight + dy;\r\n\r\n      if Align = alBottom then\r\n        FSplitControl.Height := FOriginalHeight - dy;\r\n\r\n      DoRealign;\r\n\r\n      if Assigned(OnMove) then\r\n        OnMove(Self);\r\n\r\n    end;\r\n  end;\r\n  Result := true;\r\nend;\r\n\r\nfunction TSplitter.HandleDocDoMouseUp(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  FSizing := false;\r\n  FSplitControl := nil;\r\n  FFirstMove := true;\r\n  FLayer.parentNode.removeChild(FLayer);\r\n  Result := true;\r\n  if Assigned(OnMoved) then\r\n    OnMoved(Self);\r\nend;\r\n\r\n{ TDivPanel }\r\n\r\nfunction TDivPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\n{ TCustomPanel }\r\n\r\nprocedure TCustomPanel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FAutoSize := False;\r\n  Color := clBtnFace;\r\n  TabStop := False;\r\n  CustomBorder := true;\r\nend;\r\n\r\nfunction TCustomPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TCustomPanel.SetAutoSize(AValue: boolean);\r\nbegin\r\n  if FAutoSize <> AValue then\r\n  begin\r\n    FAutoSize := AValue;\r\n    if FAutoSize then\r\n    begin\r\n      Width := -1;\r\n      Height := -1;\r\n    end;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomPanel.SetBorderStyle(AValue: TBorderStyle);\r\nbegin\r\n  inherited;\r\n  UpdateElement\r\nend;\r\n\r\nprocedure TCustomPanel.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if AutoSize then\r\n    begin\r\n      ElementHandle.style.setProperty('overflow', '');\r\n      ElementHandle.style.setProperty('white-space', 'normal');\r\n      ElementHandle.style.setProperty('display', 'inline');\r\n    end\r\n    else\r\n    begin\r\n      ElementHandle.style.setProperty('overflow', 'hidden');\r\n      ElementHandle.style.setProperty('white-space', 'nowrap');\r\n      ElementHandle.style.setProperty('display', 'inline-block');\r\n    end;\r\n    (*\r\n    if BorderStyle = bsSingle then\r\n    begin\r\n      ElementHandle.style.setProperty('border-style', 'solid');\r\n      ElementHandle.style.setProperty('border-width', '1px');\r\n      ElementHandle.style.setProperty('border-color', 'lightgray');\r\n    end\r\n    else\r\n    begin\r\n      ElementHandle.style.setProperty('border-style', 'none');\r\n      ElementHandle.style.setProperty('border-width', '');\r\n      ElementHandle.style.setProperty('border-color', '');\r\n    end;\r\n    *)\r\n    ElementHandle.style.setProperty('background-color', ColorToHTML(Color));\r\n  end;\r\nend;\r\n\r\n\r\n{ TURLPicture }\r\n\r\nprocedure TURLPicture.LoadFromFile(AFileName: string);\r\nbegin\r\n  FFilename := AFileName;\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\n\r\n{ TGeoLocation }\r\n\r\nprocedure TGeoLocation.DoHandleGeolocation(APosition: TJSPosition);\r\nbegin\r\n  if Assigned(OnGeolocation) then\r\n    OnGeolocation(Self, APosition.Coords.Latitude, APosition.Coords.Longitude, APosition.Coords.Altitude);\r\nend;\r\n\r\nprocedure TGeoLocation.GetGeolocation;\r\nbegin\r\n  if Assigned(geolocation) then\r\n  begin\r\n    geolocation.getCurrentPosition(TJSGeoLocationCallback(@DoHandleGeoLocation));\r\n  end;\r\nend;\r\n\r\nfunction TGeoLocation.HasGeolocation: boolean;\r\nbegin\r\n  Result := Assigned(geolocation);\r\nend;\r\n\r\n{ TGridPanelRows }\r\n\r\nfunction TGridPanelRows.Add: TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Add);\r\nend;\r\n\r\nconstructor TGridPanelRows.Create(AOwner: TComponent);\r\nbegin\r\n   inherited Create(AOwner, TGridPanelRow);\r\nend;\r\n\r\nfunction TGridPanelRows.GetItem(Index: integer): TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Items[Index]);\r\nend;\r\n\r\nfunction TGridPanelRows.Insert(Index: integer): TGridPanelRow;\r\nbegin\r\n  Result := TGridPanelRow(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TGridPanelRows.SetItem(Index: integer; const Value: TGridPanelRow);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TGridPanelColumns }\r\n\r\nfunction TGridPanelColumns.Add: TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Add);\r\nend;\r\n\r\nconstructor TGridPanelColumns.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TGridPanelColumn);\r\nend;\r\n\r\nfunction TGridPanelColumns.GetItem(Index: integer): TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Items[Index]);\r\nend;\r\n\r\nfunction TGridPanelColumns.Insert(Index: integer): TGridPanelColumn;\r\nbegin\r\n  Result := TGridPanelColumn(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TGridPanelColumns.SetItem(Index: integer;\r\n  const Value: TGridPanelColumn);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TGridPanel }\r\n\r\nfunction TGridPanel.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\nend;\r\n\r\nprocedure TGridPanel.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FUpdateTable := true;\r\n  FRowCollection := TGridPanelRows.Create(Self);\r\n  FColumnCollection := TGridPanelColumns.Create(Self);\r\n  FControlCollection := TControlCollection.Create(Self);\r\nend;\r\n\r\nfunction TGridPanel.CreateTable: TJSElement;\r\nvar\r\n  tbl,tblbody,row,cell: TJSElement;\r\n  i,j: integer;\r\n  ps: string;\r\nbegin\r\n  tbl := document.createElement('table');\r\n\r\n  tbl.setAttribute('width','100%');\r\n  tbl.setAttribute('height','100%');\r\n\r\n  if ElementClassName <> '' then\r\n    tbl.setAttribute('class', ElementClassName);\r\n\r\n  if (GridLineColor <> clNone) and (GridLineWidth > 0) then\r\n    ps := IntToStr(GridLineWidth)+'px solid '+ ColorToHTML(GridLineColor)\r\n  else\r\n    ps := '0px';\r\n\r\n  TJSHTMLElement(tbl).style.setProperty('border', ps);\r\n  TJSHTMLElement(tbl).style.setProperty('border-collapse','collapse');\r\n\r\n  if (Color <> clNone) then\r\n    TJSHTMLElement(tbl).style.setProperty('background-color', ColorToHTML(Color));\r\n\r\n  tblBody := document.createElement('tbody');\r\n\r\n  // cells creation\r\n  for  j := 0 to RowCollection.Count - 1 do\r\n  begin\r\n    row := document.createElement('tr');\r\n    TJSHTMLElement(row).style.setProperty('border', ps);\r\n\r\n    if RowCollection.Items[j].MarginTop <> 0 then\r\n      TJSHTMLElement(row).style.setProperty('margin-top', IntToStr(RowCollection.Items[j].MarginTop));\r\n\r\n    if RowCollection.Items[j].MarginBottom <> 0 then\r\n      TJSHTMLElement(row).style.setProperty('margin-bottom', IntToStr(RowCollection.Items[j].MarginBottom));\r\n\r\n    if (RowCollection.Items[j].ElementClassName <> '') then\r\n    begin\r\n      TJSHTMLElement(row).setAttribute('class', RowCollection.Items[j].ElementClassName);\r\n    end;\r\n\r\n    case RowCollection.Items[j].Alignment of\r\n    vaCenter: TJSHTMLElement(row).setAttribute('valign','middle');\r\n    vaBottom: TJSHTMLElement(row).setAttribute('valign','bottom');\r\n    end;\r\n\r\n    TJSHTMLElement(row).style.setProperty('border', ps);\r\n    row.setAttribute('height', RowCollection.Items[j].HeightAttribute);\r\n\r\n    for i := 0 to ColumnCollection.Count - 1 do\r\n    begin\r\n      cell := document.createElement('td');\r\n      TJSHTMLElement(cell).style.setProperty('border', ps);\r\n\r\n      if ColumnCollection.Items[i].MarginLeft <> 0 then\r\n        TJSHTMLElement(cell).style.setProperty('margin-left', IntToStr(ColumnCollection.Items[i].MarginLeft));\r\n\r\n      if ColumnCollection.Items[i].MarginRight <> 0 then\r\n        TJSHTMLElement(cell).style.setProperty('margin-right', IntToStr(ColumnCollection.Items[i].MarginRight));\r\n\r\n      if (ColumnCollection.Items[i].ElementClassName <> '') then\r\n      begin\r\n        TJSHTMLElement(cell).setAttribute('class', ColumnCollection.Items[i].ElementClassName);\r\n      end;\r\n\r\n      case ColumnCollection.Items[i].Alignment of\r\n      taCenter: TJSHTMLElement(cell).setAttribute('align','center');\r\n      taRightJustify: TJSHTMLElement(cell).setAttribute('align','right');\r\n      end;\r\n\r\n      cell.setAttribute('id', Name+'R'+IntToStr(j)+'C'+IntToStr(i));\r\n\r\n      if j = 0 then\r\n      begin\r\n        cell.setAttribute('width',ColumnCollection.Items[i].WidthAttribute);\r\n      end;\r\n\r\n      //cellText := document.createTextNode('cell is row '+IntToStr(j)+', column '+IntToStr(i));\r\n      //cell.appendChild(cellText);\r\n      row.appendChild(cell);\r\n    end;\r\n    tblBody.appendChild(row);\r\n  end;\r\n\r\n  // append the <tbody> inside the <table>\r\n  tbl.appendChild(tblBody);\r\n  Result := tbl;\r\nend;\r\n\r\nprocedure TGridPanel.UpdateTable;\r\nvar\r\n  i,j,k: integer;\r\n  fragment: TJSDocumentFragment;\r\n  ctrlid,destid: string;\r\n  control: TWinControl;\r\n  el: TJSElement;\r\n\r\nbegin\r\n  i := 0;\r\n  j := 0;\r\n\r\n  for k := 0 to ControlCollection.Count - 1 do\r\n  begin\r\n    if Assigned(ControlCollection.Items[k].Control) then\r\n    begin\r\n      fragment := document.createDocumentFragment();\r\n      control := ControlCollection.Items[k].Control;\r\n      control.ElementPosition := epRelative;\r\n      ctrlid := control.GetID;\r\n\r\n      if control.Align = alLeft then\r\n      begin\r\n        control.HeightStyle := ssPercent;\r\n        control.Height := 100;\r\n        if Assigned(control.ElementHandle) then\r\n          TJSHTMLElement(control.ElementHandle).style.setProperty('float','left');\r\n      end;\r\n\r\n      if control.Align = alRight then\r\n      begin\r\n        control.HeightStyle := ssPercent;\r\n        control.Height := 100;\r\n        if Assigned(control.ElementHandle) then\r\n          TJSHTMLElement(control.ElementHandle).style.setProperty('float','right');\r\n      end;\r\n\r\n      if (control.Align in [alTop, alBottom]) then\r\n      begin\r\n        control.WidthStyle := ssPercent;\r\n        control.Width := 100;\r\n      end;\r\n\r\n      if control.Align = alClient then\r\n      begin\r\n        control.WidthStyle := ssPercent;\r\n        control.HeightStyle := ssPercent;\r\n        control.Width := 100;\r\n        control.Height:= 100;\r\n      end;\r\n\r\n      fragment.appendChild(document.getElementById(ctrlid));\r\n\r\n      destid := Name + 'R'+ inttostr(j) + 'C' + inttostr(i);\r\n\r\n      inc(i);\r\n      if i = ColumnCollection.Count then\r\n      begin\r\n        i := 0;\r\n        inc(j);\r\n      end;\r\n\r\n      el := document.getElementById(destid);\r\n      el.appendChild(fragment);\r\n\r\n      if control.Align = alTop then\r\n        TJSHTMLElement(el).style.setProperty('vertical-align','top');\r\n\r\n      if control.Align = alBottom then\r\n        TJSHTMLElement(el).style.setProperty('vertical-align','bottom');\r\n    end;\r\n  end;\r\nend;\r\n\r\ndestructor TGridPanel.Destroy;\r\nbegin\r\n  FRowCollection.Free;\r\n  FColumnCollection.Free;\r\n  FControlCollection.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TGridPanel.SetColumnCollection(const Value: TGridPanelColumns);\r\nbegin\r\n  FColumnCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.SetControlCollection(const Value: TControlCollection);\r\nbegin\r\n  FControlCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.SetRowCollection(const Value: TGridPanelRows);\r\nbegin\r\n  FRowCollection.Assign(Value);\r\nend;\r\n\r\nprocedure TGridPanel.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) and not IsUpdating then\r\n  begin\r\n\r\n    if FUpdateTable and Assigned(Container) then\r\n    begin\r\n      TJSElement(Container).appendChild(CreateTable);\r\n      UpdateTable;\r\n      FUpdateTable := false;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{ TGridPanelColumn }\r\n\r\nprocedure TGridPanelColumn.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TGridPanelColumn) then\r\n  begin\r\n    FAlignment := (Source as TGridPanelColumn).Alignment;\r\n    FSizeStyle := (Source as TGridPanelColumn).SizeStyle;\r\n    FElementClassName := (Source as TGridPanelColumn).ElementClassName;\r\n    FValue := (Source as TGridPanelColumn).Value;\r\n    FMarginLeft := (Source as TGridPanelColumn).MarginLeft;\r\n    FMarginRight := (Source as TGridPanelColumn).MarginRight;\r\n  end;\r\nend;\r\n\r\nfunction TGridPanelColumn.WidthAttribute: string;\r\nbegin\r\n  Result := '';\r\n  case SizeStyle of\r\n  ssPercent: Result := IntTostr(Value)+'%';\r\n  ssAbsolute: Result := IntTostr(Value)+'px';\r\n  end;\r\nend;\r\n\r\n{ TGridPanelRow }\r\n\r\nprocedure TGridPanelRow.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TGridPanelRow) then\r\n  begin\r\n    FAlignment := (Source as TGridPanelRow).Alignment;\r\n    FSizeStyle := (Source as TGridPanelRow).SizeStyle;\r\n    FElementClassName := (Source as TGridPanelRow).ElementClassName;\r\n    FValue := (Source as TGridPanelRow).Value;\r\n    FMarginTop := (Source as TGridPanelRow).MarginTop;\r\n    FMarginBottom := (Source as TGridPanelRow).MarginBottom;\r\n  end;\r\nend;\r\n\r\nfunction TGridPanelRow.HeightAttribute: string;\r\nbegin\r\n  Result := '';\r\n  case SizeStyle of\r\n  ssPercent: Result := IntTostr(Value)+'%';\r\n  ssAbsolute: Result := IntTostr(Value)+'px';\r\n  end;\r\nend;\r\n\r\n{ TControlCollection }\r\n\r\nfunction TControlCollection.Add: TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Add);\r\nend;\r\n\r\nconstructor TControlCollection.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner, TControlCollectionItem);\r\nend;\r\n\r\nfunction TControlCollection.GetItem(Index: Integer): TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TControlCollection.Insert(Index: Integer): TControlCollectionItem;\r\nbegin\r\n  Result := TControlCollectionItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TControlCollection.SetItem(Index: Integer;\r\n  const Value: TControlCollectionItem);\r\nbegin\r\n  Items[Index] := Value;\r\nend;\r\n\r\n{ TWebMultimediaPlayer }\r\n\r\nfunction TMultimediaPlayer.CreateElement: TJSElement;\r\nvar\r\n  src: TJSElement;\r\nbegin\r\n  if MultimediaType = mtVideo then\r\n    Result := document.createElement('VIDEO')\r\n  else\r\n    Result := document.createElement('AUDIO');\r\n\r\n  src := document.createElement('SOURCE');\r\n  Result.appendChild(src);\r\nend;\r\n\r\nprocedure TMultimediaPlayer.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FVolume := 100;\r\n  FPlaybackRate := 1;\r\n  FMuted := false;\r\n  FAutoPlay := false;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetCurrentTime: double;\r\nvar\r\n  el: TJSElement;\r\n  i: double;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      i = el.currentTime;\r\n    end;\r\n  end;\r\n\r\n  Result := i;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetDuration: double;\r\nvar\r\n  el: TJSElement;\r\n  i: double;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      i = el.duration;\r\n    end;\r\n  end;\r\n  Result := i;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetEnded: boolean;\r\nvar\r\n  el: TJSElement;\r\n  e: boolean;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      e = el.ended;\r\n    end;\r\n  end;\r\n\r\n  Result := e;\r\nend;\r\n\r\nfunction TMultimediaPlayer.GetPaused: boolean;\r\nvar\r\n  el: TJSElement;\r\n  e: boolean;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      e = el.paused;\r\n    end;\r\n  end;\r\n\r\n  Result := e;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.Pause;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  begin\r\n    asm\r\n      el.pause();\r\n    end;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TMultimediaPlayer.Play;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.play();\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.ReLoad;\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.load();\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetAutoPlay(const Value: boolean);\r\nbegin\r\n  if (FAutoPlay <> Value) then\r\n  begin\r\n    FAutoPlay := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetControls(const Value: boolean);\r\nbegin\r\n  if (FControls <> Value) then\r\n  begin\r\n    FControls := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetCurrentTime(const Value: double);\r\nvar\r\n  el: TJSElement;\r\nbegin\r\n  el := ElementHandle;\r\n  if Assigned(el) then\r\n  asm\r\n    el.currentTime = Value;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetLoop(const Value: boolean);\r\nbegin\r\n  if (FLoop <> Value) then\r\n  begin\r\n    FLoop := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetMuted(const Value: boolean);\r\nbegin\r\n  if (FMuted <> Value) then\r\n  begin\r\n    FMuted := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetPlaybackRate(const Value: double);\r\nbegin\r\n  if (FPlaybackRate <> Value) then\r\n  begin\r\n    FPlaybackRate := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetURL(const Value: string);\r\nbegin\r\n  if (FURL <> Value) then\r\n  begin\r\n    FURL := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMultimediaPlayer.SetVolume(const Value: TMultiMediaVolume);\r\nbegin\r\n  if (FVolume <> Value) then\r\n  begin\r\n    FVolume := Value;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TMultimediaPlayer.UpdateElement;\r\nvar\r\n  el: TJSNode;\r\n  vid: TJSElement;\r\n\r\n  function booltoattr(b: boolean): string;\r\n  begin\r\n    if b then\r\n      result := 'true'\r\n    else\r\n      result := 'false';\r\n  end;\r\n\r\nbegin\r\n  inherited;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    vid := TJSElement(ElementHandle);\r\n    asm\r\n      vid.controls = this.FControls;\r\n      vid.playbackRate = this.FPlaybackRate;\r\n      vid.muted = this.FMuted;\r\n    end;\r\n\r\n    //ElementHandle.setAttribute('controls',booltoattr(FControls));\r\n    ElementHandle.setAttribute('autoplay',booltoattr(FAutoplay));\r\n    ElementHandle.setAttribute('muted',booltoattr(FMuted));\r\n    ElementHandle.setAttribute('volume',Format('%.2f',[FVolume/100]));\r\n\r\n    el := ElementHandle.firstChild;\r\n    if Assigned(el) then\r\n    begin\r\n      (el as TJSElement).setAttribute('src',url);\r\n      (el as TJSElement).setAttribute('type','video/mp4');\r\n    end;\r\n  end;\r\nend;\r\n\r\n{$HINTS ON}\r\n\r\n{ TCustomGroupBox }\r\n\r\nfunction TCustomGroupBox.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('SPAN');\r\n\r\n  FControlSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n  FCaptionSpan := TJSHTMLElement(document.createElement('SPAN'));\r\n\r\n  Result.appendChild(FControlSpan);\r\n  Result.appendChild(FCaptionSpan);\r\nend;\r\n\r\nprocedure TCustomGroupBox.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  Color := clBtnFace;\r\nend;\r\n\r\nprocedure TCustomGroupBox.UpdateElementData;\r\nbegin\r\n  inherited;\r\n  if Assigned(FCaptionSpan) then\r\n  begin\r\n    FCaptionSpan.innerHTML := FCaption;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomGroupBox.UpdateElementVisual;\r\nbegin\r\n  inherited;\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    ElementHandle.style.setProperty('overflow', 'visible');\r\n\r\n    ElementHandle.style.setProperty('white-space', 'nowrap');\r\n    ElementHandle.style.setProperty('display', 'inline-block');\r\n\r\n    ElementHandle.style.setProperty('webkit-user-select', 'none');\r\n    ElementHandle.style.setProperty('moz-user-select', 'none');\r\n    ElementHandle.style.setProperty('khtml-user-select', 'none');\r\n    ElementHandle.style.setProperty('ms-user-select', 'none');\r\n    ElementHandle.style.setProperty('user-select', 'none');\r\n\r\n    ElementHandle.style.setProperty('background-color', ColorToHTML(Color));\r\n    ElementHandle.style.setProperty('border-bottom','1px solid lightgray');\r\n\r\n    FCaptionSpan.style.setProperty('left','8px');\r\n    FCaptionSpan.style.setProperty('top','0px');\r\n    FCaptionSpan.style.setProperty('position','absolute');\r\n    FCaptionSpan.style.setProperty('background-color', ColorToHTML(Color));\r\n    FCaptionSpan.style.setProperty('zindex','100');\r\n\r\n    FControlSpan.style.setProperty('display','inline-block');\r\n    FControlSpan.style.setProperty('width','100%');\r\n    FControlSpan.style.setProperty('height','98%');\r\n    FControlSpan.style.setProperty('margin-top','8px');\r\n    FControlSpan.style.setProperty('border-style', 'solid');\r\n    FControlSpan.style.setProperty('border-width', '1px');\r\n    FControlSpan.style.setProperty('border-color', 'lightgray');\r\n    FControlSpan.style.setProperty('background-color', ColorToHTML(Color));\r\n  end;\r\nend;\r\n\r\n{ THTMLContainer }\r\n\r\nconstructor THTMLContainer.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FHTML := TStringList.Create;\r\n  FHTML.OnChange := HTMLChanged;\r\n  FScrollStyle := ssBoth;\r\nend;\r\n\r\nfunction THTMLContainer.CreateElement: TJSElement;\r\nbegin\r\n  Result := document.createElement('DIV');\r\nend;\r\n\r\ndestructor THTMLContainer.Destroy;\r\nbegin\r\n  FHTML.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure THTMLContainer.HTMLChanged(Sender: TObject);\r\nbegin\r\n  UpdateElement;\r\nend;\r\n\r\nprocedure THTMLContainer.SetHTML(const Value: TStringList);\r\nbegin\r\n  FHTML.Assign(Value);\r\nend;\r\n\r\nprocedure THTMLContainer.UpdateElement;\r\nbegin\r\n  inherited;\r\n  if not IsUpdating and Assigned(ElementHandle) then\r\n  begin\r\n    Container.innerHTML := FHTML.Text;\r\n\r\n    case ScrollStyle of\r\n    ssBoth: ElementHandle.style.setProperty('overflow','scroll');\r\n    ssNone: ElementHandle.style.setProperty('overflow','');\r\n    ssVertical: ElementHandle.style.setProperty('overflow-y','scroll');\r\n    ssHorizontal: ElementHandle.style.setProperty('overflow-x','scroll');\r\n    end;\r\n\r\n  end;\r\n\r\nend;\r\n\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.WebTools;\r\n\r\ninterface\r\n\r\nfunction DoubleToHTML(d: double): string;\r\n\r\nprocedure OutputDebugString(const s: string);\r\nfunction GetTickCount: longint;\r\nfunction GetQueryParam(AName: string): string;\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nfunction GetLocaleDecimalSeparator: string;\r\nfunction GetBrowserLocale: string;\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils;\r\n\r\nfunction DoubleToHTML(d: double): string;\r\nbegin\r\n  Result := Format('%g',[d]);\r\n  StringReplace(Result, ',','.',[rfReplaceAll]);\r\nend;\r\n\r\nprocedure OutputDebugString(const s: string);\r\nbegin\r\n  asm\r\n    console.log(s);\r\n  end;\r\nend;\r\n\r\nfunction GetTickCount: longint;\r\nvar\r\n  n: longint;\r\nbegin\r\n  asm\r\n    var d = new Date();\r\n    n = d.getTime();\r\n  end;\r\n\r\n  Result := n;\r\nend;\r\n\r\nfunction HasQueryParam(AName: string; var AValue: string): boolean;\r\nvar\r\n  found: boolean;\r\n  s: string;\r\nbegin\r\n  s := '';\r\n  asm\r\n    var query = window.location.search.substring(1);\r\n    var res = \"\";\r\n    found = false;\r\n    var vars = query.split('&');\r\n    for (var i = 0; i < vars.length; i++) {\r\n       var pair = vars[i].split('=');\r\n      if (decodeURIComponent(pair[0]) == AName) {\r\n          res = decodeURIComponent(pair[1]);\r\n          console.log(res);\r\n          found = true;\r\n       }\r\n    }\r\n    s = res;\r\n  end;\r\n\r\n  AValue := s;\r\n  Result := found;\r\nend;\r\n\r\nfunction GetQueryParam(AName: string): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  HasQueryParam(AName,res);\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction GetLocaleShortDateFormat(ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\n\r\nbegin\r\n  asm\r\n  var formats = {\r\n     \"ar-SA\" : \"dd/MM/yy\",\r\n     \"bg-BG\" : \"dd.M.yyyy\",\r\n     \"ca-ES\" : \"dd/MM/yyyy\",\r\n     \"zh-TW\" : \"yyyy/M/d\",\r\n     \"cs-CZ\" : \"d.M.yyyy\",\r\n     \"da-DK\" : \"dd-MM-yyyy\",\r\n     \"de-DE\" : \"dd.MM.yyyy\",\r\n     \"el-GR\" : \"d/M/yyyy\",\r\n     \"en-US\" : \"M/d/yyyy\",\r\n     \"fi-FI\" : \"d.M.yyyy\",\r\n     \"fr-FR\" : \"dd/MM/yyyy\",\r\n     \"he-IL\" : \"dd/MM/yyyy\",\r\n     \"hu-HU\" : \"yyyy. MM. dd.\",\r\n     \"is-IS\" : \"d.M.yyyy\",\r\n     \"it-IT\" : \"dd/MM/yyyy\",\r\n     \"ja-JP\" : \"yyyy/MM/dd\",\r\n     \"ko-KR\" : \"yyyy-MM-dd\",\r\n     \"nl-NL\" : \"d-M-yyyy\",\r\n     \"nb-NO\" : \"dd.MM.yyyy\",\r\n     \"pl-PL\" : \"yyyy-MM-dd\",\r\n     \"pt-BR\" : \"d/M/yyyy\",\r\n     \"ro-RO\" : \"dd.MM.yyyy\",\r\n     \"ru-RU\" : \"dd.MM.yyyy\",\r\n     \"hr-HR\" : \"d.M.yyyy\",\r\n     \"sk-SK\" : \"d. M. yyyy\",\r\n     \"sq-AL\" : \"yyyy-MM-dd\",\r\n     \"sv-SE\" : \"yyyy-MM-dd\",\r\n     \"th-TH\" : \"d/M/yyyy\",\r\n     \"tr-TR\" : \"dd.MM.yyyy\",\r\n     \"ur-PK\" : \"dd/MM/yyyy\",\r\n     \"id-ID\" : \"dd/MM/yyyy\",\r\n     \"uk-UA\" : \"dd.MM.yyyy\",\r\n     \"be-BY\" : \"dd.MM.yyyy\",\r\n     \"sl-SI\" : \"d.M.yyyy\",\r\n     \"et-EE\" : \"d.MM.yyyy\",\r\n     \"lv-LV\" : \"yyyy.MM.dd.\",\r\n     \"lt-LT\" : \"yyyy.MM.dd\",\r\n     \"fa-IR\" : \"MM/dd/yyyy\",\r\n     \"vi-VN\" : \"dd/MM/yyyy\",\r\n     \"hy-AM\" : \"dd.MM.yyyy\",\r\n     \"az-Latn-AZ\" : \"dd.MM.yyyy\",\r\n     \"eu-ES\" : \"yyyy/MM/dd\",\r\n     \"mk-MK\" : \"dd.MM.yyyy\",\r\n     \"af-ZA\" : \"yyyy/MM/dd\",\r\n     \"ka-GE\" : \"dd.MM.yyyy\",\r\n     \"fo-FO\" : \"dd-MM-yyyy\",\r\n     \"hi-IN\" : \"dd-MM-yyyy\",\r\n     \"ms-MY\" : \"dd/MM/yyyy\",\r\n     \"kk-KZ\" : \"dd.MM.yyyy\",\r\n     \"ky-KG\" : \"dd.MM.yy\",\r\n     \"sw-KE\" : \"M/d/yyyy\",\r\n     \"uz-Latn-UZ\" : \"dd/MM yyyy\",\r\n     \"tt-RU\" : \"dd.MM.yyyy\",\r\n     \"pa-IN\" : \"dd-MM-yy\",\r\n     \"gu-IN\" : \"dd-MM-yy\",\r\n     \"ta-IN\" : \"dd-MM-yyyy\",\r\n     \"te-IN\" : \"dd-MM-yy\",\r\n     \"kn-IN\" : \"dd-MM-yy\",\r\n     \"mr-IN\" : \"dd-MM-yyyy\",\r\n     \"sa-IN\" : \"dd-MM-yyyy\",\r\n     \"mn-MN\" : \"yy.MM.dd\",\r\n     \"gl-ES\" : \"dd/MM/yy\",\r\n     \"kok-IN\" : \"dd-MM-yyyy\",\r\n     \"syr-SY\" : \"dd/MM/yyyy\",\r\n     \"dv-MV\" : \"dd/MM/yy\",\r\n     \"ar-IQ\" : \"dd/MM/yyyy\",\r\n     \"zh-CN\" : \"yyyy/M/d\",\r\n     \"de-CH\" : \"dd.MM.yyyy\",\r\n     \"en-GB\" : \"dd/MM/yyyy\",\r\n     \"es-MX\" : \"dd/MM/yyyy\",\r\n     \"fr-BE\" : \"d/MM/yyyy\",\r\n     \"it-CH\" : \"dd.MM.yyyy\",\r\n     \"nl-BE\" : \"d/MM/yyyy\",\r\n     \"nn-NO\" : \"dd.MM.yyyy\",\r\n     \"pt-PT\" : \"dd-MM-yyyy\",\r\n     \"sr-Latn-CS\" : \"d.M.yyyy\",\r\n     \"sv-FI\" : \"d.M.yyyy\",\r\n     \"az-Cyrl-AZ\" : \"dd.MM.yyyy\",\r\n     \"ms-BN\" : \"dd/MM/yyyy\",\r\n     \"uz-Cyrl-UZ\" : \"dd.MM.yyyy\",\r\n     \"ar-EG\" : \"dd/MM/yyyy\",\r\n     \"zh-HK\" : \"d/M/yyyy\",\r\n     \"de-AT\" : \"dd.MM.yyyy\",\r\n     \"en-AU\" : \"d/MM/yyyy\",\r\n     \"es-ES\" : \"dd/MM/yyyy\",\r\n     \"fr-CA\" : \"yyyy-MM-dd\",\r\n     \"sr-Cyrl-CS\" : \"d.M.yyyy\",\r\n     \"ar-LY\" : \"dd/MM/yyyy\",\r\n     \"zh-SG\" : \"d/M/yyyy\",\r\n     \"de-LU\" : \"dd.MM.yyyy\",\r\n     \"en-CA\" : \"dd/MM/yyyy\",\r\n     \"es-GT\" : \"dd/MM/yyyy\",\r\n     \"fr-CH\" : \"dd.MM.yyyy\",\r\n     \"ar-DZ\" : \"dd-MM-yyyy\",\r\n     \"zh-MO\" : \"d/M/yyyy\",\r\n     \"de-LI\" : \"dd.MM.yyyy\",\r\n     \"en-NZ\" : \"d/MM/yyyy\",\r\n     \"es-CR\" : \"dd/MM/yyyy\",\r\n     \"fr-LU\" : \"dd/MM/yyyy\",\r\n     \"ar-MA\" : \"dd-MM-yyyy\",\r\n     \"en-IE\" : \"dd/MM/yyyy\",\r\n     \"es-PA\" : \"MM/dd/yyyy\",\r\n     \"fr-MC\" : \"dd/MM/yyyy\",\r\n     \"ar-TN\" : \"dd-MM-yyyy\",\r\n     \"en-ZA\" : \"yyyy/MM/dd\",\r\n     \"es-DO\" : \"dd/MM/yyyy\",\r\n     \"ar-OM\" : \"dd/MM/yyyy\",\r\n     \"en-JM\" : \"dd/MM/yyyy\",\r\n     \"es-VE\" : \"dd/MM/yyyy\",\r\n     \"ar-YE\" : \"dd/MM/yyyy\",\r\n     \"en-029\" : \"MM/dd/yyyy\",\r\n     \"es-CO\" : \"dd/MM/yyyy\",\r\n     \"ar-SY\" : \"dd/MM/yyyy\",\r\n     \"en-BZ\" : \"dd/MM/yyyy\",\r\n     \"es-PE\" : \"dd/MM/yyyy\",\r\n     \"ar-JO\" : \"dd/MM/yyyy\",\r\n     \"en-TT\" : \"dd/MM/yyyy\",\r\n     \"es-AR\" : \"dd/MM/yyyy\",\r\n     \"ar-LB\" : \"dd/MM/yyyy\",\r\n     \"en-ZW\" : \"M/d/yyyy\",\r\n     \"es-EC\" : \"dd/MM/yyyy\",\r\n     \"ar-KW\" : \"dd/MM/yyyy\",\r\n     \"en-PH\" : \"M/d/yyyy\",\r\n     \"es-CL\" : \"dd-MM-yyyy\",\r\n     \"ar-AE\" : \"dd/MM/yyyy\",\r\n     \"es-UY\" : \"dd/MM/yyyy\",\r\n     \"ar-BH\" : \"dd/MM/yyyy\",\r\n     \"es-PY\" : \"dd/MM/yyyy\",\r\n     \"ar-QA\" : \"dd/MM/yyyy\",\r\n     \"es-BO\" : \"dd/MM/yyyy\",\r\n     \"es-SV\" : \"dd/MM/yyyy\",\r\n     \"es-HN\" : \"dd/MM/yyyy\",\r\n     \"es-NI\" : \"dd/MM/yyyy\",\r\n     \"es-PR\" : \"dd/MM/yyyy\",\r\n     \"am-ET\" : \"d/M/yyyy\",\r\n     \"tzm-Latn-DZ\" : \"dd-MM-yyyy\",\r\n     \"iu-Latn-CA\" : \"d/MM/yyyy\",\r\n     \"sma-NO\" : \"dd.MM.yyyy\",\r\n     \"mn-Mong-CN\" : \"yyyy/M/d\",\r\n     \"gd-GB\" : \"dd/MM/yyyy\",\r\n     \"en-MY\" : \"d/M/yyyy\",\r\n     \"prs-AF\" : \"dd/MM/yy\",\r\n     \"bn-BD\" : \"dd-MM-yy\",\r\n     \"wo-SN\" : \"dd/MM/yyyy\",\r\n     \"rw-RW\" : \"M/d/yyyy\",\r\n     \"qut-GT\" : \"dd/MM/yyyy\",\r\n     \"sah-RU\" : \"MM.dd.yyyy\",\r\n     \"gsw-FR\" : \"dd/MM/yyyy\",\r\n     \"co-FR\" : \"dd/MM/yyyy\",\r\n     \"oc-FR\" : \"dd/MM/yyyy\",\r\n     \"mi-NZ\" : \"dd/MM/yyyy\",\r\n     \"ga-IE\" : \"dd/MM/yyyy\",\r\n     \"se-SE\" : \"yyyy-MM-dd\",\r\n     \"br-FR\" : \"dd/MM/yyyy\",\r\n     \"smn-FI\" : \"d.M.yyyy\",\r\n     \"moh-CA\" : \"M/d/yyyy\",\r\n     \"arn-CL\" : \"dd-MM-yyyy\",\r\n     \"ii-CN\" : \"yyyy/M/d\",\r\n     \"dsb-DE\" : \"d. M. yyyy\",\r\n     \"ig-NG\" : \"d/M/yyyy\",\r\n     \"kl-GL\" : \"dd-MM-yyyy\",\r\n     \"lb-LU\" : \"dd/MM/yyyy\",\r\n     \"ba-RU\" : \"dd.MM.yy\",\r\n     \"nso-ZA\" : \"yyyy/MM/dd\",\r\n     \"quz-BO\" : \"dd/MM/yyyy\",\r\n     \"yo-NG\" : \"d/M/yyyy\",\r\n     \"ha-Latn-NG\" : \"d/M/yyyy\",\r\n     \"fil-PH\" : \"M/d/yyyy\",\r\n     \"ps-AF\" : \"dd/MM/yy\",\r\n     \"fy-NL\" : \"d-M-yyyy\",\r\n     \"ne-NP\" : \"M/d/yyyy\",\r\n     \"se-NO\" : \"dd.MM.yyyy\",\r\n     \"iu-Cans-CA\" : \"d/M/yyyy\",\r\n     \"sr-Latn-RS\" : \"d.M.yyyy\",\r\n     \"si-LK\" : \"yyyy-MM-dd\",\r\n     \"sr-Cyrl-RS\" : \"d.M.yyyy\",\r\n     \"lo-LA\" : \"dd/MM/yyyy\",\r\n     \"km-KH\" : \"yyyy-MM-dd\",\r\n     \"cy-GB\" : \"dd/MM/yyyy\",\r\n     \"bo-CN\" : \"yyyy/M/d\",\r\n     \"sms-FI\" : \"d.M.yyyy\",\r\n     \"as-IN\" : \"dd-MM-yyyy\",\r\n     \"ml-IN\" : \"dd-MM-yy\",\r\n     \"en-IN\" : \"dd-MM-yyyy\",\r\n     \"or-IN\" : \"dd-MM-yy\",\r\n     \"bn-IN\" : \"dd-MM-yy\",\r\n     \"tk-TM\" : \"dd.MM.yy\",\r\n     \"bs-Latn-BA\" : \"d.M.yyyy\",\r\n     \"mt-MT\" : \"dd/MM/yyyy\",\r\n     \"sr-Cyrl-ME\" : \"d.M.yyyy\",\r\n     \"se-FI\" : \"d.M.yyyy\",\r\n     \"zu-ZA\" : \"yyyy/MM/dd\",\r\n     \"xh-ZA\" : \"yyyy/MM/dd\",\r\n     \"tn-ZA\" : \"yyyy/MM/dd\",\r\n     \"hsb-DE\" : \"d. M. yyyy\",\r\n     \"bs-Cyrl-BA\" : \"d.M.yyyy\",\r\n     \"tg-Cyrl-TJ\" : \"dd.MM.yy\",\r\n     \"sr-Latn-BA\" : \"d.M.yyyy\",\r\n     \"smj-NO\" : \"dd.MM.yyyy\",\r\n     \"rm-CH\" : \"dd/MM/yyyy\",\r\n     \"smj-SE\" : \"yyyy-MM-dd\",\r\n     \"quz-EC\" : \"dd/MM/yyyy\",\r\n     \"quz-PE\" : \"dd/MM/yyyy\",\r\n     \"hr-BA\" : \"d.M.yyyy.\",\r\n     \"sr-Latn-ME\" : \"d.M.yyyy\",\r\n     \"sma-SE\" : \"yyyy-MM-dd\",\r\n     \"en-SG\" : \"d/M/yyyy\",\r\n     \"ug-CN\" : \"yyyy-M-d\",\r\n     \"sr-Cyrl-BA\" : \"d.M.yyyy\",\r\n     \"es-US\" : \"M/d/yyyy\"\r\n  };\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = formats[loc] || 'dd/MM/yyyy';\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleLongDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(Date.UTC(2017, 0, 1)); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'long' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortDayName(DayOfWeek: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(Date.UTC(2017, 0, 1)); // Sunday\r\n    baseDate.setDate(baseDate.getDate() + DayOfWeek - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { weekday: 'short' });\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleLongMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(Date.UTC(2017, 0, 1)); // January\r\n    baseDate.setMonth(baseDate.getMonth() + Month - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'long' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleShortMonthName(Month: integer; ALocale: string = ''): string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var baseDate = new Date(Date.UTC(2017, 0, 1)); // January\r\n    baseDate.setMonth(baseDate.getMonth() + Month - 1);\r\n\r\n    var loc = \"\";\r\n    if (ALocale == '') { loc = navigator.language; }\r\n    else { loc = ALocale; }\r\n\r\n    res = baseDate.toLocaleDateString(loc, { month: 'short' });\r\n  end;\r\n\r\n  Result := res;\r\nend;\r\n\r\nfunction GetLocaleDecimalSeparator: string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    var n = 1.1;\r\n    n = n.toLocaleString().substring(1, 2);\r\n    res = n;\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\nfunction GetBrowserLocale: string;\r\nvar\r\n  res: string;\r\nbegin\r\n  asm\r\n    res = navigator.language\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\n\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Dialogs;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, Web, SysUtils, WEBLib.ExtCtrls, WebLib.WebTools;\r\n\r\ntype\r\n  TMsgDlgType = (mtWarning, mtError, mtInformation, mtConfirmation, mtCustom);\r\n  TMsgDlgBtn = (mbYes, mbNo, mbOK, mbCancel, mbAbort, mbRetry, mbIgnore,\r\n    mbAll, mbNoToAll, mbYesToAll, mbHelp, mbClose);\r\n  TMsgDlgButtons = set of TMsgDlgBtn;\r\n\r\n  TDialogResult = Integer;\r\n  TDialogResultProc = reference to procedure(AValue: TDialogResult);\r\n\r\n  TMessageDlg = class(TCustomControl)\r\n  private\r\n    FOpacity: double;\r\n    FLayer: TJSElement;\r\n    FDlg: TJSElement;\r\n    FMessage: string;\r\n    FMsgDlgType: TMSgDlgType;\r\n    FOnButtonClick: TNotifyEvent;\r\n    FOnClose: TNotifyEvent;\r\n    FButtons: TMsgDlgButtons;\r\n    FDialogProc: TDialogResultProc;\r\n    FDialogResult: TDialogResult;\r\n  protected\r\n    procedure BindEvents; override;\r\n    procedure SetDialogResult(const Value: TDialogResult);\r\n    function CreateButton(Caption: string): TJSHTMLElement;\r\n    function HandleButtonClick(Event: TJSMouseEvent): Boolean; virtual;\r\n    function HandleKeyDown(Event: TJSKeyBoardEvent): Boolean; virtual;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    procedure Close;\r\n    property DialogResult: TDialogResult read FDialogResult write SetDialogResult;\r\n    procedure Show;\r\n    function ShowDialog: Integer; overload; virtual;\r\n    function ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc = nil): TDialogResult; overload; virtual;\r\n  published\r\n    property Opacity: double read FOpacity write FOpacity;\r\n\r\n    property OnButtonClick: TNotifyEvent read FOnButtonClick write FOnButtonClick;\r\n    property OnClose: TNotifyEvent read FOnClose write FOnClose;\r\n  end;\r\n\r\n  TWaitMessage = class(TCustomControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FPicture: TURLPicture;\r\n    FOpacity: double;\r\n    procedure SetPicture(const Value: TURLPicture);\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n\r\n    procedure Show;\r\n    procedure Hide;\r\n  published\r\n    property Opacity: double read FOpacity write FOpacity;\r\n    property Picture: TURLPicture read FPicture write SetPicture;\r\n  end;\r\n\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nprocedure ShowMessage(const AMsg: string);\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nfunction Confirm(const Value: string): boolean;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms;\r\n\r\nvar\r\n  WebLibDlg: TMessageDlg;\r\n\r\nprocedure ShowMessage(const AMsg: string);\r\nbegin\r\n  asm\r\n    alert(AMsg);\r\n  end;\r\nend;\r\n\r\nfunction InputBox(const ACaption, APrompt, ADefault: string): string;\r\nvar\r\n  retvalue: string;\r\nbegin\r\n//\r\n  asm\r\n    retvalue = prompt(APrompt, ADefault);\r\n    if (retvalue == null) {\r\n      retvalue = \"\";\r\n    }\r\n  end;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction InputQuery(const ACaption, APrompt: string; var Value: string): Boolean; overload;\r\nvar\r\n  retvalue: boolean;\r\n  s: string;\r\nbegin\r\n  retvalue := true;\r\n  s := Value;\r\n\r\n  asm\r\n    var text = s;\r\n    s = prompt(APrompt, text);\r\n    if (s == null) {\r\n      retvalue = false;\r\n    }\r\n  end;\r\n\r\n  if retvalue then\r\n    Value := s;\r\n\r\n  Result := retvalue;\r\nend;\r\n\r\nfunction Confirm(const Value: string): boolean;\r\nvar\r\n  res: boolean;\r\nbegin\r\n  asm\r\n    res = confirm(Value);\r\n  end;\r\n  Result := res;\r\nend;\r\n\r\nprocedure MessageDlg(const Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons;  AResultProc: TDialogResultProc = nil);\r\nbegin\r\n  if not Assigned(WebLibDlg) then\r\n    WebLibDlg := TMessageDlg.Create(nil);\r\n\r\n  WebLibDlg.ShowDialog(Msg, DlgType, Buttons, AResultProc);\r\nend;\r\n\r\n{ TMessageDlg }\r\n\r\nprocedure TMessageDlg.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FMessage := '';\r\n  FMsgDlgType := mtInformation;\r\nend;\r\n\r\nprocedure TMessageDlg.BindEvents;\r\nbegin\r\n//\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog: integer;\r\nbegin\r\n  Result := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.ShowDialog(Msg: string; DlgType: TMsgDlgType; Buttons: TMsgDlgButtons; AProc: TDialogResultProc = nil): TDialogResult;\r\nbegin\r\n  Result := mrNone;\r\n  FButtons := Buttons;\r\n  FMessage := Msg;\r\n  FMsgDlgType := DlgType;\r\n  FDialogProc := AProc;\r\n  DialogResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TMessageDlg.CreateButton(Caption: string): TJSHTMLElement;\r\nbegin\r\n  Result := TJSHTMLElement(document.createElement('BUTTON'));\r\n  Result.innerHTML := Caption;\r\n  Result.style.setProperty('width', '100px');\r\n  Result.style.setProperty('margin-left', '5px');\r\n  Result.id := Caption;\r\n  Result.addEventListener('click', @HandleButtonClick);\r\n  Result.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  asm\r\n    setTimeout(function() {Result.focus();}, 1);\r\n  end;\r\nend;\r\n\r\nprocedure TMessageDlg.Show;\r\nvar\r\n  title, msg, icon, content, bar, edlg, eh, cancel: TJSHTMLElement;\r\n  MsgSymbol, MsgColor, MsgTitle, BorderColor, BarBGColor, BarHeight, Padding: string;\r\nbegin\r\n  Application.PushForm(Application.MainForm);\r\n\r\n  Padding := '5';\r\n  BarHeight := '26';\r\n  BarBGColor := '#f1f1f1';\r\n  BorderColor := '#ababab';\r\n  MsgSymbol := 'error_outline';\r\n  MsgColor := 'black';\r\n  MsgTitle := '';\r\n\r\n  case FMsgDlgType of\r\n    mtWarning: begin MsgSymbol := 'warning'; MsgColor := 'orange'; MsgTitle := 'Warning'; end;\r\n    mtError: begin MsgSymbol := 'cancel'; MsgColor := 'red'; MsgTitle := 'Error'; end;\r\n    mtInformation: begin MsgSymbol := 'info'; MsgColor := 'blue'; MsgTitle := 'Information'; end;\r\n    mtConfirmation: begin MsgSymbol := 'help'; MsgColor := 'blue'; MsgTitle := 'Confirm'; end;\r\n    mtCustom: begin MsgSymbol := ''; MsgColor := ''; MsgTitle := 'Custom'; end;\r\n  end;\r\n\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n  FLayer.addEventListener('keydown', @HandleKeyDown);\r\n\r\n  FDlg := document.createElement('DIV');\r\n  document.body.appendChild(FDlg);\r\n  edlg := TJSHTMLElement(FDlg);\r\n  edlg.style.setProperty('background-color', 'white');\r\n  edlg.style.setProperty('cursor', 'default');\r\n  edlg.style.setProperty('border', '1px solid ' + BorderColor);\r\n  edlg.style.setProperty('position', 'fixed');\r\n  edlg.style.setProperty('font-family', 'Arial');\r\n  edlg.style.setProperty('font-size', '10pt');\r\n  edlg.style.setProperty('min-width', '250px');\r\n  edlg.style.setProperty('min-height', '125px');\r\n  edlg.style.setProperty('max-width', '100%');\r\n  edlg.style.setProperty('max-height', '100%');\r\n  edlg.style.setProperty('top', '50%');\r\n  edlg.style.setProperty('left', '50%');\r\n  edlg.style.setProperty('transform', 'translate(-50%, -50%)');\r\n\r\n  cancel := TJSHTMLElement(document.createElement('DIV'));\r\n  cancel.innerHTML := '<i id=\"Cancel\" class=\"material-icons\" style=\"color:black!important;font-size:16px!important\">clear</i>';\r\n  cancel.id := 'Cancel';\r\n  cancel.style.setProperty('position', 'fixed');\r\n  cancel.style.setProperty('top', '0');\r\n  cancel.style.setProperty('right', '0');\r\n  cancel.style.setProperty('padding', Padding + 'px');\r\n  cancel.style.setProperty('height', BarHeight + 'px');\r\n  cancel.style.setProperty('line-height', BarHeight + 'px');\r\n  cancel.addEventListener('click', @HandleButtonClick);\r\n  edlg.appendChild(cancel);\r\n\r\n  title := TJSHTMLElement(document.createElement('DIV'));\r\n  title.innerHTML := MsgTitle;\r\n  title.style.setProperty('padding', Padding + 'px');\r\n  title.style.setProperty('height', BarHeight + 'px');\r\n  title.style.setProperty('line-height', BarHeight + 'px');\r\n  title.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n  edlg.appendChild(title);\r\n\r\n  msg := TJSHTMLElement(document.createElement('DIV'));\r\n  msg.style.setProperty('padding', Padding + 'px');\r\n  msg.style.setProperty('height', 'auto');\r\n  msg.style.setProperty('min-height', '50px');\r\n  msg.style.setProperty('border-bottom', '1px solid ' + BorderColor);\r\n\r\n  if FMsgDlgType <> mtCustom then\r\n  begin\r\n    icon := TJSHTMLElement(document.createElement('DIV'));\r\n    icon.innerHTML := '<i class=\"material-icons\" style=\"color:' + MsgColor + '!important;font-size:48px!important\">' + MsgSymbol + '</i>';\r\n    icon.style.setProperty('display', 'inline-block');\r\n    icon.style.setProperty('float', 'left');\r\n    icon.style.setProperty('padding-right', '15px');\r\n    msg.appendChild(icon);\r\n  end;\r\n\r\n  content := TJSHTMLElement(document.createElement('DIV'));\r\n  content.innerHTML := FMessage;\r\n  content.style.setProperty('height','auto');\r\n  content.style.setProperty('min-height','50px');\r\n  content.style.setProperty('white-space','pre-wrap');\r\n\r\n  msg.appendChild(content);\r\n\r\n  edlg.appendChild(msg);\r\n\r\n  bar := TJSHTMLElement(document.createElement('DIV'));\r\n  bar.style.setProperty('background-color', BarBGColor);\r\n  bar.style.setProperty('padding', Padding + 'px');\r\n  bar.style.setProperty('min-height', BarHeight + 'px');\r\n  bar.style.setProperty('height', 'auto');\r\n  bar.style.setProperty('line-height', BarHeight + 'px');\r\n  bar.style.setProperty('text-align', 'right');\r\n  edlg.appendChild(bar);\r\n\r\n  if FButtons = [] then\r\n    bar.appendChild(CreateButton('OK'))\r\n  else\r\n  begin\r\n    if mbYes in FButtons then\r\n      bar.appendChild(CreateButton('Yes'));\r\n\r\n    if mbNo in FButtons then\r\n      bar.appendChild(CreateButton('No'));\r\n\r\n    if mbOK in FButtons then\r\n      bar.appendChild(CreateButton('OK'));\r\n\r\n    if mbCancel in FButtons then\r\n      bar.appendChild(CreateButton('Cancel'));\r\n\r\n    if mbAbort in FButtons then\r\n      bar.appendChild(CreateButton('Abort'));\r\n\r\n    if mbRetry in FButtons then\r\n      bar.appendChild(CreateButton('Retry'));\r\n\r\n    if mbIgnore in FButtons then\r\n      bar.appendChild(CreateButton('Ignore'));\r\n\r\n    if mbAll in FButtons then\r\n      bar.appendChild(CreateButton('All'));\r\n\r\n    if mbNoToAll in FButtons then\r\n      bar.appendChild(CreateButton('NoToAll'));\r\n\r\n    if mbYesToAll in FButtons then\r\n      bar.appendChild(CreateButton('YesToAll'));\r\n\r\n    if mbHelp in FButtons then\r\n      bar.appendChild(CreateButton('Help'));\r\n\r\n    if mbClose in FButtons then\r\n      bar.appendChild(CreateButton('Close'));\r\n  end;\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\nend;\r\n\r\nprocedure TMessageDlg.SetDialogResult(const Value: TDialogResult);\r\nbegin\r\n  FDialogResult := Value;\r\n  if (FDialogResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TMessageDlg.Close;\r\nbegin\r\n  document.body.removeChild(FLayer);\r\n  document.body.removeChild(FDlg);\r\n\r\n//  Application.PopForm;\r\n\r\n  if Assigned(OnClose) then\r\n    OnClose(Self);\r\n\r\n  if Assigned(FDialogProc) then\r\n    FDialogProc(FDialogResult);\r\nend;\r\n\r\nfunction TMessageDlg.HandleButtonClick(Event: TJSMouseEvent): Boolean;\r\nvar\r\n  id: string;\r\nbegin\r\n  DialogResult := mrNone;\r\n\r\n  id := event.target['id'];\r\n\r\n  if id = 'Yes' then\r\n    DialogResult := mrYes\r\n  else if id = 'No' then\r\n    DialogResult := mrNo\r\n  else if id = 'OK' then\r\n    DialogResult := mrOK\r\n  else if id = 'Cancel' then\r\n    DialogResult := mrCancel\r\n  else if id = 'Abort' then\r\n    DialogResult := mrAbort\r\n  else if id = 'Retry' then\r\n    DialogResult := mrRetry\r\n  else if id = 'Ignore' then\r\n    DialogResult := mrIgnore\r\n  else if id = 'All' then\r\n    DialogResult := mrAll\r\n  else if id = 'NoToAll' then\r\n    DialogResult := mrNoToAll\r\n  else if id = 'YesToAll' then\r\n    DialogResult := mrYesToAll\r\n  else if id = 'Help' then\r\n    DialogResult := mrHelp\r\n  else if id = 'Close' then\r\n    DialogResult := mrClose;\r\n\r\n  if Assigned(OnButtonClick) then\r\n    OnButtonClick(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TMessageDlg.HandleKeyDown(Event: TJSKeyBoardEvent): Boolean;\r\nvar\r\n  k: Word;\r\nbegin\r\n  k := GetKeyCode(Event.Key);\r\n  if not Assigned(k) then\r\n    Exit;\r\n  if k = VK_ESCAPE then\r\n    DialogResult := mrCancel;\r\n  Result := true;\r\nend;\r\n\r\n{ TWaitMessage }\r\n\r\nprocedure TWaitMessage.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FOpacity := 0.2;\r\n  FPicture := TURLPicture.Create;\r\n\r\nend;\r\n\r\ndestructor TWaitMessage.Destroy;\r\nbegin\r\n  FPicture.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TWaitMessage.Hide;\r\nbegin\r\n  document.body.removeChild(FLayer);\r\nend;\r\n\r\nprocedure TWaitMessage.SetPicture(const Value: TURLPicture);\r\nbegin\r\n  FPicture.Assign(Value);\r\nend;\r\n\r\nprocedure TWaitMessage.Show;\r\nvar\r\n  eh,img,dv: TJSHTMLElement;\r\n  el: TJSElement;\r\nbegin\r\n  FLayer := document.createElement('SPAN');\r\n  document.body.appendChild(FLayer);\r\n  FLayer['tabindex'] := '0';\r\n\r\n  eh := TJSHTMLElement(FLayer);\r\n  eh.style.setProperty('background-color', 'black');\r\n  eh.style.setProperty('opacity', DoubleToHTML(Opacity));\r\n  eh.style.setProperty('top', '0');\r\n  eh.style.setProperty('left', '0');\r\n  eh.style.setProperty('right', '0');\r\n  eh.style.setProperty('bottom', '0');\r\n\r\n  eh.style.setProperty('webkit-user-select', 'none');\r\n  eh.style.setProperty('moz-user-select', 'none');\r\n  eh.style.setProperty('khtml-user-select', 'none');\r\n  eh.style.setProperty('ms-user-select', 'none');\r\n  eh.style.setProperty('user-select', 'none');\r\n  eh.style.setProperty('position', 'absolute');\r\n\r\n  el := document.createElement('DIV');\r\n  dv := TJSHTMLElement(el);\r\n  FLayer.appendChild(el);\r\n  dv.style.SetProperty('position','relative');\r\n  dv.style.SetProperty('width','100%');\r\n  dv.style.SetProperty('height','100%');\r\n\r\n  el := document.createElement('IMG');\r\n  img := TJSHTMLElement(el);\r\n  dv.appendChild(img);\r\n  img['src'] := FPicture.FileName;\r\n  img.style.setProperty('position','absolute');\r\n  img.style.setProperty('top', '0');\r\n  img.style.setProperty('left', '0');\r\n  img.style.setProperty('right', '0');\r\n  img.style.setProperty('bottom', '0');\r\n  img.style.setProperty('margin', 'auto');\r\nend;\r\n\r\ninitialization\r\n  WebLibDlg := nil;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Forms;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, WEBLib.Graphics, WEBLib.Controls, WEBLib.Modules, WEBLib.Lang,\r\n  Web\r\n  {$IFDEF SINGLEINSTANCE}\r\n  , JS, WEBLib.WebSocketClient\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  idOK       = 1;\r\n  idCancel   = 2;\r\n  idAbort    = 3;\r\n  idRetry    = 4;\r\n  idIgnore   = 5;\r\n  idYes      = 6;\r\n  idNo       = 7;\r\n  idClose    = 8;\r\n  idHelp     = 9;\r\n  idTryAgain = 10;\r\n  idContinue = 11;\r\n  mrNone     = 0;\r\n  mrOk       = idOk;\r\n  mrCancel   = idCancel;\r\n  mrAbort    = idAbort;\r\n  mrRetry    = idRetry;\r\n  mrIgnore   = idIgnore;\r\n  mrYes      = idYes;\r\n  mrNo       = idNo;\r\n  mrClose    = idClose;\r\n  mrHelp     = idHelp;\r\n  mrTryAgain = idTryAgain;\r\n  mrContinue = idContinue;\r\n  mrAll      = mrContinue + 1;\r\n  mrNoToAll  = mrAll + 1;\r\n  mrYesToAll = mrNoToAll + 1;\r\n\r\ntype\r\n  TCustomForm = class;\r\n  TCloseAction = (caNone, caHide, caFree, caMinimize);\r\n  TModalResult = Integer;\r\n  TFormStyle = (fsNormal, fsStayOnTop);\r\n  TNavigationTarget = (ntBlank, ntPage);\r\n\r\n  TOnPaintEvent = TNotifyEvent;\r\n  TCloseEvent = procedure(Sender: TObject; var Action: TCloseAction) of object;\r\n  TCloseQueryEvent = procedure(Sender: TObject; var CanClose: Boolean) of object;\r\n\r\n  TModalResultProc = reference to procedure(AValue: TModalResult);\r\n  TFormCreatedProc = reference to procedure(AForm: TObject);\r\n\r\n  TWindowState = (wsNormal, wsMinimized, wsMaximized);\r\n\r\n  TCustomForm = class(TWinControl)\r\n  private\r\n    FLayer: TJSElement;\r\n    FPopup: Boolean;\r\n    FFormFileName: string;\r\n    FFormContent: string;\r\n    FFormContainer: string;\r\n    FFormElement: string;\r\n    FFormStyle: TFormStyle;\r\n    FOnCreate: TNotifyEvent;\r\n    FOnResize: TNotifyEvent;\r\n    FOnShow: TNotifyEvent;\r\n    FModalResult: TModalResult;\r\n    FOnPaint: TOnPaintEvent;\r\n    FOnDeactivate: TNotifyEvent;\r\n    FOnCloseQuery: TCloseQueryEvent;\r\n    FOnClose: TCloseEvent;\r\n    FModalProc: TModalResultProc;\r\n    FCreatedProc: TFormCreatedProc;\r\n    FWindowState: TWindowState;\r\n    FCaption: string;\r\n    FIsResizing: boolean;\r\n    FOnScroll: TNotifyEvent;\r\n    FOnUnload: TNotifyEvent;\r\n    function DoResize(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoLoaded(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoScroll(Event: TEventListenerEvent): boolean; virtual;\r\n    function DoUnload(Event: TEventListenerEvent): boolean; virtual;\r\n    procedure SetModalResult(const Value: TModalResult);\r\n    function GetFormStyle: TFormStyle;\r\n    procedure SetFormStyle(const Value: TFormStyle);\r\n    function GetCanvas: TCanvas;\r\n    procedure SetCaption(const AValue: string);\r\n  protected\r\n    procedure Resize; reintroduce; virtual;\r\n    procedure Loaded; override;\r\n    procedure DoClose(var CloseAction: TCloseAction); virtual;\r\n    procedure BindEvents; override;\r\n    procedure UnbindEvents; override;\r\n    procedure DoExit; override;\r\n    procedure DoCreate; virtual;\r\n    procedure DoShow; virtual;\r\n    procedure Paint; virtual;\r\n    function HandleDoClick(Event: TJSMouseEvent): Boolean; reintroduce; virtual;\r\n    function GetWidth: Integer; override;\r\n    function GetHeight: Integer; override;\r\n    function GetLeft: Integer; override;\r\n    function GetTop: Integer; override;\r\n    function CreateElement: TJSElement; override;\r\n    procedure UpdateElement; override;\r\n    function ContainerElement: TJSElement; override;\r\n    function FormContainerElement: TJSElement; virtual;\r\n    function GetElementBindHandle: TJSEventTarget; override;\r\n    function GetElementHandle: TJSHTMLElement; override;\r\n    function CloseQuery: Boolean; virtual;\r\n    procedure LoadDFMValues; virtual;\r\n    procedure Init; virtual;\r\n    property FormContent: string read FFormContent write FFormContent;\r\n    property FormFileName: string read FFormFileName write FFormFileName;\r\n    property WindowState: TWindowState read FWindowState write FWindowState;\r\n    function IsFocused: Boolean; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    constructor Create(id: string); overload; override;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer = 0); overload; virtual;\r\n    constructor CreateNew(AFileName: string); overload; virtual;\r\n    constructor CreateNew; overload; virtual;\r\n    constructor CreateNew(AProc: TFormCreatedProc); overload; virtual;\r\n    constructor CreateNew(AElementID: string; AProc: TFormCreatedProc); overload; virtual;\r\n\r\n    destructor Destroy; override;\r\n    procedure Close; virtual;\r\n    procedure PreventDefault; reintroduce;\r\n    property ModalResult: TModalResult read FModalResult write SetModalResult;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    procedure Show;\r\n    function ShowModal: Integer; overload; virtual;\r\n    function ShowModal(AProc: TModalResultProc): TModalResult; overload; virtual;\r\n    property Caption: string read FCaption write SetCaption;\r\n    property Color;\r\n    property FormContainer: string read FFormContainer write FFormContainer;\r\n    property FormStyle: TFormStyle read GetFormStyle write SetFormStyle;\r\n    property IsResizing: boolean read FIsResizing;\r\n    property Popup: boolean read FPopup write FPopup;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnClose: TCloseEvent read FOnClose write FOnClose;\r\n    property OnCloseQuery: TCloseQueryEvent read FOnCloseQuery write FOnCloseQuery;\r\n    property OnCreate: TNotifyEvent read FOnCreate write FOnCreate;\r\n    property OnDeactivate: TNotifyEvent read FOnDeactivate write FOnDeactivate;\r\n    property OnPaint: TOnPaintEvent read FOnPaint write FOnPaint;\r\n    property OnResize: TNotifyEvent read FOnResize write FOnResize;\r\n    property OnScroll: TNotifyEvent read FOnScroll write FOnScroll;\r\n    property OnShow: TNotifyEvent read FOnShow write FOnShow;\r\n    property OnUnload: TNotifyEvent read FOnUnload write FOnUnload;\r\n  end;\r\n\r\n  TFormClass = class of TForm;\r\n  TForm = class(TCustomForm)\r\n  published\r\n    property Caption;\r\n    property Color;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnResize;\r\n    property OnShow;\r\n    property OnScroll;\r\n    property OnPaint;\r\n    property FormStyle;\r\n    property OnDeactivate;\r\n    property OnClose;\r\n    property OnCloseQuery;\r\n    property OnTouchStart;\r\n    property OnTouchMove;\r\n    property OnTouchEnd;\r\n    property OnUnload;\r\n  end;\r\n  TWebForm = TForm;\r\n\r\n  TApplication = class(TControl)\r\n  private\r\n    FMainFormOnTaskBar: Boolean;\r\n    FLastReq: TJSXMLHttpRequest;\r\n    {$IFDEF SINGLEINSTANCE}\r\n    FWebSocket: TSocketClient;\r\n    {$ENDIF}\r\n    FMainForm: TCustomForm;\r\n    FFormStack: TList;\r\n    FParameters: TStrings;\r\n    FIsRedirect: boolean;\r\n    FLanguage: TUILanguage;\r\n    FOnImageCacheReady: TNotifyEvent;\r\n    function DoFormLoad(Event: TEventListenerEvent): boolean;\r\n    function DoFormAbort(Event: TEventListenerEvent): boolean;\r\n    procedure SetLanguage(const Value: TUILanguage);\r\n    {$IFDEF SINGLEINSTANCE}\r\n    procedure DoGetDataReceived(Sender: TObject; Origin: string; Data: TJSObject);\r\n    procedure DoGetConnected(Sender: TObject);\r\n    {$ENDIF}\r\n  protected\r\n    function GetFormExtension: string;\r\n    procedure ReloadForm;\r\n  public\r\n    procedure PushForm(AForm: TCustomForm);\r\n    function PopForm: TCustomForm;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function CreateNewForm(AInstanceClass: TFormClass): TCustomForm;\r\n    procedure CreateForm(AInstanceClass: TFormClass; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference); overload;\r\n    procedure CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc); overload;\r\n    procedure CreateForm(AInstanceClass: TDataModuleClass; var AReference); overload;\r\n    procedure LoadForm(AForm: TCustomForm; AFormFile: string); virtual;\r\n    procedure Initialize;\r\n    procedure InitFormatSettings(const BrowserLocale: string);\r\n    procedure Run;\r\n    procedure Navigate(const AURL: string; ATarget: TNavigationTarget = ntBlank);\r\n    property MainForm: TCustomForm read FMainForm;\r\n    property MainFormOnTaskBar: boolean read FMainFormOnTaskBar write FMainFormOnTaskBar;\r\n    property Parameters: TStrings read FParameters;\r\n    property Language: TUILanguage read FLanguage write SetLanguage;\r\n    property OnImageCacheReady: TNotifyEvent read FOnImageCacheReady write FOnImageCacheReady;\r\n  end;\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nprocedure Log(v: JSValue); overload;\r\nprocedure Log(arr: array of JSValue); overload;\r\n\r\nvar\r\n  Application: TApplication;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Dialogs, WEBLib.WebTools;\r\n\r\nconst\r\n  cBodyTag = 'body';\r\n  cHTMLExt = '.html';\r\n\r\nprocedure Log(v: JSValue);\r\nbegin\r\n  asm\r\n    console.log(v);\r\n  end;\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure Log(arr: array of JSValue);\r\nvar\r\n  i: integer;\r\n  s,su: string;\r\nbegin\r\n  s := '[';\r\n  for i := 0 to length(arr) - 1 do\r\n  begin\r\n    asm\r\n      function isPrimitive(test) {\r\n        return (test !== Object(test));\r\n      };\r\n\r\n      if (isPrimitive(arr[i])) {\r\n         var su = arr[i].toString();\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + su;\r\n         }\r\n      else\r\n      {\r\n        console.log(arr[i]);\r\n         if (s != \"[\") { s = s + \",\"; }\r\n         s = s + \"#object\";\r\n      }\r\n    end;\r\n  end;\r\n\r\n  s := s + ']';\r\n\r\n  log(s);\r\nend;\r\n{$HINTS ON}\r\n\r\nfunction GetParentForm(AControl: TControl): TCustomForm;\r\nvar\r\n  FOwner: TComponent;\r\nbegin\r\n  Result := nil;\r\n\r\n  FOwner := AControl;\r\n\r\n  while Assigned(FOwner) and not (FOwner is TCustomForm) do\r\n  begin\r\n    FOwner := FOwner.Owner;\r\n  end;\r\n\r\n  if Assigned(FOwner) and (FOwner is TCustomForm) then\r\n    Result := (FOwner as TCustomForm);\r\nend;\r\n\r\n\r\n{ TCustomForm }\r\n\r\nprocedure TCustomForm.BindEvents;\r\nbegin\r\n  inherited;\r\n  TJSEventTarget(window).addEventListener('resize', @DoResize);\r\n  TJSEventTarget(window).addEventListener('load', @DoLoaded);\r\n  TJSEventTarget(document).addEventListener('scroll', @DoScroll);\r\n  TJSEventTarget(window).addEventListener('unload', @DoUnload);\r\nend;\r\n\r\nprocedure ReleaseForm(AForm: TCustomForm);\r\nbegin\r\n  AForm.Free;\r\n  AForm := nil;\r\nend;\r\n\r\nprocedure TCustomForm.Close;\r\nvar\r\n  lAction: TCloseAction;\r\nbegin\r\n  if CloseQuery then\r\n  begin\r\n    ClearControls;\r\n    UnbindEvents;\r\n\r\n    lAction := caHide;\r\n\r\n    if Assigned(OnClose) then\r\n      OnClose(Self, lAction);\r\n\r\n    if lAction <> caNone then\r\n    begin\r\n      if (FormFileName = '') then\r\n      begin\r\n        if Assigned(FLayer) then\r\n        begin\r\n          FormContainerElement.removeChild(FLayer);\r\n          FLayer := nil;\r\n        end;\r\n\r\n        if FFormElement <> '' then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n        else\r\n          if Assigned(Container) then\r\n          begin\r\n            FormContainerElement.removeChild(Container);\r\n            Container := nil;\r\n          end;\r\n      end\r\n      else\r\n      begin\r\n        if FFormElement <> '' then\r\n        begin\r\n          Container.innerHTML := '';\r\n          Container := nil;\r\n        end\r\n      end;\r\n\r\n      if FFormElement = '' then\r\n        Application.PopForm;\r\n\r\n      DoClose(lAction);\r\n      if (lAction = caFree) and not (csDestroying in ComponentState) then\r\n        ReleaseForm(Self);\r\n\r\n      Visible := False;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.CloseQuery: Boolean;\r\nbegin\r\n  Result := True;\r\n  if Assigned(FOnCloseQuery) then\r\n    FOnCloseQuery(Self, Result);\r\nend;\r\n\r\nfunction TCustomForm.ContainerElement: TJSElement;\r\nbegin\r\n  Result := FormContainerElement;\r\nend;\r\n\r\nconstructor TCustomForm.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FFormFileName := '';\r\n  FPopup := True;\r\nend;\r\n\r\nfunction TCustomForm.CreateElement: TJSElement;\r\nvar\r\n  eh: TJSHTMLElement;\r\nbegin\r\n  if FPopup then\r\n  begin\r\n    Result := document.createElement('SPAN');\r\n    FLayer := document.createElement('SPAN');\r\n    document.body.appendChild(FLayer);\r\n\r\n    eh := TJSHTMLElement(FLayer);\r\n    eh.addEventListener('click', @HandleDoClick);\r\n\r\n    eh.style.setProperty('top', '0');\r\n    eh.style.setProperty('left', '0');\r\n    eh.style.setProperty('right', '0');\r\n    eh.style.setProperty('bottom', '0');\r\n\r\n    eh.style.setProperty('webkit-user-select', 'none');\r\n    eh.style.setProperty('moz-user-select', 'none');\r\n    eh.style.setProperty('khtml-user-select', 'none');\r\n    eh.style.setProperty('ms-user-select', 'none');\r\n    eh.style.setProperty('user-select', 'none');\r\n    eh.style.setProperty('position', 'absolute');\r\n  end\r\n  else\r\n  begin\r\n    Result := FormContainerElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.LoadDFMValues;\r\nbegin\r\nend;\r\n\r\nprocedure TCustomForm.Init;\r\nbegin\r\nend;\r\n\r\nfunction TCustomForm.IsFocused: Boolean;\r\nbegin\r\n  // form is not focused only controls\r\n  Result := false;\r\nend;\r\n\r\nprocedure TCustomForm.Resize;\r\nvar\r\n  i: integer;\r\nbegin\r\n  FIsResizing := true;\r\n\r\n  AlignControl(Self);\r\n\r\n  if Assigned(FOnResize) then\r\n    FOnResize(Self);\r\n\r\n  FIsResizing := false;\r\n\r\n  if not IsUpdating then\r\n  begin\r\n    if (OrigRect.Left = -1) and (OrigRect.Top = -1) then\r\n      InitAnchoring;\r\n\r\n    for i := 0 to ControlCount - 1 do\r\n      Controls[i].UpdateAnchoring;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetCaption(const AValue: string);\r\nbegin\r\n  if FCaption <> AValue then\r\n  begin\r\n    FCaption := AValue;\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.SetFormStyle(const Value: TFormStyle);\r\nbegin\r\n  FFormStyle := Value;\r\nend;\r\n\r\nprocedure TCustomForm.SetModalResult(const Value: TModalResult);\r\nbegin\r\n  FModalResult := Value;\r\n  if (FModalResult <> mrNone) then\r\n    Close;\r\nend;\r\n\r\nprocedure TCustomForm.Show;\r\nbegin\r\n\r\n  if (FormFileName = '') then\r\n  begin\r\n    document.body.appendChild(Container);\r\n  end;\r\n\r\n  Visible := True;\r\n\r\n  DoShow;\r\nend;\r\n\r\nfunction TCustomForm.ShowModal: Integer;\r\nbegin\r\n  Result := mrNone;\r\n  Show;\r\nend;\r\n\r\nfunction TCustomForm.ShowModal(AProc: TModalResultProc): TModalResult;\r\nbegin\r\n  Result := mrNone;\r\n  FModalProc := AProc;\r\n  ModalResult := mrNone;\r\n  Show;\r\nend;\r\n\r\nprocedure TCustomForm.UnbindEvents;\r\nbegin\r\n  inherited;\r\n  if Assigned(FLayer) then\r\n    FLayer.removeEventListener('click', @HandleDoClick);\r\n\r\n  TJSEventTarget(window).removeEventListener('resize', @DoResize);\r\n  TJSEventTarget(window).removeEventListener('load', @DoLoaded);\r\n  TJSEventTarget(document).removeEventListener('scroll', @DoScroll);\r\n  TJSEventTarget(window).removeEventListener('unload', @DoUnload);\r\nend;\r\n\r\nprocedure TCustomForm.UpdateElement;\r\nvar\r\n  clr: string;\r\n  i: integer;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    if FCaption <> '' then\r\n      window.document.title := FCaption;\r\n\r\n    clr := ColorToHtml(Color);\r\n\r\n    TJSHTMLElement(ElementHandle).style.setProperty('background-Color',clr);\r\n\r\n    for i := 0 to ComponentCount - 1 do\r\n    begin\r\n      if Components[i] is TCSSCodeManager then\r\n      begin\r\n\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.Loaded;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TCustomForm.Paint;\r\nbegin\r\n  //\r\nend;\r\n\r\nprocedure TCustomForm.PreventDefault;\r\nbegin\r\n  ElementEvent.preventDefault();\r\nend;\r\n\r\nfunction TCustomForm.DoResize(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  CreateControl;\r\n  Resize;\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.GetCanvas: TCanvas;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\nfunction TCustomForm.GetElementBindHandle: TJSEventTarget;\r\nbegin\r\n  Result := TJSEventTarget(window);\r\nend;\r\n\r\nfunction TCustomForm.GetElementHandle: TJSHTMLElement;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetElementHandle\r\n  else\r\n    Result := TJSHTMLElement(FormContainerElement);\r\nend;\r\n\r\nfunction TCustomForm.GetFormStyle: TFormStyle;\r\nbegin\r\n  Result := FFormStyle;\r\nend;\r\n\r\nfunction TCustomForm.GetHeight: Integer;\r\nvar\r\n  d: integer;\r\n  s: string;\r\n  css: TJSCSSStyleDeclaration;\r\n  el: TJSHTMLElement;\r\n  dr: TJSDOMRect;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.bottom - dr.top);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-top');\r\n    s := Copy(s,1,Length(s)- 2);\r\n    d := StrToInt(s) - 2; // div 2;\r\n    Result := window.innerHeight - d\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n      Result := inherited GetHeight\r\n    else\r\n    begin\r\n      Result := Round(ElementHandle.offsetHeight);\r\n      if Result = 0 then\r\n        Result:= window.innerHeight;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.GetLeft: Integer;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetLeft\r\n  else\r\n    Result := Round(ElementHandle.offsetLeft);\r\nend;\r\n\r\nfunction TCustomForm.GetTop: Integer;\r\nbegin\r\n  if FPopup then\r\n    Result := inherited GetTop\r\n  else\r\n    Result := Round(ElementHandle.offsetTop);\r\nend;\r\n\r\nfunction TCustomForm.GetWidth: Integer;\r\nvar\r\n  d: integer;\r\n  dr: TJSDOMRect;\r\n  s: string;\r\n  el: TJSHTMLElement;\r\n  css: TJSCSSStyleDeclaration;\r\nbegin\r\n  if (FFormElement <> '') then\r\n  begin\r\n    el := TJSHTMLElement(document.getElementById(FFormElement));\r\n    if Assigned(el) then\r\n    begin\r\n      dr := el.getBoundingClientRect;\r\n      Result := Round(dr.right - dr.left);\r\n      Exit;\r\n    end\r\n  end;\r\n\r\n  if (ElementHandle = document.body) then\r\n  begin\r\n    css := window.getComputedStyle(ElementHandle);\r\n    s := css.getPropertyValue('margin-left');\r\n    s := Copy(s,1,Length(s) - 2);\r\n    d := StrToInt(s) - 2;\r\n\r\n    Result := window.innerWidth - d + 4;\r\n  end\r\n  else\r\n  begin\r\n    if FPopup then\r\n      Result := inherited GetWidth\r\n    else\r\n    begin\r\n      Result := Round(ElementHandle.offsetWidth);\r\n      if Result = 0 then\r\n        Result := window.innerWidth;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.HandleDoClick(Event: TJSMouseEvent): Boolean;\r\nbegin\r\n  Event.stopPropagation;\r\n  Close;\r\n  Result := True;\r\nend;\r\n\r\nprocedure TCustomForm.DoClose(var CloseAction: TCloseAction);\r\nbegin\r\n  if Assigned(FModalProc) and (CloseAction <> caNone) then\r\n  begin\r\n    FModalProc(FModalResult);\r\n    FModalProc := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TCustomForm.DoCreate;\r\nbegin\r\n  BeginUpdate;\r\n  LoadDFMValues;\r\n\r\n  Loaded;\r\n\r\n  if Assigned(OnCreate) then\r\n    OnCreate(Self);\r\n\r\n  EndUpdate;\r\n\r\n  AlignControl(Self);\r\n\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\nprocedure TCustomForm.DoExit;\r\nbegin\r\n  inherited;\r\n  if FPopup then\r\n    Close;\r\nend;\r\n\r\nfunction TCustomForm.DoScroll(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnScroll) then\r\n    OnScroll(Self);\r\n\r\n  Result := true;\r\nend;\r\n\r\nprocedure TCustomForm.DoShow;\r\nbegin\r\n  if Assigned(OnShow) then\r\n    OnShow(Self);\r\nend;\r\n\r\nfunction TCustomForm.DoUnload(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  if Assigned(OnUnload) then\r\n    OnUnload(Self);\r\n  Result := true;\r\nend;\r\n\r\nfunction TCustomForm.FormContainerElement: TJSElement;\r\nbegin\r\n  if FormContainer <> '' then\r\n  begin\r\n    ElementID := FormContainer;\r\n    Result := document.getElementById(FormContainer);\r\n    if not Assigned(Result) then\r\n      Result := document.body;\r\n  end\r\n  else\r\n  begin\r\n    Result := document.body;\r\n  end;\r\nend;\r\n\r\nfunction TCustomForm.DoLoaded(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  Resize;\r\n  InitAnchoring;\r\n  Result := true;\r\nend;\r\n\r\ndestructor TCustomForm.Destroy;\r\nbegin\r\n  if Visible then\r\n    Close;\r\n\r\n  inherited;\r\n\r\n  if Assigned(FLayer) then\r\n  begin\r\n    FormContainerElement.removeChild(FLayer);\r\n    FLayer := nil;\r\n  end;\r\nend;\r\n\r\nconstructor TCustomForm.Create(id: string);\r\nbegin\r\n  inherited Create(id);\r\n  FFormElement := '';\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  DoCreate;\r\nend;\r\n\r\nprocedure TCustomForm.CreateInitialize;\r\nbegin\r\n  inherited;\r\n  FModalResult := mrNone;\r\n  FFormStyle := fsNormal;\r\n  Color := clWhite;\r\n\r\n  TJSEventTarget(window).addEventListener('load', @DoLoaded);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AOwner: TComponent; Dummy: Integer = 0);\r\nbegin\r\n  Create(AOwner);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew;\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AFileName: string);\r\nbegin\r\n  inherited Create(cBodyTag);\r\n  FormFileName := AFileName;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AProc: TFormCreatedProc);\r\nbegin\r\n  FCreatedProc := AProc;\r\n  CreateNew;\r\nend;\r\n\r\nconstructor TCustomForm.CreateNew(AElementID: string; AProc: TFormCreatedProc);\r\nvar\r\n  AFileName: string;\r\nbegin\r\n  inherited Create(AElementID);\r\n  FCreatedProc := AProc;\r\n  FFormElement := AElementID;\r\n  AFileName := ClassType.UnitName + cHTMLExt;\r\n  Application.LoadForm(Self, AFileName);\r\nend;\r\n\r\n\r\n{ TApplication }\r\n\r\nfunction TApplication.CreateNewForm(AInstanceClass: TFormClass): TCustomForm;\r\nbegin\r\n  Result := AInstanceClass.Create(cBodyTag);\r\n  //\r\nend;\r\n\r\nprocedure TApplication.LoadForm(AForm: TCustomForm; AFormFile: string);\r\nbegin\r\n  if Assigned(FMainForm) then\r\n    PushForm(FMainForm);\r\n\r\n  FMainForm := AForm;\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load',@DoFormLoad);\r\n  FLastReq.addEventListener('abort',@DoFormAbort);\r\n  FLastReq.open('GET', AFormFile);\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.Navigate(const AURL: string; ATarget: TNavigationTarget );\r\nbegin\r\n  if ATarget = ntBlank then\r\n    window.open(AURL, '_blank')\r\n  else\r\n    window.location.href := AURL;\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference);\r\nbegin\r\n  CreateForm(AInstanceClass, AElementID, AReference, nil);\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; AElementID: string; var AReference; AProc: TFormCreatedProc);\r\nvar\r\n  lFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    el: TJSHTMLElement;\r\n    AForm: TForm;\r\n  begin\r\n    // HTML of the form being loaded\r\n    el := TJSHTMLElement(document.getElementById(AElementID));\r\n    el.innerHTML := FLastReq.responseText;\r\n\r\n    //if Assigned(FMainForm) then\r\n    //  PushForm(FMainForm);\r\n\r\n    AForm := AInstanceClass.Create(AElementID);\r\n    AForm.FormFileName := lFileName;\r\n    AForm.FormContainer := AElementID;\r\n    AForm.FFormElement := AElementID;\r\n    AForm.CreateControl;\r\n    AForm.Container := el;\r\n    AForm.Init;\r\n    AReference := AForm;\r\n    if Assigned(AProc) then\r\n      AProc(AForm);\r\n\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  if FIsRedirect then\r\n    Exit;\r\n\r\n  lFileName := AInstanceClass.UnitName + GetFormExtension;\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.ReloadForm;\r\nvar\r\n  lFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  var\r\n    i: integer;\r\n    ctl: TControl;\r\n    s: string;\r\n    sl: TStringList;\r\n\r\n  begin\r\n    sl := TStringList.Create;\r\n\r\n    // persist control state\r\n    for i := FMainForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FMainForm.Controls[i];\r\n      ctl.PersistInHTML;\r\n      ctl.ElementHandle.Id := ctl.Name;\r\n      s := ctl.Name +'='+ctl.ElementHandle.outerHTML;\r\n      sl.Add(s);\r\n    end;\r\n\r\n    for i := FMainForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FMainForm.Controls[i];\r\n      FMainForm.RemoveComponent(ctl);\r\n      ctl.Free;\r\n    end;\r\n\r\n    FMainForm.ClearControls;\r\n    FMainForm.UnbindEvents;\r\n\r\n    // HTML of the form being loaded\r\n    document.body.innerHTML := FLastReq.responseText;\r\n\r\n    FMainForm.CreateControl;\r\n    FMainForm.DoCreate;\r\n    FMainForm.Init;\r\n\r\n    // persist control state\r\n    for i := FMainForm.ControlCount - 1 downto 0 do\r\n    begin\r\n      ctl := FMainForm.Controls[i];\r\n      s := sl.Values[ctl.Name];\r\n      ctl.ElementHandle.outerHTML := s;\r\n      ctl.Container := document.getElementById(ctl.Name);\r\n      ctl.BindEvents;\r\n    end;\r\n\r\n    sl.Free;\r\n\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  lFileName := FMainForm.UnitName + GetFormExtension;\r\n\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  FLastReq.send;\r\nend;\r\n\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TFormClass; var AReference);\r\nvar\r\n  lFileName: string;\r\n\r\n  function DoStatusCreate(Event: TEventListenerEvent): boolean;\r\n  begin\r\n    // HTML of the form being loaded\r\n    document.body.innerHTML := FLastReq.responseText;\r\n\r\n    if Assigned(FMainForm) then\r\n      PushForm(FMainForm);\r\n\r\n    FMainForm := AInstanceClass.Create(cBodyTag);\r\n    FMainForm.FormFileName := lFileName;\r\n    FMainForm.CreateControl;\r\n    FMainForm.Init;\r\n    AReference := FMainForm;\r\n    Result := true;\r\n  end;\r\n\r\nbegin\r\n  if FIsRedirect then\r\n    Exit;\r\n\r\n  lFileName := AInstanceClass.UnitName + GetFormExtension;\r\n  FLastReq := TJSXMLHttpRequest.new;\r\n  FLastReq.addEventListener('load', @DoStatusCreate);\r\n  FLastReq.open('GET', lFileName);\r\n  FLastReq.setRequestHeader('Cache-Control', 'no-cache');\r\n  FLastReq.send;\r\nend;\r\n\r\nprocedure TApplication.CreateForm(AInstanceClass: TDataModuleClass; var AReference);\r\nvar\r\n  lModule: TDataModule;\r\nbegin\r\n  lModule := AInstanceClass.Create(Self);\r\n  AReference := lModule;\r\nend;\r\n\r\nfunction TApplication.DoFormLoad(Event: TEventListenerEvent): boolean;\r\nvar\r\n  eh,span: TJSHTMLElement;\r\n  l,t,w,h: integer;\r\nbegin\r\n  span := nil;\r\n\r\n  if not FMainForm.Popup then\r\n  begin\r\n    if FMainForm.FFormElement <> '' then\r\n    begin\r\n      eh := TJSHTMLElement(document.getElementById(FMainForm.FFormElement));\r\n      if Assigned(eh) then\r\n      begin\r\n        eh.innerHTML := FLastReq.responseText;\r\n        eh.style.setProperty('background-color',ColorToHTML(FMainForm.Color));\r\n        //eh.style.setProperty('border','1px Black solid');\r\n      end;\r\n    end\r\n    else\r\n      document.body.innerHTML := FLastReq.responseText;\r\n  end\r\n  else\r\n  begin\r\n    FMainForm.ClearControls;\r\n    FMainForm.FLayer := document.createElement('SPAN');\r\n    document.body.appendChild(FMainForm.FLayer);\r\n\r\n    eh := TJSHTMLElement(FMainForm.FLayer);\r\n    eh.style.setProperty('top', '0');\r\n    eh.style.setProperty('left', '0');\r\n    eh.style.setProperty('right', '0');\r\n    eh.style.setProperty('bottom', '0');\r\n\r\n    eh.style.setProperty('webkit-user-select', 'none');\r\n    eh.style.setProperty('moz-user-select', 'none');\r\n    eh.style.setProperty('khtml-user-select', 'none');\r\n    eh.style.setProperty('ms-user-select', 'none');\r\n    eh.style.setProperty('user-select', 'none');\r\n    eh.style.setProperty('position', 'absolute');\r\n\r\n    span := TJSHTMLElement(document.createElement('SPAN'));\r\n    span.style.setProperty('box-shadow','5px 5px 5px gray');\r\n\r\n    eh.appendChild(span);\r\n    span.innerHTML := FLastReq.responseText;\r\n\r\n    FMainForm.Container := span;\r\n  end;\r\n\r\n  FMainForm.Init;\r\n  FMainForm.LoadDFMValues;\r\n\r\n  if Assigned(span) and (FMainForm.FormContainer = '') then\r\n  begin\r\n    span.style.setProperty('position', 'absolute');\r\n\r\n    l := Round((window.innerWidth - FMainForm.Width)/2);\r\n    t := Round((window.innerHeight - FMainForm.Height)/2);\r\n    w := FMainForm.Width;\r\n    h := FMainForm.Height;\r\n\r\n    span.style.setProperty('background-color',ColorToHTML(FMainForm.Color));\r\n    span.style.setProperty('border','1px Black solid');\r\n\r\n    span.style.setProperty('top',IntTostr(t)+'px');\r\n    span.style.setProperty('left',IntToStr(l)+'px');\r\n    span.style.setProperty('width',IntToStr(w)+'px');\r\n    span.style.setProperty('height',IntToStr(h)+'px');\r\n  end;\r\n\r\n  if Assigned(FMainForm.FCreatedProc) then\r\n    FMainForm.FCreatedProc(FMainForm);\r\n\r\n  FMainForm.FCreatedProc := nil;\r\n\r\n  if Assigned(FMainForm.OnCreate) then\r\n    FMainForm.OnCreate(FMainForm);\r\n\r\n  Result := true;\r\nend;\r\n\r\nfunction TApplication.GetFormExtension: string;\r\nbegin\r\n  if Language <> lNone then\r\n    Result := '_' + GetLanguageISO639_1Code(Language) + cHTMLExt\r\n  else\r\n    Result := cHTMLExt;\r\n\r\nend;\r\n\r\n{$IFDEF SINGLEINSTANCE}\r\nprocedure TApplication.DoGetDataReceived(Sender: TObject; Origin: string;\r\n  Data: TJSObject);\r\nbegin\r\n  if Data.toString = '#reload' then\r\n  begin\r\n    asm\r\n      location.reload();\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TApplication.DoGetConnected(Sender: TObject);\r\nvar\r\n  url,agent:string;\r\nbegin\r\n  url := window.location.href;\r\n  agent := window.navigator.useragent;\r\n\r\n  if Pos('Edge', agent) > 0 then\r\n    agent := 'Edge'\r\n  else if Pos('Opera', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('OPR', agent) > 0 then\r\n    agent := 'Opera'\r\n  else if Pos('Chrome', agent) > 0 then\r\n    agent := 'Chrome'\r\n  else if Pos('Safari', agent) > 0 then\r\n    agent := 'Safari'\r\n  else if Pos('Firefox', agent) > 0 then\r\n    agent := 'Firefox'\r\n  else if Pos('Trident', agent) > 0 then\r\n    agent := 'MSIE'\r\n  else\r\n    agent := '';\r\n\r\n  FWebSocket.Send(url + ';' + agent);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TApplication.DoFormAbort(Event: TEventListenerEvent): boolean;\r\nbegin\r\n  ShowMessage('Failed to load form HTML template file');\r\n  Result := true;\r\nend;\r\n\r\n\r\nprocedure TApplication.InitFormatSettings(const BrowserLocale: string);\r\nvar\r\n  timestr: string;\r\n  i: integer;\r\n  locale: string;\r\nbegin\r\n  locale := BrowserLocale;\r\n\r\n  FormatSettings.ShortDateFormat := GetLocaleShortDateFormat(locale);\r\n\r\n  if (Pos('/',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '/';\r\n\r\n  if (Pos('.',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '.';\r\n\r\n  if (Pos('-',FormatSettings.ShortDateFormat) > 0) then\r\n    FormatSettings.DateSeparator := '-';\r\n\r\n  asm\r\n    var event = new Date('Jan 1, 1980 06:07:08 GMT+00:00');\r\n    var loc = \"\";\r\n    if (locale == \"\") { loc = navigator.language; } else\r\n    { loc = locale; }\r\n    timestr = event.toLocaleTimeString(loc);\r\n  end;\r\n\r\n  if pos(':',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := ':';\r\n\r\n  if pos('-',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '.';\r\n\r\n  if pos('-',timestr) > 0 then\r\n    FormatSettings.TimeSeparator := '-';\r\n\r\n  for i := 1 to 7 do\r\n  begin\r\n    ShortDayNames[i] := GetLocaleShortDayName(i,locale);\r\n    LongDayNames[i] := GetLocaleLongDayName(i,locale);\r\n  end;\r\n\r\n  for i := 1 to 12 do\r\n  begin\r\n    ShortMonthNames[i] := GetLocaleShortMonthName(i,locale);\r\n    LongMonthNames[i] := GetLocaleLongMonthName(i,locale);\r\n  end;\r\n\r\n  FormatSettings.DecimalSeparator := GetLocaleDecimalSeparator;\r\n\r\n  if FormatSettings.DecimalSeparator = '.' then\r\n    FormatSettings.ThousandSeparator := ','\r\n  else\r\n    FormatSettings.ThousandSeparator := '.';\r\nend;\r\n\r\n{$HINTS OFF}\r\nprocedure TApplication.Initialize;\r\nvar\r\n  query,token: string;\r\nbegin\r\n  FParameters.Clear;\r\n  query := window.location.href;\r\n\r\n  InitFormatSettings(GetBrowserLocale);\r\n\r\n  FParameters.Delimiter := '&';\r\n  FParameters.StrictDelimiter := true;\r\n  FParameters.DelimitedText := query;\r\n\r\n  if FParameters.IndexOfName('code') <> -1 then\r\n  begin\r\n    FIsRedirect := true;\r\n    token := FParameters.Values['code'];\r\n    asm\r\n      window.opener.processAuthData(token);\r\n    end;\r\n  \twindow.close();\r\n  end;\r\n\r\n  if FParameters.IndexOfName('access_token') <> -1 then\r\n  begin\r\n    FIsRedirect := true;\r\n    token := FParameters.Values['access_token'];\r\n    asm\r\n      window.opener.processAuthData(token);\r\n    end;\r\n  \twindow.close();\r\n  end;\r\nend;\r\n{$HINTS ON}\r\n\r\nprocedure TApplication.Run;\r\nbegin\r\nend;\r\n\r\nprocedure TApplication.SetLanguage(const Value: TUILanguage);\r\nbegin\r\n  FLanguage := Value;\r\n  ReloadForm;\r\nend;\r\n\r\nconstructor TApplication.Create(AOwner: TComponent);\r\nbegin\r\n  FFormStack := TList.Create;\r\n  FParameters := TStringList.Create;\r\n  FMainForm := nil;\r\n  FIsRedirect := false;\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket := TSocketClient.Create(Self);\r\n  FWebSocket.Port := DefaultPort;\r\n  FWebSocket.OnDataReceived := @DoGetDataReceived;\r\n  FWebSocket.OnConnect := @DoGetConnected;\r\n  FWebSocket.Connect;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FREEWARE}\r\n  asm\r\n    alert('TMS WEB Core Trial Version');\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\ndestructor TApplication.Destroy;\r\nbegin\r\n  {$IFDEF SINGLEINSTANCE}\r\n  FWebSocket.Free;\r\n  {$ENDIF}\r\n  FFormStack.Free;\r\n  FParameters.Free;\r\n  inherited Destroy;\r\nend;\r\n\r\nprocedure TApplication.PushForm(AForm: TCustomForm);\r\nvar\r\n  i: integer;\r\nbegin\r\n  // persist all control settings in HTML to be saved\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].PersistInHTML;\r\n  end;\r\n\r\n  // save with form\r\n  AForm.FormContent := document.body.innerHTML;\r\n\r\n  for i := 0 to AForm.ControlCount - 1 do\r\n  begin\r\n    AForm.Controls[i].DisableTab;\r\n  end;\r\n\r\n  FFormStack.Add(AForm);\r\nend;\r\n\r\nfunction TApplication.PopForm: TCustomForm;\r\nvar\r\n  i: integer;\r\n  frm: string;\r\nbegin\r\n  if (FFormStack.Count > 0) then\r\n  begin\r\n\r\n    Result := TCustomForm(FFormStack.Items[FFormStack.Count - 1]);\r\n    frm := Result.FormContent;\r\n    FFormStack.Delete(FFormStack.Count - 1);\r\n\r\n    // restore document\r\n    document.body.innerHTML := frm;\r\n\r\n    Result.InitFromHTML;\r\n\r\n    // rebind form events\r\n    Result.BindEvents;\r\n\r\n    // rehook controls\r\n    for i := 0 to Result.ControlCount - 1 do\r\n      Result.Controls[i].HookElement;\r\n\r\n    for i := 0 to Result.ControlCount - 1 do\r\n    begin\r\n      Result.Controls[i].RecreateCanvas;\r\n      Result.Controls[i].InternalResize;\r\n    end;\r\n\r\n    Application.FMainForm := Result;\r\n  end;\r\nend;\r\n\r\ninitialization\r\n\r\n{$IFNDEF CONSOLELOG}\r\n{$IFDEF DEBUG}\r\n(*\r\n  asm\r\n    window.onerror = function(msg, url, linenumber) {\r\n      alert('Error message: '+msg+'\\nURL: '+url+'\\nLine Number: '+linenumber);\r\n     return true;\r\n  }\r\n  end;\r\n*)\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\n  Application := TApplication.Create(nil);\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCTypes;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$HINTS OFF}\r\n{$IFDEF LCLLIB}\r\n{$DEFINE USETRECTF}\r\n{$ENDIF}\r\n{$IFDEF VCLLIB}\r\n{$IF COMPILERVERSION < 23}\r\n{$DEFINE USETRECTF}\r\n{$IFEND}\r\n{$ENDIF}\r\n{$HINTS ON}\r\n\r\n{$IFDEF WEBLIB}\r\n{$DEFINE USETRECTF}\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF VCLLIB}\r\n  Windows,\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  UITypes,\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  LCLType,\r\n  {$ENDIF}\r\n  Types, Classes, WEBLib.Graphics\r\n  ,SysUtils, WEBLib.Controls, Math\r\n  ;\r\n\r\ntype\r\n  ITMSFNCProductInfo = interface\r\n  ['{C53329EA-7B3A-4507-AD9E-88ACD6A85054}']\r\n    function GetVersion: string;\r\n    function GetDocURL: string;\r\n    function GetTipsURL: string;\r\n  end;\r\n\r\nconst\r\n  TTMSFNCBaseDocURL = 'http://www.tmssoftware.biz/Download/Manuals/TMSFNCUIPackDevGuide.pdf';\r\n  TTMSFNCBaseTipsURL = 'http://www.tmssoftware.com/site/tmsfncuipack.asp?s=faq';\r\n  {$HINTS OFF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IF COMPILERVERSION > 28}\r\n  pidWeb = $10000;\r\n  {$ELSE}\r\n  pidWeb = $1000;\r\n  {$IFEND}\r\n  {$ENDIF}\r\n  {$HINTS ON}\r\n  {$IFDEF FMXLIB}\r\n  TMSPlatformsDesktop = pidWin32 or pidWin64 or pidOSX32;\r\n  {$HINTS OFF}\r\n  TMSPlatforms = pidWin32 or pidWin64 or pidOSX32 or pidiOSSimulator or {$IF COMPILERVERSION > 28}pidiOSDevice32 or pidiOSDevice64{$ELSE}pidiOSDevice{$IFEND} or pidAndroid;\r\n  {$HINTS ON}\r\n  TMSPlatformsWeb = TMSPlatforms or pidWeb;\r\n  TMSPlatformsWebDesktop = TMSPlatformsDesktop or pidWeb;\r\n  KEY_CANCEL = VKCANCEL;\r\n  KEY_CONTROL = VKCONTROL;\r\n  KEY_SHIFT = VKSHIFT;\r\n  KEY_ESCAPE = VKESCAPE;\r\n  KEY_INSERT = VKINSERT;\r\n  KEY_DELETE = VKDELETE;\r\n  KEY_TAB = VKTAB;\r\n  KEY_PRIOR = VKPRIOR;\r\n  KEY_NEXT = VKNEXT;\r\n  KEY_UP = VKUP;\r\n  KEY_DOWN = VKDOWN;\r\n  KEY_RIGHT = VKRIGHT;\r\n  KEY_LEFT = VKLEFT;\r\n  KEY_HOME = VKHOME;\r\n  KEY_END = VKEND;\r\n  KEY_RETURN = VKRETURN;\r\n  KEY_SPACE = VKSPACE;\r\n  KEY_MENU = VKMENU;\r\n  KEY_BACK = VKBACK;\r\n  KEY_F1 = VKF1;\r\n  KEY_F2 = VKF2;\r\n  KEY_F3 = VKF3;\r\n  KEY_F4 = VKF4;\r\n  KEY_F5 = VKF5;\r\n  KEY_F6 = VKF6;\r\n  KEY_F7 = VKF7;\r\n  KEY_F8 = VKF8;\r\n  KEY_F9 = VKF9;\r\n  KEY_F10 = VKF10;\r\n  KEY_F11 = VKF11;\r\n  KEY_F12 = VKF12;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  TMSPlatformsDesktop = pidWin32 or pidWin64;\r\n  TMSPlatforms = pidWin32 or pidWin64;\r\n  TMSPlatformsWeb = TMSPlatforms or pidWeb;\r\n  TMSPlatformsWebDesktop = TMSPlatformsDesktop or pidWeb;\r\n  {$ELSE}\r\n  ssCommand = ssCtrl;\r\n  TMSPlatformsDesktop = 0;\r\n  TMSPlatforms = 0;\r\n  TMSPlatformsWeb = 0;\r\n  TMSPlatformsWebDesktop = 0;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ssCommand = ssCtrl;\r\n  {$ENDIF}\r\n  KEY_CANCEL = VK_CANCEL;\r\n  KEY_CONTROL = VK_CONTROL;\r\n  KEY_SHIFT = VK_SHIFT;\r\n  KEY_ESCAPE = VK_ESCAPE;\r\n  KEY_INSERT = VK_INSERT;\r\n  KEY_DELETE = VK_DELETE;\r\n  KEY_TAB = VK_TAB;\r\n  KEY_PRIOR = VK_PRIOR;\r\n  KEY_NEXT = VK_NEXT;\r\n  KEY_UP = VK_UP;\r\n  KEY_DOWN = VK_DOWN;\r\n  KEY_RIGHT = VK_RIGHT;\r\n  KEY_LEFT = VK_LEFT;\r\n  KEY_HOME = VK_HOME;\r\n  KEY_END = VK_END;\r\n  KEY_RETURN = VK_RETURN;\r\n  KEY_SPACE = VK_SPACE;\r\n  KEY_MENU = VK_MENU;\r\n  KEY_BACK = VK_BACK;\r\n  KEY_F1 = VK_F1;\r\n  KEY_F2 = VK_F2;\r\n  KEY_F3 = VK_F3;\r\n  KEY_F4 = VK_F4;\r\n  KEY_F5 = VK_F5;\r\n  KEY_F6 = VK_F6;\r\n  KEY_F7 = VK_F7;\r\n  KEY_F8 = VK_F8;\r\n  KEY_F9 = VK_F9;\r\n  KEY_F10 = VK_F10;\r\n  KEY_F11 = VK_F11;\r\n  KEY_F12 = VK_F12;\r\n  {$ENDIF}\r\n\r\ntype\r\n  {$IFDEF WEBLIB}\r\n  TResourceStream = TObject;\r\n  TStream = TObject;\r\n  TMemoryStream = TStream;\r\n  TPopupMenu = class(TComponent);\r\n  PChar = string;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCMouseButton = TMouseButton;\r\n\r\n  {$IFDEF USETRECTF}\r\n  {$IFNDEF WEBLIB}\r\n  PSizeF = ^TSizeF;\r\n  {$ENDIF}\r\n  TSizeF = record\r\n    cx: Single;\r\n    cy: Single;\r\n  {$IFNDEF WEBLIB}\r\n  public\r\n    property Width: Single read cx write cx;\r\n    property Height: Single read cy write cy;\r\n  {$ENDIF}\r\n  end;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  TPointFType = array [0..1] of Single;\r\n  PPointF = ^TPointF;\r\n  {$ENDIF}\r\n  TPointF = record\r\n    {$IFDEF WEBLIB}\r\n    X, Y: Single;\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    function Length: Single;\r\n    procedure Offset(const ADeltaX, ADeltaY: Single);\r\n    case Integer of\r\n      0: (V: TPointFType;);\r\n      1: (X: Single;\r\n          Y: Single;);\r\n    {$ENDIF}\r\n  end;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  PRectF = ^TRectF;\r\n  {$ENDIF}\r\n  TRectF = record\r\n  {$IFNDEF WEBLIB}\r\n  private\r\n    function GetWidth: Single;\r\n    procedure SetWidth(const Value: Single);\r\n    function GetHeight: Single;\r\n    procedure SetHeight(const Value: Single);\r\n    function GetSize: TSizeF;\r\n    procedure SetSize(const Value: TSizeF);\r\n  public\r\n    procedure Offset(const DX, DY: Single);\r\n    procedure Inflate(const DX, DY: Single);\r\n    function CenterAt(const ADesignatedArea: TRectF): TRectF;\r\n    function SnapToPixel(const AScale: Single; const APlaceBetweenPixels: Boolean): TRectF;\r\n    function FitInto(const ADesignatedArea: TRectF; out Ratio: Single): TRectF; overload;\r\n    function FitInto(const ADesignatedArea: TRectF): TRectF; overload;\r\n    function IsEmpty: Boolean;\r\n    function IntersectsWith(const R: TRectF): Boolean;\r\n    function CenterPoint: TPointF;\r\n    function Empty: TRectF;\r\n    property Width: Single read GetWidth write SetWidth;\r\n    property Height: Single read GetHeight write SetHeight;\r\n    property Size: TSizeF read GetSize write SetSize;\r\n    case Integer of\r\n      0: (Left, Top, Right, Bottom: Single);\r\n      1: (TopLeft, BottomRight: TPointF);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n    Left, Top, Right, Bottom: Single;\r\n  {$ENDIF}\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCBitmap = TBitmap;\r\n  TTMSFNCDrawBitmap = TBitmap;\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  TTMSFNCBitmap = TPicture;\r\n  TTMSFNCDrawBitmap = TGraphic;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCBitmap = class(TBitmap);\r\n  TTMSFNCDrawBitmap = TTMSFNCBitmap;\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF USETRECTF}\r\n  TRectFHelper = record helper for TRectF\r\n    function CenterAt(const ADesignatedArea: TRectF): TRectF;\r\n    function SnapToPixel(const AScale: Single; const APlaceBetweenPixels: Boolean): TRectF;\r\n    function FitInto(const ADesignatedArea: TRectF; out Ratio: Single): TRectF; overload;\r\n    function FitInto(const ADesignatedArea: TRectF): TRectF; overload;\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCBitmapHelper = class helper for TTMSFNCBitmap\r\n    procedure LoadFromURL(AURL: String); overload;\r\n    procedure LoadFromURL(AURL: String; AInstance: NativeUInt); overload;\r\n    procedure LoadFromResource(AResourceName: String); overload;\r\n    procedure LoadFromResource(AResourceName: String; AInstance: NativeUInt); overload;\r\n    {$IFDEF VCLLIB}\r\n    procedure LoadFromStream(AStream: TCustomMemoryStream);\r\n    procedure SaveToStream(AStream: TCustomMemoryStream);\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    class function CreateFromStream(AStream: TCustomMemoryStream): TTMSFNCBitmap; overload;\r\n    {$ENDIF}\r\n    class function CreateFromResource(AResourceName: String): TTMSFNCBitmap; overload;\r\n    class function CreateFromResource(AResourceName: String; AInstance: NativeUInt): TTMSFNCBitmap; overload;\r\n    class function CreateFromURL(AURL: String): TTMSFNCBitmap; overload;\r\n    class function CreateFromURL(AURL: String; AInstance: NativeUInt): TTMSFNCBitmap; overload;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCMargins = class(TPersistent)\r\n  private\r\n    FRight: Single;\r\n    FBottom: Single;\r\n    FTop: Single;\r\n    FLeft: Single;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetBottom(const Value: Single);\r\n    procedure SetLeft(const Value: Single);\r\n    procedure SetRight(const Value: Single);\r\n    procedure SetTop(const Value: Single);\r\n    function IsLeftStored: Boolean;\r\n    function IsTopStored: Boolean;\r\n    function IsRightStored: Boolean;\r\n    function IsBottomStored: Boolean;\r\n  protected\r\n    procedure Changed;\r\n  public\r\n    constructor Create; overload;\r\n    constructor Create(const ARect: TRectF); overload;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function Empty: Boolean;\r\n    function Rect: TRectF;\r\n    function PaddingRect(const R: TRectF): TRectF;\r\n  published\r\n    property Left: Single read FLeft write SetLeft stored IsLeftStored nodefault;\r\n    property Top: Single read FTop write SetTop stored IsTopStored nodefault;\r\n    property Right: Single read FRight write SetRight stored IsRightStored nodefault;\r\n    property Bottom: Single read FBottom write SetBottom stored IsBottomStored nodefault;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  TTMSFNCScaledBitmap = class(TCollectionItem)\r\n  private\r\n    FBitmap: TTMSFNCBitmap;\r\n    FScale: Single;\r\n    FBitmapName: string;\r\n    function IsScaleStored: Boolean;\r\n    procedure SetBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetScale(const Value: Single);\r\n    procedure SetBitmapName(const Value: string);\r\n  protected\r\n    procedure BitmapChanged(Sender: TObject);\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Bitmap: TTMSFNCBitmap read FBitmap write SetBitmap;\r\n    property BitmapName: string read FBitmapName write SetBitmapName;\r\n    property Scale: Single read FScale write SetScale stored IsScaleStored nodefault;\r\n  end;\r\n\r\n  TTMSFNCScaledBitmaps = class(TOwnedCollection)\r\n  private\r\n    FOnChange: TNotifyEvent;\r\n    function GetItems(Index: Integer): TTMSFNCScaledBitmap;\r\n    procedure SetItems(Index: Integer; const Value: TTMSFNCScaledBitmap);\r\n    function GetBitmap(Scale: Single): TTMSFNCBitmap;\r\n    procedure SetBitmap(Scale: Single; const Value: TTMSFNCBitmap);\r\n  protected\r\n    procedure Update(Item: TCollectionItem); override;\r\n  public\r\n    constructor Create(AOwner: TPersistent);\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n    function Add(Scale: Single = 1.0): TTMSFNCScaledBitmap; overload;\r\n    {$IFNDEF WEBLIB}\r\n    function AddBitmapFromFile(FileName: string; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\n    {$ENDIF}\r\n    function AddBitmapFromResource(ResourceName: String; Scale: Single = 1.0): TTMSFNCScaledBitmap; overload;\r\n    function AddBitmapFromResource(ResourceName: String; AInstance: NativeUInt; Scale: Single = 1.0): TTMSFNCScaledBitmap; overload;\r\n    function AddBitmap(Bitmap: TTMSFNCBitmap; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\n    function AddBitmapName(BitmapName: string; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\n    function AddDrawBitmap(Bitmap: TTMSFNCDrawBitmap; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\n    function Insert(Index: Integer): TTMSFNCScaledBitmap; overload;\r\n    function Insert(Index: Integer; Scale: Single): TTMSFNCScaledBitmap; overload;\r\n    function GetBitmapByScale(Scale: Single): TTMSFNCBitmap;\r\n    function GetItemByScale(Scale: Single): TTMSFNCScaledBitmap;\r\n    property Items[Index: Integer]: TTMSFNCScaledBitmap read GetItems write SetItems; default;\r\n    property Bitmaps[Scale: Single]: TTMSFNCBitmap read GetBitmap write SetBitmap;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPictureFormat = (pfBMP, pfGIF, pfJPG, pfPNG, pfICO, pfTiff, pfMetaFile, pfNone);\r\n\r\n  ITMSFNCCustomEditor = interface\r\n    ['{CC0C60B7-75F3-47CE-8A7F-8005A19F12E8}']\r\n    procedure SetText(AValue: String);\r\n    procedure SetSelStart(AValue: Integer);\r\n    procedure SetSelLength(AValue: Integer);\r\n    function GetTextLength: Integer;\r\n  end;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  {$IFDEF LCLLIB}generic {$ENDIF}TTMSFNCOwnedCollection<T: class> = class(TOwnedCollection)\r\n  public type\r\n    TTMSFNCCollection = {$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<T>;\r\n\r\n    TEnumerator = class\r\n    private\r\n      FIndex: Integer;\r\n      FCol: TTMSFNCCollection;\r\n    public\r\n      constructor Create(ACol: TTMSFNCCollection);\r\n      function GetCurrent: T;\r\n      function MoveNext: Boolean;\r\n      property Current: T read GetCurrent;\r\n    end;\r\n  public\r\n    function GetEnumerator: TEnumerator;\r\n    function GetItem(AIndex: Integer): T;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCOwnedCollection = class(TOwnedCollection);\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPersistent = class(TInterfacedPersistent);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPersistent = class(TPersistent);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCValueRelationShip = TValueRelationShip;\r\n\r\nprocedure InflateRectEx(var R: TRectF; DX, DY: Single);\r\nfunction ConvertToRectF(const Rect: TRect): TRectF; overload;\r\nfunction ConvertToRectF(const Rect: TRectF): TRectF; overload;\r\nfunction ConvertToRect(const Rect: TRectF): TRect; overload;\r\nfunction ConvertToRect(const Rect: TRect): TRect; overload;\r\nfunction ConvertToSizeF(const Size: TSize): TSizeF; overload;\r\nfunction ConvertToSizeF(const Size: TSizeF): TSizeF; overload;\r\nfunction ConvertToSize(const Size: TSizeF): TSize; overload;\r\nfunction ConvertToSize(const Size: TSize): TSize; overload;\r\nfunction ConvertToPointF(const Point: TPoint): TPointF; overload;\r\nfunction ConvertToPointF(const Point: TPointF): TPointF; overload;\r\nfunction ConvertToPoint(const Point: TPointF): TPoint; overload;\r\nfunction ConvertToPoint(const Point: TPoint): TPoint; overload;\r\nfunction OffsetRectEx(var R: TRect; DX, DY: Integer): Boolean; overload;\r\nfunction OffsetRectEx(var R: TRectF; DX, DY: Single): Boolean; overload;\r\nfunction PtInRectEx(const Rect: TRectF; const P: TPointF): Boolean;\r\nfunction IntersectRectEx(const Rect1: TRectF; const Rect2: TRectF): Boolean; overload;\r\nfunction IntersectRectEx(out Rect: TRectF; const R1, R2: TRectF): Boolean; overload;\r\nfunction EqualRectEx(const R1, R2: TRectF): Boolean; overload;\r\nfunction EqualRectEx(const R1, R2: TRect): Boolean; overload;\r\nfunction RectWidthEx(const Rect: TRect): Integer; overload;\r\nfunction RectWidthEx(const Rect: TRectF): Single; overload;\r\nfunction RectHeightEx(const Rect: TRect): Integer; overload;\r\nfunction RectHeightEx(const Rect: TRectF): Single; overload;\r\nfunction RectCenterEx(var R: TRect; const B: TRect): TRect; overload;\r\nfunction RectCenterEx(var R: TRectF; const B: TRectF): TRectF; overload;\r\nfunction RectCenterAtEx(const Rect: TRectF; const ADesignatedArea: TRectF): TRectF;\r\nfunction RectSnapToPixelEx(const Rect: TRectF; const AScale: Single; const APlaceBetweenPixels: Boolean): TRectF;\r\nfunction RectFitIntoEx(const Rect: TRectF; const ADesignatedArea: TRectF; out Ratio: Single): TRectF; overload;\r\nfunction RectFitIntoEx(const Rect: TRectF; const ADesignatedArea: TRectF): TRectF; overload;\r\nfunction GetPointLength(const Point: TPointF): Single;\r\nfunction MakeRectF(Left, Top, Width, Height: Single): TRectF;\r\nfunction CenterPointEx(const R: TRectF): TPointF;\r\nfunction CompareValueEx(const A, B: Extended; Epsilon: Extended = 0): TTMSFNCValueRelationship;\r\nfunction RectIsEmpty(const R: TRectF): Boolean;\r\nfunction EmptyRect: TRectF;\r\nfunction RectIntersectsWithEx(const ARect: TRectF; const R: TRectF): Boolean;\r\n{$IFDEF USETRECTF}\r\nfunction RectF(Left, Top, Right, Bottom: Single): TRectF; {$IFNDEF WEBLIB}inline; {$ENDIF}overload;\r\nfunction PointF(X, Y: Single): TPointF; {$IFNDEF WEBLIB}inline; {$ENDIF}overload;\r\n{$ENDIF}\r\nfunction BitmapToDrawBitmap(ABitmap: TTMSFNCBitmap): TTMSFNCDrawBitmap; overload;\r\nfunction IsBitmapEmpty(ABitmap: TTMSFNCBitmap): Boolean;\r\nfunction CharInArray(AChar: Char; ACharArray: array of char): Boolean;\r\nfunction CharIsNumber(AChar: Char): Boolean;\r\nfunction CharIsLetter(AChar: Char): Boolean;\r\nfunction CharIsHex(AChar: Char): Boolean;\r\nfunction CharIsLetterOrNumber(AChar: Char): Boolean;\r\n{$IFDEF WEBLIB}\r\nfunction VarToStr(const S: string): string;\r\nfunction VarToDateTime(const S: string): TDateTime;\r\nfunction AnsiPos(const Substr, S: string): Integer;\r\nfunction AnsiUpperCase(const S: string): string;\r\nfunction HInstance: Integer;\r\n{$ENDIF}\r\n\r\nimplementation\r\n\r\n{$IFNDEF WEBLIB}\r\nuses\r\n  WEBLib.TMSFNCUtils\r\n  {$IFDEF VCLLIB}\r\n  ,AnsiStrings\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,PNGImage, JPEG, GifImg\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 24}\r\n  ,Character\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  ;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nfunction VarToStr(const S: string): string;\r\nbegin\r\n  Result := S;\r\nend;\r\n\r\nfunction VarToDateTime(const S: string): TDateTime;\r\nbegin\r\n  Result := StrToDateTime(S);\r\nend;\r\n\r\nfunction HInstance: Integer;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nfunction AnsiUpperCase(const S: string): string;\r\nbegin\r\n  Result := UpperCase(S);\r\nend;\r\n\r\nfunction AnsiPos(const Substr, S: string): Integer;\r\nbegin\r\n  Result := Pos(SubStr, S);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction CharIsHex(AChar: Char): Boolean;\r\nbegin\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$WARNINGS OFF}\r\n  {$IF COMPILERVERSION > 24}\r\n  Result := AChar.IsNumber or AChar.IsInArray(['a', 'b', 'c', 'd', 'e', 'f']) or AChar.IsInArray(['A', 'B', 'C', 'D', 'E', 'F']);\r\n  {$ELSE}\r\n  Result := (AChar in ['0'..'9']) or (AChar in ['a'..'f']) or (AChar in ['A'..'F']);\r\n  {$IFEND}\r\n  {$WARNINGS ON}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := (AChar in ['0'..'9']) or (AChar in ['a'..'f']) or (AChar in ['A'..'F']);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction CharIsLetter(AChar: Char): Boolean;\r\nbegin\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$WARNINGS OFF}\r\n  {$IF COMPILERVERSION > 24}\r\n  Result := AChar.IsLetter;\r\n  {$ELSE}\r\n  Result := (AChar in ['a'..'z']) or (AChar in ['A'..'Z']);\r\n  {$IFEND}\r\n  {$WARNINGS ON}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := (AChar in ['a'..'z']) or (AChar in ['A'..'Z']);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction CharIsNumber(AChar: Char): Boolean;\r\nbegin\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$WARNINGS OFF}\r\n  {$IF COMPILERVERSION > 24}\r\n  Result := AChar.IsNumber;\r\n  {$ELSE}\r\n  Result := (AChar in ['0'..'9']);\r\n  {$IFEND}\r\n  {$WARNINGS ON}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := (AChar in ['0'..'9']);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction CharIsLetterOrNumber(AChar: Char): Boolean;\r\nbegin\r\n  Result := CharIsLetter(AChar) or CharIsNumber(AChar);\r\nend;\r\n\r\nfunction CharInArray(AChar: Char; ACharArray: array of char): Boolean;\r\nvar\r\n  ch: Char;\r\n  I: Integer;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Length(ACharArray) - 1 do\r\n  begin\r\n    ch := ACharArray[I];\r\n    if ch = AChar then\r\n    begin\r\n      Result := True;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction IsBitmapEmpty(ABitmap: TTMSFNCBitmap): Boolean;\r\nvar\r\n  b: TTMSFNCDrawBitmap;\r\nbegin\r\n  Result := True;\r\n  if Assigned(ABitmap) then\r\n  begin\r\n    b := BitmapToDrawBitmap(ABitmap);\r\n    if Assigned(b) then\r\n    begin\r\n      {$IFDEF CMNLIB}\r\n      Result := b.Empty;\r\n      {$ENDIF}\r\n      {$IFDEF WEBLIB}\r\n      Result := b.Empty;\r\n      {$ENDIF}\r\n      {$IFDEF FMXLIB}\r\n      Result := b.IsEmpty\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction BitmapToDrawBitmap(ABitmap: TTMSFNCBitmap): TTMSFNCDrawBitmap;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(ABitmap) then\r\n  begin\r\n    {$IFDEF CMNLIB}\r\n    Result := ABitmap.Graphic;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    Result := ABitmap;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    Result := ABitmap;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\n\r\n{ TTMSFNCBitmapHelper }\r\n\r\nclass function TTMSFNCBitmapHelper.CreateFromResource(AResourceName: String): TTMSFNCBitmap;\r\nbegin\r\n  Result := CreateFromResource(AResourceName, TTMSFNCUtils.GetHInstance);\r\nend;\r\n\r\nclass function TTMSFNCBitmapHelper.CreateFromResource(AResourceName: String; AInstance: NativeUInt): TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCBitmap.Create;\r\n  Result.LoadFromResource(AResourceName, AInstance);\r\nend;\r\n\r\nclass function TTMSFNCBitmapHelper.CreateFromURL(AURL: String): TTMSFNCBitmap;\r\nbegin\r\n  Result := CreateFromURL(AURL, TTMSFNCUtils.GetHInstance);\r\nend;\r\n\r\nclass function TTMSFNCBitmapHelper.CreateFromURL(AURL: String; AInstance: NativeUInt): TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCBitmap.Create;\r\n  Result.LoadFromURL(AURL, AInstance);\r\nend;\r\n\r\n{$IFDEF VCLLIB}\r\nprocedure TTMSFNCBitmapHelper.SaveToStream(AStream: TCustomMemoryStream);\r\nbegin\r\n  if Assigned(AStream) then\r\n  begin\r\n    if Assigned(Graphic) then\r\n      Graphic.SaveToStream(AStream);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapHelper.LoadFromStream(AStream: TCustomMemoryStream);\r\nvar\r\n  pic: TGraphic;\r\n  gcc: TGraphicClass;\r\nbegin\r\n  if Assigned(AStream) then\r\n  begin\r\n    pic := nil;\r\n    if TTMSFNCUtils.FindGraphicClass(AStream.Memory^, AStream.Size, gcc) then\r\n      pic := gcc.Create;\r\n\r\n    if Assigned(pic) then\r\n    begin\r\n      try\r\n        AStream.Position := 0;\r\n        pic.LoadFromStream(AStream);\r\n        Self.Assign(pic);\r\n      finally\r\n        pic.Free;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNLIB}\r\nclass function TTMSFNCBitmapHelper.CreateFromStream(AStream: TCustomMemoryStream): TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCBitmap.Create;\r\n  Result.LoadFromStream(AStream);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCBitmapHelper.LoadFromURL(AURL: String);\r\nbegin\r\n  LoadFromURL(AURL, TTMSFNCUtils.GetHInstance);\r\nend;\r\n\r\nprocedure TTMSFNCBitmapHelper.LoadFromURL(AURL: String; AInstance: NativeUInt);\r\nvar\r\n  ms: TMemoryStream;\r\nbegin\r\n  ms := TTMSFNCUtils.DownloadImage(AURL);\r\n  try\r\n    if Assigned(ms) then\r\n      Self.LoadFromStream(ms);\r\n  finally\r\n    if Assigned(ms) then\r\n      ms.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapHelper.LoadFromResource(AResourceName: String);\r\nbegin\r\n  LoadFromResource(AResourceName, TTMSFNCUtils.GetHInstance);\r\nend;\r\n\r\nprocedure TTMSFNCBitmapHelper.LoadFromResource(AResourceName: String; AInstance: NativeUInt);\r\nvar\r\n  r: TResourceStream;\r\nbegin\r\n  r := nil;\r\n  try\r\n    r := TTMSFNCUtils.GetResourceStream(AResourceName, AInstance);\r\n    if Assigned(r) then\r\n      Self.LoadFromStream(r);\r\n  finally\r\n    if Assigned(r) then\r\n      r.Free;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF USETRECTF}\r\n\r\n{ TRectF }\r\n\r\n{$IFNDEF WEBLIB}\r\nfunction TRectF.GetSize: TSizeF;\r\nbegin\r\n  Result.cx := Width;\r\n  Result.cy := Height;\r\nend;\r\n\r\nprocedure TRectF.SetSize(const Value: TSizeF);\r\nbegin\r\n  Width := Value.cx;\r\n  Height := Value.cy;\r\nend;\r\n\r\nfunction TRectF.GetHeight: Single;\r\nbegin\r\n  Result := Self.Bottom - Self.Top;\r\nend;\r\n\r\nprocedure TRectF.SetHeight(const Value: Single);\r\nbegin\r\n  Self.Bottom := Self.Top + Value;\r\nend;\r\n\r\nfunction TRectF.GetWidth: Single;\r\nbegin\r\n  Result := Self.Right - Self.Left;\r\nend;\r\n\r\nprocedure TRectF.SetWidth(const Value: Single);\r\nbegin\r\n  Self.Right := Self.Left + Value;\r\nend;\r\n\r\nfunction TRectF.CenterPoint: TPointF;\r\nbegin\r\n  Result.X := (Right - Left) / 2.0 + Left;\r\n  Result.Y := (Bottom - Top) / 2.0 + Top;\r\nend;\r\n\r\nfunction TRectF.IntersectsWith(const R: TRectF): Boolean;\r\nbegin\r\n  Result := not ( (Self.BottomRight.X < R.TopLeft.X) or\r\n                  (Self.BottomRight.Y < R.TopLeft.Y) or\r\n                  (R.BottomRight.X < Self.TopLeft.X) or\r\n                  (R.BottomRight.Y < Self.TopLeft.Y) );\r\nend;\r\n\r\nprocedure TRectF.Offset(const DX, DY: Single);\r\nbegin\r\n  TopLeft.Offset(DX, DY);\r\n  BottomRight.Offset(DX, DY);\r\nend;\r\n\r\nprocedure TRectF.Inflate(const DX, DY: Single);\r\nbegin\r\n  TopLeft.Offset(-DX, -DY);\r\n  BottomRight.Offset(DX, DY);\r\nend;\r\n\r\nfunction TRectF.Empty: TRectF;\r\nbegin\r\n  Result.Left := 0;\r\n  Result.Top := 0;\r\n  Result.Right := 0;\r\n  Result.Bottom := 0;\r\nend;\r\n\r\nfunction TRectF.IsEmpty: Boolean;\r\nbegin\r\n  Result := (Right < Left) or SameValue(Right, Left)\r\n         or (Bottom < Top) or SameValue(Bottom, Top);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TPointF.Offset(const ADeltaX, ADeltaY: Single);\r\nbegin\r\n  Self.X := Self.X + ADeltaX;\r\n  Self.Y := Self.Y + ADeltaY;\r\nend;\r\n\r\nfunction TPointF.Length: Single;\r\nbegin\r\n  Result := Sqrt(Sqr(X) + Sqr(Y));\r\nend;\r\n{$ENDIF}\r\n\r\nfunction PtInRectEx(const Rect: TRectF; const P: TPointF): Boolean;\r\nbegin\r\n  Result := (P.X >= Rect.Left) and (P.X < Rect.Right) and (P.Y >= Rect.Top)\r\n    and (P.Y < Rect.Bottom);\r\nend;\r\n\r\nfunction PointF(X, Y: Single): TPointF;\r\nbegin\r\n  Result.X := X;\r\n  Result.Y := Y;\r\nend;\r\n\r\nfunction OffsetRectEx(var R: TRect; DX, DY: Integer): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if @R <> nil then\r\n  {$ENDIF}\r\n  begin\r\n    R.Left := R.Left + DX;\r\n    R.Right := R.Right + DX;\r\n    R.Top := R.Top + DY;\r\n    R.Bottom := R.Bottom + DY;\r\n    Result := True;\r\n  end\r\n  {$IFNDEF WEBLIB}\r\n  else\r\n    Result := False;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction OffsetRectEx(var R: TRectF; DX, DY: Single): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if @R <> nil then\r\n  {$ENDIF}\r\n  begin\r\n    R.Left := R.Left + DX;\r\n    R.Right := R.Right + DX;\r\n    R.Top := R.Top + DY;\r\n    R.Bottom := R.Bottom + DY;\r\n    Result := True;\r\n  end\r\n  {$IFNDEF WEBLIB}\r\n  else\r\n    Result := False;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction RectF(Left, Top, Right, Bottom: Single): TRectF;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  Result.Bottom := Bottom;\r\n  Result.Right := Right;\r\nend;\r\n\r\nprocedure InflateRectEx(var R: TRectF; DX, DY: Single);\r\nbegin\r\n  R.Left := R.Left - DX;\r\n  R.Right := R.Right + DX;\r\n  R.Top := R.Top - DY;\r\n  R.Bottom := R.Bottom + DY;\r\nend;\r\n\r\nfunction IntersectRectEx(const Rect1: TRectF; const Rect2: TRectF): Boolean;\r\nbegin\r\n  Result := (Rect1.Left < Rect2.Right)\r\n        and (Rect1.Right > Rect2.Left)\r\n        and (Rect1.Top < Rect2.Bottom)\r\n        and (Rect1.Bottom > Rect2.Top);\r\nend;\r\n\r\nfunction EqualRectEx(const R1, R2: TRect): Boolean;\r\nbegin\r\n  Result := (R1.Left = R2.Left) and (R1.Right = R2.Right) and\r\n    (R1.Top = R2.Top) and (R1.Bottom = R2.Bottom);\r\nend;\r\n\r\nfunction EqualRectEx(const R1, R2: TRectF): Boolean;\r\nbegin\r\n  Result := (R1.Left = R2.Left) and (R1.Right = R2.Right) and\r\n    (R1.Top = R2.Top) and (R1.Bottom = R2.Bottom);\r\nend;\r\n\r\n{$ELSE}\r\n\r\nfunction EqualRectEx(const R1, R2: TRect): Boolean;\r\nbegin\r\n  Result := EqualRect(R1, R2);\r\nend;\r\n\r\nfunction EqualRectEx(const R1, R2: TRectF): Boolean;\r\nbegin\r\n  Result := EqualRect(R1, R2);\r\nend;\r\n\r\nfunction IntersectRectEx(const Rect1: TRectF; const Rect2: TRectF): Boolean;\r\nbegin\r\n  Result := IntersectRect(Rect1, Rect2);\r\nend;\r\n\r\nfunction OffsetRectEx(var R: TRect; DX, DY: Integer): Boolean;\r\nbegin\r\n  Result := OffsetRect(R, DX, DY);\r\nend;\r\n\r\nfunction OffsetRectEx(var R: TRectF; DX, DY: Single): Boolean;\r\nbegin\r\n  Result := OffsetRect(R, DX, DY);\r\nend;\r\n\r\nprocedure InflateRectEx(var R: TRectF; DX, DY: Single);\r\nbegin\r\n  InflateRect(R, DX, DY);\r\nend;\r\n\r\nfunction PtInRectEx(const Rect: TRectF; const P: TPointF): Boolean;\r\nbegin\r\n  Result := PtInRect(Rect, P);\r\nend;\r\n\r\n{$ENDIF}\r\n\r\n{$IFNDEF WEBLIB}\r\nfunction {$IFDEF USETRECTF}TRectF{$ELSE}{$IFNDEF LCLLIB}TRectFHelper{$ELSE}TRectF{$ENDIF}{$ENDIF}.FitInto(const ADesignatedArea: TRectF; out Ratio: Single): TRectF;\r\nbegin\r\n  if (ADesignatedArea.Width <= 0) or (ADesignatedArea.Height <= 0) then\r\n  begin\r\n    Ratio := 1;\r\n    Exit(Self);\r\n  end;\r\n\r\n  if (Self.Width / ADesignatedArea.Width) > (Self.Height / ADesignatedArea.Height) then\r\n    Ratio := Self.Width / ADesignatedArea.Width\r\n  else\r\n    Ratio := Self.Height / ADesignatedArea.Height;\r\n\r\n  Result := RectF(0, 0, Self.Width / Ratio, Self.Height / Ratio);\r\n  RectCenterEx(Result, ADesignatedArea);\r\nend;\r\n\r\nfunction {$IFDEF USETRECTF}TRectF{$ELSE}{$IFNDEF LCLLIB}TRectFHelper{$ELSE}TRectF{$ENDIF}{$ENDIF}.FitInto(const ADesignatedArea: TRectF): TRectF;\r\nvar\r\n  Ratio: Single;\r\nbegin\r\n  Result := FitInto(ADesignatedArea, Ratio);\r\nend;\r\n\r\nfunction {$IFDEF USETRECTF}TRectF{$ELSE}{$IFNDEF LCLLIB}TRectFHelper{$ELSE}TRectF{$ENDIF}{$ENDIF}.CenterAt(const ADesignatedArea: TRectF): TRectF;\r\nbegin\r\n  Result := Self;\r\n  RectCenterEx(Result, ADesignatedArea);\r\nend;\r\n\r\nfunction {$IFDEF USETRECTF}TRectF{$ELSE}{$IFNDEF LCLLIB}TRectFHelper{$ELSE}TRectF{$ENDIF}{$ENDIF}.SnapToPixel(const AScale: Single; const APlaceBetweenPixels: Boolean): TRectF;\r\nvar\r\n  LScale, HalfPixel: Single;\r\nbegin\r\n  if AScale <= 0 then\r\n    LScale := 1\r\n  else\r\n    LScale := AScale;\r\n  Result.Left := System.Trunc(Self.Left * LScale) / LScale;\r\n  Result.Top := System.Trunc(Self.Top * LScale) / LScale;\r\n  Result.Width := System.Round(Self.Width * LScale) / LScale;\r\n  Result.Height := System.Round(Self.Height * LScale) / LScale;\r\n  if APlaceBetweenPixels then\r\n  begin\r\n    HalfPixel := 1 / (2 * LScale);\r\n    Result.Offset(HalfPixel, HalfPixel);\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nfunction RectWidthEx(const Rect: TRect): Integer;\r\nbegin\r\n  Result := Rect.Right - Rect.Left;\r\nend;\r\n\r\nfunction RectHeightEx(const Rect: TRect): Integer;\r\nbegin\r\n  Result := Rect.Bottom - Rect.Top;\r\nend;\r\n\r\nfunction RectWidthEx(const Rect: TRectF): Single;\r\nbegin\r\n  Result := Rect.Right - Rect.Left;\r\nend;\r\n\r\nfunction RectHeightEx(const Rect: TRectF): Single;\r\nbegin\r\n  Result := Rect.Bottom - Rect.Top;\r\nend;\r\n\r\nfunction RectCenterAtEx(const Rect: TRectF; const ADesignatedArea: TRectF): TRectF;\r\nbegin\r\n  Result := Rect;\r\n  RectCenterEx(Result, ADesignatedArea);\r\nend;\r\n\r\nfunction RectSnapToPixelEx(const Rect: TRectF; const AScale: Single; const APlaceBetweenPixels: Boolean): TRectF;\r\nvar\r\n  LScale, HalfPixel: Single;\r\nbegin\r\n  if AScale <= 0 then\r\n    LScale := 1\r\n  else\r\n    LScale := AScale;\r\n  Result.Left := Trunc(Rect.Left * LScale) / LScale;\r\n  Result.Top := Trunc(Rect.Top * LScale) / LScale;\r\n  Result.Right := Result.Left + Round((Rect.Right - Rect.Left) * LScale) / LScale;\r\n  Result.Bottom := Result.Top + Round((Rect.Bottom - Rect.Top) * LScale) / LScale;\r\n  if APlaceBetweenPixels then\r\n  begin\r\n    HalfPixel := 1 / (2 * LScale);\r\n    OffsetRectEx(Result, HalfPixel, HalfPixel);\r\n  end;\r\nend;\r\n\r\nfunction RectFitIntoEx(const Rect: TRectF; const ADesignatedArea: TRectF; out Ratio: Single): TRectF;\r\nbegin\r\n  if (ADesignatedArea.Right - ADesignatedArea.Left <= 0) or (ADesignatedArea.Bottom - ADesignatedArea.Top <= 0) then\r\n  begin\r\n    Ratio := 1;\r\n    Exit(Rect);\r\n  end;\r\n\r\n  if ((Rect.Right - Rect.Left) / (ADesignatedArea.Right - ADesignatedArea.Left)) > ((Rect.Bottom - Rect.Top) / (ADesignatedArea.Bottom - ADesignatedArea.Top)) then\r\n    Ratio := (Rect.Right - Rect.Left) / (ADesignatedArea.Right - ADesignatedArea.Left)\r\n  else\r\n    Ratio := (Rect.Bottom - Rect.Top) / (ADesignatedArea.Bottom - ADesignatedArea.Top);\r\n\r\n  Result := RectF(0, 0, (Rect.Right - Rect.Left) / Ratio, (Rect.Bottom - Rect.Top) / Ratio);\r\n  RectCenterEx(Result, ADesignatedArea);\r\nend;\r\n\r\nfunction RectFitIntoEx(const Rect: TRectF; const ADesignatedArea: TRectF): TRectF;\r\nvar\r\n  Ratio: Single;\r\nbegin\r\n  Result := RectFitIntoEx(Rect, ADesignatedArea, Ratio);\r\nend;\r\n\r\nfunction RectCenterEx(var R: TRect; const B: TRect): TRect;\r\nbegin\r\n  OffsetRectEx(R, -R.Left, -R.Top);\r\n  OffsetRectEx(R, (RectWidthEx(B) - RectWidthEx(R)) div 2, (RectHeightEx(B) - RectHeightEx(R)) div 2);\r\n  OffsetRectEx(R, B.Left, B.Top);\r\n  Result := R;\r\nend;\r\n\r\nfunction RectCenterEx(var R: TRectF; const B: TRectF): TRectF;\r\nbegin\r\n  OffsetRectEx(R, -R.Left, -R.Top);\r\n  OffsetRectEx(R, Round((RectWidthEx(B) - RectWidthEx(R)) / 2), Round((RectHeightEx(B) - RectHeightEx(R)) / 2));\r\n  OffsetRectEx(R, B.Left, B.Top);\r\n  Result := R;\r\nend;\r\n\r\nfunction IntersectRectEx(out Rect: TRectF; const R1, R2: TRectF): Boolean;\r\nvar\r\n  tmpRect: TRectF;\r\nbegin\r\n  tmpRect := R1;\r\n  if R2.Left > R1.Left then tmpRect.Left := R2.Left;\r\n  if R2.Top > R1.Top then tmpRect.Top := R2.Top;\r\n  if R2.Right < R1.Right then tmpRect.Right := R2.Right;\r\n  if R2.Bottom < R1.Bottom then tmpRect.Bottom := R2.Bottom;\r\n  {$IFDEF WEBLIB}\r\n  Result := not RectIsEmpty(tmpRect);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Result := not tmpRect.IsEmpty;\r\n  {$ENDIF}\r\n  if not Result then\r\n  begin\r\n    tmpRect.Top := 0.0;\r\n    tmpRect.Bottom := 0.0;\r\n    tmpRect.Left := 0.0;\r\n    tmpRect.Right := 0.0;\r\n  end;\r\n  Rect := tmpRect;\r\nend;\r\n\r\nfunction EmptyRect: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\nend;\r\n\r\nfunction RectIsEmpty(const R: TRectF): Boolean;\r\nbegin\r\n  Result := (R.Right < R.Left) or SameValue(R.Right, R.Left)\r\n         or (R.Bottom < R.Top) or SameValue(R.Bottom, R.Top);\r\nend;\r\n\r\nfunction CompareValueEx(const A, B: Extended; Epsilon: Extended = 0): TTMSFNCValueRelationShip;\r\nbegin\r\n  if SameValue(A, B, Epsilon) then\r\n    Result := EqualsValue\r\n  else if A < B then\r\n    Result := LessThanValue\r\n  else\r\n    Result := GreaterThanValue;\r\nend;\r\n\r\nfunction RectIntersectsWithEx(const ARect: TRectF; const R: TRectF): Boolean;\r\nbegin\r\n  Result := (ARect.Left < R.Right)\r\n        and (ARect.Right > R.Left)\r\n        and (ARect.Top < R.Bottom)\r\n        and (ARect.Bottom > R.Top);\r\nend;\r\n\r\nfunction CenterPointEx(const R: TRectF): TPointF;\r\nbegin\r\n  Result.X := (R.Right - R.Left) / 2.0 + R.Left;\r\n  Result.Y := (R.Bottom - R.Top) / 2.0 + R.Top;\r\nend;\r\n\r\nfunction MakeRectF(Left, Top, Width, Height: Single): TRectF;\r\nbegin\r\n  Result.Left := Left;\r\n  Result.Top := Top;\r\n  {$IFDEF WEBLIB}\r\n  Result.Right := Left + Width;\r\n  Result.Bottom := Top + Height;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Result.Width := Width;\r\n  Result.Height := Height;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction GetPointLength(const Point: TPointF): Single;\r\nbegin\r\n  Result := Sqrt(Sqr(Point.X) + Sqr(Point.Y));\r\nend;\r\n\r\nfunction ConvertToRect(const Rect: TRect): TRect;\r\nbegin\r\n  Result := Rect;\r\nend;\r\n\r\nfunction ConvertToRect(const Rect: TRectF): TRect;\r\nbegin\r\n  Result.Left := Round(Rect.Left);\r\n  Result.Top := Round(Rect.Top);\r\n  Result.Right := Round(Rect.Right);\r\n  Result.Bottom := Round(Rect.Bottom);\r\nend;\r\n\r\nfunction ConvertToRectF(const Rect: TRectF): TRectF;\r\nbegin\r\n  Result := Rect;\r\nend;\r\n\r\nfunction ConvertToRectF(const Rect: TRect): TRectF;\r\nbegin\r\n  Result.Left := Rect.Left;\r\n  Result.Top := Rect.Top;\r\n  Result.Right := Rect.Right;\r\n  Result.Bottom := Rect.Bottom;\r\nend;\r\n\r\nfunction ConvertToPoint(const Point: TPoint): TPoint;\r\nbegin\r\n  Result := Point;\r\nend;\r\n\r\nfunction ConvertToPoint(const Point: TPointF): TPoint;\r\nbegin\r\n  Result.X := Round(Point.X);\r\n  Result.Y := Round(Point.Y);\r\nend;\r\n\r\nfunction ConvertToPointF(const Point: TPointF): TPointF;\r\nbegin\r\n  Result := Point;\r\nend;\r\n\r\nfunction ConvertToPointF(const Point: TPoint): TPointF;\r\nbegin\r\n  Result.X := Point.X;\r\n  Result.Y := Point.Y;\r\nend;\r\n\r\nfunction ConvertToSize(const Size: TSize): TSize;\r\nbegin\r\n  Result := Size;\r\nend;\r\n\r\nfunction ConvertToSize(const Size: TSizeF): TSize;\r\nbegin\r\n  Result.cx := Round(Size.cx);\r\n  Result.cy := Round(Size.cy);\r\nend;\r\n\r\nfunction ConvertToSizeF(const Size: TSizeF): TSizeF;\r\nbegin\r\n  Result := Size;\r\nend;\r\n\r\nfunction ConvertToSizeF(const Size: TSize): TSizeF;\r\nbegin\r\n  Result.cx := Size.cx;\r\n  Result.cy := Size.cy;\r\nend;\r\n\r\n{ TTMSFNCMargins }\r\n\r\nprocedure TTMSFNCMargins.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCMargins then\r\n  begin\r\n    FLeft := (Source as TTMSFNCMargins).Left;\r\n    FTop := (Source as TTMSFNCMargins).Top;\r\n    FRight := (Source as TTMSFNCMargins).Right;\r\n    FBottom := (Source as TTMSFNCMargins).Bottom;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCMargins.Changed;\r\nbegin\r\n  if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nconstructor TTMSFNCMargins.Create(const ARect: TRectF);\r\nbegin\r\n  FLeft := ARect.Left;\r\n  FBottom := ARect.Bottom;\r\n  FRight := ARect.Right;\r\n  FTop := ARect.Top;\r\nend;\r\n\r\nconstructor TTMSFNCMargins.Create;\r\nbegin\r\n  FLeft := 0;\r\n  FBottom := 0;\r\n  FRight := 0;\r\n  FTop := 0;\r\nend;\r\n\r\nfunction TTMSFNCMargins.Empty: Boolean;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := RectF(Left, Top, Right, Bottom);\r\n  {$IFDEF WEBLIB}\r\n  Result := RectIsEmpty(R);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Result := R.IsEmpty;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCMargins.SetBottom(const Value: Single);\r\nbegin\r\n  if FBottom <> Value then\r\n  begin\r\n    FBottom := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCMargins.SetLeft(const Value: Single);\r\nbegin\r\n  if FLeft <> Value then\r\n  begin\r\n    FLeft := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCMargins.SetRight(const Value: Single);\r\nbegin\r\n  if FRight <> Value then\r\n  begin\r\n    FRight := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCMargins.SetTop(const Value: Single);\r\nbegin\r\n  if FTop <> Value then\r\n  begin\r\n    FTop := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCMargins.IsLeftStored: Boolean;\r\nbegin\r\n  Result := Left <> 0;\r\nend;\r\n\r\nfunction TTMSFNCMargins.IsTopStored: Boolean;\r\nbegin\r\n  Result := Top <> 0;\r\nend;\r\n\r\nfunction TTMSFNCMargins.PaddingRect(const R: TRectF): TRectF;\r\nbegin\r\n  Result := RectF(R.Left + FLeft, R.Top + FTop, R.Right - FRight, R.Bottom - FBottom);\r\nend;\r\n\r\nfunction TTMSFNCMargins.Rect: TRectF;\r\nbegin\r\n  Result := RectF(Left, Top, Right, Bottom);\r\nend;\r\n\r\nfunction TTMSFNCMargins.IsBottomStored: Boolean;\r\nbegin\r\n  Result := Bottom <> 0;\r\nend;\r\n\r\nfunction TTMSFNCMargins.IsRightStored: Boolean;\r\nbegin\r\n  Result := Right <> 0;\r\nend;\r\n\r\n{$IFNDEF LIMITEDGRAPHICSMODE}\r\n\r\n{ TTMSFNCScaledBitmap }\r\n\r\nprocedure TTMSFNCScaledBitmap.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCScaledBitmap then\r\n  begin\r\n    FBitmap.Assign((Source as TTMSFNCScaledBitmap).Bitmap);\r\n    FBitmapName := (Source as TTMSFNCScaledBitmap).BitmapName;\r\n    FScale := (Source as TTMSFNCScaledBitmap).Scale;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmap.BitmapChanged(Sender: TObject);\r\nbegin\r\n  Changed(False);\r\nend;\r\n\r\nconstructor TTMSFNCScaledBitmap.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  FBitmap := TTMSFNCBitmap.Create;\r\n  FBitmap.OnChange := @BitmapChanged;\r\n  FScale := 1.0;\r\nend;\r\n\r\ndestructor TTMSFNCScaledBitmap.Destroy;\r\nbegin\r\n  FBitmap.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmap.IsScaleStored: Boolean;\r\nbegin\r\n  Result := Scale <> 1.0;\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmap.SetBitmap(const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FBitmap <> Value then\r\n  begin\r\n    FBitmap.Assign(Value);\r\n    Changed(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmap.SetBitmapName(const Value: string);\r\nbegin\r\n  if FBitmapName <> Value then\r\n  begin\r\n    FBitmapName := Value;\r\n    Changed(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmap.SetScale(const Value: Single);\r\nbegin\r\n  if FScale <> Value then\r\n  begin\r\n    FScale := Value;\r\n    Changed(False);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCScaledBitmaps }\r\n\r\nfunction TTMSFNCScaledBitmaps.Add(Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := TTMSFNCScaledBitmap(inherited Add);\r\n  Result.Scale := Scale;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.AddBitmap(Bitmap: TTMSFNCBitmap; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := Add(Scale);\r\n  Result.Bitmap.Assign(Bitmap);\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nfunction TTMSFNCScaledBitmaps.AddBitmapFromFile(FileName: string;\r\n  Scale: Single): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := Add(Scale);\r\n  Result.Bitmap.LoadFromFile(FileName);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCScaledBitmaps.AddBitmapFromResource(ResourceName: String; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  Result := AddBitmapFromResource(ResourceName, 0, Scale);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Result := AddBitmapFromResource(ResourceName, HInstance, Scale);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.AddBitmapFromResource(ResourceName: String; AInstance: NativeUInt; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := Add(Scale);\r\n  Result.Bitmap.LoadFromResource(ResourceName, AInstance);\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.AddBitmapName(BitmapName: string; Scale: Single = 1.0): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := Add(Scale);\r\n  Result.BitmapName := BitmapName;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.AddDrawBitmap(Bitmap: TTMSFNCDrawBitmap;\r\n  Scale: Single): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := Add(Scale);\r\n  Result.Bitmap.Assign(Bitmap);\r\nend;\r\n\r\nconstructor TTMSFNCScaledBitmaps.Create(AOwner: TPersistent);\r\nbegin\r\n  inherited Create(AOwner, TTMSFNCScaledBitmap);\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.GetBitmap(Scale: Single): TTMSFNCBitmap;\r\nbegin\r\n  Result := GetBitmapByScale(Scale);\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.GetBitmapByScale(\r\n  Scale: Single): TTMSFNCBitmap;\r\nvar\r\n  it: TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := nil;\r\n  it := GetItemByScale(Scale);\r\n  if Assigned(it) then\r\n    Result := it.Bitmap;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.GetItemByScale(Scale: Single): TTMSFNCScaledBitmap;\r\nvar\r\n  I: Integer;\r\n  cl: TTMSFNCScaledBitmap;\r\n  it: TTMSFNCScaledBitmap;\r\n  mx: Single;\r\nbegin\r\n  Result := nil;\r\n  cl := nil;\r\n  mx := 0;\r\n  for I := 0 to Count - 1 do\r\n  begin\r\n    it := Items[I];\r\n    if it.Scale = Scale then\r\n    begin\r\n      Result := it;\r\n      Break;\r\n    end\r\n    else if (it.Scale <> Scale) and (it.Scale > mx) then\r\n    begin\r\n      cl := it;\r\n      mx := it.Scale;\r\n    end;\r\n  end;\r\n\r\n  if Result = nil then\r\n    Result := cl;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.GetItems(Index: Integer): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := TTMSFNCScaledBitmap(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.Insert(Index: Integer;\r\n  Scale: Single): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := TTMSFNCScaledBitmap(inherited Insert(Index));\r\n  Result.Scale := Scale;\r\nend;\r\n\r\nfunction TTMSFNCScaledBitmaps.Insert(Index: integer): TTMSFNCScaledBitmap;\r\nbegin\r\n  Result := TTMSFNCScaledBitmap(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmaps.SetBitmap(Scale: Single;\r\n  const Value: TTMSFNCBitmap);\r\nvar\r\n  b: TTMSFNCScaledBitmap;\r\nbegin\r\n  b := GetItemByScale(Scale);\r\n  if not Assigned(b) then\r\n    b := Add(Scale);\r\n\r\n  b.Bitmap.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmaps.SetItems(Index: Integer; const Value: TTMSFNCScaledBitmap);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nprocedure TTMSFNCScaledBitmaps.Update(Item: TCollectionItem);\r\nbegin\r\n  inherited;\r\n  if Assigned(FOnChange) then\r\n    FOnChange(Self);\r\nend;\r\n\r\n{$ENDIF}\r\n\r\n{$IFNDEF WEBLIB}\r\n\r\n{ TTMSFNCOwnedCollection<T>.TEnumerator }\r\n\r\nconstructor TTMSFNCOwnedCollection{$IFNDEF LCLLIB}<T>{$ENDIF}.TEnumerator.Create(ACol: TTMSFNCCollection);\r\nbegin\r\n  inherited Create;\r\n  FIndex := -1;\r\n  FCol := ACol;\r\nend;\r\n\r\nfunction TTMSFNCOwnedCollection{$IFNDEF LCLLIB}<T>{$ENDIF}.TEnumerator.GetCurrent: T;\r\nbegin\r\n  Result := FCol.GetItem(FIndex);\r\nend;\r\n\r\nfunction TTMSFNCOwnedCollection{$IFNDEF LCLLIB}<T>{$ENDIF}.TEnumerator.MoveNext: Boolean;\r\nbegin\r\n  Result := FIndex < FCol.Count - 1;\r\n  if Result then\r\n    Inc(FIndex);\r\nend;\r\n\r\n{ TTMSFNCOwnedCollection<T> }\r\n\r\nfunction TTMSFNCOwnedCollection{$IFNDEF LCLLIB}<T>{$ENDIF}.GetEnumerator: TEnumerator;\r\nbegin\r\n  Result := TEnumerator.Create(Self);\r\nend;\r\n\r\nfunction TTMSFNCOwnedCollection{$IFNDEF LCLLIB}<T>{$ENDIF}.GetItem(AIndex: Integer): T;\r\nbegin\r\n  Result := Items[AIndex] as T;\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCUtils;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  Windows,\r\n  {$ENDIF}\r\n  Classes, SysUtils, Types, WEBLib.TMSFNCTypes, WEBLib.Controls,\r\n  WEBLib.Graphics, WEBLib.Forms\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types, FMX.Dialogs\r\n  {$IFDEF MACOS}\r\n  ,MacApi.ObjectiveC, MacApi.ObjcRuntime\r\n  {$IFDEF IOS}\r\n  ,iOSApi.Foundation\r\n  {$ELSE}\r\n  ,MacApi.Foundation\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,Rtti\r\n  {$ENDIF}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  ,UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,JPEG, PngImage, GifImg\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  ,VCL.Dialogs\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,WEBLib.Dialogs\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  PthDel = {$IFDEF MSWINDOWS} '\\'; {$ELSE} '/'; {$ENDIF}\r\n\r\ntype\r\n  TTMSFNCUtilsCharSet = array of char;\r\n\r\n  TTMSFNCUtils = class\r\n  public\r\n    class procedure OpenURL(AURL: string);\r\n    class procedure OpenFile(AFile: string; {%H-}AControlReference: TControl = nil);\r\n    class procedure GetFonts(FontList: TStringList);\r\n    class procedure SetFontSize(AFont: TFont; ASize: Single);\r\n    class function GetHInstance: NativeUInt;\r\n    class function IsHTMLUnicode(AValue: UnicodeString): Boolean;\r\n    class function IsHTML(AValue: String): Boolean;\r\n    class function GetDocumentsPath: String;\r\n    class function GetAppPath: String;\r\n    class function GetMousePos: TPointF;\r\n    class function IsHighDPIScale: Boolean;\r\n    class function GetDPIScale({%H-}AOwner: TComponent = nil): Single;\r\n    class function AddBackslash(const AValue: string): string;\r\n    class function GetResourceStream(AResourceName: string): TResourceStream; overload;\r\n    class function GetResourceStream(AResourceName: string; AInstance: NativeUInt): TResourceStream; overload;\r\n    class function Clone(AComponent: TComponent): TComponent;\r\n    class function HTMLStrip(AHTML: string): string;\r\n    class function VarPos(ASubValue, AValue: string; var AResult: Integer): Integer;\r\n    class function VarPosNoCase(ASubValue, AValue: string; var AResult: Integer): Integer;\r\n    class function CharInStr(s: string; Index: Integer): Char;\r\n    class function HexStrToBytes(const AValue: string): TBytes;\r\n    class function SaveBitmapToHexStr(const ABitmap: TTMSFNCBitmap): string;\r\n    class function SaveStreamToHexStr(const AStream: TStream): string;\r\n    class function CreateBitmapFromHexStr(const AHexStr: string): TTMSFNCBitmap;\r\n    class function MulDivInt(nNumber, nNumerator, nDenominator: Integer): Integer; overload;\r\n    class function MulDivSingle(nNumber, nNumerator, nDenominator: Single): Single; overload;\r\n    class procedure LoadBitmapFromHexStr(const AHexStr: string; const ABitmap: TTMSFNCBitmap);\r\n    class procedure LoadStreamFromHexStr(const AHexStr: string; const AStream: TStream);\r\n    {$IFDEF CMNLIB}\r\n    class function ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TColor = clWhite): TMemoryStream;\r\n    class function FindGraphicClass(const Buffer; const {%H-}BufferSize: Int64; out GraphicClass: TGraphicClass): Boolean;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    class function ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TAlphaColor = TAlphaColorRec.White): TMemoryStream;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    class function ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TColor = clWhite): TMemoryStream;\r\n    {$ENDIF}\r\n    class procedure Split(const ADelimiter: Char; AInput: string; const AStrings: TStrings);\r\n    class function MatchStrEx(AValue1, AValue2: string; ACaseSensitive: Boolean): Boolean;\r\n    class function MatchStr(AValue1, AValue2:string; ACaseSensitive: Boolean): Boolean;\r\n    class function StripLogicSpaces(AValue: string): string;\r\n    class function FirstChar(ACharset: TTMSFNCUtilsCharSet; AValue: string; var spos: Integer): char;\r\n    class function CharInSet(ch: Char; ACharSet: TTMSFNCUtilsCharSet): boolean; overload;\r\n    class function AddCharSet(ACharSet1, ACharSet2: TTMSFNCUtilsCharSet): TTMSFNCUtilsCharSet;\r\n    class function SubCharSet(ACharSet1, ACharSet2: TTMSFNCUtilsCharSet): TTMSFNCUtilsCharSet;\r\n    class function AlphaCharSet: TTMSFNCUtilsCharSet;\r\n    class function NumericCharSet: TTMSFNCUtilsCharSet;\r\n    class function CreateCharSet(AValue: string): TTMSFNCUtilsCharSet;\r\n    class function IsDate(AValue: string; var ADate: TDateTime): boolean;\r\n    class function IPos(su,s:string):Integer;\r\n    class function UnFixMarkup(su:string; SpecialChars: boolean = true): string;\r\n    class function FixMarkup(su:string;SpecialChars: boolean = true): string;\r\n    class function TagReplaceString(const Srch,Repl:string;var Dest:string):Boolean;\r\n    class function Matches(s0a, s1a: PChar): Boolean; overload;\r\n    {$IFNDEF WEBLIB}\r\n    class function Matches(s0a, s1a: string): Boolean; overload;\r\n    {$ENDIF}\r\n    class function StripThousandSep(ps: string): String;\r\n    class function ClosingParenthesis(s1: string): Integer;\r\n    class function GetMarkupIndex(const Markup: string): integer;\r\n    class function GetSpecialChar(const Value: integer): UnicodeString;\r\n    class function IndexOfTextInArray(const AText: string; const AValues: array of string): Integer;\r\n    {$IFDEF MACOS}\r\n    class function NSStrEx(AString: String): NSString;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    class function GetParentForm(AControl: TFMXObject): TCustomForm;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    class function GetParentForm(AControl: TControl): TCustomForm;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    class function GetParentForm(AControl: TControl): TCustomForm;\r\n    {$ENDIF}\r\n    class function GetOwnerForm(AComponent: TComponent): TCustomForm;\r\n    class function &Message(const AMessage: string): Integer; overload;\r\n    class function &Message(const AMessage: string; const ADialogType: TMsgDlgType; const AButtons: TMsgDlgButtons; const AHelpContext: LongInt): Integer; overload;\r\n    class function SelectFile(var AFileName: string; const ADefaultFolder: string = ''; const AFilter: string = ''): Boolean;\r\n    class function SaveFile(var AFileName: string; const AFilter: string = ''): Boolean;\r\n    class function EscapeString(const AValue: string): string;\r\n    class function UnescapeString(const AValue: string): string;\r\n    class function DownloadImage(AURL: string): TMemoryStream;\r\n  end;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCComponentHelper = class helper for TComponent\r\n    function GetVersionNumber(AMaj, AMin, ARel, ABld: ShortInt): string;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNLIB}\r\n  TTMSFNCControlHelper = class helper for TControl\r\n    function MakeScreenshot: TTMSFNCBitmap;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCClipBoardFormat = (cfText, cfRTF, cfHTML, cfBitmap, cfBitmapWin, cfStream, cfRichTextStream);\r\n\r\n  TTMSFNCClipBoard = class\r\n  protected\r\n    {$IFDEF FMXLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    class function GetFormat(AFormat: TTMSFNCClipBoardFormat): Cardinal; virtual;\r\n    class function isTextFormat(AFormat: Cardinal): Boolean; virtual;\r\n    class function isStreamFormat(AFormat: Cardinal): Boolean; virtual;\r\n    {$ELSE}\r\n    class function GetFormat(AFormat: TTMSFNCClipBoardFormat): string; virtual;\r\n    class function isTextFormat(AFormat: String): Boolean; virtual;\r\n    class function isStreamFormat(AFormat: String): Boolean; virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  public\r\n    {$IFDEF FMXLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    class procedure SetValue(AValue: TValue; AFormat: Cardinal); virtual;\r\n    class function GetValue(AFormat: Cardinal): TValue; virtual;\r\n    class function GetCustomValue(AFormat: Cardinal; AData: Pointer): TValue; virtual;\r\n    class procedure SetCustomValue(AFormat: Cardinal; AValue: TValue; var AData: Pointer); virtual;\r\n    class function AllocateCustomValue(AFormat: Cardinal; AValue: TValue): THandle; virtual;\r\n    {$ELSE}\r\n    class procedure SetValue(AValue: TValue; AFormat: String); virtual;\r\n    class function GetValue(AFormat: String): TValue; virtual;\r\n    {$IFDEF MACOS}\r\n    class function GetCustomValue(AFormat: String; AData: NSData): TValue; virtual;\r\n    class function SetCustomValue(AFormat: String; AValue: TValue): NSData; virtual;\r\n    {$ELSE}\r\n    class function GetCustomValue(AFormat: String; AData: Pointer): TValue; virtual;\r\n    class function SetCustomValue(AFormat: String; AValue: TValue): Pointer; virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    {$IFDEF MSWINDOWS}\r\n    class procedure SetBitmapWin(ABitmap: TTMSFNCBitmap); virtual;\r\n    class function GetBitmapWin: TTMSFNCBitmap; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF MSWINDOWS}\r\n    class function HasFormat(AFormat: Cardinal): Boolean; overload; virtual;\r\n    {$ELSE}\r\n    class function HasFormat(AFormat: String): Boolean; overload; virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    {$IFDEF CMNLIB}\r\n    class function GetFormat(AFormat: TTMSFNCClipBoardFormat): string; virtual;\r\n    {$ENDIF}\r\n    class function HasFormat(AFormat: TTMSFNCClipBoardFormat): Boolean; overload; virtual;\r\n    class function HasContent: Boolean; virtual;\r\n    class procedure Clear; virtual;\r\n    class procedure SetText(AText: String); virtual;\r\n    class function GetText: String; virtual;\r\n    class procedure SetStream(AStream: TMemoryStream); virtual;\r\n    class function GetStream: TMemoryStream; virtual;\r\n    class procedure SetBitmap(ABitmap: TTMSFNCBitmap); virtual;\r\n    class function GetBitmap: TTMSFNCBitmap; virtual;\r\n    class procedure SetRichTextStream(AStream: TMemoryStream); virtual;\r\n    class function GetRichTextStream: TMemoryStream; virtual;\r\n    class procedure SetRTF(ARTF: String); virtual;\r\n    class function GetRTF: String; virtual;\r\n    class procedure SetHTML(AHTML: String); virtual;\r\n    class function GetHTML: String; virtual;\r\n  end;\r\n\r\n{$EXTERNALSYM Hiword}\r\nfunction Hiword(L: DWORD): Word;\r\n{$EXTERNALSYM LoWord}\r\nfunction LoWord(L: DWORD): Word;\r\n{$EXTERNALSYM MakeWord}\r\nfunction MakeWord(b1,b2: Integer): Integer;\r\n{$EXTERNALSYM MakeLong}\r\nfunction MakeLong(i1,i2: Integer): Integer;\r\n\r\nvar\r\n  CF_FNCSTREAM: Word;\r\n  CF_FNCRICHTEXTSTREAM: Word;\r\n  CF_FNCRTF: Word;\r\n  CF_FNCBITMAP: Word;\r\n  {$IFDEF FMXLIB}\r\n  CF_FNCBITMAPWIN: Word;\r\n  {$ENDIF}\r\n  CF_FNCHTML: Word;\r\n\r\nimplementation\r\n\r\n{$IFNDEF WEBLIB}\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  {$IFNDEF LCLLIB}\r\n  WinInet, ShellApi, AnsiStrings\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,ShlObj, ComObj\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  iOSApi.UIKit, iOSApi.CocoaTypes, FMX.Platform.iOS\r\n  {$ELSE}\r\n  MacApi.AppKit\r\n  {$ENDIF}\r\n  ,MacApi.Helpers\r\n  {$ENDIF}\r\n  {$IFDEF ANDROID}\r\n  AndroidApi.JNI.App, AndroidApi.JNI.GraphicsContentViewText, AndroidApi.JNIBridge, Generics.Collections,\r\n  AndroidApi.JNI.Net, AndroidApi.Helpers, FMX.Helpers.Android, AndroidApi.JNI.JavaTypes\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  {$IFDEF LINUX}\r\n  StrUtils, FMUX.Api\r\n  {$ENDIF}\r\n  ,FMX.Platform, IOUtils, FMX.Surfaces\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 28}\r\n  ,FMX.Utils\r\n  {$IFEND}\r\n  {$IF COMPILERVERSION > 30}\r\n  {$IFDEF FMXMOBILE}\r\n  ,FMX.DialogService.Async\r\n  {$ELSE}\r\n  ,FMX.DialogService.Sync\r\n  {$ENDIF}\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  LCLIntF, LCLType\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  ,ClipBrd\r\n  {$ENDIF}\r\n  {$IFNDEF LINUX}\r\n  {$IFNDEF LCLLIB}\r\n  ,StrUtils\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,FPHTTPClient\r\n  {$ENDIF}\r\n  ;\r\n{$ENDIF}\r\n\r\nconst\r\n  HTMLNumSpecialChar = 64;\r\n  JSONNumSpecialChar = 7;\r\n\r\nvar\r\n  HTMLEncodedChar : array[1..HTMLNumSpecialChar] of unicodestring = ('&','<','>','\"',' ',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','','',\r\n                                                     '','','');\r\n\r\n  HTMLSpecialChar : array[1..HTMLNumSpecialChar] of string = ('amp;','lt;','gt;','quot;','&nbsp;',\r\n                                             '&eacute;','&egrave;','&euml;','&ecirc;',\r\n                                             '&oacute;','&ograve;','&ouml;','&ocirc;',\r\n                                             '&iacute;','&igrave;','&iuml;','&icirc;',\r\n                                             '&uacute;','&ugrave;','&uuml;','&ucirc;',\r\n                                             '&aacute;','&agrave;','&auml;','&acirc;',\r\n                                             '&Eacute;','&Egrave;','&Euml;','&Ecirc;',\r\n                                             '&Oacute;','&Ograve;','&Ouml;','&Ocirc;',\r\n                                             '&Iacute;','&Igrave;','&Iuml;','&Icirc;',\r\n                                             '&Uacute;','&Ugrave;','&Uuml;','&Ucirc;',\r\n                                             '&Aacute;','&Agrave;','&Auml;','&Acirc;',\r\n                                             '&ccedil;','&Ccedil;','&oslash;','&Oslash;',\r\n                                             '&aring;','&Aring;','&copy;','&reg;',\r\n                                             '&euro;','&laquo;','&raquo;','&atilde;',\r\n                                             '&Atilde;','&otilde;','&Otilde',\r\n                                             '&trade;','&sect;','&para;','&szlig;');\r\n\r\n  JSONSpecialChar: array[1..JSONNumSpecialChar] of char = ('\"','\\',#8,#12,#10,#13,#9);\r\n\r\n  JSONEncodedSpecialChar: array[1..JSONNumSpecialChar] of string = ('\\u0022','\\u005C','\\u0008','\\u000C','\\u000A','\\u000D','\\u0009');\r\n\r\n\r\nfunction Hiword(L: DWORD): Word;\r\nbegin\r\n  Result := L shr 16;\r\nend;\r\n\r\nfunction LoWord(L: DWORD): Word;\r\nbegin\r\n  Result := L AND $FFFF;\r\nend;\r\n\r\nfunction MakeWord(b1,b2: Integer): Integer;\r\nbegin\r\n  Result := b1 or b2 shl 8;\r\nend;\r\n\r\nfunction MakeLong(i1,i2: Integer): Integer;\r\nbegin\r\n  Result := i1 or i2 shl 16;\r\nend;\r\n\r\n{$IFDEF ANDROID}\r\ntype\r\n  JHttpURLConnection = interface;\r\n  JURLConnection = interface;\r\n  JURL = interface;\r\n\r\n  JURLClass = interface(JObjectClass)\r\n    ['{3E1A363B-FA2A-4399-A0C7-24DFC255E133}']\r\n    {class} function init(spec: JString): JURL; cdecl; overload;\r\n  end;\r\n\r\n  [JavaSignature('java/net/URL')]\r\n  JURL = interface(JObject)\r\n    ['{BCC8860A-E48B-4894-95A9-26B3AFDF3EDC}']\r\n    function openConnection: JURLConnection; cdecl; overload;\r\n  end;\r\n  TJURL = class(TJavaGenericImport<JURLClass, JURL>) end;\r\n\r\n  JURLConnectionClass = interface(JObjectClass)\r\n    ['{969FF7F8-7B73-491C-A621-855E197B0B6B}']\r\n  end;\r\n\r\n  [JavaSignature('java/net/URLConnection')]\r\n  JURLConnection = interface(JObject)\r\n    ['{F50D6528-AE5E-4862-89A1-CAE44274AED9}']\r\n    function getHeaderField(key: JString): JString; cdecl; overload;\r\n  end;\r\n  TJURLConnection = class(TJavaGenericImport<JURLConnectionClass, JURLConnection>) end;\r\n\r\n  JHttpURLConnectionClass = interface(JURLConnectionClass)\r\n    ['{D80190E4-FBCC-4286-9E39-42F45C58E7D9}']\r\n  end;\r\n  [JavaSignature('java/net/HttpURLConnection')]\r\n  JHttpURLConnection = interface(JURLConnection)\r\n  ['{57A25834-F65A-4078-8B73-1C566DF70536}']\r\n    procedure setRequestMethod(method: JString); cdecl;\r\n    procedure setDoInput(newValue: Boolean); cdecl;\r\n    procedure setDoOutput(newValue: Boolean); cdecl;\r\n    function getOutputStream: JOutputStream; cdecl;\r\n    function getInputStream: JInputStream; cdecl;\r\n    function getResponseCode: Integer; cdecl;\r\n  end;\r\n  TJHttpURLConnection = class(TJavaGenericImport<JHttpURLConnectionClass, JHttpURLConnection>) end;\r\n\r\ntype\r\n  TTMSFNCUtilsFileMode = (ufmOpen, ufmSave);\r\n\r\n  TTMSFNCUtilsDialogDismissListener = class(TJavaLocal, JDialogInterface_OnDismissListener)\r\n  public\r\n    procedure onDismiss(dialog: JDialogInterface); cdecl;\r\n  end;\r\n\r\n  TTMSFNCUtilsDialogSelectDirectoryListener = class(TJavaLocal, JDialogInterface_OnClickListener)\r\n  public\r\n    procedure onClick(dialog: JDialogInterface; which: Integer); cdecl;\r\n  end;\r\n\r\n  TTMSFNCUtilsDialogSelectFileListener = class(TJavaLocal, JDialogInterface_OnClickListener)\r\n  public\r\n    procedure onClick(dialog: JDialogInterface; which: Integer); cdecl;\r\n  end;\r\n\r\nvar\r\n  FFilePicked: Boolean;\r\n  FFileMode: TTMSFNCUtilsFileMode;\r\n  FSelectedFile: String;\r\n  FCancelled: Boolean;\r\n  FManuallyCancelled: Boolean;\r\n  FDialogBuilder: JAlertDialog_Builder;\r\n  FDialog: JDialog;\r\n  FCurrentPath: JFile;\r\n  FFileList: TJavaObjectArray<JCharSequence>;\r\n  FDirectoryListener: TTMSFNCUtilsDialogSelectDirectoryListener;\r\n  FSelectFileListener: TTMSFNCUtilsDialogSelectFileListener;\r\n  FFilter: string;\r\n  FDismissListener: TTMSFNCUtilsDialogDismissListener;\r\n\r\nfunction SharedActivityEx: JActivity;\r\nbegin\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 29}\r\n  Result := TAndroidHelper.Activity;\r\n  {$ELSE}\r\n  Result := SharedActivity;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\nend;\r\n\r\nprocedure LoadFileList(APath: JFile; AFilter: string);\r\nvar\r\n  l, lf: TList<string>;\r\n  a, c: TArray<string>;\r\n  I, K: Integer;\r\n  s: string;\r\n  SR: TSearchRec;\r\n  fn: string;\r\n  chk: Boolean;\r\nbegin\r\n  FCurrentPath := APath;\r\n  l := TList<string>.Create;\r\n  if APath.exists then\r\n  begin\r\n    lf := TList<string>.Create;\r\n\r\n    a := AFilter.Split(['|']);\r\n\r\n    for I := 0 to Length(a) - 1 do\r\n    begin\r\n      if Odd(I) then\r\n      begin\r\n        c := a[I].Split([';']);\r\n        for K := 0 to Length(c) - 1 do\r\n        begin\r\n          s := c[K].Replace('*', '');\r\n          if not lf.Contains(s) then\r\n            lf.Add(s);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if APath.getParentFile <> nil then\r\n      l.Add('..');\r\n\r\n    fn := TTMSFNCUtils.AddBackslash(JStringToString(APath.getPath)) + '*';\r\n    k := FindFirst(fn, faAnyFile, SR);\r\n    while K = 0 do\r\n    begin\r\n      chk := (sr.Name <> '.') and (sr.Name <> '..');\r\n      chk := chk and (lf.Contains(ExtractFileExt(sr.Name)) or (lf.Count = 0) or ((lf.Count = 1) and (lf[0] = '.')) or (sr.Attr and 16 = 16));\r\n\r\n      if chk then\r\n      begin\r\n        l.Add(ExtractFilePath(fn) + SR.Name);\r\n      end;\r\n\r\n      K := FindNext(SR);\r\n    end;\r\n    FindClose(SR);\r\n\r\n    lf.Free;\r\n  end;\r\n\r\n  FFileList := TJavaObjectArray<JCharSequence>.Create(l.Count);\r\n  for I := 0 to l.Count - 1 do\r\n    FFileList.Items[I] := StrToJCharSequence(l[I]);\r\n\r\n  l.Free;\r\nend;\r\n\r\nprocedure ShowDialog(AFile: JFile);\r\nbegin\r\n  FDialogBuilder := TJAlertDialog_Builder.JavaClass.init(SharedActivityEx);\r\n  FDialogBuilder.setTitle(StrToJCharSequence(JStringToString(AFile.getPath)));\r\n  if FFileMode = ufmSave then\r\n    FDialogBuilder.setPositiveButton(StrToJCharSequence('Save'), FDirectoryListener);\r\n  FDialogBuilder.setItems(FFileList, FSelectFileListener);\r\n  FDialog := FDialogBuilder.create;\r\n  FDialog.setOnDismissListener(FDismissListener);\r\n  FDialog.show;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF MACOS}\r\nclass function TTMSFNCUtils.NSStrEx(AString: String): NSString;\r\nbegin\r\n  Result := StrToNSStr(AString);\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCUtils }\r\n\r\nclass function TTMSFNCUtils.IPos(su,s:string):Integer;\r\nbegin\r\n  Result := Pos(UpperCase(su),UpperCase(s));\r\nend;\r\n\r\nclass function TTMSFNCUtils.TagReplaceString(const Srch,Repl:string;var Dest:string):Boolean;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  i := IPos(srch,dest);\r\n  if i > 0 then\r\n  begin\r\n    Result := True;\r\n    Delete(Dest,i,Length(Srch));\r\n    Dest := Copy(Dest,1,i-1) + Repl + Copy(Dest,i,Length(Dest));\r\n  end\r\n  else\r\n    Result := False;\r\nend;\r\n\r\nclass function TTMSFNCUtils.SaveFile(var AFileName: string; const AFilter: string = ''): Boolean;\r\n{$IFNDEF WEBLIB}\r\n{$IFNDEF FMXMOBILE}\r\nvar\r\n  s: TSaveDialog;\r\n  ext: string;\r\n{$ENDIF}\r\n{$IFDEF FMXMOBILE}\r\n{$IFDEF ANDROID}\r\nvar\r\n  fn: string;\r\n  f: string;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  {$IFDEF FMXMOBILE}\r\n  {$IFDEF ANDROID}\r\n  fn := ExtractFileName(AFileName);\r\n\r\n  FFileMode := ufmSave;\r\n  FFilePicked := False;\r\n  FCancelled := False;\r\n\r\n  FDirectoryListener := TTMSFNCUtilsDialogSelectDirectoryListener.Create;\r\n  FSelectFileListener := TTMSFNCUtilsDialogSelectFileListener.Create;\r\n  FDismissListener := TTMSFNCUtilsDialogDismissListener.Create;\r\n\r\n  FFilter := AFilter;\r\n  if ExtractFilePath(AFileName) = '' then\r\n    f := AddBackslash(TTMSFNCUtils.GetDocumentsPath)\r\n  else\r\n    f := AddBackslash(ExtractFilePath(AFileName));\r\n\r\n  FSelectedFile := f + fn;\r\n\r\n  FCurrentPath := TJFile.JavaClass.init(StringToJString(f));\r\n  LoadFileList(FCurrentPath, FFilter);\r\n  CallInUIThreadAndWaitFinishing(\r\n  procedure\r\n  begin\r\n    ShowDialog(FCurrentPath);\r\n  end\r\n  );\r\n\r\n  while not FFilePicked and not FCancelled do\r\n    Sleep(1);\r\n\r\n  if FFilePicked and not FCancelled then\r\n  begin\r\n    AFileName := FSelectedFile;\r\n    if ExtractFileExt(FSelectedFile) = '' then\r\n      AFileName := AddBackslash(AFileName) + fn;\r\n\r\n    Result := True;\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFNDEF FMXMOBILE}\r\n  s := TSaveDialog.Create(Application);\r\n  try\r\n    ext := ExtractFileExt(AFileName);\r\n    s.Filter := AFilter;\r\n    if ExtractFilePath(AFileName) = '' then\r\n      s.InitialDir := AddBackslash(TTMSFNCUtils.GetDocumentsPath)\r\n    else\r\n      s.InitialDir := AddBackslash(ExtractFilePath(AFileName));\r\n    s.Options := s.Options + [TOpenOption.ofOverwritePrompt];\r\n    s.FileName := ExtractFileName(AFileName);\r\n    if s.Execute then\r\n    begin\r\n      AFileName := s.FileName;\r\n      if ExtractFileExt(s.FileName) = '' then\r\n        AFileName := AFileName + ext;\r\n      Result := True;\r\n    end;\r\n  finally\r\n    s.Free;\r\n  end;\r\n  {$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('SaveFile not supported');\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.EscapeString(const AValue: string): string;\r\nvar\r\n  res: string;\r\n  ch: char;\r\n  i: integer;\r\n\r\n  function EscapeSpecialChar(ch: char; var s: string): boolean;\r\n  var\r\n    i: integer;\r\n  begin\r\n    Result := false;\r\n    s := '';\r\n\r\n    for i := 1 to JSONNumSpecialChar do\r\n    begin\r\n      if ch = JSONSpecialChar[i] then\r\n      begin\r\n        s := JSONEncodedSpecialChar[i];\r\n        Result := True;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  Result := '';\r\n  for i := 1 to length(AValue) do\r\n  begin\r\n    ch := CharInStr(AValue, i);\r\n\r\n    if ch > #127 then\r\n      Result := Result + '\\u' + IntToHex(ord(ch),4)\r\n    else\r\n    begin\r\n      res := '';\r\n      if EscapeSpecialChar(ch, res) then\r\n        Result := Result + res\r\n      else\r\n        Result := Result + ch\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.UnescapeString(const AValue: string): string;\r\nvar\r\n  i: Integer;\r\n  j: Integer;\r\n  c: Integer;\r\n  o: Integer;\r\n  s: string;\r\n  x: Integer;\r\nbegin\r\n  SetLength(s, Length(AValue));\r\n  {$IFDEF FMXMOBILE}\r\n  o := 1;\r\n  {$ENDIF}\r\n  {$IFNDEF FMXMOBILE}\r\n  o := 0;\r\n  {$ENDIF}\r\n  i := 1;\r\n  j := 1;\r\n  while i <= Length(AValue) do\r\n  begin\r\n    if AValue[i - o] = '\\' then\r\n    begin\r\n      if i < Length(AValue) then\r\n      begin\r\n        if AValue[i + 1 - o] = '\\' then\r\n        begin\r\n          x := j - o;\r\n          s[x] := '\\';\r\n          inc(i, 2);\r\n        end\r\n        else if (AValue[i + 1 - o] = 'u') and (i + 1 + 4 <= Length(AValue)) and TryStrToInt('$' + string(Copy(AValue, i + 2, 4)), c) then\r\n        begin\r\n          inc(i, 6);\r\n          x := j - o;\r\n          {$IFDEF WEBLIB}\r\n          s[x] := Chr(c);\r\n          {$ENDIF}\r\n          {$IFNDEF WEBLIB}\r\n          s[x] := Char(c);\r\n          {$ENDIF}\r\n        end\r\n        else\r\n          raise Exception.CreateFmt('Invalid code at position %s', [IntToStr(i)]);\r\n      end\r\n      else\r\n        raise Exception.Create('Unexpected end of string');\r\n    end\r\n    else\r\n    begin\r\n      x := j - o;\r\n      s[x] := AValue[i - o];\r\n      inc(i);\r\n    end;\r\n    inc(j);\r\n  end;\r\n  SetLength(s, j - 1);\r\n\r\n  Result := s;\r\nend;\r\n\r\nclass function TTMSFNCUtils.SelectFile(var AFileName: string; const ADefaultFolder: string = ''; const AFilter: string = ''): Boolean;\r\n{$IFNDEF WEBLIB}\r\n{$IFNDEF FMXMOBILE}\r\nvar\r\n  o: TOpenDialog;\r\n{$ENDIF}\r\n{$IFDEF FMXMOBILE}\r\n{$IFDEF ANDROID}\r\nvar\r\n  f: string;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  {$IFDEF FMXMOBILE}\r\n  {$IFDEF ANDROID}\r\n  FFileMode := ufmOpen;\r\n  FFilePicked := False;\r\n  FCancelled := False;\r\n\r\n  FSelectFileListener := TTMSFNCUtilsDialogSelectFileListener.Create;\r\n  FDismissListener := TTMSFNCUtilsDialogDismissListener.Create;\r\n\r\n  FFilter := AFilter;\r\n  if ADefaultFolder = '' then\r\n    f := AddBackslash(TTMSFNCUtils.GetDocumentsPath)\r\n  else\r\n    f := AddBackslash(ADefaultFolder);\r\n\r\n  FCurrentPath := TJFile.JavaClass.init(StringToJString(f));\r\n  LoadFileList(FCurrentPath, FFilter);\r\n  CallInUIThreadAndWaitFinishing(\r\n  procedure\r\n  begin\r\n    ShowDialog(FCurrentPath);\r\n  end\r\n  );\r\n\r\n  while not FFilePicked and not FCancelled do\r\n    Sleep(1);\r\n\r\n  if FFilePicked and not FCancelled then\r\n  begin\r\n    AFileName := FSelectedFile;\r\n    Result := True;\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFNDEF FMXMOBILE}\r\n  o := TOpenDialog.Create(Application);\r\n  try\r\n    o.Options := [TOpenOption.ofFileMustExist];\r\n    if ADefaultFolder = '' then\r\n      o.InitialDir := AddBackslash(TTMSFNCUtils.GetDocumentsPath)\r\n    else\r\n      o.InitialDir := AddBackslash(ADefaultFolder);\r\n    o.Filter := AFilter;\r\n    if o.Execute then\r\n    begin\r\n      AFileName := o.FileName;\r\n      Result := False;\r\n    end;\r\n  finally\r\n    o.Free;\r\n  end;\r\n  {$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('SelectFile not supported');\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.&Message(const AMessage: string): Integer;\r\nbegin\r\n  Result := TTMSFNCUtils.&Message(AMessage, TMsgDlgType.mtInformation, [TMsgDlgBtn.mbOK], 0);\r\nend;\r\n\r\nclass function TTMSFNCUtils.&Message(const AMessage: string; const ADialogType: TMsgDlgType; const AButtons: TMsgDlgButtons; const AHelpContext: LongInt): Integer;\r\nbegin\r\n{$IFNDEF WEBLIB}\r\n  {$IFDEF FMXMOBILE}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 30}\r\n  TDialogServiceAsync.MessageDialog(AMessage, ADialogType, AButtons, TMsgDlgBtn.mbYes, AHelpContext);\r\n  Result := mrOk;\r\n  {$ELSE}\r\n  Result := mrOk;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ELSE}\r\n  {$IFDEF LCLLIB}\r\n  Result := MessageDlg(AMessage, ADialogType, AButtons, AHelpContext);\r\n  {$ELSE}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 30}\r\n  {$IFDEF FMXLIB}\r\n  Result := TDialogServiceSync.MessageDialog(AMessage, ADialogType, AButtons, TMsgDlgBtn.mbYes, AHelpContext);\r\n  {$ELSE}\r\n  Result := MessageDlg(AMessage, ADialogType, AButtons, AHelpContext);\r\n  {$ENDIF}\r\n  {$ELSE}\r\n  Result := MessageDlg(AMessage, ADialogType, AButtons, AHelpContext);\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n  if ((TMsgDlgBtn.mbOK in AButtons) and (TMsgDlgBtn.mbCancel in AButtons)) or ((TMsgDlgBtn.mbYes in AButtons) and (TMsgDlgBtn.mbNo in AButtons)) then\r\n  begin\r\n    asm\r\n      if (window.confirm(AMessage))\r\n      {\r\n        return 1\r\n      }\r\n      else\r\n      {\r\n        return 2\r\n      }\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    asm\r\n      window.alert(AMessage);\r\n      return 1\r\n    end;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.NumericCharSet: TTMSFNCUtilsCharSet;\r\nvar\r\n  ch: char;\r\n  i: integer;\r\nbegin\r\n  SetLength(Result,10);\r\n  i := 0;\r\n\r\n  for ch := '0' to '9' do\r\n  begin\r\n    Result[i] := ch;\r\n    inc(i);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.CreateCharSet(AValue: string): TTMSFNCUtilsCharSet;\r\nvar\r\n  i: integer;\r\nbegin\r\n  SetLength(Result, Length(AValue));\r\n\r\n  for i := 1 to Length(AValue) do\r\n  begin\r\n    Result[i - 1] := CharInStr(AValue, i);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.DownloadImage(AURL: string): TMemoryStream;\r\n{$IFDEF LCLLIB}\r\nbegin\r\n  try\r\n    Result := TMemoryStream.Create;\r\n    TFPHTTPClient.SimpleGet(AURL, Result);\r\n  finally\r\n  end;\r\n{$ENDIF}\r\n{$IFNDEF LCLLIB}\r\n{$IFDEF MACOS}\r\nvar\r\n  req: NSMutableURLRequest;\r\n  nurl: NSURL;\r\n  res: Pointer;\r\n  resdata: NSData;\r\nbegin\r\n  Result := TMemoryStream.Create;\r\n  try\r\n    nurl := TNSURL.Wrap(TNSURL.OCClass.URLWithString(TTMSFNCUtils.NSStrEx(AURL)));\r\n    req := TNSMutableURLRequest.Wrap(TNSMutableURLRequest.OCClass.requestWithURL(nurl, NSURLRequestUseProtocolCachePolicy, 60.0));\r\n    req.setHTTPMethod(TTMSFNCUtils.NSStrEx('GET'));\r\n\r\n    res := nil;\r\n    resdata := TNSURLConnection.OCClass.sendSynchronousRequest(req, @res, nil);\r\n    if Assigned(resdata) and Assigned(res) then\r\n    begin\r\n      if not UTF8ToString(TNSString.Wrap(TNSHTTPURLResponse.Wrap(res).allHeaderFields.valueForKey(TTMSFNCUtils.NSStrEx('Content-Type'))).UTF8String).StartsWith('image/') then\r\n        Exit;\r\n\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Result.Write(resdata.bytes^, resdata.length);\r\n      {$ELSE}\r\n      Result.Write(resdata.bytes, resdata.length);\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n    end;\r\n  finally\r\n  end;\r\n{$ELSE}\r\n{$IFDEF ANDROID}\r\n  var\r\n    urlCon: JHttpURLConnection;\r\n    u: JURL;\r\n    r: Integer;\r\n    data: TJavaArray<Byte>;\r\n    bs: JByteArrayOutputStream;\r\n    ip: JInputStream;\r\n  begin\r\n    Result := TMemoryStream.Create;\r\n    try\r\n      u := TJURL.JavaClass.init(StringToJString(AURL));\r\n      urlCon := TJHttpURLConnection.Wrap((u.openConnection as ILocalObject).GetObjectID);\r\n      urlCon.setDoInput(True);\r\n      urlCon.setDoOutput(False);\r\n      urlCon.setRequestMethod(StringToJString('GET'));\r\n\r\n      if not urlCon.getHeaderField(StringToJString('Content-Type')).startsWith(StringToJString('image/')) then\r\n        Exit;\r\n\r\n      if (urlCon.getResponseCode in [200, 201]) then\r\n      begin\r\n        bs := TJByteArrayOutputStream.JavaClass.init;\r\n        ip := urlCon.getInputStream;\r\n        r := ip.read();\r\n        while r <> -1 do\r\n        begin\r\n          bs.write(r);\r\n          r := ip.read();\r\n        end;\r\n\r\n        data := bs.toByteArray;\r\n        Result :=  TMemoryStream.Create;\r\n        Result.WriteBuffer(data.Data^, bs.size);\r\n        bs.close;\r\n      end;\r\n    finally\r\n    end;\r\n{$ELSE}\r\n{$IFDEF LINUX}\r\nbegin\r\n{$ELSE}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  UrlHandle: HINTERNET;\r\n  Buffer: array[0..1024] of AnsiChar;\r\n  BytesRead: DWORD;\r\n  lpdwlen,lpdwidx,lpdword: DWORD;\r\n  cbuf: array[0..255] of char;\r\n  p: Pointer;\r\nbegin\r\n  Result := TMemoryStream.Create;\r\n\r\n  p := InternetOpen('TTMSFNCUtils', INTERNET_OPEN_TYPE_PRECONFIG, nil, nil, 0);\r\n\r\n  if Assigned(p) then\r\n  begin\r\n    UrlHandle := InternetOpenUrl(p, PChar(AURL), nil, 0, INTERNET_FLAG_PRAGMA_NOCACHE or INTERNET_FLAG_NO_CACHE_WRITE or INTERNET_FLAG_RELOAD, 0);\r\n\r\n    if Assigned(UrlHandle) then\r\n    begin\r\n      lpdwlen := SizeOf(cbuf);\r\n      lpdwidx := 0;\r\n      HttpQueryInfo(UrlHandle, HTTP_QUERY_CONTENT_TYPE,@cbuf,lpdwlen,lpdwidx);\r\n\r\n      if Pos('IMAGE',UpperCase(StrPas(cbuf))) = 0 then\r\n      begin\r\n        InternetCloseHandle(UrlHandle);\r\n        Exit;\r\n      end;\r\n\r\n      lpdword := 0;\r\n      lpdwlen := 4;\r\n      lpdwidx := 0;\r\n\r\n      HttpQueryInfo(URLHandle,HTTP_QUERY_CONTENT_LENGTH,@lpdword,lpdwlen,lpdwidx);\r\n\r\n      try\r\n        FillChar(Buffer, SizeOf(Buffer), 0);\r\n        repeat\r\n          FillChar(Buffer, SizeOf(Buffer), 0);\r\n          InternetReadFile(UrlHandle, @Buffer, SizeOf(Buffer), BytesRead);\r\n          Result.Write(buffer, bytesread);\r\n        until BytesRead = 0;\r\n      finally\r\n      end;\r\n      InternetCloseHandle(UrlHandle);\r\n    end\r\n    else\r\n      raise Exception.CreateFmt('Cannot open URL %s', [AUrl]);\r\n  end\r\n  else\r\n    raise Exception.Create('Unable to initialize Wininet');\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nbegin\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.IndexOfTextInArray(const AText: string; const AValues: array of string): Integer;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := -1;\r\n  for I := Low(AValues) to High(AValues) do\r\n    if SameText(AText, AValues[I]) then\r\n    begin\r\n      if (pos('cute', AText) > 0) or (pos('grave', AText) > 0) or (pos('uml', AText) > 0) or (pos('circ', AText) > 0) or (pos('tilde', AText) > 0)  then\r\n      begin\r\n        if (AText = AValues[I]) then\r\n        begin\r\n          Result := I;\r\n          Break;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        Result := I;\r\n        Break;\r\n      end;\r\n    end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetMarkupIndex(const Markup: string): integer;\r\nbegin\r\n  Result := IndexOfTextInArray(Markup, HTMLSpecialChar);\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetSpecialChar(const Value: integer): UnicodeString;\r\nbegin\r\n  Result := HTMLEncodedChar[Value];\r\nend;\r\n\r\nclass function TTMSFNCUtils.UnFixMarkup(su:string;SpecialChars: boolean = true):string;\r\nvar\r\n  i: integer;\r\nbegin\r\n  while Pos('&lt;',su) > 0 do\r\n  begin\r\n    TagReplacestring('&lt;','<',su);\r\n  end;\r\n\r\n  while Pos('&gt;',su) > 0 do\r\n  begin\r\n    TagReplacestring('&gt;','>',su);\r\n  end;\r\n\r\n  while Pos('&amp;',su) > 0 do\r\n  begin\r\n    TagReplacestring('&amp;','&',su);\r\n  end;\r\n\r\n  while Pos('&quot;',su) > 0 do\r\n  begin\r\n    TagReplacestring('&quot;','\"',su);\r\n  end;\r\n\r\n  if SpecialChars then\r\n  begin\r\n    for i := 4 to HTMLNumSpecialChar do\r\n    begin\r\n      while Pos(string(HTMLSpecialChar[i]),su) > 0 do\r\n      begin\r\n        TagReplacestring(string(HTMLSpecialChar[i]),string(HTMLEncodedChar[i]),su);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := su;\r\nend;\r\n\r\nclass function TTMSFNCUtils.FixMarkup(su:string;SpecialChars: boolean = true): string;\r\nvar\r\n  i: integer;\r\nbegin\r\n  while Pos('&',su) > 0 do\r\n  begin\r\n    TagReplacestring('&','*amp;',su);\r\n  end;\r\n\r\n  while Pos('*amp;',su) > 0 do\r\n  begin\r\n    TagReplacestring('*amp;','&amp;',su);\r\n  end;\r\n\r\n  while Pos('\"',su) > 0 do\r\n  begin\r\n    TagReplacestring('\"','&quot;',su);\r\n  end;\r\n\r\n  while Pos('<',su) > 0 do\r\n  begin\r\n    TagReplacestring('<','&lt;',su);\r\n  end;\r\n\r\n  while Pos('>',su) > 0 do\r\n  begin\r\n    TagReplacestring('>','&gt;',su);\r\n  end;\r\n\r\n  if SpecialChars then\r\n  begin\r\n    for i := 4 to HTMLNumSpecialChar do\r\n    begin\r\n      while Pos(string(HTMLEncodedChar[i]),su) > 0 do\r\n      begin\r\n        TagReplacestring(string(HTMLEncodedChar[i]),string(HTMLSpecialChar[i]),su);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := su;\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetOwnerForm(AComponent: TComponent): TCustomForm;\r\nvar\r\n  c: TComponent;\r\nbegin\r\n  Result := nil;\r\n  c := AComponent;\r\n  if not Assigned(c) then\r\n    Exit;\r\n\r\n  if c.Owner is TCustomForm then\r\n    Result := c.Owner as TCustomForm\r\n  else\r\n    Result := GetOwnerForm(c.Owner);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nclass function TTMSFNCUtils.GetParentForm(AControl: TFMXObject): TCustomForm;\r\nvar\r\n  c: TFMXObject;\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\nclass function TTMSFNCUtils.GetParentForm(AControl: TControl): TCustomForm;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nclass function TTMSFNCUtils.GetParentForm(AControl: TControl): TCustomForm;\r\nvar\r\n  c: TControl;\r\n{$ENDIF}\r\nbegin\r\n{$IFDEF FMXLIB}\r\n  Result := nil;\r\n  c := AControl;\r\n  if not Assigned(c) then\r\n    Exit;\r\n\r\n  if c.Parent is TCustomForm then\r\n    Result := c.Parent as TCustomForm\r\n  else\r\n    Result := GetParentForm(c.Parent);\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n  Result := Forms.GetParentForm(AControl);\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n  Result := nil;\r\n  c := AControl;\r\n  if not Assigned(c) then\r\n    Exit;\r\n\r\n  if c.Parent is TCustomForm then\r\n    Result := c.Parent as TCustomForm\r\n  else\r\n    Result := GetParentForm(c.Parent);\r\n{$ENDIF}\r\nend;\r\n\r\n{$IFDEF VCLLIB}\r\nfunction CalculateDPIScale(Scaled: boolean; AHDC: HDC): single; overload;\r\nvar\r\n  FDPI: integer;\r\nbegin\r\n  Result:= 1.0;\r\n  if Scaled then\r\n  begin\r\n    if AHDC = 0 then\r\n      AHDC:= GetDC(0);\r\n    try\r\n      FDPI := GetDeviceCaps(AHDC, LOGPIXELSX);\r\n      if FDPI <> 96 then\r\n        Result:= FDPI / 96;\r\n    finally\r\n      if AHDC = 0 then\r\n        ReleaseDC(0, AHDC);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction CalculateDPIScale(AForm: TCustomForm; AHDC: HDC): single; overload;\r\nbegin\r\n  Result := 1.0;\r\n  if Assigned(AForm) and (AForm is TForm) then\r\n    Result := CalculateDPIScale((AForm as TForm).Scaled, AHDC);\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCUtils.CharInStr(s: string; Index: Integer): Char;\r\nbegin\r\n  Result := #0;\r\n  if (Index > 0) and (Index <= Length(s)) then\r\n  begin\r\n    {$IFDEF FMXMOBILE}\r\n    dec(Index);\r\n    {$ENDIF}\r\n    Result := s[Index]\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.Clone(AComponent: TComponent): TComponent;\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('Implement Clone');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  S: TStream;\r\n  SaveName: string;\r\n  Reader: TReader;\r\nbegin\r\n  S := TMemoryStream.Create;\r\n  try\r\n    { store }\r\n    SaveName := AComponent.Name;\r\n    AComponent.Name := '';\r\n    S.WriteComponent(AComponent);\r\n    AComponent.Name := SaveName;\r\n    S.Position := 0;\r\n    { load }\r\n    try\r\n      Reader := TReader.Create(S, 4096);\r\n      try\r\n        Result := Reader.ReadRootComponent(nil);\r\n      finally\r\n        Reader.Free;\r\n      end;\r\n    finally\r\n    end;\r\n  finally\r\n    S.Free;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetAppPath: String;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  Result := 'file://'\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Result := ExtractFilePath(ParamStr(0));\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetDocumentsPath: string;\r\n{$IFDEF VCLLIB}\r\nvar\r\n  szBuffer: array [0..MAX_PATH] of Char;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := TPath.GetDocumentsPath;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := GetUserDir + PathDelim + 'Documents';\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  OleCheck(SHGetFolderPath(0, $0005, 0, 0, szBuffer));\r\n  Result := szBuffer;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetMousePos: TPointF;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  m: IFMXMouseService;\r\n{$ENDIF}\r\nbegin\r\n  Result := PointF(-1, -1);\r\n  {$IFDEF FMXLIB}\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXMouseService, IInterface(m)) then\r\n    Result := m.GetMousePos;\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  Result := PointF(Mouse.CursorPos.X, Mouse.CursorPos.Y);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.AddBackslash(const AValue: string): string;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  if (Length(AValue) >= 1) and (AValue[Length(AValue) - 1] <> PthDel) then\r\n  {$ELSE}\r\n  if (Length(AValue) >= 1) and (AValue[Length(AValue)] <> PthDel) then\r\n  {$ENDIF}\r\n    Result := AValue + PthDel\r\n  else\r\n    Result := AValue;\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetDPIScale(AOwner: TComponent = nil): Single;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  ScreenSvc: IFMXScreenService;\r\n{$ENDIF}\r\n{$IFDEF VCLLIB}\r\nvar\r\n  frm: TCustomform;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := 1.0;\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXScreenService, IInterface(ScreenSvc)) then\r\n    Result := ScreenSvc.GetScreenScale;\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  Result := 1.0;\r\n  if Assigned(Application.MainForm) and Assigned(Application.MainForm.Canvas) then\r\n    Result := CalculateDPIScale(Application.MainForm, Application.MainForm.Canvas.Handle)\r\n  else if Assigned(AOwner) then\r\n  begin\r\n    frm := GetOwnerForm(AOwner);\r\n    if Assigned(frm) and Assigned(frm.Canvas) then\r\n      Result := CalculateDPIScale(frm, frm.Canvas.Handle);\r\n  end;\r\n\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  Result := Screen.PixelsPerInch / 96;\r\n  {$ENDIF}\r\n  {$IFDEF DARWIN}\r\n  Result := Screen.PixelsPerInch / 72;\r\n  {$ENDIF}\r\n  {$IFDEF LINUX}\r\n  Result := Screen.PixelsPerInch / 96;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Result := 1.0;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.IsHighDPIScale: Boolean;\r\nbegin\r\n  Result := GetDPIScale > 1;\r\nend;\r\n\r\nclass function TTMSFNCUtils.IsHTMLUnicode(AValue: UnicodeString): Boolean;\r\nbegin\r\n  {$IFDEF LCLLIB}\r\n  Result := IsHTML(UTF8Encode(AValue));\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  Result := IsHTML(AValue);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.IsHTML(AValue: string): Boolean;\r\nbegin\r\n  Result := (Pos('</', AValue) > 0) or (Pos('/>', AValue)  > 0) or (Pos('<BR>', UpperCase(AValue)) > 0);\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.OpenFile(AFile: string; AControlReference: TControl = nil);\r\n{$IFDEF ANDROID}\r\nvar\r\n  i: JIntent;\r\n  t: string;\r\n  ext: string;\r\n{$ENDIF}\r\n{$IFDEF IOS}\r\nvar\r\n  docController: UIDocumentInteractionController;\r\n  url: NSURL;\r\n  r: NSRect;\r\n  vw: UIView;\r\n  frm: TCommonCustomForm;\r\n  pt: TPointF;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  {$IFDEF LINUX}\r\n  FmuxOpenFile(PChar(AFile));\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  frm := Application.MainForm;\r\n  if Assigned(frm) then\r\n  begin\r\n    url := TNSURL.Wrap(TNSURL.OCClass.fileURLWithPath(NSStrEx(AFile)));\r\n    docController := TUIDocumentInteractionController.Wrap(TUIDocumentInteractionController.OCClass.interactionControllerWithURL(url));\r\n    docController.retain;\r\n    vw := WindowHandleToPlatform(frm.Handle).View;\r\n    if Assigned(AControlReference) then\r\n    begin\r\n      pt := AControlReference.LocalToAbsolute(AControlReference.Position.Point);\r\n      r.origin.x := pt.X;\r\n      r.origin.Y := pt.Y;\r\n      r.size.Width := AControlReference.Width;\r\n      r.size.Height := AControlReference.Height;\r\n    end\r\n    else\r\n      r := vw.frame;\r\n\r\n    docController.presentOpenInMenuFromRect(r, vw, TRUE);\r\n  end;\r\n  {$ELSE}\r\n  TNSWorkspace.Wrap(TNSWorkspace.OCClass.sharedWorkspace).openFile(NSStrEx(AFile));\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF ANDROID}\r\n  i := TJIntent.Create;\r\n  i.setAction(TJIntent.JavaClass.ACTION_VIEW);\r\n  if not AFile.ToLower.StartsWith('file://') then\r\n    AFile := 'file://' + AFile;\r\n\r\n  ext := ExtractFileExt(AFile).ToLower;\r\n  if ext = '.pdf' then\r\n    t := 'application/pdf'\r\n  else if ext = '.html' then\r\n    t := 'text/html'\r\n  else if (ext = '.jpeg') or (ext = '.jpg') then\r\n    t := 'image/jpeg'\r\n  else if (ext = '.gif') then\r\n    t := 'image/gif'\r\n  else if (ext = '.png') then\r\n    t := 'image/png'\r\n  else if (ext = '.bmp') then\r\n    t := 'image/bmp'\r\n  else\r\n    t := 'text/plain';\r\n\r\n  i.setDataAndType(StrToJURI(AFile), StringToJString(t));\r\n  SharedActivityEx.startActivity(i);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  ShellExecute(0,PChar('open'),PChar(AFile),PChar(''),PChar(''), SW_NORMAL);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF LCLLIB}\r\n  OpenDocument(AFile);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.OpenURL(AURL: string);\r\n{$IFDEF ANDROID}\r\nvar\r\n  i: JIntent;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  {$IFDEF LINUX}\r\n  FmuxOpenUrl(PChar(AURL));\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  TUIApplication.Wrap(TUIApplication.OCClass.sharedApplication).openURL(TNSURL.Wrap(TNSURL.OCClass.URLWithString(NSStrEx(AUrl))));\r\n  {$ELSE}\r\n  TNSWorkspace.Wrap(TNSWorkspace.OCClass.sharedWorkspace).openURL(TNSURL.Wrap(TNSURL.OCClass.URLWithString(NSStrEx(AUrl))));\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF ANDROID}\r\n  i := TJIntent.Create;\r\n  i.setAction(TJIntent.JavaClass.ACTION_VIEW);\r\n  i.setData(StrToJURI(AURL));\r\n  SharedActivityEx.startActivity(i);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF LCLLIB}\r\n  LCLIntF.OpenURL(AURL);\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  ShellExecute(0,PChar('open'),PChar(AURL),PChar(''),PChar(''), SW_NORMAL);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF WEBLIB}\r\n  asm\r\n    window.open(AURL, '_blank');\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetHInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\n{$IFDEF WEBLIB}\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Add('Arial');\r\n  FontList.Add('Helvetica');\r\n  FontList.Add('Times New Roman');\r\n  FontList.Add('Times');\r\n  FontList.Add('Courier New');\r\n  FontList.Add('Courier');\r\n  FontList.Add('Verdana');\r\n  FontList.Add('Georgia');\r\n  FontList.Add('Palatino');\r\n  FontList.Add('Garamond');\r\n  FontList.Add('Bookman');\r\n  FontList.Add('Comic Sans MS');\r\n  FontList.Add('Trebuchet MS');\r\n  FontList.Add('Arial Black');\r\n  FontList.Add('Impact');\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFNDEF LCLLIB}\r\n{$IFDEF MSWINDOWS}\r\nfunction EnumFontsProc(var LogFont: TLogFont; var TextMetric: TTextMetric;\r\n  FontType: Integer; Data: Pointer): Integer; stdcall;\r\nvar\r\n  S: TStrings;\r\n  Temp: string;\r\nbegin\r\n  S := TStrings(Data);\r\n  Temp := LogFont.lfFaceName;\r\n  if (S.Count = 0) or (AnsiCompareText(S[S.Count-1], Temp) <> 0) then\r\n    S.Add(Temp);\r\n  Result := 1;\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\nvar\r\n  DC: HDC;\r\n  LFont: TLogFont;\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Clear;\r\n  DC := GetDC(0);\r\n  FillChar(LFont, sizeof(LFont), 0);\r\n  LFont.lfCharset := DEFAULT_CHARSET;\r\n  EnumFontFamiliesEx(DC, LFont, @EnumFontsProc, LPARAM(FontList), 0);\r\n  ReleaseDC(0, DC);\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF LINUX}\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Clear;\r\n  for I := 0 to FmuxGetFontCount - 1 do\r\n    FontList.Add(FmuxGetFontName(I));\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF MACOS}\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\n{$IFDEF IOS}\r\nvar\r\n  arr: NSArray;\r\n  I: Integer;\r\n  lItem: NSString;\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Clear;\r\n  arr := TUIFont.OCClass.familyNames;\r\n  arr := arr.sortedArrayUsingSelector(sel_getUid('localizedCaseInsensitiveCompare:'));\r\n\r\n  for I := 0 to arr.count - 1 do\r\n  begin\r\n    lItem := TNSString.Wrap(arr.objectAtIndex(i));\r\n    FontList.Add(String(lItem.UTF8String));\r\n  end;\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ELSE}\r\nvar\r\n  fManager: NsFontManager;\r\n  list: NSArray;\r\n  lItem: NSString;\r\n  i: Integer;\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Clear;\r\n  fManager := TNsFontManager.Wrap(TNsFontManager.OCClass.sharedFontManager);\r\n  list := fManager.availableFontFamilies;\r\n  if (List <> nil) and (List.count > 0) then\r\n  begin\r\n    for i := 0 to List.Count-1 do\r\n    begin\r\n      lItem := TNSString.Wrap(List.objectAtIndex(i));\r\n      FontList.Add(String(lItem.UTF8String));\r\n    end;\r\n  end;\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\n{$IFDEF ANDROID}\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\nbegin\r\n  FontList.BeginUpdate;\r\n  FontList.Clear;\r\n  FontList.Add('Roboto');\r\n  FontList.Add('Droid Sans');\r\n  FontList.Add('Droid Serif');\r\n  FontList.Add('Droid Sans Mono');\r\n  FontList.Sort;\r\n  FontList.EndUpdate;\r\nend;\r\n{$ENDIF}\r\n{$ELSE}\r\nclass procedure TTMSFNCUtils.GetFonts(FontList: TStringList);\r\nbegin\r\n  FontList.Assign(Screen.Fonts);\r\nend;\r\n{$ENDIF}\r\n\r\nclass procedure TTMSFNCUtils.SetFontSize(AFont: TFont; ASize: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  AFont.Size := ASize;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  AFont.Size := Round(ASize / 96 * 72);\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  AFont.Size := Round(ASize / 96 * 72);\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF CMNLIB}\r\nclass function TTMSFNCUtils.FindGraphicClass(const Buffer; const BufferSize: Int64;\r\n  out GraphicClass: TGraphicClass): Boolean;\r\nvar\r\n  {$IFDEF VCLLIB}\r\n  LongWords: array[Byte] of LongWord absolute Buffer;\r\n  {$ENDIF}\r\n  Words: array[Byte] of Word absolute Buffer;\r\nbegin\r\n  GraphicClass := nil;\r\n\r\n  if BufferSize = 0 then\r\n  begin\r\n    Result := False;\r\n    Exit;\r\n  end;\r\n\r\n  {$IFDEF VCLLIB}\r\n  case Words[0] of\r\n    $4D42: GraphicClass := TBitmap;\r\n    $D8FF: GraphicClass := TJPEGImage;\r\n    $4949: if Words[1] = $002A then GraphicClass := TWicImage; //i.e., TIFF\r\n    $4D4D: if Words[1] = $2A00 then GraphicClass := TWicImage; //i.e., TIFF\r\n  else\r\n    if Int64(Buffer) = $A1A0A0D474E5089 then\r\n      GraphicClass := TPNGImage\r\n    else if LongWords[0] = $9AC6CDD7 then\r\n      GraphicClass := TMetafile\r\n    else if (LongWords[0] = 1) and (LongWords[10] = $464D4520) then\r\n      GraphicClass := TMetafile\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 24}\r\n    else if AnsiStrings.StrLComp(PAnsiChar(@Buffer), 'GIF', 3) = 0 then\r\n    {$ELSE}\r\n    else if StrLComp(PAnsiChar(@Buffer), 'GIF', 3) = 0 then\r\n    {$IFEND}\r\n    GraphicClass := TGIFImage\r\n    {$HINTS ON}\r\n    else if Words[1] = 1 then\r\n      GraphicClass := TIcon;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  case Words[0] of\r\n    $4D42: GraphicClass := GetGraphicClassForFileExtension('bmp');\r\n    $D8FF: GraphicClass := GetGraphicClassForFileExtension('jpeg');\r\n    $4949: if Words[1] = $002A then GraphicClass := GetGraphicClassForFileExtension('tiff');\r\n    $4D4D: if Words[1] = $2A00 then GraphicClass := GetGraphicClassForFileExtension('tiff');\r\n  else\r\n    if Int64(Buffer) = $A1A0A0D474E5089 then\r\n      GraphicClass := GetGraphicClassForFileExtension('png')\r\n    else if StrLComp(PAnsiChar(@Buffer), 'GIF', 3) = 0 then\r\n      GraphicClass := GetGraphicClassForFileExtension('gif')\r\n    else if Words[1] = 1 then\r\n      GraphicClass := GetGraphicClassForFileExtension('ico');\r\n  end;\r\n  {$ENDIF}\r\n  Result := (GraphicClass <> nil);\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCUtils.SaveStreamToHexStr(const AStream: TStream): string;\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('Implement SaveStreamToHexStr');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  s: string;\r\n  K: Integer;\r\n  bt: Byte;\r\nbegin\r\n  s := '';\r\n  AStream.Position := 0;\r\n  for K := 1 to AStream.Size do\r\n  begin\r\n    bt := 0;\r\n    AStream.Read(bt, 1);\r\n    s := s + IntToHex(bt, 2);\r\n  end;\r\n  Result := s;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.SaveBitmapToHexStr(const ABitmap: TTMSFNCBitmap): string;\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('Implement SaveBitmapToHexStr');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  ms: TMemoryStream;\r\n  s: string;\r\nbegin\r\n  ms := TMemoryStream.Create;\r\n  try\r\n    s := '';\r\n    {$IFDEF CMNLIB}\r\n    if Assigned(ABitmap.Graphic) and not ABitmap.Graphic.Empty then\r\n    begin\r\n      ABitmap.Graphic.SaveToStream(ms);\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    if not ABitmap.IsEmpty then\r\n    begin\r\n      ABitmap.SaveToStream(ms);\r\n    {$ENDIF}\r\n      s := SaveStreamToHexStr(ms);\r\n    end;\r\n    Result := s;\r\n  finally\r\n    ms.Free;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.MulDivSingle(nNumber, nNumerator, nDenominator: Single): Single;\r\nbegin\r\n  Result := MulDivInt(Round(nNumber), Round(nNumerator), Round(nDenominator));\r\nend;\r\n\r\nclass function TTMSFNCUtils.MulDivInt(nNumber, nNumerator, nDenominator: Integer): Integer;\r\n  function MathRound(AValue: Extended): Int64;\r\n  begin\r\n    if AValue >= 0 then\r\n      Result := Trunc(AValue + 0.5)\r\n    else\r\n      Result := Trunc(AValue - 0.5);\r\n  end;\r\nbegin\r\n  if nDenominator = 0 then\r\n    Result := -1\r\n  else\r\n    Result := MathRound(Int64(nNumber) * Int64(nNumerator) / nDenominator);\r\nend;\r\n\r\nclass function TTMSFNCUtils.CreateBitmapFromHexStr(const AHexStr: string): TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCBitmap.Create;\r\n  LoadBitmapFromHexStr(AHexStr, Result);\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.LoadBitmapFromHexStr(const AHexStr: string; const ABitmap: TTMSFNCBitmap);\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('Implement LoadBitmapFromHexStr');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  sst: TStringStream;\r\n  bst: TBytesStream;\r\n  M: Integer;\r\n  bt: TBytes;\r\n  {$IFDEF VCLLIB}\r\n  p: TGraphic;\r\n  gcc: TGraphicClass;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  I: Integer;\r\n  {$ENDIF}\r\nbegin\r\n  sst := TStringStream.Create(AHexStr);\r\n  bst := TBytesStream.Create;\r\n  try\r\n    for M := 1 to sst.Size div 2 do\r\n    begin\r\n      bt := HexStrToBytes(sst.ReadString(2));\r\n      {$IFDEF LCLLIB}\r\n      for I := 0 to Length(bt) - 1 do\r\n        bst.WriteByte(bt[I]);\r\n      {$ENDIF}\r\n      {$IFNDEF LCLLIB}\r\n      bst.Write(bt, Length(bt));\r\n      {$ENDIF}\r\n    end;\r\n\r\n    bst.Position := 0;\r\n    {$IFDEF VCLLIB}\r\n    if TTMSFNCUtils.FindGraphicClass(bst.Memory^, bst.Size, gcc) then\r\n    begin\r\n      p := gcc.Create;\r\n      try\r\n        bst.Position := 0;\r\n        p.LoadFromStream(bst);\r\n        ABitmap.Assign(p)\r\n    {$ENDIF}\r\n\r\n    {$IFNDEF VCLLIB}\r\n      ABitmap.LoadFromStream(bst);\r\n    {$ENDIF}\r\n\r\n    {$IFDEF VCLLIB}\r\n      finally\r\n        p.Free;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n\r\n  finally\r\n    sst.Free;\r\n    bst.Free;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.LoadStreamFromHexStr(const AHexStr: string;\r\n  const AStream: TStream);\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  raise Exception.Create('Implement LoadStreamFromHexStr');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  sst: TStringStream;\r\n  bst: TBytesStream;\r\n  M: Integer;\r\n  bt: TBytes;\r\n  {$IFDEF LCLLIB}\r\n  I: Integer;\r\n  {$ENDIF}\r\nbegin\r\n  sst := TStringStream.Create(AHexStr);\r\n  bst := TBytesStream.Create;\r\n  try\r\n    for M := 1 to sst.Size div 2 do\r\n    begin\r\n      bt := HexStrToBytes(sst.ReadString(2));\r\n      {$IFDEF LCLLIB}\r\n      for I := 0 to Length(bt) - 1 do\r\n        bst.WriteByte(bt[I]);\r\n      {$ENDIF}\r\n      {$IFNDEF LCLLIB}\r\n      bst.Write(bt, Length(bt));\r\n      {$ENDIF}\r\n    end;\r\n\r\n    bst.Position := 0;\r\n    AStream.CopyFrom(bst, bst.Size);\r\n  finally\r\n    sst.Free;\r\n    bst.Free;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.HexStrToBytes(const AValue: string): TBytes;\r\nvar\r\n  il, idx: Integer;\r\n  b: TBytes;\r\nbegin\r\n  Result := nil;\r\n  SetLength(b, Length(AValue) div 2);\r\n  il := 1;\r\n  idx := 0;\r\n  while il <= Length(AValue) do\r\n  begin\r\n    b[idx] := StrToInt('$' + AValue[il{$IFDEF FMXMOBILE}-1{$ENDIF}] + AValue[il{$IFNDEF FMXMOBILE} + 1{$ENDIF}]);\r\n    il := il + 2;\r\n    idx := idx + 1;\r\n  end;\r\n  Result := b;\r\nend;\r\n\r\nclass function TTMSFNCUtils.AddCharSet(ACharSet1,\r\n  ACharSet2: TTMSFNCUtilsCharSet): TTMSFNCUtilsCharSet;\r\nvar\r\n  l,j: integer;\r\nbegin\r\n  l := Length(ACharSet1)+Length(ACharSet2);\r\n  SetLength(Result,l);\r\n  l := 0;\r\n\r\n  for j := 0 to High(ACharSet1) do\r\n  begin\r\n    Result[l] := ACharSet1[j];\r\n    inc(l);\r\n  end;\r\n\r\n  for j := 0 to High(ACharSet2) do\r\n  begin\r\n    Result[l] := ACharSet2[j];\r\n    inc(l);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.AlphaCharSet: TTMSFNCUtilsCharSet;\r\nvar\r\n  i: integer;\r\n  ch: char;\r\nbegin\r\n  SetLength(Result,52);\r\n  i := 0;\r\n\r\n  for ch := 'a' to 'z' do\r\n  begin\r\n    Result[i] := ch;\r\n    inc(i);\r\n  end;\r\n\r\n  for ch := 'A' to 'Z' do\r\n  begin\r\n    Result[i] := ch;\r\n    inc(i);\r\n  end;\r\n\r\nend;\r\n\r\nclass function TTMSFNCUtils.CharInSet(ch: Char; ACharset: TTMSFNCUtilsCharSet): boolean;\r\nvar\r\n  j: integer;\r\nbegin\r\n  Result := false;\r\n  for j := 0 to High(ACharSet) do\r\n  begin\r\n    if ch = ACharSet[j] then\r\n    begin\r\n      result := true;\r\n      break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.FirstChar(ACharset: TTMSFNCUtilsCharSet; AValue: string; var spos: Integer): char;\r\nvar\r\n  i:Integer;\r\n  q: Integer;\r\n\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  i := 0;\r\n  {$ELSE}\r\n  i := 1;\r\n  {$ENDIF}\r\n  q := 0;\r\n  spos := -1;\r\n  Result := #0;\r\n\r\n  while i <= Length(AValue) do\r\n  begin\r\n    if AValue[i] = '\"' then\r\n      inc(q);\r\n\r\n    if (CharInSet(AValue[i], ACharSet)) and not Odd(q) then\r\n    begin\r\n      spos := i;\r\n      Result := AValue[i];\r\n      Break;\r\n    end;\r\n    Inc(i);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.StripLogicSpaces(AValue: string): string;\r\nvar\r\n  i, k: integer;\r\n  q: integer;\r\nbegin\r\n  q := 0;\r\n  {$IFDEF FMXMOBILE}\r\n  i := 0;\r\n  k := length(AValue) - 1;\r\n  {$ELSE}\r\n  i := 1;\r\n  k := length(AValue);\r\n  {$ENDIF}\r\n  Result := '';\r\n\r\n  while (i <= k) do\r\n  begin\r\n    if AValue[i] = '\"' then\r\n      inc(q);\r\n\r\n    if (AValue[i] = ' ') then\r\n    begin\r\n      if Odd(q) then\r\n        Result := Result + AValue[i];\r\n    end\r\n    else\r\n      Result := Result + AValue[i];\r\n\r\n    inc(i);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.ClosingParenthesis(s1: string): integer;\r\nvar\r\n  i,j,k,r: integer;\r\nbegin\r\n  r := 0;\r\n  j := 0;\r\n  k := 0;\r\n  {$IFDEF FMXMOBILE}\r\n  i := 0;\r\n  {$ELSE}\r\n  i := 1;\r\n  {$ENDIF}\r\n\r\n  while (i <= length(s1)) do\r\n  begin\r\n    if (s1[i] = ')') then\r\n      inc(k);\r\n\r\n    if (s1[i] = '(') then\r\n      inc(j);\r\n\r\n    if (s1[i] = ')') and (j = k) then\r\n    begin\r\n      r := i;\r\n      break;\r\n    end;\r\n\r\n    inc(i);\r\n  end;\r\n\r\n  Result := r;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nclass function TTMSFNCUtils.ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TAlphaColor = TAlphaColorRec.White): TMemoryStream;\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\nclass function TTMSFNCUtils.ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TColor = clWhite): TMemoryStream;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nclass function TTMSFNCUtils.ConvertBitmapToJPEGStream(ABitmap: TTMSFNCBitmap; AQuality: Single = 1.0; ABackgroundColor: TColor = clWhite): TMemoryStream;\r\nbegin\r\n  raise Exception.Create('ConvertBitmapToJPEGStream');\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  ms: TMemoryStream;\r\n  bmp: TBitmap;\r\n{$IFDEF FMXLIB}\r\n  s: TBitmapSurface;\r\n  sp: TBitmapCodecSaveParams;\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n  gcc: TGraphicClass;\r\n  bms: TMemoryStream;\r\n  p: TGraphic;\r\n  img: TJPEGImage;\r\n{$ENDIF}\r\nbegin\r\n  Result := nil;\r\n  {$IFDEF FMXLIB}\r\n  s := TBitmapSurface.Create;\r\n  bmp := TBitmap.Create;\r\n  try\r\n    bmp.Width := ABitmap.Width;\r\n    bmp.Height := ABitmap.Height;\r\n    if (ABackgroundColor <> TAlphaColorRec.Null) and (Integer(ABackgroundColor) <> -1) then\r\n      bmp.Clear(ABackgroundColor)\r\n    else\r\n      bmp.Clear(TAlphaColorRec.White);\r\n    bmp.Canvas.BeginScene;\r\n    bmp.Canvas.DrawBitmap(ABitmap, RectF(0, 0, bmp.Width, bmp.Height), RectF(0, 0, bmp.Width, bmp.Height), 1);\r\n    bmp.Canvas.EndScene;\r\n    s.Assign(bmp);\r\n    sp.Quality := Round(AQuality * 100);\r\n    ms := TMemoryStream.Create;\r\n    if TBitmapCodecManager.SaveToStream(ms, s, '.jpeg', @sp) then\r\n      Result := ms;\r\n  finally\r\n    bmp.Free;\r\n    s.Free;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  bms := TMemoryStream.Create;\r\n  ABitmap.SaveToStream(bms);\r\n  try\r\n    if FindGraphicClass(bms.Memory^, bms.Size, gcc) then\r\n    begin\r\n      if gcc = TJPEGImage then\r\n      begin\r\n        ms := TMemoryStream.Create;\r\n        ms.LoadFromStream(bms);\r\n        Result := ms;\r\n      end\r\n      else\r\n      begin\r\n        p := gcc.Create;\r\n        img := TJPEGImage.Create;\r\n        img.CompressionQuality := Round(AQuality * 100);\r\n        bmp := TBitmap.Create;\r\n        try\r\n          bms.Position := 0;\r\n          p.LoadFromStream(bms);\r\n          bmp.Width := p.Width;\r\n          bmp.Height := p.Height;\r\n          if (ABackgroundColor <> clNone) and (Integer(ABackgroundColor) <> -1) then\r\n            bmp.Canvas.Brush.Color := ABackgroundColor\r\n          else\r\n            bmp.Canvas.Brush.Color := clWhite;\r\n          bmp.Canvas.FillRect(Rect(0, 0, bmp.Width, bmp.Height));\r\n          bmp.Canvas.Draw(0, 0, p);\r\n          img.Assign(bmp);\r\n          ms := TMemoryStream.Create;\r\n          img.SaveToStream(ms);\r\n          Result := ms;\r\n        finally\r\n          bmp.Free;\r\n          img.Free;\r\n          p.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  finally\r\n    bms.Free;\r\n  end;\r\n  {$ENDIF}\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.StripThousandSep(ps: string): string;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  while (Pos(ThousandSeparator, ps) > 0) do\r\n    Delete(ps, Pos(ThousandSeparator, ps), 1);\r\n  Result := ps;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  while (Pos(FormatSettings.ThousandSeparator, ps) > 0) do\r\n    Delete(ps, Pos(FormatSettings.ThousandSeparator, ps), 1);\r\n  Result := ps;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCUtils.SubCharSet(ACharSet1,\r\n  ACharSet2: TTMSFNCUtilsCharSet): TTMSFNCUtilsCharSet;\r\nvar\r\n  i,j,l: integer;\r\n  found: boolean;\r\nbegin\r\n  l := 0;\r\n  SetLength(Result,l);\r\n\r\n  for i := 0 to Length(ACharSet1) - 1 do\r\n  begin\r\n    found := false;\r\n    for j := 0 to Length(ACharSet2) - 1 do\r\n      begin\r\n        if ACharSet1[i] = ACharSet2[j] then\r\n        begin\r\n          found := true;\r\n          break;\r\n        end;\r\n      end;\r\n\r\n    if not found then\r\n    begin\r\n      inc(l);\r\n      SetLength(Result,l);\r\n      Result[l - 1] := ACharSet1[i];\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.IsDate(AValue: string; var ADate: TDateTime):boolean;\r\nvar\r\n  su, ts: string;\r\n  da,mo,ye,ho,mi,se: Word;\r\n  err: Integer;\r\n  dp,mp,yp,vp: Integer;\r\nbegin\r\n  Result := False;\r\n\r\n  ts := '';\r\n\r\n  {$IFDEF WEBLIB}\r\n  su := UpperCase(ShortDateFormat);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  su := UpperCase(FormatSettings.ShortDateFormat);\r\n  {$ENDIF}\r\n  dp := pos('D',su);\r\n  mp := pos('M',su);\r\n  yp := pos('Y',su);\r\n\r\n  da := 0;\r\n  mo := 0;\r\n  ye := 0;\r\n  ho := 0;\r\n  mi := 0;\r\n  se := 0;\r\n\r\n  vp := -1;\r\n  {$IFDEF WEBLIB}\r\n  if TTMSFNCUtils.VarPos(DateSeparator,AValue,vp)>0 then\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  if TTMSFNCUtils.VarPos(FormatSettings.DateSeparator,AValue,vp)>0 then\r\n  {$ENDIF}\r\n  begin\r\n    su := Copy(AValue,1,vp - 1);\r\n\r\n    if (dp<mp) and\r\n       (dp<yp) then\r\n       val(su,da,err)\r\n    else\r\n    if (mp<dp) and\r\n       (mp<yp) then\r\n       val(su,mo,err)\r\n    else\r\n    if (yp<mp) and\r\n       (yp<dp) then\r\n       val(su,ye,err);\r\n\r\n    if err<>0 then Exit;\r\n    Delete(AValue,1,vp);\r\n\r\n    {$IFDEF WEBLIB}\r\n    if TTMSFNCUtils.VarPos(DateSeparator,AValue,vp)>0 then\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    if TTMSFNCUtils.VarPos(FormatSettings.DateSeparator,AValue,vp)>0 then\r\n    {$ENDIF}\r\n    begin\r\n      su := Copy(AValue,1,vp - 1);\r\n\r\n      if ((dp>mp) and (dp<yp)) or\r\n         ((dp>yp) and (dp<mp)) then\r\n         val(su,da,err)\r\n      else\r\n      if ((mp>dp) and (mp<yp)) or\r\n         ((mp>yp) and (mp<dp)) then\r\n         val(su,mo,err)\r\n      else\r\n      if ((yp>mp) and (yp<dp)) or\r\n         ((yp>dp) and (yp<mp)) then\r\n         val(su,ye,err);\r\n\r\n      if err<>0 then Exit;\r\n      Delete(AValue,1,vp);\r\n\r\n      AValue := Trim(AValue);\r\n\r\n      if TTMSFNCUtils.VarPos(' ',AValue, vp) > 0 then  // there is space to separate date & time\r\n      begin\r\n        ts := copy(AValue, vp, length(AValue));\r\n        AValue := copy(AValue, 1, vp - 1);\r\n      end;\r\n\r\n      if (dp>mp) and\r\n         (dp>yp) then\r\n         val(AValue,da,err)\r\n      else\r\n      if (mp>dp) and\r\n         (mp>yp) then\r\n         val(AValue,mo,err)\r\n      else\r\n      if (yp>mp) and\r\n         (yp>dp) then\r\n         val(AValue,ye,err);\r\n\r\n      if err<>0 then Exit;\r\n      if (da>31) then Exit;\r\n      if (mo>12) then Exit;\r\n\r\n      if (ts <> '') then  // there is a time part\r\n      begin\r\n        {$IFDEF WEBLIB}\r\n        if TTMSFNCUtils.VarPos(TimeSeparator,ts,vp)>0 then\r\n        {$ENDIF}\r\n        {$IFNDEF WEBLIB}\r\n        if TTMSFNCUtils.VarPos(FormatSettings.TimeSeparator,ts,vp)>0 then\r\n        {$ENDIF}\r\n        begin\r\n          su := Copy(ts,1,vp - 1); // hour part\r\n          val(su,ho,err);\r\n\r\n          if (err <> 0) then Exit;\r\n          if (ho > 23) then Exit;\r\n\r\n          Delete(ts,1,vp);\r\n\r\n          {$IFDEF WEBLIB}\r\n          if TTMSFNCUtils.VarPos(TimeSeparator,ts,vp)>0 then // there is a second part\r\n          {$ENDIF}\r\n          {$IFNDEF WEBLIB}\r\n          if TTMSFNCUtils.VarPos(FormatSettings.TimeSeparator,ts,vp)>0 then // there is a second part\r\n          {$ENDIF}\r\n          begin\r\n            su := Copy(ts,1,vp - 1); // minute part\r\n            val(su,mi,err);\r\n\r\n            if err <> 0 then Exit;\r\n            Delete(ts,1,vp);\r\n\r\n            val(ts,se,err);  // second part\r\n            if (err <> 0) then Exit;\r\n            if (se > 60) then Exit;\r\n          end\r\n          else\r\n          begin\r\n            val(su,mi,err); // minute part\r\n            if (err <> 0) then Exit;\r\n          end;\r\n\r\n          if (mi > 59) then Exit;\r\n\r\n          Result := true;\r\n        end;\r\n      end\r\n      else\r\n        Result := True;\r\n\r\n      try\r\n        ADate := EncodeDate(ye,mo,da) + EncodeTime(ho,mi,se,0);\r\n      except\r\n        Result := False;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCUtils.Matches(s0a, s1a: PChar): Boolean;\r\n{$IFNDEF WEBLIB}\r\nbegin\r\n  Result := Matches(string(s0a), string(s1a));\r\nend;\r\n\r\nclass function TTMSFNCUtils.Matches(s0a, s1a: string): Boolean;\r\n{$ENDIF}\r\nconst\r\n  larger = '>';\r\n  smaller = '<';\r\n  logand  = '&';\r\n  logor   = '^';\r\n  asterix = '*';\r\n  qmark = '?';\r\n  negation = '!';\r\n\r\nvar\r\n  matching: boolean;\r\n  done: boolean;\r\n  len: longint;\r\n  lastchar:  char;\r\n  s0,s1,s2,s3: integer;\r\n  oksmaller,oklarger,negflag: boolean;\r\n  compstr: string;\r\n  flag1,flag2,flag3: boolean;\r\n  equal: boolean;\r\n  n1,n2: double;\r\n  code1, code2: Integer;\r\n  dt1,dt2: TDateTime;\r\n  q, i: integer;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  i := 1;\r\n  {$ENDIF}\r\n  {$IFNDEF FMXMOBILE}\r\n  i := 0;\r\n  {$ENDIF}\r\n\r\n  oksmaller := True;\r\n  oklarger := True;\r\n  flag1 := False;\r\n  flag2 := False;\r\n  flag3 := False;\r\n  negflag := False;\r\n  equal := False;\r\n\r\n  { [<>] string [&|] [<>] string }\r\n\r\n  // do larger than or larger than or equal\r\n\r\n  s2 := Pos(larger,s0a);\r\n\r\n  if s2 <> 0 then\r\n  begin\r\n    inc(s2);\r\n    if (s0a[s2 - i] = '=') then\r\n    begin\r\n      Equal := True;\r\n      inc(s2);\r\n    end;\r\n\r\n    while (s0a[s2 - i] = ' ') do\r\n      inc(s2);\r\n\r\n    s3 := s2;\r\n    len := 0;\r\n\r\n    lastchar := #0;\r\n\r\n    q := 0;\r\n\r\n    while (s0a[s2 - i] <> ' ') and (s2 <= Length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|')))  do\r\n    begin\r\n      if (s0a[s2 - i] = '\"') then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n\r\n      if (s0a[s2 - i] = ' ') and odd(q) then // skip space if between quotes\r\n      begin\r\n        lastchar := s0a[s2 - i];\r\n        inc(s2);\r\n      end;\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := Copy(s0a,s3,len);\r\n\r\n    //StrLCopy(compstr,s3,len);\r\n\r\n    Val(TTMSFNCUtils.StripThousandSep(s1a),n1,code1);\r\n    Val(TTMSFNCUtils.StripThousandSep(compstr),n2,code2);\r\n\r\n    dt2 := 0;\r\n    if TTMSFNCUtils.IsDate(compstr,dt2) then\r\n      code2 := 1;\r\n\r\n    dt1 := 0;\r\n    if TTMSFNCUtils.IsDate(s1a,dt1) then\r\n      code1 := 1;\r\n\r\n    if (code1 = 0) and (code2 = 0) then {both are numeric types}\r\n    begin\r\n      if equal then\r\n        oklarger := n1 >= n2\r\n      else\r\n        oklarger := n1 > n2;\r\n    end\r\n    else\r\n    begin\r\n      if TTMSFNCUtils.IsDate(compstr,dt2) and TTMSFNCUtils.IsDate(s1a,dt1) then\r\n      begin\r\n        if equal then\r\n         oklarger := dt1 >= dt2\r\n        else\r\n         oklarger := dt1 > dt2;\r\n      end\r\n      else\r\n      begin\r\n        if equal then\r\n         oklarger := (CompareStr(compstr,s1a)<=0)\r\n        else\r\n         oklarger := (CompareStr(compstr,s1a)<0);\r\n      end;\r\n    end;\r\n    flag1 := True;\r\n  end;\r\n\r\n  equal := False;\r\n\r\n  // do smaller than or smaller than or equal\r\n  s2 := Pos(smaller, s0a);\r\n  if (s2 <> 0) then\r\n  begin\r\n    inc(s2);\r\n    if (s0a[s2 - i] = '=') then\r\n      begin\r\n       equal := True;\r\n       inc(s2);\r\n      end;\r\n\r\n    lastchar := #0;\r\n\r\n    while (s0a[s2 - i] =' ') do inc(s2);\r\n    s3 := s2;\r\n    len := 0;\r\n    q := 0;\r\n\r\n    while (s0a[s2 - i] <> ' ') and (s2 <= Length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|'))) do\r\n    begin\r\n      if s0a[s2 - i] = '\"' then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := copy(s0a, s3, len);\r\n\r\n    Val(TTMSFNCUtils.StripThousandSep(s1a),n1,code1);\r\n    Val(TTMSFNCUtils.StripThousandSep(compstr),n2,code2);\r\n    if TTMSFNCUtils.IsDate(compstr,dt2) then code2 := 1;\r\n    if TTMSFNCUtils.IsDate(s1a,dt1) then code1 := 1;\r\n\r\n    if (code1 = 0) and (code2 = 0) then // both are numeric types\r\n     begin\r\n      if equal then\r\n       oksmaller := n1 <= n2\r\n      else\r\n       oksmaller := n1 < n2;\r\n     end\r\n    else\r\n     begin\r\n      // check for dates here ?\r\n      if TTMSFNCUtils.IsDate(compstr, dt2) and TTMSFNCUtils.IsDate(s1a, dt1) then\r\n       begin\r\n        if equal then\r\n         oksmaller := dt1 <= dt2\r\n        else\r\n         oksmaller := dt1 < dt2;\r\n       end\r\n      else\r\n       begin\r\n        if equal then\r\n          oksmaller := (CompareStr(compstr,s1a)>=0)\r\n        else\r\n          oksmaller := (CompareStr(compstr,s1a)>0);\r\n       end;\r\n     end;\r\n\r\n    flag2 := True;\r\n  end;\r\n\r\n  s2 := Pos(negation, s0a);\r\n\r\n  if (s2 <> 0) then\r\n  begin\r\n    inc(s2);\r\n    while (s0a[s2 - i] = ' ') do\r\n      inc(s2);\r\n    s3 := s2;\r\n    len := 0;\r\n\r\n    lastchar := #0;\r\n    q := 0;\r\n\r\n    while (s0a[s2 - i] <> ' ') and (s2 <= length(s0a)) and (odd(q) or ((s0a[s2 - i] <> '&') and (s0a[s2 - i] <> '|'))) do\r\n    begin\r\n      if (s0a[s2 - i] = '\"') then\r\n        inc(q);\r\n\r\n      if (len = 0) and (s0a[s2 - i] = '\"') then\r\n        inc(s3)\r\n      else\r\n        inc(len);\r\n\r\n      lastchar := s0a[s2 - i];\r\n      inc(s2);\r\n    end;\r\n\r\n    if (len > 0) and (lastchar = '\"') then\r\n      dec(len);\r\n\r\n    compstr := copy(s0a, s3, len);\r\n    flag3 := True;\r\n  end;\r\n\r\n  if (flag3) then\r\n  begin\r\n    if Pos(larger, s0a) = 0 then\r\n      flag1 := flag3;\r\n    if Pos(smaller, s0a) = 0 then\r\n      flag2 := flag3;\r\n  end;\r\n\r\n  if (Pos(logor, s0a) <> 0) then\r\n    if flag1 or flag2 then\r\n    begin\r\n      matches := oksmaller or oklarger;\r\n      Exit;\r\n    end;\r\n\r\n  if (Pos(logand, s0a) <> 0) then\r\n    if flag1 and flag2 then\r\n    begin\r\n      matches := oksmaller and oklarger;\r\n      Exit;\r\n    end;\r\n\r\n  if ((Pos(larger, s0a) <> 0) and (oklarger)) or\r\n     ((Pos(smaller, s0a) <> 0) and (oksmaller)) then\r\n  begin\r\n    matches := True;\r\n    Exit;\r\n  end;\r\n\r\n  s0 := 1;\r\n  s1 := 1;\r\n\r\n  matching := True;\r\n\r\n  done := ((s0 >= Length(s0a)) and (s1 >= Length(s1a))) or (s0a = '') or (s1a = '');\r\n\r\n  while not done and matching do\r\n  begin\r\n    case s0a[s0 - i] of\r\n    qmark:\r\n      begin\r\n        matching := s1 <= Length(s1a);\r\n        if matching then\r\n        begin\r\n          inc(s0);\r\n          inc(s1);\r\n        end;\r\n      end;\r\n    negation:\r\n      begin\r\n        negflag:=True;\r\n        inc(s0);\r\n      end;\r\n    '\"':\r\n      begin\r\n        inc(s0);\r\n      end;\r\n    asterix:\r\n      begin\r\n        repeat\r\n          inc(s0)\r\n        until (s0a[s0 - i] <> asterix);\r\n        len := Length(s1a) - s1;\r\n        inc(s1,len);\r\n        matching := matches(copy(s0a,s0,Length(s0a)),Copy(s1a, s1, Length(s1a)));\r\n\r\n        while (len >= 0) and not matching do\r\n        begin\r\n         dec(s1);\r\n         dec(len);\r\n         matching := matches(copy(s0a,s0,Length(s0a)),Copy(s1a, s1, Length(s1a)));\r\n       end;\r\n       if matching then\r\n       begin\r\n         s0 := Length(s0a)+1;\r\n         s1 := Length(s1a)+1;\r\n       end;\r\n    end;\r\n   else\r\n     begin\r\n       if (s0 <= Length(s0a)) and (s1 <= Length(s1a)) then\r\n         matching := s0a[s0 - i] = s1a[s1 - i]\r\n       else\r\n         matching := false;\r\n\r\n       if matching then\r\n       begin\r\n         inc(s0);\r\n         inc(s1);\r\n       end;\r\n     end;\r\n   end;\r\n\r\n   Done := (s0 > Length(s0a)) and (s1 > Length(s1a));\r\n  end;\r\n\r\n  if negflag then\r\n    Matches := not matching\r\n  else\r\n    Matches := matching;\r\nend;\r\n\r\nclass function TTMSFNCUtils.MatchStr(AValue1, AValue2:string; ACaseSensitive:Boolean):Boolean;\r\nbegin\r\n  if ACaseSensitive then\r\n    Result := Matches(PChar(AValue1),PChar(AValue2))\r\n  else\r\n    Result := Matches(PChar(AnsiUpperCase(AValue1)),PChar(AnsiUpperCase(AValue2)));\r\nend;\r\n\r\nclass function TTMSFNCUtils.MatchStrEx(AValue1, AValue2: string; ACaseSensitive: Boolean): Boolean;\r\nvar\r\n  ch,lastop: Char;\r\n  sep,cp: Integer;\r\n  res,newres: Boolean;\r\n  CharArray: TTMSFNCUtilsCharSet;\r\nbegin\r\n  AValue1 := Trim(AValue1);\r\n  AValue1 := StripLogicSpaces(AValue1);\r\n\r\n  sep := -1;\r\n  if TTMSFNCUtils.VarPos('=', AValue1, sep) = 1 then\r\n    Delete(AValue1, sep, 1);\r\n\r\n  LastOp := #0;\r\n  Res := True;\r\n\r\n  SetLength(CharArray,5);\r\n  CharArray[0] := '(';\r\n  CharArray[1] := ';';\r\n  CharArray[2] := '^';\r\n  CharArray[3] := '&';\r\n  CharArray[4] := '|';\r\n\r\n  repeat\r\n    ch := FirstChar(CharArray, AValue1, sep);\r\n    if ch <> #0 then\r\n    begin\r\n      {$IFDEF FMXMOBILE}\r\n      if (length(AValue1) > 0) and (AValue1[0] = '(') and (pos('(',AValue1) > 0) then\r\n      {$ELSE}\r\n      if (length(AValue1) > 0) and (AValue1[1] = '(') and (pos('(',AValue1) > 0) then\r\n      {$ENDIF}\r\n      begin\r\n        cp := ClosingParenthesis(AValue1);\r\n        NewRes := MatchStrEx(copy(AValue1,2,cp - 2),AValue2,ACaseSensitive);\r\n        delete(AValue1,1,cp);\r\n      end\r\n      else\r\n      begin\r\n        NewRes := MatchStr(Copy(AValue1,1,sep - 1),AValue2,ACaseSensitive);\r\n        Delete(AValue1,1,sep);\r\n      end;\r\n\r\n      if LastOp = #0 then\r\n        Res := NewRes\r\n      else\r\n        case LastOp of\r\n        ';','^','|':Res := Res or NewRes;\r\n        '&':Res := Res and NewRes;\r\n        end;\r\n\r\n      LastOp := ch;\r\n     end;\r\n\r\n  until (ch = #0);\r\n\r\n  NewRes := MatchStr(AValue1, AValue2, ACaseSensitive);\r\n\r\n  if LastOp = #0 then\r\n    Res := NewRes\r\n  else\r\n    case LastOp of\r\n    ';','^','|':Res := Res or NewRes;\r\n    '&':Res := Res and NewRes;\r\n    end;\r\n\r\n  Result := Res;\r\nend;\r\n\r\nclass procedure TTMSFNCUtils.Split(const ADelimiter: Char; AInput: string; const AStrings: TStrings);\r\nbegin\r\n  AStrings.Clear;\r\n  AStrings.Delimiter := ADelimiter;\r\n  AStrings.StrictDelimiter := True;\r\n  AStrings.DelimitedText := AInput;\r\nend;\r\n\r\nclass function TTMSFNCUtils.VarPos(ASubValue, AValue: string; var AResult: Integer): Integer;\r\nbegin\r\n  AResult := Pos(ASubValue, AValue);\r\n  Result := AResult;\r\nend;\r\n\r\nclass function TTMSFNCUtils.VarPosNoCase(ASubValue, AValue: string;\r\n  var AResult: Integer): Integer;\r\nbegin\r\n  AResult := Pos(Uppercase(ASubValue), Uppercase(AValue));\r\n  Result := AResult;\r\nend;\r\n\r\nclass function TTMSFNCUtils.HTMLStrip(AHTML: string): string;\r\nvar\r\n  TagPos: integer;\r\nbegin\r\n  Result := '';\r\n  // replace line breaks by linefeeds\r\n  while (pos('<BR>',uppercase(AHTML))>0) do\r\n    AHTML := StringReplace(AHTML,'<BR>',chr(13)+chr(10),[rfIgnoreCase]);\r\n\r\n  while (pos('<HR>',uppercase(AHTML))>0) do\r\n    AHTML := StringReplace(AHTML,'<HR>',chr(13)+chr(10),[rfIgnoreCase]);\r\n\r\n  TagPos := 0;\r\n  {remove all other tags}\r\n  while (VarPos('<',AHTML,TagPos) > 0) do\r\n  begin\r\n    Result := Result + Copy(AHTML,1,TagPos-1);\r\n    if (VarPos('>',AHTML,TagPos)>0) then\r\n      Delete(AHTML,1,TagPos)\r\n    else\r\n      Break;\r\n  end;\r\n  Result := Result + AHTML;\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetResourceStream(AResourceName: string): TResourceStream;\r\nbegin\r\n  Result := GetResourceStream(AResourceName, GetHInstance);\r\nend;\r\n\r\nclass function TTMSFNCUtils.GetResourceStream(AResourceName: string; AInstance: NativeUInt): TResourceStream;\r\n{$IFDEF WEBLIB}\r\nbegin\r\n  Result := nil;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  hst: NativeUInt;\r\n  function FindRCData(ModuleHandle: HMODULE; Name: string): boolean;\r\n  begin\r\n    Result := FindResource(ModuleHandle, PChar(Name), PChar(RT_RCDATA)) <> 0;\r\n  end;\r\nbegin\r\n  Result := nil;\r\n  hst := AInstance;\r\n  if FindRCData(hst, AResourceName) then\r\n    Result := TResourceStream.Create(hst, AResourceName, RT_RCDATA);\r\n{$ENDIF}\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\n\r\n{ TTMSFNCComponentHelper }\r\n\r\nfunction TTMSFNCComponentHelper.GetVersionNumber(AMaj, AMin, ARel,\r\n  ABld: ShortInt): string;\r\nvar\r\n  vn: Integer;\r\nbegin\r\n  vn := MakeLong(MakeWord(ABld, ARel),MakeWord(AMin, AMaj));\r\n  Result := IntToStr(Hi(Hiword(vn)))+'.'+IntToStr(Lo(Hiword(vn)))+'.'+IntToStr(Hi(Loword(vn)))+'.'+IntToStr(Lo(Loword(vn)));\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNLIB}\r\n\r\n{ TTMSFNCControlHelper }\r\n\r\nfunction TTMSFNCControlHelper.MakeScreenshot: TTMSFNCBitmap;\r\nvar\r\n  bmp: Graphics.TBitmap;\r\nbegin\r\n  bmp := Graphics.TBitmap.Create;\r\n  bmp.SetSize(Width, Height);\r\n  Result := TTMSFNCBitmap.Create;\r\n  try\r\n    if (Self is TWinControl) and (Self as TWinControl).HandleAllocated then\r\n      TWinControl(Self).PaintTo(bmp.Canvas.Handle, 0, 0);\r\n\r\n    Result.Assign(bmp);\r\n  finally\r\n    bmp.Free;\r\n  end;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\n{ TTMSFNCClipBoard }\r\n\r\n{$IFDEF FMXLIB}\r\n\r\nclass procedure TTMSFNCClipBoard.Clear;\r\n{$IFDEF MACOS}\r\nvar\r\n{$IFDEF IOS}\r\n  pb: UIPasteboard;\r\n{$ELSE}\r\n  pb: NSPasteboard;\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF ANDROID}\r\nvar\r\n  clip: IFMXClipboardService;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF MSWINDOWS}\r\n  OpenClipboard(0);\r\n  try\r\n    EmptyClipboard;\r\n  finally\r\n    CloseClipBoard;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  pb := TUIPasteboard.Wrap(TUIPasteboard.OCClass.generalPasteboard);\r\n  pb.setData(nil, CocoaNSStringConst(libUIKit, 'UIPasteboardNameGeneral'));\r\n  {$ELSE}\r\n  pb := TNSPasteboard.Wrap(TNSPasteboard.OCClass.generalPasteboard);\r\n  pb.clearContents;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF ANDROID}\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXClipboardService, IInterface(clip)) then\r\n    clip.SetClipboard('');\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetHTML: String;\r\nvar\r\n  val: TValue;\r\nbegin\r\n  Result := '';\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfHTML));\r\n  if not val.IsEmpty and val.IsType<String> then\r\n    Result := val.AsType<String>;\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.IsTextFormat(AFormat: Cardinal): Boolean;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.IsTextFormat(AFormat: String): Boolean;\r\n{$ENDIF}\r\nbegin\r\n  Result := (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfText))\r\n         or (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfRTF))\r\n         or (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfHTML));\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.IsStreamFormat(AFormat: Cardinal): Boolean;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.IsStreamFormat(AFormat: String): Boolean;\r\n{$ENDIF}\r\nbegin\r\n  Result := (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfStream)) or (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfBitmap))\r\n         or (AFormat = GetFormat(TTMSFNCClipBoardFormat.cfRichTextStream));\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.GetFormat(AFormat: TTMSFNCClipBoardFormat): Cardinal;\r\nbegin\r\n  case AFormat of\r\n    TTMSFNCClipBoardFormat.cfText: Result := CF_TEXT;\r\n    TTMSFNCClipBoardFormat.cfRTF: Result := CF_FNCRTF;\r\n    TTMSFNCClipBoardFormat.cfHTML: Result := CF_FNCHTML;\r\n    TTMSFNCClipBoardFormat.cfStream: Result := CF_FNCSTREAM;\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := CF_FNCBITMAP;\r\n    TTMSFNCClipBoardFormat.cfBitmapWin: Result := CF_FNCBITMAPWIN;\r\n    TTMSFNCClipBoardFormat.cfRichTextStream: Result := CF_FNCRICHTEXTSTREAM;\r\n    else\r\n      Result := 0;\r\n  end;\r\nend;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.GetFormat(AFormat: TTMSFNCClipBoardFormat): string;\r\nbegin\r\n  Result := '';\r\n  case AFormat of\r\n    TTMSFNCClipBoardFormat.cfText: Result := 'public.utf8-plain-text';\r\n    TTMSFNCClipBoardFormat.cfRTF: Result := 'public.rtf';\r\n    TTMSFNCClipBoardFormat.cfHTML: Result := 'public.html';\r\n    TTMSFNCClipBoardFormat.cfStream: Result := 'TTMSFNCClipBoard.StreamFormat';\r\n    {$IFDEF IOS}\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := 'public.png';\r\n    {$ELSE}\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := 'public.image';\r\n    {$ENDIF}\r\n    TTMSFNCClipBoardFormat.cfRichTextStream: Result := 'RichEditorText';\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCClipBoard.GetRTF: String;\r\nvar\r\n  val: TValue;\r\nbegin\r\n  Result := '';\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfRTF));\r\n  if not val.IsEmpty and val.IsType<String> then\r\n    Result := val.AsType<String>;\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetBitmap: TTMSFNCBitmap;\r\nvar\r\n  val: TValue;\r\n  ms: TMemoryStream;\r\nbegin\r\n  Result := nil;\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfBitmap));\r\n  if not val.IsEmpty and val.IsType<TMemoryStream> then\r\n  begin\r\n    Result := TTMSFNCBitmap.Create;\r\n    Result.LoadFromStream(val.AsType<TMemoryStream>);\r\n    ms := val.AsType<TMemoryStream>;\r\n    ms.Free;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetStream: TMemoryStream;\r\nvar\r\n  val: TValue;\r\nbegin\r\n  Result := nil;\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfStream));\r\n  if not val.IsEmpty and val.IsType<TMemoryStream> then\r\n    Result := val.AsType<TMemoryStream>;\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetRichTextStream: TMemoryStream;\r\nvar\r\n  val: TValue;\r\nbegin\r\n  Result := nil;\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfRichTextStream));\r\n  if not val.IsEmpty and val.IsType<TMemoryStream> then\r\n    Result := val.AsType<TMemoryStream>;\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetText: String;\r\nvar\r\n  val: TValue;\r\nbegin\r\n  Result := '';\r\n  val := GetValue(GetFormat(TTMSFNCClipBoardFormat.cfText));\r\n  if not val.IsEmpty and val.IsType<String> then\r\n    Result := val.AsType<String>;\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.AllocateCustomValue(AFormat: Cardinal; AValue: TValue): THandle;\r\nbegin\r\n  Result := 0;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetCustomValue(AFormat: Cardinal; AValue: TValue; var AData: Pointer);\r\n{$ELSE}\r\n{$IFDEF MACOS}\r\nclass function TTMSFNCClipBoard.SetCustomValue(AFormat: String; AValue: TValue): NSData;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.SetCustomValue(AFormat: String; AValue: TValue): Pointer;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  {$IFNDEF MSWINDOWS}\r\n  Result := nil;\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.GetCustomValue(AFormat: Cardinal; AData: Pointer): TValue;\r\n{$ELSE}\r\n{$IFDEF MACOS}\r\nclass function TTMSFNCClipBoard.GetCustomValue(AFormat: String; AData: NSData): TValue;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.GetCustomValue(AFormat: String; AData: Pointer): TValue;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.GetValue(AFormat: Cardinal): TValue;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.GetValue(AFormat: String): TValue;\r\n{$ENDIF}\r\n{$IFDEF MACOS}\r\nvar\r\n  dt: NSData;\r\n  str: NSString;\r\n  I: Integer;\r\n  arr: NSArray;\r\n{$IFDEF IOS}\r\n  dtObj: NSObject;\r\n  dtp: Pointer;\r\n  pb: UIPasteboard;\r\n  dic: NSDictionary;\r\n  K: Integer;\r\n  kp: Pointer;\r\n  key: String;\r\n{$ELSE}\r\n  pb: NSPasteboard;\r\n  pbit: NSPasteboardItem;\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF MSWINDOWS}\r\nvar\r\n  hMem: THandle;\r\n  pMem: Pointer;\r\n  txt: string;\r\n{$ENDIF}\r\n{$IFDEF ANDROID}\r\nvar\r\n  clip: IFMXClipboardService;\r\n{$ENDIF}\r\nbegin\r\n  Result := nil;\r\n{$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  pb := TUIPasteboard.Wrap(TUIPasteboard.OCClass.generalPasteboard);\r\n  arr := pb.items;\r\n  for I := 0 to arr.count - 1 do\r\n  begin\r\n    dic := TNSDictionary.Wrap(arr.objectAtIndex(I));\r\n    for K := 0 to dic.allKeys.count - 1 do\r\n    begin\r\n      kp := dic.allKeys.objectAtIndex(K);\r\n      key := UTF8ToString(TNSString.Wrap(kp).UTF8String);\r\n      if key = AFormat then\r\n      begin\r\n        dtp := dic.objectForKey(kp);\r\n        dtobj := TNSObject.Wrap(dtp);\r\n        if isStreamFormat(AFormat) then\r\n        begin\r\n          dt := TNSData.Wrap(dtp);\r\n          if Assigned(dt) then\r\n          begin\r\n            Result := TMemoryStream.Create;\r\n            Result.AsType<TMemoryStream>.Write(dt.bytes^, dt.length);\r\n            Result.AsType<TMemoryStream>.Position := 0;\r\n            Exit;\r\n          end;\r\n        end\r\n        else if isTextFormat(AFormat) then\r\n        begin\r\n          str := TNSString.Wrap(dtp);\r\n          Result := UTF8ToString(str.UTF8String);\r\n          Exit;\r\n        end\r\n        else\r\n          Result := GetCustomValue(AFormat, TNSData.Wrap(dtp));\r\n      end;\r\n    end;\r\n  end;\r\n  {$ELSE}\r\n  pb := TNSPasteboard.Wrap(TNSPasteboard.OCClass.generalPasteboard);\r\n  arr := pb.pasteboardItems;\r\n  for I := 0 to arr.count - 1 do\r\n  begin\r\n    pbit := TNSPasteboardItem.Wrap(arr.objectAtIndex(I));\r\n    if isTextFormat(AFormat) then\r\n    begin\r\n      str := pbit.stringForType(TTMSFNCUtils.NSStrEx(AFormat));\r\n      if Assigned(str) then\r\n      begin\r\n        Result := UTF8ToString(str.UTF8String);\r\n        Exit;\r\n      end;\r\n    end\r\n    else if isStreamFormat(AFormat) then\r\n    begin\r\n      if AFormat = 'public.image' then\r\n      begin\r\n        dt := pbit.dataForType(TTMSFNCUtils.NSStrEx('public.png'));\r\n        if not Assigned(dt) then\r\n        begin\r\n          dt := pbit.dataForType(TTMSFNCUtils.NSStrEx('public.tiff'));\r\n          if not Assigned(dt) then\r\n            dt := pbit.dataForType(TTMSFNCUtils.NSStrEx('public.jpeg'));\r\n        end;\r\n      end\r\n      else\r\n        dt := pbit.dataForType(TTMSFNCUtils.NSStrEx(AFormat));\r\n\r\n      if Assigned(dt) then\r\n      begin\r\n        Result := TMemoryStream.Create;\r\n        Result.AsType<TMemoryStream>.Write(dt.bytes^, dt.length);\r\n        Result.AsType<TMemoryStream>.Position := 0;\r\n        Exit;\r\n      end;\r\n    end\r\n    else\r\n      Result := GetCustomValue(AFormat, pbit.dataForType(TTMSFNCUtils.NSStrEx(AFormat)));\r\n  end;\r\n  {$ENDIF}\r\n{$ENDIF}\r\n\r\n{$IFDEF MSWINDOWS}\r\n  if AFormat = CF_TEXT then\r\n  begin\r\n    if HasFormat(CF_UNICODETEXT) then\r\n      AFormat := CF_UNICODETEXT;\r\n  end;\r\n\r\n  OpenClipboard(0);\r\n  try\r\n    hMem := GetClipboardData(AFormat);\r\n  finally\r\n    CloseClipboard;\r\n  end;\r\n\r\n  if hMem <> 0 then\r\n  begin\r\n    pMem := GlobalLock(hMem);\r\n    if pMem <> nil then\r\n    begin\r\n      try\r\n        if isStreamFormat(AFormat) then\r\n        begin\r\n          Result := TMemoryStream.Create;\r\n          Result.AsType<TMemoryStream>.Write(pMem^, GlobalSize(hMem));\r\n          Result.AsType<TMemoryStream>.Position := 0;\r\n        end\r\n        else if isTextFormat(AFormat) or (AFormat = CF_UNICODETEXT) then\r\n        begin\r\n          if AFormat = CF_UNICODETEXT then\r\n            txt := PChar(pMem)\r\n          else\r\n            txt := UTF8ToString(pMem);\r\n\r\n          Result := txt;\r\n        end\r\n        else\r\n          Result := GetCustomValue(AFormat, pMem);\r\n      finally\r\n        GlobalUnlock(hMem);\r\n      end;\r\n    end;\r\n  end;\r\n{$ENDIF}\r\n\r\n{$IFDEF ANDROID}\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXClipboardService, IInterface(clip)) then\r\n    Result := clip.GetClipboard;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.HasFormat(AFormat: TTMSFNCClipBoardFormat): Boolean;\r\nbegin\r\n  Result := HasFormat(GetFormat(AFormat));\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.HasFormat(AFormat: Cardinal): Boolean;\r\nbegin\r\n  Result := False;\r\n  try\r\n    OpenClipboard(0);\r\n    Result := Boolean(IsClipboardFormatAvailable(AFormat));\r\n    CloseClipboard;\r\n  except\r\n  end;\r\nend;\r\n{$ELSE}\r\nclass function TTMSFNCClipBoard.HasFormat(AFormat: String): Boolean;\r\nvar\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  I, K: Integer;\r\n  kp: Pointer;\r\n  key: String;\r\n  pb: UIPasteBoard;\r\n  arr: NSArray;\r\n  dic: NSDictionary;\r\n  {$ELSE}\r\n  I: Integer;\r\n  pb: NSPasteBoard;\r\n  pbi: NSPasteboardItem;\r\n  str: NSString;\r\n  {$ENDIF}\r\n  {$ELSE}\r\n  clip: IFMXClipboardService;\r\n  {$ENDIF}\r\nbegin\r\n  Result := False;\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  pb := TUIPasteboard.Wrap(TUIPasteboard.OCClass.generalPasteboard);\r\n  arr := pb.items;\r\n  for I := 0 to arr.count - 1 do\r\n  begin\r\n    dic := TNSDictionary.Wrap(arr.objectAtIndex(I));\r\n    for K := 0 to dic.allKeys.count - 1 do\r\n    begin\r\n      kp := dic.allKeys.objectAtIndex(K);\r\n      key := UTF8ToString(TNSString.Wrap(kp).UTF8String);\r\n      if key = AFormat then\r\n      begin\r\n        Result := True;\r\n        Exit;\r\n      end;\r\n    end;\r\n  end;\r\n  {$ELSE}\r\n  pb := TNSPasteboard.Wrap(TNSPasteboard.OCClass.generalPasteboard);\r\n  for I := 0 to pb.pasteboardItems.count - 1 do\r\n  begin\r\n    pbi := TNSPasteboardItem.Wrap(pb.pasteboardItems.objectAtIndex(I));\r\n    str := pbi.availableTypeFromArray(TNSArray.Wrap(TNSArray.OCClass.arrayWithObject((TTMSFNCUtils.NSStrEx(AFormat) as ILocalObject).GetObjectID)));\r\n    if Assigned(str) then\r\n    begin\r\n      Result := True;\r\n      Exit;\r\n    end;\r\n  end;\r\n  {$ENDIF}\r\n  {$ELSE}\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXClipboardService, IInterface(clip)) then\r\n    Result := not clip.GetClipboard.IsEmpty;\r\n  {$ENDIF}\r\nend;\r\n{$ENDIF}\r\n\r\nclass procedure TTMSFNCClipBoard.SetHTML(AHTML: String);\r\nbegin\r\n  SetValue(AHTML, GetFormat(TTMSFNCClipBoardFormat.cfHTML));\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRTF(ARTF: String);\r\nbegin\r\n  SetValue(ARTF, GetFormat(TTMSFNCClipBoardFormat.cfRTF));\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetStream(AStream: TMemoryStream);\r\nbegin\r\n  SetValue(AStream, GetFormat(TTMSFNCClipBoardFormat.cfStream));\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass function TTMSFNCClipBoard.GetBitmapWin: TTMSFNCBitmap;\r\nvar\r\n  Header: TBitmapFileHeader;\r\n  DataHandle: HGLOBAL;\r\n  BitmapInfoPtr: PBitmapV5Header;\r\n  Stream: TMemoryStream;\r\nbegin\r\n  Result := nil;\r\n  OpenClipboard(0);\r\n  DataHandle := GetClipboardData(CF_DIB);\r\n  BitmapInfoPtr := nil;\r\n  if DataHandle <> 0 then\r\n    BitmapInfoPtr := GlobalLock(DataHandle);\r\n\r\n  if Assigned(BitmapInfoPtr) then\r\n  begin\r\n    Stream := TMemoryStream.Create;\r\n    try\r\n      FillChar(Header, SizeOf(Header), 0);\r\n      Header.bfType := $4D42;\r\n      Header.bfSize := SizeOf(Header) + GlobalSize(DataHandle);\r\n      Header.bfOffBits := SizeOf(Header) + BitmapInfoPtr.bV5Size;\r\n      Stream.WriteBuffer(Header, SizeOf(Header));\r\n      Stream.WriteBuffer(BitmapInfoPtr^, Header.bfSize - SizeOf(Header));\r\n      Stream.Position := 0;\r\n      Result := TTMSFNCBitmap.Create;\r\n      Result.LoadFromStream(Stream);\r\n    finally\r\n      GlobalUnlock(DataHandle);\r\n      Stream.Free;\r\n      CloseClipboard;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetBitmapWin(ABitmap: TTMSFNCBitmap);\r\nvar\r\n  Data: THandle;\r\n  DataPtr: Pointer;\r\n  BitmapHeader: TBitmapInfoHeader;\r\n  BitmapData: TBitmapData;\r\n  I, J: Integer;\r\n  DIBDataPtr: Pointer;\r\nbegin\r\n  OpenClipboard(0);\r\n  try\r\n    FillChar(BitmapHeader, SizeOf(BitmapHeader), 0);\r\n    BitmapHeader.biSize := SizeOf(TBitmapInfoHeader);\r\n    BitmapHeader.biPlanes := 1;\r\n    BitmapHeader.biBitCount := 32;\r\n    BitmapHeader.biCompression := BI_RGB;\r\n\r\n    BitmapHeader.biWidth := ABitmap.Width;\r\n    BitmapHeader.biHeight := ABitmap.Height;\r\n    BitmapHeader.biSizeImage := ABitmap.BytesPerPixel * ABitmap.Width * ABitmap.Height;\r\n\r\n    if BitmapHeader.biWidth <= 0 then\r\n      BitmapHeader.biWidth := 1;\r\n    if BitmapHeader.biHeight <= 0 then\r\n      BitmapHeader.biHeight := 1;\r\n\r\n    Data := GlobalAlloc(GMEM_MOVEABLE + GMEM_DDESHARE, BitmapHeader.biWidth * Abs(BitmapHeader.biHeight) * 4 + SizeOf(BitmapHeader));\r\n    try\r\n      DataPtr := GlobalLock(Data);\r\n      try\r\n        Move(BitmapHeader, DataPtr^, SizeOf(BitmapHeader));\r\n        DIBDataPtr := @(PByteArray(DataPtr)[SizeOf(BitmapHeader)]);\r\n\r\n        if ABitmap.Map(TMapAccess.Read, BitmapData) then\r\n        try\r\n          if BitmapData.PixelFormat = TPixelFormat.BGRA then\r\n            for I := 0 to ABitmap.Height - 1 do\r\n              Move(PAlphaColorArray(BitmapData.Data)[I * (BitmapData.Pitch div 4)],\r\n                PAlphaColorArray(DIBDataPtr)[(ABitmap.Height - 1 - I) * ABitmap.Width], ABitmap.Width * 4)\r\n          else\r\n            for I := 0 to ABitmap.Height - 1 do\r\n              for J := 0 to ABitmap.Width - 1 do\r\n                PAlphaColorArray(DIBDataPtr)[(ABitmap.Height - 1 - I) * ABitmap.Width + J] :=\r\n                  BitmapData.GetPixel(J, I);\r\n        finally\r\n          ABitmap.Unmap(BitmapData);\r\n        end;\r\n      finally\r\n        GlobalUnlock(Data);\r\n      end;\r\n      SetClipboardData(CF_DIB, Data);\r\n    except\r\n      GlobalFree(Data);\r\n      raise;\r\n    end;\r\n  finally\r\n    CloseClipboard;\r\n  end;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nclass procedure TTMSFNCClipBoard.SetBitmap(ABitmap: TTMSFNCBitmap);\r\nvar\r\n  ms: TMemoryStream;\r\nbegin\r\n  ms := TMemoryStream.Create;\r\n  try\r\n    ABitmap.SaveToStream(ms);\r\n    SetValue(ms, GetFormat(TTMSFNCClipBoardFormat.cfBitmap));\r\n  finally\r\n    ms.Free;\r\n  end;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRichTextStream(AStream: TMemoryStream);\r\nbegin\r\n  SetValue(AStream, GetFormat(TTMSFNCClipBoardFormat.cfRichTextStream));\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetText(AText: String);\r\nbegin\r\n  SetValue(AText, GetFormat(TTMSFNCClipBoardFormat.cfText));\r\nend;\r\n\r\n{$IFDEF MSWINDOWS}\r\nclass procedure TTMSFNCClipBoard.SetValue(AValue: TValue; AFormat: Cardinal);\r\n{$ELSE}\r\nclass procedure TTMSFNCClipBoard.SetValue(AValue: TValue; AFormat: String);\r\n{$ENDIF}\r\n{$IFDEF MACOS}\r\nvar\r\n{$IFDEF IOS}\r\n  pb: UIPasteboard;\r\n  dic: NSDictionary;\r\n  pValue: Pointer;\r\n{$ELSE}\r\n  pb: NSPasteboard;\r\n  pbit: NSPasteboardItem;\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$IFDEF MSWINDOWS}\r\nvar\r\n  hMem: THandle;\r\n  pMem: Pointer;\r\n  txt: string;\r\n  l: integer;\r\n{$ENDIF}\r\n{$IFDEF ANDROID}\r\nvar\r\n  clip: IFMXClipboardService;\r\n{$ENDIF}\r\nbegin\r\n  if AValue.IsObject then\r\n  begin\r\n    if AValue.IsType<TMemoryStream> then\r\n      AValue.AsType<TMemoryStream>.Position := 0;\r\n  end;\r\n\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  pb := TUIPasteboard.Wrap(TUIPasteboard.OCClass.generalPasteboard);\r\n  if AValue.IsType<TMemoryStream> then\r\n    pValue := TNSData.OCClass.dataWithBytes(AValue.AsType<TMemoryStream>.Memory, AValue.AsType<TMemoryStream>.Size)\r\n  else if AValue.IsType<String> then\r\n    pValue := (TTMSFNCUtils.NSStrEx(AValue.AsType<String>) as ILocalObject).GetObjectID\r\n  else\r\n    pValue := (SetCustomValue(AFormat, AValue) as ILocalObject).GetObjectID;\r\n\r\n  if Assigned(pValue) then\r\n  begin\r\n    dic := TNSDictionary.Wrap(TNSDictionary.OCClass.dictionaryWithObject(pValue, (TTMSFNCUtils.NSStrEx(AFormat) as ILocalObject).GetObjectID));\r\n    pb.addItems(TNSArray.Wrap(TNSArray.OCClass.arrayWithObject((dic as ILocalObject).GetObjectID)));\r\n  end;\r\n  {$ELSE}\r\n  pb := TNSPasteboard.Wrap(TNSPasteboard.OCClass.generalPasteboard);\r\n  pbit := TNSPasteboardItem.Wrap(TNSPasteboardItem.Wrap(TNSPasteboardItem.OCClass.alloc).init);\r\n  if AValue.IsType<TMemoryStream> then\r\n    pbit.setData(TNSData.Wrap(TNSData.OCClass.dataWithBytes(AValue.AsType<TMemoryStream>.Memory, AValue.AsType<TMemoryStream>.Size)), TTMSFNCUtils.NSStrEx(AFormat))\r\n  else if AValue.IsType<String> then\r\n    pbit.setData(TTMSFNCUtils.NSStrEx(AValue.AsType<String>).dataUsingEncoding(NSUTF8StringEncoding), TTMSFNCUtils.NSStrEx(AFormat))\r\n  else\r\n    pbit.setData(SetCustomValue(AFormat, AValue), TTMSFNCUtils.NSStrEx(AFormat));\r\n\r\n  pb.writeObjects(TNSArray.Wrap(TNSArray.OCClass.arrayWithObject((pbit as ILocalObject).GetObjectID)));\r\n  {$ENDIF}\r\n{$ENDIF}\r\n\r\n{$IFDEF MSWINDOWS}\r\n  if AValue.IsObject and AValue.IsType<TMemoryStream> then\r\n    hMem := GlobalAlloc(GHND or GMEM_DDESHARE, AValue.AsType<TMemoryStream>.Size)\r\n  else if AValue.IsType<String> then\r\n  begin\r\n    txt := AValue.AsString;\r\n    if AFormat = CF_FNCRTF then\r\n    begin\r\n      l := Length(txt) + 1;\r\n      hMem := GlobalAlloc(GHND or GMEM_DDESHARE, l)\r\n    end\r\n    else\r\n    begin\r\n      l := ByteLength(txt) + SizeOf(Char);\r\n      hMem := GlobalAlloc(GHND or GMEM_DDESHARE, l)\r\n    end;\r\n  end\r\n  else\r\n    hMem := AllocateCustomValue(AFormat, AValue);\r\n\r\n  if hMem <> 0 then\r\n  begin\r\n    pMem := GlobalLock(hMem);\r\n    if pMem <> nil then\r\n    begin\r\n      try\r\n        if AValue.IsObject and AValue.IsType<TMemoryStream> then\r\n        begin\r\n          AValue.AsType<TMemoryStream>.Read(pMem^, AValue.AsType<TMemoryStream>.Size);\r\n          AValue.AsType<TMemoryStream>.Position := 0;\r\n        end\r\n        else if AValue.IsType<string> then\r\n        begin\r\n          if AFormat = CF_FNCRTF then\r\n          begin\r\n            {$HINTS OFF}\r\n            {$IF COMPILERVERSION > 24}\r\n            AnsiStrings.StrCopy(pMem, PAnsiChar(AnsiString(txt)));\r\n            {$ELSE}\r\n            StrCopy(PAnsiChar(pMem), PAnsiChar(AnsiString(txt)));\r\n            {$IFEND}\r\n            {$HINTS ON}\r\n          end\r\n          else\r\n          begin\r\n            if AFormat = CF_TEXT then\r\n              AFormat := CF_UNICODETEXT;\r\n\r\n            Move(PChar(txt)^, pMem^, ByteLength(txt) + SizeOf(Char));\r\n          end;\r\n        end\r\n        else\r\n          SetCustomValue(AFormat, AValue, pMem);\r\n      finally\r\n        GlobalUnlock(hMem);\r\n      end;\r\n      OpenClipboard(0);\r\n      try\r\n        SetClipboardData(AFormat, hmem);\r\n      finally\r\n        CloseClipboard;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      GlobalFree(hMem);\r\n    end;\r\n  end;\r\n{$ENDIF}\r\n\r\n{$IFDEF ANDROID}\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXClipboardService, IInterface(clip)) then\r\n    clip.SetClipboard(AValue);\r\n{$ENDIF}\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nclass function TTMSFNCClipBoard.GetBitmap: TTMSFNCBitmap;\r\nbegin\r\n  raise Exception.Create('GetBitmap not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetBitmap(ABitmap: TTMSFNCBitmap);\r\nbegin\r\n  raise Exception.Create('SetBitmap not supported');\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetRichTextStream: TMemoryStream;\r\nbegin\r\n  raise Exception.Create('GetRichTextStream not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRichTextStream(AStream: TMemoryStream);\r\nbegin\r\n  raise Exception.Create('SetRichTextStream not supported');\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetStream: TMemoryStream;\r\nbegin\r\n  raise Exception.Create('GetStream not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetStream(AStream: TMemoryStream);\r\nbegin\r\n  raise Exception.Create('SetStream not supported');\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetRTF: string;\r\nbegin\r\n  raise Exception.Create('GetRTF not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRTF(ARTF: String);\r\nbegin\r\n  raise Exception.Create('SetRTF not supported');\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetHTML: string;\r\nbegin\r\n  raise Exception.Create('GetHTML not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetHTML(AHTML: String);\r\nbegin\r\n  raise Exception.Create('SetHTML not supported');\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetText: string;\r\nbegin\r\n  raise Exception.Create('GetText not supported');\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetText(AText: String);\r\nbegin\r\n  asm\r\n    const element = document.createElement('textarea');\r\n    element.value = AText;\r\n    document.body.appendChild(element);\r\n    element.focus();\r\n    element.setSelectionRange(0, element.value.length);\r\n    document.execCommand('copy');\r\n    document.body.removeChild(element);\r\n  end;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.Clear;\r\nbegin\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.HasFormat(AFormat: TTMSFNCClipBoardFormat): Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNLIB}\r\nclass function TTMSFNCClipBoard.HasFormat(AFormat: TTMSFNCClipBoardFormat): Boolean;\r\nbegin\r\n  Result := False;\r\n  case AFormat of\r\n    TTMSFNCClipBoardFormat.cfText: Result := Clipboard.HasFormat(CF_TEXT);\r\n    TTMSFNCClipBoardFormat.cfRTF: Result := Clipboard.HasFormat(CF_FNCRTF);\r\n    TTMSFNCClipBoardFormat.cfHTML: Result := Clipboard.HasFormat(CF_FNCHTML);\r\n    TTMSFNCClipBoardFormat.cfStream: Result := Clipboard.HasFormat(CF_FNCSTREAM);\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := Clipboard.HasFormat(CF_FNCBITMAP);\r\n    TTMSFNCClipBoardFormat.cfRichTextStream: Result := Clipboard.HasFormat(CF_FNCRICHTEXTSTREAM);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetFormat(AFormat: TTMSFNCClipBoardFormat): string;\r\nbegin\r\n  Result := '';\r\n  {$IFDEF MSWINDOWS}\r\n  case AFormat of\r\n    TTMSFNCClipBoardFormat.cfText: Result := 'text/plain';\r\n    TTMSFNCClipBoardFormat.cfRTF: Result := 'Rich Text Format';\r\n    TTMSFNCClipBoardFormat.cfHTML: Result := 'HTML Format';\r\n    TTMSFNCClipBoardFormat.cfStream: Result := 'TTMSFNCClipBoard.StreamFormat';\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := 'Delphi Picture';\r\n    TTMSFNCClipBoardFormat.cfRichTextStream: Result := 'RichEditorText';\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF UNIX}\r\n  case AFormat of\r\n    TTMSFNCClipBoardFormat.cfText: Result := 'text/plain';\r\n    TTMSFNCClipBoardFormat.cfRTF: Result := 'text/richtext';\r\n    TTMSFNCClipBoardFormat.cfHTML: Result := 'text/html';\r\n    TTMSFNCClipBoardFormat.cfStream: Result := 'TTMSFNCClipBoard.StreamFormat';\r\n    TTMSFNCClipBoardFormat.cfBitmap: Result := 'Delphi Picture';\r\n    TTMSFNCClipBoardFormat.cfRichTextStream: Result := 'RichEditorText';\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.Clear;\r\nbegin\r\n  Clipboard.Clear;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetText(AText: String);\r\nbegin\r\n  {$IFDEF VCLLIB}\r\n  Clipboard.AsText := AText;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Clipboard.SetTextBuf(PChar(AText));\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetText: String;\r\nbegin\r\n  Result := Clipboard.AsText;\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetStream(AStream: TMemoryStream);\r\n{$IFDEF VCLLIB}\r\nvar\r\n  Data: THandle;\r\n  DataPtr: Pointer;\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    Data := GlobalAlloc(GMEM_MOVEABLE + GMEM_DDESHARE, AStream.Size);\r\n    try\r\n      DataPtr := GlobalLock(Data);\r\n      try\r\n        Move(AStream.Memory^, DataPtr^, AStream.Size);\r\n        SetClipboardData(CF_FNCSTREAM, Data);\r\n      finally\r\n        GlobalUnlock(Data);\r\n      end;\r\n    except\r\n      GlobalFree(Data);\r\n      raise;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    Clipboard.AddFormat(CF_FNCSTREAM, AStream);\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetStream: TMemoryStream;\r\n{$IFDEF VCLLIB}\r\nvar\r\n  DataPtr: Pointer;\r\n  Data: THandle;\r\nbegin\r\n  Result := nil;\r\n  Clipboard.Open;\r\n  try\r\n    Data := GetClipboardData(CF_FNCSTREAM);\r\n    if Data <> 0 then\r\n    begin\r\n      DataPtr := GlobalLock(Data);\r\n      if Assigned(DataPtr) then\r\n      begin\r\n        Result := TMemoryStream.Create;\r\n        Result.WriteBuffer(DataPtr^, GlobalSize(Data));\r\n        Result.Position := 0;\r\n      end;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nvar\r\n  fmt: TClipboardFormat;\r\nbegin\r\n  Result := nil;\r\n  fmt := Clipboard.FindFormatID(GetFormat(cfStream));\r\n  if fmt <> 0 then\r\n  begin\r\n    Result := TMemoryStream.Create;\r\n    Clipboard.GetFormat(fmt, Result);\r\n    Result.Position := 0;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetBitmap(ABitmap: TTMSFNCBitmap);\r\n{$IFDEF VCLLIB}\r\nvar\r\n  pic: TGraphic;\r\n  ms, ds: TMemoryStream;\r\n  gcc: TGraphicClass;\r\nbegin\r\n  pic := nil;\r\n\r\n  if IsBitmapEmpty(ABitmap) then\r\n    Exit;\r\n\r\n  ds := TMemoryStream.Create;\r\n  try\r\n    ABitmap.SaveToStream(ds);\r\n    ds.Position := 0;\r\n    if TTMSFNCUtils.FindGraphicClass(ds.Memory^, ds.Size, gcc) then\r\n      pic := gcc.Create;\r\n  finally\r\n    ds.Free;\r\n  end;\r\n\r\n  if Assigned(pic) then\r\n  begin\r\n    try\r\n      ms := TMemoryStream.Create;\r\n      try\r\n        ABitmap.SaveToStream(ms);\r\n        ms.Position := 0;\r\n        pic.LoadFromStream(ms);\r\n      finally\r\n        ms.Free;\r\n      end;\r\n\r\n      Clipboard.Open;\r\n      try\r\n        Clipboard.Assign(pic);\r\n      finally\r\n        Clipboard.Close;\r\n      end;\r\n\r\n    finally\r\n      pic.Free;\r\n    end;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nbegin\r\n  if IsBitmapEmpty(ABitmap) then\r\n    Exit;\r\n\r\n  ClipBoard.Open;\r\n  try\r\n    ClipBoard.Assign(ABitmap.Graphic);\r\n  finally\r\n    ClipBoard.Close;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetBitmap: TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCBitmap.Create;\r\n  Result.Assign(Clipboard);\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRichTextStream(AStream: TMemoryStream);\r\n{$IFDEF VCLLIB}\r\nvar\r\n  Data: THandle;\r\n  DataPtr: Pointer;\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    Data := GlobalAlloc(GMEM_MOVEABLE + GMEM_DDESHARE, AStream.Size);\r\n    try\r\n      DataPtr := GlobalLock(Data);\r\n      try\r\n        Move(AStream.Memory^, DataPtr^, AStream.Size);\r\n        SetClipboardData(CF_FNCRICHTEXTSTREAM, Data);\r\n      finally\r\n        GlobalUnlock(Data);\r\n      end;\r\n    except\r\n      GlobalFree(Data);\r\n      raise;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    Clipboard.AddFormat(CF_FNCRICHTEXTSTREAM, AStream);\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetRichTextStream: TMemoryStream;\r\n{$IFDEF VCLLIB}\r\nvar\r\n  DataPtr: Pointer;\r\n  Data: THandle;\r\nbegin\r\n  Result := nil;\r\n  Clipboard.Open;\r\n  try\r\n    Data := GetClipboardData(CF_FNCRICHTEXTSTREAM);\r\n    if Data <> 0 then\r\n    begin\r\n      DataPtr := GlobalLock(Data);\r\n      if Assigned(DataPtr) then\r\n      begin\r\n        Result := TMemoryStream.Create;\r\n        Result.WriteBuffer(DataPtr^, GlobalSize(Data));\r\n        Result.Position := 0;\r\n      end;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nvar\r\n  fmt: TClipboardFormat;\r\nbegin\r\n  Result := nil;\r\n  fmt := Clipboard.FindFormatID(GetFormat(cfRichTextStream));\r\n  if fmt <> 0 then\r\n  begin\r\n    Result := TMemoryStream.Create;\r\n    Clipboard.GetFormat(fmt, Result);\r\n    Result.Position := 0;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetRTF(ARTF: String);\r\n{$IFDEF VCLLIB}\r\nvar\r\n  rtfstr: ansistring;\r\n  MemHandleRTF: THandle;\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    rtfstr := ansistring(ARTF);\r\n\r\n    MemHandleRTF := GlobalAlloc(GHND or GMEM_SHARE, Length(rtfstr) + 1);\r\n\r\n    if (MemHandleRTF <> 0) then\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 24}\r\n      AnsiStrings.StrCopy(GlobalLock(MemHandleRTF), PAnsiChar(rtfstr));\r\n      {$ELSE}\r\n      StrCopy(PAnsiChar(GlobalLock(MemHandleRTF)), PAnsiChar(rtfstr));\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      GlobalUnlock(MemHandleRTF);\r\n      SetClipboardData(CF_FNCRTF, MemHandleRTF);\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nbegin\r\n  Clipboard.Open;\r\n  try\r\n    Clipboard.AddFormat(CF_FNCRTF, ARTF[1], Length(ARTF));\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetRTF: String;\r\n{$IFDEF VCLLIB}\r\nvar\r\n  hClip: THandle;\r\n  bufptr: Pointer;\r\n  mstream: TStringStream;\r\nbegin\r\n  Result := '';\r\n  Clipboard.Open;\r\n  try\r\n    HClip := Clipboard.GetAsHandle(CF_FNCRTF);\r\n    bufptr := GlobalLock(HClip);\r\n    if bufptr <> nil then\r\n    begin\r\n      try\r\n        mstream := TStringStream.Create('');\r\n        try\r\n          mstream.WriteBuffer(bufptr^, GlobalSize(HClip));\r\n          Result := mstream.DataString;\r\n        finally\r\n          mstream.Free;\r\n        end;\r\n      finally\r\n        GlobalUnlock(HClip);\r\n      end;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nvar\r\n  fmt: TClipboardFormat;\r\n  ms: TMemoryStream;\r\n  sz: int64;\r\nbegin\r\n  Result := '';\r\n  fmt := Clipboard.FindFormatID(GetFormat(cfRTF));\r\n  if fmt <> 0 then\r\n  begin\r\n    ms := TMemoryStream.Create;\r\n    try\r\n      if Clipboard.GetFormat(fmt, ms) then\r\n      begin\r\n        sz := ms.Size;\r\n        if (sz > 0) and (PChar(ms.Memory)[sz - 1]=#0) then\r\n          Dec(sz);\r\n\r\n        ms.Position := 0;\r\n        SetLength(Result, sz);\r\n        if sz > 0 then\r\n          ms.Read(Result[1], sz);\r\n      end;\r\n    finally\r\n      ms.Free;\r\n    end;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass procedure TTMSFNCClipBoard.SetHTML(AHTML: String);\r\n{$IFDEF VCLLIB}\r\nvar\r\n  htmlstr: ansistring;\r\n  MemHandleHTML: THandle;\r\nbegin\r\n  htmlstr := AnsiString(AHTML);\r\n  htmlstr := AnsiString('Version:0.9'#13#10\r\n    +'StartHTML:71'#13#10\r\n    +'EndHTML:'+inttostr(length(htmlstr) + 71)+#13#10\r\n    +'StartFragment:140'#13#10\r\n    +'EndFragment:'+inttostr(length(htmlstr)+ 142)+#13#10\r\n    +'<!DOCTYPE>' +#13#10\r\n    +'<HTML>'#13#10\r\n    +'<HEAD>'#13#10\r\n    +'<TITLE>The HTML Clipboard</TITLE>'#13#10\r\n    +'<BASE HREF=\"http://sample/specs\">'#13#10\r\n    +'</HEAD>'#13#10\r\n    +'<BODY>'#13#10\r\n    +'<!--StartFragment -->'#13#10)\r\n    + htmlstr + AnsiString(#13#10\r\n    +'<!--StartFragment -->'#13#10\r\n    +'</BODY>'#13#10\r\n    +'</HTML>'#13#10);\r\n\r\n  Clipboard.Open;\r\n  try\r\n    MemHandleHTML := GlobalAlloc(GHND or GMEM_SHARE, Length(htmlstr) + 1);\r\n\r\n    if (MemHandleHTML <> 0) then\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 24}\r\n      AnsiStrings.StrCopy(GlobalLock(MemHandleHTML), PAnsiChar(htmlstr));\r\n      {$ELSE}\r\n      StrCopy(PAnsiChar(GlobalLock(MemHandleHTML)), PAnsiChar(htmlstr));\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      GlobalUnlock(MemHandleHTML);\r\n      SetClipboardData(CF_FNCHTML, MemHandleHTML);\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\n{$IFDEF MSWINDOWS}\r\nconst\r\n  nhdr = 'Version:0.9' + #13#10 +\r\n                 'StartHTML:%.10d' + #13#10+\r\n                 'EndHTML:%.10d' + #13#10+\r\n                 'StartFragment:%.10d' + #13#10+\r\n                 'EndFragment:%.10d' + #13#10;\r\n  hdr = '<html><head></head><body><!--StartFragment-->';\r\n  ftr1 = '<!--EndFragment-->';\r\n  ftr2 = '</body></html>';\r\n{$ENDIF}\r\nvar\r\n  HTMLSource : String;\r\n  {$IFDEF MSWINDOWS}\r\n  iStartHTML: Integer;\r\n  iStartFragment: Integer;\r\n  iEndFragment: Integer;\r\n  iEndHTML: Integer;\r\n  {$ENDIF}\r\nbegin\r\n  {$IFDEF MSWINDOWS}\r\n  iStartHTML := 105;\r\n  iStartFragment := iStartHTML + Length(nhdr);\r\n  iEndFragment := iStartFragment + Length(AHTML) + Length(ftr1);\r\n  iEndHTML := iEndFragment + Length(ftr2);\r\n  HTMLSource := Format(nhdr, [iStartHTML, iEndHTML, iStartFragment,\r\n    iEndFragment]) + hdr + AHTML + ftr1 + ftr2;\r\n  {$ELSE}\r\n  HTMLSource := AHTML;\r\n  {$ENDIF}\r\n\r\n  Clipboard.Open;\r\n  try\r\n    Clipboard.AddFormat(CF_FNCHTML, HTMLSource[1], Length(HTMLSource));\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCClipBoard.GetHTML: String;\r\n{$IFDEF VCLLIB}\r\nvar\r\n  hclip: THandle;\r\n  bufptr: Pointer;\r\n  mstream: TStringStream;\r\nbegin\r\n  Result := '';\r\n  Clipboard.Open;\r\n  try\r\n    HClip := Clipboard.GetAsHandle(CF_FNCHTML);\r\n    bufptr := GlobalLock(HClip);\r\n    if bufptr <> nil then\r\n    begin\r\n      try\r\n        mstream := TStringStream.Create('');\r\n        try\r\n          mstream.WriteBuffer(bufptr^, GlobalSize(HClip));\r\n          Result := UTF8ToString(RawByteString(mstream.DataString));\r\n        finally\r\n          mstream.Free;\r\n        end;\r\n      finally\r\n        GlobalUnlock(HClip);\r\n      end;\r\n    end;\r\n  finally\r\n    Clipboard.Close;\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\nvar\r\n  fmt: TClipboardFormat;\r\n  ms: TMemoryStream;\r\n  sz: int64;\r\nbegin\r\n  Result := '';\r\n  fmt := Clipboard.FindFormatID(GetFormat(cfHTML));\r\n  if fmt <> 0 then\r\n  begin\r\n    ms := TMemoryStream.Create;\r\n    try\r\n      if Clipboard.GetFormat(fmt, ms) then\r\n      begin\r\n        sz := ms.Size;\r\n        if (sz > 0) and (PChar(ms.Memory)[sz-1]=#0) then\r\n          Dec(sz);\r\n\r\n        ms.Position := 0;\r\n        SetLength(Result, sz);\r\n        if sz > 0 then\r\n          ms.Read(Result[1], sz);\r\n      end;\r\n    finally\r\n      ms.Free;\r\n    end;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCClipBoard.HasContent: Boolean;\r\nbegin\r\n  Result := HasFormat(TTMSFNCClipBoardFormat.cfText)\r\n  or HasFormat(TTMSFNCClipBoardFormat.cfRTF)\r\n  or HasFormat(TTMSFNCClipBoardFormat.cfBitmap)\r\n  or HasFormat(TTMSFNCClipBoardFormat.cfBitmapWin)\r\n  or HasFormat(TTMSFNCClipBoardFormat.cfRichTextStream)\r\n  or HasFormat(TTMSFNCClipBoardFormat.cfStream);\r\nend;\r\n\r\n{$IFDEF ANDROID}\r\nprocedure TTMSFNCUtilsDialogSelectFileListener.onClick(dialog: JDialogInterface; which: Integer);\r\nvar\r\n  f: JFile;\r\n  s: JCharSequence;\r\nbegin\r\n  s := FFileList.Items[which];\r\n  if JCharSequenceToStr(s) = '..' then\r\n    f := FCurrentPath.getParentFile\r\n  else\r\n    f := TJFile.JavaClass.init(s.toString);\r\n\r\n  if f.isDirectory then\r\n  begin\r\n    if FFileMode = ufmSave then\r\n      FSelectedFile := JStringToString(f.toString);\r\n\r\n    LoadFileList(f, FFilter);\r\n    FManuallyCancelled := True;\r\n    FDialog.cancel;\r\n    FDialog.dismiss;\r\n    CallInUIThreadAndWaitFinishing(\r\n    procedure\r\n    begin\r\n      ShowDialog(f);\r\n    end\r\n    );\r\n  end\r\n  else\r\n  begin\r\n    FSelectedFile := JStringToString(f.toString);\r\n    FFilePicked := True;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCUtilsDialogDismissListener.onDismiss(dialog: JDialogInterface);\r\nbegin\r\n  FCancelled := not FManuallyCancelled;\r\n  FManuallyCancelled := False;\r\nend;\r\n\r\nprocedure TTMSFNCUtilsDialogSelectDirectoryListener.onClick(dialog: JDialogInterface; which: Integer);\r\nbegin\r\n  FFilePicked := True;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFNDEF WEBLIB}\r\ninitialization\r\nbegin\r\n  if not IsConsole then\r\n  begin\r\n    {$IFNDEF LCLLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    CF_FNCRICHTEXTSTREAM := RegisterClipboardFormat('RichEditorText');\r\n    CF_FNCSTREAM := RegisterClipboardFormat('TTMSFNCClipBoard.StreamFormat');\r\n    {$IFDEF FMXLIB}\r\n    CF_FNCBITMAP := RegisterClipboardFormat('PNG');\r\n    CF_FNCBITMAPWIN := CF_BITMAP;\r\n    {$ENDIF}\r\n    {$IFDEF VCLLIB}\r\n    CF_FNCBITMAP := CF_BITMAP;\r\n    {$ENDIF}\r\n    CF_FNCRTF := RegisterClipboardFormat('Rich Text Format');\r\n    CF_FNCHTML := RegisterClipboardFormat('HTML Format');\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    {$IFDEF LCLLIB}\r\n    CF_FNCRICHTEXTSTREAM := RegisterClipboardFormat('RichEditorText');\r\n    CF_FNCSTREAM := RegisterClipboardFormat('TTMSFNCClipBoard.StreamFormat');\r\n    CF_FNCBITMAP := CF_PICTURE;\r\n    CF_FNCRTF := RegisterClipboardFormat(TTMSFNCClipBoard.GetFormat(TTMSFNCClipBoardFormat.cfRTF));\r\n    CF_FNCHTML := RegisterClipboardFormat(TTMSFNCClipBoard.GetFormat(TTMSFNCClipBoardFormat.cfHTML));\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCGraphicsTypes;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE USECOMMONCOLORS}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE USECOMMONCOLORS}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF FMXLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  Windows,\r\n  {$ENDIF}\r\n  Classes, Types, WEBLib.TMSFNCTypes, WEBLib.Graphics\r\n  {$IFNDEF WEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  ,UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  ,Generics.Collections\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,fgl\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  {$IFNDEF LCLLIB}\r\n  FPC_FULLVERSION = 0;\r\n  {$ENDIF}\r\n  PathScale = 1E-4;\r\n  PathFontSize = 1E-2;\r\n  PathPosition = 1E-3;\r\n  PathAngle = 1E-4;\r\n\r\n  {$IFDEF FMXLIB}\r\n  gcAlpha = $FF000000;\r\n  gcAliceblue = gcAlpha or $F0F8FF;\r\n  gcAntiquewhite = gcAlpha or $FAEBD7;\r\n  gcAqua = gcAlpha or $00FFFF;\r\n  gcAquamarine = gcAlpha or $7FFFD4;\r\n  gcAzure = gcAlpha or $F0FFFF;\r\n  gcBeige = gcAlpha or $F5F5DC;\r\n  gcBisque = gcAlpha or $FFE4C4;\r\n  gcBlack = gcAlpha or $000000;\r\n  gcBlanchedalmond = gcAlpha or $FFEBCD;\r\n  gcBlue = gcAlpha or $0000FF;\r\n  gcBlueviolet = gcAlpha or $8A2BE2;\r\n  gcBrown = gcAlpha or $A52A2A;\r\n  gcBurlywood = gcAlpha or $DEB887;\r\n  gcCadetblue = gcAlpha or $5F9EA0;\r\n  gcChartreuse = gcAlpha or $7FFF00;\r\n  gcChocolate = gcAlpha or $D2691E;\r\n  gcCoral = gcAlpha or $FF7F50;\r\n  gcCornflowerblue = gcAlpha or $6495ED;\r\n  gcCornsilk = gcAlpha or $FFF8DC;\r\n  gcCrimson = gcAlpha or $DC143C;\r\n  gcCyan = gcAlpha or $00FFFF;\r\n  gcDarkblue = gcAlpha or $00008B;\r\n  gcDarkcyan = gcAlpha or $008B8B;\r\n  gcDarkgoldenrod = gcAlpha or $B8860B;\r\n  gcDarkgray = gcAlpha or $A9A9A9;\r\n  gcDarkgreen = gcAlpha or $006400;\r\n  gcDarkgrey = gcAlpha or $A9A9A9;\r\n  gcDarkkhaki = gcAlpha or $BDB76B;\r\n  gcDarkmagenta = gcAlpha or $8B008B;\r\n  gcDarkolivegreen = gcAlpha or $556B2F;\r\n  gcDarkorange = gcAlpha or $FF8C00;\r\n  gcDarkorchid = gcAlpha or $9932CC;\r\n  gcDarkred = gcAlpha or $8B0000;\r\n  gcDarksalmon = gcAlpha or $E9967A;\r\n  gcDarkseagreen = gcAlpha or $8FBC8F;\r\n  gcDarkslateblue = gcAlpha or $483D8B;\r\n  gcDarkslategray = gcAlpha or $2F4F4F;\r\n  gcDarkslategrey = gcAlpha or $2F4F4F;\r\n  gcDarkturquoise = gcAlpha or $00CED1;\r\n  gcDarkviolet = gcAlpha or $9400D3;\r\n  gcDeeppink = gcAlpha or $FF1493;\r\n  gcDeepskyblue = gcAlpha or $00BFFF;\r\n  gcDimgray = gcAlpha or $696969;\r\n  gcDimgrey = gcAlpha or $696969;\r\n  gcDodgerblue = gcAlpha or $1E90FF;\r\n  gcFirebrick = gcAlpha or $B22222;\r\n  gcFloralwhite = gcAlpha or $FFFAF0;\r\n  gcForestgreen = gcAlpha or $228B22;\r\n  gcFuchsia = gcAlpha or $FF00FF;\r\n  gcGainsboro = gcAlpha or $DCDCDC;\r\n  gcGhostwhite = gcAlpha or $F8F8FF;\r\n  gcGold = gcAlpha or $FFD700;\r\n  gcGoldenrod = gcAlpha or $DAA520;\r\n  gcGray = gcAlpha or $808080;\r\n  gcGreen = gcAlpha or $008000;\r\n  gcGreenyellow = gcAlpha or $ADFF2F;\r\n  gcGrey = gcAlpha or $808080;\r\n  gcHoneydew = gcAlpha or $F0FFF0;\r\n  gcHotpink = gcAlpha or $FF69B4;\r\n  gcIndianred = gcAlpha or $CD5C5C;\r\n  gcIndigo = gcAlpha or $4B0082;\r\n  gcIvory = gcAlpha or $FFFFF0;\r\n  gcKhaki = gcAlpha or $F0E68C;\r\n  gcLavender = gcAlpha or $E6E6FA;\r\n  gcLavenderblush = gcAlpha or $FFF0F5;\r\n  gcLawngreen = gcAlpha or $7CFC00;\r\n  gcLemonchiffon = gcAlpha or $FFFACD;\r\n  gcLightblue = gcAlpha or $ADD8E6;\r\n  gcLightcoral = gcAlpha or $F08080;\r\n  gcLightcyan = gcAlpha or $E0FFFF;\r\n  gcLightgoldenrodyellow = gcAlpha or $FAFAD2;\r\n  gcLightgray = gcAlpha or $D3D3D3;\r\n  gcLightgreen = gcAlpha or $90EE90;\r\n  gcLightgrey = gcAlpha or $D3D3D3;\r\n  gcLightpink = gcAlpha or $FFB6C1;\r\n  gcLightsalmon = gcAlpha or $FFA07A;\r\n  gcLightseagreen = gcAlpha or $20B2AA;\r\n  gcLightskyblue = gcAlpha or $87CEFA;\r\n  gcLightslategray = gcAlpha or $778899;\r\n  gcLightslategrey = gcAlpha or $778899;\r\n  gcLightsteelblue = gcAlpha or $B0C4DE;\r\n  gcLightyellow = gcAlpha or $FFFFE0;\r\n  gcLtGray = gcAlpha or $C0C0C0;\r\n  gcMedGray = gcAlpha or $A0A0A0;\r\n  gcDkGray = gcAlpha or $808080;\r\n  gcMoneyGreen = gcAlpha or $C0DCC0;\r\n  gcLegacySkyBlue = gcAlpha or $F0CAA6;\r\n  gcCream = gcAlpha or $F0FBFF;\r\n  gcLime = gcAlpha or $00FF00;\r\n  gcLimegreen = gcAlpha or $32CD32;\r\n  gcLinen = gcAlpha or $FAF0E6;\r\n  gcMagenta = gcAlpha or $FF00FF;\r\n  gcMaroon = gcAlpha or $800000;\r\n  gcMediumaquamarine = gcAlpha or $66CDAA;\r\n  gcMediumblue = gcAlpha or $0000CD;\r\n  gcMediumorchid = gcAlpha or $BA55D3;\r\n  gcMediumpurple = gcAlpha or $9370DB;\r\n  gcMediumseagreen = gcAlpha or $3CB371;\r\n  gcMediumslateblue = gcAlpha or $7B68EE;\r\n  gcMediumspringgreen = gcAlpha or $00FA9A;\r\n  gcMediumturquoise = gcAlpha or $48D1CC;\r\n  gcMediumvioletred = gcAlpha or $C71585;\r\n  gcMidnightblue = gcAlpha or $191970;\r\n  gcMintcream = gcAlpha or $F5FFFA;\r\n  gcMistyrose = gcAlpha or $FFE4E1;\r\n  gcMoccasin = gcAlpha or $FFE4B5;\r\n  gcNavajowhite = gcAlpha or $FFDEAD;\r\n  gcNavy = gcAlpha or $000080;\r\n  gcOldlace = gcAlpha or $FDF5E6;\r\n  gcOlive = gcAlpha or $808000;\r\n  gcOlivedrab = gcAlpha or $6B8E23;\r\n  gcOrange = gcAlpha or $FFA500;\r\n  gcOrangered = gcAlpha or $FF4500;\r\n  gcOrchid = gcAlpha or $DA70D6;\r\n  gcPalegoldenrod = gcAlpha or $EEE8AA;\r\n  gcPalegreen = gcAlpha or $98FB98;\r\n  gcPaleturquoise = gcAlpha or $AFEEEE;\r\n  gcPalevioletred = gcAlpha or $DB7093;\r\n  gcPapayawhip = gcAlpha or $FFEFD5;\r\n  gcPeachpuff = gcAlpha or $FFDAB9;\r\n  gcPeru = gcAlpha or $CD853F;\r\n  gcPink = gcAlpha or $FFC0CB;\r\n  gcPlum = gcAlpha or $DDA0DD;\r\n  gcPowderblue = gcAlpha or $B0E0E6;\r\n  gcPurple = gcAlpha or $800080;\r\n  gcRed = gcAlpha or $FF0000;\r\n  gcRosybrown = gcAlpha or $BC8F8F;\r\n  gcRoyalblue = gcAlpha or $4169E1;\r\n  gcSaddlebrown = gcAlpha or $8B4513;\r\n  gcSalmon = gcAlpha or $FA8072;\r\n  gcSandybrown = gcAlpha or $F4A460;\r\n  gcSeagreen = gcAlpha or $2E8B57;\r\n  gcSeashell = gcAlpha or $FFF5EE;\r\n  gcSienna = gcAlpha or $A0522D;\r\n  gcSilver = gcAlpha or $C0C0C0;\r\n  gcSkyblue = gcAlpha or $87CEEB;\r\n  gcSlateblue = gcAlpha or $6A5ACD;\r\n  gcSlategray = gcAlpha or $708090;\r\n  gcSlategrey = gcAlpha or $708090;\r\n  gcSnow = gcAlpha or $FFFAFA;\r\n  gcSpringgreen = gcAlpha or $00FF7F;\r\n  gcSteelblue = gcAlpha or $4682B4;\r\n  gcTan = gcAlpha or $D2B48C;\r\n  gcTeal = gcAlpha or $008080;\r\n  gcThistle = gcAlpha or $D8BFD8;\r\n  gcTomato = gcAlpha or $FF6347;\r\n  gcTurquoise = gcAlpha or $40E0D0;\r\n  gcViolet = gcAlpha or $EE82EE;\r\n  gcWheat = gcAlpha or $F5DEB3;\r\n  gcWhite = gcAlpha or $FFFFFF;\r\n  gcWhitesmoke = gcAlpha or $F5F5F5;\r\n  gcYellow = gcAlpha or $FFFF00;\r\n  gcYellowgreen = gcAlpha or $9ACD32;\r\n  gcNull = $00000000;\r\n  {$ENDIF}\r\n  {$IFDEF USECOMMONCOLORS}\r\n  gcAliceblue = $FFF8F0;\r\n  gcAntiquewhite = $D7EBFA;\r\n  gcAqua = $FFFF00;\r\n  gcAquamarine = $D4FF7F;\r\n  gcAzure = $FFFFF0;\r\n  gcBeige = $DCF5F5;\r\n  gcBisque = $C4E4FF;\r\n  gcBlack = $000000;\r\n  gcBlanchedalmond = $CDEBFF;\r\n  gcBlue = $FF0000;\r\n  gcBlueviolet = $E22B8A;\r\n  gcBrown = $2A2AA5;\r\n  gcBurlywood = $87B8DE;\r\n  gcCadetblue = $A09E5F;\r\n  gcChartreuse = $00FF7F;\r\n  gcChocolate = $1E69D2;\r\n  gcCoral = $507FFF;\r\n  gcCornflowerblue = $ED9564;\r\n  gcCornsilk = $DCF8FF;\r\n  gcCrimson = $3C14DC;\r\n  gcCyan = $FFFF00;\r\n  gcDarkblue = $8B0000;\r\n  gcDarkcyan = $8B8B00;\r\n  gcDarkgoldenrod = $0B86B8;\r\n  gcDarkgray = $A9A9A9;\r\n  gcDarkgreen = $006400;\r\n  gcDarkgrey = $A9A9A9;\r\n  gcDarkkhaki = $6BB7BD;\r\n  gcDarkmagenta = $8B008B;\r\n  gcDarkolivegreen = $2F6B55;\r\n  gcDarkorange = $008CFF;\r\n  gcDarkorchid = $CC3299;\r\n  gcDarkred = $00008B;\r\n  gcDarksalmon = $7A96E9;\r\n  gcDarkseagreen = $8FBC8F;\r\n  gcDarkslateblue = $8B3D48;\r\n  gcDarkslategray = $4F4F2F;\r\n  gcDarkslategrey = $4F4F2F;\r\n  gcDarkturquoise = $D1CE00;\r\n  gcDarkviolet = $D30094;\r\n  gcDeeppink = $9314FF;\r\n  gcDeepskyblue = $FFBF00;\r\n  gcDimgray = $696969;\r\n  gcDimgrey = $696969;\r\n  gcDodgerblue = $FF901E;\r\n  gcFirebrick = $2222B2;\r\n  gcFloralwhite = $F0FAFF;\r\n  gcForestgreen = $228B22;\r\n  gcFuchsia = $FF00FF;\r\n  gcGainsboro = $DCDCDC;\r\n  gcGhostwhite = $FFF8F8;\r\n  gcGold = $00D7FF;\r\n  gcGoldenrod = $20A5DA;\r\n  gcGray = $808080;\r\n  gcGreen = $008000;\r\n  gcGreenyellow = $2FFFAD;\r\n  gcGrey = $808080;\r\n  gcHoneydew = $F0FFF0;\r\n  gcHotpink = $B469FF;\r\n  gcIndianred = $5C5CCD;\r\n  gcIndigo = $82004B;\r\n  gcIvory = $F0FFFF;\r\n  gcKhaki = $8CE6F0;\r\n  gcLavender = $FAE6E6;\r\n  gcLavenderblush = $F5F0FF;\r\n  gcLawngreen = $00FC7C;\r\n  gcLemonchiffon = $CDFAFF;\r\n  gcLightblue = $E6D8AD;\r\n  gcLightcoral = $8080F0;\r\n  gcLightcyan = $FFFFE0;\r\n  gcLightgoldenrodyellow = $D2FAFA;\r\n  gcLightgray = $D3D3D3;\r\n  gcLightgreen = $90EE90;\r\n  gcLightgrey = $D3D3D3;\r\n  gcLightpink = $C1B6FF;\r\n  gcLightsalmon = $7AA0FF;\r\n  gcLightseagreen = $AAB220;\r\n  gcLightskyblue = $FACE87;\r\n  gcLightslategray = $998877;\r\n  gcLightslategrey = $998877;\r\n  gcLightsteelblue = $DEC4B0;\r\n  gcLightyellow = $E0FFFF;\r\n  gcLtGray = $C0C0C0;\r\n  gcMedGray = $A4A0A0;\r\n  gcDkGray = $808080;\r\n  gcMoneyGreen = $C0DCC0;\r\n  gcLegacySkyBlue = $F0CAA6;\r\n  gcCream = $F0FBFF;\r\n  gcLime = $00FF00;\r\n  gcLimegreen = $32CD32;\r\n  gcLinen = $E6F0FA;\r\n  gcMagenta = $FF00FF;\r\n  gcMaroon = $000080;\r\n  gcMediumaquamarine = $AACD66;\r\n  gcMediumblue = $CD0000;\r\n  gcMediumorchid = $D355BA;\r\n  gcMediumpurple = $DB7093;\r\n  gcMediumseagreen = $71B33C;\r\n  gcMediumslateblue = $EE687B;\r\n  gcMediumspringgreen = $9AFA00;\r\n  gcMediumturquoise = $CCD148;\r\n  gcMediumvioletred = $8515C7;\r\n  gcMidnightblue = $701919;\r\n  gcMintcream = $FAFFF5;\r\n  gcMistyrose = $E1E4FF;\r\n  gcMoccasin = $B5E4FF;\r\n  gcNavajowhite = $ADDEFF;\r\n  gcNavy = $800000;\r\n  gcOldlace = $E6F5FD;\r\n  gcOlive = $008080;\r\n  gcOlivedrab = $238E6B;\r\n  gcOrange = $00A5FF;\r\n  gcOrangered = $0045FF;\r\n  gcOrchid = $D670DA;\r\n  gcPalegoldenrod = $AAE8EE;\r\n  gcPalegreen = $98FB98;\r\n  gcPaleturquoise = $EEEEAF;\r\n  gcPalevioletred = $9370DB;\r\n  gcPapayawhip = $D5EFFF;\r\n  gcPeachpuff = $B9DAFF;\r\n  gcPeru = $3F85CD;\r\n  gcPink = $CBC0FF;\r\n  gcPlum = $DDA0DD;\r\n  gcPowderblue = $E6E0B0;\r\n  gcPurple = $800080;\r\n  gcRed = $0000FF;\r\n  gcRosybrown = $8F8FBC;\r\n  gcRoyalblue = $E16941;\r\n  gcSaddlebrown = $13458B;\r\n  gcSalmon = $7280FA;\r\n  gcSandybrown = $60A4F4;\r\n  gcSeagreen = $578B2E;\r\n  gcSeashell = $EEF5FF;\r\n  gcSienna = $2D52A0;\r\n  gcSilver = $C0C0C0;\r\n  gcSkyblue = $EBCE87;\r\n  gcSlateblue = $CD5A6A;\r\n  gcSlategray = $908070;\r\n  gcSlategrey = $908070;\r\n  gcSnow = $FAFAFF;\r\n  gcSpringgreen = $7FFF00;\r\n  gcSteelblue = $B48246;\r\n  gcTan = $8CB4D2;\r\n  gcTeal = $808000;\r\n  gcThistle = $D8BFD8;\r\n  gcTomato = $4763FF;\r\n  gcTurquoise = $D0E040;\r\n  gcViolet = $EE82EE;\r\n  gcWheat = $B3DEF5;\r\n  gcWhite = $FFFFFF;\r\n  gcWhitesmoke = $F5F5F5;\r\n  gcYellow = $00FFFF;\r\n  gcYellowgreen = $32CD9A;\r\n  gcNull = -1;\r\n  {$ENDIF}\r\n\r\ntype\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCGraphicsColor = TAlphaColor;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCGraphicsColor = TColor;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCGraphicsColorEntry = record\r\n    Value: TTMSFNCGraphicsColor;\r\n    Name: PChar;\r\n  end;\r\n\r\nconst\r\n  TMSFNCGraphicsColorCount = 154;\r\n  {$IFNDEF WEBLIB}\r\n  TMSFNCGraphicsColors: array[0..TMSFNCGraphicsColorCount - 1] of TTMSFNCGraphicsColorEntry = (\r\n  (Value: gcAliceblue; Name:'gcAliceblue'),\r\n  (Value: gcAntiquewhite; Name:'gcAntiquewhite'),\r\n  (Value: gcAqua; Name:'gcAqua'),\r\n  (Value: gcAquamarine; Name:'gcAquamarine'),\r\n  (Value: gcAzure; Name:'gcAzure'),\r\n  (Value: gcBeige; Name:'gcBeige'),\r\n  (Value: gcBisque; Name:'gcBisque'),\r\n  (Value: gcBlack; Name:'gcBlack'),\r\n  (Value: gcBlanchedalmond; Name:'gcBlanchedalmond'),\r\n  (Value: gcBlue; Name:'gcBlue'),\r\n  (Value: gcBlueviolet; Name:'gcBlueviolet'),\r\n  (Value: gcBrown; Name:'gcBrown'),\r\n  (Value: gcBurlywood; Name:'gcBurlywood'),\r\n  (Value: gcCadetblue; Name:'gcCadetblue'),\r\n  (Value: gcChartreuse; Name:'gcChartreuse'),\r\n  (Value: gcChocolate; Name:'gcChocolate'),\r\n  (Value: gcCoral; Name:'gcCoral'),\r\n  (Value: gcCornflowerblue; Name:'gcCornflowerblue'),\r\n  (Value: gcCornsilk; Name:'gcCornsilk'),\r\n  (Value: gcCrimson; Name:'gcCrimson'),\r\n  (Value: gcCyan; Name:'gcCyan'),\r\n  (Value: gcDarkblue; Name:'gcDarkblue'),\r\n  (Value: gcDarkcyan; Name:'gcDarkcyan'),\r\n  (Value: gcDarkgoldenrod; Name:'gcDarkgoldenrod'),\r\n  (Value: gcDarkgray; Name:'gcDarkgray'),\r\n  (Value: gcDarkgreen; Name:'gcDarkgreen'),\r\n  (Value: gcDarkgrey; Name:'gcDarkgrey'),\r\n  (Value: gcDarkkhaki; Name:'gcDarkkhaki'),\r\n  (Value: gcDarkmagenta; Name:'gcDarkmagenta'),\r\n  (Value: gcDarkolivegreen; Name:'gcDarkolivegreen'),\r\n  (Value: gcDarkorange; Name:'gcDarkorange'),\r\n  (Value: gcDarkorchid; Name:'gcDarkorchid'),\r\n  (Value: gcDarkred; Name:'gcDarkred'),\r\n  (Value: gcDarksalmon; Name:'gcDarksalmon'),\r\n  (Value: gcDarkseagreen; Name:'gcDarkseagreen'),\r\n  (Value: gcDarkslateblue; Name:'gcDarkslateblue'),\r\n  (Value: gcDarkslategray; Name:'gcDarkslategray'),\r\n  (Value: gcDarkslategrey; Name:'gcDarkslategrey'),\r\n  (Value: gcDarkturquoise; Name:'gcDarkturquoise'),\r\n  (Value: gcDarkviolet; Name:'gcDarkviolet'),\r\n  (Value: gcDeeppink; Name:'gcDeeppink'),\r\n  (Value: gcDeepskyblue; Name:'gcDeepskyblue'),\r\n  (Value: gcDimgray; Name:'gcDimgray'),\r\n  (Value: gcDimgrey; Name:'gcDimgray'),\r\n  (Value: gcDodgerblue; Name:'gcDodgerblue'),\r\n  (Value: gcFirebrick; Name:'gcFirebrick'),\r\n  (Value: gcFloralwhite; Name:'gcFloralwhite'),\r\n  (Value: gcForestgreen; Name:'gcForestgreen'),\r\n  (Value: gcFuchsia; Name:'gcFuchsia'),\r\n  (Value: gcGainsboro; Name:'gcGainsboro'),\r\n  (Value: gcGhostwhite; Name:'gcGhostwhite'),\r\n  (Value: gcGold; Name:'gcGold'),\r\n  (Value: gcGoldenrod; Name:'gcGoldenrod'),\r\n  (Value: gcGray; Name:'gcGray'),\r\n  (Value: gcGreen; Name:'gcGreen'),\r\n  (Value: gcGreenyellow; Name:'gcGreenyellow'),\r\n  (Value: gcGrey; Name:'gcGrey'),\r\n  (Value: gcHoneydew; Name:'gcHoneydew'),\r\n  (Value: gcHotpink; Name:'gcHotpink'),\r\n  (Value: gcIndianred; Name:'gcIndianred'),\r\n  (Value: gcIndigo; Name:'gcIndigo'),\r\n  (Value: gcIvory; Name:'gcIvory'),\r\n  (Value: gcKhaki; Name:'gcKhaki'),\r\n  (Value: gcLavender; Name:'gcLavender'),\r\n  (Value: gcLavenderblush; Name:'gcLavenderblush'),\r\n  (Value: gcLawngreen; Name:'gcLawngreen'),\r\n  (Value: gcLemonchiffon; Name:'gcLemonchiffon'),\r\n  (Value: gcLightblue; Name:'gcLightblue'),\r\n  (Value: gcLightcoral; Name:'gcLightcoral'),\r\n  (Value: gcLightcyan; Name:'gcLightcyan'),\r\n  (Value: gcLightgoldenrodyellow; Name:'gcLightgoldenrodyellow'),\r\n  (Value: gcLightgray; Name:'gcLightgray'),\r\n  (Value: gcLightgreen; Name:'gcLightgreen'),\r\n  (Value: gcLightgrey; Name:'gcLightgrey'),\r\n  (Value: gcLightpink; Name:'gcLightpink'),\r\n  (Value: gcLightsalmon; Name:'gcLightsalmon'),\r\n  (Value: gcLightseagreen; Name:'gcLightseagreen'),\r\n  (Value: gcLightskyblue; Name:'gcLightskyblue'),\r\n  (Value: gcLightslategray; Name:'gcLightslategray'),\r\n  (Value: gcLightslategrey; Name:'gcLightslategrey'),\r\n  (Value: gcLightsteelblue; Name:'gcLightsteelblue'),\r\n  (Value: gcLightyellow; Name:'gcLightyellow'),\r\n  (Value: gcLtGray; Name:'gcLtGray'),\r\n  (Value: gcMedGray; Name:'gcMedGray'),\r\n  (Value: gcDkGray; Name:'gcDkGray'),\r\n  (Value: gcMoneyGreen; Name:'gcMoneyGreen'),\r\n  (Value: gcLegacySkyBlue; Name:'gcLegacySkyBlue'),\r\n  (Value: gcCream; Name:'gcCream'),\r\n  (Value: gcLime; Name:'gcLime'),\r\n  (Value: gcLimegreen; Name:'gcLimegreen'),\r\n  (Value: gcLinen; Name:'gcLinen'),\r\n  (Value: gcMagenta; Name:'gcMagenta'),\r\n  (Value: gcMaroon; Name:'gcMaroon'),\r\n  (Value: gcMediumaquamarine; Name:'gcMediumaquamarine'),\r\n  (Value: gcMediumblue; Name:'gcMediumblue'),\r\n  (Value: gcMediumorchid; Name:'gcMediumorchid'),\r\n  (Value: gcMediumpurple; Name:'gcMediumpurple'),\r\n  (Value: gcMediumseagreen; Name:'gcMediumseagreen'),\r\n  (Value: gcMediumslateblue; Name:'gcMediumslateblue'),\r\n  (Value: gcMediumspringgreen; Name:'gcMediumspringgreen'),\r\n  (Value: gcMediumturquoise; Name:'gcMediumturquoise'),\r\n  (Value: gcMediumvioletred; Name:'gcMediumvioletred'),\r\n  (Value: gcMidnightblue; Name:'gcMidnightblue'),\r\n  (Value: gcMintcream; Name:'gcMintcream'),\r\n  (Value: gcMistyrose; Name:'gcMistyrose'),\r\n  (Value: gcMoccasin; Name:'gcMoccasin'),\r\n  (Value: gcNavajowhite; Name:'gcNavajowhite'),\r\n  (Value: gcNavy; Name:'gcNavy'),\r\n  (Value: gcOldlace; Name:'gcOldlace'),\r\n  (Value: gcOlive; Name:'gcOlive'),\r\n  (Value: gcOlivedrab; Name:'gcOlivedrab'),\r\n  (Value: gcOrange; Name:'gcOrange'),\r\n  (Value: gcOrangered; Name:'gcOrangered'),\r\n  (Value: gcOrchid; Name:'gcOrchid'),\r\n  (Value: gcPalegoldenrod; Name:'gcPalegoldenrod'),\r\n  (Value: gcPalegreen; Name:'gcPalegreen'),\r\n  (Value: gcPaleturquoise; Name:'gcPaleturquoise'),\r\n  (Value: gcPalevioletred; Name:'gcPalevioletred'),\r\n  (Value: gcPapayawhip; Name:'gcPapayawhip'),\r\n  (Value: gcPeachpuff; Name:'gcPeachpuff'),\r\n  (Value: gcPeru; Name:'gcPeru'),\r\n  (Value: gcPink; Name:'gcPink'),\r\n  (Value: gcPlum; Name:'gcPlum'),\r\n  (Value: gcPowderblue; Name:'gcPowderblue'),\r\n  (Value: gcPurple; Name:'gcPurple'),\r\n  (Value: gcRed; Name:'gcRed'),\r\n  (Value: gcRosybrown; Name:'gcRosybrown'),\r\n  (Value: gcRoyalblue; Name:'gcRoyalblue'),\r\n  (Value: gcSaddlebrown; Name:'gcSaddlebrown'),\r\n  (Value: gcSalmon; Name:'gcSalmon'),\r\n  (Value: gcSandybrown; Name:'gcSandybrown'),\r\n  (Value: gcSeagreen; Name:'gcSeagreen'),\r\n  (Value: gcSeashell; Name:'gcSeashell'),\r\n  (Value: gcSienna; Name:'gcSienna'),\r\n  (Value: gcSilver; Name:'gcSilver'),\r\n  (Value: gcSkyblue; Name:'gcSkyblue'),\r\n  (Value: gcSlateblue; Name:'gcSlateblue'),\r\n  (Value: gcSlategray; Name:'gcSlategray'),\r\n  (Value: gcSlategrey; Name:'gcSlategrey'),\r\n  (Value: gcSnow; Name:'gcSnow'),\r\n  (Value: gcSpringgreen; Name:'gcSpringgreen'),\r\n  (Value: gcSteelblue; Name:'gcSteelblue'),\r\n  (Value: gcTan; Name:'gcTan'),\r\n  (Value: gcTeal; Name:'gcTeal'),\r\n  (Value: gcThistle; Name:'gcThistle'),\r\n  (Value: gcTomato; Name:'gcTomato'),\r\n  (Value: gcTurquoise; Name:'gcTurquoise'),\r\n  (Value: gcViolet; Name:'gcViolet'),\r\n  (Value: gcWheat; Name:'gcWheat'),\r\n  (Value: gcWhite; Name:'gcWhite'),\r\n  (Value: gcWhitesmoke; Name:'gcWhitesmoke'),\r\n  (Value: gcYellow; Name:'gcYellow'),\r\n  (Value: gcYellowgreen; Name:'gcYellowgreen'),\r\n  (Value: gcNull; Name:'gcNull'));\r\n  {$ENDIF}\r\n\r\ntype\r\n  TTMSFNCGraphicsStrokeKind = (gskNone, gskSolid, gskDash, gskDot, gskDashDot, gskDashDotDot);\r\n  TTMSFNCGraphicsTextureMode = (gtmOriginal, gtmFit, gtmStretch, gtmCenter, gtmTile);\r\n  TTMSFNCGraphicsFillKind = (gfkNone, gfkSolid, gfkGradient, gfkTexture);\r\n  TTMSFNCGraphicsFillOrientation = (gfoHorizontal, gfoVertical);\r\n  TTMSFNCGraphicsTextAlign = (gtaCenter, gtaLeading, gtaTrailing);\r\n  TTMSFNCGraphicsTextTrimming = (gttNone, gttCharacter, gttWord);\r\n  TTMSFNCGraphicsSide = (gsLeft, gsTop, gsRight, gsBottom);\r\n  TTMSFNCGraphicsSides = set of TTMSFNCGraphicsSide;\r\n  TTMSFNCGraphicsTextQuality = (gtqDefault, gtqAntiAliasing, gtqClearType);\r\n\r\nconst\r\n  AllSides = [gsLeft, gsTop, gsRight, gsBottom];\r\n  Epsilon: Single = 1E-40;\r\n\r\ntype\r\n  TTMSFNCGraphicsStroke = class;\r\n  TTMSFNCGraphicsFill = class;\r\n  TTMSFNCGraphicsFont = class;\r\n\r\n  TTMSFNCGraphicsSaveState = class(TPersistent)\r\n  private\r\n    {$IFDEF CMNWEBLIB}\r\n    FSaveDC: Integer;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FSaveDC: TCanvasSaveState;\r\n    {$ENDIF}\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FCustomSaveDC: Integer;\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetFont(const Value: TTMSFNCGraphicsFont);\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; override;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property Font: TTMSFNCGraphicsFont read FFont write SetFont;\r\n    property CustomSaveDC: Integer read FCustomSaveDC write FCustomSaveDC;\r\n    {$IFDEF CMNWEBLIB}\r\n    property SaveDC: Integer read FSaveDC write FSaveDC;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    property SaveDC: TCanvasSaveState read FSaveDC write FSaveDC;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  TTMSFNCCustomGraphicsFill = class(TPersistent)\r\n  private\r\n    FUpdateCount: Integer;\r\n    FOnChanged: TNotifyEvent;\r\n    FOrientation: TTMSFNCGraphicsFillOrientation;\r\n    FKind: TTMSFNCGraphicsFillKind;\r\n    FColor: TTMSFNCGraphicsColor;\r\n    FColorTo: TTMSFNCGraphicsColor;\r\n    FColorMirror: TTMSFNCGraphicsColor;\r\n    FColorMirrorTo: TTMSFNCGraphicsColor;\r\n    FOpacity: Single;\r\n    FTexture: TTMSFNCBitmap;\r\n    FTextureMode: TTMSFNCGraphicsTextureMode;\r\n    procedure SetKind(const Value: TTMSFNCGraphicsFillKind);\r\n    procedure SetOrientation(const Value: TTMSFNCGraphicsFillOrientation);\r\n    procedure SetColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetColorTo(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetColorMirror(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetColorMirrorTo(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetOpacity(const Value: Single);\r\n    function IsOpacityStored: Boolean;\r\n    procedure SetTexture(const Value: TTMSFNCBitmap);\r\n    procedure SetTextureMode(const Value: TTMSFNCGraphicsTextureMode);\r\n  protected\r\n    procedure Changed;\r\n    procedure TextureChanged(Sender: TObject);\r\n    property OnChanged: TNotifyEvent read FOnChanged write FOnChanged;\r\n    property Kind: TTMSFNCGraphicsFillKind read FKind write SetKind default gfkSolid;\r\n    property Orientation: TTMSFNCGraphicsFillOrientation read FOrientation write SetOrientation default gfoVertical;\r\n    property Color: TTMSFNCGraphicsColor read FColor write SetColor default gcWhite;\r\n    property ColorTo: TTMSFNCGraphicsColor read FColorTo write SetColorTo default gcGray;\r\n    property ColorMirror: TTMSFNCGraphicsColor read FColorMirror write SetColorMirror default gcNull;\r\n    property ColorMirrorTo: TTMSFNCGraphicsColor read FColorMirrorTo write SetColorMirrorTo default gcNull;\r\n    property Opacity: Single read FOpacity write SetOpacity stored IsOpacityStored nodefault;\r\n    property Texture: TTMSFNCBitmap read FTexture write SetTexture;\r\n    property TextureMode: TTMSFNCGraphicsTextureMode read FTextureMode write SetTextureMode default gtmStretch;\r\n  public\r\n    constructor Create(const AKind: TTMSFNCGraphicsFillKind = gfkSolid; const AColor: TTMSFNCGraphicsColor = gcWhite); virtual;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n  end;\r\n\r\n  TTMSFNCGraphicsFill = class(TTMSFNCCustomGraphicsFill)\r\n  public\r\n    {$IFDEF CMNWEBLIB}\r\n    property Opacity;\r\n    {$ENDIF}\r\n  published\r\n    property OnChanged;\r\n    property Kind;\r\n    property Orientation;\r\n    property Color;\r\n    property ColorTo;\r\n    property ColorMirror;\r\n    property ColorMirrorTo;\r\n    property TextureMode;\r\n    property Texture;\r\n    {$IFDEF FMXLIB}\r\n    property Opacity;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  TTMSFNCGraphicsFont = class(TFont)\r\n  private\r\n    FUpdateCount: Integer;\r\n    FOnChanged: TNotifyEvent;\r\n  {$IFDEF FMXLIB}\r\n    FHeight: Integer;\r\n    FColor: TTMSFNCGraphicsColor;\r\n    procedure SetColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetName(const Value: string);\r\n    function GetName: string;\r\n  {$ENDIF}\r\n  protected\r\n    procedure DoChanged(Sender: TObject); {$IFDEF FMXLIB}reintroduce;{$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n    {$IFDEF LCLLIB}\r\n    procedure Changed; override;\r\n    {$ENDIF}\r\n  {$ENDIF}\r\n  public\r\n  {$IFNDEF LCLLIB}\r\n    constructor Create; virtual;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n    constructor Create; override;\r\n  {$ENDIF}\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure AssignSource(Source: TPersistent); virtual;\r\n  {$IFDEF FMXLIB}\r\n    property Height: Integer read FHeight write FHeight;\r\n  published\r\n    property Color: TTMSFNCGraphicsColor read FColor write SetColor default gcBlack;\r\n    property Name: string read GetName write SetName;\r\n  {$ENDIF}\r\n    property OnChanged: TNotifyEvent read FOnChanged write FOnChanged;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n  end;\r\n\r\n  TTMSFNCCustomGraphicsStroke = class(TPersistent)\r\n  private\r\n    FUpdateCount: Integer;\r\n    FOnChanged: TNotifyEvent;\r\n    FKind: TTMSFNCGraphicsStrokeKind;\r\n    FColor: TTMSFNCGraphicsColor;\r\n    FWidth: Single;\r\n    FOpacity: Single;\r\n    procedure SetKind(const Value: TTMSFNCGraphicsStrokeKind);\r\n    procedure SetColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetWidth(const Value: Single);\r\n    procedure SetOpacity(const Value: Single);\r\n    function IsOpacityStored: Boolean;\r\n    function IsWidthStored: Boolean;\r\n  protected\r\n    procedure Changed;\r\n    property OnChanged: TNotifyEvent read FOnChanged write FOnChanged;\r\n    property Kind: TTMSFNCGraphicsStrokeKind read FKind write SetKind default gskSolid;\r\n    property Color: TTMSFNCGraphicsColor read FColor write SetColor default gcSilver;\r\n    property Width: Single read FWidth write SetWidth stored IsWidthStored nodefault;\r\n    property Opacity: Single read FOpacity write SetOpacity stored IsOpacityStored nodefault;\r\n  public\r\n    constructor Create(const AKind: TTMSFNCGraphicsStrokeKind = gskSolid; const AColor: TTMSFNCGraphicsColor = gcSilver); virtual;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n  end;\r\n\r\n  TTMSFNCGraphicsStroke = class(TTMSFNCCustomGraphicsStroke)\r\n  public\r\n    {$IFDEF CMNWEBLIB}\r\n    property Opacity;\r\n    {$ENDIF}\r\n  published\r\n    property OnChanged;\r\n    property Kind;\r\n    property Color;\r\n    property Width;\r\n    {$IFDEF FMXLIB}\r\n    property Opacity;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCGraphicsVectorArray = array [0..2] of Single;\r\n\r\n  TTMSFNCGraphicsVector = record\r\n    case Integer of\r\n      0: (V: TTMSFNCGraphicsVectorArray;);\r\n      1: (X: Single;\r\n          Y: Single;\r\n          W: Single;);\r\n  end;\r\n\r\n  TTMSFNCGraphicsMatrixArray = array [0..2] of TTMSFNCGraphicsVector;\r\n\r\n  TTMSFNCGraphicsMatrix = record\r\n  private\r\n    function Scale(const AFactor: Single): TTMSFNCGraphicsMatrix;\r\n  public\r\n    class function Identity: TTMSFNCGraphicsMatrix; static;\r\n    class function CreateRotation(const AAngle: Single): TTMSFNCGraphicsMatrix; static;\r\n    class function CreateScaling(const AScaleX, AScaleY: Single): TTMSFNCGraphicsMatrix; static;\r\n    class function CreateTranslation(const ADeltaX, ADeltaY: Single): TTMSFNCGraphicsMatrix; static;\r\n    {$IFDEF LCLLIB}\r\n    class operator *(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix;\r\n    class operator *(const APoint: TPointF; const AMatrix: TTMSFNCGraphicsMatrix): TPointF;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    class operator Multiply(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix;\r\n    class operator Multiply(const APoint: TPointF; const AMatrix: TTMSFNCGraphicsMatrix): TPointF;\r\n    {$ENDIF}\r\n\r\n    function Determinant: Single;\r\n    function Adjoint: TTMSFNCGraphicsMatrix;\r\n    function Inverse: TTMSFNCGraphicsMatrix;\r\n\r\n    case Integer of\r\n      0: (M: TTMSFNCGraphicsMatrixArray;);\r\n      1: (m11, m12, m13: Single;\r\n          m21, m22, m23: Single;\r\n          m31, m32, m33: Single);\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCGraphicsMatrix = record\r\n    m11, m12, m13: Single;\r\n    m21, m22, m23: Single;\r\n    m31, m32, m33: Single;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCGraphicsPathPolygon = array of TPointF;\r\n\r\n  TTMSFNCGraphicsPathPointKind = (gppMoveTo, gppLineTo, gppCurveTo, gppClose);\r\n\r\n  TTMSFNCGraphicsPathCubicBezier = array[0..3] of TPointF;\r\n\r\n  TTMSFNCGraphicsPathPoint = record\r\n    Kind: TTMSFNCGraphicsPathPointKind;\r\n    {$HINTS OFF}\r\n    {$WARNINGS OFF}\r\n    {$IF FPC_FULLVERSION < 30000}\r\n    Dummy: Boolean;\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    {$WARNINGS ON}\r\n    Point: TPointF;\r\n    {$IFDEF LCLLIB}\r\n    class operator = (z1, z2 : TTMSFNCGraphicsPathPoint) b : Boolean;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  TTMSFNCGraphicsPathDrawMode = (pdmPolygon, pdmPolyline);\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCGraphicsPathPoints = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCGraphicsPathPoint;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCGraphicsPathPoint);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCGraphicsPathPoint read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCGraphicsPathPoints = class(TList<TTMSFNCGraphicsPathPoint>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCGraphicsPath = class(TPersistent)\r\n  private\r\n    FStartPoint: TPointF;\r\n    FClippable: Boolean;\r\n    FPoints: TTMSFNCGraphicsPathPoints;\r\n    procedure CalculateBezierCoefficients(const Bezier: TTMSFNCGraphicsPathCubicBezier; out AX, BX, CX, AY, BY, CY: Single);\r\n    function GetCount: Integer;\r\n    function GetPoint(AIndex: Integer): TTMSFNCGraphicsPathPoint;\r\n  public\r\n    constructor Create; virtual;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function LastPoint: TPointF;\r\n    function IsPointVisible(const P: TPointF): Boolean;\r\n    function IsRectVisible(const R: TRectF): Boolean;\r\n    function PointOnBezier(const StartPoint: TPointF; const AX, BX, CX, AY, BY, CY, T: Single): TPointF;\r\n    function CreateBezier(const Bezier: TTMSFNCGraphicsPathCubicBezier; const PointCount: Integer): TTMSFNCGraphicsPathPolygon;\r\n    function GetBounds: TRectF;\r\n    function IsClippable: Boolean;\r\n    procedure MoveTo(const P: TPointF);\r\n    procedure LineTo(const P: TPointF);\r\n    procedure CurveTo(const ControlPoint1, ControlPoint2, EndPoint: TPointF);\r\n    procedure SmoothCurveTo(const ControlPoint2, EndPoint: TPointF);\r\n    procedure QuadCurveTo(const ControlPoint, EndPoint: TPointF);\r\n    procedure AddPolygon(const APolygon: TTMSFNCGraphicsPathPolygon);\r\n    procedure ClosePath;\r\n    procedure AddLine(const StartPoint, EndPoint: TPointF);\r\n    procedure AddEllipse(const ARect: TRectF);\r\n    procedure AddRectangle(const ARect: TRectF);\r\n    procedure AddArc(const Center, Radius: TPointF; StartAngle, SweepAngle: Single);\r\n    procedure AddPath(APath: TTMSFNCGraphicsPath);\r\n    procedure ApplyMatrix(AMatrix: TTMSFNCGraphicsMatrix);\r\n    procedure Clear;\r\n    procedure Flatten(const Flatness: Single = 0.25);\r\n    procedure FlattenToPolygon(var Polygon: TTMSFNCGraphicsPathPolygon; const Flatness: Single = 0.25);\r\n    property Count: Integer read GetCount;\r\n    property Points[AIndex: Integer]: TTMSFNCGraphicsPathPoint read GetPoint; default;\r\n    property PathData: TTMSFNCGraphicsPathPoints read FPoints;\r\n    property Clippable: Boolean read FClippable write FClippable;\r\n  end;\r\n\r\n  TTMSFNCGraphicsColorObject = class\r\n  private\r\n    FColor: TTMSFNCGraphicsColor;\r\n  public\r\n    constructor Create(AColor: TTMSFNCGraphicsColor);\r\n    property Color: TTMSFNCGraphicsColor read FColor write FColor;\r\n  end;\r\n\r\n  TTMSFNCGraphicsModifyRectMode = (gcrmNone, gcrmExpandAll, gcrmShrinkAll, gcrmShiftRightAndExpandHeight, gcrmShiftDownAndExpandWidth,\r\n    gcrmShiftRightAndShrinkHeight, gcrmShiftRightDown, gcrmShiftRightUp, gcrmShiftLeftUp, gcrmShiftLeftDown, gcrmShiftUpAndExpandWidth,\r\n    gcrmShiftLeftAndExpandHeight);\r\n  TTMSFNCGraphicsModifyPointMode = (gcpmNone, gcpmLeftUp, gcpmRightDown, gcpmLeftDown, gcpmRightUp);\r\n  TTMSFNCGraphicsExpanderState = (gesCollapsed, gesExpanded);\r\n  TTMSFNCGraphicsCompactState = (gcsCollapsed, gcsExpanded);\r\n\r\n  TTMSFNCGraphicsCorner = (gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight);\r\n  TTMSFNCGraphicsCorners = set of TTMSFNCGraphicsCorner;\r\n\r\nfunction ModifyRect(const ARect: TRectF; const {%H-}ARectMode: TTMSFNCGraphicsModifyRectMode): TRectF;\r\nfunction ModifyPoint(const APoint: TPointF; const {%H-}APointMode: TTMSFNCGraphicsModifyPointMode): TPointF;\r\nfunction MakeGraphicsColor(ARed, AGreen, ABlue: Byte{$IFDEF FMXLIB};AAlpha: Byte = 255{$ENDIF}): TTMSFNCGraphicsColor;\r\nfunction Lighter(AColor: TTMSFNCGraphicsColor; APercent: Byte): TTMSFNCGraphicsColor;\r\nfunction Darker(AColor: TTMSFNCGraphicsColor; APercent: Byte): TTMSFNCGraphicsColor;\r\nfunction Blend(AColor1: TTMSFNCGraphicsColor; AColor2: TTMSFNCGraphicsColor; ALevel: Byte): TTMSFNCGraphicsColor;\r\nfunction ColorLookup: TStringList;\r\nfunction PointInPoly(APoint: TPointF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nfunction RectInPoly(ARect: TRectF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nfunction PolyInRect(APolygon: TTMSFNCGraphicsPathPolygon; ARect: TRectF): Boolean;\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\nprocedure DrawGradient(ACanvas: TCanvas; AColor, AColorTo: TColor; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; ADirection: Boolean);\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nprocedure DrawGradient(ACanvas: TCanvas; AColor, AColorTo: TColor; ARect: TRect; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; ADirection: Boolean);\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\nfunction MatrixIdentity: TTMSFNCGraphicsMatrix;\r\nfunction MatrixCreateRotation(const AAngle: Single): TTMSFNCGraphicsMatrix;\r\nfunction MatrixCreateScaling(const AScaleX, AScaleY: Single): TTMSFNCGraphicsMatrix;\r\nfunction MatrixCreateTranslation(const ADeltaX, ADeltaY: Single): TTMSFNCGraphicsMatrix;\r\nfunction MatrixMultiply(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix; overload;\r\nfunction MatrixMultiply(const APoint: TPointF; const AMatrix: TTMSFNCGraphicsMatrix): TPointF; overload;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.TMSFNCUtils, SysUtils, Math\r\n  {$IFDEF FMXLIB}\r\n  ,UIConsts\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFNDEF MSWINDOWS}\r\n  ,LCLIntF\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\nvar\r\n  FColorLookup: TStringList;\r\n\r\nfunction MatrixIdentity: TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result.m11 := 1;\r\n  Result.m12 := 0;\r\n  Result.m13 := 0;\r\n  Result.m21 := 0;\r\n  Result.m22 := 1;\r\n  Result.m23 := 0;\r\n  Result.m31 := 0;\r\n  Result.m32 := 0;\r\n  Result.m33 := 1;\r\nend;\r\n\r\nfunction MatrixCreateRotation(const AAngle: Single): TTMSFNCGraphicsMatrix;\r\nvar\r\n  S, C: Single;\r\nbegin\r\n  S := Sin(AAngle);\r\n  C := Cos(AAngle);\r\n  Result := MatrixIdentity;\r\n  Result.m11 := C;\r\n  Result.m12 := S;\r\n  Result.m21 := -S;\r\n  Result.m22 := C;\r\nend;\r\n\r\nfunction MatrixCreateScaling(const AScaleX, AScaleY: Single): TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result := MatrixIdentity;\r\n  Result.m11 := AScaleX;\r\n  Result.m22 := AScaleY;\r\nend;\r\n\r\nfunction MatrixCreateTranslation(const ADeltaX, ADeltaY: Single): TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result := MatrixIdentity;\r\n  Result.m31 := ADeltaX;\r\n  Result.m32 := ADeltaY;\r\nend;\r\n\r\nfunction MatrixMultiply(const APoint: TPointF; const AMatrix: TTMSFNCGraphicsMatrix): TPointF;\r\nbegin\r\n  Result.X := APoint.X * AMatrix.m11 + APoint.Y * AMatrix.m21 + AMatrix.m31;\r\n  Result.Y := APoint.X * AMatrix.m12 + APoint.Y * AMatrix.m22 + AMatrix.m32;\r\nend;\r\n\r\nfunction MatrixMultiply(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result.m11 := AMatrix1.m11 * AMatrix2.m11 + AMatrix1.m12 * AMatrix2.m21 + AMatrix1.m13 * AMatrix2.m31;\r\n  Result.m12 := AMatrix1.m11 * AMatrix2.m12 + AMatrix1.m12 * AMatrix2.m22 + AMatrix1.m13 * AMatrix2.m32;\r\n  Result.m13 := AMatrix1.m11 * AMatrix2.m13 + AMatrix1.m12 * AMatrix2.m23 + AMatrix1.m13 * AMatrix2.m33;\r\n  Result.m21 := AMatrix1.m21 * AMatrix2.m11 + AMatrix1.m22 * AMatrix2.m21 + AMatrix1.m23 * AMatrix2.m31;\r\n  Result.m22 := AMatrix1.m21 * AMatrix2.m12 + AMatrix1.m22 * AMatrix2.m22 + AMatrix1.m23 * AMatrix2.m32;\r\n  Result.m23 := AMatrix1.m21 * AMatrix2.m13 + AMatrix1.m22 * AMatrix2.m23 + AMatrix1.m23 * AMatrix2.m33;\r\n  Result.m31 := AMatrix1.m31 * AMatrix2.m11 + AMatrix1.m32 * AMatrix2.m21 + AMatrix1.m33 * AMatrix2.m31;\r\n  Result.m32 := AMatrix1.m31 * AMatrix2.m12 + AMatrix1.m32 * AMatrix2.m22 + AMatrix1.m33 * AMatrix2.m32;\r\n  Result.m33 := AMatrix1.m31 * AMatrix2.m13 + AMatrix1.m32 * AMatrix2.m23 + AMatrix1.m33 * AMatrix2.m33;\r\nend;\r\n\r\nfunction ModifyRect(const ARect: TRectF; const ARectMode: TTMSFNCGraphicsModifyRectMode): TRectF;\r\nbegin\r\n  Result := ARect;\r\n  {$IFDEF FMXWEBLIB}\r\n  case ARectMode of\r\n    gcrmExpandAll: Result := RectF(int(Result.Left) - 0.5, int(Result.Top) - 0.5, int(Result.Right) + 0.5, int(Result.Bottom) + 0.5);\r\n    gcrmShrinkAll: Result := RectF(int(Result.Left) + 0.5, int(Result.Top) + 0.5, int(Result.Right) - 0.5, int(Result.Bottom) - 0.5);\r\n    gcrmShiftRightAndExpandHeight: Result := RectF(int(Result.Left) + 0.5, int(Result.Top) - 0.5, int(Result.Right) + 0.5, int(Result.Bottom) + 0.5);\r\n    gcrmShiftRightDown: Result := RectF(int(Result.Left) + 0.5, int(Result.Top) + 0.5, int(Result.Right) + 0.5, int(Result.Bottom) + 0.5);\r\n    gcrmShiftRightAndShrinkHeight: Result := RectF(int(Result.Left) + 0.5, int(Result.Top) + 0.5, int(Result.Right) + 0.5, int(Result.Bottom) - 0.5);\r\n    gcrmShiftDownAndExpandWidth: Result := RectF(int(Result.Left) - 0.5, int(Result.Top) + 0.5, int(Result.Right) + 0.5, int(Result.Bottom) + 0.5);\r\n    gcrmShiftUpAndExpandWidth: Result := RectF(int(Result.Left) - 0.5, int(Result.Top) - 0.5, int(Result.Right) + 0.5, int(Result.Bottom) - 0.5);\r\n    gcrmShiftRightUp: Result := RectF(Int(Result.Left) + 0.5, Int(Result.Top) - 0.5, Int(Result.Right) + 0.5, Int(Result.Bottom) - 0.5);\r\n    gcrmShiftLeftUp: Result := RectF(Int(Result.Left) - 0.5, Int(Result.Top) - 0.5, Int(Result.Right) - 0.5, Int(Result.Bottom) - 0.5);\r\n    gcrmShiftLeftDown: Result := RectF(Int(Result.Left) - 0.5, Int(Result.Top) + 0.5, Int(Result.Right) - 0.5, Int(Result.Bottom) + 0.5);\r\n    gcrmShiftLeftAndExpandHeight: Result := RectF(int(Result.Left) - 0.5, int(Result.Top) - 0.5, int(Result.Right) - 0.5, int(Result.Bottom) + 0.5);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction ModifyPoint(const APoint: TPointF; const APointMode: TTMSFNCGraphicsModifyPointMode): TPointF;\r\nbegin\r\n  Result := APoint;\r\n  {$IFDEF FMXWEBLIB}\r\n  case APointMode of\r\n    gcpmRightDown: Result := PointF(Int(Result.X) + 0.5, Int(Result.Y) + 0.5);\r\n    gcpmLeftUp: Result := PointF(Int(Result.X) - 0.5, Int(Result.Y) - 0.5);\r\n    gcpmRightUp: Result := PointF(Int(Result.X) + 0.5, Int(Result.Y) - 0.5);\r\n    gcpmLeftDown: Result := PointF(Int(Result.X) - 0.5, Int(Result.Y) + 0.5);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction ColorLookup: TStringList;\r\nbegin\r\n  Result := FColorLookup;\r\nend;\r\n\r\nfunction PolyInRect(APolygon: TTMSFNCGraphicsPathPolygon; ARect: TRectF): Boolean;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Length(APolygon) - 1 do\r\n  begin\r\n    if PtInRectEx(ARect, APolygon[I]) then\r\n    begin\r\n      Result := True;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction RectInPoly(ARect: TRectF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nbegin\r\n  Result := PointInPoly(PointF(ARect.Left, ARect.Top), APolygon)\r\n    or PointInPoly(PointF(ARect.Right, ARect.Top), APolygon)\r\n    or PointInPoly(PointF(ARect.Left, ARect.Bottom), APolygon)\r\n    or PointInPoly(PointF(ARect.Right, ARect.Bottom), APolygon);\r\nend;\r\n\r\nfunction PointInPoly(APoint: TPointF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nvar\r\n  minX, maxX, minY, maxY: Double;\r\n  I, J: Integer;\r\n  q: TPointF;\r\n  pt, ptn: TPointF;\r\n  inside, chk: Boolean;\r\n  calc: Double;\r\n  chkc: Boolean;\r\nbegin\r\n  Result := False;\r\n  if Length(APolygon) = 0 then\r\n    Exit;\r\n\r\n  minX := APolygon[0].X;\r\n  maxX := APolygon[0].X;\r\n  minY := APolygon[0].Y;\r\n  maxY := APolygon[0].Y;\r\n\r\n  for I := 1 to Length(APolygon) - 1 do\r\n  begin\r\n    q := APolygon[I];\r\n    minX := Min(q.X, minX);\r\n    maxX := Max(q.X, maxX);\r\n    minY := Min(q.Y, minY);\r\n    maxY := Max(q.Y, maxY);\r\n  end;\r\n\r\n  if (APoint.X < minX) or (APoint.X > maxX) or (APoint.Y < minY) or (APoint.Y > maxY) then\r\n  begin\r\n    Result := False;\r\n    Exit;\r\n  end;\r\n\r\n  inside := False;\r\n  J := Length(APolygon) - 1;\r\n  for I := 0 to Length(APolygon) - 1 do\r\n  begin\r\n    pt := APolygon[I];\r\n    ptn := APolygon[J];\r\n    chk := (pt.Y > APoint.Y) <> (ptn.Y > APoint.Y);\r\n    if (ptn.Y - pt.Y) <> 0 then\r\n    begin\r\n      calc := (ptn.X - pt.X) * (APoint.Y - pt.Y) / (ptn.Y - pt.Y) + pt.X;\r\n      chkc := APoint.X < calc;\r\n      if chk and chkc then\r\n        inside := not inside;\r\n    end;\r\n\r\n    j := I;\r\n  end;\r\n  Result := inside;\r\nend;\r\n\r\nfunction Blend(AColor1: TTMSFNCGraphicsColor; AColor2: TTMSFNCGraphicsColor; ALevel: Byte): TTMSFNCGraphicsColor;\r\nvar\r\n  c1, c2: LongInt;\r\n  r, g, b, v1, v2: byte;\r\nbegin\r\n  ALevel := Round(2.55 * ALevel);\r\n  {$IFDEF CMNWEBLIB}\r\n  c1 := ColorToRGB(AColor1);\r\n  c2 := ColorToRGB(AColor2);\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  c1 := AColor1;\r\n  c2 := AColor2;\r\n  {$ENDIF}\r\n  v1 := Byte(c1);\r\n  v2 := Byte(c2);\r\n  r := Max(0, Min(255, ALevel * (v1 - v2) shr 8 + v2));\r\n  v1 := Byte(c1 shr 8);\r\n  v2 := Byte(c2 shr 8);\r\n  g := Max(0, Min(255, ALevel * (v1 - v2) shr 8 + v2));\r\n  v1 := Byte(c1 shr 16);\r\n  v2 := Byte(c2 shr 16);\r\n  b := Max(0, Min(255, ALevel * (v1 - v2) shr 8 + v2));\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := (b shl 16) + (g shl 8) + r;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  Result := MakeGraphicsColor(r, g, b);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction Lighter(AColor: TTMSFNCGraphicsColor; APercent: Byte): TTMSFNCGraphicsColor;\r\nvar\r\n  r, g, b: Byte;\r\nbegin\r\n  {$IFDEF CMNWEBLIB}\r\n  AColor := ColorToRGB(AColor);\r\n  r := GetRValue(AColor);\r\n  g := GetGValue(AColor);\r\n  b := GetBValue(AColor);\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  r := TAlphaColorRec(AColor).R;\r\n  g := TAlphaColorRec(AColor).G;\r\n  b := TAlphaColorRec(AColor).B;\r\n  {$ENDIF}\r\n\r\n  r := r + Min(255, TTMSFNCUtils.MulDivInt(255 - r, APercent, 100));\r\n  g := g + Min(255, TTMSFNCUtils.MulDivInt(255 - g, APercent, 100));\r\n  b := b + Min(255, TTMSFNCUtils.MulDivInt(255 - b, APercent, 100));\r\n\r\n  {$IFDEF FMXLIB}\r\n  Result := MakeGraphicsColor(r, g, b, TAlphaColorRec(AColor).A);\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := MakeGraphicsColor(r, g, b);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction Darker(AColor: TTMSFNCGraphicsColor; APercent: Byte): TTMSFNCGraphicsColor;\r\nvar\r\n  r, g, b: Byte;\r\nbegin\r\n  {$IFDEF CMNWEBLIB}\r\n  AColor := ColorToRGB(AColor);\r\n  r := GetRValue(AColor);\r\n  g := GetGValue(AColor);\r\n  b := GetBValue(AColor);\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  r := TAlphaColorRec(AColor).R;\r\n  g := TAlphaColorRec(AColor).G;\r\n  b := TAlphaColorRec(AColor).B;\r\n  {$ENDIF}\r\n\r\n  r := r - Max(0, TTMSFNCUtils.MulDivInt(255 - r, APercent, 100));\r\n  g := g - Max(0, TTMSFNCUtils.MulDivInt(255 - g, APercent, 100));\r\n  b := b - Max(0, TTMSFNCUtils.MulDivInt(255 - b, APercent, 100));\r\n\r\n  {$IFDEF FMXLIB}\r\n  Result := MakeGraphicsColor(r, g, b, TAlphaColorRec(AColor).A);\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := MakeGraphicsColor(r, g, b);\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\nprocedure DrawGradient(ACanvas: TCanvas; AColor, AColorTo: TColor;\r\n  ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; ADirection: Boolean);\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nprocedure DrawGradient(ACanvas: TCanvas; AColor, AColorTo: TColor;\r\n  ARect: TRect; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; ADirection: Boolean);\r\n{$ENDIF}\r\nvar\r\n  diffr,startr,endr: Integer;\r\n  diffg,startg,endg: Integer;\r\n  diffb,startb,endb: Integer;\r\n  si: Integer;\r\n  rstepr,rstepg,rstepb,rstepw: Single;\r\n  i,stepw: Word;\r\n  oldp, oldb: TColor;\r\n  Steps: Integer;\r\n  {$IFDEF WEBLIB}\r\n  R, dr: TRectF;\r\n  iend: Single;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  R, dr: TRect;\r\n  iend: Integer;\r\n  {$ENDIF}\r\n  a: Single;\r\n  oldps: TPenStyle;\r\n  oldbs: TBrushStyle;\r\nbegin\r\n  R := ARect;\r\n\r\n  {$IFDEF WEBLIB}\r\n  if ADirection then\r\n    Steps := Round(R.Right - R.Left)\r\n  else\r\n    Steps := Round(R.Bottom - R.Top);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  if ADirection then\r\n    Steps := R.Right - R.Left\r\n  else\r\n    Steps := R.Bottom - R.Top;\r\n  {$ENDIF}\r\n\r\n  if Steps = 0 then\r\n    Steps := 1;\r\n\r\n  AColor := ColorToRGB(AColor);\r\n  AColorTo := ColorToRGB(AColorTo);\r\n\r\n  startr := (AColor and $0000FF);\r\n  startg := (AColor and $00FF00) shr 8;\r\n  startb := (AColor and $FF0000) shr 16;\r\n\r\n  endr := (AColorTo and $0000FF);\r\n  endg := (AColorTo and $00FF00) shr 8;\r\n  endb := (AColorTo and $FF0000) shr 16;\r\n\r\n  diffr := endr - startr;\r\n  diffg := endg - startg;\r\n  diffb := endb - startb;\r\n\r\n  rstepr := diffr / steps;\r\n  rstepg := diffg / steps;\r\n  rstepb := diffb / steps;\r\n\r\n  if ADirection then\r\n    rstepw := (R.Right - R.Left) / Steps\r\n  else\r\n    rstepw := (R.Bottom - R.Top) / Steps;\r\n\r\n  with ACanvas do\r\n  begin\r\n    oldb := Brush.Color;\r\n    oldbs := Brush.Style;\r\n    oldp := Pen.Color;\r\n    oldps := Pen.Style;\r\n    Pen.Style := psSolid;\r\n    Brush.Style := bsSolid;\r\n    for i := 0 to Steps - 1 do\r\n    begin\r\n      endr := startr + Round(rstepr*i);\r\n      endg := startg + Round(rstepg*i);\r\n      endb := startb + Round(rstepb*i);\r\n      stepw := Round(i*rstepw);\r\n      Pen.Color := endr + (endg shl 8) + (endb shl 16);\r\n      Brush.Color := Pen.Color;\r\n\r\n      if ADirection then\r\n      begin\r\n        si := Trunc(rstepw);\r\n        iend := R.Left + stepw + si;\r\n        iend := Min(iend, R.Right);\r\n\r\n        dr := r;\r\n\r\n        if (I <= ARounding) and ((gcTopLeft in ACorners) or (gcBottomLeft in ACorners)) then\r\n        begin\r\n          a := SQRT(Power(ARounding, 2) - Power(ARounding - I, 2));\r\n\r\n          if (gcTopLeft in ACorners) then\r\n            dr.Top := dr.Top + Round(ARounding - a);\r\n\r\n          if (gcBottomLeft in ACorners) then\r\n            dr.Bottom := dr.Bottom - Round(ARounding - a);\r\n        end\r\n        else if (I >= Steps - ARounding) and ((gcBottomRight in ACorners) or (gcTopRight in ACorners)) then\r\n        begin\r\n          a := SQRT(Power(ARounding, 2) - Power(ARounding - (Steps - I), 2));\r\n\r\n          if (gcTopRight in ACorners) then\r\n            dr.Top := dr.Top + Round(ARounding - a);\r\n\r\n          if (gcBottomRight in ACorners) then\r\n            dr.Bottom := dr.Bottom - Round(ARounding - a);\r\n        end;\r\n\r\n        Rectangle(dr.Left + stepw, dr.Top, iend, dr.Bottom)\r\n      end\r\n      else\r\n      begin\r\n        si := Trunc(rstepw);\r\n        iend := R.Top + stepw + si;\r\n        iend := Min(iend, r.Bottom);\r\n\r\n        dr := r;\r\n\r\n        if (I <= ARounding) and ((gcTopLeft in ACorners) or (gcTopRight in ACorners)) then\r\n        begin\r\n          a := SQRT(Power(ARounding, 2) - Power(ARounding - I, 2));\r\n\r\n          if (gcTopLeft in ACorners) then\r\n            dr.Left := dr.Left + Round(ARounding - a);\r\n\r\n          if (gcTopRight in ACorners) then\r\n            dr.Right := dr.Right - Round(ARounding - a);\r\n        end\r\n        else if (I >= Steps - ARounding) and ((gcBottomLeft in ACorners) or (gcBottomRight in ACorners)) then\r\n        begin\r\n          a := SQRT(Power(ARounding, 2) - Power(ARounding - (Steps - I), 2));\r\n\r\n          if (gcBottomLeft in ACorners) then\r\n            dr.Left := dr.Left + Round(ARounding - a);\r\n\r\n          if (gcBottomRight in ACorners) then\r\n            dr.Right := dr.Right - Round(ARounding - a);\r\n        end;\r\n\r\n        Rectangle(dr.Left, dr.Top + stepw, dr.Right, iend);\r\n      end;\r\n    end;\r\n    Brush.Color := oldb;\r\n    Brush.Style := oldbs;\r\n    Pen.Color := oldp;\r\n    Pen.style := oldps;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nfunction MakeGraphicsColor(ARed, AGreen, ABlue: Byte{$IFDEF FMXLIB};AAlpha: Byte = 255{$ENDIF}): TTMSFNCGraphicsColor;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := MakeColor(ARed, AGreen, ABlue, AAlpha);\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  Result := RGB(ARed, AGreen, ABlue);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := RGBToColor(ARed, AGreen, ABlue);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Result := RGB(ARed, AGreen, ABlue);\r\n  {$ENDIF}\r\nend;\r\n\r\n{ TTMSFNCGraphicsFont }\r\n\r\nprocedure TTMSFNCGraphicsFont.BeginUpdate;\r\nbegin\r\n  Inc(FUpdateCount);\r\nend;\r\n\r\nconstructor TTMSFNCGraphicsFont.Create;\r\nbegin\r\n  inherited Create;\r\n  {$IFDEF FMXLIB}\r\n  FColor := gcBlack;\r\n  inherited OnChanged := DoChanged;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  OnChange := @DoChanged;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsFont.EndUpdate;\r\nbegin\r\n  Dec(FUpdateCount);\r\n  DoChanged(Self);\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF LCLLIB}\r\nprocedure TTMSFNCGraphicsFont.Changed;\r\nbegin\r\n  inherited;\r\n  DoChanged(Self);\r\nend;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCGraphicsFont.DoChanged(Sender: TObject);\r\nbegin\r\n  if Assigned(OnChanged) and (FUpdateCount = 0) then\r\n    OnChanged(Self);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsFont.AssignSource(Source: TPersistent);\r\nbegin\r\n  Assign(Source);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsFont.Assign(Source: TPersistent);\r\nbegin\r\n  inherited Assign(Source);\r\n  {$IFDEF FMXLIB}\r\n  if Source is TTMSFNCGraphicsFont then\r\n    FColor := (Source as TTMSFNCGraphicsFont).Color;\r\n  {$ENDIF}\r\n  DoChanged(Self);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCGraphicsFont.SetName(const Value: string);\r\nbegin\r\n  Family := Value;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsFont.GetName: string;\r\nbegin\r\n  Result := Family;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsFont.SetColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColor <> Value then\r\n  begin\r\n    FColor := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColor = clNone then\r\n      FColor := gcNull\r\n    else if FColor = clDefault then\r\n      FColor := clBtnFace;\r\n    {$ENDIF}\r\n    DoChanged(Self);\r\n  end;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\n{ TTMSFNCGraphicsSaveState }\r\n\r\nconstructor TTMSFNCGraphicsSaveState.Create;\r\nbegin\r\n  inherited;\r\n  FFill := TTMSFNCGraphicsFill.Create;\r\n  FStroke := TTMSFNCGraphicsStroke.Create;\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\nend;\r\n\r\ndestructor TTMSFNCGraphicsSaveState.Destroy;\r\nbegin\r\n  FFill.Free;\r\n  FStroke.Free;\r\n  FFont.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsSaveState.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsSaveState.SetFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  FFont.AssignSource(Value);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsSaveState.SetStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FStroke.Assign(Value);\r\nend;\r\n\r\n{ TTMSFNCCustomGraphicsFill }\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomGraphicsFill then\r\n  begin\r\n    FColor := (Source as TTMSFNCCustomGraphicsFill).Color;\r\n    FColorTo := (Source as TTMSFNCCustomGraphicsFill).ColorTo;\r\n    FColorMirror := (Source as TTMSFNCCustomGraphicsFill).ColorMirror;\r\n    FColorMirrorTo := (Source as TTMSFNCCustomGraphicsFill).ColorMirrorTo;\r\n    FKind := (Source as TTMSFNCCustomGraphicsFill).Kind;\r\n    FOrientation := (Source as TTMSFNCCustomGraphicsFill).Orientation;\r\n    FOpacity := (Source as TTMSFNCCustomGraphicsFill).Opacity;\r\n    FTexture.Assign((Source as TTMSFNCCustomGraphicsFill).Texture);\r\n    FTextureMode := (Source as TTMSFNCCustomGraphicsFill).TextureMode;\r\n  end\r\n  else if Source is TTMSFNCCustomGraphicsStroke then\r\n  begin\r\n    FColor := (Source as TTMSFNCCustomGraphicsStroke).Color;\r\n    FColorTo := gcNull;\r\n    FColorMirror := gcNull;\r\n    FColorMirrorTo := gcNull;\r\n    FKind := gfkSolid;\r\n    FOrientation := gfoVertical;\r\n    FOpacity := 1;\r\n  end;\r\n  Changed;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.Changed;\r\nbegin\r\n  if Assigned(OnChanged) and (FUpdateCount = 0) then\r\n    OnChanged(Self);\r\nend;\r\n\r\nconstructor TTMSFNCCustomGraphicsFill.Create(const AKind: TTMSFNCGraphicsFillKind = gfkSolid; const AColor: TTMSFNCGraphicsColor = gcWhite);\r\nbegin\r\n  FKind := AKind;\r\n  FColor := AColor;\r\n  FOpacity := 1;\r\n  FOrientation := gfoVertical;\r\n  FColorTo := gcGray;\r\n  FColorMirror := gcNull;\r\n  FColorMirrorTo := gcNull;\r\n  FTextureMode := gtmStretch;\r\n  FTexture := TTMSFNCBitmap.Create;\r\n  FTexture.OnChange := @TextureChanged;\r\nend;\r\n\r\ndestructor TTMSFNCCustomGraphicsFill.Destroy;\r\nbegin\r\n  FTexture.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.EndUpdate;\r\nbegin\r\n  Dec(FUpdateCount);\r\n  Changed;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColor <> Value then\r\n  begin\r\n    FColor := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColor = clNone then\r\n      FColor := gcNull\r\n    else if FColor = clDefault then\r\n      FColor := clBtnFace;\r\n    {$ENDIF}\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetColorTo(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColorTo <> Value then\r\n  begin\r\n    FColorTo := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColorTo = clNone then\r\n      FColorTo := gcNull\r\n    else if FColorTo = clDefault then\r\n      FColorTo := clBtnFace;\r\n    {$ENDIF}\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetColorMirror(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColorMirror <> Value then\r\n  begin\r\n    FColorMirror := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColorMirror = clNone then\r\n      FColorMirror := gcNull\r\n    else if FColorMirror = clDefault then\r\n      FColorMirror := clBtnFace;\r\n    {$ENDIF}\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetColorMirrorTo(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColorMirrorTo <> Value then\r\n  begin\r\n    FColorMirrorTo := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColorMirrorTo = clNone then\r\n      FColorMirrorTo := gcNull\r\n    else if FColorMirrorTo = clDefault then\r\n      FColorMirrorTo := clBtnFace;\r\n    {$ENDIF}\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetKind(const Value: TTMSFNCGraphicsFillKind);\r\nbegin\r\n  if FKind <> Value then\r\n  begin\r\n    FKind := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetOrientation(const Value: TTMSFNCGraphicsFillOrientation);\r\nbegin\r\n  if FOrientation <> Value then\r\n  begin\r\n    FOrientation := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetTexture(const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FTexture <> Value then\r\n  begin\r\n    FTexture.Assign(Value);\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetTextureMode(\r\n  const Value: TTMSFNCGraphicsTextureMode);\r\nbegin\r\n  if FTextureMode <> Value then\r\n  begin\r\n    FTextureMode := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.TextureChanged(Sender: TObject);\r\nbegin\r\n  Changed;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsFill.SetOpacity(const Value: Single);\r\nbegin\r\n  if FOpacity <> Value then\r\n  begin\r\n    FOpacity := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomGraphicsFill.IsOpacityStored: Boolean;\r\nbegin\r\n  Result := Opacity <> 1;\r\nend;\r\n\r\n{ TTMSFNCCustomGraphicsStroke }\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomGraphicsStroke then\r\n  begin\r\n    FColor := (Source as TTMSFNCCustomGraphicsStroke).Color;\r\n    FKind := (Source as TTMSFNCCustomGraphicsStroke).Kind;\r\n    FOpacity := (Source as TTMSFNCCustomGraphicsStroke).Opacity;\r\n    FWidth := (Source as TTMSFNCCustomGraphicsStroke).Width;\r\n  end\r\n  else if Source is TTMSFNCCustomGraphicsFill then\r\n  begin\r\n    FColor := (Source as TTMSFNCCustomGraphicsFill).Color;\r\n    FKind := gskSolid;\r\n    FOpacity := 1;\r\n    FWidth := 1;\r\n  end;\r\n  Changed;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.BeginUpdate;\r\nbegin\r\n  Inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.Changed;\r\nbegin\r\n  if Assigned(OnChanged) and (FUpdateCount = 0) then\r\n    OnChanged(Self);\r\nend;\r\n\r\nconstructor TTMSFNCCustomGraphicsStroke.Create(const AKind: TTMSFNCGraphicsStrokeKind = gskSolid; const AColor: TTMSFNCGraphicsColor = gcSilver);\r\nbegin\r\n  FKind := AKind;\r\n  FColor := AColor;\r\n  FOpacity := 1;\r\n  FWidth := 1;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.EndUpdate;\r\nbegin\r\n  Dec(FUpdateCount);\r\n  Changed;\r\nend;\r\n\r\nfunction TTMSFNCCustomGraphicsStroke.IsWidthStored: Boolean;\r\nbegin\r\n  Result := Width <> 1;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.SetColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColor <> Value then\r\n  begin\r\n    FColor := Value;\r\n    {$IFDEF CMNWEBLIB}\r\n    if FColor = clNone then\r\n      FColor := gcNull\r\n    else if FColor = clDefault then\r\n      FColor := clBtnFace;\r\n    {$ENDIF}\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.SetKind(const Value: TTMSFNCGraphicsStrokeKind);\r\nbegin\r\n  if FKind <> Value then\r\n  begin\r\n    FKind := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.SetOpacity(const Value: Single);\r\nbegin\r\n  if FOpacity <> Value then\r\n  begin\r\n    FOpacity := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomGraphicsStroke.IsOpacityStored: Boolean;\r\nbegin\r\n  Result := Opacity <> 1;\r\nend;\r\n\r\nprocedure TTMSFNCCustomGraphicsStroke.SetWidth(const Value: Single);\r\nbegin\r\n  if FWidth <> Value then\r\n  begin\r\n    FWidth := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCGraphicsPath }\r\n\r\nconstructor TTMSFNCGraphicsPath.Create;\r\nbegin\r\n  inherited Create;\r\n  FPoints := TTMSFNCGraphicsPathPoints.Create;\r\nend;\r\n\r\ndestructor TTMSFNCGraphicsPath.Destroy;\r\nbegin\r\n  FPoints.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.Assign(Source: TPersistent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Source is TTMSFNCGraphicsPath then\r\n  begin\r\n    FPoints.Count := TTMSFNCGraphicsPath(Source).Count;\r\n    for I := 0 to TTMSFNCGraphicsPath(Source).Count - 1 do\r\n      FPoints[I] := TTMSFNCGraphicsPath(Source)[I];\r\n  end\r\n  else\r\n    inherited\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.GetBounds: TRectF;\r\nconst\r\n  SmallAmount = 0.001;\r\nvar\r\n  I: Integer;\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  if PathData.Count < 1 then\r\n    Exit(RectF(0, 0, 0, 0));\r\n  Result := RectF($FFFF, $FFFF, -$FFFF, -$FFFF);\r\n  for I := 0 to PathData.Count - 1 do\r\n  begin\r\n    pt := PathData[I];\r\n    if pt.Kind = TTMSFNCGraphicsPathPointKind.gppClose then\r\n      Continue;\r\n\r\n    if pt.Point.X < Result.Left then\r\n      Result.Left := pt.Point.X;\r\n    if pt.Point.X > Result.Right then\r\n      Result.Right := pt.Point.X;\r\n    if pt.Point.Y < Result.Top then\r\n      Result.Top := pt.Point.Y;\r\n    if pt.Point.Y > Result.Bottom then\r\n      Result.Bottom := pt.Point.Y;\r\n  end;\r\n  // add small amount\r\n  {$IFDEF WEBLIB}\r\n  if SameValue(Result.Right - Result.Left, 0, SmallAmount) then\r\n    Result.Right := Result.Left + SmallAmount;\r\n  if SameValue(Result.Bottom - Result.Top, 0, SmallAmount) then\r\n    Result.Bottom := Result.Top + SmallAmount;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  if SameValue(Result.Width, 0, SmallAmount) then\r\n    Result.Right := Result.Left + SmallAmount;\r\n  if SameValue(Result.Height, 0, SmallAmount) then\r\n    Result.Bottom := Result.Top + SmallAmount;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.GetCount: Integer;\r\nbegin\r\n  Result := FPoints.Count;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.GetPoint(AIndex: Integer): TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  Result := TTMSFNCGraphicsPathPoint(FPoints[AIndex]);\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.IsClippable: Boolean;\r\nbegin\r\n  Result := FClippable;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.IsPointVisible(const P: TPointF): Boolean;\r\nvar\r\n  pt: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  SetLength(pt, 0);\r\n  FlattenToPolygon(pt);\r\n  Result := PointInPoly(p, pt);\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.IsRectVisible(const R: TRectF): Boolean;\r\nvar\r\n  pt: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  SetLength(pt, 0);\r\n  FlattenToPolygon(pt);\r\n  Result := PolyInRect(pt, R);\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.LastPoint: TPointF;\r\nbegin\r\n  if Count > 0 then\r\n    Result := FPoints[FPoints.Count - 1].Point\r\n  else\r\n  begin\r\n    Result := PointF(0, 0);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.MoveTo(const P: TPointF);\r\nvar\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  pt.Kind := gppMoveTo;\r\n  pt.Point := p;\r\n  FPoints.Add(pt);\r\n  FStartPoint := FPoints[FPoints.Count - 1].Point;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.LineTo(const P: TPointF);\r\nvar\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  pt.Kind := gppLineTo;\r\n  pt.Point := p;\r\n  FPoints.Add(pt);\r\n  if (P.X = FStartPoint.X) and (P.Y = FStartPoint.Y) then\r\n    FClippable := True;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.QuadCurveTo(const ControlPoint, EndPoint: TPointF);\r\nconst\r\n  OneThird = 1 / 3;\r\n  TwoThirds = 2 / 3;\r\nvar\r\n  LP, CP1, CP2: TPointF;\r\nbegin\r\n  LP := LastPoint;\r\n  CP1.X := OneThird * LP.X + TwoThirds * ControlPoint.X;\r\n  CP1.Y := OneThird * LP.Y + TwoThirds * ControlPoint.Y;\r\n  CP2.X := TwoThirds * ControlPoint.X + OneThird * EndPoint.X;\r\n  CP2.Y := TwoThirds * ControlPoint.Y + OneThird * EndPoint.Y;\r\n  CurveTo(CP1, CP2, EndPoint);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.CurveTo(const ControlPoint1, ControlPoint2, EndPoint: TPointF);\r\nvar\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  pt.Kind := gppCurveTo;\r\n  pt.Point := ControlPoint1;\r\n  FPoints.Add(pt);\r\n  pt.Kind := gppCurveTo;\r\n  pt.Point := ControlPoint2;\r\n  FPoints.Add(pt);\r\n  pt.Kind := gppCurveTo;\r\n  pt.Point := EndPoint;\r\n  FPoints.Add(pt);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.SmoothCurveTo(const ControlPoint2, EndPoint: TPointF);\r\nvar\r\n  ControlPoint1: TPointF;\r\nbegin\r\n  if Count > 2 then\r\n  begin\r\n    ControlPoint1.X := LastPoint.X + (LastPoint.X - FPoints[FPoints.Count - 2].Point.X);\r\n    ControlPoint1.Y := LastPoint.Y + (LastPoint.Y - FPoints[FPoints.Count - 2].Point.Y);\r\n  end\r\n  else\r\n    ControlPoint1 := ControlPoint2;\r\n  CurveTo(ControlPoint1, ControlPoint2, EndPoint);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.ClosePath;\r\nvar\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  pt.Kind := gppClose;\r\n  pt.Point := FStartPoint;\r\n  FPoints.Add(pt);\r\n  FClippable := True;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddPath(APath: TTMSFNCGraphicsPath);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  FPoints.Capacity := FPoints.Count + APath.Count;\r\n  for I := 0 to APath.Count - 1 do\r\n    FPoints.Add(APath.Points[I]);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddPolygon(\r\n  const APolygon: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to Length(APolygon) - 1 do\r\n    LineTo(APolygon[I]);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.Clear;\r\nbegin\r\n  FPoints.Clear;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.CalculateBezierCoefficients(const Bezier: TTMSFNCGraphicsPathCubicBezier; out AX, BX, CX, AY, BY, CY: Single);\r\nbegin\r\n  CX := 3 * (Bezier[1].X - Bezier[0].X);\r\n  CY := 3 * (Bezier[1].Y - Bezier[0].Y);\r\n  BX := 3 * (Bezier[2].X - Bezier[1].X) - CX;\r\n  BY := 3 * (Bezier[2].Y - Bezier[1].Y) - CY;\r\n  AX := Bezier[3].X - Bezier[0].X - CX - BX;\r\n  AY := Bezier[3].Y - Bezier[0].Y - CY - BY;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.PointOnBezier(const StartPoint: TPointF; const AX, BX, CX, AY, BY, CY, T: Single): TPointF;\r\nvar\r\n  SquareT, CubeT: Single;\r\nbegin\r\n  SquareT := T * T;\r\n  CubeT := SquareT * T;\r\n  Result.X := (AX * CubeT) + (BX * SquareT) + (CX * T) + StartPoint.X;\r\n  Result.Y := (AY * CubeT) + (BY * SquareT) + (CY * T) + StartPoint.Y;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsPath.CreateBezier(const Bezier: TTMSFNCGraphicsPathCubicBezier; const PointCount: Integer): TTMSFNCGraphicsPathPolygon;\r\nvar\r\n  AX, BX, CX, AY, BY, CY, DT, T: Single;\r\n  I: Integer;\r\nbegin\r\n  if PointCount = 0 then\r\n    Exit;\r\n  DT := 1 / (1 * PointCount - 1);\r\n  T := 0;\r\n  SetLength(Result, PointCount);\r\n  CalculateBezierCoefficients(Bezier, AX, BX, CX, AY, BY, CY);\r\n  for I := 0 to PointCount - 1 do\r\n  begin\r\n    Result[I] := PointOnBezier(Bezier[0], AX, BX, CX, AY, BY, CY, T);\r\n    T := T + DT;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.Flatten(const Flatness: Single);\r\nvar\r\n  J, I: Integer;\r\n  BPts: TTMSFNCGraphicsPathPolygon;\r\n  B: TTMSFNCGraphicsPathCubicBezier;\r\n  F, Len: Single;\r\n  SegCount: Integer;\r\n  OldPathData: TTMSFNCGraphicsPathPoints;\r\n  CurPoint: TPointF;\r\n  x: TPointF;\r\nbegin\r\n  if FPoints.Count > 0 then\r\n  begin\r\n    F := Max(Flatness, 0.05);\r\n    OldPathData := TTMSFNCGraphicsPathPoints.Create;\r\n    try\r\n      OldPathData.Count := FPoints.Count;\r\n      for J := 0 to FPoints.Count - 1 do\r\n        OldPathData.Add(FPoints[J]);\r\n      FPoints.Clear;\r\n      J := 0;\r\n      while J < OldPathData.Count do\r\n      begin\r\n        case OldPathData[J].Kind of\r\n          gppMoveTo:\r\n            begin\r\n              MoveTo(OldPathData[J].Point);\r\n              CurPoint := OldPathData[J].Point;\r\n            end;\r\n          gppLineTo:\r\n            begin\r\n              LineTo(OldPathData[J].Point);\r\n              CurPoint := OldPathData[J].Point;\r\n            end;\r\n          gppCurveTo:\r\n            begin\r\n              B[0] := CurPoint;\r\n              B[1] := OldPathData[J].Point;\r\n              Inc(J);\r\n              B[2] := OldPathData[J].Point;\r\n              Inc(J);\r\n              B[3] := OldPathData[J].Point;\r\n              BPts := CreateBezier(B, 6);\r\n              Len := 0;\r\n              for I := 0 to High(BPts) - 1 do\r\n              begin\r\n                x.X := BPts[I].X - BPts[I + 1].X;\r\n                x.Y := BPts[I].Y - BPts[I + 1].Y;\r\n                Len := Len + GetPointLength(x);\r\n              end;\r\n              SegCount := Round(Len / F);\r\n              if SegCount < 2 then\r\n                LineTo(B[3])\r\n              else\r\n              begin\r\n                BPts := CreateBezier(B, SegCount);\r\n                for I := 0 to High(BPts) do\r\n                  LineTo(BPts[I]);\r\n                CurPoint := OldPathData[J].Point;\r\n              end;\r\n            end;\r\n          gppClose:\r\n            ClosePath;\r\n        end;\r\n        Inc(J);\r\n      end;\r\n    finally\r\n      OldPathData.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.FlattenToPolygon(var Polygon: TTMSFNCGraphicsPathPolygon; const Flatness: Single = 0.25);\r\n\r\n  procedure AddPoint(const P: TPointF);\r\n  begin\r\n    if (Length(Polygon) > 0) and (SameValue(P.X, Polygon[High(Polygon)].X, PathPosition) and SameValue(P.Y,\r\n      Polygon[High(Polygon)].Y, PathPosition)) then\r\n      Exit;\r\n    SetLength(Polygon, Length(Polygon) + 1);\r\n    Polygon[High(Polygon)] := P;\r\n  end;\r\n\r\nvar\r\n  J, I: Integer;\r\n  BPts: TTMSFNCGraphicsPathPolygon;\r\n  B: TTMSFNCGraphicsPathCubicBezier;\r\n  SP, CurPoint, X: TPointF;\r\n  F, Len: Single;\r\n  SegCount: Integer;\r\nbegin\r\n  SetLength(Polygon, 0);\r\n  if FPoints.Count > 0 then\r\n  begin\r\n    F := Max(Flatness, 0.05);\r\n    J := 0;\r\n    while J < FPoints.Count do\r\n    begin\r\n      case FPoints[J].Kind of\r\n        gppMoveTo:\r\n          begin\r\n            if Length(Polygon) > 0 then\r\n              AddPoint(PointF($FFFFFF, $FFFFFF));\r\n            AddPoint(FPoints[J].Point);\r\n            CurPoint := FPoints[J].Point;\r\n            SP := CurPoint;\r\n          end;\r\n        gppLineTo:\r\n          begin\r\n            AddPoint(FPoints[J].Point);\r\n            CurPoint := FPoints[J].Point;\r\n          end;\r\n        gppCurveTo:\r\n          begin\r\n            B[0] := CurPoint;\r\n            B[1] := FPoints[J].Point;\r\n            Inc(J);\r\n            B[2] := FPoints[J].Point;\r\n            Inc(J);\r\n            B[3] := FPoints[J].Point;\r\n            BPts := CreateBezier(B, 6);\r\n            Len := 0;\r\n            for I := 0 to High(BPts) - 1 do\r\n            begin\r\n              x.X := BPts[I].X - BPts[I + 1].X;\r\n              x.Y := BPts[I].Y - BPts[I + 1].Y;\r\n              Len := Len + GetPointLength(x);\r\n            end;\r\n            SegCount := Round(Len / F);\r\n            if SegCount < 2 then\r\n            begin\r\n              AddPoint(B[0]);\r\n              AddPoint(B[3]);\r\n            end\r\n            else\r\n            begin\r\n              BPts := CreateBezier(B, SegCount);\r\n              for I := 0 to High(BPts) do\r\n                AddPoint(BPts[I]);\r\n            end;\r\n            CurPoint := FPoints[J].Point;\r\n          end;\r\n        gppClose:\r\n          begin\r\n            AddPoint(SP);\r\n          end;\r\n      end;\r\n      Inc(J);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddEllipse(const ARect: TRectF);\r\nvar\r\n  CX, CY, PX, PY: Single;\r\n  c: Single;\r\nbegin\r\n  c := 0.5522847498;\r\n  CX := (ARect.Left + ARect.Right) / 2;\r\n  CY := (ARect.Top + ARect.Bottom) / 2;\r\n  PX := c * ((ARect.Right - ARect.Left) / 2);\r\n  PY := c * ((ARect.Bottom - ARect.Top) / 2);\r\n  MoveTo(PointF(ARect.Left, CY));\r\n  CurveTo(PointF(ARect.Left, CY - PY), PointF(CX - PX, ARect.Top), PointF(CX, ARect.Top));\r\n  CurveTo(PointF(CX + PX, ARect.Top), PointF(ARect.Right, CY - PY), PointF(ARect.Right, CY));\r\n  CurveTo(PointF(ARect.Right, CY + PY), PointF(CX + PX, ARect.Bottom), PointF(CX, ARect.Bottom));\r\n  CurveTo(PointF(CX - PX, ARect.Bottom), PointF(ARect.Left, CY + PY), PointF(ARect.Left, CY));\r\n  FClippable := True;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddLine(const StartPoint, EndPoint: TPointF);\r\nbegin\r\n  if Count = 0 then\r\n    MoveTo(StartPoint)\r\n  else\r\n    LineTo(StartPoint);\r\n\r\n  LineTo(EndPoint);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddRectangle(const ARect: TRectF);\r\nbegin\r\n  MoveTo(PointF(ARect.Left, ARect.Top));\r\n  LineTo(PointF(ARect.Right, ARect.Top));\r\n  LineTo(PointF(ARect.Right, ARect.Bottom));\r\n  LineTo(PointF(ARect.Left, ARect.Bottom));\r\n  ClosePath;\r\n  FClippable := True;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.ApplyMatrix(AMatrix: TTMSFNCGraphicsMatrix);\r\nvar\r\n  I: Integer;\r\n  pt: TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  if PathData.Count > 0 then\r\n  begin\r\n    for I := 0 to PathData.Count - 1 do\r\n    begin\r\n      if PathData[I].Kind in [TTMSFNCGraphicsPathPointKind.gppMoveTo, TTMSFNCGraphicsPathPointKind.gppLineTo, TTMSFNCGraphicsPathPointKind.gppCurveTo] then\r\n      begin\r\n        pt := PathData[I];\r\n        pt.Point := MatrixMultiply(pt.Point, AMatrix);\r\n        PathData[I] := pt;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure DrawArcWithBezier(Path: TTMSFNCGraphicsPath; CenterX, CenterY, RadiusX, RadiusY, StartAngle, SweepRange: Single;\r\n  UseMoveTo: Boolean);\r\nvar\r\n  Coord: array of TPointF;\r\n  Pts: array of TPointF;\r\n  A, X, Y: Single;\r\n  {$IFDEF LCLLIB}\r\n  C, B, CC, SS: Extended;\r\n  {$ELSE}\r\n  C, B, CC, SS: Single;\r\n  {$ENDIF}\r\n  I: Integer;\r\nbegin\r\n  if SweepRange = 0 then\r\n  begin\r\n    if UseMoveTo then\r\n    begin\r\n      if Path.FPoints.Count < 1 then\r\n        Path.MoveTo(PointF(CenterX + RadiusX * Cos(StartAngle), CenterY - RadiusY * Sin(StartAngle)))\r\n      else\r\n        Path.LineTo(PointF(CenterX + RadiusX * Cos(StartAngle), CenterY - RadiusY * Sin(StartAngle)));\r\n    end;\r\n    Path.LineTo(PointF(CenterX + RadiusX * Cos(StartAngle), CenterY - RadiusY * Sin(StartAngle)));\r\n    Exit;\r\n  end;\r\n  {$IFDEF WEBLIB}\r\n  B := Sin(SweepRange / 2);\r\n  C := Cos(SweepRange / 2);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  SinCos(SweepRange / 2, B, C);\r\n  {$ENDIF}\r\n  A := 1 - C;\r\n  X := A * 4 / 3;\r\n  Y := B - X * C / B;\r\n  {$IFDEF WEBLIB}\r\n  SS := Sin(StartAngle + SweepRange / 2);\r\n  CC := Cos(StartAngle + SweepRange / 2);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  SinCos(StartAngle + SweepRange / 2, SS, CC);\r\n  {$ENDIF}\r\n  SetLength(Coord, 4);\r\n  Coord[0] := PointF(C, -B);\r\n  Coord[1] := PointF(C + X, -Y);\r\n  Coord[2] := PointF(C + X, Y);\r\n  Coord[3] := PointF(C, B);\r\n  SetLength(Pts, 4);\r\n  for I := 0 to 3 do\r\n  begin\r\n    Pts[I] := PointF(CenterX + RadiusX * (Coord[I].X * CC - Coord[I].Y * SS), CenterY + RadiusY * (Coord[I].X *\r\n      SS + Coord[I].Y * CC));\r\n  end;\r\n  if UseMoveTo then\r\n  begin\r\n    if Path.FPoints.Count < 1 then\r\n      Path.MoveTo(Pts[0])\r\n    else\r\n      Path.LineTo(Pts[0]);\r\n  end;\r\n  Path.CurveTo(Pts[1], Pts[2], Pts[3]);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPath.AddArc(const Center, Radius: TPointF; StartAngle, SweepAngle: Single);\r\nconst\r\n  BezierArcAngleEpsilon = 0.01;\r\n  MinSweepAngle = 1E-10;\r\nvar\r\n  UseMoveTo: Boolean;\r\n  I: Integer;\r\n  F: Single;\r\n  TotalSweep, LocalSweep, PrevSweep: Single;\r\n  Done: Boolean;\r\nbegin\r\n  StartAngle := DegToRad(StartAngle);\r\n  SweepAngle := DegToRad(SweepAngle);\r\n  I := Trunc(StartAngle / (2 * Pi));\r\n  F := StartAngle - (I * 2 * Pi);\r\n  StartAngle := F;\r\n  if SweepAngle >= 2 * Pi then\r\n    SweepAngle := 2 * Pi;\r\n  if SweepAngle <= -2 * Pi then\r\n    SweepAngle := -2 * Pi;\r\n  if Abs(SweepAngle) < MinSweepAngle then\r\n    Exit;\r\n  TotalSweep := 0;\r\n  Done := False;\r\n  UseMoveTo := True;\r\n  repeat\r\n    if SweepAngle < 0 then\r\n    begin\r\n      PrevSweep := TotalSweep;\r\n      LocalSweep := -Pi / 2;\r\n      TotalSweep := TotalSweep - (Pi / 2);\r\n      if TotalSweep <= SweepAngle + BezierArcAngleEpsilon then\r\n      begin\r\n        LocalSweep := SweepAngle - PrevSweep;\r\n        Done := True;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      PrevSweep := TotalSweep;\r\n      LocalSweep := Pi / 2;\r\n      TotalSweep := TotalSweep + (Pi / 2);\r\n      if TotalSweep >= SweepAngle - BezierArcAngleEpsilon then\r\n      begin\r\n        LocalSweep := SweepAngle - PrevSweep;\r\n        Done := True;\r\n      end;\r\n    end;\r\n    DrawArcWithBezier(Self, Center.X, Center.Y, Radius.X, Radius.Y, StartAngle, LocalSweep, UseMoveTo);\r\n    UseMoveTo := False;\r\n    StartAngle := StartAngle + LocalSweep;\r\n  until Done;\r\nend;\r\n\r\n{ TTMSFNCGraphicsPathPoint }\r\n\r\n{$IFDEF LCLLIB}\r\nclass operator TTMSFNCGraphicsPathPoint.=(z1, z2: TTMSFNCGraphicsPathPoint)b: boolean;\r\nbegin\r\n  Result := z1 = z2;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFNDEF WEBLIB}\r\n\r\n{ TTMSFNCGraphicsMatrix }\r\n\r\nclass function TTMSFNCGraphicsMatrix.CreateRotation(const AAngle: Single): TTMSFNCGraphicsMatrix;\r\nvar\r\n  S, C: Single;\r\nbegin\r\n  S := Sin(AAngle);\r\n  C := Cos(AAngle);\r\n  Result := Identity;\r\n  Result.m11 := C;\r\n  Result.m12 := S;\r\n  Result.m21 := -S;\r\n  Result.m22 := C;\r\nend;\r\n\r\nclass function TTMSFNCGraphicsMatrix.CreateScaling(const AScaleX, AScaleY: Single): TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result := Identity;\r\n  Result.m11 := AScaleX;\r\n  Result.m22 := AScaleY;\r\nend;\r\n\r\nclass function TTMSFNCGraphicsMatrix.CreateTranslation(const ADeltaX, ADeltaY: Single): TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result := Identity;\r\n  Result.m31 := ADeltaX;\r\n  Result.m32 := ADeltaY;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsMatrix.Scale(const AFactor: Single): TTMSFNCGraphicsMatrix;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to 2 do\r\n  begin\r\n    Result.M[I].V[0] := Self.M[I].V[0] * AFactor;\r\n    Result.M[I].V[1] := Self.M[I].V[1] * AFactor;\r\n    Result.M[I].V[2] := Self.M[I].V[2] * AFactor;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsMatrix.Determinant: Single;\r\nbegin\r\n  Result := Self.M[0].V[0] * (Self.M[1].V[1] * Self.M[2].V[2] - Self.M[2].V[1] * Self.M[1].V[2]) - Self.M[0].V[1]\r\n    * (Self.M[1].V[0] * Self.M[2].V[2] - Self.M[2].V[0] * Self.M[1].V[2]) + Self.M[0].V[2] * (Self.M[1].V[0]\r\n    * Self.M[2].V[1] - Self.M[2].V[0] * Self.M[1].V[1]);\r\nend;\r\n\r\nfunction TTMSFNCGraphicsMatrix.Adjoint: TTMSFNCGraphicsMatrix;\r\nvar\r\n  a1, a2, a3, b1, b2, b3, c1, c2, c3: Single;\r\nbegin\r\n  a1 := Self.M[0].V[0];\r\n  a2 := Self.M[0].V[1];\r\n  a3 := Self.M[0].V[2];\r\n  b1 := Self.M[1].V[0];\r\n  b2 := Self.M[1].V[1];\r\n  b3 := Self.M[1].V[2];\r\n  c1 := Self.M[2].V[0];\r\n  c2 := Self.M[2].V[1];\r\n  c3 := Self.M[2].V[2];\r\n\r\n  Result.M[0].V[0] := (b2 * c3 - c2 * b3);\r\n  Result.M[1].V[0] := -(b1 * c3 - c1 * b3);\r\n  Result.M[2].V[0] := (b1 * c2 - c1 * b2);\r\n\r\n  Result.M[0].V[1] := -(a2 * c3 - c2 * a3);\r\n  Result.M[1].V[1] := (a1 * c3 - c1 * a3);\r\n  Result.M[2].V[1] := -(a1 * c2 - c1 * a2);\r\n\r\n  Result.M[0].V[2] := (a2 * b3 - b2 * a3);\r\n  Result.M[1].V[2] := -(a1 * b3 - b1 * a3);\r\n  Result.M[2].V[2] := (a1 * b2 - b1 * a2);\r\nend;\r\n\r\nclass function TTMSFNCGraphicsMatrix.Identity: TTMSFNCGraphicsMatrix;\r\nbegin\r\n  Result.m11 := 1;\r\n  Result.m12 := 0;\r\n  Result.m13 := 0;\r\n  Result.m21 := 0;\r\n  Result.m22 := 1;\r\n  Result.m23 := 0;\r\n  Result.m31 := 0;\r\n  Result.m32 := 0;\r\n  Result.m33 := 1;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsMatrix.Inverse: TTMSFNCGraphicsMatrix;\r\nconst\r\n  DefaultValue: TTMSFNCGraphicsMatrix = (m11: 1.0; m12: 0.0; m13: 0.0; m21: 0.0; m22: 1.0; m23: 0.0; m31: 0.0; m32: 0.0; m33: 1.0);\r\nvar\r\n  Det: Single;\r\nbegin\r\n  Det := Self.Determinant;\r\n  if Abs(Det) < Epsilon then\r\n    Result := DefaultValue\r\n  else\r\n    Result:= Self.Adjoint.Scale(1 / Det);\r\nend;\r\n\r\n{$IFDEF LCLLIB}\r\nclass operator TTMSFNCGraphicsMatrix.*(const APoint: TPointF;\r\n  const AMatrix: TTMSFNCGraphicsMatrix): TPointF;\r\n{$ENDIF}\r\n{$IFNDEF LCLLIB}\r\nclass operator TTMSFNCGraphicsMatrix.Multiply(const APoint: TPointF;\r\n  const AMatrix: TTMSFNCGraphicsMatrix): TPointF;\r\n{$ENDIF}\r\nbegin\r\n  Result.X := APoint.X * AMatrix.M[0].V[0] + APoint.Y * AMatrix.M[1].V[0]\r\n    + AMatrix.M[2].V[0];\r\n  Result.Y := APoint.X * AMatrix.M[0].V[1] + APoint.Y * AMatrix.M[1].V[1]\r\n    + AMatrix.M[2].V[1];\r\nend;\r\n\r\n{$IFDEF LCLLIB}\r\nclass operator TTMSFNCGraphicsMatrix.*(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix;\r\n{$ENDIF}\r\n{$IFNDEF LCLLIB}\r\nclass operator TTMSFNCGraphicsMatrix.Multiply(const AMatrix1, AMatrix2: TTMSFNCGraphicsMatrix): TTMSFNCGraphicsMatrix;\r\n{$ENDIF}\r\nbegin\r\n  Result.m11 := AMatrix1.m11 * AMatrix2.m11 + AMatrix1.m12 * AMatrix2.m21 + AMatrix1.m13 * AMatrix2.m31;\r\n  Result.m12 := AMatrix1.m11 * AMatrix2.m12 + AMatrix1.m12 * AMatrix2.m22 + AMatrix1.m13 * AMatrix2.m32;\r\n  Result.m13 := AMatrix1.m11 * AMatrix2.m13 + AMatrix1.m12 * AMatrix2.m23 + AMatrix1.m13 * AMatrix2.m33;\r\n  Result.m21 := AMatrix1.m21 * AMatrix2.m11 + AMatrix1.m22 * AMatrix2.m21 + AMatrix1.m23 * AMatrix2.m31;\r\n  Result.m22 := AMatrix1.m21 * AMatrix2.m12 + AMatrix1.m22 * AMatrix2.m22 + AMatrix1.m23 * AMatrix2.m32;\r\n  Result.m23 := AMatrix1.m21 * AMatrix2.m13 + AMatrix1.m22 * AMatrix2.m23 + AMatrix1.m23 * AMatrix2.m33;\r\n  Result.m31 := AMatrix1.m31 * AMatrix2.m11 + AMatrix1.m32 * AMatrix2.m21 + AMatrix1.m33 * AMatrix2.m31;\r\n  Result.m32 := AMatrix1.m31 * AMatrix2.m12 + AMatrix1.m32 * AMatrix2.m22 + AMatrix1.m33 * AMatrix2.m32;\r\n  Result.m33 := AMatrix1.m31 * AMatrix2.m13 + AMatrix1.m32 * AMatrix2.m23 + AMatrix1.m33 * AMatrix2.m33;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nfunction TTMSFNCGraphicsPathPoints.GetItem(Index: Integer): TTMSFNCGraphicsPathPoint;\r\nbegin\r\n  Result := TTMSFNCGraphicsPathPoint(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsPathPoints.SetItem(Index: Integer; const Value: TTMSFNCGraphicsPathPoint);\r\nbegin\r\n//  inherited Items[Index] := Value;\r\n  inherited Put(Index, Value);\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCGraphicsColorObject }\r\n\r\nconstructor TTMSFNCGraphicsColorObject.Create(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  FColor := AColor;\r\nend;\r\n\r\nprocedure DestroyColorLookup;\r\nvar\r\n  I: Integer;\r\n  {$IFNDEF FMXLIB}\r\n  obj: TTMSFNCGraphicsColorObject;\r\n  {$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  for I := 0 to FColorLookup.Count - 1 do\r\n    FColorLookup.Objects[I].DisposeOf;\r\n  {$ELSE}\r\n  for I := 0 to FColorLookup.Count - 1 do\r\n  begin\r\n    obj := TTMSFNCGraphicsColorObject(FColorLookup.Objects[I]);\r\n    obj.Free;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  FColorLookup.Free;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\ninitialization\r\nbegin\r\n  fcolorlookup := TStringList.Create;\r\n  fcolorlookup.addobject('aliceblue', TTMSFNCGraphicsColorObject.Create(gcaliceblue));\r\n  fcolorlookup.addobject('antiquewhite', TTMSFNCGraphicsColorObject.Create(gcantiquewhite));\r\n  fcolorlookup.addobject('aqua', TTMSFNCGraphicsColorObject.Create(gcaqua));\r\n  fcolorlookup.addobject('aquamarine', TTMSFNCGraphicsColorObject.Create(gcaquamarine));\r\n  fcolorlookup.addobject('azure', TTMSFNCGraphicsColorObject.Create(gcazure));\r\n  fcolorlookup.addobject('beige', TTMSFNCGraphicsColorObject.Create(gcbeige));\r\n  fcolorlookup.addobject('bisque', TTMSFNCGraphicsColorObject.Create(gcbisque));\r\n  fcolorlookup.addobject('black', TTMSFNCGraphicsColorObject.Create(gcblack));\r\n  fcolorlookup.addobject('blanchedalmond', TTMSFNCGraphicsColorObject.Create(gcblanchedalmond));\r\n  fcolorlookup.addobject('blue', TTMSFNCGraphicsColorObject.Create(gcblue));\r\n  fcolorlookup.addobject('blueviolet', TTMSFNCGraphicsColorObject.Create(gcblueviolet));\r\n  fcolorlookup.addobject('brown', TTMSFNCGraphicsColorObject.Create(gcbrown));\r\n  fcolorlookup.addobject('burlywood', TTMSFNCGraphicsColorObject.Create(gcburlywood));\r\n  fcolorlookup.addobject('cadetblue', TTMSFNCGraphicsColorObject.Create(gccadetblue));\r\n  fcolorlookup.addobject('chartreuse', TTMSFNCGraphicsColorObject.Create(gcchartreuse));\r\n  fcolorlookup.addobject('chocolate', TTMSFNCGraphicsColorObject.Create(gcchocolate));\r\n  fcolorlookup.addobject('coral', TTMSFNCGraphicsColorObject.Create(gccoral));\r\n  fcolorlookup.addobject('cornflowerblue', TTMSFNCGraphicsColorObject.Create(gccornflowerblue));\r\n  fcolorlookup.addobject('cornsilk', TTMSFNCGraphicsColorObject.Create(gccornsilk));\r\n  fcolorlookup.addobject('crimson', TTMSFNCGraphicsColorObject.Create(gccrimson));\r\n  fcolorlookup.addobject('cyan', TTMSFNCGraphicsColorObject.Create(gccyan));\r\n  fcolorlookup.addobject('darkblue', TTMSFNCGraphicsColorObject.Create(gcdarkblue));\r\n  fcolorlookup.addobject('darkcyan', TTMSFNCGraphicsColorObject.Create(gcdarkcyan));\r\n  fcolorlookup.addobject('darkgoldenrod', TTMSFNCGraphicsColorObject.Create(gcdarkgoldenrod));\r\n  fcolorlookup.addobject('darkgray', TTMSFNCGraphicsColorObject.Create(gcdarkgray));\r\n  fcolorlookup.addobject('darkgreen', TTMSFNCGraphicsColorObject.Create(gcdarkgreen));\r\n  fcolorlookup.addobject('darkgrey', TTMSFNCGraphicsColorObject.Create(gcdarkgrey));\r\n  fcolorlookup.addobject('darkkhaki', TTMSFNCGraphicsColorObject.Create(gcdarkkhaki));\r\n  fcolorlookup.addobject('darkmagenta', TTMSFNCGraphicsColorObject.Create(gcdarkmagenta));\r\n  fcolorlookup.addobject('darkolivegreen', TTMSFNCGraphicsColorObject.Create(gcdarkolivegreen));\r\n  fcolorlookup.addobject('darkorange', TTMSFNCGraphicsColorObject.Create(gcdarkorange));\r\n  fcolorlookup.addobject('darkorchid', TTMSFNCGraphicsColorObject.Create(gcdarkorchid));\r\n  fcolorlookup.addobject('darkred', TTMSFNCGraphicsColorObject.Create(gcdarkred));\r\n  fcolorlookup.addobject('darksalmon', TTMSFNCGraphicsColorObject.Create(gcdarksalmon));\r\n  fcolorlookup.addobject('darkseagreen', TTMSFNCGraphicsColorObject.Create(gcdarkseagreen));\r\n  fcolorlookup.addobject('darkslateblue', TTMSFNCGraphicsColorObject.Create(gcdarkslateblue));\r\n  fcolorlookup.addobject('darkslategray', TTMSFNCGraphicsColorObject.Create(gcdarkslategray));\r\n  fcolorlookup.addobject('darkslategrey', TTMSFNCGraphicsColorObject.Create(gcdarkslategrey));\r\n  fcolorlookup.addobject('darkturquoise', TTMSFNCGraphicsColorObject.Create(gcdarkturquoise));\r\n  fcolorlookup.addobject('darkviolet', TTMSFNCGraphicsColorObject.Create(gcdarkviolet));\r\n  fcolorlookup.addobject('deeppink', TTMSFNCGraphicsColorObject.Create(gcdeeppink));\r\n  fcolorlookup.addobject('deepskyblue', TTMSFNCGraphicsColorObject.Create(gcdeepskyblue));\r\n  fcolorlookup.addobject('dimgray', TTMSFNCGraphicsColorObject.Create(gcdimgray));\r\n  fcolorlookup.addobject('dimgrey', TTMSFNCGraphicsColorObject.Create(gcdimgrey));\r\n  fcolorlookup.addobject('dodgerblue', TTMSFNCGraphicsColorObject.Create(gcdodgerblue));\r\n  fcolorlookup.addobject('firebrick', TTMSFNCGraphicsColorObject.Create(gcfirebrick));\r\n  fcolorlookup.addobject('floralwhite', TTMSFNCGraphicsColorObject.Create(gcfloralwhite));\r\n  fcolorlookup.addobject('forestgreen', TTMSFNCGraphicsColorObject.Create(gcforestgreen));\r\n  fcolorlookup.addobject('fuchsia', TTMSFNCGraphicsColorObject.Create(gcfuchsia));\r\n  fcolorlookup.addobject('gainsboro', TTMSFNCGraphicsColorObject.Create(gcgainsboro));\r\n  fcolorlookup.addobject('ghostwhite', TTMSFNCGraphicsColorObject.Create(gcghostwhite));\r\n  fcolorlookup.addobject('gold', TTMSFNCGraphicsColorObject.Create(gcgold));\r\n  fcolorlookup.addobject('goldenrod', TTMSFNCGraphicsColorObject.Create(gcgoldenrod));\r\n  fcolorlookup.addobject('gray', TTMSFNCGraphicsColorObject.Create(gcgray));\r\n  fcolorlookup.addobject('green', TTMSFNCGraphicsColorObject.Create(gcgreen));\r\n  fcolorlookup.addobject('greenyellow', TTMSFNCGraphicsColorObject.Create(gcgreenyellow));\r\n  fcolorlookup.addobject('grey', TTMSFNCGraphicsColorObject.Create(gcgrey));\r\n  fcolorlookup.addobject('honeydew', TTMSFNCGraphicsColorObject.Create(gchoneydew));\r\n  fcolorlookup.addobject('hotpink', TTMSFNCGraphicsColorObject.Create(gchotpink));\r\n  fcolorlookup.addobject('indianred', TTMSFNCGraphicsColorObject.Create(gcindianred));\r\n  fcolorlookup.addobject('indigo', TTMSFNCGraphicsColorObject.Create(gcindigo));\r\n  fcolorlookup.addobject('ivory', TTMSFNCGraphicsColorObject.Create(gcivory));\r\n  fcolorlookup.addobject('khaki', TTMSFNCGraphicsColorObject.Create(gckhaki));\r\n  fcolorlookup.addobject('lavender', TTMSFNCGraphicsColorObject.Create(gcLavender));\r\n  fcolorlookup.addobject('lavenderblush', TTMSFNCGraphicsColorObject.Create(gcLavenderblush));\r\n  fcolorlookup.addobject('lawngreen', TTMSFNCGraphicsColorObject.Create(gcLawngreen));\r\n  fcolorlookup.addobject('lemonchiffon', TTMSFNCGraphicsColorObject.Create(gclemonchiffon));\r\n  fcolorlookup.addobject('lightblue', TTMSFNCGraphicsColorObject.Create(gclightblue));\r\n  fcolorlookup.addobject('lightcoral', TTMSFNCGraphicsColorObject.Create(gclightcoral));\r\n  fcolorlookup.addobject('lightcyan', TTMSFNCGraphicsColorObject.Create(gclightcyan));\r\n  fcolorlookup.addobject('lightgoldenrodyellow', TTMSFNCGraphicsColorObject.Create(gclightgoldenrodyellow));\r\n  fcolorlookup.addobject('lightgray', TTMSFNCGraphicsColorObject.Create(gclightgray));\r\n  fcolorlookup.addobject('lightgreen', TTMSFNCGraphicsColorObject.Create(gclightgreen));\r\n  fcolorlookup.addobject('lightgrey', TTMSFNCGraphicsColorObject.Create(gclightgrey));\r\n  fcolorlookup.addobject('lightpink', TTMSFNCGraphicsColorObject.Create(gclightpink));\r\n  fcolorlookup.addobject('lightsalmon', TTMSFNCGraphicsColorObject.Create(gclightsalmon));\r\n  fcolorlookup.addobject('lightseagreen', TTMSFNCGraphicsColorObject.Create(gclightseagreen));\r\n  fcolorlookup.addobject('lightskyblue', TTMSFNCGraphicsColorObject.Create(gclightskyblue));\r\n  fcolorlookup.addobject('lightslategray', TTMSFNCGraphicsColorObject.Create(gclightslategray));\r\n  fcolorlookup.addobject('lightslategrey', TTMSFNCGraphicsColorObject.Create(gclightslategrey));\r\n  fcolorlookup.addobject('lightsteelblue', TTMSFNCGraphicsColorObject.Create(gclightsteelblue));\r\n  fcolorlookup.addobject('lightyellow', TTMSFNCGraphicsColorObject.Create(gclightyellow));\r\n  fcolorlookup.addobject('lime', TTMSFNCGraphicsColorObject.Create(gclime));\r\n  fcolorlookup.addobject('limegreen', TTMSFNCGraphicsColorObject.Create(gclimegreen));\r\n  fcolorlookup.addobject('linen', TTMSFNCGraphicsColorObject.Create(gclinen));\r\n  fcolorlookup.addobject('magenta', TTMSFNCGraphicsColorObject.Create(gcmagenta));\r\n  fcolorlookup.addobject('maroon', TTMSFNCGraphicsColorObject.Create(gcmaroon));\r\n  fcolorlookup.addobject('mediumaquamarine', TTMSFNCGraphicsColorObject.Create(gcmediumaquamarine));\r\n  fcolorlookup.addobject('mediumblue', TTMSFNCGraphicsColorObject.Create(gcmediumblue));\r\n  fcolorlookup.addobject('mediumorchid', TTMSFNCGraphicsColorObject.Create(gcmediumorchid));\r\n  fcolorlookup.addobject('mediumpurple', TTMSFNCGraphicsColorObject.Create(gcmediumpurple));\r\n  fcolorlookup.addobject('mediumseagreen', TTMSFNCGraphicsColorObject.Create(gcmediumseagreen));\r\n  fcolorlookup.addobject('mediumslateblue', TTMSFNCGraphicsColorObject.Create(gcmediumslateblue));\r\n  fcolorlookup.addobject('mediumspringgreen', TTMSFNCGraphicsColorObject.Create(gcmediumspringgreen));\r\n  fcolorlookup.addobject('mediumturquoise', TTMSFNCGraphicsColorObject.Create(gcmediumturquoise));\r\n  fcolorlookup.addobject('mediumvioletred', TTMSFNCGraphicsColorObject.Create(gcmediumvioletred));\r\n  fcolorlookup.addobject('midnightblue', TTMSFNCGraphicsColorObject.Create(gcmidnightblue));\r\n  fcolorlookup.addobject('mintcream', TTMSFNCGraphicsColorObject.Create(gcmintcream));\r\n  fcolorlookup.addobject('mistyrose', TTMSFNCGraphicsColorObject.Create(gcmistyrose));\r\n  fcolorlookup.addobject('moccasin', TTMSFNCGraphicsColorObject.Create(gcmoccasin));\r\n  fcolorlookup.addobject('navajowhite', TTMSFNCGraphicsColorObject.Create(gcnavajowhite));\r\n  fcolorlookup.addobject('navy', TTMSFNCGraphicsColorObject.Create(gcnavy));\r\n  fcolorlookup.addobject('oldlace', TTMSFNCGraphicsColorObject.Create(gcoldlace));\r\n  fcolorlookup.addobject('olive', TTMSFNCGraphicsColorObject.Create(gcolive));\r\n  fcolorlookup.addobject('olivedrab', TTMSFNCGraphicsColorObject.Create(gcolivedrab));\r\n  fcolorlookup.addobject('orange', TTMSFNCGraphicsColorObject.Create(gcorange));\r\n  fcolorlookup.addobject('orangered', TTMSFNCGraphicsColorObject.Create(gcorangered));\r\n  fcolorlookup.addobject('orchid', TTMSFNCGraphicsColorObject.Create(gcorchid));\r\n  fcolorlookup.addobject('palegoldenrod', TTMSFNCGraphicsColorObject.Create(gcpalegoldenrod));\r\n  fcolorlookup.addobject('palegreen', TTMSFNCGraphicsColorObject.Create(gcpalegreen));\r\n  fcolorlookup.addobject('paleturquoise', TTMSFNCGraphicsColorObject.Create(gcpaleturquoise));\r\n  fcolorlookup.addobject('palevioletred', TTMSFNCGraphicsColorObject.Create(gcpalevioletred));\r\n  fcolorlookup.addobject('papayawhip', TTMSFNCGraphicsColorObject.Create(gcpapayawhip));\r\n  fcolorlookup.addobject('peachpuff', TTMSFNCGraphicsColorObject.Create(gcpeachpuff));\r\n  fcolorlookup.addobject('peru', TTMSFNCGraphicsColorObject.Create(gcperu));\r\n  fcolorlookup.addobject('pink', TTMSFNCGraphicsColorObject.Create(gcpink));\r\n  fcolorlookup.addobject('plum', TTMSFNCGraphicsColorObject.Create(gcplum));\r\n  fcolorlookup.addobject('powderblue', TTMSFNCGraphicsColorObject.Create(gcpowderblue));\r\n  fcolorlookup.addobject('purple', TTMSFNCGraphicsColorObject.Create(gcpurple));\r\n  fcolorlookup.addobject('red', TTMSFNCGraphicsColorObject.Create(gcred));\r\n  fcolorlookup.addobject('rosybrown', TTMSFNCGraphicsColorObject.Create(gcrosybrown));\r\n  fcolorlookup.addobject('royalblue', TTMSFNCGraphicsColorObject.Create(gcroyalblue));\r\n  fcolorlookup.addobject('saddlebrown', TTMSFNCGraphicsColorObject.Create(gcsaddlebrown));\r\n  fcolorlookup.addobject('salmon', TTMSFNCGraphicsColorObject.Create(gcsalmon));\r\n  fcolorlookup.addobject('sandybrown', TTMSFNCGraphicsColorObject.Create(gcsandybrown));\r\n  fcolorlookup.addobject('seagreen', TTMSFNCGraphicsColorObject.Create(gcseagreen));\r\n  fcolorlookup.addobject('seashell', TTMSFNCGraphicsColorObject.Create(gcseashell));\r\n  fcolorlookup.addobject('sienna', TTMSFNCGraphicsColorObject.Create(gcsienna));\r\n  fcolorlookup.addobject('skyblue', TTMSFNCGraphicsColorObject.Create(gcskyblue));\r\n  fcolorlookup.addobject('slateblue', TTMSFNCGraphicsColorObject.Create(gcslateblue));\r\n  fcolorlookup.addobject('slategray', TTMSFNCGraphicsColorObject.Create(gcslategray));\r\n  fcolorlookup.addobject('slategrey', TTMSFNCGraphicsColorObject.Create(gcslategrey));\r\n  fcolorlookup.addobject('snow', TTMSFNCGraphicsColorObject.Create(gcsnow));\r\n  fcolorlookup.addobject('springgreen', TTMSFNCGraphicsColorObject.Create(gcspringgreen));\r\n  fcolorlookup.addobject('steelblue', TTMSFNCGraphicsColorObject.Create(gcsteelblue));\r\n  fcolorlookup.addobject('violet', TTMSFNCGraphicsColorObject.Create(gcviolet));\r\n  fcolorlookup.addobject('thistle', TTMSFNCGraphicsColorObject.Create(gcthistle));\r\n  fcolorlookup.addobject('tan', TTMSFNCGraphicsColorObject.Create(gctan));\r\n  fcolorlookup.addobject('tomato', TTMSFNCGraphicsColorObject.Create(gctomato));\r\n  fcolorlookup.addobject('turquoise', TTMSFNCGraphicsColorObject.Create(gcturquoise));\r\n  fcolorlookup.addobject('wheat', TTMSFNCGraphicsColorObject.Create(gcwheat));\r\n  fcolorlookup.addobject('whitesmoke', TTMSFNCGraphicsColorObject.Create(gcwhitesmoke));\r\n  fcolorlookup.addobject('yellowgreen', TTMSFNCGraphicsColorObject.Create(gcyellowgreen));\r\n  fcolorlookup.addobject('red', TTMSFNCGraphicsColorObject.Create(gcred));\r\n  fcolorlookup.addobject('black', TTMSFNCGraphicsColorObject.Create(gcblack));\r\n  fcolorlookup.addobject('blue', TTMSFNCGraphicsColorObject.Create(gcblue));\r\n  fcolorlookup.addobject('green', TTMSFNCGraphicsColorObject.Create(gcgreen));\r\n  fcolorlookup.addobject('aqua', TTMSFNCGraphicsColorObject.Create(gcaqua));\r\n  fcolorlookup.addobject('yellow', TTMSFNCGraphicsColorObject.Create(gcyellow));\r\n  fcolorlookup.addobject('fuchsia', TTMSFNCGraphicsColorObject.Create(gcfuchsia));\r\n  fcolorlookup.addobject('white', TTMSFNCGraphicsColorObject.Create(gcwhite));\r\n  fcolorlookup.addobject('lime', TTMSFNCGraphicsColorObject.Create(gclime));\r\n  fcolorlookup.addobject('silver', TTMSFNCGraphicsColorObject.Create(gcsilver));\r\n  fcolorlookup.addobject('gray', TTMSFNCGraphicsColorObject.Create(gcgray));\r\n  fcolorlookup.addobject('olive', TTMSFNCGraphicsColorObject.Create(gcolive));\r\n  fcolorlookup.addobject('navy', TTMSFNCGraphicsColorObject.Create(gcnavy));\r\n  fcolorlookup.addobject('purple', TTMSFNCGraphicsColorObject.Create(gcpurple));\r\n  fcolorlookup.addobject('teal', TTMSFNCGraphicsColorObject.Create(gcteal));\r\n  fcolorlookup.addobject('orange', TTMSFNCGraphicsColorObject.Create(gcorange));\r\n  fcolorlookup.addobject('maroon', TTMSFNCGraphicsColorObject.Create(gcmaroon));\r\n  FColorLookup.Sort;\r\nend;\r\n\r\nfinalization\r\nbegin\r\n  DestroyColorLookup;\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n","{\r\n    This file is part of the Pas2JS run time library.\r\n    Copyright (c) 2018 by Mattias Gaertner\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\nunit TypInfo;\r\n\r\n{$mode objfpc}\r\n{$modeswitch externalclass}\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Types, RTLConsts, JS;\r\n\r\ntype\r\n  // if you change the following enumeration type in any way\r\n  // you also have to change the rtl.js in an appropriate way !\r\n  TTypeKind = (\r\n    tkUnknown,  // 0\r\n    tkInteger,  // 1\r\n    tkChar,     // 2 in Delphi/FPC tkWChar, tkUChar\r\n    tkString,   // 3 in Delphi/FPC tkSString, tkWString or tkUString\r\n    tkEnumeration, // 4\r\n    tkSet,      // 5\r\n    tkDouble,   // 6\r\n    tkBool,     // 7\r\n    tkProcVar,  // 8\r\n    tkMethod,   // 9  proc var of object\r\n    tkArray,    // 10 static array\r\n    tkDynArray, // 11\r\n    tkRecord,   // 12\r\n    tkClass,    // 13\r\n    tkClassRef, // 14\r\n    tkPointer,  // 15\r\n    tkJSValue,  // 16\r\n    tkRefToProcVar, // 17\r\n    tkInterface // 18\r\n    //tkObject,\r\n    //tkSString,tkLString,tkAString,tkWString,\r\n    //tkVariant,\r\n    //tkWChar,\r\n    //tkInt64,\r\n    //tkQWord,\r\n    //tkInterfaceRaw,\r\n    //tkUString,tkUChar,\r\n    //tkHelper,\r\n    //tkFile,\r\n    );\r\n  TTypeKinds = set of TTypeKind;\r\n\r\nconst\r\n  tkFloat = tkDouble; // for compatibility with Delphi/FPC\r\n  tkProcedure = tkProcVar; // for compatibility with Delphi\r\n  tkAny = [Low(TTypeKind)..High(TTypeKind)];\r\n  tkMethods = [tkMethod];\r\n  tkProperties = tkAny-tkMethods-[tkUnknown];\r\n\r\ntype\r\n  { TTypeInfo }\r\n\r\n  TTypeInfo = class external name 'rtl.tTypeInfo'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeKind external name 'kind';\r\n  end;\r\n  TTypeInfoClassOf = class of TTypeInfo;\r\n\r\n  TOrdType  = (\r\n    otSByte,      // 0\r\n    otUByte,      // 1\r\n    otSWord,      // 2\r\n    otUWord,      // 3\r\n    otSLong,      // 4\r\n    otULong,      // 5\r\n    otSIntDouble, // 6 NativeInt\r\n    otUIntDouble  // 7 NativeUInt\r\n    );\r\n\r\n  { TTypeInfoInteger - Kind = tkInteger }\r\n\r\n  TTypeInfoInteger = class external name 'rtl.tTypeInfoInteger'(TTypeInfo)\r\n  public\r\n    MinValue: NativeInt external name 'minvalue';\r\n    MaxValue: NativeInt external name 'maxvalue';\r\n    OrdType : TOrdType external name 'ordtype';\r\n  end;\r\n\r\n  { TEnumType }\r\n\r\n  TEnumType = class external name 'anonymous'\r\n  private\r\n    function GetIntToName(Index: NativeInt): String; external name '[]';\r\n    function GetNameToInt(Name: String): NativeInt; external name '[]';\r\n  public\r\n    property IntToName[Index: NativeInt]: String read GetIntToName;\r\n    property NameToInt[Name: String]: NativeInt read GetNameToInt;\r\n  end;\r\n\r\n  { TTypeInfoEnum - Kind = tkEnumeration }\r\n\r\n  TTypeInfoEnum = class external name 'rtl.tTypeInfoEnum'(TTypeInfoInteger)\r\n  public\r\n    // not supported: OrdType : TOrdType, BaseType: TTypeInfo\r\n    EnumType: TEnumType external name 'enumtype';\r\n  end;\r\n\r\n  { TTypeInfoSet - Kind = tkSet }\r\n\r\n  TTypeInfoSet = class external name 'rtl.tTypeInfoSet'(TTypeInfo)\r\n  public\r\n    // not supported: OrdType : TOrdType, BaseType: TTypeInfo\r\n    CompType: TTypeInfo external name 'comptype';\r\n  end;\r\n\r\n  { TTypeInfoStaticArray - Kind = tkArray }\r\n\r\n  TTypeInfoStaticArray = class external name 'rtl.tTypeInfoStaticArray'(TTypeInfo)\r\n  public\r\n    Dims: TIntegerDynArray;\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  { TTypeInfoDynArray - Kind = tkDynArray }\r\n\r\n  TTypeInfoDynArray = class external name 'rtl.tTypeInfoDynArray'(TTypeInfo)\r\n  public\r\n    DimCount: NativeInt external name 'dimcount';\r\n    ElType: TTypeInfo external name 'eltype';\r\n  end;\r\n\r\n  TParamFlag     = (\r\n    pfVar,     // 2^0 = 1\r\n    pfConst,   // 2^1 = 2\r\n    pfOut,     // 2^2 = 4\r\n    pfArray    // 2^3 = 8\r\n    //pfAddress,pfReference,\r\n    );\r\n  TParamFlags = set of TParamFlag;\r\n\r\n  { TProcedureParam }\r\n\r\n  TProcedureParam = class external name 'anonymous'\r\n  public\r\n    Name: String external name 'name';\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // TParamFlags as bit vector\r\n  end;\r\n\r\n  TProcedureParams = array of TProcedureParam;\r\n\r\n  TProcedureFlag = (\r\n    pfStatic,   // 2^0 = 1\r\n    pfVarargs,  // 2^1 = 2\r\n    pfExternal  // 2^2 = 4  name may be an expression\r\n    );\r\n  TProcedureFlags = set of TProcedureFlag;\r\n\r\n  { TProcedureSignature }\r\n\r\n  TProcedureSignature = class external name 'anonymous'\r\n  public\r\n    Params: TProcedureParams external name 'params'; // can be null\r\n    ResultType: TTypeInfo external name 'resulttype'; // can be null\r\n    Flags: NativeInt external name 'flags'; // TProcedureFlags as bit vector\r\n  end;\r\n\r\n  { TTypeInfoProcVar - Kind = tkProcVar }\r\n\r\n  TTypeInfoProcVar = class external name 'rtl.tTypeInfoProcVar'(TTypeInfo)\r\n  public\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n\r\n  { TTypeInfoRefToProcVar - Kind = tkRefToProcVar }\r\n\r\n  TTypeInfoRefToProcVar = class external name 'rtl.tTypeInfoRefToProcVar'(TTypeInfoProcVar)\r\n  end;\r\n\r\n  TMethodKind = (\r\n    mkProcedure,     // 0  default\r\n    mkFunction,      // 1\r\n    mkConstructor,   // 2\r\n    mkDestructor,    // 3\r\n    mkClassProcedure,// 4\r\n    mkClassFunction  // 5\r\n    //mkClassConstructor,mkClassDestructor,mkOperatorOverload\r\n    );\r\n  TMethodKinds = set of TMethodKind;\r\n\r\n  { TTypeInfoMethodVar - Kind = tkMethod }\r\n\r\n  TTypeInfoMethodVar = class external name 'rtl.tTypeInfoMethodVar'(TTypeInfoProcVar)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n  end;\r\n\r\n  TTypeMemberKind = (\r\n    tmkUnknown,  // 0\r\n    tmkField,    // 1\r\n    tmkMethod,   // 2\r\n    tmkProperty  // 3\r\n    );\r\n  TTypeMemberKinds = set of TTypeMemberKind;\r\n\r\n  { TTypeMember }\r\n\r\n  TTypeMember = class external name 'rtl.tTypeMember'\r\n  public\r\n    Name: String external name 'name';\r\n    Kind: TTypeMemberKind external name 'kind';\r\n  end;\r\n  TTypeMemberDynArray = array of TTypeMember;\r\n\r\n  { TTypeMemberField - Kind = tmkField }\r\n\r\n  TTypeMemberField = class external name 'rtl.tTypeMemberField'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n  end;\r\n\r\n  { TTypeMemberMethod - Kind = tmkMethod }\r\n\r\n  TTypeMemberMethod = class external name 'rtl.tTypeMemberMethod'(TTypeMember)\r\n  public\r\n    MethodKind: TMethodKind external name 'methodkind';\r\n    ProcSig: TProcedureSignature external name 'procsig';\r\n  end;\r\n  TTypeMemberMethodDynArray = array of TTypeMemberMethod;\r\n\r\nconst\r\n  pfGetFunction = 1; // getter is a function\r\n  pfSetProcedure = 2; // setter is a procedure\r\n  // stored is a 2-bit vector:\r\n  pfStoredFalse = 4; // stored false, never\r\n  pfStoredField = 8; // stored field, field name is in Stored\r\n  pfStoredFunction = 12; // stored function, function name is in Stored\r\n  pfHasIndex = 16; { if getter is function, append Index as last param\r\n                     if setter is function, append Index as second last param }\r\ntype\r\n  { TTypeMemberProperty - Kind = tmkProperty }\r\n\r\n  TTypeMemberProperty = class external name 'rtl.tTypeMemberProperty'(TTypeMember)\r\n  public\r\n    TypeInfo: TTypeInfo external name 'typeinfo';\r\n    Flags: NativeInt external name 'flags'; // bit vector, see pf constants above\r\n    Params: TProcedureParams external name 'params'; // can be null\r\n    Index: JSValue external name 'index'; // can be undefined\r\n    Getter: String external name 'getter'; // name of field or function\r\n    Setter: String external name 'setter'; // name of field or function\r\n    Stored: String external name 'stored'; // name of field or function, can be undefined\r\n    Default: JSValue external name 'Default'; // can be undefined\r\n  end;\r\n  TTypeMemberPropertyDynArray = array of TTypeMemberProperty;\r\n\r\n  { TTypeMembers }\r\n\r\n  TTypeMembers = class external name 'rtl.tTypeMembers'\r\n  private\r\n    function GetItems(Name: String): TTypeMember; external name '[]';\r\n    procedure SetItems(Name: String; const AValue: TTypeMember); external name '[]';\r\n  public\r\n    property Members[Name: String]: TTypeMember read GetItems write SetItems; default;\r\n  end;\r\n\r\n  { TTypeInfoStruct }\r\n\r\n  TTypeInfoStruct = class external name 'rtl.tTypeInfoStruct'(TTypeInfo)\r\n  private\r\n    FFieldCount: NativeInt external name 'fields.length';\r\n    FMethodCount: NativeInt external name 'methods.length';\r\n    FPropCount: NativeInt external name 'properties.length';\r\n  public\r\n    Members: TTypeMembers external name 'members';\r\n    Names: TStringDynArray external name 'names'; // all member names with TTypeInfo\r\n    Fields: TStringDynArray external name 'fields';\r\n    Methods: TStringDynArray external name 'methods';\r\n    Properties: TStringDynArray external name 'properties';\r\n    property FieldCount: NativeInt read FFieldCount;\r\n    function GetField(Index: NativeInt): TTypeMemberField; external name 'getField';\r\n    function AddField(aName: String; aType: TTypeInfo; Options: TJSObject = nil\r\n      ): TTypeMemberField; external name 'addField';\r\n    property MethodCount: NativeInt read FMethodCount;\r\n    function GetMethod(Index: NativeInt): TTypeMemberMethod; external name 'getMethod';\r\n    function AddMethod(aName: String; MethodKind: TMethodKind = mkProcedure;\r\n      Params: TJSArray = nil; ResultType: TTypeInfo = nil;\r\n      Options: TJSObject = nil): TTypeMemberMethod; external name 'addMethod';\r\n    property PropCount: NativeInt read FPropCount;\r\n    function GetProp(Index: NativeInt): TTypeMemberProperty; external name 'getProperty';\r\n    function AddProperty(aName: String; Flags: NativeInt; ResultType: TTypeInfo;\r\n      Getter, Setter: String; Options: TJSObject = nil): TTypeMemberProperty; external name 'addProperty';\r\n  end;\r\n\r\n  { TTypeInfoRecord - Kind = tkRecord }\r\n\r\n  TTypeInfoRecord = class external name 'rtl.tTypeInfoRecord'(TTypeInfoStruct)\r\n  public\r\n    RecordType: TJSObject external name 'record';\r\n  end;\r\n\r\n  { TTypeInfoClass - Kind = tkClass }\r\n\r\n  TTypeInfoClass = class external name 'rtl.tTypeInfoClass'(TTypeInfoStruct)\r\n  public\r\n    ClassType: TClass external name 'class';\r\n    Ancestor: TTypeInfoClass external name 'ancestor';\r\n  end;\r\n\r\n  { TTypeInfoClassRef - class-of, Kind = tkClassRef }\r\n\r\n  TTypeInfoClassRef = class external name 'rtl.tTypeInfoClassRef'(TTypeInfo)\r\n  public\r\n    InstanceType: TTypeInfo external name 'instancetype';\r\n  end;\r\n\r\n  { TTypeInfoPointer - Kind = tkPointer }\r\n\r\n  TTypeInfoPointer = class external name 'rtl.tTypeInfoPointer'(TTypeInfo)\r\n  public\r\n    RefType: TTypeInfo external name 'reftype'; // can be null\r\n  end;\r\n\r\n  { TTypeInfoInterface - Kind = tkInterface }\r\n\r\n  TTypeInfoInterface = class external name 'rtl.tTypeInfoInterface'(TTypeInfoStruct)\r\n  public\r\n    InterfaceType: TJSObject external name 'interface';\r\n    Ancestor: TTypeInfoInterface external name 'ancestor';\r\n  end;\r\n\r\n  EPropertyError  = class(Exception);\r\n\r\nfunction GetClassMembers(aTIClass: TTypeInfoClass): TTypeMemberDynArray;\r\nfunction GetClassMember(aTIClass: TTypeInfoClass; const aName: String): TTypeMember;\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nfunction GetClassMethods(aTIClass: TTypeInfoClass): TTypeMemberMethodDynArray;\r\nfunction CreateMethod(Instance: TObject; FuncName: String): Pointer; external name 'rtl.createCallback';\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface): TTypeMemberDynArray;\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface; const aName: String): TTypeMember;\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface): TTypeMemberMethodDynArray;\r\n\r\nfunction GetPropInfos(aTIClass: TTypeInfoClass): TTypeMemberPropertyDynArray;\r\nfunction GetPropInfo(TI: TTypeInfoClass; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(TI: TTypeInfoClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction GetPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(Instance: TObject; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String): TTypeMemberProperty;\r\nfunction FindPropInfo(aClass: TClass; const PropName: String; const Kinds: TTypeKinds): TTypeMemberProperty;\r\n\r\n// Property information routines.\r\nFunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty): Boolean;\r\nFunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nfunction PropIsType(Instance: TObject; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\nfunction PropIsType(aClass: TClass; const PropName: string; const TypeKind: TTypeKind): Boolean;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty): JSValue;\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String; Value: JSValue);\r\nprocedure SetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: JSValue);\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty): NativeInt;\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String; Value: NativeInt);\r\nprocedure SetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty): longint;\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: longint);\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String; const Value: String);\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty; const Value: String);\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String);\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String);\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String; deprecated;\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String; deprecated;\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String); deprecated;\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: String); deprecated;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty): boolean;\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean);\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: boolean);\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass : TClass): TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass : TClass):  TObject;\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nFunction  GetFloatProp(Instance: TObject; const PropName: string): Double;\r\nFunction  GetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty) : Double;\r\nProcedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double);\r\nProcedure SetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty;  Value : Double);\r\n\r\nimplementation\r\n\r\nfunction GetClassMembers(aTIClass: TTypeInfoClass): TTypeMemberDynArray;\r\nvar\r\n  C: TTypeInfoClass;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  C:=aTIClass;\r\n  while C<>nil do\r\n  begin\r\n    inc(Cnt,length(C.Names));\r\n    C:=C.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  C:=aTIClass;\r\n  i:=0;\r\n  while C<>nil do\r\n  begin\r\n    for j:=0 to length(C.Names)-1 do\r\n    begin\r\n      Result[i]:=C.Members[C.Names[j]];\r\n      inc(i);\r\n    end;\r\n    C:=C.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetClassMember(aTIClass: TTypeInfoClass; const aName: String): TTypeMember;\r\nvar\r\n  C: TTypeInfoClass;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  C:=aTIClass;\r\n  while C<>nil do\r\n  begin\r\n    if TJSObject(C.Members).hasOwnProperty(aName) then\r\n      exit(C.Members[aName]);\r\n    C:=C.Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  C:=aTIClass;\r\n  while C<>nil do\r\n  begin\r\n    for i:=0 to length(C.Names)-1 do\r\n      if CompareText(C.Names[i],aName)=0 then\r\n        exit(C.Members[C.Names[i]]);\r\n    C:=C.Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInstanceMethod(Instance: TObject; const aName: String): Pointer;\r\nvar\r\n  TI: TTypeMember;\r\nbegin\r\n  if Instance=nil then exit(nil);\r\n  TI:=GetClassMember(TypeInfo(Instance),aName);\r\n  if not (TI is TTypeMemberMethod) then exit(nil);\r\n  Result:=CreateMethod(Instance,TI.Name); // Note: use TI.Name for the correct case!\r\nend;\r\n\r\nfunction GetClassMethods(aTIClass: TTypeInfoClass): TTypeMemberMethodDynArray;\r\nvar\r\n  C: TTypeInfoClass;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  C:=aTIClass;\r\n  while C<>nil do\r\n  begin\r\n    inc(Cnt,C.MethodCount);\r\n    C:=C.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  C:=aTIClass;\r\n  i:=0;\r\n  while C<>nil do\r\n  begin\r\n    for j:=0 to C.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(C.Members[C.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    C:=C.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMembers(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,length(Intf.Names));\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to length(Intf.Names)-1 do\r\n    begin\r\n      Result[i]:=Intf.Members[Intf.Names[j]];\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetInterfaceMember(aTIInterface: TTypeInfoInterface;\r\n  const aName: String): TTypeMember;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i: Integer;\r\nbegin\r\n  // quick search: case sensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    if TJSObject(Intf.Members).hasOwnProperty(aName) then\r\n      exit(Intf.Members[aName]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  // slow search: case insensitive\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    for i:=0 to length(Intf.Names)-1 do\r\n      if CompareText(Intf.Names[i],aName)=0 then\r\n        exit(Intf.Members[Intf.Names[i]]);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  Result:=nil;\r\nend;\r\n\r\nfunction GetInterfaceMethods(aTIInterface: TTypeInfoInterface\r\n  ): TTypeMemberMethodDynArray;\r\nvar\r\n  Intf: TTypeInfoInterface;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  Intf:=aTIInterface;\r\n  while Intf<>nil do\r\n  begin\r\n    inc(Cnt,Intf.MethodCount);\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  Intf:=aTIInterface;\r\n  i:=0;\r\n  while Intf<>nil do\r\n  begin\r\n    for j:=0 to Intf.MethodCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberMethod(Intf.Members[Intf.Methods[j]]);\r\n      inc(i);\r\n    end;\r\n    Intf:=Intf.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetPropInfos(aTIClass: TTypeInfoClass): TTypeMemberPropertyDynArray;\r\nvar\r\n  C: TTypeInfoClass;\r\n  i, Cnt, j: Integer;\r\nbegin\r\n  Cnt:=0;\r\n  C:=aTIClass;\r\n  while C<>nil do\r\n  begin\r\n    inc(Cnt,C.PropCount);\r\n    C:=C.Ancestor;\r\n  end;\r\n  SetLength(Result,Cnt);\r\n  C:=aTIClass;\r\n  i:=0;\r\n  while C<>nil do\r\n  begin\r\n    for j:=0 to C.PropCount-1 do\r\n    begin\r\n      Result[i]:=TTypeMemberProperty(C.Members[C.Properties[j]]);\r\n      inc(i);\r\n    end;\r\n    C:=C.Ancestor;\r\n  end;\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nvar\r\n  m: TTypeMember;\r\n  i: Integer;\r\n  C: TTypeInfoClass;\r\nbegin\r\n  // quick search case sensitive\r\n  C:=TI;\r\n  while C<>nil do\r\n  begin\r\n    m:=C.Members[PropName];\r\n    if m is TTypeMemberProperty then\r\n      exit(TTypeMemberProperty(m));\r\n    C:=C.Ancestor;\r\n  end;\r\n\r\n  // slow search case insensitive\r\n  Result:=nil;\r\n  repeat\r\n    for i:=0 to TI.PropCount-1 do\r\n      if CompareText(PropName,TI.Properties[i])=0 then\r\n      begin\r\n        m:=TI.Members[TI.Properties[i]];\r\n        if m is TTypeMemberProperty then\r\n          Result:=TTypeMemberProperty(m);\r\n        exit;\r\n      end;\r\n    TI:=TI.Ancestor;\r\n  until TI=nil;\r\nend;\r\n\r\nfunction GetPropInfo(TI: TTypeInfoClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TI,PropName);\r\n  if (Kinds<>[]) and (Result<>nil) and not (Result.TypeInfo.Kind in Kinds) then\r\n    Result:=nil;\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance),PropName,Kinds);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,[]);\r\nend;\r\n\r\nfunction GetPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(AClass),PropName,Kinds);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(Instance: TObject; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(Instance), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String\r\n  ): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction FindPropInfo(aClass: TClass; const PropName: String;\r\n  const Kinds: TTypeKinds): TTypeMemberProperty;\r\nbegin\r\n  Result:=GetPropInfo(TypeInfo(aClass), PropName, Kinds);\r\n  if Result=nil then\r\n    raise EPropertyError.CreateFmt(SErrPropertyNotFound, [PropName]);\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): Boolean;\r\ntype\r\n  TIsStored = function: Boolean of object;\r\nbegin\r\n  case PropInfo.Flags and 12 of\r\n  0: Result:=true;\r\n  4: Result:=false;\r\n  8: Result:=Boolean(TJSObject(Instance)[PropInfo.Stored]);\r\n  else Result:=TIsStored(TJSObject(Instance)[PropInfo.Stored])();\r\n  end;\r\nend;\r\n\r\nfunction IsStoredProp(Instance: TObject; const PropName: string): Boolean;\r\nbegin\r\n  Result:=IsStoredProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction IsPublishedProp(Instance: TObject; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(Instance,PropName)<>nil;\r\nend;\r\n\r\nfunction IsPublishedProp(aClass: TClass; const PropName: String): Boolean;\r\nbegin\r\n  Result:=GetPropInfo(aClass,PropName)<>nil;\r\nend;\r\n\r\nfunction PropType(Instance: TObject; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(Instance,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropType(aClass: TClass; const PropName: string): TTypeKind;\r\nbegin\r\n  Result:=FindPropInfo(aClass,PropName).TypeInfo.Kind;\r\nend;\r\n\r\nfunction PropIsType(Instance: TObject; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(Instance,PropName)=TypeKind;\r\nend;\r\n\r\nfunction PropIsType(aClass: TClass; const PropName: string;\r\n  const TypeKind: TTypeKind): Boolean;\r\nbegin\r\n  Result:=PropType(aClass,PropName)=TypeKind;\r\nend;\r\n\r\ntype\r\n  TGetterKind = (\r\n    gkNone,\r\n    gkField,\r\n    gkFunction,\r\n    gkFunctionWithParams\r\n  );\r\n\r\nfunction GetPropGetterKind(const PropInfo: TTypeMemberProperty): TGetterKind;\r\nbegin\r\n  if PropInfo.Getter='' then\r\n    Result:=gkNone\r\n  else if (pfGetFunction and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      Result:=gkFunctionWithParams\r\n    else\r\n      Result:=gkFunction;\r\n    end\r\n  else\r\n    Result:=gkField;\r\nend;\r\n\r\ntype\r\n  TSetterKind = (\r\n    skNone,\r\n    skField,\r\n    skProcedure,\r\n    skProcedureWithParams\r\n  );\r\n\r\nfunction GetPropSetterKind(const PropInfo: TTypeMemberProperty): TSetterKind;\r\nbegin\r\n  if PropInfo.Setter='' then\r\n    Result:=skNone\r\n  else if (pfSetProcedure and PropInfo.Flags)>0 then\r\n    begin\r\n    if length(PropInfo.Params)>0 then\r\n      Result:=skProcedureWithParams\r\n    else\r\n      Result:=skProcedure;\r\n    end\r\n  else\r\n    Result:=skField;\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropName: String): JSValue;\r\nbegin\r\n  Result:=GetJSValueProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetJSValueProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): JSValue;\r\ntype\r\n  TGetter = function: JSValue of object;\r\n  TGetterWithIndex = function(Index: JSValue): JSValue of object;\r\nvar\r\n  gk: TGetterKind;\r\nbegin\r\n  gk:=GetPropGetterKind(PropInfo);\r\n  case gk of\r\n    gkNone:\r\n      raise EPropertyError.CreateFmt(SCantReadPropertyS, [PropInfo.Name]);\r\n    gkField:\r\n      Result:=TJSObject(Instance)[PropInfo.Getter];\r\n    gkFunction:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        Result:=TGetterWithIndex(TJSObject(Instance)[PropInfo.Getter])(PropInfo.Index)\r\n      else\r\n        Result:=TGetter(TJSObject(Instance)[PropInfo.Getter])();\r\n    gkFunctionWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject; const PropName: String;\r\n  Value: JSValue);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetJSValueProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: JSValue);\r\ntype\r\n  TSetter = procedure(Value: JSValue) of object;\r\n  TSetterWithIndex = procedure(Index, Value: JSValue) of object;\r\nvar\r\n  sk: TSetterKind;\r\nbegin\r\n  sk:=GetPropSetterKind(PropInfo);\r\n  case sk of\r\n    skNone:\r\n      raise EPropertyError.CreateFmt(SCantWritePropertyS, [PropInfo.Name]);\r\n    skField:\r\n      TJSObject(Instance)[PropInfo.Setter]:=Value;\r\n    skProcedure:\r\n      if (pfHasIndex and PropInfo.Flags)>0 then\r\n        TSetterWithIndex(TJSObject(Instance)[PropInfo.Setter])(PropInfo.Index,Value)\r\n      else\r\n        TSetter(TJSObject(Instance)[PropInfo.Setter])(Value);\r\n    skProcedureWithParams:\r\n      raise EPropertyError.CreateFmt(SIndexedPropertyNeedsParams, [PropInfo.Name]);\r\n  end;\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropName: String): NativeInt;\r\nbegin\r\n  Result:=GetNativeIntProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetNativeIntProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): NativeInt;\r\nbegin\r\n  Result:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject; const PropName: String;\r\n  Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetNativeIntProp(Instance: TObject;\r\n  const PropInfo: TTypeMemberProperty; Value: NativeInt);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropName: String): longint;\r\nbegin\r\n  Result:=longint(GetJSValueProp(Instance,PropName));\r\nend;\r\n\r\nfunction GetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): longint;\r\nbegin\r\n  Result:=longint(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropName: String; Value: longint);\r\nbegin\r\n  SetJSValueProp(Instance,PropName,Value);\r\nend;\r\n\r\nprocedure SetOrdProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: longint);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetEnumProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty): String;\r\nvar\r\n  n: NativeInt;\r\n  TIEnum: TTypeInfoEnum;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=NativeInt(GetJSValueProp(Instance,PropInfo));\r\n  if (n>=TIEnum.MinValue) and (n<=TIEnum.MaxValue) then\r\n    Result:=TIEnum.EnumType.IntToName[n]\r\n  else\r\n    Result:=str(n);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropName: String;\r\n  const Value: String);\r\nbegin\r\n  SetEnumProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetEnumProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  const Value: String);\r\nvar\r\n  TIEnum: TTypeInfoEnum;\r\n  n: NativeInt;\r\nbegin\r\n  TIEnum:=PropInfo.TypeInfo as TTypeInfoEnum;\r\n  n:=TIEnum.EnumType.NameToInt[Value];\r\n  if not isUndefined(n) then\r\n    SetJSValueProp(Instance,PropInfo,n);\r\nend;\r\n\r\n\r\nfunction GetStrProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=String(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetStrProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropName: String): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropName);\r\nend;\r\n\r\nfunction GetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): String;\r\nbegin\r\n  Result:=GetStrProp(Instance,PropInfo);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropName: String; Value: String\r\n  );\r\nbegin\r\n  SetStrProp(Instance,PropName,Value);\r\nend;\r\n\r\nprocedure SetStringProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: String);\r\nbegin\r\n  SetStrProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropName: String): boolean;\r\nbegin\r\n  Result:=GetBoolProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty\r\n  ): boolean;\r\nbegin\r\n  Result:=Boolean(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropName: String; Value: boolean\r\n  );\r\nbegin\r\n  SetBoolProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetBoolProp(Instance: TObject; const PropInfo: TTypeMemberProperty;\r\n  Value: boolean);\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropName: String; MinClass : TClass): TObject;\r\nbegin\r\n  Result:=GetObjectProp(Instance,FindPropInfo(Instance,PropName));\r\n  if (MinClass<>Nil) and (Result<>Nil) Then\r\n    if not Result.InheritsFrom(MinClass) then\r\n      Result:=Nil;\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty):  TObject;\r\n\r\nbegin\r\n  Result:=GetObjectProp(Instance,PropInfo,Nil);\r\nend;\r\n\r\nfunction GetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; MinClass : TClass):  TObject;\r\n\r\nVar\r\n  O : TObject;\r\n\r\nbegin\r\n  O:=TObject(GetJSValueProp(Instance,PropInfo));\r\n  if (MinClass<>Nil) and not O.InheritsFrom(MinClass) then\r\n    Result:=Nil\r\n  else\r\n    Result:=O;\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropName: String; Value: TObject) ;\r\n\r\nbegin\r\n  SetObjectProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nprocedure SetObjectProp(Instance: TObject; const PropInfo: TTypeMemberProperty; Value: TObject);\r\n\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nFunction  GetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty) : Double;\r\nbegin\r\n  Result:=Double(GetJSValueProp(Instance,PropInfo));\r\nend;\r\n\r\nFunction  GetFloatProp(Instance: TObject; const PropName: string): Double;\r\n\r\nbegin\r\n  Result:=GetFloatProp(Instance,FindPropInfo(Instance,PropName));\r\nend;\r\n\r\nProcedure SetFloatProp(Instance: TObject; const PropName: string; Value: Double);\r\n\r\nbegin\r\n  SetFloatProp(Instance,FindPropInfo(Instance,PropName),Value);\r\nend;\r\n\r\nProcedure SetFloatProp(Instance: TObject; PropInfo : TTypeMemberProperty; Value : Double);\r\n\r\nbegin\r\n  SetJSValueProp(Instance,PropInfo,Value);\r\nend;\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCCustomComponent;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Controls, WEBLib.TMSFNCTypes\r\n  {$IFNDEF WEBLIB}\r\n  ,WEBLib.TMSFNCPersistence\r\n  {$ENDIF}\r\n  ,TypInfo;\r\n\r\ntype\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCCustomComponent = class(TCustomControl, ITMSFNCProductInfo{$IFNDEF WEBLIB}, ITMSFNCPersistence{$ENDIF})\r\n  private\r\n    FStored: Boolean;\r\n  {$ELSE}\r\n  TTMSFNCCustomComponent = class(TControl, ITMSFNCProductInfo, ITMSFNCPersistence)\r\n  {$ENDIF}\r\n  private\r\n    FAdaptToStyle: Boolean;\r\n  protected\r\n    {$IFDEF WEBLIB}\r\n    class function GetVersionNumber(AMaj, AMin, ARel, ABld: ShortInt): string;\r\n    {$ENDIF}\r\n    function CanSaveProperty({%H-}AObject: TObject; {%H-}APropertyName: string; {%H-}APropertyType: TTypeKind): Boolean; virtual;\r\n    function CanLoadProperty({%H-}AObject: TObject; {%H-}APropertyName: string; {%H-}APropertyType: TTypeKind): Boolean; virtual;\r\n    function GetVersion: string; virtual;\r\n    function GetDocURL: string; virtual;\r\n    function GetTipsURL: string; virtual;\r\n    function GetInstance: NativeUInt; virtual;\r\n    procedure SetAdaptToStyle(const Value: Boolean); virtual;\r\n    procedure Paint; override;\r\n    procedure Loaded; override;\r\n    procedure RegisterRuntimeClasses; virtual;\r\n    property AdaptToStyle: Boolean read FAdaptToStyle write SetAdaptToStyle default False;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    {$IFDEF FMXLIB}\r\n    procedure SetBounds(X, Y, AWidth, AHeight: Single); override;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure SetBounds(X, Y, {%H-}AWidth, {%H-}AHeight: Integer); override;\r\n    property Stored: Boolean read FStored write FStored;\r\n    {$ENDIF}\r\n    function IsDesignTime: Boolean; virtual;\r\n    function IsLoading: Boolean; virtual;\r\n    function IsReading: Boolean; virtual;\r\n    function IsDesigning: Boolean; virtual;\r\n    function IsDestroying: Boolean; virtual;\r\n    {$IFNDEF WEBLIB}\r\n    procedure SaveSettingsToFile(AFileName: string); virtual;\r\n    procedure LoadSettingsFromFile(AFileName: string); virtual;\r\n    procedure SaveSettingsToStream(AStream: TStream); virtual;\r\n    procedure LoadSettingsFromStream(AStream: TStream); virtual;\r\n    {$ENDIF}\r\n  published\r\n    {$IFDEF FMXLIB}\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 27}\r\n    property Size;\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    property Position;\r\n    {$ENDIF}\r\n    property Visible {$IFDEF CMNLIB}default False{$ENDIF};\r\n    property Width;\r\n    property Height;\r\n  end;\r\n\r\n  TTMSFNCCustomComponentClass = class of TTMSFNCCustomComponent;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.TMSFNCUtils, SysUtils, WEBLib.TMSFNCGraphics,\r\n  WEBLib.Graphics, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFNDEF LCLLIB}\r\n  ,Types\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,PngImage\r\n  {$ENDIF}\r\n  ;\r\n\r\n{ TTMSFNCCustomComponent }\r\n\r\n{$IFDEF WEBLIB}\r\nclass function TTMSFNCCustomComponent.GetVersionNumber(AMaj, AMin, ARel, ABld: ShortInt): string;\r\nbegin\r\n  Result := '';\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomComponent.CanSaveProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if AObject = Self then\r\n    Result := (TTMSFNCUtils.IndexOfTextInArray(APropertyName, ExcludePropertyList) = -1)\r\n  else\r\n  {$ENDIF}\r\n    Result := True;\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.CanLoadProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if AObject = Self then\r\n    Result := (TTMSFNCUtils.IndexOfTextInArray(APropertyName, ExcludePropertyList) = -1)\r\n  else\r\n  {$ENDIF}\r\n    Result := True;\r\nend;\r\n\r\nconstructor TTMSFNCCustomComponent.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Width := 26;\r\n  Height := 26;\r\n\r\n  if not IsDesigning then\r\n    RegisterRuntimeClasses;\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.GetDocURL: string;\r\nbegin\r\n  Result := TTMSFNCBaseDocURL;\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.GetInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.GetTipsURL: string;\r\nbegin\r\n  Result := TTMSFNCBaseTipsURL;\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.GetVersion: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.IsDesignTime: Boolean;\r\nbegin\r\n  Result := (csDesigning in ComponentState) and not ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState));\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.IsReading: Boolean;\r\nbegin\r\n  Result := (csReading in Owner.ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.IsDesigning: Boolean;\r\nbegin\r\n  Result := (csDesigning in ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.IsDestroying: Boolean;\r\nbegin\r\n  Result := (csDestroying in ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomComponent.IsLoading: Boolean;\r\nbegin\r\n  Result := (csLoading in Owner.ComponentState);\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.Loaded;\r\nbegin\r\n  inherited;\r\n  if not (csDesigning in ComponentState) then\r\n    Visible := False;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCCustomComponent.SaveSettingsToFile(AFileName: string);\r\nbegin\r\n  TTMSFNCPersistence.SaveSettingsToFile(Self, AFileName);\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.LoadSettingsFromFile(AFileName: string);\r\nbegin\r\n  TTMSFNCPersistence.LoadSettingsFromFile(Self, AFileName);\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.SaveSettingsToStream(AStream: TStream);\r\nbegin\r\n  TTMSFNCPersistence.SaveSettingsToStream(Self, AStream);\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.LoadSettingsFromStream(AStream: TStream);\r\nbegin\r\n  TTMSFNCPersistence.LoadSettingsFromStream(Self, AStream);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomComponent.Paint;\r\nvar\r\n  {$IFDEF VCLLIB}\r\n  png: TPngImage;\r\n  {$ENDIF}\r\n  pic: TTMSFNCBitmap;\r\n  g: TTMSFNCGraphics;\r\n  r: TResourceStream;\r\nbegin\r\n  inherited;\r\n  r := nil;\r\n  pic := TTMSFNCBitmap.Create;\r\n  {$IFDEF VCLLIB}\r\n  png := TPNGImage.Create;\r\n  {$ENDIF}\r\n  g := TTMSFNCGraphics.Create(Canvas);\r\n  try\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcBlack;\r\n    g.DrawRectangle(RectF(0, 0, Width, Height));\r\n\r\n    r := TTMSFNCUtils.GetResourceStream(UpperCase(ClassName), GetInstance);\r\n    if Assigned(r) then\r\n    begin\r\n      {$IFDEF VCLLIB}\r\n      png.LoadFromStream(r);\r\n      pic.Assign(png);\r\n      {$ELSE}\r\n      pic.LoadFromStream(r);\r\n      {$ENDIF}\r\n    end;\r\n\r\n    g.DrawBitmap(RectF(0, 0, Width, Height), BitmapToDrawBitmap(pic));\r\n  finally\r\n    if Assigned(r) then\r\n      r.Free;\r\n\r\n    pic.Free;\r\n    {$IFDEF VCLLIB}\r\n    png.Free;\r\n    {$ENDIF}\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.RegisterRuntimeClasses;\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCCustomComponent.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  FAdaptToStyle := Value;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomComponent.SetBounds(X, Y, AWidth, AHeight: Single);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomComponent.SetBounds(X, Y, AWidth, AHeight: Integer);\r\n{$ENDIF}\r\nbegin\r\n  inherited SetBounds(X, Y, 26, 26);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016 - 2017                                 }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCGraphics;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  Windows,\r\n  {$ENDIF}\r\n  Classes, WEBLib.TMSFNCGraphicsTypes, WEBLib.Graphics,\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  WEBLib.TMSFNCBitmapContainer,\r\n  {$ENDIF}\r\n  Types, WEBLib.TMSFNCTypes\r\n  {$IFDEF CMNLIB}\r\n  ,FMX.ImgList\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  ,UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  ;\r\n\r\ntype\r\n  TTMSFNCGraphics = class;\r\n\r\n  TTMSFNCGraphicsContext = class\r\n  private\r\n    {$IFDEF AUTOREFCOUNT}\r\n    [Weak]FGraphics: TTMSFNCGraphics;\r\n    {$ELSE}\r\n    FGraphics: TTMSFNCGraphics;\r\n    {$ENDIF}\r\n    function GetCanvas: TCanvas;\r\n    function GetGraphics: TTMSFNCGraphics;\r\n  protected\r\n    function GetNativeCanvas: Pointer; virtual; abstract;\r\n  public\r\n    constructor Create(const AGraphics: TTMSFNCGraphics); virtual;\r\n    function CreatePath: Pointer; virtual; abstract;\r\n    function ConvertToPath(APath: TTMSFNCGraphicsPath; const Flatness: Single = 0.25): Pointer;\r\n    function GetFillColor: TTMSFNCGraphicsColor; virtual; abstract;\r\n    function CalculateText(AText: string; ARect: TRectF; AWordWrapping: Boolean): TRectF; virtual; abstract;\r\n    function SetTextAngle(ARect: TRectF; AAngle: Single): TRectF; virtual; abstract;\r\n    procedure Render; virtual; abstract;\r\n    procedure PathOpen(APath: Pointer); virtual; abstract;\r\n    procedure PathMoveTo(APath: Pointer; APoint: TPointF); virtual; abstract;\r\n    procedure PathLineTo(APath: Pointer; APoint: TPointF); virtual; abstract;\r\n    procedure PathClose(APath: Pointer); virtual; abstract;\r\n    procedure ResetClip; virtual; abstract;\r\n    procedure ResetTransform; virtual; abstract;\r\n    procedure ScaleTransform(AX, AY: Single); virtual; abstract;\r\n    procedure RotateTransform(AAngle: Single); virtual; abstract;\r\n    procedure TranslateTransform(AX, AY: Single); virtual; abstract;\r\n    procedure SetTextQuality(ATextQuality: TTMSFNCGraphicsTextQuality); virtual; abstract;\r\n    procedure SetAntiAliasing(AAntiAliasing: Boolean); virtual; abstract;\r\n    procedure SetShowAcceleratorChar(AShowAcceleratorChar: Boolean); virtual; abstract;\r\n    procedure SetSize(AWidth, AHeight: Single); virtual; abstract;\r\n    procedure ResetTextAngle(AAngle: Single); virtual; abstract;\r\n    procedure BeginScene; virtual; abstract;\r\n    procedure EndScene; virtual; abstract;\r\n    procedure StartSpecialPen; virtual; abstract;\r\n    procedure StopSpecialPen; virtual; abstract;\r\n    procedure RestoreState(AState: TTMSFNCGraphicsSaveState); virtual; abstract;\r\n    procedure SaveState(AState: TTMSFNCGraphicsSaveState); virtual; abstract;\r\n    procedure SetFontSize(ASize: Integer); virtual; abstract;\r\n    procedure SetFontColor(AColor: TTMSFNCGraphicsColor); virtual; abstract;\r\n    procedure SetFontName(AName: string); virtual; abstract;\r\n    procedure SetFont(AFont: TTMSFNCGraphicsFont); virtual; abstract;\r\n    procedure SetFontStyles(AStyle: TFontStyles); virtual; abstract;\r\n    procedure SetFill(AFill: TTMSFNCGraphicsFill); virtual; abstract;\r\n    procedure SetFillKind(AKind: TTMSFNCGraphicsFillKind); virtual; abstract;\r\n    procedure SetFillColor(AColor: TTMSFNCGraphicsColor); virtual; abstract;\r\n    procedure SetStroke(AStroke: TTMSFNCGraphicsStroke); virtual; abstract;\r\n    procedure SetStrokeKind(AKind: TTMSFNCGraphicsStrokeKind); virtual; abstract;\r\n    procedure SetStrokeColor(AColor: TTMSFNCGraphicsColor); virtual; abstract;\r\n    procedure SetStrokeWidth(AWidth: Single); virtual; abstract;\r\n    procedure DrawLine(AStroke: TTMSFNCGraphicsStroke; AFromPoint: TPointF; AToPoint: TPointF; AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown; AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown); virtual; abstract;\r\n    procedure DrawPolygon(AStroke: TTMSFNCGraphicsStroke; APolygon: TTMSFNCGraphicsPathPolygon); virtual; abstract;\r\n    procedure FillPolygon(AFill: TTMSFNCGraphicsFill; APolygon: TTMSFNCGraphicsPathPolygon); virtual; abstract;\r\n    procedure DrawPolyline(AStroke: TTMSFNCGraphicsStroke; APolyline: TTMSFNCGraphicsPathPolygon); virtual; abstract;\r\n    procedure FillPolyline(AFill: TTMSFNCGraphicsFill; APolyline: TTMSFNCGraphicsPathPolygon); virtual; abstract;\r\n    procedure FillArc(AFill: TTMSFNCGraphicsFill; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single); virtual; abstract;\r\n    procedure DrawArc(AStroke: TTMSFNCGraphicsStroke; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single); virtual; abstract;\r\n    procedure FillRect(AFill: TTMSFNCGraphicsFill; ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure DrawRect(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure FillRoundRect(AFill: TTMSFNCGraphicsFill; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure DrawRoundRect(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure FillEllipse(AFill: TTMSFNCGraphicsFill; ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure DrawEllipse(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure DrawBitmap(ABitmap: TTMSFNCDrawBitmap; ASrcRect, ADstRect: TRectF; AOpacity: Single); virtual; abstract;\r\n    procedure ClipRect(ARect: TRectF); virtual; abstract;\r\n    procedure ClipPath(APath: TTMSFNCGraphicsPath); virtual; abstract;\r\n    procedure DrawFocusPath(AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; AColor: TTMSFNCGraphicsColor); virtual; abstract;\r\n    procedure DrawFocusRectangle(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; AColor: TTMSFNCGraphicsColor; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); virtual; abstract;\r\n    procedure DrawText(AText: string; ARect: TRectF; AWordWrapping: Boolean; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign; ATrimming: TTMSFNCGraphicsTextTrimming; AAngle: Single); virtual; abstract;\r\n    procedure DrawPath(AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); virtual; abstract;\r\n    procedure FillPath(AFill: TTMSFNCGraphicsFill; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); virtual; abstract;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property NativeCanvas: Pointer read GetNativeCanvas;\r\n    property Graphics: TTMSFNCGraphics read GetGraphics;\r\n  end;\r\n\r\n  TTMSFNCGraphicsContextClass = class of TTMSFNCGraphicsContext;\r\n\r\n  TTMSFNCGraphics = class\r\n  private\r\n    FActiveCanvas: TCanvas;\r\n    FBlockUpdate: Integer;\r\n    FNative: Boolean;\r\n    FContextNative, FContextGeneral: TTMSFNCGraphicsContext;\r\n    FBitmap: TBitmap;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    {$IFNDEF LIMITEDGRAPHICSMODE}\r\n    FHighlightColor: TTMSFNCGraphicsColor;\r\n    FOptimizedHTMLDrawing: Boolean;\r\n    FHighlightTextColor: TTMSFNCGraphicsColor;\r\n    FHighlightFontStyles: TFontStyles;\r\n    FURLUnderline: Boolean;\r\n    FURLColor: TTMSFNCGraphicsColor;\r\n    FBitmapContainer: TTMSFNCBitmapContainer;\r\n    {$IFDEF CMNLIB}\r\n    FImageList: TCustomImageList;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    function GetCanvas: TCanvas;\r\n    function GetContext: TTMSFNCGraphicsContext;\r\n  protected\r\n    procedure FontChanged(Sender: TObject);\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure StrokeChanged(Sender: TObject);\r\n    procedure InitializeDefaultAppearance;\r\n    function InternalCalculateText(AText: String; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRectF; overload; virtual;\r\n    function InternalDrawText(ARect: TRectF; AText: String; var AControlID: String; var AControlValue: String; var AControlType: string;AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    procedure DrawTexture(ARect: TRectF; ATexture: TTMSFNCBitmap; ATextureMode: TTMSFNCGraphicsTextureMode);\r\n    class procedure ConvertBitmapToGrayScale(ABitmap: TTMSFNCBitmap);\r\n  public class var\r\n    DefaultSelectionFillColor: TTMSFNCGraphicsColor;\r\n    DefaultTextFontColor: TTMSFNCGraphicsColor;\r\n    DefaultPopupFillColor: TTMSFNCGraphicsColor;\r\n    DefaultPopupStrokeColor: TTMSFNCGraphicsColor;\r\n    DefaultButtonStrokeColorFocused: TTMSFNCGraphicsColor;\r\n    DefaultButtonFillColorFocused: TTMSFNCGraphicsColor;\r\n    DefaultButtonStrokeColorDisabled: TTMSFNCGraphicsColor;\r\n    DefaultButtonFillColorDisabled: TTMSFNCGraphicsColor;\r\n    DefaultButtonStrokeColor: TTMSFNCGraphicsColor;\r\n    DefaultButtonFillColor: TTMSFNCGraphicsColor;\r\n  public\r\n    constructor Create(ACanvas: TCanvas; ANative: Boolean = False); virtual;\r\n    constructor CreateNative(ACanvas: TCanvas); virtual;\r\n    constructor CreateBitmapCanvas(AWidth: Integer = 1; AHeight: Integer = 1; ANative: Boolean = False; {%H-}AHighDPI: Boolean = True); virtual;\r\n    constructor CreateNativeBitmapCanvas(AWidth: Integer = 1; AHeight: Integer = 1); virtual;\r\n    destructor Destroy; override;\r\n    procedure StartSpecialPen;\r\n    procedure StopSpecialPen;\r\n    procedure BeginScene; virtual;\r\n    procedure EndScene; virtual;\r\n    procedure Assign(Source: TTMSFNCGraphics); virtual;\r\n    procedure SetFill(AFill: TTMSFNCGraphicsFill); virtual;\r\n    procedure SetStroke(AStroke: TTMSFNCGraphicsStroke); virtual;\r\n    procedure RestoreState(AState: TTMSFNCGraphicsSaveState; ACanvasOnly: Boolean = False); virtual;\r\n    procedure SetFillKind(AKind: TTMSFNCGraphicsFillKind); virtual;\r\n    procedure SetFillColor(AColor: TTMSFNCGraphicsColor); virtual;\r\n    procedure SetFontColor(AColor: TTMSFNCGraphicsColor); virtual;\r\n    procedure SetFontName(AName: string); virtual;\r\n    procedure SetFont(AFont: TTMSFNCGraphicsFont); virtual;\r\n    procedure SetFontSize(ASize: Integer); virtual;\r\n    procedure SetFontStyles(AStyle: TFontStyles); virtual;\r\n    procedure SetStrokeKind(AKind: TTMSFNCGraphicsStrokeKind); virtual;\r\n    procedure SetStrokeColor(AColor: TTMSFNCGraphicsColor); virtual;\r\n    procedure SetStrokeWidth(AWidth: Single); virtual;\r\n    procedure DrawLine(AFromPoint: TPoint; AToPoint: TPoint; {%H-}AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown; {%H-}AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown); overload; virtual;\r\n    procedure DrawLine(AFromPoint: TPointF; AToPoint: TPointF; {%H-}AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown; {%H-}AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown); overload; virtual;\r\n    procedure DrawFocusRectangle(ALeft, ATop, ARight, ABottom: Integer; AColor: TTMSFNCGraphicsColor = gcBlack; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawFocusRectangle(ARect: TRect; AColor: TTMSFNCGraphicsColor = gcBlack; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawFocusRectangle(ALeft, ATop, ARight, ABottom: Double; AColor: TTMSFNCGraphicsColor = gcBlack; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawFocusRectangle(ARect: TRectF; AColor: TTMSFNCGraphicsColor = gcBlack; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawFocusPath(APath: TTMSFNCGraphicsPath; AColor: TTMSFNCGraphicsColor = gcBlack); virtual;\r\n    procedure DrawPolygon(APolygon: TTMSFNCGraphicsPathPolygon); virtual;\r\n    procedure DrawPolyline(APolyline: TTMSFNCGraphicsPathPolygon); virtual;\r\n    procedure DrawPath(APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); virtual;\r\n    procedure DrawArc(const Center, Radius: TPointF; StartAngle, SweepAngle: Single); overload; virtual;\r\n    procedure DrawArc(const Center, Radius: TPoint; StartAngle, SweepAngle: Integer); overload; virtual;\r\n    procedure DrawRectangle(ALeft, ATop, ARight, ABottom: Double; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ALeft, ATop, ARight, ABottom: Double; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawEllipse(ALeft, ATop, ARight, ABottom: Double; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ARect: TRectF; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ALeft, ATop, ARight, ABottom: Integer; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ALeft, ATop, ARight, ABottom: Integer; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawEllipse(ALeft, ATop, ARight, ABottom: Integer; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ARect: TRect; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRectangle(ARect: TRect; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRoundRectangle(ALeft, ATop, ARight, ABottom: Double; ARounding: Single = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRoundRectangle(ARect: TRectF; ARounding: Single = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRoundRectangle(ALeft, ATop, ARight, ABottom: Integer; ARounding: Integer = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawRoundRectangle(ARect: TRect; ARounding: Integer = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawEllipse(ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawBitmapPart(ASourceLeft, ASourceTop, ASourceRight, ASourceBottom: Double; ADestinationLeft, ADestinationTop, ADestinationRight, ADestinationBottom: Double;\r\n    ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmapPart(ASourceRect: TRectF; ADestinationRect: TRectF; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmap(ALeft, ATop, ARight, ABottom: Double; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmap(ARect: TRectF; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawEllipse(ARect: TRect; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); overload; virtual;\r\n    procedure DrawBitmapPart(ASourceLeft, ASourceTop, ASourceRight, ASourceBottom: Integer; ADestinationLeft, ADestinationTop, ADestinationRight, ADestinationBottom: Integer;\r\n    ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmapPart(ASourceRect: TRect; ADestinationRect: TRect; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmap(ALeft, ATop, ARight, ABottom: Integer; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmap(ARect: TRect; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmap(ALeft, ATop: Integer; ABitmap: TTMSFNCDrawBitmap); overload; virtual;\r\n    procedure DrawBitmap(ALeft, ATop: Single; ABitmap: TTMSFNCDrawBitmap); overload; virtual;\r\n    {$IFDEF CMNLIB}\r\n    procedure DrawBitmap(ALeft, ATop: Integer; ABitmap: TTMSFNCBitmap); overload; virtual;\r\n    procedure DrawBitmap(ALeft, ATop: Single; ABitmap: TTMSFNCBitmap); overload; virtual;\r\n    {$ENDIF}\r\n    procedure DrawCheckBox(ARect: TRectF; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True); overload; virtual;\r\n    procedure DrawButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawCloseButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawExpanderButton(ARect: TRectF; AState: TTMSFNCGraphicsExpanderState = gesExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawCompactButton(ARect: TRectF; AState: TTMSFNCGraphicsCompactState = gcsExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawDropDownButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; ACenter: Boolean = False; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawRadioButton(ARect: TRectF; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True); overload; virtual;\r\n    procedure DrawProgressBar(ARect: TRectF; AValue: Single; AFormat: string = '%.0f%%'; AMax: Single = 100; AColor: TTMSFNCGraphicsColor = gcYellowgreen; ATextColor: TTMSFNCGraphicsColor = gcBlack; AShowText: Boolean = True; AEnabled: Boolean = True); overload; virtual;\r\n    procedure DrawCheckBox(ARect: TRect; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True); overload; virtual;\r\n    procedure DrawButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawCloseButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawExpanderButton(ARect: TRect; AState: TTMSFNCGraphicsExpanderState = gesExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawCompactButton(ARect: TRect; AState: TTMSFNCGraphicsCompactState = gcsExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawDropDownButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; ACenter: Boolean = False; AAdaptToStyle: Boolean = True); overload; virtual;\r\n    procedure DrawRadioButton(ARect: TRect; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True); overload; virtual;\r\n    procedure DrawProgressBar(ARect: TRect; AValue: Single; AFormat: string = '%.0f%%'; AMax: Single = 100; AColor: TTMSFNCGraphicsColor = gcYellowgreen; ATextColor: TTMSFNCGraphicsColor = gcBlack; AShowText: Boolean = True; AEnabled: Boolean = True); overload; virtual;\r\n    {$IFNDEF LIMITEDGRAPHICSMODE}\r\n    procedure DrawBitmapWithName(ALeft, ATop, ARight, ABottom: Double; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmapWithName(ARect: TRectF; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawScaledBitmap(ARect: TRectF; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawScaledBitmap(ALeft, ATop, ARight, ABottom: Double; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmapWithName(ALeft, ATop, ARight, ABottom: Integer; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawBitmapWithName(ARect: TRect; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawScaledBitmap(ARect: TRect; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    procedure DrawScaledBitmap(ALeft, ATop, ARight, ABottom: Integer; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False); overload; virtual;\r\n    {$ENDIF}\r\n    function GetBitmapDrawRectangle(ALeft, ATop, ARight, ABottom: Double; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRectF; overload; virtual;\r\n    function GetBitmapDrawRectangle(ARect: TRectF; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRectF; overload; virtual;\r\n    function GetBitmapDrawRectangle(ALeft, ATop, ARight, ABottom: Integer; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRect; overload; virtual;\r\n    function GetBitmapDrawRectangle(ARect: TRect; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRect; overload; virtual;\r\n    procedure ClipRect(ARect: TRectF); overload; virtual;\r\n    function CalculateTextSize(AText: string; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TSizeF; overload; virtual;\r\n    function CalculateTextWidth(AText: string; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Single; overload; virtual;\r\n    function CalculateTextHeight(AText: string; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Single; overload; virtual;\r\n    function CalculateText(AText: String; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRectF; overload; virtual;\r\n    function CalculateTextSize(AText: string): TSizeF; overload; virtual;\r\n    function CalculateTextWidth(AText: string): Single; overload; virtual;\r\n    function CalculateTextHeight(AText: string): Single; overload; virtual;\r\n    function CalculateText(AText: String): TRectF; overload; virtual;\r\n    procedure ClipRect(ARect: TRect); overload; virtual;\r\n    function CalculateTextSize(AText: string; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TSize; overload; virtual;\r\n    function CalculateTextWidth(AText: string; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Integer; overload; virtual;\r\n    function CalculateTextHeight(AText: string; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Integer; overload; virtual;\r\n    function CalculateText(AText: String; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRect; overload; virtual;\r\n    function CalculateTextSizeInt(AText: string): TSize; overload; virtual;\r\n    function CalculateTextWidthInt(AText: string): Integer; overload; virtual;\r\n    function CalculateTextHeightInt(AText: string): Integer; overload; virtual;\r\n    function CalculateTextInt(AText: String): TRect; overload; virtual;\r\n    function DrawText(APoint: TPointF; AText: String; AAngle: Single = 0 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ARect: TRectF; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ALeft, ATop, ARight, ABottom: Double; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ARect: TRect; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ALeft, ATop, ARight, ABottom: Integer; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ARect: TRectF; AText: String; var AControlID: String; var AControlValue: String; var AControlType: string;AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ALeft, ATop, ARight, ABottom: Double; AText: String; var AControlID: String; var AControlValue: String; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ARect: TRect; AText: String; var AControlID: String; var AControlValue: String; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function DrawText(ALeft, ATop, ARight, ABottom: Integer; AText: String; var AControlID: String; var AControlValue: String; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading; AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n      AMinWidth: Single = -1; AMinHeight: Single = -1 {$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String; overload; virtual;\r\n    function SaveState(ACanvasOnly: Boolean = False): TTMSFNCGraphicsSaveState; virtual;\r\n    property Fill: TTMSFNCGraphicsFill read FFill;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke;\r\n    property Font: TTMSFNCGraphicsFont read FFont;\r\n    property Canvas: TCanvas read GetCanvas;\r\n    property Context: TTMSFNCGraphicsContext read GetContext;\r\n    property Bitmap: TBitmap read FBitmap;\r\n    {$IFNDEF LIMITEDGRAPHICSMODE}\r\n    property OptimizedHTMLDrawing: Boolean read FOptimizedHTMLDrawing write FOptimizedHTMLDrawing;\r\n    property HighlightColor: TTMSFNCGraphicsColor read FHighlightColor write FHighlightColor;\r\n    property HighlightTextColor: TTMSFNCGraphicsColor read FHighlightTextColor write FHighlightTextColor;\r\n    property HighlightFontStyle: TFontStyles read FHighlightFontStyles write FHighlightFontStyles;\r\n    {$IFDEF CMNLIB}\r\n    property ImageList: TCustomImageList read FImageList write FImageList;\r\n    {$ENDIF}\r\n    property BitmapContainer: TTMSFNCBitmapContainer read FBitmapContainer write FBitmapContainer;\r\n    property URLColor: TTMSFNCGraphicsColor read FURLColor write FURLColor default gcBlue;\r\n    property URLUnderline: Boolean read FURLUnderline write FURLUnderline default True;\r\n    class function ApplyHilight(AText, AHilight, ATag: string; ADoCase: Boolean): string;\r\n    class function GetBitmapFromBitmapContainer(ABitmapContainer: TTMSFNCBitmapContainer; AName: string; AApplyScale: Boolean = False; AScale: Single = 0): TTMSFNCBitmap; virtual;\r\n    class function GetScaledBitmap(ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; ABitmapContainer: TTMSFNCBitmapContainer = nil): TTMSFNCBitmap;\r\n    {$ENDIF}\r\n    class procedure GetAspectSize(var AWidth: Single; var AHeight: Single; AOriginalWidth: Single; AOriginalHeight: Single; ANewWidth: Single; ANewHeight: Single; AAspectRatio: Boolean = True;\r\n      AStretch: Boolean = False; ACropping: Boolean = False); virtual;\r\n    class procedure DrawSample(ACanvas: TCanvas; ARect: TRectF); virtual;\r\n    class procedure SetDefaultGraphicColors; virtual;\r\n    class function PointInPath(APoint: TPointF; APath: TTMSFNCGraphicsPath): Boolean; overload; virtual;\r\n    class function PointInPath(APoint: TPoint; APath: TTMSFNCGraphicsPath): Boolean; overload; virtual;\r\n    class function PointInPolygon(APoint: TPointF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean; overload; virtual;\r\n    class function PointInPolygon(APoint: TPoint; APolygon: TTMSFNCGraphicsPathPolygon): Boolean; overload; virtual;\r\n    class function PointInRect(APoint: TPointF; ARect: TRectF): Boolean; overload; virtual;\r\n    class function PointInRect(APoint: TPoint; ARect: TRect): Boolean; overload; virtual;\r\n    class function GetColorRed(AColor: TTMSFNCGraphicsColor): Byte; virtual;\r\n    class function GetColorGreen(AColor: TTMSFNCGraphicsColor): Byte; virtual;\r\n    class function GetColorBlue(AColor: TTMSFNCGraphicsColor): Byte; virtual;\r\n    {$IFDEF FMXLIB}\r\n    class function GetColorAlpha(AColor: TTMSFNCGraphicsColor): Byte; virtual;\r\n    {$ENDIF}\r\n    class function ColorToHTML(AColor: TTMSFNCGraphicsColor): string; virtual;\r\n    class function HTMLToColor(AHTML: string): TTMSFNCGraphicsColor; virtual;\r\n    class function TextToColor(AText: string): TTMSFNCGraphicsColor; virtual;\r\n  end;\r\n\r\n  ITMSFNCGraphicsExport = interface\r\n    ['{481CA803-8B50-4545-B212-57AC0D065D09}']\r\n    procedure &Export({%H-}AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF);\r\n  end;\r\n\r\n{$IFDEF WEBLIB}\r\nconst\r\n  TMSFNCGRAPHICSCLOSE = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJ'+\r\n                        'cEhZcwAACxIAAAsSAdLdfvwAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuOWwzfk4AAABVSURBVDhPYxh+'+\r\n                        'QBSI/0OYWAFIThjCxA5ACmAYHeCTQwHYFGITwwuQNSBjkgBFmkGAIgNAGv5BaZINQdYMA0Qbgk0zDBBlCCiR4FMA'+\r\n                        'khOCMIcJYGAAAHvVMBv6PIFYAAAAAElFTkSuQmCC';\r\n  TMSFNCGRAPHICSDOWN = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBA'+\r\n                       'JqcGAAAAGdJREFUOI3tzjsOwjAURNGDUqSgTxU5K2AVrJtswjUsgHSR0qdxAZZFPrS+3ZvRzBsqf9MUtBtazJk+oM'+\r\n                       'e0VTriiZCFX8nbpENMgfARjsn74vKj5IFruhfc8d6zIF9S/Hyk5HS4spMVeFcOjszaOwMAAAAASUVORK5CYII=';\r\n  TMSFNCGRAPHICSDOWN2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAA'+\r\n                        'RnQU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMT'+\r\n                        'ZEaa/1AAAAdElEQVQ4T6XMsQ2AMBBD0UxBBwyA2L9jCWpY5bCLSJfgSFgUr+AHX4mIX2R0yOiQ0SGjQ8Ud5q7RCl'+\r\n                        'vX5IEDLlhS4/gGvuV/5YEJTuCAR+qYjW/N/81Hko8Mx/QKST0yHJOMCYfDMcnokNEho0NGh4zfRXkAxSYKjdpwcI'+\r\n                        'UAAAAASUVORK5CYII=';\r\n  TMSFNCGRAPHICSUP = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJq'+\r\n                     'cGAAAAEZJREFUOI3tjLEJACAMwLLo5EM+rTjpXV7g0oI4tYKbgYwJfJ6Txet4iu6Jxk10TTSuQACidzKAIrGik24ZpC'+\r\n                     'PeJ8ky+DhZ1JENPrPndiwAAAAASUVORK5CYII=';\r\n  TMSFNCGRAPHICSUP2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARn'+\r\n                      'QU1BAACxjwv8YQUAAAAJcEhZcwAACxIAAAsSAdLdfvwAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa'+\r\n                      '/1AAAAcklEQVQ4T6XMMQ6AMAiF4S46eSEvremk5/IC+GggKfE1ER2+gZ9AEZFfaMygMYPGDBozaOyshu0aGo0eXmb4'+\r\n                      'hEbw42qGTx4B/HiHCWYYPgmDOWEDPfbmT46uNWEwC/THTp/oLvQwfEFjBo0ZNGbQ+J6UG5Y9CmuVGrAsAAAAAElFTkS'+\r\n                      'uQmCC';\r\n  TMSFNCGRAPHICSPIN = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAARnQ'+\r\n                      'U1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1'+\r\n                      'AAABKklEQVQ4T2PAB0JDQ5mjoqIEgUxGiAiRIDo6WiY8PHwdEGvW19czQYUJA6AGhbCwsO9Aek1ISIiZvb09C1QKPwB'+\r\n                      'qaAbi/1DNJ4HYiqDNIE1ADZ9AGqGa/wLp6xERESZAaVQ/AyUUgDgIiOdCbQFrQsL/gPgxUM4OFACSQMYdIP4FFPwNxH'+\r\n                      '+gpqNoAortAYayHNSfjAwgNwMFvaCaMTQA8W+g+M7IyEgNiLuQAMgUoNsDgYruoWkCOe1gcHCwHlQpJgA6wwCo6DySJ'+\r\n                      'hD+BDQwCaoEEwA1SQAVzQLiq0BcBMRXgBhk25PAwEBJqDJUkJaWxgr0QzoQbwYqdABGNCeQrQPSDKTv44w3oFPEgYqm'+\r\n                      'Amk9UNqECjMCxWSBeAeUjx1ANWAkZCSD0AADAwDRpKHlJfOjAwAAAABJRU5ErkJggg==';\r\n  TMSFNCGRAPHICSPIN2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAYAAAAfSC3RAAAAAXNSR0IArs4c6QAAAARn'+\r\n                       'QU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa'+\r\n                       '/1AAAA/UlEQVQ4T33Su2oCQRTGcddLYWmlQhTLCBIsQgoLSW2nj2Bj7yv4DGkCeYOQxiaBNJapbCI2ooU+gY3gbf1/'+\r\n                       'w47MjosHfsvM7DlzY1JhGN6TQQGBM2bEOgke8IU60tGY4SYlqWGHT7wgC/PPT/SNoFDxH1owKyclWyrawsYJczwj8J'+\r\n                       'O1tR4+oFX8OGONtpLLWGCPA47Q7H78ogqd06yoPXeg4qQCTfaDR1x3ZxuapYsl3NDWJnjCtUjcThNTuKHL6cPNM2yj'+\r\n                       'hHfMMMQ/tNoGuoNYkeiTwwBjvCKPBlS8QuzFWPoU8QadQ29TY3qbFXxH/Ru2oYKbhww7kSdMXQD8wIToOQZE/AAAAA'+\r\n                       'BJRU5ErkJggg==';\r\n  TMSFNCGRAPHICSRIGHT = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMB'+\r\n                        'AJqcGAAAAFNJREFUOI3tzzsSQFAQRNFDqSezHUuwYBJLsBuhEomE4/ll3HBq+nY1PxENRrS5xzK4L1jPSiISesxP'+\r\n                        'JcORJJqwU9xthjrX/ko4mpBQocN0tf1rbDeZDIfcSud0AAAAAElFTkSuQmCC';\r\n  TMSFNCGRAPHICSLEFT = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBA'+\r\n                       'JqcGAAAAEpJREFUOI3lzKENgEAQAMEJBkkIDdDTSxp6gqMyCkB8IQgMFdwZAutn+U19Bi84MUbxhZrBawSXB+8RDD'+\r\n                       'MaDkyvmQyZyYYuOvh6N24uDUKEV//MAAAAAElFTkSuQmCC';\r\n  TMSFNCGRAPHICSEXPAND = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOvwAADr8'+\r\n                         'BOAVTJAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4zjOaXUAAAACVJREFUGFdj+P//P07MEBYW9h8Xxi'+\r\n                         '8JAjglYACnBAzglMAEDAwARZ1DA4NRF38AAAAASUVORK5CYII=';\r\n{$ENDIF}\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, Math\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  ,WEBLib.TMSFNCUtils\r\n  ,WEBLib.TMSFNCHTMLEngine\r\n  {$ENDIF}\r\n  ,WEBLib.TMSFNCGraphics.General\r\n  {$IFDEF WEBLIB}\r\n  ,WEBLib.TMSFNCGraphics.WEB\r\n  {$ENDIF}\r\n  {$IFDEF MSWINDOWS}\r\n  ,WEBLib.TMSFNCGraphics.Win\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  ,WEBLib.TMSFNCGraphics.iOS\r\n  {$ENDIF}\r\n  {$IFNDEF IOS}\r\n  ,WEBLib.TMSFNCGraphics.Mac\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF ANDROID}\r\n  ,WEBLib.TMSFNCGraphics.Android\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF UNIX}\r\n  {$IFDEF LINUX}\r\n  ,WEBLib.TMSFNCGraphics.Unix\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFNDEF MSWINDOWS}\r\n  ,LCLIntF\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\n{$IFNDEF LIMITEDGRAPHICSMODE}\r\n{$R TMSFNCGraphics.res}\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCGraphics.EndScene;\r\nbegin\r\n  Context.EndScene;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.BeginScene;\r\nbegin\r\n  Context.BeginScene;\r\nend;\r\n\r\nconstructor TTMSFNCGraphics.CreateNativeBitmapCanvas(AWidth: Integer = 1; AHeight: Integer = 1);\r\nbegin\r\n  CreateBitmapCanvas(AWidth, AHeight, True);\r\nend;\r\n\r\nconstructor TTMSFNCGraphics.CreateBitmapCanvas(AWidth: Integer = 1; AHeight: Integer = 1; ANative: Boolean = False; AHighDPI: Boolean = True);\r\nbegin\r\n  FNative := ANative;\r\n  FBitmap := TBitmap.Create{$IFDEF FMXLIB}(AWidth, AHeight){$ENDIF};\r\n  {$IFDEF FMXLIB}\r\n  if AHighDPI then\r\n    FBitmap.BitmapScale := TTMSFNCUtils.GetDPIScale;\r\n  {$ENDIF}\r\n  FBitmap.Width := AWidth;\r\n  FBitmap.Height := AHeight;\r\n  FActiveCanvas := FBitmap.Canvas;\r\n  if not ANative then\r\n  begin\r\n    FContextGeneral := TTMSFNCGraphicsContextGeneral.Create(Self);\r\n    FContextGeneral.SetSize(AWidth, AHeight);\r\n  end\r\n  else\r\n  begin\r\n    FContextNative := GetNativeContextClass.Create(Self);\r\n    FContextNative.SetSize(AWidth, AHeight);\r\n  end;\r\n  FFill := TTMSFNCGraphicsFill.Create;\r\n  FFill.OnChanged := @FillChanged;\r\n  FStroke := TTMSFNCGraphicsStroke.Create;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FFont.OnChanged := @FontChanged;\r\n  InitializeDefaultAppearance;\r\nend;\r\n\r\nconstructor TTMSFNCGraphics.CreateNative(ACanvas: TCanvas);\r\nbegin\r\n  Create(ACanvas, True);\r\nend;\r\n\r\nconstructor TTMSFNCGraphics.Create(ACanvas: TCanvas; ANative: Boolean = False);\r\nbegin\r\n  FNative := ANative;\r\n  FActiveCanvas := ACanvas;\r\n  if not ANative then\r\n  begin\r\n    FContextGeneral := TTMSFNCGraphicsContextGeneral.Create(Self);\r\n    FContextGeneral.SetSize(1, 1);\r\n  end\r\n  else\r\n  begin\r\n    FContextNative := GetNativeContextClass.Create(Self);\r\n    FContextNative.SetSize(1, 1);\r\n  end;\r\n  FFill := TTMSFNCGraphicsFill.Create;\r\n  FFill.OnChanged := @FillChanged;\r\n  FStroke := TTMSFNCGraphicsStroke.Create;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FFont.OnChanged := @FontChanged;\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  FHighlightColor := gcBlue;\r\n  FHighlightTextColor := gcWhite;\r\n  FHighlightFontStyles := [];\r\n  {$eNDIF}\r\n  InitializeDefaultAppearance;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.RestoreState(AState: TTMSFNCGraphicsSaveState; ACanvasOnly: Boolean = False);\r\nbegin\r\n  if not ACanvasOnly then\r\n  begin\r\n    SetFill(AState.Fill);\r\n    SetStroke(AState.Stroke);\r\n    SetFont(AState.Font);\r\n  end;\r\n\r\n  Context.RestoreState(AState);\r\n\r\n  AState.Free;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.SaveState(ACanvasOnly: Boolean = False): TTMSFNCGraphicsSaveState;\r\nbegin\r\n  Result := TTMSFNCGraphicsSaveState.Create;\r\n\r\n  if not ACanvasOnly then\r\n  begin\r\n    Result.Fill.Assign(FFill);\r\n    Result.Stroke.Assign(FStroke);\r\n    Result.Font.AssignSource(FFont);\r\n  end;\r\n\r\n  Context.SaveState(Result);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.StopSpecialPen;\r\nbegin\r\n  Context.StopSpecialPen;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.StartSpecialPen;\r\nbegin\r\n  Context.StartSpecialPen;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.Assign(Source: TTMSFNCGraphics);\r\nbegin\r\n  if Source is TTMSFNCGraphics then\r\n  begin\r\n    FFill.BeginUpdate;\r\n    FFill.Assign((Source as TTMSFNCGraphics).Fill);\r\n    FFill.EndUpdate;\r\n    FStroke.BeginUpdate;\r\n    FStroke.Assign((Source as TTMSFNCGraphics).Stroke);\r\n    FStroke.EndUpdate;\r\n    FFont.BeginUpdate;\r\n    FFont.AssignSource((Source as TTMSFNCGraphics).Font);\r\n    FFont.EndUpdate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFill(AFill: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFill(AFill);\r\n  FFill.Assign(AFill);\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFillKind(AKind: TTMSFNCGraphicsFillKind);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFillKind(AKind);\r\n  FFill.Kind := AKind;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFillColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFillColor(AColor);\r\n  FFill.Color := AColor;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetStrokeKind(AKind: TTMSFNCGraphicsStrokeKind);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetStrokeKind(AKind);\r\n  FStroke.Kind := AKind;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetStroke(AStroke: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetStroke(AStroke);\r\n  FStroke.Assign(AStroke);\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetStrokeWidth(AWidth: Single);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetStrokeWidth(AWidth);\r\n  FStroke.Width := AWidth;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetStrokeColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetStrokeColor(AColor);\r\n  FStroke.Color := AColor;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawLine(AFromPoint: TPoint; AToPoint: TPoint; AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown;\r\n  AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown);\r\nbegin\r\n  DrawLine(ConvertToPointF(AFromPoint), ConvertToPointF(AToPoint), AModifyPointModeFrom, AModifyPointModeTo);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawLine(AFromPoint: TPointF; AToPoint: TPointF; AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown;\r\n  AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown);\r\nbegin\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawLine(FStroke, AFromPoint, AToPoint, AModifyPointModeFrom, AModifyPointModeTo);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawPolyline(APolyline: TTMSFNCGraphicsPathPolygon);\r\nbegin\r\n  if (FFill.Color <> gcNull) and (FFill.Kind <> gfkNone) then\r\n    Context.FillPolyline(FFill, APolyline);\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawPolyline(FStroke, APolyline);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawPolygon(APolygon: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  pth: TTMSFNCGraphicsPath;\r\nbegin\r\n  if ((FFill.Color <> gcNull) and (FFill.Kind <> gfkNone)) or (FFill.Kind = gfkTexture) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture:\r\n      begin\r\n        pth := TTMSFNCGraphicsPath.Create;\r\n        try\r\n          pth.AddPolygon(APolygon);\r\n          DrawTexture(pth.GetBounds, FFill.Texture, FFill.TextureMode);\r\n        finally\r\n          pth.Free;\r\n        end;\r\n      end;\r\n      else\r\n        Context.FillPolygon(FFill, APolygon);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawPolygon(FStroke, APolygon);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawPath(APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon);\r\nbegin\r\n  if ((FFill.Color <> gcNull) and (FFill.Kind <> gfkNone)) or (FFill.Kind = gfkTexture) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture: DrawTexture(APath.GetBounds, FFill.Texture, FFill.TextureMode);\r\n      else\r\n        Context.FillPath(FFill, APath, APathMode);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawPath(FStroke, APath, APathMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawArc(const Center: TPoint; const Radius: TPoint; StartAngle: Integer; SweepAngle: Integer);\r\nbegin\r\n  DrawArc(ConvertToPointF(Center), ConvertToPointF(Radius), StartAngle, SweepAngle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawArc(const Center: TPointF; const Radius: TPointF; StartAngle: Single; SweepAngle: Single);\r\nvar\r\n  pth: TTMSFNCGraphicsPath;\r\nbegin\r\n  if (FFill.Color <> gcNull) and (FFill.Kind <> gfkNone) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture:\r\n      begin\r\n        pth := TTMSFNCGraphicsPath.Create;\r\n        try\r\n          pth.AddArc(Center, Radius, StartAngle, SweepAngle);\r\n          DrawTexture(pth.GetBounds, FFill.Texture, FFill.TextureMode);\r\n        finally\r\n          pth.Free;\r\n        end;\r\n      end;\r\n      else\r\n        Context.FillArc(FFill, Center, Radius, StartAngle, SweepAngle);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawArc(FStroke, Center, Radius, StartAngle, SweepAngle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRoundRectangle(ARect: TRect; ARounding: Integer = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRoundRectangle(ConvertToRectF(ARect), ARounding, ACorners);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRoundRectangle(ARect: TRectF; ARounding: Single = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRoundRectangle(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, ARounding, ACorners, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(RectF(ALeft, ATop, ARight, ABottom), AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(ALeft, ATop, ARight, ABottom, AllSides, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(RectF(ALeft, ATop, ARight, ABottom), ASides, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nvar\r\n  r: TRectF;\r\n  pth: TTMSFNCGraphicsPath;\r\nbegin\r\n  r := RectF(ALeft, ATop, ARight, ABottom);\r\n  if ((FFill.Color <> gcNull) and (FFill.Kind <> gfkNone)) or (FFill.Kind = gfkTexture) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture:\r\n      begin\r\n        pth := TTMSFNCGraphicsPath.Create;\r\n        try\r\n          pth.AddRectangle(r);\r\n          DrawTexture(r, FFill.Texture, FFill.TextureMode);\r\n        finally\r\n          pth.Free;\r\n        end;\r\n      end;\r\n      else\r\n        Context.FillRect(FFill, r, AModifyRectMode);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawRect(FStroke, r, ASides, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRoundRectangle(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ARounding: Integer = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRoundRectangle(RectF(ALeft, ATop, ARight, ABottom), ARounding, ACorners);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRoundRectangle(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ARounding: Single = 10; ACorners: TTMSFNCGraphicsCorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight]; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nvar\r\n  r: TRectF;\r\n  rc: Single;\r\n  pth: TTMSFNCGraphicsPath;\r\nbegin\r\n  r := RectF(ALeft, ATop, ARight, ABottom);\r\n  if ((FFill.Color <> gcNull) and (FFill.Kind <> gfkNone)) or (FFill.Kind = gfkTexture) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture:\r\n      begin\r\n        pth := TTMSFNCGraphicsPath.Create;\r\n        try\r\n          rc := ARounding;\r\n          if gcBottomLeft in ACorners then\r\n          begin\r\n            pth.MoveTo(PointF(r.Left + rc, r.Bottom));\r\n            pth.AddArc(PointF(r.Left + rc, r.Bottom - rc), PointF(rc, rc), -270, 90);\r\n            pth.LineTo(PointF(r.Left, r.Bottom - rc));\r\n          end\r\n          else\r\n          begin\r\n            pth.MoveTo(PointF(r.Left, r.Bottom));\r\n          end;\r\n\r\n          if gcTopLeft in ACorners then\r\n          begin\r\n            pth.LineTo(PointF(r.Left, r.Top + rc));\r\n            pth.AddArc(PointF(r.Left + rc, r.Top + rc), PointF(rc, rc), -180, 90);\r\n            pth.LineTo(PointF(r.Left + rc, r.Top));\r\n          end\r\n          else\r\n            pth.LineTo(PointF(r.Left, r.Top));\r\n\r\n          if gcTopRight in ACorners then\r\n          begin\r\n            pth.LineTo(PointF(r.Right - rc, r.Top));\r\n            pth.AddArc(PointF(r.Right - rc, r.Top + rc), PointF(rc, rc), -90, 90);\r\n            pth.LineTo(PointF(r.Right, r.Top + rc));\r\n          end\r\n          else\r\n            pth.LineTo(PointF(r.Right, r.Top));\r\n\r\n          if gcBottomRight in ACorners then\r\n          begin\r\n            pth.LineTo(PointF(r.Right, r.Bottom - rc));\r\n            pth.AddArc(PointF(r.Right - rc, r.Bottom - rc), PointF(rc, rc), 0, 90);\r\n            pth.LineTo(PointF(r.Right - rc, r.Bottom));\r\n          end\r\n          else\r\n            pth.LineTo(PointF(r.Right, r.Bottom));\r\n\r\n          if gcBottomLeft in ACorners then\r\n            pth.LineTo(PointF(r.Left + rc, r.Bottom))\r\n          else\r\n            pth.LineTo(PointF(r.Left, r.Bottom));\r\n\r\n          pth.ClosePath;\r\n\r\n          DrawTexture(r, FFill.Texture, FFill.TextureMode);\r\n        finally\r\n          pth.Free;\r\n        end;\r\n      end;\r\n      else\r\n        Context.FillRoundRect(FFill, r, ARounding, ACorners, AModifyRectMode);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawRoundRect(FStroke, r, ARounding, ACorners, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ARect: TRect; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(ConvertToRectF(ARect), ASides, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ARect: TRectF; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, ASides, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ARect: TRect; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(ConvertToRectF(ARect), AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRectangle(ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawRectangle(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFontSize(ASize: Integer);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFontSize(ASize);\r\n  FFont.Size := ASize;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFontColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFontColor(AColor);\r\n  FFont.Color := AColor;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFontName(AName: string);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFontName(AName);\r\n  FFont.Name := AName;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFont(AFont: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFont(AFont);\r\n  FFont.AssignSource(AFont);\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.SetFontStyles(AStyle: TFontStyles);\r\nbegin\r\n  if FBlockUpdate > 0 then\r\n    Exit;\r\n\r\n  Inc(FBlockUpdate);\r\n  Context.SetFontStyles(AStyle);\r\n  FFont.Style := AStyle;\r\n  Dec(FBlockUpdate);\r\nend;\r\n\r\ndestructor TTMSFNCGraphics.Destroy;\r\nbegin\r\n  if Assigned(FContextNative) then\r\n  begin\r\n    FContextNative.Free;\r\n    FContextNative := nil;\r\n  end;\r\n\r\n  if Assigned(FContextGeneral) then\r\n  begin\r\n    FContextGeneral.Free;\r\n    FContextGeneral := nil;\r\n  end;\r\n\r\n  if Assigned(FFont) then\r\n  begin\r\n    FFont.Free;\r\n    FFont := nil;\r\n  end;\r\n\r\n  if Assigned(FFill) then\r\n  begin\r\n    FFill.OnChanged := nil;\r\n    FFill.Free;\r\n    FFill := nil;\r\n  end;\r\n\r\n  if Assigned(FStroke) then\r\n  begin\r\n    FStroke.OnChanged := nil;\r\n    FStroke.Free;\r\n    FStroke := nil;\r\n  end;\r\n\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  FBitmapContainer := nil;\r\n  {$IFDEF CMNLIB}\r\n  FImageList := nil;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  if Assigned(FBitmap) then\r\n  begin\r\n    FBitmap.Free;\r\n    FBitmap := nil;\r\n  end;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCloseButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nbegin\r\n  DrawCloseButton(ConvertToRectF(ARect), ADown, AFocused, AEnabled, AAdaptToStyle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCloseButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\n  bmpa: TBitmap;\r\n  r: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  DrawButton(ARect, ADown, AFocused, AEnabled, AAdaptToStyle);\r\n  if AAdaptToStyle then\r\n  begin\r\n    bmpa := TBitmap.Create;\r\n    bmpa.SetSize(16, 16);\r\n    {$IFDEF CMNLIB}\r\n    bmpa.TransparentMode := tmFixed;\r\n    bmpa.Transparent := True;\r\n    bmpa.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    g := TTMSFNCGraphics.Create(bmpa.Canvas);\r\n    try\r\n      g.BeginScene;\r\n      {$IFDEF CMNLIB}\r\n      g.Fill.Color := gcWhite;\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := gcWhite;\r\n      g.DrawRectangle(0, 0, bmpa.Width, bmpa.Height);\r\n      {$ENDIF}\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultSelectionFillColor;\r\n      g.Stroke.Width := 2;\r\n      g.DrawLine(PointF(3, 3), PointF(12, 12), gcpmRightDown);\r\n      g.DrawLine(PointF(3, 12), PointF(12, 3), gcpmRightDown);\r\n    finally\r\n      g.EndScene;\r\n      g.Free;\r\n    end;\r\n\r\n    try\r\n      r := ARect;\r\n      {$IFDEF WEBLIB}\r\n      DrawBitmap(r, TTMSFNCBitmap(bmpa));\r\n      {$ELSE}\r\n      DrawBitmap(r, bmpa);\r\n      {$ENDIF}\r\n    finally\r\n      bmpa.Free;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSCLOSE));\r\n\r\n    try\r\n      r := ARect;\r\n      {$IFDEF WEBLIB}\r\n      DrawBitmap(r, BitmapToDrawBitmap(TTMSFNCBitmap(bmp)));\r\n      {$ELSE}\r\n      DrawBitmap(r, BitmapToDrawBitmap(bmp));\r\n      {$ENDIF}\r\n    finally\r\n      bmp.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawExpanderButton(ARect: TRect; AState: TTMSFNCGraphicsExpanderState = gesExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nbegin\r\n  DrawExpanderButton(ConvertToRectF(ARect), AState, ADown, AFocused, AEnabled, AAdaptToStyle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawExpanderButton(ARect: TRectF; AState: TTMSFNCGraphicsExpanderState = gesExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nvar\r\n  bmpa: TBitmap;\r\n  bmp: TTMSFNCBitmap;\r\n  r: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  DrawButton(ARect, ADown, AFocused, AEnabled, AAdaptToStyle);\r\n  if AAdaptToStyle then\r\n  begin\r\n    bmpa := TBitmap.Create;\r\n    bmpa.SetSize(16, 16);\r\n    {$IFDEF CMNLIB}\r\n    bmpa.TransparentMode := tmFixed;\r\n    bmpa.Transparent := True;\r\n    bmpa.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    g := TTMSFNCGraphics.Create(bmpa.Canvas);\r\n    try\r\n      g.BeginScene;\r\n      {$IFDEF CMNLIB}\r\n      g.Fill.Color := gcWhite;\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := gcWhite;\r\n      g.DrawRectangle(0, 0, bmpa.Width, bmpa.Height);\r\n      {$ENDIF}\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Width := 2;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultSelectionFillColor;\r\n      case AState of\r\n        gesCollapsed:\r\n        begin\r\n          g.DrawLine(PointF(5, 6), PointF(8, 9), gcpmRightDown);\r\n          g.DrawLine(PointF(8, 9), PointF(11, 6), gcpmRightDown);\r\n        end;\r\n        gesExpanded:\r\n        begin\r\n          g.DrawLine(PointF(5, 9), PointF(8, 6), gcpmRightDown);\r\n          g.DrawLine(PointF(8, 6), PointF(11, 9), gcpmRightDown);\r\n        end;\r\n      end;\r\n    finally\r\n      g.EndScene;\r\n      g.Free;\r\n    end;\r\n\r\n    if Assigned(bmpa) then\r\n    begin\r\n      try\r\n        r := ARect;\r\n        {$IFDEF WEBLIB}\r\n        DrawBitmap(r, TTMSFNCBitmap(bmpa));\r\n        {$ELSE}\r\n        DrawBitmap(r, bmpa);\r\n        {$ENDIF}\r\n      finally\r\n        bmpa.Free;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case AState of\r\n      gesCollapsed: bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSDOWN));\r\n      gesExpanded: bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSUP));\r\n      else\r\n        bmp := nil;\r\n    end;\r\n\r\n    if Assigned(bmp) then\r\n    begin\r\n      try\r\n        r := ARect;\r\n        {$IFDEF WEBLIB}\r\n        DrawBitmap(r, BitmapToDrawBitmap(TTMSFNCBitmap(bmp)));\r\n        {$ELSE}\r\n        DrawBitmap(r, BitmapToDrawBitmap(bmp));\r\n        {$ENDIF}\r\n      finally\r\n        bmp.Free;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCompactButton(ARect: TRect; AState: TTMSFNCGraphicsCompactState = gcsExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nbegin\r\n  DrawCompactButton(ConvertToRectF(ARect), AState, ADown, AFocused, AEnabled, AAdaptToStyle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCompactButton(ARect: TRectF; AState: TTMSFNCGraphicsCompactState = gcsExpanded; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nvar\r\n  bmpa: TBitmap;\r\n  bmp: TTMSFNCBitmap;\r\n  r: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  DrawButton(ARect, ADown, AFocused, AEnabled, AAdaptToStyle);\r\n  if AAdaptToStyle then\r\n  begin\r\n    bmpa := TBitmap.Create;\r\n    bmpa.SetSize(16, 16);\r\n    {$IFDEF CMNLIB}\r\n    bmpa.TransparentMode := tmFixed;\r\n    bmpa.Transparent := True;\r\n    bmpa.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    g := TTMSFNCGraphics.Create(bmpa.Canvas);\r\n    try\r\n      g.BeginScene;\r\n      {$IFDEF CMNLIB}\r\n      g.Fill.Color := gcWhite;\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := gcWhite;\r\n      g.DrawRectangle(0, 0, bmpa.Width, bmpa.Height);\r\n      {$ENDIF}\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Width := 2;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultSelectionFillColor;\r\n      case AState of\r\n        gcsCollapsed:\r\n        begin\r\n          g.DrawLine(PointF(6, 5), PointF(9, 8), gcpmRightDown);\r\n          g.DrawLine(PointF(9, 8), PointF(6, 11), gcpmRightDown);\r\n        end;\r\n        gcsExpanded:\r\n        begin\r\n          g.DrawLine(PointF(9, 5), PointF(6, 8), gcpmRightDown);\r\n          g.DrawLine(PointF(6, 8), PointF(9, 11), gcpmRightDown);\r\n        end;\r\n      end;\r\n    finally\r\n      g.EndScene;\r\n      g.Free;\r\n    end;\r\n\r\n    if Assigned(bmpa) then\r\n    begin\r\n      try\r\n        r := ARect;\r\n        {$IFDEF WEBLIB}\r\n        DrawBitmap(r, TTMSFNCBitmap(bmpa));\r\n        {$ELSE}\r\n        DrawBitmap(r, bmpa);\r\n        {$ENDIF}\r\n      finally\r\n        bmpa.Free;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case AState of\r\n      gcsCollapsed: bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSRIGHT));\r\n      gcsExpanded: bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSLEFT));\r\n      else\r\n        bmp := nil;\r\n    end;\r\n\r\n    if Assigned(bmp) then\r\n    begin\r\n      try\r\n        r := ARect;\r\n        {$IFDEF WEBLIB}\r\n        DrawBitmap(r, BitmapToDrawBitmap(TTMSFNCBitmap(bmp)));\r\n        {$ELSE}\r\n        DrawBitmap(r, BitmapToDrawBitmap(bmp));\r\n        {$ENDIF}\r\n      finally\r\n        bmp.Free;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawDropDownButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; ACenter: Boolean = False; AAdaptToStyle: Boolean = True);\r\nbegin\r\n  DrawDropDownButton(ConvertToRectF(ARect), ADown, AFocused, AEnabled, ACenter, AAdaptToStyle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawDropDownButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; ACenter: Boolean = False; AAdaptToStyle: Boolean = True);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\n  bmpa: TBitmap;\r\n  r: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  DrawButton(ARect, ADown, AFocused, AEnabled, AAdaptToStyle);\r\n  if AAdaptToStyle then\r\n  begin\r\n    bmpa := TBitmap.Create;\r\n    bmpa.SetSize(7, 7);\r\n    {$IFDEF CMNLIB}\r\n    bmpa.TransparentMode := tmFixed;\r\n    bmpa.Transparent := True;\r\n    bmpa.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    g := TTMSFNCGraphics.Create(bmpa.Canvas);\r\n    try\r\n      g.BeginScene;\r\n      {$IFDEF CMNLIB}\r\n      g.Fill.Color := gcWhite;\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := gcWhite;\r\n      g.DrawRectangle(0, 0, bmpa.Width, bmpa.Height);\r\n      {$ENDIF}\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultSelectionFillColor;\r\n      g.DrawLine(PointF(0, 1), PointF(6, 1), gcpmRightDown);\r\n      g.DrawLine(PointF(0, 2), PointF(6, 2), gcpmRightDown);\r\n      g.DrawLine(PointF(1, 3), PointF(5, 3), gcpmRightDown);\r\n      g.DrawLine(PointF(2, 4), PointF(4, 4), gcpmRightDown);\r\n      g.DrawLine(PointF(3, 5), PointF(3, 5), gcpmRightDown);\r\n    finally\r\n      g.EndScene;\r\n      g.Free;\r\n    end;\r\n\r\n    try\r\n      if (ARect.Right - bmpa.Width - 10 > ARect.Left) and not ACenter then\r\n        r := RectF(ARect.Right - bmpa.Width - 10, ARect.Top, ARect.Right, ARect.Bottom)\r\n      else\r\n        r := ARect;\r\n\r\n      {$IFDEF WEBLIB}\r\n      DrawBitmap(r, TTMSFNCBitmap(bmpa));\r\n      {$ELSE}\r\n      DrawBitmap(r, bmpa);\r\n      {$ENDIF}\r\n    finally\r\n      bmpa.Free;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSEXPAND));\r\n    try\r\n      if (ARect.Right - bmp.Width - 10 > ARect.Left) and not ACenter then\r\n        r := RectF(ARect.Right - bmp.Width - 10, ARect.Top, ARect.Right, ARect.Bottom)\r\n      else\r\n        r := ARect;\r\n\r\n      {$IFDEF WEBLIB}\r\n      DrawBitmap(r, BitmapToDrawBitmap(TTMSFNCBitmap(bmp)));\r\n      {$ELSE}\r\n      DrawBitmap(r, BitmapToDrawBitmap(bmp));\r\n      {$ENDIF}\r\n    finally\r\n      bmp.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawButton(ARect: TRect; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nbegin\r\n  DrawButton(ConvertToRectF(ARect), ADown, AFocused, AEnabled, AAdaptToStyle);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawButton(ARect: TRectF; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True; AAdaptToStyle: Boolean = True);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := ARect;\r\n  Stroke.Kind := gskSolid;\r\n  Stroke.Width := 1;\r\n  Fill.Kind := gfkSolid;\r\n\r\n  if AAdaptToStyle then\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if not AFocused then\r\n      begin\r\n        Stroke.Color := TTMSFNCGraphics.DefaultButtonStrokeColor;\r\n        Fill.Color := TTMSFNCGraphics.DefaultButtonFillColor;\r\n      end\r\n      else\r\n      begin\r\n        Stroke.Color := TTMSFNCGraphics.DefaultButtonStrokeColorFocused;\r\n        Fill.Color := TTMSFNCGraphics.DefaultButtonFillColorFocused;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      Stroke.Color := TTMSFNCGraphics.DefaultButtonStrokeColorDisabled;\r\n      Fill.Color := TTMSFNCGraphics.DefaultButtonFillColorDisabled;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if not AFocused then\r\n      begin\r\n        Stroke.Color := gcDarkGray;\r\n        Fill.Color := MakeGraphicsColor(225, 225, 225);\r\n      end\r\n      else\r\n      begin\r\n        Stroke.Color := MakeGraphicsColor(60, 127, 177);\r\n        Fill.Color := MakeGraphicsColor(229, 241, 251);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      Stroke.Color := gcDarkGray;\r\n      Fill.Color := gcLightgray;\r\n    end;\r\n  end;\r\n\r\n  DrawRectangle(r);\r\n  InflateRectEx(r, -1, -1);\r\n  Fill.Kind := gfkNone;\r\n\r\n  if not ADown then\r\n    Stroke.Color := Fill.Color\r\n  else\r\n    Stroke.Color := Lighter(Stroke.Color, 40);\r\n\r\n  DrawRectangle(r);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCheckBox(ARect: TRect; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True);\r\nbegin\r\n  DrawCheckBox(ConvertToRectF(ARect), AChecked, AFocused, AEnabled);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawCheckBox(ARect: TRectF; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True);\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\n  r: TRectF;\r\nbegin\r\n  r := ARect;\r\n  InflateRectEx(r, -1, -1);\r\n\r\n  if AEnabled then\r\n  begin\r\n    if AFocused then\r\n      c := gcSteelBlue\r\n    else\r\n      c := gcBlack;\r\n  end\r\n  else\r\n    c := gcDarkgray;\r\n\r\n  Fill.Kind := gfkSolid;\r\n  if AEnabled then\r\n    Fill.Color := Lighter(gcLightgray, 85)\r\n  else\r\n    Fill.Color := gcLightgray;\r\n\r\n  Stroke.Width := 1;\r\n  Stroke.Kind := gskSolid;\r\n  Stroke.Color := c;\r\n  DrawRectangle(r);\r\n  InflateRectEx(r, -(r.Right - r.Left) / 5, -(r.Bottom - r.Top) / 5);\r\n  Stroke.Width := 2;\r\n  Stroke.Color := c;\r\n  if AChecked then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    DrawLine(PointF(r.Left + 1, r.Top + 1), PointF(r.Right - 1, r.Bottom - 1));\r\n    DrawLine(PointF(r.Right - 1, r.Top + 1), PointF(r.Left + 1, r.Bottom - 1));\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    DrawLine(PointF(r.Left, r.Top), PointF(r.Right - 1, r.Bottom - 1));\r\n    DrawLine(PointF(r.Right - 1, r.Top), PointF(r.Left, r.Bottom - 1));\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawProgressBar(ARect: TRect; AValue: Single; AFormat: string = '%.0f%%'; AMax: Single = 100; AColor: TTMSFNCGraphicsColor = gcYellowgreen; ATextColor: TTMSFNCGraphicsColor = gcBlack; AShowText: Boolean = True; AEnabled: Boolean = True);\r\nbegin\r\n  DrawProgressBar(ConvertToRectF(ARect), AValue, AFormat, AMax, AColor, ATextColor, AShowText, AEnabled);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawProgressBar(ARect: TRectF; AValue: Single; AFormat: string = '%.0f%%'; AMax: Single = 100; AColor: TTMSFNCGraphicsColor = gcYellowgreen; ATextColor: TTMSFNCGraphicsColor = gcBlack; AShowText: Boolean = True; AEnabled: Boolean = True);\r\nvar\r\n  r, rp: TRectF;\r\n  v: Single;\r\nbegin\r\n  r := ARect;\r\n  rp := r;\r\n  if AEnabled then\r\n    Fill.Color := Lighter(gcLightGray, 75)\r\n  else\r\n    Fill.Color := gcLightGray;\r\n\r\n  Fill.Kind := gfkSolid;\r\n  Stroke.Kind := gskSolid;\r\n  Stroke.Color := gcDarkgray;\r\n\r\n  DrawRectangle(r);\r\n\r\n  v := Max(0, Min(AValue, AMax));\r\n\r\n  if (v >= 0) and (v <= AMax) and (AMax > 0) then\r\n  begin\r\n    InflateRectEx(rp, -1, -1);\r\n    rp.Right := rp.Left + (rp.Right - r.Left) * v / AMax;\r\n\r\n    Fill.Color := AColor;\r\n    Stroke.Color := Fill.Color;\r\n\r\n    DrawRectangle(rp);\r\n\r\n    if AShowText then\r\n    begin\r\n      Font.Color := ATextColor;\r\n      DrawText(r, Format(AFormat, [v / AMax * 100]), False, gtaCenter, gtaCenter);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRadioButton(ARect: TRect; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True);\r\nbegin\r\n  DrawRadioButton(ConvertToRectF(ARect), AChecked, AFocused, AEnabled);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawRadioButton(ARect: TRectF; AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True);\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\n  r: TRectF;\r\nbegin\r\n  r := ARect;\r\n  InflateRectEx(r, -1, -1);\r\n\r\n  if AEnabled then\r\n  begin\r\n    if AFocused then\r\n      c := gcSteelBlue\r\n    else\r\n      c := gcBlack;\r\n  end\r\n  else\r\n    c := gcDarkgray;\r\n\r\n  Fill.Kind := gfkSolid;\r\n  if AEnabled then\r\n    Fill.Color := Lighter(gcLightgray, 85)\r\n  else\r\n    Fill.Color := gcLightgray;\r\n\r\n  Stroke.Kind := gskSolid;\r\n  Stroke.Width := 1;\r\n  Stroke.Color := c;\r\n  DrawEllipse(r);\r\n  InflateRectEx(r, -(r.Right - r.Left) / 5, -(r.Bottom - r.Top) / 5);\r\n  Fill.Kind := gfkSolid;\r\n  Fill.Color := c;\r\n  if AChecked then\r\n  begin\r\n    DrawEllipse(r);\r\n  end;\r\nend;\r\n\r\n{$IFDEF CMNLIB}\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft, ATop: Single; ABitmap: TTMSFNCBitmap);\r\nbegin\r\n  DrawBitmap(ALeft, ATop, BitmapToDrawBitmap(ABitmap));\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft, ATop: Integer; ABitmap: TTMSFNCBitmap);\r\nbegin\r\n  DrawBitmap(ALeft, ATop, BitmapToDrawBitmap(ABitmap));\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft, ATop: Single; ABitmap: TTMSFNCDrawBitmap);\r\nbegin\r\n  DrawBitmap(RectF(ALeft, ATop, ALeft + ABitmap.Width, ATop + ABitmap.Height), ABitmap);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft, ATop: Integer; ABitmap: TTMSFNCDrawBitmap);\r\nbegin\r\n  DrawBitmap(Rect(ALeft, ATop, ALeft + ABitmap.Width, ATop + ABitmap.Height), ABitmap);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ARect: TRect; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmap(ConvertToRectF(ARect), ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ARect: TRectF; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmap(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmap(RectF(ALeft, ATop, ARight, ABottom), ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmap(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  if not Assigned(ABitmap) then\r\n    Exit;\r\n\r\n  r := RectF(ALeft, ATop, ARight, ABottom);\r\n  r := GetBitmapDrawRectangle(r, ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\n  Context.DrawBitmap(ABitmap, RectF(0, 0, ABitmap.Width, ABitmap.Height), r, 1);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapPart(ASourceRect: TRect; ADestinationRect: TRect; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmapPart(ConvertToRectF(ASourceRect), ConvertToRectF(ADestinationRect), ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapPart(ASourceRect: TRectF; ADestinationRect: TRectF; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True;\r\n  AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmapPart(ASourceRect.Left, ASourceRect.Top, ASourceRect.Right, ASourceRect.Bottom, ADestinationRect.Left, ADestinationRect.Top, ADestinationRect.Right, ADestinationRect.Bottom,\r\n    ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapPart(ASourceLeft: Integer; ASourceTop: Integer; ASourceRight: Integer; ASourceBottom: Integer; ADestinationLeft: Integer; ADestinationTop: Integer;\r\n  ADestinationRight: Integer; ADestinationBottom: Integer; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True; AStretch: Boolean = False;\r\n  ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmapPart(RectF(ASourceLeft, ASourceTop, ASourceRight, ASourceBottom), RectF(ADestinationLeft, ADestinationTop, ADestinationRight, ADestinationBottom), ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapPart(ASourceLeft: Double; ASourceTop: Double; ASourceRight: Double; ASourceBottom: Double; ADestinationLeft: Double; ADestinationTop: Double;\r\n  ADestinationRight: Double; ADestinationBottom: Double; ABitmap: TTMSFNCDrawBitmap; AAspectRatio: Boolean = True; AStretch: Boolean = False;\r\n  ACenter: Boolean = True; ACropping: Boolean = False);\r\nvar\r\n  r, rs: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  r := RectF(ADestinationLeft, ADestinationTop, ADestinationRight, ADestinationBottom);\r\n  rs := RectF(ASourceLeft, ASourceTop, ASourceRight, ASourceBottom);\r\n  if RectIsEmpty(r) or RectIsEmpty(rs) then\r\n    Exit;\r\n\r\n  g := TTMSFNCGraphics.CreateBitmapCanvas(Round(ASourceRight - ASourceLeft), Round(ASourceBottom - ASourceTop), FNative);\r\n  try\r\n    g.BeginScene;\r\n    g.DrawBitmap(-ASourceLeft, -ASourceTop, -ASourceLeft + g.Bitmap.Width, -ASourceTop + g.Bitmap.Height, ABitmap, False, False, False, False);\r\n    g.EndScene;\r\n    {$IFDEF WEBLIB}\r\n    DrawBitmap(r, TTMSFNCBitmap(g.Bitmap), AAspectRatio, AStretch, ACenter, ACropping);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    DrawBitmap(r, g.Bitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\n    {$ENDIF}\r\n  finally\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nclass procedure TTMSFNCGraphics.GetAspectSize(var AWidth: Single; var AHeight: Single; AOriginalWidth: Single; AOriginalHeight: Single; ANewWidth: Single; ANewHeight: Single;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACropping: Boolean = False);\r\nvar\r\n  arc, ar: Single;\r\nbegin\r\n  if AAspectRatio then\r\n  begin\r\n    if (AOriginalWidth > 0) and (AOriginalHeight > 0) and (ANewWidth > 0) and (ANewHeight > 0) then\r\n    begin\r\n      if (AOriginalWidth < ANewWidth) and (AOriginalHeight < ANewHeight) and (not AStretch) then\r\n      begin\r\n        AWidth := AOriginalWidth;\r\n        AHeight := AOriginalHeight;\r\n      end\r\n      else\r\n      begin\r\n        if AOriginalWidth / AOriginalHeight < ANewWidth / ANewHeight then\r\n        begin\r\n          AHeight := ANewHeight;\r\n          AWidth := ANewHeight * AOriginalWidth / AOriginalHeight;\r\n        end\r\n        else\r\n        begin\r\n          AWidth := ANewWidth;\r\n          AHeight := ANewWidth * AOriginalHeight / AOriginalWidth;\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      AWidth := 0;\r\n      AHeight := 0;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if AStretch then\r\n    begin\r\n      AWidth := ANewWidth;\r\n      AHeight := ANewHeight;\r\n    end\r\n    else\r\n    begin\r\n      AWidth := AOriginalWidth;\r\n      AHeight := AOriginalHeight;\r\n\r\n      if ACropping then\r\n      begin\r\n        if (AWidth >= AHeight) and (AWidth > 0) then\r\n        begin\r\n          AHeight := AOriginalWidth / AWidth * AHeight;\r\n          AWidth := AOriginalWidth;\r\n        end\r\n        else\r\n        if (AHeight >= AWidth) and (AHeight > 0) then\r\n        begin\r\n          AWidth := AOriginalHeight / AHeight * AWidth;\r\n          AHeight := AOriginalHeight;\r\n        end;\r\n\r\n        if AHeight = 0 then\r\n          ar := 1\r\n        else\r\n          ar := AWidth / AHeight;\r\n\r\n        if AOriginalHeight = 0 then\r\n          arc := 1\r\n        else\r\n          arc := AOriginalWidth / AOriginalHeight;\r\n\r\n        if (ar < 1) or (arc > ar) then\r\n        begin\r\n          AHeight := AOriginalWidth / ar;\r\n          AWidth := AOriginalWidth;\r\n        end\r\n        else\r\n        begin\r\n          AWidth := ar * AOriginalHeight;\r\n          AHeight := AOriginalHeight;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetBitmapDrawRectangle(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ABitmap: TTMSFNCDrawBitmap;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRect;\r\nbegin\r\n  Result := ConvertToRect(GetBitmapDrawRectangle(RectF(ALeft, ATop, ARight, ABottom), ABitmap, AAspectRatio, AStretch, ACenter, ACropping));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetBitmapDrawRectangle(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ABitmap: TTMSFNCDrawBitmap;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRectF;\r\nvar\r\n  bmp: TTMSFNCDrawBitmap;\r\n  rdest: TRectF;\r\n  w, h: Single;\r\n  x, y: Single;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  bmp := ABitmap;\r\n  if Assigned(bmp) then\r\n  begin\r\n    x := 0;\r\n    y := 0;\r\n    w := 0;\r\n    h := 0;\r\n    GetAspectSize(w, h, bmp.Width, bmp.Height, ARight - ALeft, ABottom - ATop, AAspectRatio, AStretch, ACropping);\r\n    if ACenter or ACropping then\r\n    begin\r\n      x := Round((ARight - ALeft - w) / 2);\r\n      y := Round((ABottom - ATop - h) / 2);\r\n    end;\r\n\r\n    rdest := RectF(ALeft + x, ATop + y, ALeft + x + w, ATop + y + h);\r\n    Result := rdest;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetBitmapDrawRectangle(ARect: TRect; ABitmap: TTMSFNCDrawBitmap;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRect;\r\nbegin\r\n  Result := ConvertToRect(GetBitmapDrawRectangle(ConvertToRectF(ARect), ABitmap, AAspectRatio, AStretch, ACenter, ACropping));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetBitmapDrawRectangle(ARect: TRectF; ABitmap: TTMSFNCDrawBitmap;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False): TRectF;\r\nbegin\r\n  Result := GetBitmapDrawRectangle(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, ABitmap, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetContext: TTMSFNCGraphicsContext;\r\nbegin\r\n  if FNative then\r\n    Result := FContextNative\r\n  else\r\n    Result := FContextGeneral;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.GetCanvas: TCanvas;\r\nbegin\r\n  Result := FActiveCanvas;\r\nend;\r\n\r\n{$IFNDEF LIMITEDGRAPHICSMODE}\r\nclass function TTMSFNCGraphics.GetScaledBitmap(ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0; ABitmapContainer: TTMSFNCBitmapContainer = nil): TTMSFNCBitmap;\r\nvar\r\n  b: TTMSFNCScaledBitmap;\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(ABitmaps) then\r\n  begin\r\n    if AScale > 0 then\r\n      b := ABitmaps.GetItemByScale(AScale)\r\n    else\r\n      b := ABitmaps.GetItemByScale(TTMSFNCUtils.GetDPIScale);\r\n\r\n    if Assigned(b) then\r\n    begin\r\n      if Assigned(b.Bitmap) and not IsBitmapEmpty(b.Bitmap) then\r\n        Result := b.Bitmap\r\n      else\r\n      begin\r\n        bmp := GetBitmapFromBitmapContainer(ABitmapContainer, b.BitmapName, True, AScale);\r\n        if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n          Result := bmp\r\n        else\r\n        begin\r\n          bmp := GetBitmapFromBitmapContainer(ABitmapContainer, b.BitmapName, False);\r\n          if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n            Result := bmp\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCGraphics.ApplyHilight(AText: string; AHilight: string; ATag: string; ADoCase: Boolean): String;\r\nbegin\r\n  Result := HiLight(AText, AHilight, ATag, ADoCase);\r\nend;\r\n\r\nclass function TTMSFNCGraphics.GetBitmapFromBitmapContainer(ABitmapContainer: TTMSFNCBitmapContainer; AName: string; AApplyScale: Boolean = False; AScale: Single = 0): TTMSFNCBitmap;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(ABitmapContainer) and (AName <> '') then\r\n  begin\r\n    if AApplyScale then\r\n    begin\r\n      if AScale > 0 then\r\n        Result := ABitmapContainer.FindBitmap(AName + '_' + FloatToStr(AScale))\r\n      else\r\n        Result := ABitmapContainer.FindBitmap(AName + '_' + FloatToStr(TTMSFNCUtils.GetDPIScale));\r\n    end;\r\n\r\n    if not Assigned(Result) then\r\n      Result := ABitmapContainer.FindBitmap(AName);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapWithName(ARect: TRect; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmapWithName(ConvertToRectF(ARect), ABitmapName, AApplyScale, AScale, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapWithName(ARect: TRectF; ABitmapName: string; AApplyScale: Boolean = False; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nvar\r\n  b: TTMSFNCBitmap;\r\nbegin\r\n  b := GetBitmapFromBitmapContainer(FBitmapContainer, ABitmapName, AApplyScale, AScale);\r\n  if Assigned(b) then\r\n    DrawBitmap(ARect, BitmapToDrawBitmap(b), AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapWithName(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ABitmapName: string;\r\n  AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True;\r\n  ACropping: Boolean = False);\r\nbegin\r\n  DrawBitmapWithName(RectF(ALeft, ATop, ARight, ABottom), ABitmapName, AApplyScale, AScale, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawBitmapWithName(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ABitmapName: string;\r\n  AApplyScale: Boolean = False; AScale: Single = 0; AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True;\r\n  ACropping: Boolean = False);\r\nvar\r\n  b: TTMSFNCBitmap;\r\nbegin\r\n  b := GetBitmapFromBitmapContainer(FBitmapContainer, ABitmapName, AApplyScale, AScale);\r\n  if Assigned(b) then\r\n    DrawBitmap(ALeft, ATop, ARight, ABottom, BitmapToDrawBitmap(b), AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawScaledBitmap(ARect: TRect; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawScaledBitmap(ConvertToRectF(ARect), ABitmaps, AScale, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawScaledBitmap(ARect: TRectF; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nvar\r\n  b: TTMSFNCScaledBitmap;\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  if Assigned(ABitmaps) then\r\n  begin\r\n    if AScale > 0 then\r\n      b := ABitmaps.GetItemByScale(AScale)\r\n    else\r\n      b := ABitmaps.GetItemByScale(TTMSFNCUtils.GetDPIScale);\r\n\r\n    if Assigned(b) then\r\n    begin\r\n      if Assigned(b.Bitmap) and not IsBitmapEmpty(b.Bitmap) then\r\n        DrawBitmap(ARect, BitmapToDrawBitmap(b.Bitmap), AAspectRatio, AStretch, ACenter, ACropping)\r\n      else\r\n      begin\r\n        bmp := GetBitmapFromBitmapContainer(FBitmapContainer, b.BitmapName, True, AScale);\r\n        if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n          DrawBitmap(ARect, BitmapToDrawBitmap(bmp), AAspectRatio, AStretch, ACenter, ACropping)\r\n        else\r\n          DrawBitmapWithName(ARect, b.BitmapName, False, b.Scale, AAspectRatio, AStretch, ACenter, ACropping);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawScaledBitmap(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nbegin\r\n  DrawScaledBitmap(RectF(ALeft, ATop, ARight, ABottom), ABitmaps, AScale, AAspectRatio, AStretch, ACenter, ACropping);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawScaledBitmap(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; ABitmaps: TTMSFNCScaledBitmaps; AScale: Single = 0;\r\n  AAspectRatio: Boolean = True; AStretch: Boolean = False; ACenter: Boolean = True; ACropping: Boolean = False);\r\nvar\r\n  b: TTMSFNCScaledBitmap;\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  if Assigned(ABitmaps) then\r\n  begin\r\n    if AScale > 0 then\r\n      b := ABitmaps.GetItemByScale(AScale)\r\n    else\r\n      b := ABitmaps.GetItemByScale(TTMSFNCUtils.GetDPIScale);\r\n\r\n    if Assigned(b) then\r\n    begin\r\n      if Assigned(b.Bitmap) and not IsBitmapEmpty(b.Bitmap) then\r\n        DrawBitmap(ALeft, ATop, ARight, ABottom, BitmapToDrawBitmap(b.Bitmap), AAspectRatio, AStretch, ACenter, ACropping)\r\n      else\r\n      begin\r\n        bmp := GetBitmapFromBitmapContainer(FBitmapContainer, b.BitmapName, True, AScale);\r\n        if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n          DrawBitmap(ALeft, ATop, ARight, ABottom, BitmapToDrawBitmap(bmp), AAspectRatio, AStretch, ACenter, ACropping)\r\n        else\r\n          DrawBitmapWithName(ALeft, ATop, ARight, ABottom, b.BitmapName, False, b.Scale, AAspectRatio, AStretch, ACenter, ACropping);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCGraphics.ClipRect(ARect: TRect);\r\nbegin\r\n  ClipRect(ConvertToRect(ARect));\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.ClipRect(ARect: TRectF);\r\nbegin\r\n  Context.ClipRect(ARect);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawFocusPath(APath: TTMSFNCGraphicsPath; AColor: TTMSFNCGraphicsColor = gcBlack);\r\nbegin\r\n  Context.DrawFocusPath(FStroke, APath, AColor);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawFocusRectangle(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; AColor: TTMSFNCGraphicsColor = gcBlack; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawFocusRectangle(Rect(ALeft, ATop, ARight, ABottom), AColor, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawFocusRectangle(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; AColor: TTMSFNCGraphicsColor = gcBlack; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := RectF(ALeft, ATop, ARight, ABottom);\r\n  Context.DrawFocusRectangle(FStroke, r, AColor, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawFocusRectangle(ARect: TRect; AColor: TTMSFNCGraphicsColor = gcBlack; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawFocusRectangle(ConvertToRectF(ARect), AColor, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawFocusRectangle(ARect: TRectF; AColor: TTMSFNCGraphicsColor = gcBlack; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawFocusRectangle(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, AColor, AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.FontChanged(Sender: TObject);\r\nbegin\r\n  SetFont(Sender as TTMSFNCGraphicsFont);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.StrokeChanged(Sender: TObject);\r\nbegin\r\n  SetStroke(Sender as TTMSFNCGraphicsStroke);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.FillChanged(Sender: TObject);\r\nbegin\r\n  SetFill(Sender as TTMSFNCGraphicsFill);\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ALeft, ATop, ARight, ABottom: Integer; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  AControlID, AControlValue, AControlType: string;\r\nbegin\r\n  AControlID := '';\r\n  AControlValue := '';\r\n  AControlType := '';\r\n  Result := DrawText(RectF(ALeft, ATop, ARight, ABottom), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming,\r\n    AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ALeft, ATop, ARight, ABottom: Double; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  AControlID, AControlValue, AControlType: string;\r\nbegin\r\n  AControlID := '';\r\n  AControlValue := '';\r\n  AControlType := '';\r\n  Result := DrawText(RectF(ALeft, ATop, ARight, ABottom), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming,\r\n    AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ALeft, ATop, ARight, ABottom: Integer; AText: String; var AControlID: string; var AControlValue: string; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nbegin\r\n  Result := DrawText(RectF(ALeft, ATop, ARight, ABottom), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming,\r\n    AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ALeft, ATop, ARight, ABottom: Double; AText: String; var AControlID: string; var AControlValue: string; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nbegin\r\n  Result := DrawText(RectF(ALeft, ATop, ARight, ABottom), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming,\r\n    AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.InitializeDefaultAppearance;\r\nbegin\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  FURLColor := gcBlue;\r\n  FURLUnderline := True;\r\n  {$ENDIF}\r\n  SetFill(Fill);\r\n  SetStroke(Stroke);\r\n  SetFont(Font);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nclass function TTMSFNCGraphics.GetColorAlpha(AColor: TTMSFNCGraphicsColor): Byte;\r\nbegin\r\n  Result := TAlphaColorRec(AColor).A;\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCGraphics.GetColorRed(AColor: TTMSFNCGraphicsColor): Byte;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := TAlphaColorRec(AColor).R;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  AColor := ColorToRGB(AColor);\r\n  Result := GetRValue(AColor);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCGraphics.GetColorGreen(AColor: TTMSFNCGraphicsColor): Byte;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := TAlphaColorRec(AColor).G;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  AColor := ColorToRGB(AColor);\r\n  Result := GetGValue(AColor);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCGraphics.GetColorBlue(AColor: TTMSFNCGraphicsColor): Byte;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := TAlphaColorRec(AColor).B;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  AColor := ColorToRGB(AColor);\r\n  Result := GetBValue(AColor);\r\n  {$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCGraphics.TextToColor(AText: string): TTMSFNCGraphicsColor;\r\nvar\r\n  i: integer;\r\n  s: string;\r\n  c: TStringList;\r\nbegin\r\n  s := AText;\r\n\r\n  s := LowerCase(s);\r\n  if pos('cl',s) = 1 then\r\n    Delete(s,1,2);\r\n\r\n  if pos('cla',s) = 1 then\r\n    Delete(s,1,3);\r\n\r\n  if pos('gc',s) = 1 then\r\n    Delete(s,1,2);\r\n\r\n  Result := gcBlack;\r\n  c := ColorLookup;\r\n  if Assigned(c) then\r\n  begin\r\n    i := c.IndexOf(LowerCase(s));\r\n    if (i >= 0) and (i <= c.Count - 1) then\r\n      Result := TTMSFNCGraphicsColorObject(c.Objects[i]).Color;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCGraphics.HTMLToColor(AHTML: string): TTMSFNCGraphicsColor;\r\n\r\nfunction HexVal(s:string): Integer;\r\nvar\r\n  i,j: Integer;\r\n  i1, i2: Integer;\r\nbegin\r\n  if Length(s) < 2 then\r\n  begin\r\n    Result := 0;\r\n    Exit;\r\n  end;\r\n\r\n  {$IFDEF FMXMOBILE}\r\n  i1 := 0;\r\n  i2 := 1;\r\n  {$ELSE}\r\n  i1 := 1;\r\n  i2 := 2;\r\n  {$ENDIF}\r\n\r\n  if s[i1] >= 'A' then\r\n    i := ord(s[i1]) - ord('A') + 10\r\n  else\r\n    i := ord(s[i1]) - ord('0');\r\n\r\n  if s[i2] >= 'A' then\r\n    j := ord(s[i2]) - ord('A') + 10\r\n  else\r\n    j := ord(s[i2]) - ord('0');\r\n\r\n  Result := i shl 4 + j;\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  r,g,b: Integer;\r\nbegin\r\n  r := Hexval(Copy(AHTML,2,2));\r\n  g := Hexval(Copy(AHTML,4,2)) shl 8;\r\n  b := Hexval(Copy(AHTML,6,2)) shl 16;\r\n  Result := TColor(b + g + r);\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nconst\r\n  Alpha = TTMSFNCGraphicsColor($FF000000);\r\nvar\r\n  r,g,b: Integer;\r\nbegin\r\n  r := Hexval(Copy(AHTML,2,2)) shl 16;\r\n  g := Hexval(Copy(AHTML,4,2)) shl 8;\r\n  b := Hexval(Copy(AHTML,6,2));\r\n  Result := Alpha or TTMSFNCGraphicsColor(b + g + r);\r\n{$ENDIF}\r\nend;\r\n\r\nclass function TTMSFNCGraphics.ColorToHTML(AColor: TTMSFNCGraphicsColor): string;\r\nconst\r\n  HTMLHexColor = '#RRGGBB';\r\n  HexDigit: array[0..$F] of Char = '0123456789ABCDEF';\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\n  i: Integer;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  i := 0;\r\n  {$ELSE}\r\n  i := 1;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FMXLIB}\r\n  c := AColor;\r\n  {$ENDIF}\r\n  {$IFNDEF FMXLIB}\r\n  c := ColorToRGB(AColor);\r\n  {$ENDIF}\r\n  Result := HtmlHexColor;\r\n  Result[1 + i] := HexDigit[GetColorRed(c) shr 4];\r\n  Result[2 + i] := HexDigit[GetColorRed(c) and $F];\r\n  Result[3 + i] := HexDigit[GetColorGreen(c) shr 4];\r\n  Result[4 + i] := HexDigit[GetColorGreen(c) and $F];\r\n  Result[5 + i] := HexDigit[GetColorBlue(c) shr 4];\r\n  Result[6 + i] := HexDigit[GetColorBlue(c) and $F];\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawTexture(ARect: TRectF; ATexture: TTMSFNCBitmap; ATextureMode: TTMSFNCGraphicsTextureMode);\r\nvar\r\n  LR, R, IR: TRectF;\r\n  I, J: Integer;\r\nbegin\r\n  if IsBitmapEmpty(ATexture) then\r\n    Exit;\r\n\r\n  LR := ARect;\r\n  case ATextureMode of\r\n    gtmOriginal:\r\n    begin\r\n      R := RectF(ARect.Left, ARect.Top, ARect.Left + ATexture.Width, ARect.Top + ATexture.Height);\r\n      IntersectRectEx(IR, LR, R);\r\n      DrawBitmapPart(RectF(0, 0, (IR.Right - IR.Left), (IR.Bottom - IR.Top)), RectF(R.Left, R.Top, R.Left + (IR.Right - IR.Left), R.Top + (IR.Bottom - IR.Top)), BitmapToDrawBitmap(ATexture), False, False, False, False);\r\n    end;\r\n    gtmFit:\r\n    begin\r\n      R := RectF(0, 0, ATexture.Width, ATexture.Height);\r\n      R := RectSnapToPixelEx(RectFitIntoEx(R, ARect), 1, False);\r\n      DrawBitmapPart(RectF(0, 0, ATexture.Width, ATexture.Height), R, BitmapToDrawBitmap(ATexture), False, True, False, False);\r\n    end;\r\n    gtmStretch: DrawBitmapPart(RectF(0, 0, ATexture.Width, ATexture.Height), ARect, BitmapToDrawBitmap(ATexture), False, True, False, False);\r\n    gtmTile:\r\n    begin\r\n      for I := 0 to Trunc((LR.Right - LR.Left) / ATexture.Width) + 1 do\r\n      begin\r\n        for J := 0 to Trunc((LR.Bottom - LR.Top) / ATexture.Height) + 1 do\r\n        begin\r\n          R := RectF(LR.Left, LR.Top, LR.Left + ATexture.Width, LR.Top + ATexture.Height);\r\n          OffsetRectEx(R, I * ATexture.Width, J * ATexture.Height);\r\n          IntersectRectEx(IR, LR, R);\r\n          if IntersectRectEx(IR, R) then\r\n            DrawBitmap(RectF(R.Left, R.Top, (R.Left + (IR.Right - IR.Left)), (R.Top + (IR.Bottom - IR.Top))), BitmapToDrawBitmap(ATexture), False, False, False, False);\r\n        end;\r\n      end;\r\n    end;\r\n    gtmCenter:\r\n    begin\r\n      R := RectF(0, 0, ATexture.Width, ATexture.Height);\r\n      R := RectSnapToPixelEx(RectCenterAtEx(R, ARect), 1, False);\r\n      DrawBitmapPart(RectF(0, 0, ATexture.Width, ATexture.Height), R, BitmapToDrawBitmap(ATexture), True, False, True, False);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ARect: TRect; AText: String; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  AControlID, AControlValue, AControlType: string;\r\nbegin\r\n  AControlID := '';\r\n  AControlValue := '';\r\n  AControlType := '';\r\n  Result := DrawText(ConvertToRectF(ARect), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming, AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ARect: TRect; AText: String; var AControlID: string; var AControlValue: string; var AControlType: string; AWordWrapping: Boolean = False; AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nbegin\r\n  Result := DrawText(ConvertToRectF(ARect), AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming, AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(APoint: TPointF; AText: String; AAngle: Single = 0{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  AControlID, AControlValue, AControlType: string;\r\nbegin\r\n  AControlID := '';\r\n  AControlValue := '';\r\n  AControlType := '';\r\n  Result := DrawText(RectF(APoint.X, APoint.Y, APoint.X + 10000, APoint.Y + 10000), AText, AControlID, AControlValue, AControlType, False, gtaLeading, gtaLeading, gttNone, AAngle, -1, -1{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ARect: TRectF; AText: String; AWordWrapping: Boolean = False;AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  AControlID, AControlValue, AControlType: string;\r\nbegin\r\n  AControlID := '';\r\n  AControlValue := '';\r\n  AControlType := '';\r\n  Result := DrawText(ARect, AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming, AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.DrawText(ARect: TRectF; AText: String; var AControlID: string; var AControlValue: string; var AControlType: string; AWordWrapping: Boolean = False;AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n  lst: TStringList;\r\n  i, l, p: Integer;\r\n  b: Boolean;\r\n  r, rd: TRectF;\r\nconst\r\n  arr: array[0..1] of string = ('<BR>', '<BR/>');\r\nbegin\r\n  rd := ARect;\r\n\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  b := (not ATestAnchor) and OptimizedHTMLDrawing;\r\n  {$ELSE}\r\n  b := OptimizedHTMLDrawing;\r\n  {$ENDIF}\r\n\r\n  b := b and TTMSFNCUtils.IsHTML(AText);\r\n\r\n  if b then\r\n  begin\r\n    for I := 0 to Length(arr) - 1 do\r\n    begin\r\n      p := Pos(arr[I], UpperCase(AText));\r\n      l := Length(arr[I]);\r\n    end;\r\n\r\n    if (p > 0) and (l > 0) then\r\n    begin\r\n      lst := TStringList.Create;\r\n      try\r\n        lst.LineBreak := Copy(AText, p, l);\r\n        lst.Text := AText;\r\n\r\n        for I := 0 to lst.Count - 1 do\r\n        begin\r\n          r := CalculateText(lst[I], rd, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\n          InternalDrawText(RectF(r.Left, r.Top, r.Right + 1, r.Bottom), lst[I], AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign,\r\n            ATrimming, AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\n\r\n          rd.Top := rd.Top + (r.Bottom - r.Top);\r\n        end;\r\n\r\n      finally\r\n        lst.Free;\r\n      end;\r\n    end\r\n    else\r\n      b := False;\r\n  end;\r\n\r\n  if not b then\r\n  begin\r\n    Result := InternalDrawText(ARect, AText, AControlID, AControlValue, AControlType, AWordWrapping, AHorizontalAlign, AVerticalAlign,\r\n      ATrimming, AAngle, AMinWidth, AMinHeight{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML, ATestAnchor, AX, AY{$ENDIF});\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.InternalDrawText(ARect: TRectF; AText: String; var AControlID: string; var AControlValue: string; var AControlType: string; AWordWrapping: Boolean = False;AHorizontalAlign: TTMSFNCGraphicsTextAlign = gtaLeading;\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign = gtaCenter; ATrimming: TTMSFNCGraphicsTextTrimming = gttNone; AAngle: Single = 0;\r\n  AMinWidth: Single = -1; AMinHeight: Single = -1{$IFNDEF LIMITEDGRAPHICSMODE};ASupportHTML: Boolean = True; ATestAnchor: Boolean = False; AX: Single = -1; AY: Single = - 1{$ENDIF}): String;\r\nvar\r\n{$IFNDEF LIMITEDGRAPHICSMODE}\r\n  a, s: String;\r\n  fa: String;\r\n  XSize, YSize: Single;\r\n  hl, ml: Integer;\r\n  hr, cr: TRectF;\r\n  xs, ys: Single;\r\n  lc: Integer;\r\n  htmlr: TRectF;\r\n  isanchor: boolean;\r\n  st: TTMSFNCGraphicsSaveState;\r\n{$ENDIF}\r\n  oldc: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n\r\n  oldc := Context.GetFillColor;\r\n  Context.SetFillColor(FFont.Color);\r\n\r\n  {$IFDEF WEBLIB}\r\n  if (AMinHeight > -1) and (ARect.Bottom - ARect.Top < AMinHeight) then\r\n    ARect.Bottom := ARect.Top + AMinHeight;\r\n\r\n  if (AMinWidth > -1) and (ARect.Right - ARect.Left < AMinWidth) then\r\n    ARect.Right := ARect.Left + AMinWidth;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  if (AMinHeight > -1) and (ARect.Height < AMinHeight) then\r\n    ARect.Height := AMinHeight;\r\n\r\n  if (AMinWidth > -1) and (ARect.Width < AMinWidth) then\r\n    ARect.Width := AMinWidth;\r\n  {$ENDIF}\r\n\r\n  ARect := Context.SetTextAngle(ARect, AAngle);\r\n\r\n  Result := '';\r\n\r\n  {$IFNDEF LIMITEDGRAPHICSMODE}\r\n  if ((AnsiPos('</', AText) > 0) or (AnsiPos('/>', AText)  > 0) or (AnsiPos('<BR>', UpperCase(AText)) > 0)) and ASupportHTML then\r\n  begin\r\n    hr := RectF(0, 0, 0, 0);\r\n    XSize := 0;\r\n    YSize := 0;\r\n    hl := -1;\r\n    ml := -1;\r\n    fa := '';\r\n    s := '';\r\n    a := '';\r\n    lc := 0;\r\n    cr := RectF(0, 0, 0, 0);\r\n    AControlID := '';\r\n    AControlValue := '';\r\n    AControlType := '';\r\n    HTMLDrawEx(Self, AText, ARect,0, 0,-1,-1,0,False,True,False,False,False,False,AWordWrapping,False, '', 1.0,URLColor,\r\n        gcNull,gcNull,gcNull,a,s,fa,XSize,YSize,hl,ml,hr, cr, AControlID, AControlValue, AControlType, lc, 0, FBitmapContainer, 1, URLUnderline{$IFDEF CMNLIB}, FImageList{$ENDIF},\r\n        HighlightColor, HighlightTextColor, HighlightFontStyle);\r\n\r\n    YSize := YSize + 1;\r\n\r\n    if (AWordWrapping and (lc <= 1)) or (not AWordWrapping) then\r\n    begin\r\n      xs := ARect.Left;\r\n      ys := ARect.Top;\r\n\r\n      case AHorizontalAlign of\r\n        gtaCenter: xs := xs + ((ARect.Right - ARect.Left) - XSize) / 2;\r\n        gtaTrailing: xs := ARect.Left + (ARect.Right - ARect.Left) - XSize;\r\n      end;\r\n\r\n      case AVerticalAlign of\r\n        gtaCenter: ys := ys + ((ARect.Bottom - ARect.Top) - YSize) / 2;\r\n        gtaTrailing: ys := ys + (ARect.Bottom - ARect.Top) - YSize;\r\n      end;\r\n\r\n      htmlr := RectF(xs, ys, xs + XSize, ys + YSize);\r\n    end\r\n    else\r\n      htmlr := ARect;\r\n\r\n    st := SaveState(True);\r\n    ClipRect(ARect);\r\n    isanchor := HTMLDrawEx(Self, AText, htmlr,Round(AX), Round(AY),-1,-1,0,ATestAnchor,False,False,False,False,False,AWordWrapping,False, '', 1.0,URLColor,\r\n        gcNull,gcNull,gcNull,a,s,fa,XSize,YSize,hl,ml,hr,cr, AControlID, AControlValue, AControlType, lc, 0, FBitmapContainer, 1, URLUnderline{$IFDEF CMNLIB}, FImageList{$ENDIF},\r\n        HighlightColor, HighlightTextColor, HighlightFontStyle);\r\n    RestoreState(st, True);\r\n\r\n    if isanchor then\r\n      Result := a;\r\n  end\r\n  else if not ATestAnchor then\r\n  {$ENDIF}\r\n    Context.DrawText(AText, ARect, AWordWrapping, AHorizontalAlign, AVerticalAlign, ATrimming, AAngle);\r\n\r\n  Context.ResetTextAngle(AAngle);\r\n  Context.SetFillColor(oldc);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawEllipse(ALeft: Integer; ATop: Integer; ARight: Integer; ABottom: Integer; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawEllipse(RectF(ALeft, ATop, ARight, ABottom), AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawEllipse(ALeft: Double; ATop: Double; ARight: Double; ABottom: Double; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nvar\r\n  r: TRectF;\r\n  pth: TTMSFNCGraphicsPath;\r\nbegin\r\n  r := RectF(ALeft, ATop, ARight, ABottom);\r\n  if ((FFill.Color <> gcNull) and (FFill.Kind <> gfkNone)) or (FFill.Kind = gfkTexture) then\r\n  begin\r\n    case FFill.Kind of\r\n      gfkTexture:\r\n      begin\r\n        pth := TTMSFNCGraphicsPath.Create;\r\n        try\r\n          pth.AddEllipse(r);\r\n          DrawTexture(r, FFill.Texture, FFill.TextureMode);\r\n        finally\r\n          pth.Free;\r\n        end;\r\n      end;\r\n      else\r\n        Context.FillEllipse(FFill, r, AModifyRectMode);\r\n    end;\r\n  end;\r\n\r\n  if (FStroke.Color <> gcNull) and (FStroke.Kind <> gskNone) then\r\n    Context.DrawEllipse(FStroke, r, AModifyRectMode);\r\nend;\r\n\r\nclass procedure TTMSFNCGraphics.SetDefaultGraphicColors;\r\nbegin\r\n  TTMSFNCGraphics.DefaultPopupFillColor := gcWhite;\r\n  TTMSFNCGraphics.DefaultPopupStrokeColor := gcSilver;\r\n  TTMSFNCGraphics.DefaultButtonFillColor := MakeGraphicsColor(225, 225, 225);\r\n  TTMSFNCGraphics.DefaultButtonStrokeColor := gcDarkgray;\r\n  TTMSFNCGraphics.DefaultTextFontColor := gcBlack;\r\n  TTMSFNCGraphics.DefaultSelectionFillColor := gcBlack;\r\n  TTMSFNCGraphics.DefaultButtonFillColorFocused := MakeGraphicsColor(229, 241, 251);\r\n  TTMSFNCGraphics.DefaultButtonStrokeColorFocused := MakeGraphicsColor(60, 127, 177);\r\n  TTMSFNCGraphics.DefaultButtonStrokeColorDisabled := gcDarkGray;\r\n  TTMSFNCGraphics.DefaultButtonFillColorDisabled := gcLightgray;\r\nend;\r\n\r\nclass procedure TTMSFNCGraphics.ConvertBitmapToGrayScale(ABitmap: TTMSFNCBitmap);\r\ntype\r\n  TTMSFNCGraphicsColorToGrayscale = (ctgLightness, ctgAverage, ctgLuminosity);\r\n\r\n  function MinColor(const A, B, C: Integer): Integer;\r\n  begin\r\n    Result := Min(A, Min(B, C));\r\n  end;\r\n\r\n  function MaxColor(const A, B, C: Integer): Integer;\r\n  begin\r\n    Result := Max(A, Max(B, C));\r\n  end;\r\n\r\n  function ColorToGray(AColor: TTMSFNCGraphicsColor; AMode: TTMSFNCGraphicsColorToGrayscale = ctgLuminosity): TTMSFNCGraphicsColor;\r\n  var\r\n    R, G, B, X: Byte;\r\n    {$IFNDEF CMNLIB}\r\n    A: Byte;\r\n    {$ENDIF}\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    R := TAlphaColorRec(AColor).R;\r\n    G := TAlphaColorRec(AColor).G;\r\n    B := TAlphaColorRec(AColor).B;\r\n    A := TAlphaColorRec(AColor).A;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    R := AColor and $FF;\r\n    G := (AColor and $FF00) shr 8;\r\n    B := (AColor and $FF0000) shr 16;\r\n    {$ENDIF}\r\n    case AMode of\r\n      ctgLightness: X := (MaxColor(R, G, B) + MinColor(R, G, B)) div 2;\r\n      ctgAverage: X := (R + G + B) div 3;\r\n      ctgLuminosity: X := Round(0.21 *R + 0.71*G + 0.07*B);\r\n      else\r\n        X := 0;\r\n    end;\r\n    {$IFDEF FMXLIB}\r\n    Result := MakeGraphicsColor(X, X, X, A);\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    Result := TTMSFNCGraphicsColor(RGB(X, X, X));\r\n    {$ENDIF}\r\n  end;\r\n\r\nvar\r\n  I, J: Integer;\r\n  {$IFDEF FMXLIB}\r\n  m: TBitmapData;\r\n  {$ENDIF}\r\nbegin\r\n  if Assigned(ABitmap) and not IsBitmapEmpty(ABitmap) then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    if ABitmap.Map(TMapAccess.ReadWrite, m) then\r\n    begin\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    begin\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    begin\r\n    {$ENDIF}\r\n      for I := 0 to ABitmap.Width - 1 do\r\n      begin\r\n        for J := 0 to ABitmap.Height - 1 do\r\n        begin\r\n          {$IFDEF CMNLIB}\r\n          ABitmap.Bitmap.Canvas.Pixels[I, J] := ColorToGray(ABitmap.Bitmap.Canvas.Pixels[I, J]);\r\n          {$ENDIF}\r\n          {$IFDEF FMXLIB}\r\n          m.SetPixel(I, J, ColorToGray(m.GetPixel(I, J)));\r\n          {$ENDIF}\r\n        end;\r\n      end;\r\n      {$IFDEF FMXLIB}\r\n      ABitmap.Unmap(m);\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass procedure TTMSFNCGraphics.DrawSample(ACanvas: TCanvas; ARect: TRectF);\r\nvar\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  g := TTMSFNCGraphics.Create(ACanvas);\r\n  try\r\n    g.Font.Name := 'Courier New';\r\n    g.Font.Size := 20;\r\n    g.Font.Color := gcWhite;\r\n    g.Fill.Kind := gfkGradient;\r\n    g.Fill.Color := gcDarkorange;\r\n    g.Fill.ColorTo := gcSteelblue;\r\n    g.Stroke.Color := gcDarkblue;\r\n    g.DrawRectangle(ARect);\r\n    g.DrawText(ARect, 'Sample', False, gtaCenter);\r\n  finally\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInPolygon(APoint: TPoint; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nbegin\r\n  Result := PointInPolygon(ConvertToPointF(APoint), APolygon);\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInPolygon(APoint: TPointF; APolygon: TTMSFNCGraphicsPathPolygon): Boolean;\r\nbegin\r\n  Result := PointInPolygon(APoint, APolygon);\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInRect(APoint: TPoint; ARect: TRect): Boolean;\r\nbegin\r\n  Result := PointInRect(ConvertToPointF(APoint), ConvertToRectF(ARect));\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInRect(APoint: TPointF; ARect: TRectF): Boolean;\r\nbegin\r\n  Result := PtInRectEx(ARect, APoint);\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInPath(APoint: TPoint; APath: TTMSFNCGraphicsPath): Boolean;\r\nbegin\r\n  Result := PointInPath(ConvertToPointF(APoint), APath);\r\nend;\r\n\r\nclass function TTMSFNCGraphics.PointInPath(APoint: TPointF; APath: TTMSFNCGraphicsPath): Boolean;\r\nbegin\r\n  Result := APath.IsPointVisible(APoint);\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextSizeInt(AText: String): TSize;\r\nbegin\r\n  Result := ConvertToSize(CalculateTextSize(AText));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextSize(AText: String): TSizeF;\r\nbegin\r\n  Result := CalculateTextSize(AText, RectF(0, 0, 10000, 10000));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextHeightInt(AText: String): Integer;\r\nbegin\r\n  Result := Round(CalculateTextHeight(AText));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextHeight(AText: String): Single;\r\nbegin\r\n  Result := CalculateTextHeight(AText, RectF(0, 0, 10000, 10000));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextWidthInt(AText: String): Integer;\r\nbegin\r\n  Result := Round(CalculateTextWidth(AText));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextWidth(AText: String): Single;\r\nbegin\r\n  Result := CalculateTextWidth(AText, RectF(0, 0, 10000, 10000));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextSize(AText: String; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TSize;\r\nbegin\r\n  Result := ConvertToSize(CalculateTextSize(AText, ConvertToRectF(ARect), AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF}));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextSize(AText: String; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TSizeF;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := CalculateText(AText, ARect, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\n  Result.cx := r.Right - r.Left;\r\n  Result.cy := r.Bottom - r.Top;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextHeight(AText: String; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Integer;\r\nbegin\r\n  Result := Round(CalculateTextHeight(AText, ConvertToRectF(ARect), AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF}));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextHeight(AText: String; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Single;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := CalculateText(AText, ARect, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\n  Result := r.Bottom - r.Top;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextWidth(AText: String; ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Integer;\r\nbegin\r\n  Result := Round(CalculateTextWidth(AText, ConvertToRectF(ARect), AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF}));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextWidth(AText: String; ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): Single;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := CalculateText(AText, ARect, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\n  Result := r.Right - r.Left;\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateTextInt(AText: String): TRect;\r\nbegin\r\n  Result := ConvertToRect(CalculateText(AText));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateText(AText: String): TRectF;\r\nbegin\r\n  Result := CalculateText(AText, RectF(0, 0, 10000, 10000));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateText(AText: String;\r\n  ARect: TRect; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRect;\r\nbegin\r\n  Result := ConvertToRect(CalculateText(AText, ConvertToRectF(ARect), AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF}));\r\nend;\r\n\r\nfunction TTMSFNCGraphics.CalculateText(AText: String;\r\n  ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRectF;\r\nvar\r\n  lst: TStringList;\r\n  i, l, p: Integer;\r\n  b: Boolean;\r\n  r: TRectF;\r\nconst\r\n  arr: array[0..1] of string = ('<BR>', '<BR/>');\r\nbegin\r\n  Result := ARect;\r\n\r\n  b := OptimizedHTMLDrawing and TTMSFNCUtils.IsHTML(AText);\r\n  if b then\r\n  begin\r\n    for I := 0 to Length(arr) - 1 do\r\n    begin\r\n      p := Pos(arr[I], UpperCase(AText));\r\n      l := Length(arr[I]);\r\n    end;\r\n\r\n    if (p > 0) and (l > 0) then\r\n    begin\r\n      lst := TStringList.Create;\r\n      try\r\n        lst.LineBreak := Copy(AText, p, l);\r\n        lst.Text := AText;\r\n\r\n        Result.Bottom := 0;\r\n        for I := 0 to lst.Count - 1 do\r\n        begin\r\n          r := InternalCalculateText(lst[I], ARect, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\n          Result.Bottom := Result.Bottom + (r.Bottom - r.Top);\r\n        end;\r\n\r\n      finally\r\n        lst.Free;\r\n      end;\r\n    end\r\n    else\r\n      b := False;\r\n  end;\r\n\r\n  if not b then\r\n    Result := InternalCalculateText(AText, ARect, AWordWrapping{$IFNDEF LIMITEDGRAPHICSMODE}, ASupportHTML{$ENDIF});\r\nend;\r\n\r\nfunction TTMSFNCGraphics.InternalCalculateText(AText: String;\r\n  ARect: TRectF; AWordWrapping: Boolean = False{$IFNDEF LIMITEDGRAPHICSMODE}; ASupportHTML: Boolean = True{$ENDIF}): TRectF;\r\n{$IFNDEF LIMITEDGRAPHICSMODE}\r\nvar\r\n  a, s: String;\r\n  fa: String;\r\n  XSize, YSize: Single;\r\n  hl, ml: Integer;\r\n  hr, cr: TRectF;\r\n  lc: Integer;\r\n  AControlID, AControlType, AControlValue: string;\r\n{$ENDIF}\r\nbegin\r\n  Result := ARect;\r\n\r\n  if Round(Result.Right - Result.Left) <= 0 then\r\n  begin\r\n    Result.Bottom := Result.Top;\r\n    Exit;\r\n  end;\r\n\r\n  if AText <> '' then\r\n  begin\r\n    {$IFNDEF LIMITEDGRAPHICSMODE}\r\n    if ASupportHTML and ((AnsiPos('</', AText) > 0) or (AnsiPos('/>', AText)  > 0) or (AnsiPos('<BR>', UpperCase(AText)) > 0)) then\r\n    begin\r\n      hr := RectF(0, 0, 0, 0);\r\n      XSize := 0;\r\n      YSize := 0;\r\n      hl := -1;\r\n      ml := -1;\r\n      fa := '';\r\n      s := '';\r\n      a := '';\r\n      lc := 0;\r\n      cr := RectF(0, 0, 0, 0);\r\n      AControlID := '';\r\n      AControlValue := '';\r\n      AControlType := '';\r\n      HTMLDrawEx(Self, AText, ARect, 0, 0,-1,-1,0,False,True,False,False,False,False,AWordWrapping,False, '', 1.0,URLColor,\r\n        gcNull,gcNull,gcNull,a,s,fa,XSize,YSize,hl,ml,hr,cr, AControlID, AControlValue, AControlType, lc, 0, FBitmapContainer, 1, URLUnderline{$IFDEF CMNLIB}, FImageList{$ENDIF},\r\n        HighlightColor, HighlightTextColor, HighlightFontStyle);\r\n\r\n      YSize := YSize + 1;\r\n\r\n      Result.Right := Result.Left + XSize;\r\n      Result.Bottom := Result.Top + YSize;\r\n    end\r\n    else\r\n    {$ENDIF}\r\n    begin\r\n      Result := Context.CalculateText(AText, ARect, AWordWrapping);\r\n      Result.Bottom := Result.Bottom + 1;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    Result.Right := Result.Left;\r\n    Result.Bottom := Result.Top;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawEllipse(ARect: TRect; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawEllipse(ConvertToRectF(ARect), AModifyRectMode);\r\nend;\r\n\r\nprocedure TTMSFNCGraphics.DrawEllipse(ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll);\r\nbegin\r\n  DrawEllipse(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom, AModifyRectMode);\r\nend;\r\n\r\n{ TTMSFNCGraphicsContext }\r\n\r\nfunction TTMSFNCGraphicsContext.ConvertToPath(APath: TTMSFNCGraphicsPath; const Flatness: Single = 0.25): Pointer;\r\nvar\r\n  J, I: Integer;\r\n  BPts: TTMSFNCGraphicsPathPolygon;\r\n  B: TTMSFNCGraphicsPathCubicBezier;\r\n  F, Len: Single;\r\n  SegCount: Integer;\r\n  CurPoint: TPointF;\r\n  x: TPointF;\r\nbegin\r\n  Result := CreatePath;\r\n  PathOpen(Result);\r\n  if APath.Count > 0 then\r\n  begin\r\n    F := Max(Flatness, 0.05);\r\n    J := 0;\r\n    while J < APath.Count do\r\n    begin\r\n      case APath[J].Kind of\r\n        gppMoveTo:\r\n          begin\r\n            PathMoveTo(Result, APath[J].Point);\r\n            CurPoint := APath[J].Point;\r\n          end;\r\n        gppLineTo:\r\n          begin\r\n            PathLineTo(Result, APath[J].Point);\r\n            CurPoint := APath[J].Point;\r\n          end;\r\n        gppCurveTo:\r\n          begin\r\n            B[0] := CurPoint;\r\n            B[1] := APath[J].Point;\r\n            Inc(J);\r\n            B[2] := APath[J].Point;\r\n            Inc(J);\r\n            B[3] := APath[J].Point;\r\n            BPts := APath.CreateBezier(B, 6);\r\n            Len := 0;\r\n            for I := 0 to High(BPts) - 1 do\r\n            begin\r\n              x.X := BPts[I].X - BPts[I + 1].X;\r\n              x.Y := BPts[I].Y - BPts[I + 1].Y;\r\n              Len := Len + GetPointLength(x);\r\n            end;\r\n            SegCount := Round(Len / F);\r\n            if SegCount < 2 then\r\n              PathLineTo(Result, B[3])\r\n            else\r\n            begin\r\n              BPts := APath.CreateBezier(B, SegCount);\r\n              for I := 0 to High(BPts) do\r\n                PathLineTo(Result, BPts[I]);\r\n              CurPoint := APath[J].Point;\r\n            end;\r\n          end;\r\n        gppClose: PathClose(Result);\r\n      end;\r\n      Inc(J);\r\n    end;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCGraphicsContext.Create(const AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  FGraphics := AGraphics;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContext.GetGraphics: TTMSFNCGraphics;\r\nbegin\r\n  Result := FGraphics;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContext.GetCanvas: TCanvas;\r\nbegin\r\n  Result := Graphics.Canvas;\r\nend;\r\n\r\n{$IFDEF WEBLIB}\r\ninitialization\r\nbegin\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSCLOSE);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSDOWN);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSUP);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSRIGHT);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSLEFT);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSEXPAND);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSPIN);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSPIN2);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSDOWN);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSDOWN2);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSUP);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCGRAPHICSUP2);\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCBitmapContainer;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCTypes, WEBLib.TMSFNCCustomComponent, WEBLib.Controls\r\n  {$IFNDEF WEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  , Generics.Collections\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  , fgl\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 0; // Release nr.\r\n  BLD_VER = 0; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : First Release\r\n\r\ntype\r\n  TTMSFNCBitmapContainer = class;\r\n\r\n  ITMSFNCBitmapContainer = interface\r\n    ['{ED26710D-395F-4971-8AC9-A31083BF2A3C}']\r\n    procedure SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\n    function GetBitmapContainer: TTMSFNCBitmapContainer;\r\n    property BitmapContainer: TTMSFNCBitmapContainer read GetBitmapContainer write SetBitmapContainer;\r\n  end;\r\n\r\n  TTMSFNCBitmapItem = class(TCollectionItem)\r\n  private\r\n    FBitmap: TTMSFNCBitmap;\r\n    FTag: NativeInt;\r\n    FName: string;\r\n    procedure SetBitmap(const Value: TTMSFNCBitmap);\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure DoBitmapChanged(Sender: TObject); virtual;\r\n    procedure Assign(Source: TPersistent); override;\r\n    function GetDisplayName: string; override;\r\n  published\r\n    property Bitmap: TTMSFNCBitmap read FBitmap write SetBitmap;\r\n    property Name: string read FName write FName;\r\n    property Tag: NativeInt read FTag write FTag;\r\n  end;\r\n\r\n  TTMSFNCBitmapCollection = class(TOwnedCollection)\r\n  private\r\n    FOwner: TTMSFNCBitmapContainer;\r\n    function GetItemEx(Index: Integer): TTMSFNCBitmapItem;\r\n    procedure SetItemEx(Index: Integer; const Value: TTMSFNCBitmapItem);\r\n  protected\r\n    function GetBitmapItemClass: TCollectionItemClass; virtual;\r\n  public\r\n    constructor Create(AOwner: TTMSFNCBitmapContainer);\r\n    function Add: TTMSFNCBitmapItem;\r\n    function Insert(index: Integer): TTMSFNCBitmapItem;\r\n    property Items[Index: Integer]: TTMSFNCBitmapItem read GetItemEx write SetItemEx; default;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TControlList = class(TList);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TControlList = class(TList<TControl>);\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FMXLIB}\r\n  TWinControl = TControl;\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCBitmapContainer = class(TTMSFNCCustomComponent)\r\n  private\r\n    FControls: TControlList;\r\n    FItems: TTMSFNCBitmapCollection;\r\n    FOnBitmapChanged: TNotifyEvent;\r\n    procedure SetItems(const Value: TTMSFNCBitmapCollection);\r\n    function GetBitmapName(AIndex: Integer): String;\r\n    function GetBitmap(AIndex: Integer): TTMSFNCBitmap;\r\n    function GetItems: TTMSFNCBitmapCollection;\r\n  protected\r\n    function GetInstance: NativeUInt; override;\r\n    function GetVersion: string; override;\r\n    function CreateItems: TTMSFNCBitmapCollection; virtual;\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure DoBitmapChanged(Sender: TObject);\r\n    procedure InvalidateMembers(AControl: TWinControl); virtual;\r\n  public\r\n    constructor Create; reintroduce; overload; virtual;\r\n    constructor Create(AOwner: TComponent); overload; override;\r\n    destructor Destroy; override;\r\n    procedure Changed; virtual;\r\n    procedure RegisterControl(AControl: TControl);\r\n    function FindBitmap(s: string): TTMSFNCBitmap; virtual;\r\n    function ItemCount: Integer;\r\n    function RandomBitmapName: string;\r\n    function RandomBitmap: TTMSFNCBitmap;\r\n    procedure AddFromURL({%H-}URL, {%H-}BitmapName: string); virtual;\r\n    procedure AddFromResource(ResourceName, BitmapName: string; AInstance: NativeUInt); overload;\r\n    procedure AddFromResource(ResourceName, BitmapName: string); overload;\r\n    {$IFNDEF WEBLIB}\r\n    procedure AddFromFile(FileName, BitmapName: String);\r\n    procedure AddFromFolder(AFolder: string);\r\n    {$ENDIF}\r\n    property BitmapNames[AIndex: Integer]: String read GetBitmapName;\r\n    property Bitmaps[AIndex: Integer]: TTMSFNCBitmap read GetBitmap;\r\n  published\r\n    property Items: TTMSFNCBitmapCollection read GetItems write SetItems;\r\n    property Version: string read GetVersion;\r\n    property OnBitmapChanged: TNotifyEvent read FOnBitmapChanged write FOnBitmapChanged;\r\n  end;\r\n\r\nimplementation\r\n\r\n{$R 'TMSFNCBitmapContainer.res'}\r\n\r\nuses\r\n  TypInfo, WEBLib.Forms, SysUtils, WEBLib.TMSFNCUtils\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types\r\n  {$ENDIF}\r\n  ;\r\n\r\n  {$IFDEF FMXLIB}\r\ntype\r\n  TCustomFormHelper = class helper for TCustomForm\r\n  private\r\n    function GetControlCount: Integer;\r\n    function GetControls(AIndex: Integer): TWinControl;\r\n  public\r\n    property ControlCount: Integer read GetControlCount;\r\n    property Controls[Index: Integer]: TWinControl read GetControls;\r\n  end;\r\n  {$ENDIF}\r\n\r\n{ TTMSFNCBitmapItem }\r\n\r\nprocedure TTMSFNCBitmapItem.Assign(Source: TPersistent);\r\nbegin\r\n  Name := (Source as TTMSFNCBitmapItem).Name;\r\n  Tag := (Source as TTMSFNCBitmapItem).Tag;\r\n  Bitmap.Assign((Source as TTMSFNCBitmapItem).Bitmap)\r\nend;\r\n\r\nconstructor TTMSFNCBitmapItem.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  FBitmap := TTMSFNCBitmap.Create;\r\n  FBitmap.OnChange := @DoBitmapChanged;\r\n  FName := 'Item' + IntToStr(Collection.Count);\r\nend;\r\n\r\ndestructor TTMSFNCBitmapItem.Destroy;\r\nbegin\r\n  FBitmap.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapItem.DoBitmapChanged(Sender: TObject);\r\nbegin\r\n  if (Collection is TTMSFNCBitmapCollection) then\r\n  begin\r\n    if Assigned((Collection as TTMSFNCBitmapCollection).FOwner) then\r\n      (Collection as TTMSFNCBitmapCollection).FOwner.DoBitmapChanged(Self);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCBitmapItem.GetDisplayName: string;\r\nbegin\r\n  if FName <> '' then\r\n    Result := FName\r\n  {$IFDEF WEBLIB}\r\n  else\r\n    Result := '';\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  else\r\n    Result := inherited;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCBitmapItem.SetBitmap(const Value: TTMSFNCBitmap);\r\nbegin\r\n  FBitmap.Assign(Value);\r\nend;\r\n\r\n{ TTMSFNCBitmapCollection }\r\n\r\nfunction TTMSFNCBitmapCollection.Add: TTMSFNCBitmapItem;\r\nbegin\r\n  Result := TTMSFNCBitmapItem(inherited Add);\r\nend;\r\n\r\nconstructor TTMSFNCBitmapCollection.Create(AOwner: TTMSFNCBitmapContainer);\r\nbegin\r\n  inherited Create(AOwner, GetBitmapItemClass);\r\n  FOwner := AOwner;\r\nend;\r\n\r\nfunction TTMSFNCBitmapCollection.GetBitmapItemClass: TCollectionItemClass;\r\nbegin\r\n  Result := TTMSFNCBitmapItem;\r\nend;\r\n\r\nfunction TTMSFNCBitmapCollection.GetItemEx(Index: Integer): TTMSFNCBitmapItem;\r\nbegin\r\n  Result := TTMSFNCBitmapItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCBitmapCollection.Insert(index: Integer): TTMSFNCBitmapItem;\r\nbegin\r\n  Result := TTMSFNCBitmapItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TTMSFNCBitmapCollection.SetItemEx(Index: Integer; const Value: TTMSFNCBitmapItem);\r\nbegin\r\n  inherited SetItem(Index, Value);\r\nend;\r\n\r\n{ TTMSFNCBitmapContainer }\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCBitmapContainer.AddFromFile(FileName, BitmapName: string);\r\nvar\r\n  bmpi: TTMSFNCBitmapItem;\r\nbegin\r\n  bmpi := Items.Add;\r\n  bmpi.Bitmap.LoadFromFile(FileName);\r\n  bmpi.Name := BitmapName;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.AddFromFolder(AFolder: string);\r\nvar\r\n  SR: TSearchRec;\r\n\r\n  procedure AddToList(s: string);\r\n  begin\r\n    with Items.Add do\r\n    begin\r\n      try\r\n        Bitmap.LoadFromFile(s);\r\n        Name := ExtractFileName(s);\r\n      except\r\n        Bitmap.Assign(nil);\r\n      end;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  if FindFirst(AFolder,faAnyFile and not faDirectory,SR) = 0 then\r\n  begin\r\n    AddToList(ExtractFilePath(AFolder) + SR.Name);\r\n    while FindNext(SR) = 0 do\r\n      AddToList(ExtractFilePath(AFolder) + SR.Name);\r\n  end;\r\n  FindClose(SR);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCBitmapContainer.AddFromURL(URL, BitmapName: string);\r\n{$IFDEF WEBLIB}\r\nvar\r\n  bmpi: TTMSFNCBitmapItem;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  bmpi := Self.Items.Add;\r\n  bmpi.Bitmap.LoadFromURL(URL);\r\n  bmpi.Name := BitmapName;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.AddFromResource(ResourceName, BitmapName: string; AInstance: NativeUInt);\r\nvar\r\n  bmpi: TTMSFNCBitmapItem;\r\nbegin\r\n  bmpi := Items.Add;\r\n  bmpi.Bitmap.LoadFromResource(ResourceName, AInstance);\r\n  bmpi.Name := BitmapName;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.AddFromResource(ResourceName, BitmapName: string);\r\nbegin\r\n  AddFromResource(ResourceName, BitmapName, GetInstance);\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.Changed;\r\nvar\r\n  i: integer;\r\nbegin\r\n  for i := 0 to FControls.Count - 1 do\r\n  {$IFDEF FMXLIB}\r\n    FControls.Items[i].Invalidate;\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n    FControls.Items[i].Invalidate;\r\n  {$ENDIF}\r\nend;\r\n\r\nconstructor TTMSFNCBitmapContainer.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FItems := CreateItems;\r\n  FControls := TControlList.Create;\r\nend;\r\n\r\nconstructor TTMSFNCBitmapContainer.Create;\r\nbegin\r\n  Create(nil);\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.CreateItems: TTMSFNCBitmapCollection;\r\nbegin\r\n  Result := TTMSFNCBitmapCollection.Create(Self);\r\nend;\r\n\r\ndestructor TTMSFNCBitmapContainer.Destroy;\r\nbegin\r\n  FControls.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.DoBitmapChanged(Sender: TObject);\r\nvar\r\n  f: TCustomForm;\r\n  I: Integer;\r\nbegin\r\n  f := TTMSFNCUtils.GetParentForm(Self);\r\n  if Assigned(f) then\r\n  begin\r\n    for I := 0 to f.ControlCount - 1 do\r\n      if f.Controls[I] is TWinControl then\r\n        InvalidateMembers(f.Controls[I] as TWinControl);\r\n  end;\r\n\r\n  if Assigned(OnBitmapChanged) then\r\n    OnBitmapChanged(Self);\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.FindBitmap(s: string): TTMSFNCBitmap;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result := nil;\r\n  s := Uppercase(s);\r\n  i := 1;\r\n  while i <= Items.Count do\r\n  begin\r\n    if Uppercase(Items[i - 1].Name) = s then\r\n    begin\r\n      Result := Items[i - 1].Bitmap;\r\n      Break;\r\n    end;\r\n    Inc(i);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.SetItems(const Value: TTMSFNCBitmapCollection);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.GetBitmap(AIndex: Integer): TTMSFNCBitmap;\r\nbegin\r\n  Result := nil;\r\n  if (AIndex >= 0) and (AIndex <= Items.Count - 1) then\r\n    Result := Items[AIndex].Bitmap;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.GetBitmapName(AIndex: Integer): String;\r\nbegin\r\n  Result := '';\r\n  if (AIndex >= 0) and (AIndex <= Items.Count - 1) then\r\n    Result := Items[AIndex].Name;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.GetInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.GetItems: TTMSFNCBitmapCollection;\r\nbegin\r\n  Result := FItems;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.GetVersion: string;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.InvalidateMembers(AControl: TWinControl);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(AControl) then\r\n    Exit;\r\n\r\n  if Assigned(GetPropInfo(AControl, 'BitmapContainer')) then\r\n    AControl.Invalidate;\r\n\r\n  for I := 0 to AControl.ControlCount - 1 do\r\n  begin\r\n    if AControl.Controls[I] is TWinControl then\r\n      InvalidateMembers(AControl.Controls[I] as TWinControl);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.ItemCount: Integer;\r\nbegin\r\n  Result := Items.Count;\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nvar\r\n  i: integer;\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and Assigned(FControls) then\r\n  begin\r\n    for i := FControls.Count - 1 downto 0 do\r\n    begin\r\n      if (FControls.Items[i] = AComponent) then\r\n        FControls.Delete(i);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.RandomBitmap: TTMSFNCBitmap;\r\nbegin\r\n  Result := Bitmaps[Random(ItemCount)];\r\nend;\r\n\r\nfunction TTMSFNCBitmapContainer.RandomBitmapName: string;\r\nbegin\r\n  Result := BitmapNames[Random(ItemCount)];\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.RegisterControl(\r\n  AControl: TControl);\r\nbegin\r\n  FControls.Add(AControl);\r\nend;\r\n\r\nprocedure TTMSFNCBitmapContainer.RegisterRuntimeClasses;\r\nbegin\r\n  RegisterClass(TTMSFNCBitmapContainer);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\n\r\n{ TCustomFormHelper }\r\n\r\nfunction TCustomFormHelper.GetControls(AIndex: Integer): TWinControl;\r\nvar\r\n  c: TFmxObject;\r\nbegin\r\n  Result := nil;\r\n  c := Children[AIndex];\r\n  if c is TWinControl then\r\n    Result := c as TWinControl;\r\nend;\r\n\r\nfunction TCustomFormHelper.GetControlCount: Integer;\r\nbegin\r\n  Result := ChildrenCount;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nend.\r\n","{********************************************************************}\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCHTMLEngine;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCGraphics, Types, WEBLib.Graphics,\r\n  WEBLib.TMSFNCTypes, WEBLib.TMSFNCBitmapContainer, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFDEF CMNLIB}\r\n  , FMX.ImgList\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  , UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  ;\r\n\r\nvar\r\n  TMSFNCHTMLENGINE_ATTR_DELIM: char = '\"';\r\n\r\nfunction HTMLDrawEx(AGraphics: TTMSFNCGraphics; s:string; fr:TRectF;\r\n                    XPos,YPos,FocusLink,HoverLink,ShadowOffset: Integer;\r\n                    CheckHotSpot,CheckHeight,{%H-}Print,Selected,Blink,HoverStyle,WordWrap: Boolean;\r\n                    {%H-}ResFactor:Double;\r\n                    URLColor,HoverColor,HoverFontColor,ShadowColor: TTMSFNCGraphicsColor;\r\n                    var AnchorVal,StripVal,FocusAnchor: string;\r\n                    var XSize,YSize: single; var HyperLinks,MouseLink: Integer;\r\n                    var HoverRect:TRectF;var LineCount: Integer; LineSpacing: Integer;\r\n                    BitmapContainer: TTMSFNCBitmapContainer; {%H-}Opacity: Single; HyperLinkUnderline: Boolean = True{$IFDEF CMNLIB}; ImageList: TCustomImageList = nil{$ENDIF};\r\n                    HighlightColor: TTMSFNCGraphicsColor = gcBlue;\r\n                    HighlightTextColor: TTMSFNCGraphicsColor = gcWhite;\r\n                    HighlightTextStyle: TFontStyles = []\r\n                    ): Boolean; overload;\r\n\r\nfunction HTMLDrawEx(AGraphics: TTMSFNCGraphics; s:string; fr:TRectF;\r\n                    XPos,YPos,FocusLink,HoverLink,ShadowOffset: Integer;\r\n                    CheckHotSpot,CheckHeight,{%H-}Print,Selected,Blink,HoverStyle,WordWrap, Down: Boolean;\r\n                    DownID: string;\r\n                    {%H-}ResFactor:Double;\r\n                    URLColor,HoverColor,HoverFontColor,ShadowColor: TTMSFNCGraphicsColor;\r\n                    var AnchorVal,StripVal,FocusAnchor: string;\r\n                    var XSize,YSize: single; var HyperLinks,MouseLink: Integer;\r\n                    var HoverRect, ControlRect:TRectF;var CID,CV,CT: string; var LineCount: Integer; LineSpacing: Integer;\r\n                    BitmapContainer: TTMSFNCBitmapContainer; {%H-}Opacity: Single; HyperLinkUnderline: Boolean = True{$IFDEF CMNLIB}; ImageList: TCustomImageList = nil{$ENDIF};\r\n                    HighlightColor: TTMSFNCGraphicsColor = gcBlue;\r\n                    HighlightTextColor: TTMSFNCGraphicsColor = gcWhite;\r\n                    HighlightTextStyle: TFontStyles = []\r\n                    ): Boolean; overload;\r\n\r\nfunction HiLight(s,h,tag:string;DoCase:boolean):string;\r\nfunction UnHiLight(s,tag:string):string;\r\nfunction GetControlValue(HTML,ControlID:string;var ControlValue:String): Boolean;\r\nfunction GetControlProp(HTML,ControlID:string): string;\r\nfunction GetControlMaxLen(HTML,ControlID:string): integer;\r\nfunction SetControlValue(var HTML:string;ControlID,ControlValue:string): Boolean;\r\nfunction ClearRadioControls(HTML: string): string;\r\nfunction GetNextControlID(HTML:string; ControlID: string): string;\r\nfunction HasHTMLControl(HTML: string): boolean;\r\nprocedure ParseControl(Tag: string; var ControlType,ControlID,ControlValue,ControlWidth,ControlHeight,ControlProp,ControlLen:string);\r\n\r\nimplementation\r\n\r\nuses\r\n  SysUtils, WEBLib.TMSFNCUtils\r\n  {$IFDEF LCLLIB}\r\n  ,LCLIntF\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,Windows\r\n  {$ENDIF}\r\n  ;\r\n\r\nfunction VarIPos(su,s:string;var Res:Integer):Integer;\r\nbegin\r\n  Res := Pos(su, Uppercase(s));\r\n  Result := Res;\r\nend;\r\n\r\nfunction StripPos2HTMLPos(s:string; i: Integer): Integer;\r\nvar\r\n  j,k: Integer;\r\n  Skip: Boolean;\r\nbegin\r\n  Result := 0;\r\n  k := 1;\r\n  Skip := False;\r\n\r\n  {$IFDEF FMXMOBILE}\r\n  for j := 0 to Length(s) - 1 do\r\n  {$ELSE}\r\n  for j := 1 to Length(s) do\r\n  {$ENDIF}\r\n  begin\r\n    if s[j] = '<' then\r\n      Skip := True;\r\n\r\n    if k = i then\r\n    begin\r\n      Result := j;\r\n      Exit;\r\n    end;\r\n\r\n    if not Skip then\r\n      Inc(k);\r\n\r\n    if s[j] = '>' then\r\n      Skip := False;\r\n\r\n  end;\r\n\r\n  if k = i then\r\n  begin\r\n    Result := Length(s) + 1;\r\n  end;\r\nend;\r\n\r\n\r\nfunction PosFrom(su,s:string; h: Integer;DoCase: boolean; var Res: Integer): Integer;\r\nvar\r\n  r: Integer;\r\nbegin\r\n  Result := 0;\r\n  Res := 0;\r\n\r\n  if h > 0 then\r\n    Delete(s,1,h);\r\n\r\n  if DoCase then\r\n    r := Pos(su,s)\r\n  else\r\n    r := Pos(AnsiUpperCase(su), AnsiUpperCase(s));\r\n\r\n  if r > 0 then\r\n  begin\r\n    Res := h + r;\r\n    Result := Res;\r\n  end;\r\nend;\r\n\r\n\r\nfunction HiLight(s,h,tag:string;DoCase:boolean):string;\r\nvar\r\n  hs: string;\r\n  l,k: Integer;\r\nbegin\r\n  hs := TTMSFNCUtils.HTMLStrip(s);\r\n\r\n  l := 0;\r\n\r\n  if (pos(h,s) > 0) and ((pos('<',hs) >0) or (pos('>',hs) > 0)) then\r\n  begin\r\n    hs := StringReplace(hs,'<','&lt;',[rfReplaceAll]);\r\n    hs := StringReplace(hs,'>','&gt;',[rfReplaceAll]);\r\n    s := hs;\r\n    h := StringReplace(h,'<','&lt;',[rfReplaceAll]);\r\n    h := StringReplace(h,'>','&gt;',[rfReplaceAll]);\r\n  end;\r\n\r\n  k := 0;\r\n  while PosFrom(h,hs,l,DoCase,k) > 0 do\r\n  begin\r\n    l := k + Length(h);\r\n    Insert('<'+tag+'>',s,StripPos2HTMLPos(s,k));\r\n    Insert('</'+tag+'>',s,StripPos2HTMLPos(s,l));\r\n  end;\r\n\r\n  Result := s;\r\nend;\r\n\r\nfunction UnHiLight(s,tag:string):string;\r\nbegin\r\n  Result := '';\r\n  // replace line breaks by linefeeds\r\n  tag := Uppercase(tag);\r\n  while Pos('<'+tag+'>',Uppercase(s)) > 0 do s := StringReplace(s,'<'+tag+'>','',[rfIgnoreCase]);\r\n  while Pos('</'+tag+'>',Uppercase(s)) > 0 do s := StringReplace(s,'</'+tag+'>','',[rfIgnoreCase]);\r\n\r\n  s := StringReplace(s,'&lt;','<',[rfReplaceAll]);\r\n  s := StringReplace(s,'&gt;','>',[rfReplaceAll]);\r\n\r\n  Result := s;\r\nend;\r\n\r\nfunction IStrToInt(s:string):Integer;\r\nvar\r\n  {%H-}Err,Res: Integer;\r\nbegin\r\n  Val(s,Res,Err);\r\n  Result := Res;\r\nend;\r\n\r\nfunction DBTagStrip(s:string):string;\r\nvar\r\n  i,j: Integer;\r\nbegin\r\n  i := Pos('<#',s);\r\n  if i > 0 then\r\n  begin\r\n    Result := Copy(s,1,i - 1);\r\n    Delete(s,1,i);\r\n    j := Pos('>',s);\r\n    if j > 0 then\r\n      Delete(s,j,1);\r\n    Result := Result + s;\r\n  end\r\n  else\r\n    Result := s;\r\nend;\r\n\r\nfunction CRLFStrip(s:string;break:boolean):string;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result := '';\r\n  {$IFDEF FMXMOBILE}\r\n  for i := 0 to Length(s) - 1 do\r\n  {$ELSE}\r\n  for i := 1 to Length(s) do\r\n  {$ENDIF}\r\n  begin\r\n    if not ( (s[i] = #13) or (s[i] = #10)) then\r\n      Result := Result + s[i]\r\n    else\r\n      if (s[i] = #13) and break then\r\n        Result := Result + '<BR>';\r\n  end;\r\nend;\r\n\r\nprocedure ParseControl(Tag: string; var ControlType,ControlID,ControlValue,ControlWidth,ControlHeight,ControlProp,ControlLen:string);\r\nvar\r\n  Prop: string;\r\n  vp: integer;\r\nbegin\r\n  ControlType := '';\r\n  ControlWidth := '';\r\n  ControlHeight := '';\r\n  ControlValue := '';\r\n  ControlID := '';\r\n  ControlProp := '';\r\n  ControlLen := '';\r\n\r\n  vp := 0;\r\n  if VarIPos('TYPE=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlType := Uppercase(Prop);\r\n  end;\r\n\r\n  if VarIPos('WIDTH=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlWidth := Prop;\r\n  end;\r\n\r\n  if VarIPos('HEIGHT=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlHeight := Prop;\r\n  end;\r\n\r\n  if VarIPos('ID=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlID := Prop;\r\n  end;\r\n\r\n  if VarIPos('VALUE=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlValue := TTMSFNCUtils.UnFixMarkup(Prop);\r\n  end;\r\n\r\n  if VarIPos('PROP=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlProp := TTMSFNCUtils.UnFixMarkup(Prop);\r\n  end;\r\n\r\n  if VarIPos('MAXLEN=',Tag,vp) > 0 then\r\n  begin\r\n    Prop := Copy(Tag,vp + 1,Length(Tag));\r\n    Prop := Copy(Prop,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) + 1,Length(Prop));\r\n    Prop := Copy(Prop,1,Pos(TMSFNCHTMLENGINE_ATTR_DELIM,Prop) - 1);\r\n    ControlLen := Prop;\r\n  end;\r\nend;\r\n\r\nfunction HasHTMLControl(HTML: string): boolean;\r\nvar\r\n  lp: Integer;\r\nbegin\r\n  lp := 0;\r\n  Result := VarIPos('<CONTROL', HTML,lp) > 0;\r\nend;\r\n\r\nfunction GetNextControlID(HTML, ControlID:string): string;\r\nvar\r\n  lp: Integer;\r\n  Tag,CType,CID,CV,CW,CH,CP,CL: string;\r\n  flg: boolean;\r\nbegin\r\n  Result := '';\r\n  flg := ControlID = '';\r\n\r\n  lp := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n\r\n    if flg and (CType <> 'BUTTON') and (CType <> 'CHECK') and (CType <> 'RADIO') then\r\n    begin\r\n      Result := CID;\r\n      Exit;\r\n    end;\r\n\r\n    if (ControlID = CID) then\r\n      flg := true;\r\n  end;\r\nend;\r\n\r\nfunction GetControlValue(HTML,ControlID:string;var ControlValue:String): Boolean;\r\nvar\r\n  lp: Integer;\r\n  Tag,CType,CID,CV,CW,CH,CP,CL: string;\r\nbegin\r\n  Result := False;\r\n  lp := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n    if (ControlID = CID) then\r\n    begin\r\n      ControlValue := CV;\r\n      Result := True;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction GetControlProp(HTML,ControlID:string): string;\r\nvar\r\n  lp: Integer;\r\n  Tag,CType,CID,CV,CW,CH,CP,CL: string;\r\nbegin\r\n  Result := '';\r\n  lp := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n    if (ControlID = CID) then\r\n    begin\r\n      Result := CP;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction GetControlMaxLen(HTML,ControlID:string): integer;\r\nvar\r\n  lp, {%H-}e: Integer;\r\n  Tag,CType,CID,CV,CW,CH,CP,CL: string;\r\nbegin\r\n  Result := 0;\r\n  lp := 0;\r\n  e := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n\r\n    if (ControlID = CID) then\r\n    begin\r\n      val(CL,Result,e);\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction SetControlValue(var HTML:string;ControlID,ControlValue:string): Boolean;\r\nvar\r\n  lp: Integer;\r\n  Tag,Temp,CType,CID,CV,CW,CH,CP,CL: string;\r\nbegin\r\n  Result := False;\r\n  Temp := '';\r\n  ControlValue := TTMSFNCUtils.FixMarkup(ControlValue);\r\n  lp := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Temp := Temp + Copy(html,1,lp);\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n    if (ControlID = CID) then\r\n    begin\r\n      Temp := Temp + 'CONTROL ID='+TMSFNCHTMLENGINE_ATTR_DELIM+ControlID+TMSFNCHTMLENGINE_ATTR_DELIM+' VALUE='+TMSFNCHTMLENGINE_ATTR_DELIM+ControlValue+TMSFNCHTMLENGINE_ATTR_DELIM+' WIDTH='+TMSFNCHTMLENGINE_ATTR_DELIM+CW+TMSFNCHTMLENGINE_ATTR_DELIM+' TYPE=' + TMSFNCHTMLENGINE_ATTR_DELIM +CType+TMSFNCHTMLENGINE_ATTR_DELIM;\r\n      if (CP <> '') then\r\n        Temp := Temp + ' PROP='+TMSFNCHTMLENGINE_ATTR_DELIM+TTMSFNCUtils.FixMarkup(CP)+TMSFNCHTMLENGINE_ATTR_DELIM;\r\n      if (CL <> '') then\r\n        Temp := Temp + ' MAXLEN='+TMSFNCHTMLENGINE_ATTR_DELIM+CL+TMSFNCHTMLENGINE_ATTR_DELIM;\r\n\r\n      Temp := Temp + '>';\r\n      html := Temp + Copy(html,pos('>',html)+1,Length(html));\r\n      Result := True;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction ClearRadioControls(HTML: string): string;\r\nvar\r\n  lp: Integer;\r\n  Tag,CType,CID,CV,CW,CH,CP,CL: string;\r\n  sl: TStringList;\r\n  s: string;\r\nbegin\r\n  Result := '';\r\n\r\n  s := HTML;\r\n\r\n  sl := TStringList.Create;\r\n  lp := 0;\r\n  while VarIPos('<CONTROL ',html,lp) > 0 do\r\n  begin\r\n    Delete(html,1,lp);\r\n    Tag := Copy(html,1,Pos('>',html));\r\n    CType := '';\r\n    CID := '';\r\n    CV := '';\r\n    CW := '';\r\n    CH := '';\r\n    CP := '';\r\n    CL := '';\r\n    ParseControl(Tag,CType,CID,CV,CW,CH,CP,CL);\r\n\r\n    if CType = 'RADIO' then\r\n      sl.Add(CID);\r\n  end;\r\n\r\n  for lp := 0 to sl.Count - 1 do\r\n  begin\r\n    SetControlValue(s, sl.Strings[lp], 'FALSE');\r\n  end;\r\n\r\n  sl.Free;\r\n  Result := s;\r\nend;\r\n\r\nfunction HTMLDrawEx(AGraphics: TTMSFNCGraphics; s:string; fr:TRectF;\r\n                    XPos,YPos,FocusLink,HoverLink,ShadowOffset: Integer;\r\n                    CheckHotSpot,CheckHeight,{%H-}Print,Selected,Blink,HoverStyle,WordWrap, Down: Boolean;\r\n                    DownID: string;\r\n                    {%H-}ResFactor:Double;\r\n                    URLColor,HoverColor,HoverFontColor,ShadowColor: TTMSFNCGraphicsColor;\r\n                    var AnchorVal,StripVal,FocusAnchor: string;\r\n                    var XSize,YSize: single; var HyperLinks,MouseLink: Integer;\r\n                    var HoverRect, ControlRect:TRectF;var CID,CV,CT: string; var LineCount: Integer; LineSpacing: Integer;\r\n                    BitmapContainer: TTMSFNCBitmapContainer; {%H-}Opacity: Single; HyperLinkUnderline: Boolean = True{$IFDEF CMNLIB}; ImageList: TCustomImageList = nil{$ENDIF};\r\n                    HighlightColor: TTMSFNCGraphicsColor = gcBlue;\r\n                    HighlightTextColor: TTMSFNCGraphicsColor = gcWhite;\r\n                    HighlightTextStyle: TFontStyles = []\r\n                    ): Boolean;\r\n\r\ntype\r\n  TFloatStyle = (fsNone, fsLeft, fsRight);\r\n\r\nvar\r\n  su: string;\r\n  r,dr: TRectF;\r\n  hr,rr: TRectF;\r\n  htmlwidth,htmlheight,txtheight, ch: Single;\r\n  rh: TRectF;\r\n  Align: TAlignment;\r\n  PIndent: Integer;\r\n  OldFont: TTMSFNCGraphicsFont;\r\n  OldFontColor: TTMSFNCGraphicsColor;\r\n  CalcFont: TTMSFNCGraphicsFont;\r\n  CalcFontColor: TTMSFNCGraphicsColor;\r\n  DrawFont: TTMSFNCGraphicsFont;\r\n  DrawFontCOlor: TTMSFNCGraphicsColor;\r\n  FontColor: TTMSFNCGraphicsColor;\r\n  OldPenColor: TTMSFNCGraphicsColor;\r\n  OldCalcFont: TTMSFNCGraphicsFont;\r\n  OldCalcFontColor: TTMSFNCGraphicsColor;\r\n  BkColor,BGColor: TTMSFNCGraphicsColor;\r\n  OldDrawFont: TTMSFNCGraphicsFont;\r\n  OldDrawFontColor: TTMSFNCGraphicsColor;\r\n  Hotspot, ImageHotspot: Boolean;\r\n  Anchor,OldAnchor,MouseInAnchor,Error: Boolean;\r\n  paracolor,pencolor,blnkcolor,hifcol,hibcol: TTMSFNCGraphicsColor;\r\n  LastAnchor,OldAnchorVal,LType: string;\r\n  IMGSize: TPoint;\r\n  isSup,isSub,isPara,isShad: Boolean;\r\n  hlcount,licount: Integer;\r\n  imgali: single;\r\n  subh, suph: Single;\r\n  ListIndex: Integer;\r\n  Invisible: Boolean;\r\n  FoundTag: Boolean;\r\n  nnFit: Integer;\r\n  inspoint: Integer;\r\n  hifStyles: TFontStyles;\r\n  AltImg,ImgIdx,OldImgIdx: Integer;\r\n  ColL,ColB: TTMSFNCGraphicsColor;\r\n  ofsx,newofsx: integer;\r\n  FHot: Boolean;\r\n  floatrect: TRect;\r\n  floatpt: TPoint;\r\n  txtfloat,txtfloatbefore: TFloatStyle;\r\n  imgfloat: TFloatStyle;\r\n\r\n\r\n  function HTMLDrawLine(AGraphics: TTMSFNCGraphics; var s:string;r: TRectF;Calc:Boolean;\r\n                        var w,h,subh,suph,imgali:Single;var Align:TAlignment; var PIndent: Integer;\r\n                        XPos,YPos:Integer;var Hotspot,ImageHotSpot:Boolean;OffsetX: integer; var NewOffsetX: integer; var floatrect: TRect; var txtfloat: TFloatStyle):string;\r\n  var\r\n    su,Res,TagProp,Prop,Tagp,LineText,dsu:string;\r\n    cr, ir: TRectF;\r\n    {$IFDEF CMNLIB}\r\n    crc: TRect;\r\n    {$ENDIF}\r\n    linebreak,imgbreak,linkbreak: Boolean;\r\n    indent,bmpx,bmpy,imgw,imgh: Integer;\r\n    err: integer;\r\n    sw, th, errs: Single;\r\n    rh: TRectF;\r\n    TagPos,SpacePos,o,l: Integer;\r\n    bmp: TTMSFNCBitmap;\r\n    bmpcreated: boolean;\r\n    NewColor: TTMSFNCGraphicsColor;\r\n    TagWidth,TagHeight,WordLen: Integer;\r\n    WordWidth: Single;\r\n    TagChar: Char;\r\n    LengthFits: Boolean;\r\n    ptf1,ptf2: TPointF;\r\n    imgalign,imgoffs, imgth: integer;\r\n    ControlType,ControlWidth,ControlHeight,ControlID,ControlValue,ControlProp,ControlLen: string;\r\n  begin\r\n    Result := '';\r\n    LineText := '';\r\n    WordWidth := 0;\r\n    r.Bottom := r.Bottom - Subh;\r\n\r\n    w := 0;\r\n    sw := 0;\r\n\r\n    LineBreak := False;\r\n    ImgBreak := False;\r\n    LinkBreak := False;\r\n    HotSpot := False;\r\n    ImageHotSpot := False;\r\n\r\n//    r.Left := r.Left + offsetX;\r\n\r\n    cr := r;\r\n    res := '';\r\n\r\n    if not Calc then\r\n      cr.Left := cr.Left + OffsetX;\r\n\r\n    if isPara and not Calc then\r\n    begin\r\n      Pencolor := AGraphics.Stroke.Color;\r\n      AGraphics.Stroke.Color := AGraphics.Fill.Color;\r\n      AGraphics.DrawRectangle(Rectf(fr.Left,r.Top,fr.Right,r.Top + h));\r\n    end;\r\n\r\n    while (Length(s) > 0) and not LineBreak and not ImgBreak do\r\n    begin\r\n      // get next word or till next HTML tag\r\n      TagPos := Pos('<',s);\r\n\r\n      if WordWrap then\r\n        SpacePos := Pos(' ',s)\r\n      else\r\n        SpacePos := 0;\r\n\r\n      if (Tagpos > 0) and ((SpacePos > TagPos) or (SpacePos = 0)) then\r\n        su := Copy(s,1,TagPos - 1)\r\n      else\r\n      begin\r\n        if SpacePos > 0 then\r\n          su := Copy(s,1,SpacePos)\r\n        else\r\n          su := s;\r\n      end;\r\n\r\n      WordLen := Length(su);\r\n\r\n      while Pos('&nbsp;',su) > 0 do\r\n      begin\r\n        TTMSFNCUtils.TagReplacestring('&nbsp;',' ',su);\r\n      end;\r\n\r\n      while Pos('&lt;',su) > 0 do\r\n      begin\r\n        TTMSFNCUtils.TagReplacestring('&lt;','<',su);\r\n      end;\r\n\r\n      while Pos('&gt;',su) > 0 do\r\n      begin\r\n        TTMSFNCUtils.TagReplacestring('&gt;','>',su);\r\n      end;\r\n\r\n      //WordLenEx := Length(su);\r\n\r\n      if WordLen > 0 then\r\n      begin\r\n        rh := AGraphics.CalculateText(su);\r\n        th := rh.Bottom - rh.Top;\r\n\r\n        if isSub and (subh < (th / 4)) then subh := th / 4;\r\n        if isSup and (suph < (th / 4)) then suph := th / 4;\r\n\r\n        if th > h then\r\n          h := th;\r\n\r\n        StripVal := StripVal + su;\r\n\r\n        if Invisible then\r\n          Delete(s,1,WordLen);\r\n\r\n        if not Invisible then\r\n        begin\r\n          // draw mode\r\n          if not Calc then\r\n          begin\r\n            if isSup then\r\n              cr.Bottom := cr.Bottom - suph;\r\n\r\n            if isSub then\r\n              cr.Bottom := cr.Bottom + subh;\r\n\r\n            cr.Bottom := cr.Bottom - imgali;\r\n\r\n            rh := AGraphics.CalculateText(su);\r\n            errs := rh.Right - rh.Left;\r\n\r\n            if BkColor <> gcNull then\r\n            begin\r\n              AGraphics.Fill.Color := BkColor;\r\n              AGraphics.Stroke.Color := BkColor;\r\n              rh := AGraphics.CalculateText('gh');\r\n              AGraphics.DrawRectangle(RectF(cr.Left, cr.Top, cr.Left + errs, cr.Top + (rh.Bottom - rh.Top)));\r\n            end;\r\n\r\n            BKColor := gcNull;\r\n\r\n            if isShad then\r\n            begin\r\n              OffsetRectEx(cr,ShadowOffset,ShadowOffset);\r\n              AGraphics.Font.Color := ShadowColor;\r\n              AGraphics.DrawText(cr, su, False, gtaLeading, gtaCenter, gttNone, 0, -1, -1{$IFNDEF LIMITEDGRAPHICSMODE}, False{$ENDIF});\r\n              OffsetRectEx(cr,-ShadowOffset,-ShadowOffset);\r\n              AGraphics.Font.Color := OldFontColor;\r\n            end;\r\n\r\n            //errs := cr.Right;\r\n\r\n            {$IFDEF FMXMOBILE}\r\n            if (su <> '') and (su[length(su)-1] = ' ') and Anchor then\r\n            {$ELSE}\r\n            if (su <> '') and (su[length(su)] = ' ') and Anchor then\r\n            {$ENDIF}\r\n              dsu := su + #0\r\n            else\r\n              dsu := su;\r\n\r\n            AGraphics.Font.Color := FontColor;\r\n            AGraphics.DrawText(cr, dsu, False, gtaLeading, gtaCenter, gttNone, 0, -1, -1{$IFNDEF LIMITEDGRAPHICSMODE}, False{$ENDIF});\r\n\r\n            cr.Right := cr.Left + errs;\r\n\r\n            if Anchor and (Hyperlinks - 1 = FocusLink) then\r\n              FocusAnchor := LastAnchor;\r\n\r\n            if Error then\r\n            begin\r\n              AGraphics.Stroke.Color := gcRed;\r\n              AGraphics.Stroke.Kind := gskSolid;\r\n              AGraphics.Stroke.Width := 1;\r\n\r\n              l := Round((cr.Left / 2) * 2);\r\n              if (l mod 4)=0 then o := 2 else o := 0;\r\n\r\n              while l < cr.Right do\r\n              begin\r\n                ptf1 := PointF(l,r.Bottom + o - 1);\r\n                if o = 2 then o := 0 else o := 2;\r\n                ptf2 := PointF(l + 2, r.Bottom + o - 1);\r\n                AGraphics.DrawLine(ptf1, ptf2);\r\n                Inc(l,2);\r\n              end;\r\n            end;\r\n\r\n            cr.Left := cr.Right;\r\n            cr.Right := r.Right;\r\n            cr.Bottom := r.Bottom;\r\n            cr.Top := r.Top;\r\n          end\r\n        else\r\n          begin\r\n            cr := r; //reinitialized each time !\r\n\r\n            rh := AGraphics.CalculateText(su);\r\n            cr.Right := cr.Left + (rh.Right - rh.Left);\r\n\r\n            // preparations for editing purposes\r\n            if (ypos > cr.Top) and (ypos < cr.bottom) and (xpos > w) then {scan charpos here}\r\n            begin\r\n              //this will get the character pos of the insertion point\r\n              nnfit := 0;\r\n              if nnfit = WordLen then\r\n                InsPoint := InsPoint + WordLen\r\n              else\r\n                InsPoint := InsPoint + nnfit;\r\n            end;\r\n\r\n            //end of preparations for editing purposes\r\n\r\n            // Calculated text width\r\n            WordWidth := cr.Right - cr.Left;\r\n            w := w + WordWidth;\r\n\r\n            //errs := XPos - cr.Left;\r\n            //errs := r.Right - XPos - cr.Left;\r\n\r\n            if (XPos - cr.Left  >= w - WordWidth) and (XPos - cr.Left <= w) and Anchor then\r\n            begin\r\n              HotSpot := True;\r\n              if (YPos > cr.Top){ and (YPos < cr.Bottom)} then\r\n              begin\r\n                Anchorval := LastAnchor;\r\n                MouseInAnchor := True;\r\n              end;\r\n            end;\r\n          end;\r\n\r\n          LengthFits := (w < r.Right - r.Left - OfsX) or (r.Right - r.Left - OfsX <= WordWidth);\r\n\r\n//          if not LengthFits and\r\n//            ((Length(LineText) > 0) and (LineText[Length(LineText)] <> ' ')) then\r\n//            LengthFits := True;\r\n\r\n          LineText := LineText + su;\r\n\r\n//          if not LengthFits and not Wordwrap then\r\n//          begin\r\n//            LineBreak := true;\r\n//          end;\r\n\r\n          if LengthFits or not WordWrap then\r\n          begin\r\n            Res := Res + Copy(s,1,WordLen);\r\n\r\n            //if not LengthFits and Calc and (LineText <> su) then\r\n            //  s := '';\r\n\r\n            Delete(s,1,WordLen);\r\n\r\n            if Length(su) >= WordLen then\r\n            begin\r\n\r\n              if Copy(su, WordLen, 1) = ' ' then\r\n              begin\r\n                rh := AGraphics.CalculateText(' ');\r\n                sw := (rh.Right - rh.Left);\r\n              end\r\n              else\r\n                sw := 0;\r\n            end\r\n            else\r\n              sw := 0;\r\n          end\r\n          else\r\n          begin\r\n            LineBreak := True;\r\n            w := w - WordWidth;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      TagPos := Pos('<',s);\r\n\r\n      if (TagPos = 1) and (Length(s) <= 2) then\r\n        s := '';\r\n\r\n      if not LineBreak and (TagPos = 1) and (Length(s) > 2) then\r\n      begin\r\n        {$IFDEF FMXMOBILE}\r\n        if (s[1] = '/') and (Length(s) > 3) then\r\n        {$ELSE}\r\n        if (s[2] = '/') and (Length(s) > 3) then\r\n        {$ENDIF}\r\n        begin\r\n          {$IFDEF FMXMOBILE}\r\n          case UpCase(s[2]) of\r\n          {$ELSE}\r\n          case UpCase(s[3]) of\r\n          {$ENDIF}\r\n          'A':begin\r\n                if (not HoverStyle or (Hoverlink = Hyperlinks)) and not Calc then\r\n                begin\r\n                  AGraphics.Font.Style := AGraphics.Font.Style - [TFontStyle.fsUnderline];\r\n                  if Hovercolor <> gcNull then\r\n                    BkColor := HoverColor;\r\n                  if HoverFontColor <> gcNull then\r\n                    FontColor := HoverFontColor;\r\n                end;\r\n\r\n                if not Selected then\r\n                  FontColor := OldFontColor;\r\n\r\n                Anchor := False;\r\n\r\n                if MouseInAnchor then\r\n                begin\r\n                  hr.Bottom := r.Bottom;\r\n                  hr.Right := r.Left + w;\r\n                  if r.Top <> hr.Top then\r\n                  begin\r\n                    hr.Left := r.Left;\r\n                    hr.Top := r.Top;\r\n                  end;\r\n\r\n                  HoverRect := hr;\r\n                  MouseLink := HyperLinks;\r\n                  MouseInAnchor := False;\r\n                end;\r\n\r\n                if Focuslink = Hyperlinks - 1 then\r\n                begin\r\n                  rr.Right := cr.Left;\r\n                  rr.Bottom := cr.Bottom - ImgAli;\r\n                  rh := AGraphics.CalculateText('gh');\r\n                  rr.Top := rr.Bottom - (rh.Bottom - rh.Top);\r\n                  InflateRectEx(rr,1,0);\r\n                  //if not Calc then AGraphics.DrawFocusRect(rr);\r\n                end;\r\n              end;\r\n          'E':begin\r\n                if not Calc then\r\n                  Error := False;\r\n              end;\r\n          'B':begin\r\n                {$IFDEF FMXMOBILE}\r\n                if s[3] <> '>' then\r\n                {$ELSE}\r\n                if s[4] <> '>' then\r\n                {$ENDIF}\r\n                  FontColor := OldFontColor\r\n                else\r\n                  AGraphics.Font.Style := AGraphics.Font.Style - [TFontStyle.fsBold];\r\n              end;\r\n          'S':begin\r\n                {$IFDEF FMXMOBILE}\r\n                TagChar := UpCase(s[3]);\r\n                {$ELSE}\r\n                TagChar := UpCase(s[4]);\r\n                {$ENDIF}\r\n\r\n                if (TagChar = 'U') then\r\n                begin\r\n                  isSup := False;\r\n                  isSub := False;\r\n                end\r\n                else\r\n                 if (TagChar = 'H') then\r\n                  isShad := False\r\n                 else\r\n                  AGraphics.Font.Style := AGraphics.Font.Style - [TFontStyle.fsStrikeOut];\r\n              end;\r\n          'F':begin\r\n                AGraphics.Font.Name := OldFont.Name;\r\n                AGraphics.Font.Size := OldFont.Size;\r\n                if not Calc and not Selected then\r\n                begin\r\n                  FontColor := OldFontColor;\r\n                  AGraphics.Fill.Color := BGColor;\r\n                end;\r\n              end;\r\n          'H':begin\r\n                if not Calc then\r\n                begin\r\n                  FontColor := hifCol;\r\n                  BkColor := hibCol;\r\n                  AGraphics.Font.Style := hifStyles;\r\n                  AGraphics.Fill.Color := hibCol;\r\n                end;\r\n              end;\r\n          'I':begin\r\n                AGraphics.Font.Style := AGraphics.Font.Style - [TFontStyle.fsItalic];\r\n              end;\r\n          'L':begin\r\n                LineBreak := True;\r\n              end;\r\n          'O':begin\r\n                NewOffsetX := 0;\r\n              end;\r\n          'P':begin\r\n                LineBreak := True;\r\n                if not Calc then\r\n                begin\r\n                  AGraphics.Fill.Color := ParaColor;\r\n                  isPara := false;\r\n                end;\r\n              end;\r\n          'U':begin\r\n                {$IFDEF FMXMOBILE}\r\n                if (s[3] <> '>') and (ListIndex > 0) then\r\n                {$ELSE}\r\n                if (s[4] <> '>') and (ListIndex > 0) then\r\n                {$ENDIF}\r\n                  Dec(Listindex)\r\n                else\r\n                  AGraphics.Font.Style := AGraphics.Font.Style - [TFontStyle.fsUnderline];\r\n              end;\r\n          'R':begin\r\n                //EndRotated(Canvas);\r\n              end;\r\n          'Z':Invisible := False;\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          {$IFDEF FMXMOBILE}\r\n          case Upcase(s[1]) of\r\n          {$ELSE}\r\n          case Upcase(s[2]) of\r\n          {$ENDIF}\r\n          'A':begin\r\n                // only do this when at hover position in xpos,ypos\r\n                if (FocusLink = HyperLinks) and not Calc then\r\n                begin\r\n                  rr.Left := cr.Left;\r\n                  rr.Top := cr.Top;\r\n                end;\r\n\r\n                Inc(HyperLinks);\r\n                if (not HoverStyle or (Hoverlink = HyperLinks)) and not Calc then\r\n                begin\r\n                  if HyperLinkUnderline then\r\n                    AGraphics.Font.Style := AGraphics.Font.Style + [TFontStyle.fsUnderline];\r\n\r\n                  if (Hovercolor <> gcNull) and not Calc then\r\n                    BkColor := HoverColor;\r\n\r\n                  if HoverFontColor <> gcNull then\r\n                    FontColor := HoverFontColor;\r\n                end;\r\n\r\n                if not Selected and ((HoverFontColor = gcNull) or (HoverLink <> HyperLinks) or not HoverStyle) then\r\n                begin\r\n                  OldFontColor := FontColor;\r\n                  FontColor := URLColor;\r\n                end;\r\n\r\n                TagProp := Copy(s,3,Pos('>',s) - 1);  // <A href=\"anchor\">\r\n                Prop := Copy(TagProp,Pos('\"',TagProp) + 1,Length(TagProp));\r\n                Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n                LastAnchor := Prop;\r\n                Anchor := True;\r\n\r\n                hr.Left := w;\r\n                hr.Top := r.Top;\r\n              end;\r\n          'B':begin\r\n                {$IFDEF FMXMOBILE}\r\n                TagChar := Upcase(s[2]);\r\n                {$ELSE}\r\n                TagChar := Upcase(s[3]);\r\n                {$ENDIF}\r\n                case TagChar of\r\n                '>': AGraphics.Font.Style := AGraphics.Font.Style + [TFontStyle.fsBold]; // <B> tag\r\n                'R': // <BR> tag\r\n                   begin\r\n                    LineBreak := true;\r\n                    StripVal := StripVal + #13;\r\n                   end;\r\n                'L': if not Blink then\r\n                   FontColor := BlnkColor; // <BLINK> tag\r\n                'O':\r\n                  begin\r\n\r\n                    bmpy := 0;\r\n                    Res := Res + Copy(s,1,pos('>',s));\r\n                    if not Calc and not Selected then\r\n                    begin\r\n                      TagProp := Uppercase(Copy(s,6,pos('>',s)-1));\r\n\r\n                      if (Pos('BACKGROUND',TagProp) > 0) then\r\n                      begin\r\n                        Prop := Copy(TagProp,Pos('BACKGROUND',TagProp)+10,Length(TagProp));\r\n                        Prop := Copy(Prop,Pos('\"',Prop)+1,Length(prop));\r\n                        Prop := Copy(Prop,1,Pos('\"',Prop)-1);\r\n\r\n                        if Pos('IDX:', UpperCase(Prop)) > 0 then\r\n                          begin\r\n                            Delete(Prop, 1, 4);\r\n                            (*\r\n                            if Assigned(FImages) and (IStrToInt(Prop) < FImages.Count) then\r\n                              begin\r\n                                IMGSize.X := MulDiv(FImages.Width, GetDeviceCaps(AGraphics.Handle, LOGPIXELSX), 96);\r\n                                IMGSize.Y := MulDiv(FImages.Height, GetDeviceCaps(AGraphics.Handle, LOGPIXELSY), 96);\r\n\r\n                                if not Calc and not Print then\r\n                                  FImages.Draw(Canvas, CR.Left, CR.Top, IStrToInt(Prop), True);\r\n\r\n                                if not Calc and Print then\r\n                                  begin\r\n                                    CR.Right := CR.Left + Round(resfactor * FImages.Width);\r\n                                    CR.Bottom := CR.Top + Round(resfactor * FImages.Height);\r\n\r\n                                    ABitmap := TBitmap.Create;\r\n                                    FImages.GetBitmap(IStrToInt(Prop), ABitmap);\r\n                                    PrintBitmap(Canvas, CR, ABitmap);\r\n                                    ABitmap.Free;\r\n                                    CR := r;\r\n                                  end;\r\n                              end;\r\n                            *)\r\n                          end;\r\n\r\n                        bmp := nil;\r\n                        bmpcreated := false;\r\n\r\n                        if (Pos(':',Prop) = 0) and Assigned(BitmapContainer) then\r\n                        begin\r\n                          bmp := BitmapContainer.FindBitmap(Prop);\r\n                        end;\r\n\r\n                        {$IFNDEF WEBLIB}\r\n                        if (Pos('FILE://',Uppercase(Prop)) > 0)  then\r\n                        begin\r\n                          Delete(Prop,1,7);\r\n\r\n                          if FileExists(Prop) then\r\n                          begin\r\n                            bmp := TTMSFNCBitmap.Create;\r\n                            bmp.LoadFromFile(Prop);\r\n                            bmpcreated := true;\r\n                          end;\r\n                        end;\r\n                        {$ENDIF}\r\n                        {$IFDEF WEBLIB}\r\n                        if (Pos('URL://',Uppercase(Prop)) > 0)  then\r\n                        begin\r\n                          Delete(Prop,1,6);\r\n                          bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromURL(Prop));\r\n                          bmpcreated := true;\r\n                        end;\r\n                        {$ENDIF}\r\n\r\n                        if Assigned(bmp) then\r\n                        begin\r\n                          if not IsBitmapEmpty(bmp) and (bmp.Width > 0) and (bmp.Height > 0) then\r\n                          begin\r\n                            // do the tiling here\r\n                            //hrgn := CreateRectRgn(fr.left, fr.top, fr.right,fr.bottom);\r\n                            //SelectClipRgn(AGraphics.Handle, hrgn);\r\n                            while (bmpy < fr.bottom-fr.top) do\r\n                            begin\r\n                              bmpx := 0;\r\n                              while (bmpx < fr.right - fr.left) do\r\n                              begin\r\n                                AGraphics.DrawBitmap(RectF(Round(fr.left+bmpx),Round(fr.top+bmpy), Round(fr.Left + bmpx) + bmp.Width,Round(fr.top+bmpy) + bmp.Height), BitmapToDrawBitmap(bmp));\r\n                                //AGraphics.Draw(fr.left+bmpx,fr.top+bmpy,bmp);\r\n                                bmpx := bmpx + bmp.width;\r\n                              end;\r\n                              bmpy := bmpy + bmp.height;\r\n                            end;\r\n                            //SelectClipRgn(AGraphics.handle, 0);\r\n                            //DeleteObject(hrgn);\r\n                          end;\r\n\r\n                          if bmpcreated then\r\n                            bmp.Free;\r\n                        end; //end of bmp <> nil\r\n                      end; //end of background\r\n\r\n                      if (Pos('BGTOPLEFT', TagProp) > 0) then\r\n                        begin\r\n                          Prop := Copy(TagProp, Pos('BGTOPLEFT', TagProp) + 10, Length(TagProp));\r\n                          Prop := Copy(Prop, Pos('\"', Prop) + 1, Length(Prop));\r\n                          Prop := Copy(Prop, 1, Pos('\"', Prop) - 1);\r\n\r\n                          bmp := nil;\r\n\r\n                          if (Pos(':', Prop) = 0) and Assigned(BitmapContainer) then\r\n                            begin\r\n                              bmp := BitmapContainer.FindBitmap(Prop);\r\n                            end;\r\n\r\n                          if Assigned(bmp) then\r\n                          begin\r\n                            if not IsBitmapEmpty(bmp) and (bmp.Width > 0) and (bmp.Height > 0) then\r\n                            begin\r\n                              AGraphics.DrawBitmap(RectF(Round(fr.Left), Round(fr.Top + bmpy),Round(fr.Left) + bmp.Width ,Round(fr.Top) + bmp.Height), BitmapToDrawBitmap(bmp));\r\n                            end;\r\n                          end;\r\n                        end; //end of bgtopleft\r\n\r\n                      if (Pos('BGTOPRIGHT', TagProp) > 0) then\r\n                        begin\r\n                          Prop := Copy(TagProp, Pos('BGTOPRIGHT', TagProp) + 10, Length(TagProp));\r\n                          Prop := Copy(Prop, Pos('\"', Prop) + 1, Length(Prop));\r\n                          Prop := Copy(Prop, 1, Pos('\"', Prop) - 1);\r\n\r\n                          bmp := nil;\r\n\r\n                          if (Pos(':', Prop) = 0) and Assigned(BitmapContainer) then\r\n                            begin\r\n                              bmp := BitmapContainer.FindBitmap(Prop);\r\n                            end;\r\n\r\n\r\n                          if Assigned(bmp) then\r\n                          begin\r\n                            if not IsBitmapEmpty(bmp) and (bmp.Width > 0) and (bmp.Height > 0) then\r\n                            begin\r\n                              AGraphics.DrawBitmap(RectF(Round(fr.Right) - bmp.Width, Round(fr.Top + bmpy), Round(fr.Right), Round(fr.Top) + bmp.Height ), BitmapToDrawBitmap(bmp));\r\n                            end;\r\n                          end;\r\n                        end; //end of bgtopright\r\n\r\n                      if TTMSFNCUtils.VarPos('BGCOLOR',TagProp,TagPos) > 0 then\r\n                      begin\r\n                        Prop := Copy(TagProp,TagPos + 5,Length(TagProp));\r\n                        Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                        Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                        NewColor := gcNull;\r\n\r\n                        if Length(Prop) > 0 then\r\n                        begin\r\n                          {$IFDEF FMXMOBILE}\r\n                          if Prop[0] = '#' then\r\n                          {$ELSE}\r\n                          if Prop[1] = '#' then\r\n                          {$ENDIF}\r\n                            NewColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                          else\r\n                          begin\r\n                            {$IFDEF WEBLIB}\r\n                            NewColor := TTMSFNCGraphics.TextToColor(LowerCase(prop));\r\n                            {$ENDIF}\r\n                            {$IFNDEF WEBLIB}\r\n                            NewColor := TTMSFNCGraphics.TextToColor(AnsiLowerCase(prop));\r\n                            {$ENDIF}\r\n                          end;\r\n                        end;\r\n\r\n                        if TTMSFNCUtils.VarPos('BGCOLORTO',TagProp,TagPos) > 0 then\r\n                        begin\r\n                          Prop := Copy(TagProp,TagPos + 5,Length(TagProp));\r\n                          Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                          Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                          Prop := 'H';\r\n                          if TTMSFNCUtils.VarPos('DIR',TagProp,TagPos) > 0 then\r\n                          begin\r\n                            Prop := Copy(TagProp,TagPos + 3,Length(TagProp));\r\n                            Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                            Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n                          end;\r\n\r\n                          AGraphics.Stroke.Color := Newcolor;\r\n                          //DrawHTMLGradient(Canvas,NewColor,NewColorTo,clNone,64,Rect(fr.left,fr.top,fr.right,fr.bottom),Prop = 'H');\r\n                          //AGraphics.Brush.Style := bsClear\r\n                        end\r\n                        else\r\n                        begin\r\n                          BGColor := AGraphics.Fill.Color;\r\n                          AGraphics.Fill.Color := NewColor;\r\n                          PenColor:=AGraphics.Stroke.Color;\r\n                          AGraphics.Stroke.Color := Newcolor;\r\n                          AGraphics.DrawRectangle(Rectf(fr.left - 2,fr.top,fr.right,fr.bottom));\r\n                          AGraphics.Stroke.Color := PenColor;\r\n                        end;\r\n                      end;\r\n                    end;\r\n                  end;\r\n                end;\r\n              end;\r\n          'E':begin\r\n                if not Calc then\r\n                  Error := True;\r\n              end;\r\n          'C':begin\r\n                TagProp := Copy(s,9,pos('>',s)-1);\r\n                ControlType := '';\r\n                ControlID := '';\r\n                ControlValue := '';\r\n                ControlWidth := '';\r\n                ControlHeight := '';\r\n                ControlProp := '';\r\n                ControlLen := '';\r\n                ParseControl(TagProp,ControlType,ControlID,ControlValue,ControlWidth,ControlHeight,ControlProp,ControlLen);\r\n\r\n                ch := 25;\r\n\r\n                if ControlHeight <> '' then\r\n                begin\r\n                  val(ControlHeight,ch,err);\r\n                  if err <> 0 then\r\n                    ch := 25;\r\n                end;\r\n\r\n                if (ControlWidth <> '') or (ControlType = 'CHECK') or (ControlType = 'RADIO') then\r\n                begin\r\n                  val(ControlWidth,Indent,err);\r\n\r\n                  if err = 0 then\r\n                  begin\r\n                    IMGSize.x := Indent;\r\n                    IMGSize.y := Round(AGraphics.CalculateTextHeight('gh')) + 10;\r\n                  end;\r\n\r\n                  if (ControlType = 'CHECK') or (ControlType = 'RADIO') then\r\n                    h := 16\r\n                  else\r\n                    h := 23;\r\n\r\n                  if (ch > 25) then\r\n                    h := ch - 2;\r\n\r\n                  if not Calc then\r\n                  begin\r\n                    if (ControlType = 'EDIT') or (ControlType = 'PASSWORD') or (ControlType = 'MASK') then\r\n                    begin\r\n                    end;\r\n\r\n                    if ControlType = 'COMBO' then\r\n                    begin\r\n                    end;\r\n\r\n                    if ControlType = 'CHECK' then\r\n                    begin\r\n                      IMGSize.x := Round(16 * ResFactor) + 2;\r\n                      IMGSize.y := IMGSize.x;\r\n                      Indent := IMGSize.x;\r\n                      ir := RectF(cr.Left + 1, cr.Top + ((cr.Bottom - cr.Top) - (ImgSize.Y - 2)) / 2, cr.Left + IMGSize.X - 1, cr.Top + ((cr.Bottom - cr.Top) - (ImgSize.Y - 2)) / 2 + (IMGSize.Y - 2));\r\n                      ir := RectF(Round(ir.Left), Round(ir.Top), Round(ir.Right), Round(ir.Bottom));\r\n                      AGraphics.DrawCheckBox(ir, UpperCase(ControlValue) = 'TRUE', (Down and (DownID = ControlID)), True);\r\n                    end;\r\n\r\n                    if ControlType = 'RADIO' then\r\n                    begin\r\n                      IMGSize.x := Round(16 * ResFactor) + 2;\r\n                      IMGSize.y := IMGSize.x;\r\n                      Indent := IMGSize.x;\r\n                      ir := RectF(cr.Left + 1, cr.Top + ((cr.Bottom - cr.Top) - (ImgSize.Y - 2)) / 2, cr.Left + IMGSize.X - 1, cr.Top + ((cr.Bottom - cr.Top) - (ImgSize.Y - 2)) / 2 + (IMGSize.Y - 2));\r\n                      ir := RectF(Round(ir.Left), Round(ir.Top), Round(ir.Right), Round(ir.Bottom));\r\n                      AGraphics.DrawRadioButton(ir, UpperCase(ControlValue) = 'TRUE', (Down and (DownID = ControlID)), True);\r\n                    end;\r\n\r\n                    if ControlType = 'BUTTON' then\r\n                    begin\r\n                      IMGSize.y := 22;\r\n                      ir := RectF(cr.Left + 2,cr.Top + ((cr.Bottom - cr.Top) - IMGSize.Y) / 2,cr.Left + Indent -2, cr.Top + ((cr.Bottom - cr.Top) - IMGSize.Y) / 2+ IMGSize.Y);\r\n                      FHot := PtInRectEx(ir, PointF(XPos, YPos));\r\n                      ir := RectF(Round(ir.Left), Round(ir.Top), Round(ir.Right), Round(ir.Bottom));\r\n                      AGraphics.DrawButton(ir, Down and (DownID = ControlID), FHot, True);\r\n                      InflateRectEx(ir,-2,-2);\r\n                      AGraphics.DrawText(ir, ControlValue, False, gtaCenter, gtaCenter);\r\n                    end;\r\n                  end;\r\n\r\n                  if (ControlType = 'BUTTON') then\r\n                    IMGSize.y := 22;\r\n\r\n                  if (ControlType = 'COMBO') then\r\n                     IMGSize.y := 25;\r\n\r\n                  if (ControlType = 'CHECK') or (ControlType = 'RADIO') then\r\n                  begin\r\n                    IMGSize.x := Round(16 * ResFactor) + 2;\r\n                    IMGSize.y := IMGSize.X;\r\n                  end;\r\n\r\n                  if ((XPos - r.Left > w) and (XPos - r.Left < w + IMGSize.x) and\r\n                     (YPos > cr.Top) and (YPos < cr.Top + IMGSize.Y)) or\r\n                     (CheckHotSpot and (CID = ControlID)) then\r\n                  begin\r\n                    ImageHotSpot := True;\r\n                    AnchorVal := 'ctrl';\r\n                    AltImg := ImgIdx;\r\n\r\n                    ir.Left := r.left + w;\r\n                    ir.Right := ir.Left + ImgSize.X;\r\n                    ir.Top := cR.Top;\r\n                    ir.Bottom := cr.top + ImgSize.Y;\r\n\r\n                    ControlRect := ir;\r\n                    CV := ControlValue;\r\n                    CID := ControlID;\r\n                    CT := ControlType;\r\n                  end;\r\n\r\n                  if (w + IMGSize.x > r.Right-r.Left) and\r\n                     (IMGSize.x < r.Right - r.Left) then\r\n                  begin\r\n                    ImgBreak := True;\r\n                  end\r\n                  else\r\n                  begin\r\n                    w := w + IMGSize.x;\r\n                    cr.left := cr.left + IMGSize.x;\r\n                    if IMGSize.y > h then\r\n                      h := IMGSize.y;\r\n                  end;\r\n                end;\r\n              end;\r\n          'H':begin\r\n                {$IFDEF FMXMOBILE}\r\n                case Upcase(s[2]) of\r\n                {$ELSE}\r\n                case Upcase(s[3]) of\r\n                {$ENDIF}\r\n                'R':\r\n                begin\r\n                  LineBreak := True;\r\n                  if not Calc then\r\n                  begin\r\n                    TagProp := Copy(s,4,Pos('>',s) - 1);\r\n\r\n                    NewColor := gcBlack;\r\n\r\n                    if TTMSFNCUtils.VarPos('COLOR',Uppercase(TagProp),TagPos) > 0 then\r\n                    begin\r\n                      Prop := Copy(TagProp,TagPos+5,Length(TagProp));\r\n                      Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                      Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n\r\n                      if Length(Prop) > 0 then\r\n                      begin\r\n                        {$IFDEF FMXMOBILE}\r\n                        if Prop[0] = '#' then\r\n                        {$ELSE}\r\n                        if Prop[1] = '#' then\r\n                        {$ENDIF}\r\n                          NewColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                        else\r\n                        begin\r\n                          {$IFDEF WEBLIB}\r\n                          NewColor := TTMSFNCGraphics.TextToColor(LowerCase(prop));\r\n                          {$ENDIF}\r\n                          {$IFNDEF WEBLIB}\r\n                          NewColor := TTMSFNCGraphics.TextToColor(AnsiLowerCase(prop));\r\n                          {$ENDIF}\r\n                        end;\r\n                      end;\r\n                    end;\r\n\r\n                    AGraphics.Stroke.Kind := gskSolid;\r\n                    Pencolor := AGraphics.Stroke.color;\r\n                    AGraphics.Stroke.Color := Newcolor;\r\n                    ptf1 := PointF(r.Left, cr.Bottom  + 1);\r\n                    ptf2 := PointF(r.Right, cr.Bottom + 1);\r\n                    AGraphics.DrawLine(ptf1,ptf2);\r\n                    AGraphics.Stroke.Color := Pencolor;\r\n                  end;\r\n                end;\r\n                'I':\r\n                begin\r\n                  if not Calc then\r\n                  begin\r\n                    hifCol := FontColor;\r\n                    hibCol := BkColor;\r\n                    hifStyles := AGraphics.Font.Style;\r\n                    BkColor := HighlightColor;\r\n                    FontColor := HighlightTextColor;\r\n                  end;\r\n                  AGraphics.Font.Style := HighlightTextStyle;\r\n                end;\r\n                end;\r\n              end;\r\n          'I':begin\r\n                {$IFDEF FMXMOBILE}\r\n                TagChar := Upcase(s[2]);\r\n                {$ELSE}\r\n                TagChar := Upcase(s[3]);\r\n                {$ENDIF}\r\n\r\n                if TagChar = '>' then // <I> tag\r\n                  AGraphics.Font.Style := AGraphics.Font.Style + [TFontStyle.fsItalic]\r\n                else\r\n                if TagChar = 'N' then  // <IND> tag\r\n                begin\r\n                  TagProp := Copy(s,3,pos('>',s) - 1);\r\n\r\n                  Prop := Copy(TagProp,TTMSFNCUtils.ipos('x',TagProp) + 2,Length(TagProp));\r\n                  Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(prop));\r\n                  Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                  val(Prop,indent,err);\r\n                  if err = 0 then\r\n                  begin\r\n                    if indent > w then\r\n                     begin\r\n                       w := Indent;\r\n                       cr.left := fr.left + Indent;\r\n                     end;\r\n                  end;\r\n                end\r\n                else\r\n                  if TagChar = 'M' then\r\n                  begin\r\n                    imgalign := 0;\r\n                    imgoffs := 0;\r\n                    imgfloat := fsNone;\r\n                    imgth := Round(AGraphics.CalculateTextHeight('gh'));\r\n                    inc(ImgIdx);\r\n\r\n                    ir := cr;\r\n\r\n                    TagProp := Copy(s,3,Pos('>',s) - 1);\r\n                    Prop := Copy(TagProp,Pos('SRC',Uppercase(TagProp)) + 4,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                    TagProp := Uppercase(TagProp);\r\n\r\n                    if (Pos('ALT',TagProp) > 0) and (AltImg = ImgIdx) then\r\n                    begin\r\n                      Prop := Copy(TagProp,Pos('ALT',TagProp) + 4,Length(TagProp));\r\n                      Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                      Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n                    end;\r\n\r\n                    TagWidth := 0;\r\n                    TagHeight := 0;\r\n\r\n                    if Pos('WIDTH',TagProp) > 0 then\r\n                    begin\r\n                      Tagp := Copy(TagProp,Pos('WIDTH',TagProp) + 6,Length(TagProp));\r\n                      Tagp := Copy(Tagp,Pos('\"',tagp) + 1,Length(Tagp));\r\n                      Tagp := Copy(Tagp,1,Pos('\"',tagp) - 1);\r\n                      Val(Tagp,TagWidth,Err);\r\n                    end;\r\n\r\n                    if Pos('HEIGHT',TagProp) > 0 then\r\n                    begin\r\n                      Tagp := Copy(TagProp,TTMSFNCUtils.ipos('HEIGHT',TagProp) + 7,Length(TagProp));\r\n                      Tagp := Copy(Tagp,pos('\"',Tagp) + 1,Length(Tagp));\r\n                      Tagp := Copy(Tagp,1,pos('\"',Tagp) - 1);\r\n                      Val(Tagp,TagHeight,Err);\r\n                    end;\r\n\r\n                    if Pos('ALIGN',TagProp) > 0 then\r\n                    begin\r\n                      Tagp := Copy(TagProp,TTMSFNCUtils.ipos('ALIGN',TagProp) + 6,Length(TagProp));\r\n                      Tagp := Copy(Tagp,pos('\"',Tagp) + 1,Length(Tagp));\r\n                      Tagp := Copy(Tagp,1,pos('\"',Tagp) - 1);\r\n\r\n                      if TagP = 'MIDDLE' then\r\n                        imgalign := 1;\r\n\r\n                      if TagP = 'TOP' then\r\n                        imgalign := 2;\r\n                    end;\r\n\r\n                    if Pos('FLOAT',TagProp) > 0 then\r\n                    begin\r\n                      Tagp := Copy(TagProp,TTMSFNCUtils.ipos('FLOAT',TagProp) + 6,Length(TagProp));\r\n                      Tagp := Copy(Tagp,pos('\"',Tagp) + 1,Length(Tagp));\r\n                      Tagp := Copy(Tagp,1,pos('\"',Tagp) - 1);\r\n\r\n                      if TagP = 'LEFT' then\r\n                      begin\r\n                        imgfloat := fsLeft;\r\n                        ir.left := fr.Left;\r\n                      end;\r\n\r\n                      if TagP = 'RIGHT' then\r\n                        imgfloat := fsRight;\r\n                    end;\r\n\r\n                    IMGSize.x := 0;\r\n                    IMGSize.y := 0;\r\n\r\n                    if Pos('IDX:',Uppercase(Prop)) > 0 then\r\n                    begin\r\n                      Delete(Prop,1,4);\r\n                      {$IFDEF CMNLIB}\r\n                      if Assigned(ImageList) and (IStrToInt(Prop) < ImageList.Count) then\r\n                      begin\r\n                        {$IFDEF FMXLIB}\r\n                        {$ENDIF}\r\n                        {$IFDEF CMNLIB}\r\n                        {$IFDEF VCLLIB}\r\n                        IMGSize.x := MulDiv(ImageList.Width,GetDeviceCaps(AGraphics.Canvas.Handle,LOGPIXELSX),96);\r\n                        IMGSize.y := MulDiv(ImageList.Height,GetDeviceCaps(AGraphics.Canvas.Handle,LOGPIXELSY),96);\r\n                        {$ENDIF}\r\n                        {$IFDEF LCLLIB}\r\n                        IMGSize.x := ImageList.Width;\r\n                        IMGSize.y := ImageList.Height;\r\n                        {$ENDIF}\r\n\r\n                        if (imgth > ImageList.Height) then\r\n                        begin\r\n                          if imgalign = 0 then // bottom\r\n                            imgoffs := (imgth - ImageList.Height);\r\n\r\n                          if imgalign = 1 then // center\r\n                            imgoffs := (imgth - ImageList.Height) div 2;\r\n                        end;\r\n\r\n                        if not Calc and not Print then\r\n                        begin\r\n                          crc := ConvertToRect(ir);\r\n                          ImageList.Draw(AGraphics.Canvas,crc.Left,crc.Top + imgoffs,IStrToInt(Prop),True);\r\n                        end;\r\n                        {$ENDIF}\r\n                      end;\r\n                      {$ENDIF}\r\n                    end;\r\n\r\n                    bmp := nil;\r\n                    bmpcreated := false;\r\n\r\n                    if (Pos(':',Prop) = 0) and Assigned(BitmapContainer) then\r\n                    begin\r\n                      bmp := BitmapContainer.FindBitmap(Prop);\r\n                    end;\r\n\r\n                    {$IFNDEF WEBLIB}\r\n                    if (Pos('FILE://',Uppercase(Prop)) > 0)  then\r\n                    begin\r\n                      Delete(Prop,1,7);\r\n\r\n                      if FileExists(Prop) then\r\n                      begin\r\n                        bmp := TTMSFNCBitmap.Create;\r\n                        bmp.LoadFromFile(Prop);\r\n                        bmpcreated := true;\r\n                      end;\r\n                    end;\r\n                    {$ENDIF}\r\n                    {$IFDEF WEBLIB}\r\n                    if (Pos('URL://',Uppercase(Prop)) > 0)  then\r\n                    begin\r\n                      Delete(Prop,1,6);\r\n                      bmp := TTMSFNCBitmap(TTMSFNCBitmap.CreateFromURL(Prop));\r\n                      bmpcreated := true;\r\n                    end;\r\n                    {$ENDIF}\r\n\r\n                    imgw := 0;\r\n                    imgh := 0;\r\n\r\n                      if Assigned(bmp) then\r\n                      begin\r\n                        if not IsBitmapEmpty(bmp) then\r\n                        begin\r\n                          if (TagWidth > 0) and (TagHeight > 0) then\r\n                          begin\r\n                            imgw := TagWidth;\r\n                            imgh := TagHeight;\r\n                          end;\r\n                          if (TagWidth > 0) and (TagHeight = 0) then\r\n                          begin\r\n                            imgw := TagWidth;\r\n                            imgh := Round(TagWidth/bmp.Width * bmp.Height);\r\n                          end;\r\n                          if (TagWidth = 0) and (TagHeight > 0) then\r\n                          begin\r\n                            imgw := Round(TagHeight/bmp.Height * bmp.Width);\r\n                            imgh := TagHeight;\r\n                          end;\r\n                          if (TagWidth = 0) and (TagHeight = 0) then\r\n                          begin\r\n                            imgw := bmp.Width;\r\n                            imgh := bmp.Height;\r\n                          end;\r\n\r\n                          if imgfloat = fsRight then\r\n                            ir.Left := r.Right - imgw;\r\n\r\n                          if not Calc {and not Print} then\r\n                          begin\r\n                            if (TagWidth > 0) or (TagHeight > 0) then\r\n                            begin\r\n                              AGraphics.DrawBitmap(RectF(Round(ir.Left),Round(ir.Top),Round(ir.Left) + imgw,Round(ir.Top) + imgh), BitmapToDrawBitmap(bmp));\r\n                            end\r\n                            else\r\n                            if (TagWidth > 0) and (TagHeight = 0) then\r\n                            begin\r\n                              AGraphics.DrawBitmap(RectF(Round(ir.Left),Round(ir.Top),Round(ir.Left) + TagWidth,Round(ir.Top) + TagHeight),BitmapToDrawBitmap(bmp));\r\n                            end\r\n                            else\r\n                            begin\r\n                              AGraphics.DrawBitmap(RectF(Round(ir.Left),Round(ir.Top),Round(ir.Left) + bmp.Width, Round(ir.Top) + bmp.Height),BitmapToDrawBitmap(bmp));\r\n                            end;\r\n                          end;\r\n\r\n                          if (TagWidth > 0) or (TagHeight > 0) then\r\n                          begin\r\n                            IMGSize.x := imgw;\r\n                            IMGSize.y := imgh;\r\n                          end\r\n                          else\r\n                          begin\r\n                            IMGSize.x := bmp.Width;\r\n                            IMGSize.y := bmp.Height;\r\n                          end;\r\n                        end;\r\n\r\n                        if bmpcreated then\r\n                          bmp.Free;\r\n                      end;\r\n\r\n                    if (XPos - r.Left > w) and (XPos - r.Left < w + IMGSize.x) and\r\n                       (YPos > cr.Top) and (YPos < cr.Top + IMGSize.Y) and Anchor then\r\n                    begin\r\n                      ImageHotSpot := True;\r\n                      AnchorVal := LastAnchor;\r\n                      AltImg := ImgIdx;\r\n                    end;\r\n\r\n                    if (w + IMGSize.x > r.Right-r.Left) and\r\n                       (IMGSize.x < r.Right - r.Left) then\r\n                    begin\r\n                      ImgBreak := True;\r\n                    end\r\n                    else\r\n                      begin\r\n                        w := w + IMGSize.x;\r\n                        cr.left := cr.left + IMGSize.x;\r\n                        if IMGSize.y > h then\r\n                          h := IMGSize.y;\r\n                      end;\r\n\r\n                    if Pos('ALIGN',TagProp) > 0 then\r\n                    begin\r\n                      if Pos('\"TOP',TagProp) > 0 then\r\n                      begin\r\n                        rh := AGraphics.CalculateText('gh');\r\n                        ImgAli := h - (rh.Bottom - rh.Top);\r\n                      end\r\n                      else\r\n                      begin\r\n                        if Pos('\"MIDDLE',TagProp) > 0 then\r\n                        begin\r\n                          rh := AGraphics.CalculateText('gh');\r\n                          ImgAli := (h - (rh.Bottom - rh.Top)) / 2;\r\n                        end;\r\n                      end;\r\n                    end;\r\n\r\n                    if (Pos('WRAP',TagProp) > 0) then\r\n                    begin\r\n                      rh := AGraphics.CalculateText('gh');\r\n                      h := rh.Bottom - rh.Top;\r\n                      ImgAli := 0;\r\n                    end;\r\n\r\n                    if imgfloat = fsLeft then\r\n                    begin\r\n                      rh := AGraphics.CalculateText('gh');\r\n                      ImgAli := h - (rh.Bottom - rh.Top);\r\n                      floatrect.left := imgw;\r\n                      floatrect.bottom := imgh;\r\n                      if not calc then\r\n                      begin\r\n                        rh := AGraphics.CalculateText('gh');\r\n                        h := (rh.Bottom - rh.Top);\r\n                      end;\r\n                    end;\r\n\r\n                    if imgfloat = fsRight then\r\n                    begin\r\n                      rh := AGraphics.CalculateText('gh');\r\n                      ImgAli := h - (rh.Bottom - rh.Top);\r\n                      floatrect.right := imgw;\r\n                      floatrect.bottom := imgh;\r\n                      if not calc then\r\n                      begin\r\n                        rh := AGraphics.CalculateText('gh');\r\n                        h := rh.Bottom - rh.Top;\r\n                      end;\r\n                      w := fr.Right;\r\n                    end;\r\n\r\n                  end;\r\n                end;\r\n          'L':begin\r\n                NewColor := gcNull;\r\n                LType := '';\r\n\r\n                if (TTMSFNCUtils.VarPos('>',s,TagPos)>0) then\r\n                begin\r\n                  TagProp := Uppercase(Copy(s,3,TagPos-1));\r\n\r\n                  if TTMSFNCUtils.VarPos('TYPE',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos+4,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n                    LType := Prop;\r\n                  end;\r\n                  if TTMSFNCUtils.VarPos('COLOR',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos+5,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n\r\n                    if Length(Prop) > 0 then\r\n                    begin\r\n                      {$IFDEF FMXMOBILE}\r\n                      if Prop[0] = '#' then\r\n                      {$ELSE}\r\n                      if Prop[1] = '#' then\r\n                      {$ENDIF}\r\n                        NewColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                      else\r\n                        NewColor := TTMSFNCGraphics.TextToColor(prop);\r\n                    end;\r\n                  end;\r\n                end;\r\n\r\n                w := w + 12 * ListIndex;\r\n                if Linkbreak then\r\n                  Imgbreak := True else Linkbreak := True;\r\n\r\n                cr.left := cr.left + 12 * (ListIndex - 1);\r\n\r\n                if not calc and not Invisible then\r\n                begin\r\n                  if LType = '' then\r\n                  begin\r\n                    if (NewColor <> gcNull) then\r\n                    begin\r\n                      ColL := AGraphics.Font.Color;\r\n                      FontColor := NewColor;\r\n                    end;\r\n                    Prop := AGraphics.Font.Name;\r\n                    AGraphics.Font.Name := 'Symbol';\r\n\r\n                    if Odd(ListIndex) then\r\n                      AGraphics.DrawText(cr, '', False, gtaLeading, gtaCenter, gttNone, 0, -1, -1{$IFNDEF LIMITEDGRAPHICSMODE}, False{$ENDIF})\r\n                    else\r\n                      AGraphics.DrawText(cr, 'o', False, gtaLeading, gtaCenter, gttNone, 0, -1, -1{$IFNDEF LIMITEDGRAPHICSMODE}, False{$ENDIF});\r\n\r\n                    AGraphics.Font.Name := prop;\r\n                    if NewColor <> gcNull then\r\n                      FontColor := ColL;\r\n                  end\r\n                  else\r\n                  begin\r\n                    ColB := gcNull;\r\n\r\n                    if LTYPE = 'SQUARE' then\r\n                    begin\r\n                      ColB := AGraphics.Fill.Color;\r\n                      AGraphics.Stroke.Color := NewColor;\r\n                      AGraphics.Fill.Color := NewColor;\r\n                      AGraphics.DrawRectangle(RectF(cr.Left, cr.Top + 2, cr.Left + 8, cr.Top + 10));\r\n                      AGraphics.Fill.Color := ColB;\r\n                    end;\r\n\r\n                    if LTYPE = 'CIRCLE' then\r\n                    begin\r\n                      ColB := AGraphics.Fill.Color;\r\n                      AGraphics.Stroke.Color := NewColor;\r\n                      AGraphics.Fill.Color := NewColor;\r\n                      AGraphics.DrawEllipse(RectF(cr.Left, cr.Top + 2, cr.Left + 8, cr.Top + 10));\r\n                      AGraphics.Fill.Color := ColB;\r\n                    end;\r\n                  end;\r\n                end;\r\n                cr.Left := cr.Left + 12;\r\n              end;\r\n          'U':begin\r\n                {$IFDEF FMXMOBILE}\r\n                if s[2] <> '>' then\r\n                {$ELSE}\r\n                if s[3] <> '>' then\r\n                {$ENDIF}\r\n                begin\r\n                  Inc(ListIndex);\r\n                  LineBreak := true;\r\n                end\r\n                else\r\n                  AGraphics.Font.Style := AGraphics.Font.Style + [TFontStyle.fsUnderline];\r\n              end;\r\n          'O':begin\r\n                {$IFDEF FMXMOBILE}\r\n                TagChar := Upcase(s[2]);\r\n                {$ELSE}\r\n                TagChar := Upcase(s[3]);\r\n                {$ENDIF}\r\n                if TagChar = 'F' then  // <OFS> tag\r\n                begin\r\n                  TagProp := Copy(s,3,pos('>',s) - 1);\r\n                  Prop := Copy(TagProp,TTMSFNCUtils.ipos('x',TagProp) + 2,Length(TagProp));\r\n                  Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(prop));\r\n                  Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n                  val(Prop,NewOffsetX,err);\r\n                  cr.Left := NewOffsetX;\r\n                  w := NewOffsetX;\r\n                end\r\n              end;\r\n          'P':begin\r\n                if (TTMSFNCUtils.VarPos('>',s,TagPos)>0) then\r\n                begin\r\n                  TagProp := Uppercase(Copy(s,3,TagPos-1));\r\n\r\n                  if TTMSFNCUtils.VarPos('ALIGN',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos+5,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n\r\n                    if Pos('RIGHT',Prop) > 0 then Align := taRightJustify;\r\n                    if Pos('LEFT',Prop) > 0 then Align := taLeftJustify;\r\n                    if Pos('CENTER',Prop) > 0 then Align := taCenter;\r\n                  end;\r\n\r\n                  if TTMSFNCUtils.VarPos('INDENT',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos+6,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n                    PIndent := IStrToInt(Prop);\r\n                  end;\r\n\r\n                  if TTMSFNCUtils.VarPos('FLOAT',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos+5,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',prop)+1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n\r\n                    if Prop = 'LEFT' then\r\n                      txtfloat := fsLeft;\r\n\r\n                    if Prop = 'RIGHT' then\r\n                      txtfloat := fsRight;\r\n\r\n                    floatpt := Point(Round(r.Left), Round(r.Top));\r\n                  end;\r\n\r\n                  if TTMSFNCUtils.VarPos('BGCOLOR',TagProp,TagPos) > 0 then\r\n                  begin\r\n                    Prop := Copy(TagProp,TagPos + 5,Length(TagProp));\r\n                    Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                    Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                    NewColor := gcNull;\r\n\r\n                    if Length(Prop) > 0 then\r\n                    begin\r\n                      {$IFDEF FMXMOBILE}\r\n                      if Prop[0] = '#' then\r\n                      {$ELSE}\r\n                      if Prop[1] = '#' then\r\n                      {$ENDIF}\r\n                        NewColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                      else\r\n                        NewColor := TTMSFNCGraphics.TextToColor(prop);\r\n                    end;\r\n\r\n                    if TTMSFNCUtils.VarPos('BGCOLORTO',TagProp,TagPos) > 0 then\r\n                    begin\r\n                      Prop := Copy(TagProp,TagPos + 5,Length(TagProp));\r\n                      Prop := Copy(Prop,Pos('\"',Prop) + 1,Length(Prop));\r\n                      Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                      if not Calc then\r\n                      begin\r\n                        isPara := True;\r\n                        AGraphics.Stroke.Color := Newcolor;\r\n\r\n                        //DrawHTMLGradient(Canvas,NewColor,NewColorTo,clNone,64,Rect(fr.left,r.top,fr.right,r.bottom+2),true);\r\n                        //AGraphics.Brush.Style := bsClear\r\n                      end;\r\n                    end\r\n                    else\r\n                    begin\r\n                      if not Calc then\r\n                      begin\r\n                        isPara := True;\r\n                        paracolor := AGraphics.Fill.Color;\r\n                        //if AGraphics.Brush.Style = bsClear then ParaColor := clNone;\r\n                        AGraphics.Fill.color := NewColor;\r\n                        PenColor := AGraphics.Stroke.Color;\r\n                        AGraphics.Stroke.Color := Newcolor;\r\n                        AGraphics.DrawRectangle(RectF(fr.left,r.top,fr.right,r.bottom));\r\n                      end;\r\n                    end;\r\n                  end;\r\n                end;\r\n            end;\r\n        'F':begin\r\n              if (TTMSFNCUtils.VarPos('>',s,TagPos)>0) then\r\n              begin\r\n                TagProp := UpperCase(Copy(s,6,TagPos-6));\r\n\r\n                if (TTMSFNCUtils.VarPos('FACE',TagProp,TagPos) > 0) then\r\n                begin\r\n                  Prop := Copy(TagProp,TagPos+4,Length(TagProp));\r\n                  Prop := Copy(prop,pos('\"',prop)+1,Length(prop));\r\n                  Prop := Copy(prop,1,pos('\"',prop)-1);\r\n                  AGraphics.Font.Name := Prop;\r\n                end;\r\n\r\n                if (TTMSFNCUtils.VarPos(' COLOR',TagProp,TagPos) > 0) and not Selected then\r\n                begin\r\n                  Prop := Copy(TagProp,TagPos+6,Length(TagProp));\r\n                  Prop := Copy(Prop,Pos('\"',prop)+1,Length(prop));\r\n                  Prop := Copy(Prop,1,Pos('\"',prop)-1);\r\n                  OldFontColor := AGraphics.Font.Color;\r\n\r\n                  if Length(Prop) > 0 then\r\n                  begin\r\n                    {$IFDEF FMXMOBILE}\r\n                    if Prop[0] = '#' then\r\n                    {$ELSE}\r\n                    if Prop[1] = '#' then\r\n                    {$ENDIF}\r\n                      FontColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                    else\r\n                      FontColor := TTMSFNCGraphics.TextToColor(Prop);\r\n                  end;\r\n                end;\r\n\r\n                if (TTMSFNCUtils.VarPos('BGCOLOR',TagProp,TagPos)>0) and not Calc and not Selected then\r\n                begin\r\n                  Prop := Copy(TagProp,TagPos+7,Length(TagProp));\r\n                  Prop := Copy(prop,pos('\"',prop)+1,Length(prop));\r\n                  Prop := Copy(prop,1,pos('\"',prop)-1);\r\n\r\n                  if Length(Prop) > 0 then\r\n                  begin\r\n                    {$IFDEF FMXMOBILE}\r\n                    if Prop[0] = '#' then\r\n                    {$ELSE}\r\n                    if Prop[1] = '#' then\r\n                    {$ENDIF}\r\n                      BkColor := TTMSFNCGraphics.HTMLToColor(Prop)\r\n                    else\r\n                      BkColor := TTMSFNCGraphics.TextToColor(prop);\r\n                  end;\r\n\r\n                end;\r\n\r\n                if (TTMSFNCUtils.VarPos('SIZE',TagProp,TagPos)>0) then\r\n                begin\r\n                  Prop := Copy(TagProp,TagPos+4,Length(TagProp));\r\n                  Prop := Copy(Prop,Pos('=',Prop)+1,Length(Prop));\r\n                  Prop := Copy(Prop,Pos('\"',Prop)+1,Length(Prop));\r\n                  Prop := Copy(Prop,1,Pos('\"',Prop) - 1);\r\n\r\n                  case IStrToInt(Prop) of\r\n                  1: TTMSFNCUtils.SetFontSize(AGraphics.Font, 8);\r\n                  2: TTMSFNCUtils.SetFontSize(AGraphics.Font, 10);\r\n                  3: TTMSFNCUtils.SetFontSize(AGraphics.Font, 12);\r\n                  4: TTMSFNCUtils.SetFontSize(AGraphics.Font, 14);\r\n                  5: TTMSFNCUtils.SetFontSize(AGraphics.Font, 16);\r\n                  else\r\n                    TTMSFNCUtils.SetFontSize(AGraphics.Font, IStrToInt(Prop));\r\n                  end;\r\n                end;\r\n              end;\r\n            end;\r\n        'S':begin\r\n              {$IFDEF FMXMOBILE}\r\n              TagChar := Upcase(s[2]);\r\n              {$ELSE}\r\n              TagChar := Upcase(s[3]);\r\n              {$ENDIF}\r\n\r\n              if TagChar = '>' then\r\n                AGraphics.Font.Style := AGraphics.font.Style + [TFontStyle.fsStrikeOut]\r\n              else\r\n              begin\r\n                if TagChar = 'H' then\r\n                  isShad := True\r\n                else\r\n                begin\r\n                  if TTMSFNCUtils.ipos('<SUB>',s)=1 then\r\n                    isSub := True\r\n                  else\r\n                    if TTMSFNCUtils.ipos('<SUP>',s)=1 then\r\n                      isSup := True;\r\n                end;\r\n              end;\r\n            end;\r\n        'R':begin\r\n              TagProp := Copy(s,3,pos('>',s)-1);\r\n              prop := Copy(TagProp,TTMSFNCUtils.ipos('a',TagProp)+2,Length(TagProp));\r\n              prop := Copy(prop,pos('\"',prop)+1,Length(prop));\r\n              prop := Copy(prop,1,pos('\"',prop)-1);\r\n              //StartRotated(Canvas,indent);\r\n            end;\r\n        'Z':Invisible := True;\r\n        end;\r\n      end;\r\n\r\n      if (TTMSFNCUtils.VarPos('>',s,TagPos)>0) and not ImgBreak then\r\n      begin\r\n        Res := Res + Copy(s,1,TagPos);\r\n        Delete(s,1,TagPos);\r\n      end\r\n      else\r\n        if not Imgbreak then\r\n          Delete(s,1,Length(s));\r\n    end;\r\n  end;\r\n\r\n    w := w - sw;\r\n\r\n    if w > xsize then\r\n      xsize := w + 2;\r\n\r\n    if (FocusLink = Hyperlinks - 1) and Anchor and not Calc then\r\n    begin\r\n      rr.Right := cr.Left;\r\n      rr.Bottom := cr.Bottom;\r\n      InflateRectEx(rr,1,0);\r\n      //if not Calc then\r\n      //  AGraphics.DrawFocusRect(rr);\r\n      rr.Left := r.Left + 1;\r\n      rr.Top := rr.Bottom;\r\n    end;\r\n\r\n    Result := Res;\r\n  end;\r\n\r\nbegin\r\n  Anchor := False;\r\n  Error := False;\r\n  OldFont := TTMSFNCGraphicsFont.Create;\r\n  OldFont.AssignSource(AGraphics.Font);\r\n  OldFontColor := AGraphics.Font.Color;\r\n  DrawFont := TTMSFNCGraphicsFont.Create;\r\n  DrawFont.AssignSource(AGraphics.Font);\r\n  DrawFontColor := AGraphics.Font.Color;\r\n  CalcFont := TTMSFNCGraphicsFont.Create;\r\n  CalcFont.AssignSource(AGraphics.Font);\r\n  CalcFontColor := AGraphics.Font.Color;\r\n  OldDrawfont := TTMSFNCGraphicsFont.Create;\r\n  OldDrawFont.AssignSource(AGraphics.Font);\r\n  OldDrawFontColor := AGraphics.Font.Color;\r\n  OldCalcFont := TTMSFNCGraphicsFont.Create;\r\n  OldCalcFont.AssignSource(AGraphics.Font);\r\n  OldCalcFontColor := AGraphics.Font.Color;\r\n  BlnkColor := AGraphics.Fill.color;\r\n  OldPenColor := AGraphics.Stroke.Color;\r\n  BGColor := gcNull;\r\n  BkColor := gcNull;\r\n  ParaColor := gcNull;\r\n  isPara := False;\r\n  isShad := False;\r\n  Invisible := False;\r\n\r\n  OldFontColor := AGraphics.Font.Color;\r\n\r\n  ControlRect := RectF(0,0,0,0);\r\n  CV := '';\r\n  CT := '';\r\n  if not CheckHotSpot then\r\n    CID := '';\r\n\r\n  OfsX := 0;\r\n  NewOfsX := 0;\r\n\r\n  txtfloat := fsNone;\r\n  floatrect := Rect(0,0,0,0);\r\n\r\n  Result := False;\r\n\r\n  r := fr;\r\n\r\n  Align := taLeftJustify;\r\n  PIndent := 0;\r\n\r\n  XSize := 0;\r\n  YSize := 0;\r\n  HyperLinks := 0;\r\n  HlCount := 0;\r\n  ListIndex := 0;\r\n  LiCount := 0;\r\n  StripVal := '';\r\n  FocusAnchor := '';\r\n  MouseLink := -1;\r\n  MouseInAnchor := False;\r\n\r\n  ImgIdx := 0;\r\n  AltImg := -1;\r\n\r\n  if Pos('&',s) > 0 then\r\n  begin\r\n    repeat\r\n      Foundtag := False;\r\n\r\n      if TTMSFNCUtils.TagReplacestring('&amp;','&',s) then Foundtag := True;\r\n      if TTMSFNCUtils.TagReplacestring('&quot;','\"',s) then Foundtag := True;\r\n\r\n      if TTMSFNCUtils.TagReplacestring('&sect;','',s) then Foundtag := True;\r\n      if TTMSFNCUtils.TagReplacestring('&permil;','',s) then Foundtag := True;\r\n      if TTMSFNCUtils.TagReplacestring('&reg;','',s) then Foundtag := True;\r\n\r\n      if TTMSFNCUtils.TagReplacestring('&copy;','',s) then Foundtag := True;\r\n      if TTMSFNCUtils.TagReplacestring('&para;','',s) then Foundtag := True;\r\n\r\n      if TTMSFNCUtils.TagReplacestring('&trade;','',s) then Foundtag := True;\r\n      if TTMSFNCUtils.TagReplacestring('&euro;','',s) then Foundtag := True;\r\n\r\n    until not Foundtag;\r\n  end;\r\n\r\n  s := DBTagStrip(s);\r\n  s := CRLFStrip(s,True);\r\n\r\n  InsPoint := 0;\r\n  LineCount := 0;\r\n\r\n  while Length(s) > 0 do\r\n  begin\r\n    //calculate part of the HTML text fitting on the next line\r\n    OldFont.AssignSource(OldCalcFont);\r\n    OldFontColor := OldCalcFontColor;\r\n    AGraphics.Font.AssignSource(CalcFont);\r\n    FontColor := CalcFontColor;\r\n    OldAnchor := Anchor;\r\n    OldAnchorVal := LastAnchor;\r\n    suph := 0;\r\n    subh := 0;\r\n    imgali := 0;\r\n    isSup := False;\r\n    isSub := False;\r\n    HotSpot := False;\r\n    ImageHotSpot := False;\r\n    HTMLWidth := 0;\r\n    rh := AGraphics.CalculateText('gh');\r\n    HtmlHeight := rh.Bottom - rh.Top;\r\n    txtHeight := HtmlHeight;\r\n\r\n    OldImgIdx := ImgIdx;\r\n\r\n    s := Trim(s);\r\n\r\n    txtfloatbefore := txtfloat;\r\n\r\n    su := HTMLDrawLine(AGraphics,s,r,True,HtmlWidth,HtmlHeight,subh,suph,imgali,Align,PIndent,XPos,YPos,HotSpot,ImageHotSpot,ofsx,newofsx, floatrect,txtfloat);\r\n    Inc(LineCount);\r\n\r\n    Anchor := OldAnchor;\r\n    LastAnchor := OldAnchorVal;\r\n\r\n    CalcFont.AssignSource(AGraphics.Font);\r\n    CalcFontColor := AGraphics.Font.Color;\r\n    OldCalcFont.AssignSource(OldFont);\r\n    OldCalcFontColor := OldFontColor;\r\n\r\n    HTMLHeight := HTMLHeight + LineSpacing;\r\n\r\n    dr := r;\r\n\r\n    case Align of\r\n    taCenter:if (r.right - r.left - htmlwidth > 0) then\r\n               dr.left := r.left+((r.right - r.left - htmlwidth) / 2);\r\n    taRightJustify:if r.right - htmlwidth > r.left then\r\n                       dr.left := r.right - htmlwidth;\r\n    end;\r\n\r\n    dr.Left := dr.Left + PIndent;\r\n\r\n    dr.Bottom := dr.Top + HtmlHeight + Subh + Suph;\r\n\r\n    if not CheckHeight then\r\n    begin\r\n      OldFont.AssignSource(OldDrawFont);\r\n      OldFontColor := OldDrawFontColor;\r\n      AGraphics.Font.AssignSource(DrawFont);\r\n      FontColor := DrawFontColor;\r\n\r\n      HyperLinks := HlCount;\r\n      ListIndex := LiCount;\r\n      ImgIdx := OldImgIdx;\r\n\r\n      HTMLDrawLine(AGraphics,su,dr,CheckHotSpot,HtmlWidth,HtmlHeight,subh,suph,ImgAli,Align,PIndent,XPos,YPos,HotSpot,ImageHotspot,ofsx,newofsx, floatrect,txtfloat);\r\n\r\n      HlCount := HyperLinks;\r\n      LiCount := ListIndex;\r\n\r\n      r.left := fr.Left + floatrect.left;\r\n\r\n      r.right := fr.Right - floatrect.right;\r\n\r\n      if dr.Top > floatrect.bottom then\r\n      begin\r\n        floatrect.Left := 0;\r\n        floatrect.Right := 0;\r\n        r.Left := fr.Left;\r\n      end;\r\n\r\n      rh := AGraphics.CalculateText('gh');\r\n\r\n      if (HotSpot and\r\n         (YPos > dr.Bottom - ImgAli - (rh.Bottom - rh.Top)) and\r\n         (YPos < dr.Bottom - ImgAli)) or ImageHotSpot then\r\n      begin\r\n        Result := True;\r\n      end;\r\n\r\n      ofsx := newofsx;\r\n\r\n      DrawFont.AssignSource(AGraphics.Font);\r\n      DrawFontColor := FontColor;\r\n      OldDrawFont.AssignSource(OldFont);\r\n      OldDrawFontColor := OldFontColor;\r\n    end;\r\n\r\n    if (txtfloat <> fsNone) and (txtfloat <> txtfloatbefore) then\r\n    begin\r\n      r.Left := floatpt.x;\r\n      r.Top := floatpt.y;\r\n      txtfloat := fsNone;\r\n    end\r\n    else\r\n    begin\r\n      r.top := r.top + HtmlHeight + subh + suph;\r\n      ysize := ysize + HtmlHeight + subh + suph;\r\n    end;\r\n\r\n    //do not draw below bottom\r\n    if (r.top + TxtHeight > r.bottom + 1) and not CheckHeight then\r\n      s := '';\r\n  end;\r\n\r\n  if (ysize = 0) then\r\n  begin\r\n    rh := AGraphics.CalculateText('gh');\r\n    ysize := rh.Bottom - rh.Top;\r\n  end;\r\n\r\n  //ysize := ysize + 2;\r\n\r\n  InsPoint := InsPoint shr 1;\r\n\r\n  AGraphics.Stroke.Color := OldPenColor;\r\n  AGraphics.Fill.Color := BlnkColor;\r\n  AGraphics.Font.AssignSource(OldFont);\r\n  OldFont.Free;\r\n  DrawFont.Free;\r\n  CalcFont.Free;\r\n  OldDrawfont.Free;\r\n  OldCalcfont.Free;\r\nend;\r\n\r\nfunction HTMLDrawEx(AGraphics: TTMSFNCGraphics; s:string; fr:TRectF;\r\n                    XPos,YPos,FocusLink,HoverLink,ShadowOffset: Integer;\r\n                    CheckHotSpot,CheckHeight,{%H-}Print,Selected,Blink,HoverStyle,WordWrap: Boolean;\r\n                    {%H-}ResFactor:Double;\r\n                    URLColor,HoverColor,HoverFontColor,ShadowColor: TTMSFNCGraphicsColor;\r\n                    var AnchorVal,StripVal,FocusAnchor: string;\r\n                    var XSize,YSize: single; var HyperLinks,MouseLink: Integer;\r\n                    var HoverRect: TRectF; var LineCount: Integer; LineSpacing: Integer;\r\n                    BitmapContainer: TTMSFNCBitmapContainer; {%H-}Opacity: Single; HyperLinkUnderline: Boolean = True{$IFDEF CMNLIB}; ImageList: TCustomImageList = nil{$ENDIF};\r\n                    HighlightColor: TTMSFNCGraphicsColor = gcBlue;\r\n                    HighlightTextColor: TTMSFNCGraphicsColor = gcWhite;\r\n                    HighlightTextStyle: TFontStyles = []\r\n                    ): Boolean;\r\nvar\r\n  cr: TRectF;\r\n  cid: string;\r\n  cv: string;\r\n  ct: string;\r\nbegin\r\n  cid := '';\r\n  cv := '';\r\n  ct := '';\r\n  cr := RectF(0, 0, 0, 0);\r\n  Result := HTMLDrawEx(AGraphics, s, fr, XPos, YPos, FocusLink, HoverLink, ShadowOffset, CheckHotSpot, CheckHeight, Print, Selected, Blink, HoverStyle, WordWrap, False, '',\r\n    ResFactor, URLColor, HoverColor, HoverFontColor, ShadowColor, AnchorVal, StripVal, FocusAnchor, XSize, YSize, HyperLinks, MouseLink, HoverRect, cr, cid, cv, ct, LineCount, LineSpacing, BitmapContainer,\r\n    Opacity, HyperLinkUnderline{$IFDEF CMNLIB}, ImageList{$ENDIF}, HighlightColor, HighlightTextColor, HighlightTextStyle);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2017                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCGraphics.General;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF FMXLIB}\r\n{$IFDEF MSWINDOWS}\r\n{$DEFINE FMXWINDOWS}\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCGraphicsTypes,\r\n  Types, WEBLib.Graphics, WEBLib.TMSFNCGraphics,\r\n  WEBLib.TMSFNCTypes\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types, FMX.TextLayout, System.Math.Vectors\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  ,UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  ;\r\n\r\ntype\r\n  TTMSFNCGraphicsContextGeneral = class(TTMSFNCGraphicsContext)\r\n  private\r\n    {%H-}FShowAcceleratorChar: Boolean;\r\n    {$IFDEF CMNLIB}\r\n    FOldPenHandle: THandle;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    FOldPenStyle: TPenStyle;\r\n    FOldPenWidth: Integer;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FMatrix: TMatrix;\r\n    FMatrixSaved: Boolean;\r\n    FTextMatrix: TMatrix;\r\n    FTextLayout: TTextLayout;\r\n    {$ENDIF}\r\n  protected\r\n    function GetNativeCanvas: Pointer; override;\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    procedure DrawRotatedText(ACanvas: TCanvas; ARect: TRectF; AText: String; AAngle: Single; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    procedure DrawRotatedText(ACanvas: TCanvas; ARect: TRect; AText: String; AAngle: Single; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign);\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    {$IFDEF FMXWINDOWS}\r\n    function CalculateTextWin(AText: string; ARect: TRectF; AWordWrapping: Boolean): TRectF; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    procedure SaveMatrix;\r\n    procedure RestoreMatrix;\r\n    {$ENDIF}\r\n  public\r\n    destructor Destroy; override;\r\n    function GetFillColor: TTMSFNCGraphicsColor; override;\r\n    function CalculateText(AText: string; ARect: TRectF; AWordWrapping: Boolean): TRectF; override;\r\n    function SetTextAngle(ARect: TRectF; {%H-}AAngle: Single): TRectF; override;\r\n    function CreatePath: Pointer; override;\r\n    procedure Render; override;\r\n    procedure PathOpen({%H-}APath: Pointer); override;\r\n    procedure PathMoveTo(APath: Pointer; APoint: TPointF); override;\r\n    procedure PathLineTo(APath: Pointer; APoint: TPointF); override;\r\n    procedure PathClose(APath: Pointer); override;\r\n    procedure ResetTransform; override;\r\n    procedure ResetClip; override;\r\n    procedure ScaleTransform({%H-}AX, {%H-}AY: Single); override;\r\n    procedure RotateTransform({%H-}AAngle: Single); override;\r\n    procedure TranslateTransform({%H-}AX, {%H-}AY: Single); override;\r\n    procedure SetTextQuality({%H-}ATextQuality: TTMSFNCGraphicsTextQuality); override;\r\n    procedure SetAntiAliasing({%H-}AAntiAliasing: Boolean); override;\r\n    procedure SetShowAcceleratorChar({%H-}AShowAcceleratorChar: Boolean); override;\r\n    procedure SetSize({%H-}AWidth, {%H-}AHeight: Single); override;\r\n    procedure ResetTextAngle({%H-}AAngle: Single); override;\r\n    procedure BeginScene; override;\r\n    procedure EndScene; override;\r\n    procedure StartSpecialPen; override;\r\n    procedure StopSpecialPen; override;\r\n    procedure RestoreState(AState: TTMSFNCGraphicsSaveState); override;\r\n    procedure SaveState({%H-}AState: TTMSFNCGraphicsSaveState); override;\r\n    procedure SetFontSize(ASize: Integer); override;\r\n    procedure SetFontColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetFontName(AName: string); override;\r\n    procedure SetFont(AFont: TTMSFNCGraphicsFont); override;\r\n    procedure SetFontStyles(AStyle: TFontStyles); override;\r\n    procedure SetFill(AFill: TTMSFNCGraphicsFill); override;\r\n    procedure SetFillKind(AKind: TTMSFNCGraphicsFillKind); override;\r\n    procedure SetFillColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetStroke(AStroke: TTMSFNCGraphicsStroke); override;\r\n    procedure SetStrokeKind(AKind: TTMSFNCGraphicsStrokeKind); override;\r\n    procedure SetStrokeColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetStrokeWidth(AWidth: Single); override;\r\n    procedure DrawLine({%H-}AStroke: TTMSFNCGraphicsStroke; AFromPoint: TPointF; AToPoint: TPointF; {%H-}AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown; {%H-}AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown); override;\r\n    procedure DrawPolygon({%H-}AStroke: TTMSFNCGraphicsStroke; APolygon: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillPolygon({%H-}AFill: TTMSFNCGraphicsFill; APolygon: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure DrawPolyline({%H-}AStroke: TTMSFNCGraphicsStroke; APolyline: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillPolyline({%H-}AFill: TTMSFNCGraphicsFill; APolyline: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillArc({%H-}AFill: TTMSFNCGraphicsFill; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single); override;\r\n    procedure DrawArc({%H-}AStroke: TTMSFNCGraphicsStroke; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single); override;\r\n    procedure FillRect({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawRect({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure FillRoundRect({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawRoundRect({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure FillEllipse({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawEllipse({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawBitmap(ABitmap: TTMSFNCDrawBitmap; {%H-}ASrcRect, ADstRect: TRectF; {%H-}AOpacity: Single); override;\r\n    procedure ClipRect(ARect: TRectF); override;\r\n    procedure ClipPath({%H-}APath: TTMSFNCGraphicsPath); override;\r\n    procedure DrawFocusPath({%H-}AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; AColor: TTMSFNCGraphicsColor); override;\r\n    procedure DrawFocusRectangle({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; AColor: TTMSFNCGraphicsColor; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawText(AText: string; ARect: TRectF; AWordWrapping: Boolean; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign; ATrimming: TTMSFNCGraphicsTextTrimming; AAngle: Single); override;\r\n    procedure DrawPath({%H-}AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); override;\r\n    procedure FillPath({%H-}AFill: TTMSFNCGraphicsFill; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); override;\r\n  end;\r\n\r\nfunction GetNativeContextClass: TTMSFNCGraphicsContextClass;\r\n\r\nimplementation\r\n\r\nuses\r\n  Math\r\n  {$IFDEF MSWINDOWS}\r\n  {$IFNDEF LCLLIB}\r\n  ,Windows\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF FMXWINDOWS}\r\n  ,SysUtils, WinApi.D2D1, WinApi.D3D10, WinApi.Dxgi,WinApi.DxgiFormat,\r\n  WinApi.ActiveX, FMX.Canvas.D2D, Winapi.D3D10_1,\r\n  FMX.Consts\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,LCLIntF, LCLType\r\n  {$ENDIF}\r\n  ;\r\n\r\n{$IFDEF FMXWINDOWS}\r\ntype\r\n  TDirect3DLevel = (lUndetermined, lUnsupported, lDirect3D10, lDirect3D10_1);\r\n  TDirect3DSupport = (sUndetermined, sDirect3D10Legacy, sDirect3D10, sDirect3D10_1);\r\n\r\nvar\r\n  FSharedDevice: ID3D10Device;\r\n  FSharedDXGIFactory: IDXGIFactory;\r\n  FSharedFactory: ID2D1Factory;\r\n  FSharedDWriteFactory: IDWriteFactory;\r\n  FDirect3DLevel: TDirect3DLevel;\r\n  FDirect3DSupport: TDirect3DSupport;\r\n  FDirect3DHardware: Boolean;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXWINDOWS}\r\nfunction TTMSFNCGraphicsContextGeneral.CalculateTextWin(AText: string; ARect: TRectF; AWordWrapping: Boolean): TRectF;\r\nvar\r\n  TextRange: TDWriteTextRange;\r\n  TextFormat: IDWriteTextFormat;\r\n  LocaleName: string;\r\n  TrimOptions: TDwriteTrimming;\r\n  TrimmingSign: IDWriteInlineObject;\r\n  FLayout: IDWriteTextLayout;\r\n  FMetrics: TDWriteTextMetrics;\r\n  FOverhangMetrics: TDwriteOverhangMetrics;\r\n  PrevFPUState: TArithmeticExceptionMask;\r\n\r\n  procedure SaveClearFPUState;\r\n  begin\r\n    PrevFPUState:= GetExceptionMask;\r\n    SetExceptionMask(exAllArithmeticExceptions);\r\n  end;\r\n\r\n  procedure RestoreFPUState;\r\n  begin\r\n    SetExceptionMask(PrevFPUState);\r\n  end;\r\n\r\n  function D2FontWeight(const Style: TFontStyles): TDWriteFontWeight; inline;\r\n  begin\r\n    Result := DWRITE_FONT_WEIGHT_REGULAR;\r\n    if TFontStyle.fsBold in Style then\r\n      Result := DWRITE_FONT_WEIGHT_BOLD;\r\n  end;\r\n\r\n  function D2FontStyle(const Style: TFontStyles): TDWriteFontStyle; inline;\r\n  begin\r\n    Result := 0;\r\n    if TFontStyle.fsItalic in Style then\r\n      Result := Result + DWRITE_FONT_STYLE_OBLIQUE;\r\n  end;\r\n\r\n  procedure UpdateDirect3DLevel;\r\n  var\r\n    DXLib: THandle;\r\n  begin\r\n    if FDirect3DLevel = TDirect3DLevel.lUndetermined then\r\n    begin\r\n      {$HINTS OFF}\r\n      if {$IF COMPILERVERSION > 27}GlobalUseDX{$ELSE}GlobalUseDX10{$IFEND} then\r\n      {$HINTS ON}\r\n      begin\r\n        FDirect3DLevel := TDirect3DLevel.lUndetermined;\r\n\r\n        // Direct3D 10.1\r\n        DXLib := LoadLibrary(D3D10_1_dll);\r\n        if DXLib <> 0 then\r\n        try\r\n          if GetProcAddress(DXLib, 'D3D10CreateDevice1') <> nil then\r\n            FDirect3DLevel := TDirect3DLevel.lDirect3D10_1;\r\n        finally\r\n          FreeLibrary(DXLib);\r\n        end;\r\n\r\n        if FDirect3DLevel = TDirect3DLevel.lUndetermined then\r\n        begin // Direct3D 10.0\r\n          DXLib := LoadLibrary(D3D10dll);\r\n          if DXLib <> 0 then\r\n          try\r\n            if GetProcAddress(DXLib, 'D3D10CreateDevice') <> nil then\r\n              FDirect3DLevel := TDirect3DLevel.lDirect3D10;\r\n          finally\r\n            FreeLibrary(DXLib);\r\n          end;\r\n        end;\r\n\r\n        if FDirect3DLevel = TDirect3DLevel.lUndetermined then\r\n          FDirect3DLevel := TDirect3DLevel.lUnsupported;\r\n      end\r\n      else\r\n        FDirect3DLevel := TDirect3DLevel.lUnsupported;\r\n    end;\r\n  end;\r\n\r\n  procedure CreateDirect3DDevice;\r\n\r\n  function CreateDevice(const DriverType: D3D10_DRIVER_TYPE): HResult;\r\n  var\r\n    Flags: Cardinal;\r\n  begin\r\n    Result := S_OK;\r\n    Flags := D3D10_CREATE_DEVICE_BGRA_SUPPORT;\r\n\r\n    if FDirect3DLevel = TDirect3DLevel.lDirect3D10_1 then\r\n    begin\r\n      // Direct3D 10.1 with full hardware support\r\n      Result := D3D10CreateDevice1(nil, DriverType, 0, Flags, D3D10_FEATURE_LEVEL_10_1,\r\n        D3D10_1_SDK_VERSION, ID3D10Device1(FSharedDevice));\r\n\r\n      if Succeeded(Result) then\r\n        FDirect3DSupport := TDirect3DSupport.sDirect3D10_1;\r\n\r\n      if Failed(Result) then\r\n      begin\r\n        // Direct3D 10.1 with hardware support of 10.0\r\n        Result := D3D10CreateDevice1(nil, DriverType, 0, Flags, D3D10_FEATURE_LEVEL_10_0,\r\n          D3D10_1_SDK_VERSION, ID3D10Device1(FSharedDevice));\r\n\r\n        if Succeeded(Result) then\r\n          FDirect3DSupport := TDirect3DSupport.sDirect3D10;\r\n      end;\r\n    end;\r\n\r\n    if (FDirect3DLevel = TDirect3DLevel.lDirect3D10) or Failed(Result) then\r\n    begin\r\n      // Legacy Direct3D 10.0 (on unpatched version of Vista)\r\n      Result := D3D10CreateDevice(nil, DriverType, 0, Flags, D3D10_SDK_VERSION, FSharedDevice);\r\n\r\n      if Succeeded(Result) then\r\n      begin\r\n        FDirect3DLevel := TDirect3DLevel.lDirect3D10;\r\n        FDirect3DSupport := TDirect3DSupport.sDirect3D10Legacy;\r\n      end;\r\n    end;\r\n  end;\r\n\r\nvar\r\n  Res: HResult;\r\nbegin\r\n  if FDirect3DLevel < TDirect3DLevel.lDirect3D10 then\r\n    raise Exception.CreateFmt('Cannot determine Direct3D support level.', [ClassType]);\r\n\r\n  SaveClearFPUState;\r\n  try\r\n    {$HINTS OFF}\r\n    if {$IF COMPILERVERSION > 27}GlobalUseDXSoftware{$ELSE}GlobalUseDX10Software{$IFEND} then\r\n    {$HINTS ON}\r\n    begin\r\n      Res := CreateDevice(D3D10_DRIVER_TYPE_WARP);\r\n      if Failed(Res) then\r\n      begin\r\n        // WARP device might not be supported on pre-DX10.1 system, which may still support DX10 in hardware.\r\n        Res := CreateDevice(D3D10_DRIVER_TYPE_HARDWARE);\r\n        if Succeeded(Res) then\r\n          FDirect3DHardware := True;\r\n      end\r\n      else\r\n        FDirect3DHardware := False;\r\n    end\r\n    else\r\n    begin\r\n      Res := CreateDevice(D3D10_DRIVER_TYPE_HARDWARE);\r\n      if Failed(Res) then\r\n      begin\r\n        Res := CreateDevice(D3D10_DRIVER_TYPE_WARP);\r\n        if Succeeded(Res) then\r\n          FDirect3DHardware := False;\r\n      end\r\n      else\r\n        FDirect3DHardware := True;\r\n    end;\r\n\r\n    if Failed(Res) then\r\n      raise ECannotCreateD3DDevice.CreateFmt(SCannotCreateD3DDevice, [ClassType]);\r\n  finally\r\n    RestoreFPUState;\r\n  end;\r\nend;\r\n\r\nprocedure AcquireDXGIFactory;\r\nvar\r\n  DXGIDevice: IDXGIDevice;\r\n  DXGIAdapter: IDXGIAdapter;\r\nbegin\r\n  if Succeeded(FSharedDevice.QueryInterface(IDXGIDevice, DXGIDevice)) and (DXGIDevice <> nil) and\r\n    Succeeded(DXGIDevice.GetParent(IDXGIAdapter, DXGIAdapter)) and (DXGIAdapter <> nil) then\r\n      DXGIAdapter.GetParent(IDXGIFactory, FSharedDXGIFactory);\r\nend;\r\n\r\nprocedure CreateDirect2DFactory;\r\nvar\r\n  FactoryOptions: PD2D1FactoryOptions;\r\n  Res: HResult;\r\nbegin\r\n  FactoryOptions := nil;\r\n  Res := D2D1CreateFactory(D2D1_FACTORY_TYPE_MULTI_THREADED, ID2D1Factory, FactoryOptions, FSharedFactory);\r\n  if Failed(Res) or (FSharedFactory = nil) then\r\n    raise Exception.CreateFmt('Cannot create Direct2D Factory object for ''%s''.', [ClassType]);\r\n\r\n  if Failed(DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(FSharedDWriteFactory))) then\r\n    raise Exception.CreateFmt('Cannot create DirectWrite Factory object for ''%s''.', [ClassType]);\r\nend;\r\n\r\nprocedure CreateSharedResources;\r\nbegin\r\n  UpdateDirect3DLevel;\r\n  if FSharedDevice = nil then\r\n  begin\r\n    CreateDirect3DDevice;\r\n    AcquireDXGIFactory;\r\n  end;\r\n  if FSharedFactory = nil then\r\n    CreateDirect2DFactory;\r\nend;\r\n\r\nfunction SharedDWriteFactory: IDWriteFactory;\r\nbegin\r\n  if FSharedDWriteFactory = nil then\r\n    CreateSharedResources;\r\n  Result := FSharedDWriteFactory;\r\nend;\r\n\r\nvar\r\n  r: TRectF;\r\n  dwVersion:Dword;\r\n  dwWindowsMajorVersion: Dword;\r\nbegin\r\n  dwVersion := GetVersion;\r\n  dwWindowsMajorVersion :=  DWORD(LOBYTE(LOWORD(dwVersion)));\r\n  if (dwWindowsMajorVersion = 5) then\r\n  begin\r\n    r := ARect;\r\n    Canvas.MeasureText(r, AText, AWordWrapping, [], TTextAlign.Leading, TTextAlign.Leading);\r\n    Result := r;\r\n  end\r\n  else\r\n  begin\r\n    Result := RectF(0, 0, 0, 0);\r\n    FLayout := nil;\r\n    if Succeeded(SharedDWriteFactory.CreateTextFormat(PChar(Canvas.Font.Family), nil, D2FontWeight(Canvas.Font.Style),\r\n      D2FontStyle(Canvas.Font.Style), DWRITE_FONT_STRETCH_NORMAL, Canvas.Font.Size, PChar(LocaleName), TextFormat)) then\r\n    try\r\n      TextFormat.SetReadingDirection(DWRITE_READING_DIRECTION_LEFT_TO_RIGHT);\r\n\r\n      if not AWordWrapping then\r\n        TextFormat.SetWordWrapping(DWRITE_WORD_WRAPPING_NO_WRAP)\r\n      else\r\n        TextFormat.SetWordWrapping(DWRITE_WORD_WRAPPING_WRAP);\r\n\r\n      FillChar(TrimOptions, SizeOf(TDwriteTrimming), 0);\r\n      TrimOptions.granularity := DWRITE_TRIMMING_GRANULARITY_NONE;\r\n\r\n      TrimmingSign := nil;\r\n      TextFormat.SetTrimming(TrimOptions, TrimmingSign);\r\n      TrimmingSign := nil;\r\n\r\n      if Succeeded(SharedDWriteFactory.CreateTextLayout(PChar(AText), AText.Length, TextFormat, ARect.Width,\r\n        ARect.Height, FLayout)) then\r\n      begin\r\n        TextRange.StartPosition := 0;\r\n        TextRange.Length := AText.Length;\r\n        FLayout.SetStrikethrough(TFontStyle.fsStrikeOut in Canvas.Font.Style, TextRange);\r\n        FLayout.SetUnderline(TFontStyle.fsUnderline in Canvas.Font.Style, TextRange);\r\n        FLayout.GetMetrics(FMetrics);\r\n        FLayout.GetOverhangMetrics(FOverhangMetrics);\r\n\r\n        Result := TRectF.Create(FMetrics.left, FMetrics.top,\r\n          FMetrics.left + {Max(}FMetrics.widthIncludingTrailingWhitespace{, FOverhangMetrics.Right + AMaxRect.Width)},\r\n          FMetrics.top + Min(FMetrics.height, FMetrics.layoutHeight));\r\n        Result.Offset(ARect.TopLeft);\r\n        if FMetrics.top < 0 then\r\n          Result.Offset(0, Abs(FMetrics.top));\r\n      end;\r\n    finally\r\n      TextFormat := nil;\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCGraphicsContextGeneral.SaveMatrix;\r\nbegin\r\n  if not FMatrixSaved then\r\n  begin\r\n    FMatrixSaved := True;\r\n    FMatrix := Canvas.Matrix;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.RestoreMatrix;\r\nbegin\r\n  if FMatrixSaved then\r\n  begin\r\n    FMatrixSaved := False;\r\n    Canvas.SetMatrix(FMatrix);\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawRotatedText(ACanvas: TCanvas; ARect: TRectF; AText: String; AAngle: Single; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign);\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawRotatedText(ACanvas: TCanvas; ARect: TRect; AText: String; AAngle: Single; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign);\r\n{$ENDIF}\r\nvar\r\n  tw, th: Single;\r\n  so: Integer;\r\n  s: String;\r\n  xs, ys, angle: Single;\r\nbegin\r\n  s := AText;\r\n  angle := -10 * AAngle;\r\n  {$IFDEF CMNLIB}\r\n  so := ACanvas.Font.Orientation;\r\n  ACanvas.Font.Orientation := Round(angle);\r\n  {$ENDIF}\r\n\r\n  xs := ARect.Left;\r\n  ys := ARect.Top;\r\n  tw := ACanvas.TextWidth(s);\r\n  th := ACanvas.TextHeight(s);\r\n\r\n  {$IFDEF CMNLIB}\r\n  if angle < 0 then\r\n  begin\r\n    case AHorizontalAlign of\r\n      gtaCenter: ys := ys + (ARect.Bottom - ARect.Top - tw) / 2;\r\n      gtaTrailing: ys := ys + (ARect.Bottom - ARect.Top - tw);\r\n    end;\r\n\r\n    case AVerticalAlign of\r\n      gtaCenter: xs := xs + (ARect.Right - ARect.Left) / 2 + th / 2;\r\n      gtaLeading: xs := xs + (ARect.Right - ARect.Left);\r\n      gtaTrailing: xs := xs + th;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case AHorizontalAlign of\r\n      gtaCenter: ys := ys + (ARect.Bottom - ARect.Top - tw) / 2 + tw;\r\n      gtaLeading: ys := ys + (ARect.Bottom - ARect.Top);\r\n      gtaTrailing: ys := ys + tw;\r\n    end;\r\n\r\n    case AVerticalAlign of\r\n      gtaCenter: xs := xs + (ARect.Right - ARect.Left) / 2 - th / 2;\r\n      gtaTrailing: xs := xs + (ARect.Right - ARect.Left - th);\r\n    end;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF WEBLIB}\r\n  ACanvas.TextOut(xs, ys, s);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  ACanvas.TextOut(Round(xs), Round(ys), s);\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  ACanvas.Font.Orientation := so;\r\n  {$ENDIF}\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCGraphicsContext }\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.BeginScene;\r\nbegin\r\n  {$IFDEF FMXWEBLIB}\r\n  if Assigned(Canvas) then\r\n  begin\r\n    Canvas.BeginScene;\r\n    Canvas.Clear(gcNull);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextGeneral.CalculateText(AText: string; ARect: TRectF;\r\n  AWordWrapping: Boolean): TRectF;\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  {$IFDEF VCLLIB}\r\n  r: TRect;\r\n  dstyle: TTextFormat;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  r: TRect;\r\n  dstyle: Word;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  r: TCanvasRectF;\r\n  {$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := ARect;\r\n  {$IFDEF FMXWINDOWS}\r\n  Result := CalculateTextWin(AText, Result, AWordWrapping)\r\n  {$ELSE}\r\n  Canvas.MeasureText(Result, AText, AWordWrapping, [], TTextAlign.Leading, TTextAlign.Leading)\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  r := Canvas.TextRect(r, AText, AWordWrapping, True);\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  dstyle := [tfCalcRect];\r\n  if AWordWrapping then\r\n    dstyle := dstyle + [tfWordBreak]\r\n  else\r\n    dstyle := dstyle + [tfSingleLine];\r\n\r\n  if not FShowAcceleratorChar then\r\n    dstyle := dstyle + [tfNoPrefix];\r\n\r\n  Canvas.TextRect(r, AText, dstyle);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  dstyle := DT_CALCRECT;\r\n  if AWordWrapping then\r\n    dstyle := dstyle or DT_WORDBREAK\r\n  else\r\n    dstyle := dstyle or DT_SINGLELINE;\r\n\r\n  if not FShowAcceleratorChar then\r\n    dstyle := dstyle or DT_NOPREFIX;\r\n\r\n  LCLIntF.DrawText(Canvas.Handle, PChar(AText), Length(AText), r, dstyle);\r\n  {$ENDIF}\r\n  Result := RectF(r.Left, r.Top, r.Right, r.Bottom);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ClipPath(APath: TTMSFNCGraphicsPath);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ClipRect(ARect: TRectF);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.IntersectClipRect(ARect);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF VCLLIB}\r\n  IntersectClipRect(Canvas.Handle, Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Canvas.Clipping := True;\r\n  Canvas.ClipRect := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.ClipRect := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextGeneral.CreatePath: Pointer;\r\nbegin\r\n  Result := TTMSFNCGraphicsPath.Create;\r\nend;\r\n\r\ndestructor TTMSFNCGraphicsContextGeneral.Destroy;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if Assigned(FTextLayout) then\r\n  begin\r\n    FTextLayout.Free;\r\n    FTextLayout := nil;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawArc(AStroke: TTMSFNCGraphicsStroke; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  {$IFDEF CMNLIB}\r\n  x, y, xs, ys, sx, sy, sxs, sys: Integer;\r\n  {$ENDIF}\r\n  bs: TBrushStyle;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.DrawArc(ACenter, ARadius, AStartAngle, ASweepAngle, AStroke.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF WEBLIB}\r\n  sx := Floor(ACenter.X - ARadius.X);\r\n  sy := Floor(ACenter.Y - ARadius.Y);\r\n  sxs := Floor(ACenter.X + ARadius.X);\r\n  sys := Floor(ACenter.Y + ARadius.Y);\r\n\r\n  x := Floor(ACenter.X + (ARadius.X * COS(DegToRad(-AStartAngle - ASweepAngle))));\r\n  y := Floor(ACenter.Y - (ARadius.Y * SIN(DegToRad(-AStartAngle - ASweepAngle))));\r\n  xs := Floor(ACenter.X + (ARadius.X * COS(DegToRad(-AStartAngle))));\r\n  ys := Floor(ACenter.Y - (ARadius.Y * SIN(DegToRad(- AStartAngle))));\r\n  {$ENDIF}\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  {$IFNDEF WEBLIB}\r\n  Canvas.Arc(sx, sy, sxs, sys, x, y, xs, ys);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.AngleArc(ACenter.X, ACenter.Y, ARadius.X, AStartAngle, ASweepAngle);\r\n  {$ENDIF}\r\n  Canvas.Brush.Style := bs;\r\n  Canvas.Brush.Color := c;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawBitmap(ABitmap: TTMSFNCDrawBitmap; ASrcRect, ADstRect: TRectF; AOpacity: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.DrawBitmap(ABitmap, ASrcRect, ADstRect, AOpacity, True);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.StretchDraw(CreateCanvasRectF(ADstRect.Left, ADstRect.Top, ADstRect.Right, ADstRect.Bottom), ABitmap);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Canvas.StretchDraw(Bounds(Round(ADstRect.Left), Round(ADstRect.Top), Round(ADstRect.Right - ADstRect.Left), Round(ADstRect.Bottom - ADstRect.Top)), ABitmap);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawEllipse(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF;\r\n  AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\n  r: TCanvasRectF;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\n  r: TRect;\r\n{$ENDIF}\r\n  bs: TBrushStyle;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n  Canvas.DrawEllipse(r, AStroke.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  Canvas.Ellipse(r);\r\n  Canvas.Brush.Style := bs;\r\n  Canvas.Brush.Color := c;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawFocusPath(AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; AColor: TTMSFNCGraphicsColor);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  bs: TBrushStyle;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Stroke.Kind := TBrushKind.Solid;\r\n  Canvas.Stroke.Color := AColor;\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 31}\r\n  Canvas.Stroke.Dash := TStrokeDash.Dot;\r\n  {$ELSE}\r\n  Canvas.StrokeDash := TStrokeDash.Dot;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  DrawPath(AStroke, APath);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  Canvas.Pen.Color := AColor;\r\n  StartSpecialPen;\r\n  DrawPath(AStroke, APath);\r\n  StopSpecialPen;\r\n  Canvas.Brush.Color := c;\r\n  Canvas.Brush.Style := bs;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawFocusRectangle(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; AColor: TTMSFNCGraphicsColor; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\n  r: TCanvasRectF;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\n  r: TRect;\r\n{$ENDIF}\r\n  c: TTMSFNCGraphicsColor;\r\n  bs: TBrushStyle;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n  Canvas.Stroke.Thickness := 1;\r\n  Canvas.Stroke.Kind := TBrushKind.Solid;\r\n  Canvas.Stroke.Color := AColor;\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 31}\r\n  Canvas.Stroke.Dash := TStrokeDash.Dot;\r\n  {$ELSE}\r\n  Canvas.StrokeDash := TStrokeDash.Dot;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  Canvas.DrawRect(r, 0, 0, AllCorners, 1);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  Canvas.Pen.Color := AColor;\r\n  StartSpecialPen;\r\n  Canvas.Rectangle(r);\r\n  StopSpecialPen;\r\n  Canvas.Brush.Color := c;\r\n  Canvas.Brush.Style := bs;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawLine(AStroke: TTMSFNCGraphicsStroke; AFromPoint, AToPoint: TPointF;\r\n  AModifyPointModeFrom, AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  AFromPoint := ModifyPoint(AFromPoint, AModifyPointModeFrom);\r\n  AToPoint := ModifyPoint(AToPoint, AModifyPointModeTo);\r\n  Canvas.DrawLine(AFromPoint, AToPoint, AStroke.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.MoveTo(AFromPoint.X, AFromPoint.Y);\r\n  Canvas.LineTo(AToPoint.X, AToPoint.Y);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  Canvas.MoveTo(Round(AFromPoint.X), Round(AFromPoint.Y));\r\n  Canvas.LineTo(Round(AToPoint.X), Round(AToPoint.Y));\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawPath(AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath;\r\n  APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon);\r\nvar\r\n  p: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  if Assigned(APath) then\r\n  begin\r\n    SetLength(p, 0);\r\n    APath.FlattenToPolygon(p);\r\n    case APathMode of\r\n      pdmPolygon: DrawPolygon(AStroke, p);\r\n      pdmPolyline: DrawPolyline(AStroke, p);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawPolygon(AStroke: TTMSFNCGraphicsStroke; APolygon: TTMSFNCGraphicsPathPolygon);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n{$IFDEF WEBLIB}\r\n  pts: array of TCanvasPointF;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\n  pts: array of TPoint;\r\n{$ENDIF}\r\n  I: Integer;\r\n  bs: TBrushStyle;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.DrawPolygon(TPolygon(APolygon), AStroke.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  SetLength(pts, Length(APolygon));\r\n  for I := 0 to Length(APolygon) - 1 do\r\n  begin\r\n    {$IFDEF WEBLIB}\r\n    pts[I] := CreateCanvasPointF(APolygon[I].X, APolygon[I].Y);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    pts[I] := Point(Round(APolygon[I].X), Round(APolygon[I].Y));\r\n    {$ENDIF}\r\n  end;\r\n\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  Canvas.Polygon(pts);\r\n  Canvas.Brush.Style := bs;\r\n  Canvas.Brush.Color := c;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawPolyline(AStroke: TTMSFNCGraphicsStroke; APolyline: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\n  pts: array of TCanvasPointF;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\n  pts: array of TPoint;\r\n{$ENDIF}\r\n  bs: TBrushStyle;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  for I := 0 to High(APolyline) - 1 do\r\n    DrawLine(AStroke, APolyline[I], APolyline[I + 1]);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  SetLength(pts, Length(APolyline));\r\n  for I := 0 to Length(APolyline) - 1 do\r\n  begin\r\n    {$IFDEF WEBLIB}\r\n    pts[I] := CreateCanvasPointF(APolyline[I].X, APolyline[I].Y);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    pts[I] := Point(Round(APolyline[I].X), Round(APolyline[I].Y));\r\n    {$ENDIF}\r\n  end;\r\n\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n  Canvas.Polyline(pts);\r\n  Canvas.Brush.Style := bs;\r\n  Canvas.Brush.Color := c;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawRect(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ASides: TTMSFNCGraphicsSides; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXWEBLIB}\r\n  r: TRectF;\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n  r: TRect;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXWEBLIB}\r\n  r := ARect;\r\n  if gsTop in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Right, r.Top));\r\n  if gsLeft in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Left, r.Bottom));\r\n  if gsBottom in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Bottom), PointF(r.Right, r.Bottom));\r\n  if gsRight in ASides then\r\n    DrawLine(AStroke, PointF(r.Right, r.Top), PointF(r.Right, r.Bottom));\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  if gsTop in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Right - 1, r.Top));\r\n  if gsLeft in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Left, r.Bottom - 1));\r\n  if gsBottom in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Bottom - 1), PointF(r.Right - 1, r.Bottom - 1));\r\n  if gsRight in ASides then\r\n    DrawLine(AStroke, PointF(r.Right - 1, r.Top), PointF(r.Right - 1, r.Bottom));\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawRoundRect(AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ARounding: Single;\r\n  ACorners: TTMSFNCGraphicsCorners; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n  c: TCorners;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r, rg: TCanvasRectF;\r\n  rc: Single;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r, rg: TRect;\r\n  rc: Integer;\r\n  {$ENDIF}\r\n  cl: TTMSFNCGraphicsColor;\r\n  bs: TBrushStyle;\r\n\r\n  {$IFDEF WEBLIB}\r\n  procedure CanvasArc(ACanvas: TCanvas; Center, Radius: TPointF; StartAngle, SweepAngle: Integer);\r\n  begin\r\n    ACanvas.AngleArc(Center.X, Center.Y, Radius.X, DegToRad(StartAngle), DegToRad(SweepAngle));\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  procedure CanvasArc(ACanvas: TCanvas; Center, Radius: TPoint; StartAngle, SweepAngle: Integer);\r\n  var\r\n    sx, sy, sxs, sys, x, y, xs, ys: Integer;\r\n  begin\r\n    sx := Center.X - Radius.X;\r\n    sy := Center.Y - Radius.Y;\r\n    sxs := Center.X + Radius.X;\r\n    sys := Center.Y + Radius.Y;\r\n\r\n    x := Center.X + Round(Radius.X * COS(DegToRad(-StartAngle - SweepAngle)));\r\n    y := Center.Y - Round(Radius.Y * SIN(DegToRad(-StartAngle - SweepAngle)));\r\n    xs := Center.X + Round(Radius.X * COS(DegToRad(-StartAngle)));\r\n    ys := Center.Y - Round(Radius.Y * SIN(DegToRad(- StartAngle)));\r\n\r\n    ACanvas.Arc(sx, sy, sxs, sys, x, y, xs, ys);\r\n  {$ENDIF}\r\n  end;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n\r\n  c := [];\r\n  if gcTopLeft in ACorners then\r\n    c := c + [TCorner.TopLeft];\r\n\r\n  if gcTopRight in ACorners then\r\n    c := c + [TCorner.TopRight];\r\n\r\n  if gcBottomLeft in ACorners then\r\n    c := c + [TCorner.BottomLeft];\r\n\r\n  if gcBottomRight in ACorners then\r\n    c := c + [TCorner.BottomRight];\r\n\r\n  Canvas.DrawRect(r, ARounding, ARounding, c, AStroke.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n\r\n  rg := r;\r\n  rg.Bottom := rg.Bottom - 1;\r\n  rg.Right := rg.Right - 1;\r\n\r\n  cl := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n\r\n  rc := Round(ARounding);\r\n  if ACorners = [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight] then\r\n    Canvas.RoundRect(r, rc * 2, rc * 2)\r\n  else if ACorners = [] then\r\n    Canvas.Rectangle(r)\r\n  else\r\n  begin\r\n    {$IFNDEF WEBLIB}\r\n    r.Right := r.Right - 1;\r\n    r.Bottom := r.Bottom - 1;\r\n    rc := rc - 1;\r\n    {$ENDIF}\r\n    if gcBottomLeft in ACorners then\r\n    begin\r\n      Canvas.MoveTo(r.Left + rc, r.Bottom);\r\n      {$IFDEF WEBLIB}\r\n      CanvasArc(Canvas, PointF(r.Left + rc, r.Bottom - rc), PointF(rc, rc), -270, 90);\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      CanvasArc(Canvas, Point(r.Left + rc, r.Bottom - rc), Point(rc, rc), -270, 90);\r\n      {$ENDIF}\r\n      Canvas.MoveTo(r.Left, r.Bottom - rc);\r\n    end\r\n    else\r\n    begin\r\n      Canvas.MoveTo(r.Left, r.Bottom);\r\n    end;\r\n\r\n    if gcTopLeft in ACorners then\r\n    begin\r\n      {$IFDEF WEBLIB}\r\n      Canvas.LineTo(r.Left, r.Top + rc);\r\n      CanvasArc(Canvas, PointF(r.Left + rc, r.Top + rc), PointF(rc, rc), -180, 90);\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      Canvas.LineTo(r.Left, r.Top + rc - 2);\r\n      CanvasArc(Canvas, Point(r.Left + rc, r.Top + rc), Point(rc, rc), -180, 90);\r\n      {$ENDIF}\r\n      Canvas.MoveTo(r.Left + rc, r.Top);\r\n    end\r\n    else\r\n      Canvas.LineTo(r.Left, r.Top);\r\n\r\n    if gcTopRight in ACorners then\r\n    begin\r\n      Canvas.LineTo(r.Right - rc, r.Top);\r\n      {$IFDEF WEBLIB}\r\n      CanvasArc(Canvas, PointF(r.Right - rc, r.Top + rc), PointF(rc, rc), -90, 90);\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      CanvasArc(Canvas, Point(r.Right - rc, r.Top + rc), Point(rc, rc), -90, 90);\r\n      {$ENDIF}\r\n      Canvas.MoveTo(r.Right, r.Top + rc);\r\n    end\r\n    else\r\n      Canvas.LineTo(r.Right, r.Top);\r\n\r\n    if gcBottomRight in ACorners then\r\n    begin\r\n      {$IFDEF WEBLIB}\r\n      Canvas.LineTo(r.Right, r.Bottom - rc);\r\n      CanvasArc(Canvas, PointF(r.Right - rc, r.Bottom - rc), PointF(rc, rc), 0, 90);\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      Canvas.LineTo(r.Right, r.Bottom - rc + 1);\r\n      CanvasArc(Canvas, Point(r.Right - rc, r.Bottom - rc + 1), Point(rc, rc), 0, 90);\r\n      {$ENDIF}\r\n      Canvas.MoveTo(r.Right - rc, r.Bottom);\r\n    end\r\n    else\r\n    begin\r\n      Canvas.LineTo(r.Right, r.Bottom);\r\n    end;\r\n\r\n    if gcBottomLeft in ACorners then\r\n    begin\r\n      {$IFDEF WEBLIB}\r\n      Canvas.LineTo(r.Left + rc, r.Bottom)\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      Canvas.LineTo(r.Left + rc - 2, r.Bottom)\r\n      {$ENDIF}\r\n    end\r\n    else\r\n      Canvas.LineTo(r.Left, r.Bottom);\r\n  end;\r\n\r\n  Canvas.Brush.Color := cl;\r\n  Canvas.Brush.Style := bs;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.DrawText(AText: string; ARect: TRectF;\r\n  AWordWrapping: Boolean; AHorizontalAlign,\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign;\r\n  ATrimming: TTMSFNCGraphicsTextTrimming; AAngle: Single);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  rcalc: TRectF;\r\n  rh: Integer;\r\n  {$IFDEF WEBLIB}\r\n  r: TRectF;\r\n  st: TTMSFNCGraphicsSaveState;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r: TRect;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {%H-}dstyle: TTextStyle;\r\n  {$IFNDEF MSWINDOWS}       \r\n  crr: TRect;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  dstyle: TTextFormat;\r\n  {$ENDIF}\r\n  c: TTMSFNCGraphicsColor;\r\n  bs: TBrushStyle;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if not Assigned(FTextLayout) then\r\n    FTextLayout := TTextLayoutManager.DefaultTextLayout.Create(Canvas);\r\n\r\n  FTextLayout.BeginUpdate;\r\n  try\r\n    FTextLayout.TopLeft := PointF(Round(ARect.Left), Round(ARect.Top));\r\n    FTextLayout.Text := AText;\r\n    FTextLayout.MaxSize := PointF(Round(ARect.Width), Round(ARect.Height));\r\n    FTextLayout.WordWrap := AWordWrapping;\r\n    FTextLayout.Opacity := 1;\r\n    FTextLayout.HorizontalAlign := TTextAlign(Integer(AHorizontalAlign));\r\n    FTextLayout.VerticalAlign := TTextAlign(Integer(AVerticalAlign));\r\n    FTextLayout.Font.Assign(Canvas.Font);\r\n    FTextLayout.Color := Canvas.Fill.Color;\r\n    if not AWordWrapping then\r\n      FTextLayout.Trimming := TTextTrimming(Integer(ATrimming))\r\n    else\r\n      FTextLayout.Trimming := TTextTrimming.None;\r\n  finally\r\n    FTextLayout.EndUpdate;\r\n  end;\r\n  FTextLayout.RenderLayout(Canvas);\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  c := Canvas.Brush.Color;\r\n  bs := Canvas.Brush.Style;\r\n  Canvas.Brush.Style := bsClear;\r\n\r\n  {$IFDEF WEBLIB}\r\n  r := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  dstyle := [];\r\n  if AWordWrapping then\r\n    dstyle := dstyle + [tfWordBreak]\r\n  else\r\n    dstyle := dstyle + [tfSingleLine];\r\n\r\n  if not FShowAcceleratorChar then\r\n    dstyle := dstyle + [tfNoPrefix];\r\n\r\n  case AHorizontalAlign of\r\n    gtaCenter: dstyle := dstyle + [tfCenter];\r\n    gtaLeading: dstyle := dstyle + [tfLeft];\r\n    gtaTrailing: dstyle := dstyle + [tfRight];\r\n  end;\r\n\r\n  case AVerticalAlign of\r\n    gtaCenter: dstyle := dstyle + [tfVerticalCenter];\r\n    gtaLeading: dstyle := dstyle + [tfTop];\r\n    gtaTrailing: dstyle := dstyle + [tfBottom];\r\n  end;\r\n\r\n  case ATrimming of\r\n    gttCharacter: dstyle := dstyle + [tfEndEllipsis];\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 22}\r\n    gttWord: dstyle := dstyle + [tfWordEllipsis];\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF LCLLIB}\r\n  dStyle.RightToLeft := False;\r\n  dStyle.WordBreak := AWordWrapping;\r\n  dStyle.SingleLine := not AWordWrapping;\r\n  dStyle.Clipping := True;\r\n  dStyle.EndEllipsis := False;\r\n  dStyle.SystemFont := False;\r\n  dStyle.ShowPrefix := FShowAcceleratorChar;\r\n\r\n  case AHorizontalAlign of\r\n    gtaCenter: dstyle.Alignment := taCenter;\r\n    gtaLeading: dstyle.Alignment := taLeftJustify;\r\n    gtaTrailing: dstyle.Alignment := taRightJustify;\r\n  end;\r\n\r\n  case AVerticalAlign of\r\n    gtaCenter: dstyle.Layout := tlCenter;\r\n    gtaLeading: dstyle.Layout := tlTop;\r\n    gtaTrailing: dstyle.Layout := tlBottom;\r\n  end;\r\n\r\n  case ATrimming of\r\n    gttCharacter: dstyle.EndEllipsis := True;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  if AWordWrapping then\r\n  begin\r\n    case AVerticalAlign of\r\n      gtaCenter:\r\n      begin\r\n        rcalc := CalculateText(AText, ARect, AWordWrapping);\r\n        rh := Round(rcalc.Bottom - rcalc.Top);\r\n        {$IFDEF WEBLIB}\r\n        r.Top := r.Top + Max(0, ((r.Bottom - r.Top) - rh) / 2);\r\n        {$ENDIF}\r\n        {$IFNDEF WEBLIB}\r\n        r.Top := r.Top + Max(0, ((r.Bottom - r.Top) - rh) div 2);\r\n        {$ENDIF}\r\n        r.Bottom := Max(0, Min(Round(ARect.Bottom), r.Top + rh));\r\n      end;\r\n      gtaTrailing:\r\n      begin\r\n        rcalc := CalculateText(AText, ARect, AWordWrapping);\r\n        rh := Round(rcalc.Bottom - rcalc.Top);\r\n        r.Top := r.Top + r.Bottom - rh;\r\n        r.Bottom := r.Top + rh;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if AAngle <> 0 then\r\n    DrawRotatedText(Canvas, r, AText, AAngle, AHorizontalAlign, AVerticalAlign)\r\n  else\r\n  begin\r\n  {$IFDEF GDIPLUSDRAWING}\r\n    b := CreateGDIPFontFill(Font);\r\n    ft := CreateGDIPFont(Font);\r\n    sf := CreateGPStringFormat(AHorizontalAlign, AVerticalAlign, AWordWrapping);\r\n    try\r\n      rt := MakeRect(ARect.Left, ARect.Top, ARect.Width, ARect.Height);\r\n      FGDIPCanvas.DrawString(AText, Length(AText), ft, rt, sf, b);\r\n    finally\r\n      sf.Free;\r\n      ft.Free;\r\n      b.Free;\r\n    end;\r\n  {$ENDIF}\r\n  {$IFNDEF GDIPLUSDRAWING}\r\n  {$IFDEF WEBLIB}\r\n    st := TTMSFNCGraphicsSaveState.Create;\r\n    try\r\n      SaveState(st);\r\n      ClipRect(r);\r\n      case AHorizontalAlign of\r\n        gtaLeading:\r\n        begin\r\n          case AVerticalAlign of\r\n            gtaLeading: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taLeftJustify, taAlignTop);\r\n            gtaCenter: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taLeftJustify, taVerticalCenter);\r\n            gtaTrailing: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taLeftJustify, taAlignBottom);\r\n          end;\r\n        end;\r\n        gtaCenter:\r\n        begin\r\n          case AVerticalAlign of\r\n            gtaLeading: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taCenter, taAlignTop);\r\n            gtaCenter: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taCenter, taVerticalCenter);\r\n            gtaTrailing: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taCenter, taAlignBottom);\r\n          end;\r\n        end;\r\n        gtaTrailing:\r\n        begin\r\n          case AVerticalAlign of\r\n            gtaLeading: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taRightJustify, taAlignTop);\r\n            gtaCenter: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taRightJustify, taVerticalCenter);\r\n            gtaTrailing: Canvas.TextRect(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom), AText, AWordWrapping, False, taRightJustify, taAlignBottom);\r\n          end;\r\n        end;\r\n      end;\r\n    finally\r\n      RestoreState(st);\r\n    end;\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n    Canvas.TextRect(r, AText, dstyle);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n    {$IFNDEF MSWINDOWS}\r\n    crr := Rect(0, 0, 0, 0);\r\n    if not Canvas.Clipping or (IntersectRect(crr, Canvas.ClipRect, r) and Canvas.Clipping) then\r\n    {$ENDIF}\r\n      Canvas.TextRect(r, r.Left, r.Top, AText, dstyle);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  end;\r\n\r\n  Canvas.Brush.Color := c;\r\n  Canvas.Brush.Style := bs;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.EndScene;\r\nbegin\r\n  {$IFDEF FMXWEBLIB}\r\n  Canvas.EndScene;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillArc(AFill: TTMSFNCGraphicsFill; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  {$IFNDEF WEBLIB}\r\n  x, y, xs, ys, sx, sy, sxs, sys: Integer;\r\n  {$ENDIF}\r\n  ps: TPenStyle;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.FillArc(ACenter, ARadius, AStartAngle, ASweepAngle, AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF WEBLIB}\r\n  sx := Floor(ACenter.X - ARadius.X);\r\n  sy := Floor(ACenter.Y - ARadius.Y);\r\n  sxs := Floor(ACenter.X + ARadius.X);\r\n  sys := Floor(ACenter.Y + ARadius.Y);\r\n\r\n  x := Floor(ACenter.X + (ARadius.X * COS(DegToRad(-AStartAngle - ASweepAngle))));\r\n  y := Floor(ACenter.Y - (ARadius.Y * SIN(DegToRad(-AStartAngle - ASweepAngle))));\r\n  xs := Floor(ACenter.X + (ARadius.X * COS(DegToRad(-AStartAngle))));\r\n  ys := Floor(ACenter.Y - (ARadius.Y * SIN(DegToRad(- AStartAngle))));\r\n  {$ENDIF}\r\n\r\n  ps := Canvas.Pen.Style;\r\n  Canvas.Pen.Style := psClear;\r\n  {$IFNDEF WEBLIB}\r\n  Canvas.Arc(sx, sy, sxs, sys, x, y, xs, ys);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.AngleArc(ACenter.X, ACenter.Y, ARadius.X, AStartAngle, ASweepAngle);\r\n  {$ENDIF}\r\n  Canvas.Pen.Style := ps;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillEllipse(AFill: TTMSFNCGraphicsFill; ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n{$IFDEF WEBLIB}\r\n  r: TCanvasRectF;\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\n  r: TRect;\r\n{$ENDIF}\r\n  ps: TPenStyle;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n  Canvas.FillEllipse(r, AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := CreateCanvasRectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n\r\n  ps := Canvas.Pen.Style;\r\n  Canvas.Pen.Style := psClear;\r\n  Canvas.Ellipse(r);\r\n  Canvas.Pen.Style := ps;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillPath(AFill: TTMSFNCGraphicsFill;\r\n  APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode);\r\nvar\r\n  p: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  if Assigned(APath) then\r\n  begin\r\n    SetLength(p, 0);\r\n    APath.FlattenToPolygon(p);\r\n    case APathMode of\r\n      pdmPolygon: FillPolygon(AFill, p);\r\n      pdmPolyline: FillPolyline(AFill, p);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillPolygon(AFill: TTMSFNCGraphicsFill; APolygon: TTMSFNCGraphicsPathPolygon);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  {$IFDEF WEBLIB}\r\n  pts: array of TCanvasPointF;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  pts: array of TPoint;\r\n  {$ENDIF}\r\n  I: Integer;\r\n  ps: TPenStyle;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.FillPolygon(TPolygon(APolygon), AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  SetLength(pts, Length(APolygon));\r\n  for I := 0 to Length(APolygon) - 1 do\r\n  begin\r\n    {$IFDEF WEBLIB}\r\n    pts[I] := CreateCanvasPointF(APolygon[I].X, APolygon[I].Y);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    pts[I] := Point(Round(APolygon[I].X), Round(APolygon[I].Y));\r\n    {$ENDIF}\r\n  end;\r\n\r\n  ps := Canvas.Pen.Style;\r\n  Canvas.Pen.Style := psClear;\r\n  Canvas.Polygon(pts);\r\n  Canvas.Pen.Style := ps;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillPolyline(AFill: TTMSFNCGraphicsFill; APolyline: TTMSFNCGraphicsPathPolygon);\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  {$IFDEF WEBLIB}\r\n  pts: array of TCanvasPointF;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  pts: array of TPoint;\r\n  {$ENDIF}\r\n  I: Integer;\r\n  ps: TPenStyle;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.FillPolygon(TPolygon(APolyline), AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  SetLength(pts, Length(APolyline));\r\n  for I := 0 to Length(APolyline) - 1 do\r\n  begin\r\n    {$IFDEF WEBLIB}\r\n    pts[I] := CreateCanvasPointF(APolyline[I].X, APolyline[I].Y);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    pts[I] := Point(Round(APolyline[I].X), Round(APolyline[I].Y));\r\n    {$ENDIF}\r\n  end;\r\n\r\n  ps := Canvas.Pen.Style;\r\n  Canvas.Pen.Style := psClear;\r\n  Canvas.Polyline(pts);\r\n  Canvas.Pen.Style := ps;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillRect(AFill: TTMSFNCGraphicsFill; ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r: TRectF;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r: TRect;\r\n  {$ENDIF}\r\n  c: TTMSFNCGraphicsColor;\r\n  bs: TBrushStyle;\r\n  ps: TPenStyle;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n  Canvas.FillRect(r, 0, 0, AllCorners, AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n\r\n  c := gcNull;\r\n  bs := bsClear;\r\n  if (AFill.Kind = gfkGradient) then\r\n  begin\r\n    if (AFill.Color <> gcNull) and (AFill.ColorTo <> gcNull) then\r\n    begin\r\n      if (AFill.ColorMirror <> gcNull) and (AFill.ColorMirrorTo <> gcNull) then\r\n      begin\r\n        case AFill.Orientation of\r\n          gfoHorizontal:\r\n          begin\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, RectF(r.Left, r.Top, r.Left + (r.Right - r.Left) / 2, r.Bottom), 0, [], True);\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, RectF(r.Left + (r.Right - r.Left) / 2, r.Top, r.Right, r.Bottom), 0, [], True);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, Rect(r.Left, r.Top, r.Left + (r.Right - r.Left) div 2, r.Bottom), 0, [], True);\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, Rect(r.Left + (r.Right - r.Left) div 2, r.Top, r.Right, r.Bottom), 0, [], True);\r\n            {$ENDIF}\r\n          end;\r\n          gfoVertical:\r\n          begin\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, RectF(r.Left, r.Top, r.Right, r.Top + (r.Bottom - r.Top) / 2), 0, [], False);\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, RectF(r.Left, r.Top + (r.Bottom - r.Top) / 2, r.Right, r.Bottom), 0, [], False);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, Rect(r.Left, r.Top, r.Right, r.Top + (r.Bottom - r.Top) div 2), 0, [], False);\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, Rect(r.Left, r.Top + (r.Bottom - r.Top) div 2, r.Right, r.Bottom), 0, [], False);\r\n            {$ENDIF}\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n        DrawGradient(Canvas, AFill.Color, AFill.ColorTo, r, 0, [], AFill.Orientation = gfoHorizontal);\r\n    end;\r\n\r\n    c := Canvas.Brush.Color;\r\n    bs := Canvas.Brush.Style;\r\n    Canvas.Brush.Style := bsClear;\r\n  end;\r\n\r\n  ps := Canvas.Pen.Style;\r\n  Canvas.Pen.Style := psClear;\r\n  if (AFill.Color <> gcNull) and (AFill.Kind = gfkSolid) then\r\n  begin\r\n    {$IFDEF WEBLIB}\r\n    Canvas.Rectangle(CreateCanvasRectF(r.Left, r.Top, r.Right, r.Bottom));\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    Canvas.Rectangle(r);\r\n    {$ENDIF}\r\n  end;\r\n  Canvas.Pen.Style := ps;\r\n\r\n  if AFill.Kind = gfkGradient then\r\n  begin\r\n    Canvas.Brush.Color := c;\r\n    Canvas.Brush.Style := bs;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.FillRoundRect(AFill: TTMSFNCGraphicsFill; ARect: TRectF; ARounding: Single;\r\n  ACorners: TTMSFNCGraphicsCorners; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  r: TRectF;\r\n  c: TCorners;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r, rg: TRectF;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r, rg: TRect;\r\n  {$ENDIF}\r\n  c: TTMSFNCGraphicsCorners;\r\n{$ENDIF}\r\nbegin\r\n  ARect := ModifyRect(ARect, AModifyRectMode);\r\n  {$IFDEF FMXLIB}\r\n  r := ARect;\r\n\r\n  c := [];\r\n  if gcTopLeft in ACorners then\r\n    c := c + [TCorner.TopLeft];\r\n\r\n  if gcTopRight in ACorners then\r\n    c := c + [TCorner.TopRight];\r\n\r\n  if gcBottomLeft in ACorners then\r\n    c := c + [TCorner.BottomLeft];\r\n\r\n  if gcBottomRight in ACorners then\r\n    c := c + [TCorner.BottomRight];\r\n\r\n  Canvas.FillRect(r, ARounding, ARounding, c, AFill.Opacity);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  r := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Bottom);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  r := Rect(Round(ARect.Left), Round(ARect.Top), Round(ARect.Right), Round(ARect.Bottom));\r\n  {$ENDIF}\r\n\r\n  rg := r;\r\n  rg.Bottom := rg.Bottom - 1;\r\n  rg.Right := rg.Right - 1;\r\n\r\n  if (AFill.Kind = gfkGradient) then\r\n  begin\r\n    if (AFill.Color <> gcNull) and (AFill.ColorTo <> gcNull) then\r\n    begin\r\n      if (AFill.ColorMirror <> gcNull) and (AFill.ColorMirrorTo <> gcNull) then\r\n      begin\r\n        case AFill.Orientation of\r\n          gfoHorizontal:\r\n          begin\r\n            c := [];\r\n            if gcTopLeft in ACorners then\r\n              c := c + [gcTopLeft];\r\n            if gcBottomLeft in ACorners then\r\n              c := c + [gcBottomLeft];\r\n\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, RectF(rg.Left, rg.Top, rg.Left + (rg.Right - rg.Left) / 2, r.Bottom), ARounding, c, True);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, Rect(rg.Left, rg.Top, rg.Left + (rg.Right - rg.Left) div 2, r.Bottom), ARounding, c, True);\r\n            {$ENDIF}\r\n\r\n            c := [];\r\n            if gcTopRight in ACorners then\r\n              c := c + [gcTopRight];\r\n            if gcBottomRight in ACorners then\r\n              c := c + [gcBottomRight];\r\n\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, RectF(rg.Left + (rg.Right - r.Left) / 2, rg.Top, rg.Right, rg.Bottom), ARounding, c, True);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, Rect(rg.Left + (rg.Right - r.Left) div 2, rg.Top, rg.Right, rg.Bottom), ARounding, c, True);\r\n            {$ENDIF}\r\n          end;\r\n          gfoVertical:\r\n          begin\r\n            c := [];\r\n            if gcTopLeft in ACorners then\r\n              c := c + [gcTopLeft];\r\n            if gcTopRight in ACorners then\r\n              c := c + [gcTopRight];\r\n\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, RectF(rg.Left, rg.Top, rg.Right, rg.Top + (rg.Bottom - rg.Top) / 2), ARounding, c, False);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.Color, AFill.ColorTo, Rect(rg.Left, rg.Top, rg.Right, rg.Top + (rg.Bottom - rg.Top) div 2), ARounding, c, False);\r\n            {$ENDIF}\r\n\r\n            c := [];\r\n            if gcBottomLeft in ACorners then\r\n              c := c + [gcBottomLeft];\r\n            if gcBottomRight in ACorners then\r\n              c := c + [gcBottomRight];\r\n\r\n            {$IFDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, RectF(rg.Left, rg.Top + (rg.Bottom - rg.Top) / 2, rg.Right, rg.Bottom), ARounding, c, False);\r\n            {$ENDIF}\r\n            {$IFNDEF WEBLIB}\r\n            DrawGradient(Canvas, AFill.ColorMirror, AFill.ColorMirrorTo, Rect(rg.Left, rg.Top + (rg.Bottom - rg.Top) div 2, rg.Right, rg.Bottom), ARounding, c, False);\r\n            {$ENDIF}\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n        DrawGradient(Canvas, AFill.Color, AFill.ColorTo, rg, ARounding, ACorners, AFill.Orientation = gfoHorizontal);\r\n    end;\r\n  end\r\n  else if (AFill.Color <> gcNull) and (AFill.Kind = gfkSolid) then\r\n    DrawGradient(Canvas, AFill.Color, AFill.Color, r, ARounding, ACorners, AFill.Orientation = gfoHorizontal);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.StartSpecialPen;\r\n{$IFDEF CMNLIB}\r\nvar\r\n  hpen: THandle;\r\n  lb: TLogBrush;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF CMNLIB}\r\n  lb.lbColor := ColorToRGB(Canvas.Pen.Color);\r\n  lb.lbStyle := BS_SOLID;\r\n\r\n  hpen := ExtCreatePen(PS_COSMETIC or PS_ALTERNATE, 1, lb, 0, nil);\r\n  FOldPenHandle := SelectObject(Canvas.Handle, hpen);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  FOldPenStyle := Canvas.Pen.Style;\r\n  FOldPenWidth := Canvas.Pen.Width;\r\n  Canvas.Pen.Style := psDot;\r\n  Canvas.Pen.Width := 1;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.StopSpecialPen;\r\nbegin\r\n  {$IFDEF CMNLIB}\r\n  DeleteObject(SelectObject(Canvas.Handle, FOldPenHandle));\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.Pen.Style := FOldPenStyle;\r\n  Canvas.Pen.Width := FOldPenWidth;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.TranslateTransform(AX, AY: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  SaveMatrix;\r\n  Canvas.MultiplyMatrix(TMatrix.CreateTranslation(AX, AY));\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextGeneral.GetFillColor: TTMSFNCGraphicsColor;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := Canvas.Fill.Color;\r\n  {$ENDIF}\r\n  {$IFNDEF FMXLIB}\r\n  Result := Canvas.Brush.Color;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextGeneral.GetNativeCanvas: Pointer;\r\nbegin\r\n  Result := Canvas;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.PathClose(APath: Pointer);\r\nbegin\r\n  TTMSFNCGraphicsPath(APath).ClosePath;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.PathLineTo(APath: Pointer;\r\n  APoint: TPointF);\r\nbegin\r\n  TTMSFNCGraphicsPath(APath).LineTo(APoint);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.PathMoveTo(APath: Pointer;\r\n  APoint: TPointF);\r\nbegin\r\n  TTMSFNCGraphicsPath(APath).MoveTo(APoint);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.PathOpen(APath: Pointer);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.Render;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ResetClip;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ResetTextAngle(AAngle: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if AAngle <> 0 then\r\n    Canvas.SetMatrix(FTextMatrix);\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  if AAngle <> 0 then\r\n    Canvas.SetTransform(1, 0, 0, 1, 0, 0);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ResetTransform;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  RestoreMatrix;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.RestoreState(AState: TTMSFNCGraphicsSaveState);\r\nbegin\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF VCLLIB}\r\n  RestoreDC(Canvas.Handle, AState.SaveDC);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Canvas.Clipping := False;\r\n  Canvas.RestoreHandleState;\r\n  {$ENDIF}\r\n  AState.SaveDC := 0;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  Canvas.RestoreState(AState.SaveDC);\r\n  AState.SaveDC := nil;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.Restore;\r\n  {$ENDIF}\r\n\r\n  {$IFNDEF GDIPLUSDRAWING}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Refresh;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.RotateTransform(AAngle: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  SaveMatrix;\r\n  Canvas.MultiplyMatrix(TMatrix.CreateRotation(DegToRad(AAngle)));\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SaveState(AState: TTMSFNCGraphicsSaveState);\r\nbegin\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Refresh;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  AState.SaveDC := Canvas.SaveState;\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  AState.SaveDC := SaveDC(Canvas.Handle);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Canvas.SaveHandleState;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Canvas.Save;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.ScaleTransform(AX, AY: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  SaveMatrix;\r\n  Canvas.MultiplyMatrix(TMatrix.CreateScaling(AX, AY));\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextGeneral.SetTextAngle(ARect: TRectF; AAngle: Single): TRectF;\r\n{$IFDEF FMXWEBLIB}\r\nvar\r\n  ar: Single;\r\n  cx: TPointF;\r\n  {$IFDEF FMXLIB}\r\n  rm: TMatrix;\r\n  {$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  Result := ARect;\r\n  {$IFDEF FMXWEBLIB}\r\n  if AAngle <> 0 then\r\n  begin\r\n    ar := DegToRad(AAngle);\r\n    cx.X := Result.Left + (Result.Right - Result.Left) / 2;\r\n    cx.Y := Result.Top + (Result.Bottom - Result.Top) / 2;\r\n    {$IFDEF FMXLIB}\r\n    FTextMatrix := Canvas.Matrix;\r\n    rm := TMatrix.CreateRotation(ar) * TMatrix.CreateTranslation(cx.X, cx.Y);\r\n    Canvas.MultiplyMatrix(rm);\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    Canvas.Transform(Cos(ar), Sin(ar), -Sin(ar), Cos(ar), cx.X, cx.Y);\r\n    {$ENDIF}\r\n    if (Result.Right - Result.Left) < (Result.Bottom - Result.Top) then\r\n      Result := RectF(-(Result.Bottom - Result.Top) / 2, -(Result.Right - Result.Left) / 2, (Result.Bottom - Result.Top) / 2, (Result.Right - Result.Left) / 2)\r\n    else\r\n      Result := RectF(-(Result.Right - Result.Left) / 2, -(Result.Bottom - Result.Top) / 2, (Result.Right - Result.Left) / 2, (Result.Bottom - Result.Top) / 2);\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetTextQuality(\r\n  ATextQuality: TTMSFNCGraphicsTextQuality);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetSize(AWidth, AHeight: Single);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetShowAcceleratorChar(AShowAcceleratorChar: Boolean);\r\nbegin\r\n  FShowAcceleratorChar := AShowAcceleratorChar;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetAntiAliasing(AAntiAliasing: Boolean);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFill(AFill: TTMSFNCGraphicsFill);\r\n{$IFDEF FMXLIB}\r\nvar\r\n  pt: TGradientPoint;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Fill.Color := AFill.Color;\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      Canvas.Fill.Kind := TBrushKind.Solid;\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n      Canvas.Fill.Kind := TBrushKind.Gradient;\r\n      Canvas.Fill.Gradient.Points.Clear;\r\n\r\n      if (AFill.ColorMirror <> gcNull) and (AFill.ColorMirrorTo <> gcNull) then\r\n      begin\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.Color;\r\n        pt.Offset := 0;\r\n\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.ColorTo;\r\n        pt.Offset := 0.5;\r\n\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.ColorMirror;\r\n        pt.Offset := 0.5;\r\n\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.ColorMirrorTo;\r\n        pt.Offset := 1;\r\n      end\r\n      else\r\n      begin\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.Color;\r\n        pt.Offset := 0;\r\n\r\n        pt := TGradientPoint(Canvas.Fill.Gradient.Points.Add);\r\n        pt.Color := AFill.ColorTo;\r\n        pt.Offset := 1;\r\n      end;\r\n\r\n      case AFill.Orientation of\r\n        gfoHorizontal:\r\n        begin\r\n          Canvas.Fill.Gradient.StartPosition.Point := PointF(0, 0.5);\r\n          Canvas.Fill.Gradient.StopPosition.Point := PointF(1, 0.5);\r\n        end;\r\n        gfoVertical:\r\n        begin\r\n          Canvas.Fill.Gradient.StartPosition.Point := PointF(0.5, 0);\r\n          Canvas.Fill.Gradient.StopPosition.Point := PointF(0.5, 1);\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n      Canvas.Fill.Kind := TBrushKind.None;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Brush.Color := AFill.Color;\r\n  case AFill.Kind of\r\n    gfkSolid, gfkGradient: Canvas.Brush.Style := bsSolid;\r\n    gfkNone: Canvas.Brush.Style := bsClear;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFillColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Fill.Color := AColor;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Brush.Color := AColor;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFillKind(AKind: TTMSFNCGraphicsFillKind);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Fill.Kind := TBrushKind(Integer(AKind));\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  case AKind of\r\n    gfkNone: Canvas.Brush.Style := bsClear;\r\n    gfkSolid, gfkGradient: Canvas.Brush.Style := bsSolid;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFont(AFont: TTMSFNCGraphicsFont);\r\nbegin\r\n  Canvas.Font.Assign(AFont);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFontColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Fill.Color := AColor;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Font.Color := AColor;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFontName(AName: string);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Font.Family := AName;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Font.Name := AName;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFontSize(ASize: Integer);\r\nbegin\r\n  Canvas.Font.Size := ASize;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetFontStyles(AStyle: TFontStyles);\r\nbegin\r\n  Canvas.Font.Style := AStyle;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetStroke(AStroke: TTMSFNCGraphicsStroke);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Stroke.Color := AStroke.Color;\r\n  Canvas.Stroke.Thickness := AStroke.Width;\r\n  case AStroke.Kind of\r\n    gskSolid:\r\n    begin\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n      Canvas.Stroke.Dash := TStrokeDash.Solid;\r\n    end;\r\n    gskNone: Canvas.Stroke.Kind := TBrushKind.None;\r\n    else\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n  end;\r\n\r\n  case AStroke.Kind of\r\n    gskDash: Canvas.Stroke.Dash := TStrokeDash.Dash;\r\n    gskDot: Canvas.Stroke.Dash := TStrokeDash.Dot;\r\n    gskDashDot: Canvas.Stroke.Dash := TStrokeDash.DashDot;\r\n    gskDashDotDot: Canvas.Stroke.Dash := TStrokeDash.DashDotDot;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Pen.Color := AStroke.Color;\r\n  Canvas.Pen.Width := Round(AStroke.Width);\r\n  case AStroke.Kind of\r\n    gskSolid: Canvas.Pen.Style := psSolid;\r\n    gskNone: Canvas.Pen.Style := psClear;\r\n    gskDash: Canvas.Pen.Style := psDash;\r\n    gskDot: Canvas.Pen.Style := psDot;\r\n    gskDashDot: Canvas.Pen.Style := psDashDot;\r\n    gskDashDotDot: Canvas.Pen.Style := psDashDotDot;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetStrokeColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Stroke.Color := AColor;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Pen.Color := AColor;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetStrokeKind(\r\n  AKind: TTMSFNCGraphicsStrokeKind);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  case AKind of\r\n    gskNone: Canvas.Stroke.Kind := TBrushKind.None;\r\n    gskSolid:\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Canvas.Stroke.Dash := TStrokeDash.Solid;\r\n      {$ELSE}\r\n      Canvas.StrokeDash := TStrokeDash.Solid;\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n    end;\r\n    gskDash:\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Canvas.Stroke.Dash := TStrokeDash.Dash;\r\n      {$ELSE}\r\n      Canvas.StrokeDash := TStrokeDash.Dash;\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n    end;\r\n    gskDot:\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Canvas.Stroke.Dash := TStrokeDash.Dot;\r\n      {$ELSE}\r\n      Canvas.StrokeDash := TStrokeDash.Dot;\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n    end;\r\n    gskDashDot:\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Canvas.Stroke.Dash := TStrokeDash.DashDot;\r\n      {$ELSE}\r\n      Canvas.StrokeDash := TStrokeDash.DashDot;\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n    end;\r\n    gskDashDotDot:\r\n    begin\r\n      {$HINTS OFF}\r\n      {$IF COMPILERVERSION > 31}\r\n      Canvas.Stroke.Dash := TStrokeDash.DashDotDot;\r\n      {$ELSE}\r\n      Canvas.StrokeDash := TStrokeDash.DashDotDot;\r\n      {$IFEND}\r\n      {$HINTS ON}\r\n      Canvas.Stroke.Kind := TBrushKind.Solid;\r\n    end;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  case AKind of\r\n    gskNone: Canvas.Pen.Style := psClear;\r\n    gskSolid: Canvas.Pen.Style := psSolid;\r\n    gskDash: Canvas.Pen.Style := psDash;\r\n    gskDot: Canvas.Pen.Style := psDot;\r\n    gskDashDot: Canvas.Pen.Style := psDashDot;\r\n    gskDashDotDot: Canvas.Pen.Style := psDashDotDot;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextGeneral.SetStrokeWidth(AWidth: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Canvas.Stroke.Thickness := AWidth;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Canvas.Pen.Width := Round(AWidth);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction GetNativeContextClass: TTMSFNCGraphicsContextClass;\r\nbegin\r\n  Result := TTMSFNCGraphicsContextGeneral;\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2017                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCGraphics.WEB;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\n{$IFDEF WEBLIB}\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCGraphicsTypes, WEBLib.TMSFNCUtils, {%H-}Types, WEBLib.TMSFNCTypes,\r\n  WEBLib.TMSFNCGraphics, WEBLib.Graphics;\r\n\r\ntype\r\n  TTMSFNCGraphicsContextWEB = class(TTMSFNCGraphicsContext)\r\n  private\r\n    FActivePath: TTMSFNCGraphicsPath;\r\n    FScale: Single;\r\n    FNeedsRendering: Boolean;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FContextSize: TSizeF;\r\n    FNCanvas: Pointer;\r\n    FBitmap: TBitmap;\r\n  protected\r\n    function GetNativeCanvas: Pointer; override;\r\n    procedure DestroyResources;\r\n    function DrawTextInternal(AText: String; ARect: TRectF; {%H-}AWordWrap: Boolean; AHorizontalAlignment: TTMSFNCGraphicsTextAlign; ACalculate: Boolean): TRectF;\r\n    procedure DrawLinearGradient(ARect: TRectF);\r\n    procedure FontChanged(Sender: TObject);\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure StrokeChanged(Sender: TObject);\r\n    procedure RestoreContext;\r\n    procedure SaveContext;\r\n    procedure ApplyStroke;\r\n    procedure ApplyFill;\r\n  public\r\n    constructor Create(const AGraphics: TTMSFNCGraphics); override;\r\n    destructor Destroy; override;\r\n    function GetFillColor: TTMSFNCGraphicsColor; override;\r\n    function CalculateText(AText: string; ARect: TRectF; AWordWrapping: Boolean): TRectF; override;\r\n    function SetTextAngle(ARect: TRectF; {%H-}AAngle: Single): TRectF; override;\r\n    function CreatePath: Pointer; override;\r\n    procedure Render; override;\r\n    procedure PathOpen({%H-}APath: Pointer); override;\r\n    procedure PathMoveTo({%H-}APath: Pointer; APoint: TPointF); override;\r\n    procedure PathLineTo({%H-}APath: Pointer; APoint: TPointF); override;\r\n    procedure PathClose({%H-}APath: Pointer); override;\r\n    procedure ResetClip; override;\r\n    procedure ResetTransform; override;\r\n    procedure ScaleTransform(AX, AY: Single); override;\r\n    procedure RotateTransform(AAngle: Single); override;\r\n    procedure TranslateTransform(AX, AY: Single); override;\r\n    procedure SetTextQuality({%H-}ATextQuality: TTMSFNCGraphicsTextQuality); override;\r\n    procedure SetAntiAliasing(AAntiAliasing: Boolean); override;\r\n    procedure SetShowAcceleratorChar({%H-}AShowAcceleratorChar: Boolean); override;\r\n    procedure SetSize(AWidth, AHeight: Single); override;\r\n    procedure ResetTextAngle({%H-}AAngle: Single); override;\r\n    procedure BeginScene; override;\r\n    procedure EndScene; override;\r\n    procedure StartSpecialPen; override;\r\n    procedure StopSpecialPen; override;\r\n    procedure RestoreState({%H-}AState: TTMSFNCGraphicsSaveState); override;\r\n    procedure SaveState({%H-}AState: TTMSFNCGraphicsSaveState); override;\r\n    procedure SetFontSize(ASize: Integer); override;\r\n    procedure SetFontColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetFontName(AName: string); override;\r\n    procedure SetFont(AFont: TTMSFNCGraphicsFont); override;\r\n    procedure SetFontStyles(AStyle: TFontStyles); override;\r\n    procedure SetFill(AFill: TTMSFNCGraphicsFill); override;\r\n    procedure SetFillKind(AKind: TTMSFNCGraphicsFillKind); override;\r\n    procedure SetFillColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetStroke(AStroke: TTMSFNCGraphicsStroke); override;\r\n    procedure SetStrokeKind(AKind: TTMSFNCGraphicsStrokeKind); override;\r\n    procedure SetStrokeColor(AColor: TTMSFNCGraphicsColor); override;\r\n    procedure SetStrokeWidth(AWidth: Single); override;\r\n    procedure DrawLine({%H-}AStroke: TTMSFNCGraphicsStroke; AFromPoint: TPointF; AToPoint: TPointF; {%H-}AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode = gcpmRightDown; {%H-}AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode = gcpmRightDown); override;\r\n    procedure DrawPolygon({%H-}AStroke: TTMSFNCGraphicsStroke; APolygon: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillPolygon({%H-}AFill: TTMSFNCGraphicsFill; APolygon: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure DrawPolyline({%H-}AStroke: TTMSFNCGraphicsStroke; APolyline: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillPolyline({%H-}AFill: TTMSFNCGraphicsFill; APolyline: TTMSFNCGraphicsPathPolygon); override;\r\n    procedure FillArc({%H-}AFill: TTMSFNCGraphicsFill; {%H-}ACenter, {%H-}ARadius: TPointF; {%H-}AStartAngle, {%H-}ASweepAngle: Single); override;\r\n    procedure DrawArc({%H-}AStroke: TTMSFNCGraphicsStroke; ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single); override;\r\n    procedure FillRect({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawRect({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ASides: TTMSFNCGraphicsSides; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure FillRoundRect({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawRoundRect({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure FillEllipse({%H-}AFill: TTMSFNCGraphicsFill; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawEllipse({%H-}AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawBitmap(ABitmap: TTMSFNCDrawBitmap; {%H-}ASrcRect, ADstRect: TRectF; {%H-}AOpacity: Single); override;\r\n    procedure ClipRect(ARect: TRectF); override;\r\n    procedure ClipPath({%H-}APath: TTMSFNCGraphicsPath); override;\r\n    procedure DrawFocusPath({%H-}AStroke: TTMSFNCGraphicsStroke; {%H-}APath: TTMSFNCGraphicsPath; {%H-}AColor: TTMSFNCGraphicsColor); override;\r\n    procedure DrawFocusRectangle({%H-}AStroke: TTMSFNCGraphicsStroke; {%H-}ARect: TRectF; {%H-}AColor: TTMSFNCGraphicsColor; {%H-}AModifyRectMode: TTMSFNCGraphicsModifyRectMode = gcrmShrinkAll); override;\r\n    procedure DrawText(AText: string; ARect: TRectF; AWordWrapping: Boolean; AHorizontalAlign, AVerticalAlign: TTMSFNCGraphicsTextAlign; {%H-}ATrimming: TTMSFNCGraphicsTextTrimming; {%H-}AAngle: Single); override;\r\n    procedure DrawPath({%H-}AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); override;\r\n    procedure FillPath({%H-}AFill: TTMSFNCGraphicsFill; APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode = pdmPolygon); override;\r\n  end;\r\n\r\nfunction GetNativeContextClass: TTMSFNCGraphicsContextClass;\r\n\r\n{$ENDIF}\r\n\r\nimplementation\r\n\r\n{$IFDEF WEBLIB}\r\n\r\nuses\r\n  SysUtils, Math;\r\n\r\nfunction GetNativeContextClass: TTMSFNCGraphicsContextClass;\r\nbegin\r\n  Result := TTMSFNCGraphicsContextWEB;\r\nend;\r\n\r\n{ TTMSFNCGraphicsContextWEB }\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ApplyFill;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n     Exit;\r\n\r\n  case FFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n//      cairo_set_source_rgba(FNCanvas, TTMSFNCGraphics.GetColorRed(FFill.Color) / 255, TTMSFNCGraphics.GetColorGreen(FFill.Color) / 255,\r\n//        TTMSFNCGraphics.GetColorBlue(FFill.Color) / 255, FFill.Opacity);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ApplyStroke;\r\nvar\r\n  f: array of Double;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n     Exit;\r\n\r\n//  cairo_set_line_width(FNCanvas, FStroke.Width);\r\n//  cairo_set_source_rgba(FNCanvas, TTMSFNCGraphics.GetColorRed(FStroke.Color) / 255, TTMSFNCGraphics.GetColorGreen(FStroke.Color) / 255,\r\n//    TTMSFNCGraphics.GetColorBlue(FStroke.Color) / 255, FStroke.Opacity);\r\n\r\n//  case FStroke.Kind of\r\n//    gskSolid, gskNone: cairo_set_dash(FNCanvas, nil,0, 0);\r\n//    gskDash:\r\n//    begin\r\n//      SetLength(f, 2);\r\n//      f[0] := 3;\r\n//      f[1] := 1;\r\n//      cairo_set_dash(FNCanvas, @f[0], Length(f), 0);\r\n//    end;\r\n//    gskDot:\r\n//    begin\r\n//      SetLength(f, 2);\r\n//      f[0] := 1;\r\n//      f[1] := 1;\r\n//      cairo_set_dash(FNCanvas, @f[0], Length(f), 0);\r\n//    end;\r\n//    gskDashDot:\r\n//    begin\r\n//      SetLength(f, 4);\r\n//      f[0] := 3;\r\n//      f[1] := 1;\r\n//      f[2] := 1;\r\n//      f[3] := 1;\r\n//      cairo_set_dash(FNCanvas, @f[0], Length(f), 0);\r\n//    end;\r\n//    gskDashDotDot:\r\n//    begin\r\n//      SetLength(f, 6);\r\n//      f[0] := 3;\r\n//      f[1] := 1;\r\n//      f[2] := 1;\r\n//      f[3] := 1;\r\n//      f[4] := 1;\r\n//      f[5] := 1;\r\n//      cairo_set_dash(FNCanvas, @f[0], Length(f), 0);\r\n//    end;\r\n//  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.BeginScene;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.CalculateText(AText: string; ARect: TRectF;\r\n  AWordWrapping: Boolean): TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n  Result := DrawTextInternal(AText, ARect, AWordWrapping, gtaLeading, True);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ClipPath(APath: TTMSFNCGraphicsPath);\r\n//var\r\n//  pth: ^cairo_path_t;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  pth := ConvertToPath(APath);\r\n  try\r\n    SaveContext;\r\n//    cairo_append_path(FNCanvas, pth);\r\n//    cairo_clip(FNCanvas);\r\n  finally\r\n\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ClipRect(ARect: TRectF);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_rectangle(FNCanvas, ARect.Left, ARect.Top, ARect.Width, ARect.Height);\r\n//  cairo_clip(FNCanvas);\r\nend;\r\n\r\nconstructor TTMSFNCGraphicsContextWEB.Create(const AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  inherited;\r\n  FScale := TTMSFNCUtils.GetDPIScale;\r\n  FNeedsRendering := True;\r\n  FContextSize.cx := 0;\r\n  FContextSize.cy := 0;\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FFont.OnChanged := @FontChanged;\r\n  FStroke := TTMSFNCGraphicsStroke.Create;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n  FFill := TTMSFNCGraphicsFill.Create;\r\n  FFill.OnChanged := @FillChanged;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.CreatePath: Pointer;\r\nbegin\r\n//  cairo_new_path(FNCanvas);\r\n//  Result := cairo_copy_path(FNCanvas);\r\nend;\r\n\r\ndestructor TTMSFNCGraphicsContextWEB.Destroy;\r\nbegin\r\n  Render;\r\n\r\n  if Assigned(FFont) then\r\n  begin\r\n    FFont.Free;\r\n    FFont := nil;\r\n  end;\r\n\r\n  if Assigned(FFill) then\r\n  begin\r\n    FFill.Free;\r\n    FFill := nil;\r\n  end;\r\n\r\n  if Assigned(FStroke) then\r\n  begin\r\n    FStroke.Free;\r\n    FStroke := nil;\r\n  end;\r\n\r\n  DestroyResources;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DestroyResources;\r\nbegin\r\n  if Assigned(FNCanvas) then\r\n  begin\r\n    RestoreContext;\r\n//    cairo_destroy(FNCanvas);\r\n    FNCanvas := nil;\r\n  end;\r\n\r\n  if Assigned(FBitmap) then\r\n  begin\r\n    FBitmap.Free;\r\n    FBitmap := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawArc(AStroke: TTMSFNCGraphicsStroke;\r\n  ACenter, ARadius: TPointF; AStartAngle, ASweepAngle: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_arc(FNCanvas, ACenter.X, ACenter.Y, ARadius.X, DegToRad(AStartAngle), DegToRad(AStartAngle + ASweepAngle));\r\n  ApplyStroke;\r\n//  cairo_stroke(FNCanvas);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawBitmap(ABitmap: TTMSFNCDrawBitmap;\r\n  ASrcRect, ADstRect: TRectF; AOpacity: Single);\r\nvar\r\n  R: TRectF;\r\n//  img: Pcairo_surface_t;\r\n//\r\n//  function GraphicToARGB32(Source: TGraphic; buf: PByte): Boolean;\r\n//  var\r\n//    p: PDWord;\r\n//    x, y: Integer;\r\n//    c: TFPColor;\r\n//    Img: TLazIntfImage;\r\n//  begin\r\n//    Img := TRasterImage(Source).CreateIntfImage;\r\n//    try\r\n//      if Img.DataDescription.Format = ricfNone then begin\r\n//        Result := False;\r\n//        Exit;\r\n//      end;\r\n//      p := Pointer(buf);\r\n//      for y := 0 to Source.Height-1 do begin\r\n//        for x := 0 to Source.Width-1 do begin\r\n//          c := Img.Colors[x, y];\r\n//          p^ := Hi(c.alpha) shl 24 + Hi(c.red) shl 16 + Hi(c.green) shl 8 + Hi(c.blue);\r\n//          inc(p);\r\n//        end;\r\n//      end;\r\n//    finally\r\n//      Img.Free;\r\n//    end;\r\n//    Result := True;\r\n//  end;\r\n\r\n//  function CreateCairoImage: Pcairo_surface_t;\r\n//  var\r\n//    buf: PByte;\r\n//  begin\r\n//    try\r\n//      buf := GetMem(ABitmap.Width*ABitmap.Height*4);\r\n//\r\n//      if not GraphicToARGB32(ABitmap, buf) then\r\n//        Exit;\r\n//\r\n//      Result := cairo_image_surface_create_for_data(buf, CAIRO_FORMAT_ARGB32, ABitmap.Width, ABitmap.Height, ABitmap.Width * 4);\r\n//    finally\r\n//      Freemem(buf);\r\n//    end;\r\n//  end;\r\nbegin\r\n  if not Assigned(ABitmap) or not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n  R := ADstRect;\r\n//  img := CreateCairoImage;\r\n  try\r\n//    cairo_translate(FNCanvas, R.Left, R.Top);\r\n//    cairo_scale(FNCanvas, r.Width / ABitmap.Width, r.Height / ABitmap.Height);\r\n//    cairo_set_source_surface(FNCanvas, img, 0, 0);\r\n//    cairo_paint(FNCanvas);\r\n  finally\r\n//    cairo_surface_destroy(img);\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawEllipse(AStroke: TTMSFNCGraphicsStroke;\r\n  ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  r := ARect;\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_arc(FNCanvas, r.Left + r.Width / 2, r.Top + r.Height / 2, r.Width / 2, 0, 2 * PI);\r\n  ApplyStroke;\r\n//  cairo_stroke(FNCanvas);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawFocusPath(\r\n  AStroke: TTMSFNCGraphicsStroke; APath: TTMSFNCGraphicsPath;\r\n  AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawFocusRectangle(\r\n  AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; AColor: TTMSFNCGraphicsColor;\r\n  AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawLine(AStroke: TTMSFNCGraphicsStroke;\r\n  AFromPoint: TPointF; AToPoint: TPointF;\r\n  AModifyPointModeFrom: TTMSFNCGraphicsModifyPointMode;\r\n  AModifyPointModeTo: TTMSFNCGraphicsModifyPointMode);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_move_to(FNCanvas, AFromPoint.X, AFromPoint.Y);\r\n//  cairo_line_to(FNCanvas, AToPoint.X, AToPoint.Y);\r\n//  cairo_stroke(FNCanvas);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawLinearGradient(ARect: TRectF);\r\n//var\r\n//  pat: Pcairo_pattern_t;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  case FFill.Orientation of\r\n    gfoHorizontal: {pat := cairo_pattern_create_linear(ARect.Left, ARect.Top + ARect.Height / 2, ARect.Right, ARect.Top + ARect.Height / 2)};\r\n    gfoVertical: {pat := cairo_pattern_create_linear(ARect.Left + ARect.Width / 2, ARect.Top, ARect.Left + ARect.Width / 2, ARect.Bottom)};\r\n  end;\r\n\r\n  if (FFill.ColorTo <> gcnull) and (FFill.ColorMirror <> gcNull) then\r\n  begin\r\n//    cairo_pattern_add_color_stop_rgba(pat, 0, TTMSFNCGraphics.GetColorRed(FFill.Color) / 255, TTMSFNCGraphics.GetColorGreen(FFill.Color) / 255, TTMSFNCGraphics.GetColorBlue(FFill.Color) / 255, FFill.Opacity);\r\n//    cairo_pattern_add_color_stop_rgba(pat, 0.5, TTMSFNCGraphics.GetColorRed(FFill.ColorTo) / 255, TTMSFNCGraphics.GetColorGreen(FFill.ColorTo) / 255, TTMSFNCGraphics.GetColorBlue(FFill.ColorTo) / 255, FFill.Opacity);\r\n//    cairo_pattern_add_color_stop_rgba(pat, 0.5, TTMSFNCGraphics.GetColorRed(FFill.ColorMirror) / 255, TTMSFNCGraphics.GetColorGreen(FFill.ColorMirror) / 255, TTMSFNCGraphics.GetColorBlue(FFill.ColorMirror) / 255, FFill.Opacity);\r\n//    cairo_pattern_add_color_stop_rgba(pat, 1, TTMSFNCGraphics.GetColorRed(FFill.ColorMirrorTo) / 255, TTMSFNCGraphics.GetColorGreen(FFill.ColorMirrorTo) / 255, TTMSFNCGraphics.GetColorBlue(FFill.ColorMirrorTo) / 255, FFill.Opacity);\r\n  end\r\n  else if FFill.ColorTo <> gcNull then\r\n  begin\r\n//    cairo_pattern_add_color_stop_rgba(pat, 0, TTMSFNCGraphics.GetColorRed(FFill.Color) / 255, TTMSFNCGraphics.GetColorGreen(FFill.Color) / 255, TTMSFNCGraphics.GetColorBlue(FFill.Color) / 255, FFill.Opacity);\r\n//    cairo_pattern_add_color_stop_rgba(pat, 1, TTMSFNCGraphics.GetColorRed(FFill.ColorTo) / 255, TTMSFNCGraphics.GetColorGreen(FFill.ColorTo) / 255, TTMSFNCGraphics.GetColorBlue(FFill.ColorTo) / 255, FFill.Opacity);\r\n  end;\r\n\r\n//  cairo_rectangle(FNCanvas, ARect.Left, ARect.Top, ARect.Width, ARect.Height);\r\n//  cairo_set_source(FNCanvas, pat);\r\n//  cairo_fill(FNCanvas);\r\n//  cairo_pattern_destroy(pat);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawPath(AStroke: TTMSFNCGraphicsStroke;\r\n  APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode);\r\nvar\r\n  p: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  if Assigned(APath) then\r\n  begin\r\n    FActivePath := APath;\r\n    SetLength(p, 0);\r\n    APath.FlattenToPolygon(p);\r\n    case APathMode of\r\n      pdmPolygon: DrawPolygon(AStroke, p);\r\n      pdmPolyline: DrawPolyline(AStroke, p);\r\n    end;\r\n    FActivePath := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawPolygon(AStroke: TTMSFNCGraphicsStroke;\r\n  APolygon: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if Length(APolygon) = 0 then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_move_to(FNCanvas, APolygon[0].X, APolygon[0].Y);\r\n//  for I := 1 to Length(APolygon) - 1 do\r\n//    cairo_line_to(FNCanvas, APolygon[I].X, APolygon[I].Y);\r\n//  cairo_close_path(FNCanvas);\r\n  ApplyStroke;\r\n//  cairo_stroke(FNCanvas);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawPolyline(AStroke: TTMSFNCGraphicsStroke;\r\n  APolyline: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if Length(APolyline) = 0 then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_move_to(FNCanvas, APolyline[0].X, APolyline[0].Y);\r\n//  for I := 1 to Length(APolyline) - 1 do\r\n//    cairo_line_to(FNCanvas, APolyline[I].X, APolyline[I].Y);\r\n  ApplyStroke;\r\n//  cairo_stroke(FNCanvas);\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawRect(AStroke: TTMSFNCGraphicsStroke;\r\n  ARect: TRectF; ASides: TTMSFNCGraphicsSides;\r\n  AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  r := ARect;\r\n  if gsTop in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Right, r.Top));\r\n  if gsLeft in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Top), PointF(r.Left, r.Bottom));\r\n  if gsBottom in ASides then\r\n    DrawLine(AStroke, PointF(r.Left, r.Bottom), PointF(r.Right, r.Bottom));\r\n  if gsRight in ASides then\r\n    DrawLine(AStroke, PointF(r.Right, r.Top), PointF(r.Right, r.Bottom));\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawRoundRect(\r\n  AStroke: TTMSFNCGraphicsStroke; ARect: TRectF; ARounding: Single;\r\n  ACorners: TTMSFNCGraphicsCorners;\r\n  AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  pth: TTMSFNCGraphicsPath;\r\n  r: TRectF;\r\n  rc: Single;\r\nbegin\r\n  r := ARect;\r\n  rc := ARounding;\r\n\r\n  pth := TTMSFNCGraphicsPath.Create;\r\n  try\r\n    if gcBottomLeft in ACorners then\r\n    begin\r\n      pth.MoveTo(PointF(r.Left + rc, r.Bottom));\r\n      pth.AddArc(PointF(r.Left + rc, r.Bottom - rc), PointF(rc, rc), -270, 90);\r\n      pth.LineTo(PointF(r.Left, r.Bottom - rc));\r\n    end\r\n    else\r\n    begin\r\n      pth.MoveTo(PointF(r.Left, r.Bottom));\r\n    end;\r\n\r\n    if gcTopLeft in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Left, r.Top + rc));\r\n      pth.AddArc(PointF(r.Left + rc, r.Top + rc), PointF(rc, rc), -180, 90);\r\n      pth.LineTo(PointF(r.Left + rc, r.Top));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Left, r.Top));\r\n\r\n    if gcTopRight in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Right - rc, r.Top));\r\n      pth.AddArc(PointF(r.Right - rc, r.Top + rc), PointF(rc, rc), -90, 90);\r\n      pth.LineTo(PointF(r.Right, r.Top + rc));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Right, r.Top));\r\n\r\n    if gcBottomRight in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Right, r.Bottom - rc));\r\n      pth.AddArc(PointF(r.Right - rc, r.Bottom - rc), PointF(rc, rc), 0, 90);\r\n      pth.LineTo(PointF(r.Right - rc, r.Bottom));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Right, r.Bottom));\r\n\r\n    if gcBottomLeft in ACorners then\r\n      pth.LineTo(PointF(r.Left + rc, r.Bottom))\r\n    else\r\n      pth.LineTo(PointF(r.Left, r.Bottom));\r\n\r\n    pth.ClosePath;\r\n\r\n    DrawPath(FStroke, pth);\r\n  finally\r\n    pth.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.DrawText(AText: string; ARect: TRectF;\r\n  AWordWrapping: Boolean; AHorizontalAlign,\r\n  AVerticalAlign: TTMSFNCGraphicsTextAlign;\r\n  ATrimming: TTMSFNCGraphicsTextTrimming; AAngle: Single);\r\nvar\r\n  R: TRectF;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n  R := DrawTextInternal(AText, ARect, AWordWrapping, AHorizontalAlign, True);\r\n  case AVerticalAlign of\r\n    gtaCenter: DrawTextInternal(AText, RectF(ARect.Left, ARect.Top + ((ARect.Bottom - ARect.Top) - (r.Bottom - r.Top)) / 2, ARect.Right, ARect.Top + ((ARect.Bottom - ARect.Top) - (r.Bottom - r.Top)) / 2 + (r.Bottom - r.Top)), AWordWrapping, AHorizontalAlign, False);\r\n    gtaLeading: DrawTextInternal(AText, RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + (r.Bottom - r.Top)), AWordWrapping, AHorizontalAlign, False);\r\n    gtaTrailing: DrawTextInternal(AText, RectF(ARect.Left, ARect.Bottom - (r.Bottom - r.Top), ARect.Right, ARect.Bottom), AWordWrapping, AHorizontalAlign, False);\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.EndScene;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  Render;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillArc(AFill: TTMSFNCGraphicsFill; ACenter,\r\n  ARadius: TPointF; AStartAngle, ASweepAngle: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_arc(FNCanvas, ACenter.X, ACenter.Y, ARadius.X, DegToRad(AStartAngle), DegToRad(AStartAngle + ASweepAngle));\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      ApplyFill;\r\n//      cairo_fill(FNCanvas);\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n//      cairo_clip(FNCanvas);\r\n      DrawLinearGradient(RectF(ACenter.X - ARadius.X, ACenter.Y - ARadius.Y, ACenter.X + ARadius.X, ACenter.Y + ARadius.Y));\r\n    end;\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillChanged(Sender: TObject);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n     Exit;\r\n\r\n  ApplyFill;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillEllipse(AFill: TTMSFNCGraphicsFill;\r\n  ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  r := ARect;\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_arc(FNCanvas, r.Left + r.Width / 2, r.Top + r.Height / 2, r.Width / 2, 0, 2 * PI);\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      ApplyFill;\r\n//      cairo_fill(FNCanvas);\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n//      cairo_clip(FNCanvas);\r\n      DrawLinearGradient(r);\r\n    end;\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillPath(AFill: TTMSFNCGraphicsFill;\r\n  APath: TTMSFNCGraphicsPath; APathMode: TTMSFNCGraphicsPathDrawMode);\r\nvar\r\n  p: TTMSFNCGraphicsPathPolygon;\r\nbegin\r\n  if Assigned(APath) then\r\n  begin\r\n    FActivePath := APath;\r\n    SetLength(p, 0);\r\n    APath.FlattenToPolygon(p);\r\n    case APathMode of\r\n      pdmPolygon: FillPolygon(AFill, p);\r\n      pdmPolyline: FillPolyline(AFill, p);\r\n    end;\r\n    FActivePath := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillPolygon(AFill: TTMSFNCGraphicsFill;\r\n  APolygon: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if Length(Apolygon) = 0 then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_move_to(FNCanvas, APolygon[0].X, APolygon[0].Y);\r\n//  for I := 1 to Length(APolygon) - 1 do\r\n//    cairo_line_to(FNCanvas, APolygon[I].X, APolygon[I].Y);\r\n//  cairo_close_path(FNCanvas);\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      ApplyFill;\r\n//      cairo_fill(FNCanvas);\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n//      cairo_clip(FNCanvas);\r\n      if Assigned(FActivePath) then\r\n        DrawLinearGradient(FActivePath.GetBounds);\r\n    end;\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillPolyline(AFill: TTMSFNCGraphicsFill;\r\n  APolyline: TTMSFNCGraphicsPathPolygon);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if Length(APolyline) = 0 then\r\n    Exit;\r\n\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_move_to(FNCanvas, APolyline[0].X, APolyline[0].Y);\r\n//  for I := 1 to Length(APolyline) - 1 do\r\n//    cairo_line_to(FNCanvas, APolyline[I].X, APolyline[I].Y);\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      ApplyFill;\r\n//      cairo_fill(FNCanvas);\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n//      cairo_clip(FNCanvas);\r\n      if Assigned(FActivePath) then\r\n        DrawLinearGradient(FActivePath.GetBounds);\r\n    end;\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillRect(AFill: TTMSFNCGraphicsFill;\r\n  ARect: TRectF; AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  r := ARect;\r\n  SaveContext;\r\n//  cairo_new_path(FNCanvas);\r\n//  cairo_rectangle(FNCanvas, r.Left, r.Top, r.Width, r.Height);\r\n  case AFill.Kind of\r\n    gfkSolid:\r\n    begin\r\n      ApplyFill;\r\n//      cairo_fill(FNCanvas);\r\n    end;\r\n    gfkGradient:\r\n    begin\r\n//      cairo_clip(FNCanvas);\r\n      DrawLinearGradient(r);\r\n    end;\r\n  end;\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FillRoundRect(AFill: TTMSFNCGraphicsFill;\r\n  ARect: TRectF; ARounding: Single; ACorners: TTMSFNCGraphicsCorners;\r\n  AModifyRectMode: TTMSFNCGraphicsModifyRectMode);\r\nvar\r\n  pth: TTMSFNCGraphicsPath;\r\n  r: TRectF;\r\n  rc: Single;\r\nbegin\r\n  r := ARect;\r\n  rc := ARounding;\r\n\r\n  pth := TTMSFNCGraphicsPath.Create;\r\n  try\r\n    if gcBottomLeft in ACorners then\r\n    begin\r\n      pth.MoveTo(PointF(r.Left + rc, r.Bottom));\r\n      pth.AddArc(PointF(r.Left + rc, r.Bottom - rc), PointF(rc, rc), -270, 90);\r\n      pth.LineTo(PointF(r.Left, r.Bottom - rc));\r\n    end\r\n    else\r\n    begin\r\n      pth.MoveTo(PointF(r.Left, r.Bottom));\r\n    end;\r\n\r\n    if gcTopLeft in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Left, r.Top + rc));\r\n      pth.AddArc(PointF(r.Left + rc, r.Top + rc), PointF(rc, rc), -180, 90);\r\n      pth.LineTo(PointF(r.Left + rc, r.Top));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Left, r.Top));\r\n\r\n    if gcTopRight in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Right - rc, r.Top));\r\n      pth.AddArc(PointF(r.Right - rc, r.Top + rc), PointF(rc, rc), -90, 90);\r\n      pth.LineTo(PointF(r.Right, r.Top + rc));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Right, r.Top));\r\n\r\n    if gcBottomRight in ACorners then\r\n    begin\r\n      pth.LineTo(PointF(r.Right, r.Bottom - rc));\r\n      pth.AddArc(PointF(r.Right - rc, r.Bottom - rc), PointF(rc, rc), 0, 90);\r\n      pth.LineTo(PointF(r.Right - rc, r.Bottom));\r\n    end\r\n    else\r\n      pth.LineTo(PointF(r.Right, r.Bottom));\r\n\r\n    if gcBottomLeft in ACorners then\r\n      pth.LineTo(PointF(r.Left + rc, r.Bottom))\r\n    else\r\n      pth.LineTo(PointF(r.Left, r.Bottom));\r\n\r\n    pth.ClosePath;\r\n\r\n    FillPath(FFill, pth);\r\n  finally\r\n    pth.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.FontChanged(Sender: TObject);\r\nbegin\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.GetFillColor: TTMSFNCGraphicsColor;\r\nbegin\r\n  Result := Graphics.Fill.Color;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.GetNativeCanvas: Pointer;\r\nbegin\r\n  Result := FNCanvas;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.PathClose(APath: Pointer);\r\nbegin\r\n//  cairo_close_path(FNCanvas);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.PathLineTo(APath: Pointer; APoint: TPointF);\r\nbegin\r\n//  cairo_line_to(FNCanvas, APoint.X, APoint.Y);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.PathMoveTo(APath: Pointer; APoint: TPointF);\r\nbegin\r\n//  cairo_move_to(FNCanvas, APoint.X, APoint.Y);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.PathOpen(APath: Pointer);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.Render;\r\nbegin\r\n  if not FNeedsRendering then\r\n    Exit;\r\n\r\n//  if Assigned(FNCanvas) and Assigned(FBitmap) then\r\n//    Canvas.Draw(0, 0, FBitmap);\r\n\r\n  FNeedsRendering := False;\r\n  DestroyResources;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ResetClip;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ResetTextAngle(AAngle: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if AAngle <> 0 then\r\n    RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ResetTransform;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  RestoreContext;\r\n  SaveContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.RestoreState(\r\n  AState: TTMSFNCGraphicsSaveState);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  RestoreContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.RotateTransform(AAngle: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  cairo_rotate(FNCanvas, DegToRad(AAngle));\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.DrawTextInternal(AText: String; ARect: TRectF; AWordWrap: Boolean; AHorizontalAlignment: TTMSFNCGraphicsTextAlign; ACalculate: Boolean): TRectF;\r\nvar\r\n  i: Integer;\r\n  s, sn, st: string;\r\n  l: Integer;\r\n  w, mw: Single;\r\n  f: Boolean;\r\n  p: Integer;\r\n  tw: Single;\r\n  th: Single;\r\n  lcnt: Integer;\r\n  rs: TRectF;\r\n  fws: Single;\r\n//  te: cairo_text_extents_t;\r\n  ths: Single;\r\n\r\n  procedure ApplyFont;\r\n//  var\r\n//    slant: cairo_font_slant_t;\r\n//    weight: cairo_font_weight_t;\r\n//    fn: string;\r\n//    sz: Single;\r\n  begin\r\n//    fn := FFont.Name;\r\n//    if (fn = '') or (UpperCase(fn) = 'DEFAULT') then\r\n//      fn := 'sans-serif';\r\n//\r\n//    sz := FFont.Size;\r\n//    if sz = 0 then\r\n//      sz := 12;\r\n//\r\n//    if fsBold in FFont.Style then\r\n//      weight := CAIRO_FONT_WEIGHT_BOLD\r\n//    else\r\n//      weight := CAIRO_FONT_WEIGHT_NORMAL;\r\n//\r\n//    if fsItalic in FFont.Style then\r\n//      slant := CAIRO_FONT_SLANT_ITALIC\r\n//    else\r\n//      slant := CAIRO_FONT_SLANT_NORMAL;\r\n//\r\n//    cairo_select_font_face(FNCanvas, PChar(fn), slant, weight);\r\n//    cairo_set_font_size(FNCanvas, sz * 1.3);\r\n//    cairo_set_source_rgb(FNCanvas, TTMSFNCGraphics.GetColorRed(FFont.Color) / 255, TTMSFNCGraphics.GetColorGreen(FFont.Color) / 255,\r\n//      TTMSFNCGraphics.GetColorBlue(FFont.Color) / 255);\r\n  end;\r\n\r\n  function FindNextWord(AText: String; var APos: Integer): String;\r\n  var\r\n    l: integer;\r\n    i: integer;\r\n  begin\r\n    Result := '';\r\n\r\n    l := Length(AText);\r\n    if APos > l then\r\n      Exit;\r\n\r\n    i := APos;\r\n    while True do\r\n    begin\r\n      if ((AText[i] = #10) and (AText[i - 1] = #13)) or ((AText[i] = #13) and (AText[i - 1] = #10)) or (AText[i] = ' ') then\r\n      begin\r\n        if AText[i] = ' ' then\r\n          Result := Copy(AText, APos, i - (APos - 1))\r\n        else\r\n          Result := Copy(AText, APos, i - APos);\r\n\r\n        Break;\r\n      end\r\n      else if (AText[i] = #10) or (AText[i] = #13) or (AText[i] = ' ') then\r\n      begin\r\n        result := Copy(AText, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else if i >= l then\r\n      begin\r\n        result := Copy(AText, APos, i - (APos - 1));\r\n        Break;\r\n      end\r\n      else\r\n        inc(i);\r\n    end;\r\n\r\n    APos := i + 1;\r\n  end;\r\nbegin\r\n  ApplyFont;\r\n  if not AWordWrap then\r\n  begin\r\n//    cairo_text_extents(FNCanvas, PChar(AText), @te);\r\n    if not ACalculate then\r\n    begin\r\n//      case AHorizontalAlignment of\r\n//        gtaCenter: cairo_move_to(FNCanvas, ARect.Left + (ARect.Width - te.x_advance) / 2, ARect.Top + te.height);\r\n//        gtaLeading: cairo_move_to(FNCanvas, ARect.Left, ARect.Top + te.height);\r\n//        gtaTrailing: cairo_move_to(FNCanvas, ARect.Right - te.x_advance, ARect.Top + te.height);\r\n//      end;\r\n//      cairo_show_text(FNCanvas, PChar(AText));\r\n    end;\r\n//    Result := RectF(ARect.Left, ARect.Top, ARect.Left + te.x_advance, ARect.Top + te.Height);\r\n  end\r\n  else\r\n  begin\r\n    rs := ARect;\r\n\r\n    mw := 0;\r\n    i := 1;\r\n    ths := FFont.Size * 0.5;\r\n    lcnt := 0;\r\n    fws := 0;\r\n    tw := 0;\r\n    s := FindNextWord(AText, i);\r\n//    cairo_text_extents(FNCanvas, PChar(s), @te);\r\n//    w := te.x_advance;\r\n//    th := te.Height + ths;\r\n\r\n    mw := mw + w;\r\n    if (Length(s) > 0) and (s[Length(s)] = ' ') then\r\n      mw := mw + fws;\r\n\r\n    while i <= Length(AText) do\r\n    begin\r\n      l := Length(s);\r\n      if (l >= 2) and (((s[l] = #10) and (s[l - 1] = #13)) or ((s[l] = #13) and (s[l - 1] = #10))) then\r\n      begin\r\n        s := Copy(s, 1, l - 2);\r\n        f := True;\r\n      end\r\n      else if (l >= 1) and ((s[l] = #10) or (s[l] = #13)) then\r\n      begin\r\n        s := Copy(s, 1, l - 1);\r\n        f := True;\r\n      end\r\n      else\r\n        f := False;\r\n\r\n      sn := FindNextWord(AText, i);\r\n//      cairo_text_extents(FNCanvas, PChar(sn), @te);\r\n//      w := te.x_advance;\r\n//      th := Max(th, te.Height + ths);\r\n\r\n      if (ARect.Left + mw + w > ARect.Right) or f then\r\n      begin\r\n        if s <> '' then\r\n        begin\r\n          p := Length(s);\r\n          st := Copy(s, 1, p);\r\n\r\n          Inc(lcnt);\r\n          if mw > tw then\r\n            tw := mw;\r\n\r\n          if not ACalculate then\r\n          begin\r\n//            case AHorizontalAlignment of\r\n//              gtaCenter: cairo_move_to(FNCanvas, ARect.Left + (ARect.Width - mw) / 2, ARect.Top + th);\r\n//              gtaLeading: cairo_move_to(FNCanvas, ARect.Left, ARect.Top + th);\r\n//              gtaTrailing: cairo_move_to(FNCanvas, ARect.Right - mw, ARect.Top + th);\r\n//            end;\r\n//            cairo_show_text(FNCanvas, PChar(st));\r\n          end;\r\n\r\n          mw := 0;\r\n        end;\r\n\r\n        s := '';\r\n\r\n        ARect.Top := ARect.Top + th;\r\n        if (Trunc(ARect.Top) > Trunc(ARect.Bottom - th)) and not ACalculate then\r\n          Break;\r\n      end;\r\n\r\n      mw := mw + w;\r\n      if (Length(sn) > 0) and (sn[Length(sn)] = ' ') then\r\n        mw := mw + fws;\r\n      s := s + sn;\r\n    end;\r\n\r\n    if s <> '' then\r\n    begin\r\n      p := Length(s);\r\n      st := Copy(s, 1, p);\r\n      Inc(lcnt);\r\n      if mw > tw then\r\n        tw := mw;\r\n\r\n      if not ACalculate then\r\n      begin\r\n//        case AHorizontalAlignment of\r\n//          gtaCenter: cairo_move_to(FNCanvas, ARect.Left + (ARect.Width - mw) / 2, ARect.Top + th);\r\n//          gtaLeading: cairo_move_to(FNCanvas, ARect.Left, ARect.Top + th);\r\n//          gtaTrailing: cairo_move_to(FNCanvas, ARect.Right - mw, ARect.Top + th);\r\n//        end;\r\n//        cairo_show_text(FNCanvas, PChar(st));\r\n      end;\r\n    end;\r\n\r\n    Result := RectF(rs.Left, rs.Top, rs.Left + tw, rs.Top + lcnt * th);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SaveContext;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  cairo_save(FNCanvas);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.RestoreContext;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  cairo_restore(FNCanvas);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SaveState(AState: TTMSFNCGraphicsSaveState);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  SaveContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.ScaleTransform(AX, AY: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  cairo_scale(FNCanvas, AX, AY);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetSize(AWidth, AHeight: Single);\r\nbegin\r\n  FContextSize.cx := AWidth;\r\n  FContextSize.cy := AHeight;\r\n\r\n  DestroyResources;\r\n\r\n  FBitmap := TBitmap.Create;\r\n//  FBitmap.SetSize(Round(AWidth * FScale), Round(AHeight * FScale));\r\n//  FBitmap.Canvas.Brush.Style := bsSolid;\r\n//  FBitmap.Canvas.Brush.Color := gcWhite;\r\n//  FBitmap.Canvas.FillRect(0, 0, FBitmap.Width, FBitmap.Height);\r\n\r\n//  {$IFDEF LINUX}\r\n//  {$IFDEF LCLGTK2}\r\n//  FNCanvas := gdk_cairo_create(TGtkDeviceContext(FBitmap.Canvas.Handle).Drawable);\r\n//  {$ENDIF}\r\n//  {$ENDIF}\r\n//  {$IFDEF DARWIN}\r\n//  FNCanvas := nil;\r\n//  {$ENDIF}\r\n  ScaleTransform(FScale, FScale);\r\n  SaveContext;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetTextQuality(ATextQuality: TTMSFNCGraphicsTextQuality);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetShowAcceleratorChar(AShowAcceleratorChar: Boolean);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetAntiAliasing(AAntiAliasing: Boolean);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  if AAntiAliasing then\r\n//  begin\r\n//    {$IFDEF LINUX}\r\n//    cairo_set_antialias(FNCanvas, CAIRO_ANTIALIAS_BEST);\r\n//    {$ENDIF}\r\n//    {$IFDEF DARWIN}\r\n//    cairo_set_antialias(FNCanvas, CAIRO_ANTIALIAS_DEFAULT);\r\n//    {$ENDIF}\r\n//  end\r\n//  else\r\n//    cairo_set_antialias(FNCanvas, CAIRO_ANTIALIAS_NONE);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFill(AFill: TTMSFNCGraphicsFill);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFill.Assign(AFill);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFillColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFill.Color := AColor;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFillKind(AKind: TTMSFNCGraphicsFillKind);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFill.Kind := AKind;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFont(AFont: TTMSFNCGraphicsFont);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFont.AssignSource(AFont);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFontColor(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFont.Color := AColor;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFontName(AName: string);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFont.Name := AName;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFontSize(ASize: Integer);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFont.Size := ASize;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetFontStyles(AStyle: TFontStyles);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FFont.Style := AStyle;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetStroke(AStroke: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FStroke.Assign(AStroke);\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetStrokeColor(\r\n  AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FStroke.Color := AColor;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetStrokeKind(\r\n  AKind: TTMSFNCGraphicsStrokeKind);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FStroke.Kind := AKind;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.SetStrokeWidth(AWidth: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  FStroke.Width := AWidth;\r\nend;\r\n\r\nfunction TTMSFNCGraphicsContextWEB.SetTextAngle(ARect: TRectF;\r\n  AAngle: Single): TRectF;\r\nvar\r\n  ar: Single;\r\n  cx: TPointF;\r\nbegin\r\n  Result := ARect;\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n  if AAngle <> 0 then\r\n  begin\r\n    ar := DegToRad(AAngle);\r\n    cx.X := Result.Left + (Result.Right - Result.Left) / 2;\r\n    cx.Y := Result.Top + (Result.Bottom - Result.Top) / 2;\r\n\r\n    SaveContext;\r\n\r\n//    cairo_translate(FNCanvas, cx.X, cx.Y);\r\n//    cairo_rotate(FNCanvas, ar);\r\n\r\n    if (Result.Right - Result.Left) < (Result.Bottom - Result.Top) then\r\n      Result := RectF(-(Result.Bottom - Result.Top) / 2, -(Result.Right - Result.Left) / 2, (Result.Bottom - Result.Top) / 2, (Result.Right - Result.Left) / 2)\r\n    else\r\n      Result := RectF(-(Result.Right - Result.Left) / 2, -(Result.Bottom - Result.Top) / 2, (Result.Right - Result.Left) / 2, (Result.Bottom - Result.Top) / 2);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.StartSpecialPen;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.StopSpecialPen;\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.StrokeChanged(Sender: TObject);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n     Exit;\r\n\r\n  ApplyStroke;\r\nend;\r\n\r\nprocedure TTMSFNCGraphicsContextWEB.TranslateTransform(AX, AY: Single);\r\nbegin\r\n  if not Assigned(FNCanvas) then\r\n    Exit;\r\n\r\n//  cairo_translate(FNCanvas, AX, AY);\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCStyles;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF VCLLIB}\r\n{$HINTS OFF}\r\n{$IF COMPILERVERSION > 22}\r\n{$DEFINE VCLSTYLESENABLED}\r\n{$IFEND}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.Graphics, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types, WEBLib.Controls, UITypes\r\n  {$ENDIF}\r\n  {$IFDEF VCLSTYLESENABLED}\r\n  ,VCL.Themes\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,js\r\n  {$ENDIF}\r\n  ;\r\n\r\ntype\r\n  ITMSFNCAdaptToStyle = interface\r\n  ['{3EFF288D-3927-4E86-8E9D-EF684B501C9E}']\r\n    function GetAdaptToStyle: Boolean;\r\n    procedure SetAdaptToStyle(const Value: Boolean);\r\n    property AdaptToStyle: Boolean read GetAdaptToStyle write SetAdaptToStyle;\r\n  end;\r\n\r\n  TTMSFNCStyles = class\r\n  private class var\r\n    {$IFDEF FMXLIB}\r\n    FScene: IScene;\r\n    {$ENDIF}\r\n  protected\r\n    {$IFDEF FMXLIB}\r\n    class function ExtractColor(ABitmap: TBitmap): TTMSFNCGraphicsColor; virtual;\r\n    class function ExtractColorTo(ABitmap: TBitmap): TTMSFNCGraphicsColor; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    class function ExtractColor(AValue: string): TTMSFNCGraphicsColor; virtual;\r\n    class function ExtractColorTo(AValue: string): TTMSFNCGraphicsColor; virtual;\r\n    class function ExtractFontName(AValue: string): string; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    class function ExtractColor(AElement: TThemedElementDetails): TTMSFNCGraphicsColor; virtual;\r\n    class function ExtractColorTo(AElement: TThemedElementDetails): TTMSFNCGraphicsColor; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    class function ParseBrush(ABrush: TBrush; ASecondColor: Boolean): TTMSFNCGraphicsColor; virtual;\r\n    class function GetStyleSceneObject: TFmxObject; virtual;\r\n    class function GetStyleBackgroundFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleBackgroundStroke(AStyle: TFmxObject): TStrokeBrush; virtual;\r\n    class function GetStyleDefaultButtonFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleDefaultButtonStroke(AStyle: TFmxObject): TStrokeBrush; virtual;\r\n    class function GetStyleEditTextColor(AStyle: TFmxObject): TAlphaColor; virtual;\r\n    class function GetStyleEditFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleEditStroke(AStyle: TFmxObject): TStrokeBrush; virtual;\r\n    class function GetStyleHeaderFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleHeaderStroke(AStyle: TFmxObject): TStrokeBrush; virtual;\r\n    class function GetStyleSelectionFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleAlternativeSelectionFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleAlternativeBackgroundFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleAlternativeBackgroundStroke(AStyle: TFmxObject): TStrokeBrush; virtual;\r\n    class function GetStyleFocusFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleLineFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function GetStyleTextFont(AStyle: TFmxObject): TFont; virtual;\r\n    class function GetStyleTextColor(AStyle: TFmxObject): TAlphaColor; virtual;\r\n    class function GetStyleAlternateBackgroundFill(AStyle: TFmxObject): TBrush; virtual;\r\n    class function IsTransparentStyle(AStyle: TFmxObject): Boolean; virtual;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    class function GetStyleBackgroundFill: string; virtual;\r\n    class function GetStyleBackgroundStroke: string; virtual;\r\n    class function GetStyleDefaultButtonFill: string; virtual;\r\n    class function GetStyleDefaultButtonStroke: string; virtual;\r\n    class function GetStyleEditTextColor: string; virtual;\r\n    class function GetStyleEditFill: string; virtual;\r\n    class function GetStyleEditStroke: string; virtual;\r\n    class function GetStyleHeaderFill: string; virtual;\r\n    class function GetStyleHeaderStroke: string; virtual;\r\n    class function GetStyleSelectionFill: string; virtual;\r\n    class function GetStyleAlternativeSelectionFill: string; virtual;\r\n    class function GetStyleAlternativeBackgroundFill: string; virtual;\r\n    class function GetStyleAlternativeBackgroundStroke: string; virtual;\r\n    class function GetStyleFocusFill: string; virtual;\r\n    class function GetStyleLineFill: string; virtual;\r\n    class function GetStyleTextFont: string; virtual;\r\n    class function GetStyleTextColor: string; virtual;\r\n    class function GetStyleAlternateBackgroundFill: string; virtual;\r\n    {$ENDIF}\r\n  public\r\n    {$IFDEF FMXLIB}\r\n    class procedure SetActiveScene(AScene: IScene); virtual;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    class function FindCSSStyleRule(ARuleName: string): TJSObject; virtual;\r\n    class function FindCSSStyleProperty(ARuleName, APropertyName: string): string; virtual;\r\n    {$ENDIF}\r\n    class function StyleServicesEnabled: Boolean; virtual;\r\n    class function GetStyleLineFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleBackgroundFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleBackgroundFillColorTo(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleAlternativeBackgroundFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleAlternativeBackgroundFillColorTo(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleBackgroundStrokeColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleHeaderFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleHeaderFillColorTo(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleHeaderStrokeColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleSelectionFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleSelectionFillColorTo(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleTextFontColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleAlternativeTextFontColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleDefaultButtonFillColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n    class function GetStyleDefaultButtonStrokeColor(var {%H-}AColor: TTMSFNCGraphicsColor): Boolean; virtual;\r\n  end;\r\n\r\nvar\r\n  CSSStyleFileName: string = '';\r\n\r\nimplementation\r\n\r\n{$IFDEF FMXLIB}\r\nuses\r\n  UIConsts, FMX.Objects, FMX.Styles, FMX.Styles.Objects, Types, SysUtils, WEBLib.Forms;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nuses\r\n  SysUtils;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nfunction Pos(const Search, InString: String; Offset: Integer): Integer; assembler; overload;\r\nasm\r\n  return InString.indexOf(Search, Offset)+1;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\n\r\nclass function TTMSFNCStyles.ParseBrush(ABrush: TBrush; ASecondColor: Boolean): TTMSFNCGraphicsColor;\r\nbegin\r\n  case ABrush.Kind of\r\n    TBrushKind.None, TBrushKind.Resource: Result := gcNull;\r\n    TBrushKind.Solid: Result := ABrush.Color;\r\n    TBrushKind.Gradient:\r\n    begin\r\n      if ABrush.Gradient.Points.Count > 0 then\r\n      begin\r\n        if ASecondColor then\r\n          Result := ABrush.Gradient.Points[1].Color\r\n        else\r\n          Result := ABrush.Gradient.Points[0].Color;\r\n      end\r\n      else\r\n        Result := ABrush.Color;\r\n    end;\r\n    TBrushKind.Bitmap:\r\n    begin\r\n      if ASecondColor then\r\n        Result := ExtractColorTo(ABrush.Bitmap.Bitmap)\r\n      else\r\n        Result := ExtractColor(ABrush.Bitmap.Bitmap);\r\n    end;\r\n    else\r\n      Result := gcNull;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleSceneObject: TFmxObject;\r\nvar\r\n  frm: TCommonCustomForm;\r\nbegin\r\n  if Assigned(TTMSFNCStyles.FScene) and Assigned(TTMSFNCStyles.FScene.GetObject) and (TTMSFNCStyles.FScene.GetObject.ClassName <> 'TTMSFNCCustomPopupForm') then\r\n  begin\r\n    if Assigned(TTMSFNCStyles.FScene.StyleBook) then\r\n      Result := TTMSFNCStyles.FScene.StyleBook.Style\r\n    else\r\n      Result := TStyleManager.ActiveStyleForScene(TTMSFNCStyles.FScene);\r\n  end\r\n  else\r\n  begin\r\n    frm := Screen.ActiveForm;\r\n    if not Assigned(frm) then\r\n      frm := Application.MainForm;\r\n\r\n    if Assigned(frm) and Assigned(frm.StyleBook) then\r\n      Result := frm.StyleBook.Style\r\n    else\r\n      Result := TStyleManager.ActiveStyle(nil);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.IsTransparentStyle(\r\n  AStyle: TFmxObject): Boolean;\r\nvar\r\n  st: TStyleDescription;\r\nbegin\r\n  Result := False;\r\n  st := TStyleManager.FindStyleDescriptor(AStyle);\r\n  if Assigned(st) then\r\n    Result := LowerCase(st.Title) = 'transparent';\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternateBackgroundFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('alternatingrowbackground');\r\n      if (Assigned(stobj) and (stobj is TBrushObject)) then\r\n        f.Assign((stobj as TBrushObject).Brush);\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeSelectionFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('memostyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('selection');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if (stobj is TBrushObject) then\r\n          f.Assign((stobj as TBrushObject).Brush)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('buttonstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonStroke(\r\n  AStyle: TFmxObject): TStrokeBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  s: TStrokeBrush;\r\nbegin\r\n  s := TStrokeBrush.Create(TBrushKind.Solid, claDarkGray);\r\n  Result := s;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('buttonstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          s.Assign((stobj as TRectangle).Stroke);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundStroke(\r\n  AStyle: TFmxObject): TStrokeBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  s: TStrokeBrush;\r\nbegin\r\n  s := TStrokeBrush.Create(TBrushKind.Solid, claDarkGray);\r\n  Result := s;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          s.Assign((stobj as TRectangle).Stroke);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('memostyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundStroke(\r\n  AStyle: TFmxObject): TStrokeBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  s: TStrokeBrush;\r\nbegin\r\n  s := TStrokeBrush.Create(TBrushKind.Solid, claDarkGray);\r\n  Result := s;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('memostyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('foreground');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TBrushObject) then\r\n          s.Assign((stobj as TBrushObject).Brush);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditTextColor(AStyle: TFmxObject): TAlphaColor;\r\nvar\r\n  st, stobj: TFMXObject;\r\nbegin\r\n  Result := claBlack;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('editstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('foreground');\r\n      if (Assigned(stobj) and (stobj is TBrushObject)) then\r\n      begin\r\n        if (Assigned(stobj) and (stobj is TBrushObject)) then\r\n          Result := (stobj as TBrushObject).Brush.Color;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('editstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditStroke(\r\n  AStyle: TFmxObject): TStrokeBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  s: TStrokeBrush;\r\nbegin\r\n  s := TStrokeBrush.Create(TBrushKind.Solid, claDarkGray);\r\n  Result := s;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('editstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          s.Assign((stobj as TRectangle).Stroke);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleFocusFill(AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('focus');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('headeritemstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if stobj is TButtonStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TButtonStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderStroke(\r\n  AStyle: TFmxObject): TStrokeBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  s: TStrokeBrush;\r\nbegin\r\n  s := TStrokeBrush.Create(TBrushKind.Solid, claDarkGray);\r\n  Result := s;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('headeritemstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('background');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          s.Assign((stobj as TRectangle).Stroke);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleLineFill(AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('linefill');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TBrushObject) then\r\n          f.Assign((stobj as TBrushObject).Brush)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleSelectionFill(\r\n  AStyle: TFmxObject): TBrush;\r\nvar\r\n  st, stobj: TFmxObject;\r\n  f: TBrush;\r\n  bmp: TBitmap;\r\nbegin\r\n  f := TBrush.Create(TBrushKind.Solid, claNull);\r\n  Result := f;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('gridstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('selection');\r\n      if Assigned(stobj) then\r\n      begin\r\n        if (stobj is TRectangle) then\r\n          f.Assign((stobj as TRectangle).Fill)\r\n        else if (stobj is TBrushObject) then\r\n          f.Assign((stobj as TBrushObject).Brush)\r\n        else if stobj is TCustomStyleObject then\r\n        begin\r\n          f.Kind := TBrushKind.Bitmap;\r\n          f.Bitmap.WrapMode := TWrapMode.TileStretch;\r\n          bmp := TBitmap.Create(Round(200), Round(200));\r\n          if bmp.Canvas.BeginScene then\r\n          begin\r\n            (stobj as TCustomStyleObject).DrawToCanvas(bmp.Canvas, RectF(-10, -10, bmp.Width + 10, bmp.Height + 10));\r\n            bmp.Canvas.EndScene;\r\n          end;\r\n          f.Bitmap.Bitmap.Assign(bmp);\r\n          bmp.Free;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleTextColor(\r\n  AStyle: TFmxObject): TAlphaColor;\r\nvar\r\n  st, stobj: TFmxObject;\r\nbegin\r\n  Result := claBlack;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('headeritemstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('text');\r\n      if (Assigned(stobj) and (stobj is TText)) then\r\n        Result := (stobj as TText).TextSettings.FontColor;\r\n    end;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleTextFont(AStyle: TFmxObject): TFont;\r\nvar\r\n  st, stobj: TFmxObject;\r\nbegin\r\n  Result := TFont.Create;\r\n  if Assigned(AStyle) then\r\n  begin\r\n    st := AStyle.FindStyleResource('headeritemstyle');\r\n    if Assigned(st) then\r\n    begin\r\n      stobj := st.FindStyleResource('text');\r\n      if (Assigned(stobj) and (stobj is TText)) then\r\n        Result.Assign((stobj as TText).TextSettings.Font);\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCStyles }\r\n\r\n{$IFDEF FMXLIB}\r\nclass function TTMSFNCStyles.ExtractColor(\r\n  ABitmap: TBitmap): TTMSFNCGraphicsColor;\r\nvar\r\n  dt: TBitmapData;\r\nbegin\r\n  Result := gcNull;\r\n  if not Assigned(ABitmap) then\r\n    Exit;\r\n  if ABitmap.Map(TMapAccess.Read, dt) then\r\n  begin\r\n    Result := dt.GetPixel(dt.Width div 2, 0);\r\n    ABitmap.Unmap(dt);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.ExtractColorTo(\r\n  ABitmap: TBitmap): TTMSFNCGraphicsColor;\r\nvar\r\n  dt: TBitmapData;\r\nbegin\r\n  Result := gcNull;\r\n  if not Assigned(ABitmap) then\r\n    Exit;\r\n  if ABitmap.Map(TMapAccess.Read, dt) then\r\n  begin\r\n    Result := dt.GetPixel(dt.Width div 2, dt.Height);\r\n    ABitmap.Unmap(dt);\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', 'background');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundStroke: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', 'border-color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCButtonStyle', 'background');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonStroke: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCButtonStyle', 'border-color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditTextColor: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCEditStyle', '--foreground');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCEditStyle', 'background');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleEditStroke: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCStyle', 'border-color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCHeaderItemStyle', 'background');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderStroke: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCHeaderItemStyle', 'border-color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleSelectionFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', '--selection');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeSelectionFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCMemoStyle', '--selection');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCMemoStyle', 'background');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundStroke: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCMemoStyle', 'border-color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleFocusFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', '--focus');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleLineFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', '--linefill');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleTextFont: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCHeaderItemStyle', 'font-family');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleTextColor: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCHeaderItemStyle', 'color');\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternateBackgroundFill: string;\r\nbegin\r\n  Result := FindCSSStyleProperty('.TMSFNCGridStyle', '--alternatingrowbackground');\r\nend;\r\n\r\nclass function TTMSFNCStyles.ExtractColor(AValue: string): TTMSFNCGraphicsColor;\r\nvar\r\n  s, s2, s3: string;\r\n  sl, sl2: TStringList;\r\n  p, p2: Integer;\r\n\r\n  function ParseValue(AValue: string): Integer;\r\n  begin\r\n    Result := StrToInt(Trim(StringReplace(AValue, 'rgb(', '', [rfReplaceAll])))\r\n  end;\r\nbegin\r\n  Result := gcNull;\r\n  if AValue <> '' then\r\n  begin\r\n    s := LowerCase(StringReplace(AValue, ' ', '', [rfReplaceAll]));\r\n    if Pos('linear-gradient', s) = 1 then\r\n    begin\r\n      p := Pos('rgb', s);\r\n      if p = 0 then\r\n        p := Pos('#', s);\r\n      p2 := Pos(')', s, p);\r\n      s2 := Copy(s, p, p2 - p + 1);\r\n      p := Pos('rgb', s, p2);\r\n      if p = 0 then\r\n        p := Pos('#', s);\r\n      p2 := Pos(')', s, p);\r\n      s3 := Copy(s, p, p2 - p + 1);\r\n      Result := ExtractColor(s2);\r\n    end\r\n    else if Pos('rgb', s) = 1 then\r\n    begin\r\n      sl := TStringList.Create;\r\n      try\r\n        sl.Delimiter := ',';\r\n        sl.DelimitedText := s;\r\n        Result := MakeGraphicsColor(ParseValue(sl[0]), ParseValue(sl[1]), ParseValue(sl[2]));\r\n      finally\r\n        sl.Free;\r\n      end;\r\n    end\r\n    else if Pos('#', s) = 1 then\r\n      Result := HexToColor(s);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.ExtractColorTo(AValue: string): TTMSFNCGraphicsColor;\r\nvar\r\n  s, s2, s3: string;\r\n  sl, sl2: TStringList;\r\n  p, p2: Integer;\r\n\r\n  function ParseValue(AValue: string): Integer;\r\n  begin\r\n    Result := StrToInt(Trim(StringReplace(AValue, 'rgb(', '', [rfReplaceAll])))\r\n  end;\r\nbegin\r\n  Result := gcNull;\r\n  if AValue <> '' then\r\n  begin\r\n    s := LowerCase(StringReplace(AValue, ' ', '', [rfReplaceAll]));\r\n    if Pos('linear-gradient', s) = 1 then\r\n    begin\r\n      p := Pos('rgb', s);\r\n      if p = 0 then\r\n        p := Pos('#', s);\r\n      p2 := Pos(')', s, p);\r\n      s2 := Copy(s, p, p2 - p + 1);\r\n      p := Pos('rgb', s, p2);\r\n      if p = 0 then\r\n        p := Pos('#', s);\r\n      p2 := Pos(')', s, p);\r\n      s3 := Copy(s, p, p2 - p + 1);\r\n      Result := ExtractColor(s3);\r\n    end\r\n    else if Pos('rgb', s) = 1 then\r\n    begin\r\n      sl := TStringList.Create;\r\n      try\r\n        sl.Delimiter := ',';\r\n        sl.DelimitedText := s;\r\n        Result := MakeGraphicsColor(ParseValue(sl[0]), ParseValue(sl[1]), ParseValue(sl[2]));\r\n      finally\r\n        sl.Free;\r\n      end;\r\n    end\r\n    else if Pos('#', s) = 1 then\r\n      Result := HexToColor(s);\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.ExtractFontName(AValue: string): string;\r\nbegin\r\n  Result := AValue;\r\nend;\r\n\r\nclass function TTMSFNCStyles.FindCSSStyleProperty(ARuleName, APropertyName: string): string;\r\nvar\r\n  j: TJSObject;\r\n  s: string;\r\n  v: string;\r\nbegin\r\n  Result := '';\r\n  j := FindCSSStyleRule(ARuleName);\r\n  if Assigned(j) then\r\n  begin\r\n    s := APropertyName;\r\n    asm\r\n      v = j.style.getPropertyValue(s);\r\n    end;\r\n    Result := v;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.FindCSSStyleRule(ARuleName: string): TJSObject;\r\nvar\r\n  s, f: string;\r\nbegin\r\n  Result := nil;\r\n  s := ARuleName;\r\n  f := CSSStyleFileName;\r\n  asm\r\n    for (var i = 0; i < document.styleSheets.length; i++){\r\n      var fn = document.styleSheets[i].href;\r\n      if (fn != null) {\r\n      if (f == fn.substring(fn.lastIndexOf('/')+1) || f == \"\"){\r\n        var classes = document.styleSheets[i].rules || document.styleSheets[i].cssRules;\r\n        for (var x = 0; x < classes.length; x++) {\r\n            if (classes[x].selectorText.startsWith(s)) {\r\n                return classes[x];\r\n            }\r\n        }\r\n       }\r\n      }\r\n    }\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF VCLSTYLESENABLED}\r\nclass function TTMSFNCStyles.ExtractColor(AElement: TThemedElementDetails): TTMSFNCGraphicsColor;\r\nvar\r\n  bmp: TBitmap;\r\nbegin\r\n  bmp := TBitmap.Create;\r\n  try\r\n    bmp.SetSize(200, 200);\r\n    StyleServices.DrawElement(bmp.Canvas.Handle, AElement, Rect(0, 0, 200, 200));\r\n    Result := bmp.Canvas.Pixels[bmp.Width div 2, 2];\r\n  finally\r\n    bmp.Free;\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.ExtractColorTo(AElement: TThemedElementDetails): TTMSFNCGraphicsColor;\r\nvar\r\n  bmp: TBitmap;\r\nbegin\r\n  bmp := TBitmap.Create;\r\n  try\r\n    bmp.SetSize(200, 200);\r\n    StyleServices.DrawElement(bmp.Canvas.Handle, AElement, Rect(0, 0, 200, 200));\r\n    Result := bmp.Canvas.Pixels[bmp.Width div 2, bmp.Height - 2];\r\n  finally\r\n    bmp.Free;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundFillColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleBackgroundFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecFillColor, c);\r\n    if c = clNone then\r\n      c := ExtractColor(l);\r\n\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleBackgroundFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundFillColorTo(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleBackgroundFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, True);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgGradientCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecFillColor, c);\r\n    if c = clNone then\r\n      c := ExtractColorTo(l);\r\n\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleBackgroundFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColorTo(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundFillColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleAlternativeBackgroundFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(teBackgroundNormal);\r\n    c := ExtractColor(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleAlternativeBackgroundFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeBackgroundFillColorTo(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleAlternativeBackgroundFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, True);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(teBackgroundNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecGradientColor1, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleAlternativeBackgroundFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColorTo(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleBackgroundStrokeColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  s: TStrokeBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    s := GetStyleBackgroundStroke(GetStyleSceneObject);\r\n    if Assigned(s) then\r\n    begin\r\n      AColor := ParseBrush(s, False);\r\n      Result := AColor <> claNull;\r\n      s.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecBorderColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleBackgroundStroke;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonFillColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleDefaultButtonFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tcbButtonNormal);\r\n    c := ExtractColor(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleDefaultButtonFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleDefaultButtonStrokeColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  s: TStrokeBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    s := GetStyleDefaultButtonStroke(GetStyleSceneObject);\r\n    if Assigned(s) then\r\n    begin\r\n      AColor := ParseBrush(s, False);\r\n      Result := AColor <> claNull;\r\n      s.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tcbButtonNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecBorderColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleDefaultButtonStroke;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderFillColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleHeaderFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgFixedCellNormal);\r\n    c := ExtractColor(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleHeaderFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderFillColorTo(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleHeaderFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, True);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgFixedCellNormal);\r\n    c := ExtractColorTo(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleHeaderFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColorTo(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleHeaderStrokeColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  s: TStrokeBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    s := GetStyleHeaderStroke(GetStyleSceneObject);\r\n    if Assigned(s) then\r\n    begin\r\n      AColor := ParseBrush(s, False);\r\n      Result := AColor <> claNull;\r\n      s.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLLIBVCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgFixedCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecBorderColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleHeaderStroke;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleLineFillColor(\r\n  var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleLineFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecBorderColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleLineFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleSelectionFillColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleSelectionFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, False);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgCellSelected);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecFillColor, c);\r\n    c := ExtractColor(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleSelectionFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleSelectionFillColorTo(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  f: TBrush;\r\n{$ENDIF}\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    f := GetStyleSelectionFill(GetStyleSceneObject);\r\n    if Assigned(f) then\r\n    begin\r\n      AColor := ParseBrush(f, True);\r\n      Result := AColor <> claNull;\r\n      f.Free;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    l := StyleServices.GetElementDetails(tgCellSelected);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecFillColor, c);\r\n    c := ExtractColorTo(l);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleSelectionFill;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColorTo(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleTextFontColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    AColor := GetStyleTextColor(GetStyleSceneObject);\r\n    Result := AColor <> claNull;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    AColor := gcBlack;\r\n    l := StyleServices.GetElementDetails(tgCellNormal);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecTextColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleTextColor;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nclass function TTMSFNCStyles.GetStyleAlternativeTextFontColor(var AColor: TTMSFNCGraphicsColor): Boolean;\r\n{$IFDEF VCLSTYLESENABLED}\r\nvar\r\n  l: TThemedElementDetails;\r\n  c: TColor;\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nvar\r\n  f: string;\r\n  c: TTMSFNCGraphicsColor;\r\n{$ENDIF}\r\nbegin\r\n  Result := False;\r\n  if StyleServicesEnabled then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    AColor := GetStyleEditTextColor(GetStyleSceneObject);\r\n    Result := AColor <> claNull;\r\n    {$ENDIF}\r\n    {$IFDEF VCLSTYLESENABLED}\r\n    AColor := gcBlack;\r\n    l := StyleServices.GetElementDetails(tgCellSelected);\r\n    c := clNone;\r\n    StyleServices.GetElementColor(l, ecTextColor, c);\r\n    AColor := c;\r\n    Result := c <> clNone;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    f := GetStyleEditTextColor;\r\n    if f <> '' then\r\n    begin\r\n      c := ExtractColor(f);\r\n      AColor := c;\r\n      Result := c <> gcNull;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nclass procedure TTMSFNCStyles.SetActiveScene(AScene: IScene);\r\nbegin\r\n  FScene := AScene;\r\nend;\r\n{$ENDIF}\r\n\r\nclass function TTMSFNCStyles.StyleServicesEnabled: Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  s: TFmxObject;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  Result := True;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  Result := False;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  s := GetStyleSceneObject;\r\n  Result := Assigned(s);\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  {$IFDEF VCLSTYLESENABLED}\r\n  Result := (StyleServices.Enabled) and (StyleServices.Name <> 'Windows');\r\n  {$ENDIF}\r\n  {$IFNDEF VCLSTYLESENABLED}\r\n  Result := False;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCCustomControl;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE LCLWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\n{$DEFINE LCLWEBLIB}\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXMOBILE}\r\n{$DEFINE DRAWTRIAL}\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\n{$DEFINE DRAWTRIAL}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  {%H-}Windows,\r\n  {$ENDIF}\r\n  Classes, WEBLib.Controls, WEBLib.TMSFNCGraphics, WEBLib.Graphics, WEBLib.TMSFNCStyles\r\n  {$IFNDEF WEBLIB}\r\n  ,WEBLib.TMSFNCPersistence, WEBLib.TMSFNCUndo\r\n  {$IFDEF FNCLIB}\r\n  ,WEBLib.TMSFNCHint\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ,Types, WEBLib.TMSFNCGraphicsTypes, WEBLib.TMSFNCTypes, TypInfo, WEBLib.Forms\r\n  {$IFDEF VCLLIB}\r\n  ,Messages\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,UITypes, Generics.Collections\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,LMessages, {%H-}LCLIntF, fgl\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types, Messaging\r\n  {$ENDIF}\r\n  ;\r\n\r\ntype\r\n  {$IFDEF FNCLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ITMSFNCShortCutHint = interface\r\n  ['{A3E21A73-163A-4617-841B-8E0A62BF41B0}']\r\n    function HasShortCut(AShortCut: string): Boolean;\r\n    function HandleShortCut(AShortCut: string): Boolean;\r\n    function GetShortCutHint: string;\r\n    function IsShortCutHintActive: Boolean;\r\n    procedure ShowShortCutHint;\r\n    procedure CancelShortCutHint(AClearShortCutHintString: Boolean = True);\r\n    procedure SetShortCutHint(const Value: string);\r\n    property ShortCutHint: string read GetShortCutHint write SetShortCutHint;\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  TTMSFNCCustomDesignerForm = class(TForm);\r\n\r\n  TTMSFNCCustomControl = class;\r\n\r\n  TTMSFNCControlAlignment = (caNone, caTop, caBottom, caLeft, caRight, caClient);\r\n\r\n  {$IFDEF FNCLIB}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCCustomControlShortCutWindowList = TObjectList<TTMSFNCHint>;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCCustomControlBaseCommon = class(TControl, ITMSFNCAdaptToStyle, ITMSFNCProductInfo {$IFDEF FNCLIB}, ITMSFNCShortCutHint{$ENDIF})\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCCustomControlBaseCommon = class(TCustomControl, ITMSFNCAdaptToStyle, ITMSFNCProductInfo {$IFNDEF WEBLIB}{$IFDEF FNCLIB}, ITMSFNCShortCutHint{$ENDIF}{$ENDIF})\r\n  {$ENDIF}\r\n  private\r\n    {$IFDEF CMNWEBLIB}\r\n    FAllowFocus: Boolean;\r\n    {$ENDIF}\r\n    {$IFDEF FNCLIB}\r\n    FShortCutHint: string;\r\n    {$IFNDEF WEBLIB}\r\n    FShortCutLimitation: string;\r\n    FShortCutWindowList: TTMSFNCCustomControlShortCutWindowList;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FAllowGetChildren: Boolean;\r\n    FAdaptToStyle: Boolean;\r\n    FAdaptedToStyle: Boolean;\r\n    FTransparent: Boolean;\r\n    FBufferedPainting: Boolean;\r\n    FNativeCanvas: Boolean;\r\n    FAntiAliasing: Boolean;\r\n    FOptimizedHTMLDrawing: Boolean;\r\n    FShowAcceleratorChar: Boolean;\r\n    FTextQuality: TTMSFNCGraphicsTextQuality;\r\n    FOnInternalDblClick: TNotifyEvent;\r\n    FOnInternalMouseDown: TNotifyEvent;\r\n    FOnInternalMouseMove: TNotifyEvent;\r\n    FOnInternalMouseUp: TNotifyEvent;\r\n    function GetAllowFocus: Boolean;\r\n    {$IFDEF FNCLIB}\r\n    function GetShortCutHint: string;\r\n    {$ENDIF}\r\n    function GetControlAlignment: TTMSFNCControlAlignment;\r\n    procedure SetAllowFocus(const Value: Boolean);\r\n    procedure SetControlAlignment(const Value: TTMSFNCControlAlignment);\r\n    procedure SetAntiAliasing(const Value: Boolean);\r\n    procedure SetOptimizedHTMLDrawing(const Value: Boolean);\r\n    procedure SetShowAcceleratorChar(const Value: Boolean);\r\n    procedure SetNativeCanvas(const Value: Boolean);\r\n    procedure SetTextQuality(const Value: TTMSFNCGraphicsTextQuality);\r\n    {$IFDEF FNCLIB}\r\n    procedure SetShortCutHint(const Value: string);\r\n    {$ENDIF}\r\n  protected\r\n    function GetVersion: string; virtual;\r\n    function GetDocURL: string; virtual;\r\n    function GetTipsURL: string; virtual;\r\n    function GetClientMousePos: TPointF; virtual;\r\n    function ConvertScreenToClient(APoint: TPointF): TPointF; virtual;\r\n    function ConvertClientToScreen(APoint: TPointF): TPointF; virtual;\r\n    function GetDragObjectScreenShot: TTMSFNCBitmap; virtual;\r\n    function GetAdaptToStyle: Boolean; virtual;\r\n    {$IFDEF FNCLIB}\r\n    {$IFNDEF WEBLIB}\r\n    function HasShortCut(AShortCut: string): Boolean; virtual;\r\n    function HandleShortCut(AShortCut: string): Boolean; virtual;\r\n    function ExecuteShortCutMethod(AShortCut: string): Boolean; virtual;\r\n    function IsShortCutHintActive: Boolean; virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    procedure ChangeDPIScale({%H-}M, {%H-}D: Integer); virtual;\r\n    procedure DestroyGraphicElements; virtual; abstract;\r\n    procedure SetDefaultGraphicColors; virtual;\r\n    procedure SetAdaptToStyle(const Value: Boolean); virtual;\r\n    procedure CancelHint; virtual;\r\n    procedure BeginDrag; virtual;\r\n    procedure InitializeStyle;\r\n    procedure ApplyStyle; virtual;\r\n    procedure ResetToDefaultStyle; virtual;\r\n    procedure HandleMouseLeave; virtual;\r\n    procedure HandleMouseEnter; virtual;\r\n    procedure HandleMouseDown({%H-}Button: TTMSFNCMouseButton; {%H-}Shift: TShiftState; {%H-}X, {%H-}Y: Single); virtual;\r\n    procedure HandleMouseMove({%H-}Shift: TShiftState; {%H-}X, {%H-}Y: Single); virtual;\r\n    procedure HandleDblClick({%H-}X, {%H-}Y: Single); virtual;\r\n    procedure HandleMouseUp({%H-}Button: TTMSFNCMouseButton; {%H-}Shift: TShiftState; {%H-}X, {%H-}Y: Single); virtual;\r\n    procedure HandleKeyPress(var {%H-}Key: Char); virtual;\r\n    procedure HandleKeyDown(var {%H-}Key: Word; {%H-}Shift: TShiftState); virtual;\r\n    procedure HandleDialogKey(var {%H-}Key: Word; {%H-}Shift: TShiftState); virtual;\r\n    procedure HandleKeyUp(var {%H-}Key: Word; {%H-}Shift: TShiftState); virtual;\r\n    procedure HandleMouseWheel({%H-}Shift: TShiftState; {%H-}WheelDelta: Integer; var {%H-}Handled: Boolean); virtual;\r\n    procedure HandleDragOver(const {%H-}Source: TObject; const {%H-}Point: TPointF; var {%H-}Accept: Boolean); virtual;\r\n    procedure HandleDragDrop(const {%H-}Source: TObject; const {%H-}Point: TPointF); virtual;\r\n    {$IFDEF FNCLIB}\r\n    {$IFNDEF WEBLIB}\r\n    procedure GetShortCutHints(AShortCutHints: TStringList); virtual;\r\n    procedure ShowShortCutHint; virtual;\r\n    procedure CustomizeShortCut({%H-}AShortCutWindow: TTMSFNCHint; {%H-}AShortCut: string; {%H-}AShortCutRect: TRectF; var {%H-}AShortCutPosition: TPointF); virtual;\r\n    procedure CancelShortCutHint(AClearShortCutHintString: Boolean = True); virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    property AdaptToStyle: Boolean read GetAdaptToStyle write SetAdaptToStyle default False;\r\n    property Transparent: Boolean read FTransparent write FTransparent default False;\r\n    property BufferedPainting: Boolean read FBufferedPainting write FBufferedPainting default False;\r\n    property NativeCanvas: Boolean read FNativeCanvas write SetNativeCanvas default False;\r\n    property AntiAliasing: Boolean read FAntiAliasing write SetAntiAliasing default True;\r\n    property OptimizedHTMLDrawing: Boolean read FOptimizedHTMLDrawing write SetOptimizedHTMLDrawing default True;\r\n    property ShowAcceleratorChar: Boolean read FShowAcceleratorChar write SetShowAcceleratorChar default True;\r\n    property TextQuality: TTMSFNCGraphicsTextQuality read FTextQuality write SetTextQuality default gtqAntiAliasing;\r\n    property OnInternalMouseDown: TNotifyEvent read FOnInternalMouseDown write FOnInternalMouseDown;\r\n    property OnInternalMouseUp: TNotifyEvent read FOnInternalMouseUp write FOnInternalMouseUp;\r\n    property OnInternalMouseMove: TNotifyEvent read FOnInternalMouseMove write FOnInternalMouseMove;\r\n    property OnInternalDblClick: TNotifyEvent read FOnInternalDblClick write FOnInternalDblClick;\r\n    {$IFDEF FNCLIB}\r\n    property ShortCutHint: string read GetShortCutHint write SetShortCutHint;\r\n    {$ENDIF}\r\n    property AllowGetChildren: Boolean read FAllowGetChildren write FAllowGetChildren default False;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    property AllowFocus: Boolean read GetAllowFocus write SetAllowFocus default True;\r\n    property ControlAlignment: TTMSFNCControlAlignment read GetControlAlignment write SetControlAlignment default caNone;\r\n    procedure SetControlMargins(ALeft, ATop, ARight, ABottom: Single);\r\n    procedure GetControlMargins(var ALeft, ATop, ARight, ABottom: Single);\r\n  end;\r\n\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCCustomControlBase = class(TTMSFNCCustomControlBaseCommon)\r\n  private\r\n    FStyleChangedId: Integer;\r\n    function GetL: Single;\r\n    function GetT: Single;\r\n    procedure SetTop(const Value: Single);\r\n    procedure SetLeft(const Value: Single);\r\n  protected\r\n    procedure StyleChangedHandler(const Sender: TObject; const Msg: TMessage); virtual;\r\n    procedure DoMouseEnter; override;\r\n    procedure DoMouseLeave; override;\r\n    procedure DragOver(const Data: TDragObject; const Point: TPointF; var Operation: TDragOperation); override;\r\n    procedure DragDrop(const Data: TDragObject; const Point: TPointF); override;\r\n    procedure MouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure MouseMove(Shift: TShiftState; X, Y: Single); override;\r\n    procedure MouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure KeyDown(var Key: Word; var KeyChar: WideChar; Shift: TShiftState); override;\r\n    procedure KeyUp(var Key: Word; var KeyChar: WideChar; Shift: TShiftState); override;\r\n    procedure DialogKey(var Key: Word; Shift: TShiftState); override;\r\n    procedure MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); override;\r\n    procedure DblClick; override;\r\n    {$WARNINGS OFF}\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION < 30}\r\n    function GetHintString: String; virtual;\r\n    function HasHint: Boolean; virtual;\r\n    {$IFEND}\r\n    {$IF COMPILERVERSION = 28}\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n    {$IFEND}\r\n    {$WARNINGS ON}\r\n    {$HINTS ON}\r\n  public\r\n    property Left: Single read GetL write SetLeft;\r\n    property Top: Single read GetT write SetTop;\r\n    procedure Invalidate; virtual;\r\n    procedure SetNewScene(AScene: IScene); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCCustomControlBase = class(TTMSFNCCustomControlBaseCommon)\r\n  private\r\n    FStored: Boolean;\r\n    FHitTest: Boolean;\r\n    {$IFDEF VCLLIB}\r\n    procedure WMGetDlgCode(var Message: TWMGetDlgCode); message WM_GETDLGCODE;\r\n    procedure WMMouseWheel(var Message: TWMMouseWheel); message WM_MOUSEWHEEL;\r\n    procedure WMEraseBkGnd(var Message: TWMEraseBkGnd); message WM_ERASEBKGND;\r\n    procedure WMPaint(var Message: TWMPaint); message WM_PAINT;\r\n    procedure CMMouseLeave(var Message: TMessage); message CM_MOUSELEAVE;\r\n    procedure CMMouseEnter(var Message: TMessage); message CM_MOUSEENTER;\r\n    procedure CMFocusChanged(var Message: TCMFocusChanged); message CM_FOCUSCHANGED;\r\n    procedure CMHintShow(var Message: TMessage); message CM_HINTSHOW;\r\n    procedure WMNCHitTest(var Message: TWMNCHitTest); message WM_NCHITTEST;\r\n    procedure CMStyleChanged(var Message: TMessage); message CM_STYLECHANGED;\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    procedure WMGetDlgCode(var {%H-}Message: TLMNoParams); message LM_GETDLGCODE;\r\n    procedure WMEraseBkGnd(var {%H-}Message: TLMEraseBkGnd); message LM_ERASEBKGND;\r\n    procedure WMPaint(var {%H-}Message: TLMPaint); message LM_PAINT;\r\n    procedure WMMouseWheel(var {%H-}Message: TLMMouseEvent); message LM_MOUSEWHEEL;\r\n    procedure CMMouseLeave(var {%H-}Message: TLMNoParams); message CM_MOUSELEAVE;\r\n    procedure CMMouseEnter(var {%H-}Message: TLMNoParams); message CM_MOUSEENTER;\r\n    procedure CMFocusChanged(var {%H-}Message: TLMessage); message CM_FOCUSCHANGED;\r\n    procedure CMHintShow(var {%H-}Message: TLMessage); message CM_HINTSHOW;\r\n    procedure WMNCHitTest(var Message: TLMessage) ; message LM_NCHITTEST;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    procedure MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); override;\r\n    procedure DoMouseLeave; override;\r\n    procedure DoMouseEnter; override;\r\n    {$ENDIF}\r\n  protected\r\n    function GetHintString: String; virtual;\r\n    function HasHint: Boolean; virtual;\r\n    procedure MouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Integer); override;\r\n    procedure MouseMove(Shift: TShiftState; X, Y: Integer); override;\r\n    procedure MouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Integer); override;\r\n    procedure DragOver(Source: TObject; X, Y: Integer; State: TDragState; var Accept: Boolean); override;\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure KeyPress(var Key: Char); override;\r\n    procedure KeyUp(var Key: Word; Shift: TShiftState); override;\r\n    procedure DblClick; override;\r\n    {$IFDEF VCLLIB}\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 30}\r\n    procedure ChangeScale(M, D: Integer; isDpiChange: Boolean); override;\r\n    {$ELSE}\r\n    procedure ChangeScale(M, D: Integer); override;\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    {$ENDIF}\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    {$IFDEF WEBLIB}\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    procedure BeginUpdate; virtual;\r\n    procedure EndUpdate; virtual;\r\n    {$ENDIF}\r\n    procedure DragDrop(Source: TObject; X, Y: Integer); override;\r\n    function CanFocus: Boolean; override;\r\n    function LocalRect: TRectF; virtual;\r\n    property Stored: Boolean read FStored write FStored default True;\r\n    property HitTest: Boolean read FHitTest write FHitTest default True;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCCustomControlBeforeDrawEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCCustomControlAfterDrawEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF) of object;\r\n  TTMSFNCCustomControlCanSavePropertyEvent = procedure(Sender: TObject; AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanSave: Boolean) of object;\r\n  TTMSFNCCustomControlCanLoadPropertyEvent = procedure(Sender: TObject; AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanLoad: Boolean) of object;\r\n\r\n  TTMSFNCCustomControl = class(TTMSFNCCustomControlBase, ITMSFNCGraphicsExport{$IFNDEF WEBLIB}, ITMSFNCPersistence{$ENDIF})\r\n  private\r\n    {$IFDEF WEBLIB}\r\n    FBlockInvalidate: Boolean;\r\n    FPopupMenu: TPopupMenu;\r\n    {$ENDIF}\r\n    FOnBeforeDraw: TTMSFNCCustomControlBeforeDrawEvent;\r\n    FOnAfterDraw: TTMSFNCCustomControlAfterDrawEvent;\r\n    FOnCanSaveProperty: TTMSFNCCustomControlCanSavePropertyEvent;\r\n    FOnCanLoadProperty: TTMSFNCCustomControlCanLoadPropertyEvent;\r\n    {$IFDEF FMXLIB}\r\n    FColor: TTMSFNCGraphicsColor;\r\n    {$ENDIF}\r\n    FCheckedChk, FUnCheckedChk, FCheckedFocusChk, FUnCheckedFocusChk, FCheckedDisabledChk, FUnCheckedDisabledChk: TTMSFNCBitmap;\r\n    FCheckedRd, FUnCheckedRd, FCheckedFocusRd, FUnCheckedFocusRd, FCheckedDisabledRd, FUnCheckedDisabledRd: TTMSFNCBitmap;\r\n    FDownBtn, FNormalBtn, FDownFocusBtn, FNormalFocusBtn, FNormalDisabledBtn: TTMSFNCBitmap;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FDataPointer: Pointer;\r\n    FDataBoolean: Boolean;\r\n    FDataString: String;\r\n    FDataObject: TObject;\r\n    FDataInteger: NativeInt;\r\n    {$IFNDEF WEBLIB}\r\n    FUndoManager: TTMSFNCUndoManager;\r\n    function GetUndoManager: TTMSFNCUndoManager;\r\n    {$ENDIF}\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    {$IFDEF FMXLIB}\r\n    procedure SetColor(const Value: TTMSFNCGraphicsColor);\r\n    {$ENDIF}\r\n  protected\r\n    {$IFDEF WEBLIB}\r\n    class function GetVersionNumber(AMaj, AMin, ARel, ABld: ShortInt): string;\r\n    {$ENDIF}\r\n    function CanSaveProperty({%H-}AObject: TObject; {%H-}APropertyName: string; {%H-}APropertyType: TTypeKind): Boolean; virtual;\r\n    function CanLoadProperty({%H-}AObject: TObject; {%H-}APropertyName: string; {%H-}APropertyType: TTypeKind): Boolean; virtual;\r\n    function GetVersion: string; override;\r\n    function LocalToScreenEx(APoint: TPointF): TPointF; virtual;\r\n    function ScreenToLocalEx(APoint: TPointF): TPointF; virtual;\r\n    function GetContentRect: TRectF; virtual;\r\n    function GetControlRect: TRectF; virtual;\r\n    {$IFDEF WEBLIB}\r\n    procedure SetColor(AValue: TColor); override;\r\n    {$ENDIF}\r\n    procedure RegisterRuntimeClasses; virtual;\r\n    procedure &Export({%H-}AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF); virtual;\r\n    procedure ApplyStyle; override;\r\n    procedure ResetToDefaultStyle; override;\r\n    procedure DestroyGraphicElements; override;\r\n    {$IFDEF FMXLIB}\r\n    procedure TurnOffAnimation(chk: TFmxObject); virtual;\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    procedure DoSetBounds(ALeft, ATop, AWidth, AHeight: Integer); override;\r\n    {$ENDIF}\r\n    procedure UpdateControlAfterResize; virtual;\r\n    procedure CreateCheckBoxBitmaps; virtual;\r\n    procedure CreateRadioButtonBitmaps; virtual;\r\n    procedure CreateButtonBitmaps(AWidth, AHeight: Single); virtual;\r\n    procedure DoBeforeDraw(AGraphics: TTMSFNCGraphics; ARect: TRectF; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDraw(AGraphics: TTMSFNCGraphics; ARect: TRectF); virtual;\r\n    procedure DoCanSaveProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanSave: Boolean); virtual;\r\n    procedure DoCanLoadProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanLoad: Boolean); virtual;\r\n    procedure DrawBackground(AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF); virtual;\r\n    procedure StrokeChanged(Sender: TObject);\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure Draw({%H-}AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF); virtual;\r\n    procedure DrawControl; virtual;\r\n    procedure DoBitmapChanged(Sender: TObject);\r\n    {$IFDEF DRAWTRIAL}\r\n    {$IFDEF FREEWARE}\r\n    procedure DrawTrial(AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF); virtual;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    procedure CaptureEx; virtual;\r\n    procedure ReleaseCaptureEx; virtual;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetCheckBoxBitmap(AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True): TTMSFNCBitmap; virtual;\r\n    function GetRadioButtonBitmap(AChecked: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True): TTMSFNCBitmap; virtual;\r\n    function GetButtonBitmap(AWidth, AHeight: Single; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True): TTMSFNCBitmap; virtual;\r\n    function IsDesignTime: Boolean; virtual;\r\n    function IsLoading: Boolean; virtual;\r\n    function IsReading: Boolean; virtual;\r\n    function IsDesigning: Boolean; virtual;\r\n    function IsDesignerForm: Boolean; virtual;\r\n    function IsDestroying: Boolean; virtual;\r\n    {$IFNDEF WEBLIB}\r\n    procedure SaveSettingsToFile(AFileName: string); virtual;\r\n    procedure LoadSettingsFromFile(AFileName: string); virtual;\r\n    procedure SaveSettingsToStream(AStream: TStream); virtual;\r\n    procedure LoadSettingsFromStream(AStream: TStream); virtual;\r\n    {$ENDIF}\r\n    procedure DisableBackground;\r\n    procedure EnableBackground;\r\n    procedure DisableFill;\r\n    procedure EnableFill;\r\n    procedure DisableStroke;\r\n    procedure EnableStroke;\r\n    procedure Resize; override;\r\n    procedure Paint; override;\r\n    property DataPointer: Pointer read FDataPointer write FDataPointer;\r\n    property DataBoolean: Boolean read FDataBoolean write FDataBoolean;\r\n    property DataObject: TObject read FDataObject write FDataObject;\r\n    property DataString: String read FDataString write FDataString;\r\n    property DataInteger: NativeInt read FDataInteger write FDataInteger;\r\n    {$IFNDEF WEBLIB}\r\n    property UndoManager: TTMSFNCUndoManager read GetUndoManager;\r\n    {$ENDIF}\r\n  published\r\n    property AdaptToStyle;\r\n    property AllowFocus default True;\r\n    {$IFDEF FMXLIB}\r\n    property Hint;\r\n    property ShowHint;\r\n    property Color: TTMSFNCGraphicsColor read FColor write SetColor default gcWhite;\r\n    property Align;\r\n    property CanParentFocus;\r\n    property ClipChildren default True;\r\n    property ClipParent default False;\r\n    property DisableFocusEffect default True;\r\n    property DragMode default TDragMode.dmManual;\r\n    property EnableDragHighlight default True;\r\n    property Enabled default True;\r\n    property Height;\r\n    property HitTest default True;\r\n    property Locked default False;\r\n    property Padding;\r\n    property Opacity;\r\n    property Margins;\r\n    property PopupMenu;\r\n    property Position;\r\n    property RotationAngle;\r\n    property RotationCenter;\r\n    property Scale;\r\n    {$WARNINGS OFF}\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 27}\r\n    property Size;\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    {$WARNINGS ON}\r\n    property TabOrder;\r\n    property TabStop default True;\r\n    property TouchTargetExpansion;\r\n    property Visible default True;\r\n    property Width;\r\n    property OnApplyStyleLookup;\r\n    property OnDragEnter;\r\n    property OnDragLeave;\r\n    property OnDragOver;\r\n    property OnDragDrop;\r\n    property OnDragEnd;\r\n    property OnKeyDown;\r\n    property OnKeyUp;\r\n    property OnCanFocus;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnMouseDown;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n    property OnMouseWheel;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnResize;\r\n    {$ENDIF}\r\n\r\n    {$IFDEF CMNLIB}\r\n    property Align;\r\n    {$IFDEF LCLLIB}\r\n    property BorderSpacing;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    property BevelEdges;\r\n    property BevelInner;\r\n    property BevelKind;\r\n    property BevelOuter;\r\n    property BevelWidth;\r\n    property Ctl3D;\r\n    property ParentCtl3D;\r\n    property ParentDoubleBuffered;\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 23}\r\n    property StyleElements;\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    property Touch;\r\n    property OnGesture;\r\n    property OnMouseActivate;\r\n    {$ENDIF}\r\n    property Anchors;\r\n    property BiDiMode;\r\n    property Color default gcWhite;\r\n    property Constraints;\r\n    property DoubleBuffered;\r\n    property DragCursor;\r\n    property DragKind;\r\n    property DragMode;\r\n    property Enabled;\r\n    property Font;\r\n    property TabStop default True;\r\n    property ParentBiDiMode;\r\n    property ParentColor default False;\r\n    property ParentFont;\r\n    property ParentShowHint;\r\n    property PopupMenu;\r\n    property ShowHint;\r\n    property Hint;\r\n    property TabOrder;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnContextPopup;\r\n    property OnDblClick;\r\n    property OnDragDrop;\r\n    property OnDragOver;\r\n    property OnEndDock;\r\n    property OnEndDrag;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n    property OnMouseWheelDown;\r\n    property OnMouseWheelUp;\r\n    property OnStartDock;\r\n    property OnStartDrag;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    property Align;\r\n    property DoubleBuffered;\r\n    property Color;\r\n    property Enabled;\r\n    property Font;\r\n    property ParentDoubleBuffered;\r\n    property TabStop;\r\n    property ShowHint;\r\n    property Hint;\r\n    property TabOrder;\r\n    property Visible;\r\n    property OnClick;\r\n    property OnDblClick;\r\n    property OnEnter;\r\n    property OnExit;\r\n    property OnKeyDown;\r\n    property OnKeyPress;\r\n    property OnKeyUp;\r\n    property OnMouseDown;\r\n    property OnMouseEnter;\r\n    property OnMouseLeave;\r\n    property OnMouseMove;\r\n    property OnMouseUp;\r\n    property OnMouseWheel;\r\n    property PopupMenu: TPopupMenu read FPopupMenu write FPopupMenu;\r\n    {$ENDIF}\r\n    property ShowAcceleratorChar;\r\n    property OnBeforeDraw: TTMSFNCCustomControlBeforeDrawEvent read FOnBeforeDraw write FOnBeforeDraw;\r\n    property OnAfterDraw: TTMSFNCCustomControlAfterDrawEvent read FOnAfterDraw write FOnAfterDraw;\r\n    property OnCanSaveProperty: TTMSFNCCustomControlCanSavePropertyEvent read FOnCanSaveProperty write FOnCanSaveProperty;\r\n    property OnCanLoadProperty: TTMSFNCCustomControlCanLoadPropertyEvent read FOnCanLoadProperty write FOnCanLoadProperty;\r\n  end;\r\n\r\n  TTMSFNCCustomControlClass = class of TTMSFNCCustomControl;\r\n\r\n  TTMSFNCControl = class(TTMSFNCCustomControl)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.TMSFNCUtils, SysUtils\r\n  {$IFNDEF LCLLIB}\r\n  ,WEBLib.StdCtrls\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Platform, FMX.Ani\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,LCLType\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,WEBLib.TMSFNCXPVS\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  {$IFNDEF FMXMOBILE}\r\n  {$IFDEF FREEWARE}\r\n  {$IFDEF MSWINDOWS}\r\n  ,System.Win.Registry, WinApi.ShellApi\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  ,MacApi.AppKit, MacApi.Foundation, MacApi.Helpers\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Objects, UIConsts\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,VCL.ExtCtrls\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\n{$IFDEF CMNLIB}\r\ntype\r\n  TWinControlProtected = class(TWinControl);\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNLIB}\r\nfunction CreateShiftStateEx: TShiftState;\r\nbegin\r\n  Result := [];\r\n  if GetKeyState(VK_SHIFT) < 0 then\r\n    Include(Result, ssShift);\r\n  if GetKeyState(VK_CONTROL) < 0 then\r\n    Include(Result, ssCtrl);\r\n  if GetKeyState(VK_MENU) < 0 then\r\n    Include(Result, ssAlt);\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCCustomControlBaseCommon }\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  FAdaptToStyle := Value;\r\n  InitializeStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.ChangeDPIScale(M, D: Integer);\r\nbegin\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetAdaptToStyle: Boolean;\r\nbegin\r\n  Result := FAdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.ApplyStyle;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.ResetToDefaultStyle;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetDefaultGraphicColors;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundFillColor(c) then\r\n    TTMSFNCGraphics.DefaultPopupFillColor := c\r\n  else\r\n    TTMSFNCGraphics.DefaultPopupFillColor := gcWhite;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundStrokeColor(c) then\r\n    TTMSFNCGraphics.DefaultPopupStrokeColor := c\r\n  else\r\n    TTMSFNCGraphics.DefaultPopupStrokeColor := gcSilver;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleDefaultButtonFillColor(c) then\r\n    TTMSFNCGraphics.DefaultButtonFillColor := c\r\n  else\r\n    TTMSFNCGraphics.DefaultButtonFillColor := MakeGraphicsColor(225, 225, 225);\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleLineFillColor(c) then\r\n    TTMSFNCGraphics.DefaultButtonStrokeColor := c\r\n  else\r\n    TTMSFNCGraphics.DefaultButtonStrokeColor := gcDarkgray;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleTextFontColor(c) then\r\n    TTMSFNCGraphics.DefaultTextFontColor := c\r\n  else\r\n    TTMSFNCGraphics.DefaultTextFontColor := gcBlack;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleSelectionFillColor(c) then\r\n  begin\r\n    TTMSFNCGraphics.DefaultSelectionFillColor := c;\r\n    TTMSFNCGraphics.DefaultButtonFillColorFocused := Blend(c, TTMSFNCGraphics.DefaultButtonFillColor, 25);\r\n    TTMSFNCGraphics.DefaultButtonStrokeColorFocused := Blend(c, TTMSFNCGraphics.DefaultButtonStrokeColor, 30);\r\n  end\r\n  else\r\n  begin\r\n    TTMSFNCGraphics.DefaultSelectionFillColor := gcBlack;\r\n    TTMSFNCGraphics.DefaultButtonFillColorFocused := MakeGraphicsColor(229, 241, 251);\r\n    TTMSFNCGraphics.DefaultButtonStrokeColorFocused := MakeGraphicsColor(60, 127, 177);\r\n  end;\r\n\r\n  TTMSFNCGraphics.DefaultButtonStrokeColorDisabled := gcDarkGray;\r\n  TTMSFNCGraphics.DefaultButtonFillColorDisabled := gcLightgray;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.InitializeStyle;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCStyles.SetActiveScene(Scene);\r\n  {$ENDIF}\r\n  SetDefaultGraphicColors;\r\n  DestroyGraphicElements;\r\n  if AdaptToStyle then\r\n  begin\r\n    FAdaptedToStyle := True;\r\n    ApplyStyle;\r\n  end\r\n  else if FAdaptedToStyle then\r\n  begin\r\n    ResetToDefaultStyle;\r\n    FAdaptedToStyle := False;\r\n  end;\r\n\r\n  Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetVersion: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetDocURL: string;\r\nbegin\r\n  Result := TTMSFNCBaseDocURL;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetTipsURL: string;\r\nbegin\r\n  Result := TTMSFNCBaseTipsURL;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetClientMousePos: TPointF;\r\nbegin\r\n  Result := ConvertScreenToClient(TTMSFNCUtils.GetMousePos);\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.ConvertClientToScreen(APoint: TPointF): TPointF;\r\nvar\r\n  p: TPoint;\r\nbegin\r\n  p := ClientToScreen(Point(Round(APoint.X), Round(APoint.Y)));\r\n  Result := PointF(p.X, p.Y);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.ConvertClientToScreen(APoint: TPointF): TPointF;\r\nbegin\r\n  Result := LocalToScreen(APoint);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNWEBLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.ConvertScreenToClient(APoint: TPointF): TPointF;\r\nvar\r\n  p: TPoint;\r\nbegin\r\n  p := ScreenToClient(Point(Round(APoint.X), Round(APoint.Y)));\r\n  Result := PointF(p.X, p.Y);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.ConvertScreenToClient(APoint: TPointF): TPointF;\r\nbegin\r\n  Result := ScreenToLocal(APoint);\r\nend;\r\n{$ENDIF}\r\n\r\nconstructor TTMSFNCCustomControlBaseCommon.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  {$IFDEF FNCLIB}\r\n  {$IFNDEF WEBLIB}\r\n  FShortCutWindowList := TTMSFNCCustomControlShortCutWindowList.Create;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  SetDefaultGraphicColors;\r\n  FAdaptToStyle := False;\r\n  FAdaptedToStyle := False;\r\n  FTransparent := False;\r\n  FNativeCanvas := False;\r\n  FBufferedPainting := False;\r\n  FAntiAliasing := True;\r\n  FOptimizedHTMLDrawing := True;\r\n  FShowAcceleratorChar := True;\r\n  FTextQuality := gtqAntiAliasing;\r\n  {$IFDEF CMNWEBLIB}\r\n  FAllowFocus := True;\r\n  {$ENDIF}\r\nend;\r\n\r\ndestructor TTMSFNCCustomControlBaseCommon.Destroy;\r\nbegin\r\n  {$IFDEF FNCLIB}\r\n  {$IFNDEF WEBLIB}\r\n  CancelShortCutHint;\r\n  FShortCutWindowList.Free;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetAllowFocus: Boolean;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := CanFocus;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := FAllowFocus;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetAllowFocus(const Value: Boolean);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  CanFocus := Value;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  FAllowFocus := Value;\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF FNCLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.GetShortCutHint: string;\r\nbegin\r\n  Result := FShortCutHint;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetShortCutHint(const Value: string);\r\nbegin\r\n  FShortCutHint := Value;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nfunction TTMSFNCCustomControlBaseCommon.IsShortCutHintActive: Boolean;\r\nbegin\r\n  Result := FShortCutWindowList.Count > 0;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.CancelShortCutHint(AClearShortCutHintString: Boolean = True);\r\nbegin\r\n  FShortCutWindowList.Clear;\r\n  if AClearShortCutHintString then\r\n    FShortCutLimitation := '';\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.CustomizeShortCut(AShortCutWindow: TTMSFNCHint; AShortCut: string; AShortCutRect: TRectF; var AShortCutPosition: TPointF);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.GetShortCutHints(AShortCutHints: TStringList);\r\nbegin\r\n  AShortCutHints.Add(ShortCutHint);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.ShowShortCutHint;\r\nvar\r\n  pt: TPointF;\r\n  r: TRect;\r\n  I: Integer;\r\n  h: TTMSFNCHint;\r\n  s: string;\r\n  l: TStringList;\r\nbegin\r\n  CancelShortCutHint(False);\r\n  l := TStringList.Create;\r\n  try\r\n    GetShortCutHints(l);\r\n\r\n    for I := 0 to l.Count - 1 do\r\n    begin\r\n      s := l[I];\r\n      if (s <> '') and ((Pos(FShortCutLimitation, s) > 0) or (FShortCutLimitation = '')) then\r\n      begin\r\n        h := TTMSFNCHint.Create(Self);\r\n        r := h.Calculate(s);\r\n        pt := PointF((Width - (r.Right - r.Left)) / 2, Height - (r.Bottom - r.Top) / 2);\r\n        CustomizeShortCut(h, s, ConvertToRectF(r), pt);\r\n        pt := ConvertClientToScreen(pt);\r\n        h.ShowHintAt(s, Round(pt.X), Round(pt.Y));\r\n        FShortCutWindowList.Add(h);\r\n      end;\r\n    end;\r\n  finally\r\n    l.Free;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.ExecuteShortCutMethod(AShortCut: String): Boolean;\r\nbegin\r\n  Result := False;\r\n  if AShortCut = ShortCutHint then\r\n  begin\r\n    Click;\r\n    Result := True;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.HasShortCut(AShortCut: string): Boolean;\r\nvar\r\n  sl: TStringList;\r\n  i: Integer;\r\n  s: string;\r\nbegin\r\n  Result := False;\r\n  sl := TStringList.Create;\r\n  try\r\n    GetShortCutHints(sl);\r\n    for I := 0 to sl.Count - 1 do\r\n    begin\r\n      s := sl[I];\r\n      if (s <> '') and ((Pos(AShortCut, s) = 1) or (AShortCut = '')) then\r\n      begin\r\n        Result := True;\r\n        Break;\r\n      end;\r\n    end;\r\n  finally\r\n    sl.Free;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.HandleShortCut(AShortcut: string): Boolean;\r\nvar\r\n  sl: TStringList;\r\n  s: string;\r\n  I: Integer;\r\n  b: Boolean;\r\nbegin\r\n  Result := ExecuteShortCutMethod(AShortCut);\r\n  if Result then\r\n  begin\r\n    CancelShortCutHint;\r\n    FShortCutLimitation := '';\r\n  end\r\n  else\r\n  begin\r\n    FShortCutLimitation := AShortCut;\r\n    sl := TStringList.Create;\r\n    try\r\n      GetShortCutHints(sl);\r\n      b := False;\r\n      for I := 0 to sl.Count - 1 do\r\n      begin\r\n        s := sl[I];\r\n        if (s <> '') and ((Pos(FShortCutLimitation, s) = 1) or (FShortCutLimitation = '')) then\r\n        begin\r\n          b := True;\r\n          Break;\r\n        end;\r\n      end;\r\n\r\n      if b then\r\n        ShowShortCutHint\r\n      else\r\n        CancelShortCutHint;\r\n    finally\r\n      sl.Free;\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetTextQuality(const Value: TTMSFNCGraphicsTextQuality);\r\nbegin\r\n  if FTextQuality <> Value then\r\n  begin\r\n    FTextQuality := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetNativeCanvas(const Value: Boolean);\r\nbegin\r\n  if FNativeCanvas <> Value then\r\n  begin\r\n    FNativeCanvas := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetAntiAliasing(const Value: Boolean);\r\nbegin\r\n  if FAntiAliasing <> Value then\r\n  begin\r\n    FAntiAliasing := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetOptimizedHTMLDrawing(const Value: Boolean);\r\nbegin\r\n  if FOptimizedHTMLDrawing <> Value then\r\n  begin\r\n    FOptimizedHTMLDrawing := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetShowAcceleratorChar(const Value: Boolean);\r\nbegin\r\n  if FShowAcceleratorChar <> Value then\r\n  begin\r\n    FShowAcceleratorChar := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetControlAlignment: TTMSFNCControlAlignment;\r\nbegin\r\n  Result := caNone;\r\n  {$IFDEF FMXLIB}\r\n  case Align of\r\n    TAlignLayout.None: Result := caNone;\r\n    TAlignLayout.Top: Result := caTop;\r\n    TAlignLayout.Bottom: Result := caBottom;\r\n    TAlignLayout.Left: Result := caLeft;\r\n    TAlignLayout.Right: Result := caRight;\r\n    TAlignLayout.Client: Result := caClient;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  case Align of\r\n    alNone: Result := caNone;\r\n    alTop: Result := caTop;\r\n    alBottom: Result := caBottom;\r\n    alLeft: Result := caLeft;\r\n    alRight: Result := caRight;\r\n    alClient: Result := caClient;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetControlAlignment(const Value: TTMSFNCControlAlignment);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  case Value of\r\n    caNone: Align := TAlignLayout.None;\r\n    caTop: Align := TAlignLayout.Top;\r\n    caBottom: Align := TAlignLayout.Bottom;\r\n    caLeft: Align := TAlignLayout.Left;\r\n    caRight: Align := TAlignLayout.Right;\r\n    caClient: Align := TAlignLayout.Client;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  case Value of\r\n    caNone: Align := alNone;\r\n    caTop: Align := alTop;\r\n    caBottom: Align := alBottom;\r\n    caLeft: Align := alLeft;\r\n    caRight: Align := alRight;\r\n    caClient: Align := alClient;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseLeave;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseEnter;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X: Single; Y: Single);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseMove(Shift: TShiftState; X: Single; Y: Single);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleDblClick(X: Single; Y: Single);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleDragOver(const Source: TObject; const Point: TPointF; var Accept: Boolean);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleDragDrop(const Source: TObject; const Point: TPointF);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X: Single; Y: Single);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleKeyPress(var Key: Char);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleKeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleDialogKey(var Key: Word; Shift: TShiftState);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleKeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.HandleMouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean);\r\nbegin\r\n\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomControlBase.StyleChangedHandler(const Sender: TObject; const Msg: TMessage);\r\nbegin\r\n  InitializeStyle;\r\nend;\r\n\r\nconstructor TTMSFNCCustomControlBase.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FStyleChangedId := TMessageManager.DefaultManager.SubscribeToMessage(TStyleChangedMessage, StyleChangedHandler);\r\nend;\r\n\r\ndestructor TTMSFNCCustomControlBase.Destroy;\r\nvar\r\n  frm: TCustomForm;\r\nbegin\r\n  frm := TTMSFNCUtils.GetOwnerForm(Self);\r\n  if Assigned(frm) and (csDestroying in frm.ComponentState) then\r\n    TTMSFNCStyles.SetActiveScene(nil);\r\n\r\n  TMessageManager.DefaultManager.Unsubscribe(TStyleChangedMessage, FStyleChangedId);\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.Invalidate;\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\n{$WARNINGS OFF}\r\n{$HINTS OFF}\r\n{$IF COMPILERVERSION < 30}\r\nfunction TTMSFNCCustomControlBase.GetHintString: String;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBase.HasHint: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n{$IFEND}\r\n{$HINTS ON}\r\n{$WARNINGS ON}\r\n\r\nfunction TTMSFNCCustomControlBase.GetL: Single;\r\nbegin\r\n  Result := Position.X;\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBase.GetT: Single;\r\nbegin\r\n  Result := Position.Y;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.SetTop(const Value: Single);\r\nbegin\r\n  Position.Y := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.SetLeft(const Value: Single);\r\nbegin\r\n  Position.X := Value;\r\nend;\r\n\r\n{$WARNINGS OFF}\r\n{$HINTS OFF}\r\n{$IF COMPILERVERSION = 28}\r\nprocedure TTMSFNCCustomControlBase.BeginUpdate;\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.EndUpdate;\r\nbegin\r\nend;\r\n{$IFEND}\r\n{$HINTS ON}\r\n{$WARNINGS ON}\r\n\r\nprocedure TTMSFNCCustomControlBase.KeyDown(var Key: Word; var KeyChar: WideChar;\r\n  Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if KeyChar = ' ' then\r\n    Key := KEY_SPACE;\r\n\r\n  HandleKeyPress(KeyChar);\r\n  HandleKeyDown(Key, Shift);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.KeyUp(var Key: Word; var KeyChar: WideChar;\r\n  Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if KeyChar = ' ' then\r\n    Key := KEY_SPACE;\r\n\r\n  HandleKeyUp(Key, Shift);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DialogKey(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  HandleDialogKey(Key, Shift);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DragOver(const Data: TDragObject; const Point: TPointF; var Operation: TDragOperation);\r\nvar\r\n  b: Boolean;\r\nbegin\r\n  inherited;\r\n  b := Operation = TDragOperation.Move;\r\n  HandleDragOver(Data.Source, Point, b);\r\n  if b then\r\n    Operation := TDragOperation.Move;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DragDrop(const Data: TDragObject; const Point: TPointF);\r\nbegin\r\n  inherited;\r\n  HandleDragDrop(Data.Source, Point);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X,\r\n  Y: Single);\r\nbegin\r\n  inherited;\r\n  HandleMouseDown(Button, Shift, X, Y);\r\n  if Assigned(OnInternalMouseDown) then\r\n    OnInternalMouseDown(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseMove(Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  HandleMouseMove(Shift, X, Y);\r\n  if Assigned(OnInternalMouseMove) then\r\n    OnInternalMouseMove(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X,\r\n  Y: Single);\r\nbegin\r\n  inherited;\r\n  HandleMouseUp(Button, Shift, X, Y);\r\n  if Assigned(OnInternalMouseUp) then\r\n    OnInternalMouseUp(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseWheel(Shift: TShiftState; WheelDelta: Integer;\r\n  var Handled: Boolean);\r\nbegin\r\n  inherited;\r\n  HandleMouseWheel(Shift, WheelDelta, Handled);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DoMouseEnter;\r\nbegin\r\n  inherited;\r\n  HandleMouseEnter;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.SetNewScene(AScene: IScene);\r\nbegin\r\n  inherited;\r\n  TTMSFNCStyles.SetActiveScene(AScene);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DoMouseLeave;\r\nbegin\r\n  inherited;\r\n  HandleMouseLeave;\r\nend;\r\n\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControlBase.DblClick;\r\nvar\r\n  pf: TPointF;\r\nbegin\r\n  inherited;\r\n  pf := ConvertScreenToClient(TTMSFNCUtils.GetMousePos);\r\n  HandleDblClick(pf.X, pf.Y);\r\n  if Assigned(OnInternalDblClick) then\r\n    OnInternalDblClick(Self);\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\n\r\n{$IFDEF VCLLIB}\r\n{$HINTS OFF}\r\n{$IF COMPILERVERSION > 30}\r\nprocedure TTMSFNCCustomControlBase.ChangeScale(M, D: Integer; isDpiChange: Boolean);\r\n{$ELSE}\r\nprocedure TTMSFNCCustomControlBase.ChangeScale(M, D: Integer);\r\n{$IFEND}\r\nbegin\r\n  inherited;\r\n  if not (csDesigning in ComponentState) and (M <> D) then\r\n    ChangeDPIScale(M, D);\r\nend;\r\n{$HINTS ON}\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControlBase.KeyPress(var Key: Char);\r\nbegin\r\n  inherited;\r\n  HandleKeyPress(Key);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.KeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  Ctrl: TWinControl;\r\nbegin\r\n  inherited;\r\n  HandleDialogKey(Key, Shift);\r\n  HandleKeyDown(Key, Shift);\r\n  if Key = KEY_TAB then\r\n  begin\r\n    {$IFNDEF WEBLIB}\r\n    if ssShift in Shift then\r\n      Ctrl := TWinControlProtected(Self.Parent).FindNextControl(Self, False, True, True)\r\n    else\r\n      Ctrl := TWinControlProtected(Self.Parent).FindNextControl(Self, True, True, True);\r\n\r\n    if Assigned(Ctrl) and Ctrl.CanFocus then\r\n      Ctrl.SetFocus;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.KeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  HandleKeyUp(Key, Shift);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DragOver(Source: TObject; X, Y: Integer; State: TDragState; var Accept: Boolean);\r\nbegin\r\n  inherited;\r\n  HandleDragOver(Source, PointF(X, Y), Accept);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DragDrop(Source: TObject; X, Y: Integer);\r\nbegin\r\n  inherited;\r\n  HandleDragDrop(Source, PointF(X, Y));\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  inherited;\r\n  HandleMouseDown(Button, Shift, X, Y);\r\n  if Assigned(OnInternalMouseDown) then\r\n    OnInternalMouseDown(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseMove(Shift: TShiftState; X, Y: Integer);\r\nbegin\r\n  inherited;\r\n  HandleMouseMove(Shift, X, Y);\r\n  if Assigned(OnInternalMouseMove) then\r\n    OnInternalMouseMove(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X,\r\n  Y: Integer);\r\nbegin\r\n  inherited;\r\n  HandleMouseUp(Button, Shift, X, Y);\r\n  if Assigned(OnInternalMouseUp) then\r\n    OnInternalMouseUp(Self);\r\nend;\r\n\r\n{$IFDEF VCLLIB}\r\nprocedure TTMSFNCCustomControlBase.CMHintShow(var Message: TMessage);\r\nvar\r\n  h: String;\r\nbegin\r\n  with TCMHintShow(Message).HintInfo^ do\r\n  begin\r\n    if HasHint then\r\n    begin\r\n      h := GetHintString;\r\n      HintStr := h;\r\n      ReshowTimeout := 0;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMStyleChanged(var Message: TMessage);\r\nbegin\r\n  InitializeStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMNCHitTest(var Message: TWMNCHitTest);\r\nbegin\r\n  if not HitTest then\r\n    Message.Result := HTTRANSPARENT\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMPaint(var Message: TWMPaint);\r\nbegin\r\n  if Transparent then\r\n    PaintHandler(Message)\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMEraseBkGnd(var Message: TWMEraseBkGnd);\r\nbegin\r\n  if Transparent then\r\n    Message.Result := 1\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMGetDlgCode(var Message: TWMGetDlgCode);\r\nbegin\r\n  if TabStop then\r\n    Message.result := DLGC_WANTALLKEYS or DLGC_WANTARROWS or DLGC_WANTTAB\r\n  else\r\n    Message.result := DLGC_WANTALLKEYS or DLGC_WANTARROWS;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMMouseWheel(var Message: TWMMouseWheel);\r\nvar\r\n  b: Boolean;\r\nbegin\r\n  inherited;\r\n  b := False;\r\n  HandleMouseWheel(CreateShiftStateEx, Message.WheelDelta, b);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMFocusChanged(var Message: TCMFocusChanged);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMMouseLeave(var Message: TMessage);\r\nbegin\r\n  HandleMouseLeave;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMMouseEnter(var Message: TMessage);\r\nbegin\r\n  HandleMouseEnter;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nprocedure TTMSFNCCustomControlBase.DoMouseEnter;\r\nbegin\r\n  inherited;\r\n  HandleMouseEnter;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.DoMouseLeave;\r\nbegin\r\n  inherited;\r\n  HandleMouseLeave;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.MouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean);\r\nbegin\r\n  HandleMouseWheel(Shift, WheelDelta, Handled);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF LCLLIB}\r\nprocedure TTMSFNCCustomControlBase.CMFocusChanged(var Message: TLMessage);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMMouseLeave(var Message: TLMNoParams);\r\nbegin\r\n  HandleMouseLeave;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMMouseEnter(var Message: TLMNoParams);\r\nbegin\r\n  HandleMouseEnter;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.CMHintShow(var Message: TLMessage);\r\nvar\r\n  h: String;\r\nbegin\r\n  with TCMHintShow(Message).HintInfo^ do\r\n  begin\r\n    if HasHint then\r\n    begin\r\n      h := GetHintString;\r\n      HintStr := h;\r\n      ReshowTimeout := 0;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMNCHitTest(var Message: TLMessage);\r\nbegin\r\n  if not HitTest then\r\n    Message.Result := HTTRANSPARENT\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMPaint(var Message: TLMPaint);\r\nbegin\r\n  if Transparent then\r\n    PaintHandler(Message)\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMEraseBkGnd(var Message: TLMEraseBkGnd);\r\nbegin\r\n  if Transparent then\r\n    Message.Result := 1\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMGetDlgCode(var Message: TLMNoParams);\r\nbegin\r\n  if TabStop then\r\n    Message.result := DLGC_WANTALLKEYS or DLGC_WANTARROWS or DLGC_WANTTAB\r\n  else\r\n    Message.result := DLGC_WANTALLKEYS or DLGC_WANTARROWS;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.WMMouseWheel(var Message: TLMMouseEvent);\r\nvar\r\n  b: Boolean;\r\nbegin\r\n  inherited;\r\n  b := False;\r\n  HandleMouseWheel(CreateShiftStateEx, Message.WheelDelta, b);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomControlBase.CanFocus: Boolean;\r\nbegin\r\n  Result := inherited CanFocus;\r\n  Result := Result and AllowFocus;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.BeginUpdate;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  inherited;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBase.EndUpdate;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  inherited;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBase.LocalRect: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, Width, Height);\r\nend;\r\n\r\nconstructor TTMSFNCCustomControlBase.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FHitTest := True;\r\n  FStored := True;\r\n  {$IFNDEF WEBLIB}\r\n  DoubleBuffered := True;\r\n  {$ENDIF}\r\n  ControlStyle := ControlStyle + [csAcceptsControls];\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nclass function TTMSFNCCustomControl.GetVersionNumber(AMaj, AMin, ARel, ABld: ShortInt): string;\r\nbegin\r\n  Result := '';\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControl.DisableBackground;\r\nbegin\r\n  FFill.Kind := gfkNone;\r\n  FStroke.Kind := gskNone;\r\n  {$IFDEF CMNWEBLIB}\r\n  Color := clBtnFace;\r\n  {$IFNDEF WEBLIB}\r\n  ParentColor := False;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.EnableBackground;\r\nbegin\r\n  FFill.Kind := gfkSolid;\r\n  FStroke.Kind := gskSolid;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DisableStroke;\r\nbegin\r\n  FStroke.Kind := gskNone;\r\nend;\r\n\r\n{$IFDEF LCLLIB}\r\nprocedure TTMSFNCCustomControl.DoSetBounds(ALeft, ATop, AWidth,\r\n  AHeight: Integer);\r\nbegin\r\n  inherited DoSetBounds(ALeft, ATop, AWidth, AHeight);\r\n  UpdateControlAfterResize;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nprocedure TTMSFNCCustomControl.SetColor(AValue: TColor);\r\nbegin\r\n  inherited;\r\n  if Assigned(Fill) then\r\n    Fill.Color := AValue;\r\n  Invalidate;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomControl.SetColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColor <> Value then\r\n  begin\r\n    FColor := Value;\r\n    Fill.Color := Color;\r\n    Invalidate;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControl.Resize;\r\nbegin\r\n  inherited;\r\n  {$IFNDEF LCLLIB}\r\n  UpdateControlAfterResize;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.EnableStroke;\r\nbegin\r\n  FStroke.Kind := gskSolid;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DisableFill;\r\nbegin\r\n  FFill.Kind := gfkNone;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.EnableFill;\r\nbegin\r\n  FFill.Kind := gfkSolid;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomControl then\r\n  begin\r\n    FFill.Assign((Source as TTMSFNCCustomControl).Fill);\r\n    FStroke.Assign((Source as TTMSFNCCustomControl).Stroke);\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCCustomControl.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  {$IFDEF FMXLIB}\r\n  FColor := gcWhite;\r\n  CanFocus := True;\r\n  ClipChildren := True;\r\n  DisableFocusEffect := True;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ParentColor := False;\r\n  {$ENDIF}\r\n  Color := gcWhite;\r\n  {$ENDIF}\r\n  TabStop := True;\r\n  FFill := TTMSFNCGraphicsFill.Create;\r\n  FStroke := TTMSFNCGraphicsStroke.Create;\r\n  FFill.OnChanged := @FillChanged;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n\r\n  if not IsDesignerForm then\r\n    RegisterRuntimeClasses;\r\nend;\r\n\r\ndestructor TTMSFNCCustomControl.Destroy;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if Assigned(FUndoManager) then\r\n  begin\r\n    FUndoManager.Free;\r\n    FUndoManager := nil;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  if Assigned(FDownBtn) then\r\n  begin\r\n    FDownBtn.Free;\r\n    FDownBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalBtn) then\r\n  begin\r\n    FNormalBtn.Free;\r\n    FNormalBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FDownFocusBtn) then\r\n  begin\r\n    FDownFocusBtn.Free;\r\n    FDownFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalFocusBtn) then\r\n  begin\r\n    FNormalFocusBtn.Free;\r\n    FNormalFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalDisabledBtn) then\r\n  begin\r\n    FNormalDisabledBtn.Free;\r\n    FNormalDisabledBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedChk) then\r\n  begin\r\n    FCheckedChk.Free;\r\n    FCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedFocusChk) then\r\n  begin\r\n    FCheckedFocusChk.Free;\r\n    FCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledChk) then\r\n  begin\r\n    FUnCheckedDisabledChk.Free;\r\n    FUnCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledChk) then\r\n  begin\r\n    FCheckedDisabledChk.Free;\r\n    FCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedChk) then\r\n  begin\r\n    FUnCheckedChk.Free;\r\n    FUnCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusChk) then\r\n  begin\r\n    FUnCheckedFocusChk.Free;\r\n    FUnCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedRd) then\r\n  begin\r\n    FCheckedRd.Free;\r\n    FCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedFocusRd) then\r\n  begin\r\n    FCheckedFocusRd.Free;\r\n    FCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedRd) then\r\n  begin\r\n    FUnCheckedRd.Free;\r\n    FUnCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusRd) then\r\n  begin\r\n    FUnCheckedFocusRd.Free;\r\n    FUnCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledRd) then\r\n  begin\r\n    FUnCheckedDisabledRd.Free;\r\n    FUnCheckedDisabledRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledRd) then\r\n  begin\r\n    FCheckedDisabledRd.Free;\r\n    FCheckedDisabledRd := nil;\r\n  end;\r\n\r\n  FFill.Free;\r\n  FStroke.Free;\r\n\r\n  inherited;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nfunction TTMSFNCCustomControl.GetUndoManager: TTMSFNCUndoManager;\r\nbegin\r\n  if not Assigned(FUndoManager) then\r\n    FUndoManager := TTMSFNCUndoManager.Create(Self);\r\n\r\n  Result := FUndoManager;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControl.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.SetStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DoCanSaveProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanSave: Boolean);\r\nbegin\r\n  if Assigned(OnCanSaveProperty) then\r\n    OnCanSaveProperty(Self, AObject, APropertyName, APropertyType, ACanSave);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DoCanLoadProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind; var ACanLoad: Boolean);\r\nbegin\r\n  if Assigned(OnCanLoadProperty) then\r\n    OnCanLoadProperty(Self, AObject, APropertyName, APropertyType, ACanLoad);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DoBeforeDraw(AGraphics: TTMSFNCGraphics; ARect: TRectF; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDraw) then\r\n    OnBeforeDraw(Self, AGraphics, ARect, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DoAfterDraw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nbegin\r\n  if Assigned(OnAfterDraw) then\r\n    OnAfterDraw(Self, AGraphics, ARect);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DrawBackground(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nbegin\r\n  AGraphics.Fill.Assign(Fill);\r\n  AGraphics.Fill.Color := Color;\r\n  AGraphics.Stroke.Assign(Stroke);\r\n  AGraphics.DrawRectangle(ARect);\r\nend;\r\n\r\n{$IFDEF DRAWTRIAL}\r\n{$IFDEF FREEWARE}\r\nprocedure TTMSFNCCustomControl.DrawTrial(AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF);\r\nvar\r\n  s: String;\r\nbegin\r\n  if not (Parent is TTMSFNCCustomControl) then\r\n  begin\r\n    InflateRectEx(ARect, -5, -5);\r\n    AGraphics.Font.Color := gcRed;\r\n    TTMSFNCUtils.SetFontSize(AGraphics.Font, 10);\r\n    s := ClassName + ' Trial ' + GetVersion;\r\n    AGraphics.DrawText(ARect, s, False, gtaTrailing, gtaTrailing);\r\n  end;\r\nend;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControl.DrawControl;\r\nvar\r\n  g, gbmp: TTMSFNCGraphics;\r\n  r: TRectF;\r\n  df: Boolean;\r\n  bmp: TTMSFNCDrawBitmap;\r\n  {$IFDEF FMXLIB}\r\n  sc: Single;\r\n  {$ENDIF}\r\nbegin\r\n  if BufferedPainting then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    sc := TTMSFNCUtils.GetDPIScale;\r\n    g := TTMSFNCGraphics.CreateBitmapCanvas(Round(Width * sc), Round(Height * sc), NativeCanvas);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    g := TTMSFNCGraphics.CreateBitmapCanvas(Width, Height, NativeCanvas);\r\n    {$ENDIF}\r\n    g.BeginScene;\r\n  end\r\n  else\r\n    g := TTMSFNCGraphics.Create(Canvas, NativeCanvas);\r\n\r\n  g.OptimizedHTMLDrawing := OptimizedHTMLDrawing;\r\n  g.Context.SetSize(Width, Height);\r\n  g.Context.SetAntiAliasing(AntiAliasing);\r\n  g.Context.SetShowAcceleratorChar(ShowAcceleratorChar);\r\n  g.Context.SetTextQuality(TextQuality);\r\n  try\r\n    r := RectF(0, 0, Width, Height);\r\n    df := True;\r\n    DoBeforeDraw(g, r, df);\r\n    if df then\r\n    begin\r\n      DrawBackground(g, r);\r\n      Draw(g, r);\r\n      DoAfterDraw(g, r);\r\n    end;\r\n    {$IFDEF DRAWTRIAL}\r\n    {$IFDEF FREEWARE}\r\n    DrawTrial(g, r);\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    if BufferedPainting then\r\n      g.EndScene;\r\n\r\n    g.Context.Render;\r\n\r\n    if BufferedPainting then\r\n    begin\r\n      bmp := TTMSFNCDrawBitmap(g.Bitmap);\r\n      gbmp := TTMSFNCGraphics.Create(Canvas, False);\r\n      try\r\n        gbmp.Context.SetSize(Width, Height);\r\n        gbmp.Context.SetAntiAliasing(AntiAliasing);\r\n        gbmp.Context.SetShowAcceleratorChar(ShowAcceleratorChar);\r\n        gbmp.Context.SetTextQuality(TextQuality);\r\n        gbmp.DrawBitmap(r, bmp);\r\n      finally\r\n        gbmp.Free;\r\n      end;\r\n    end;\r\n  finally\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.Paint;\r\nbegin\r\n  inherited;\r\n  DrawControl;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.StrokeChanged(Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.FillChanged(Sender: TObject);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  FColor := Fill.Color;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  if (Fill.Kind <> gfkNone) and (Fill.Color <> gcNull) then\r\n    Color := Fill.Color\r\n  else\r\n    Color := clBtnFace;\r\n  {$ENDIF}\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.UpdateControlAfterResize;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DoBitmapChanged(Sender: TObject);\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  if FBlockInvalidate then\r\n    Exit;\r\n  FBlockInvalidate := True;\r\n  Invalidate;\r\n  FBlockInvalidate := False;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.CreateCheckBoxBitmaps;\r\nvar\r\n{$IFDEF FMXLIB}\r\n  chk: TCheckBox;\r\n  f: TCommonCustomForm;\r\n  fo: IControl;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLWEBLIB}\r\n  rc: TRect;\r\n  dChecked: Cardinal;\r\n  hth: HTHEME;\r\n  ThemeStyle: DWord;\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g: TTMSFNCGraphics;\r\n  {$ENDIF}\r\n  bmp: TBitmap;\r\n{$ENDIF}\r\nbegin\r\n  if Assigned(FCheckedFocusChk) then\r\n  begin\r\n    FCheckedFocusChk.Free;\r\n    FCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedChk) then\r\n  begin\r\n    FUnCheckedChk.Free;\r\n    FUnCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedChk) then\r\n  begin\r\n    FCheckedChk.Free;\r\n    FCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusChk) then\r\n  begin\r\n    FUnCheckedFocusChk.Free;\r\n    FUnCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledChk) then\r\n  begin\r\n    FUnCheckedDisabledChk.Free;\r\n    FUnCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledChk) then\r\n  begin\r\n    FCheckedDisabledChk.Free;\r\n    FCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  {$IFDEF FMXLIB}\r\n  chk := TCheckBox.Create(Self);\r\n  chk.Width := chk.Height;\r\n  chk.Text := '';\r\n  chk.Parent := Self;\r\n  chk.IsChecked := false;\r\n  chk.NeedStyleLookup;\r\n  chk.ApplyStyleLookup;\r\n\r\n  {$IFDEF FMXMOBILE}\r\n  chk.Width := 25;\r\n  chk.Height := 25;\r\n  {$ENDIF}\r\n\r\n  TurnOffAnimation(chk);\r\n  FUnCheckedChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.IsChecked := true;\r\n  FCheckedChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.Enabled := False;\r\n  chk.IsChecked := False;\r\n  FUnCheckedDisabledChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.IsChecked := True;\r\n  FCheckedDisabledChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.Enabled := True;\r\n\r\n  f := TTMSFNCUtils.GetParentForm(Self);\r\n  fo := nil;\r\n  if Assigned(f) then\r\n    fo := f.Focused;\r\n\r\n  chk.SetFocus;\r\n  chk.IsChecked := false;\r\n  FUnCheckedFocusChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.IsChecked := true;\r\n  FCheckedFocusChk := TTMSFNCBitmap(chk.MakeScreenshot);\r\n  chk.Parent := nil;\r\n  chk.Free;\r\n\r\n  if Assigned(fo) then\r\n    fo.SetFocus;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  bmp := TBitmap.Create;\r\n  {$IFDEF VCLLIB}\r\n  rc := Bounds(0, 0, 16, 16);\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n  {$ENDIF}\r\n  try\r\n    {$IFNDEF WEBLIB}\r\n    bmp.PixelFormat := pf24bit;\r\n    bmp.TransparentMode := tmFixed;\r\n    bmp.Transparent := True;\r\n    bmp.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    bmp.SetSize(16, 16);\r\n\r\n    FUnCheckedChk := TTMSFNCBitmap.Create;\r\n    FUnCheckedChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK;\r\n    ThemeStyle := CBS_UNCHECKEDNORMAL;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), False, False, True);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedChk.Assign(bmp);\r\n\r\n    FCheckedChk := TTMSFNCBitmap.Create;\r\n    FCheckedChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK or DFCS_CHECKED;\r\n    ThemeStyle := CBS_CHECKEDNORMAL;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), True, False, True);\r\n    {$ENDIF}\r\n\r\n    FCheckedChk.Assign(bmp);\r\n\r\n    FUnCheckedFocusChk := TTMSFNCBitmap.Create;\r\n    FUnCheckedFocusChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK or DFCS_HOT;\r\n    ThemeStyle := CBS_UNCHECKEDHOT;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), False, True, True);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedFocusChk.Assign(bmp);\r\n\r\n    FCheckedFocusChk := TTMSFNCBitmap.Create;\r\n    FCheckedFocusChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK or DFCS_CHECKED or DFCS_HOT;\r\n    ThemeStyle := CBS_CHECKEDHOT;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), True, True, True);\r\n    {$ENDIF}\r\n\r\n    FCheckedFocusChk.Assign(bmp);\r\n\r\n    FUnCheckedDisabledChk := TTMSFNCBitmap.Create;\r\n    FUnCheckedDisabledChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK or DFCS_INACTIVE;\r\n    ThemeStyle := CBS_UNCHECKEDDISABLED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), False, False, False);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedDisabledChk.Assign(bmp);\r\n\r\n    FCheckedDisabledChk := TTMSFNCBitmap.Create;\r\n    FCheckedDisabledChk.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONCHECK or DFCS_CHECKED or DFCS_INACTIVE;\r\n    ThemeStyle := CBS_CHECKEDDISABLED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_CHECKBOX, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawCheckBox(RectF(0, 0, bmp.Width, bmp.Height), True, False, False);\r\n    {$ENDIF}\r\n\r\n    FCheckedDisabledChk.Assign(bmp);\r\n  finally\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Free;\r\n    {$ENDIF}\r\n    bmp.Free;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.CreateButtonBitmaps(AWidth, AHeight: Single);\r\nvar\r\n{$IFDEF FMXLIB}\r\n  btn: TButton;\r\n  f: TCommonCustomForm;\r\n  fo: IControl;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLWEBLIB}\r\n  rc: TRect;\r\n  dChecked: Cardinal;\r\n  hth: HTHEME;\r\n  ThemeStyle: DWord;\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g: TTMSFNCGraphics;\r\n  {$ENDIF}\r\n  bmp: TBitmap;\r\n{$ENDIF}\r\nbegin\r\n  if Assigned(FDownBtn) then\r\n  begin\r\n    FDownBtn.Free;\r\n    FDownBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalBtn) then\r\n  begin\r\n    FNormalBtn.Free;\r\n    FNormalBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FDownFocusBtn) then\r\n  begin\r\n    FDownFocusBtn.Free;\r\n    FDownFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalFocusBtn) then\r\n  begin\r\n    FNormalFocusBtn.Free;\r\n    FNormalFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalDisabledBtn) then\r\n  begin\r\n    FNormalDisabledBtn.Free;\r\n    FNormalDisabledBtn := nil;\r\n  end;\r\n\r\n  {$IFDEF FMXLIB}\r\n  btn := TButton.Create(Self);\r\n  btn.Width := AWidth;\r\n  btn.Height := AHeight;\r\n  btn.Text := '';\r\n  btn.Parent := Self;\r\n  btn.StaysPressed := True;\r\n  btn.IsPressed := False;\r\n  btn.NeedStyleLookup;\r\n  btn.ApplyStyleLookup;\r\n\r\n  TurnOffAnimation(btn);\r\n  FNormalBtn := TTMSFNCBitmap(btn.MakeScreenshot);\r\n  btn.IsPressed := true;\r\n  FDownBtn := TTMSFNCBitmap(btn.MakeScreenshot);\r\n  btn.Enabled := False;\r\n  btn.IsPressed := False;\r\n  FNormalDisabledBtn := TTMSFNCBitmap(btn.MakeScreenshot);\r\n  btn.Enabled := True;\r\n\r\n  f := TTMSFNCUtils.GetParentForm(Self);\r\n  fo := nil;\r\n  if Assigned(f) then\r\n    fo := f.Focused;\r\n\r\n  btn.SetFocus;\r\n  btn.IsPressed := false;\r\n  FNormalFocusBtn := TTMSFNCBitmap(btn.MakeScreenshot);\r\n  btn.IsPressed := true;\r\n  FDownFocusBtn := TTMSFNCBitmap(btn.MakeScreenshot);\r\n  btn.Parent := nil;\r\n  btn.Free;\r\n\r\n  if Assigned(fo) then\r\n    fo.SetFocus;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  bmp := TBitmap.Create;\r\n  {$IFDEF VCLLIB}\r\n  rc := Bounds(0, 0, Round(AWidth), Round(AHeight));\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n  {$ENDIF}\r\n  try\r\n    {$IFNDEF WEBLIB}\r\n    bmp.PixelFormat := pf24bit;\r\n    bmp.TransparentMode := tmFixed;\r\n    bmp.Transparent := True;\r\n    bmp.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    bmp.SetSize(Round(AWidth), Round(AHeight));\r\n\r\n    FNormalBtn := TTMSFNCBitmap.Create;\r\n    FNormalBtn.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONPUSH;\r\n    ThemeStyle := PBS_NORMAL;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_PUSHBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc, DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawButton(RectF(0, 0, bmp.Width, bmp.Height), False, False, True, AdaptToStyle);\r\n    {$ENDIF}\r\n\r\n    FNormalBtn.Assign(bmp);\r\n\r\n    FDownBtn := TTMSFNCBitmap.Create;\r\n    FDownBtn.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONPUSH or DFCS_PUSHED;\r\n    ThemeStyle := PBS_PRESSED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_PUSHBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc, DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawButton(RectF(0, 0, bmp.Width, bmp.Height), True, False, True, AdaptToStyle);\r\n    {$ENDIF}\r\n\r\n    FDownBtn.Assign(bmp);\r\n\r\n    FNormalFocusBtn := TTMSFNCBitmap.Create;\r\n    FNormalFocusBtn.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONPUSH or DFCS_HOT;\r\n    ThemeStyle := PBS_HOT;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_PUSHBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc, DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawButton(RectF(0, 0, bmp.Width, bmp.Height), True, True, True, AdaptToStyle);\r\n    {$ENDIF}\r\n\r\n    FNormalFocusBtn.Assign(bmp);\r\n\r\n    FDownFocusBtn := TTMSFNCBitmap.Create;\r\n    FDownFocusBtn.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONPUSH or DFCS_PUSHED or DFCS_HOT;\r\n    ThemeStyle := PBS_HOT or PBS_PRESSED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_PUSHBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc, DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawButton(RectF(0, 0, bmp.Width, bmp.Height), False, True, True, AdaptToStyle);\r\n    {$ENDIF}\r\n\r\n    FDownFocusBtn.Assign(bmp);\r\n\r\n    FNormalDisabledBtn := TTMSFNCBitmap.Create;\r\n    FNormalDisabledBtn.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONPUSH or DFCS_INACTIVE;\r\n    ThemeStyle := PBS_DISABLED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_PUSHBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc, DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawButton(RectF(0, 0, bmp.Width, bmp.Height), False, False, False, AdaptToStyle);\r\n    {$ENDIF}\r\n\r\n    FNormalDisabledBtn.Assign(bmp);\r\n  finally\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Free;\r\n    {$ENDIF}\r\n    bmp.Free;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.CreateRadioButtonBitmaps;\r\nvar\r\n{$IFDEF FMXLIB}\r\n  Rd: TRadioButton;\r\n  f: TCommonCustomForm;\r\n  fo: IControl;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLWEBLIB}\r\n  rc: TRect;\r\n  dChecked: Cardinal;\r\n  hth: HTHEME;\r\n  ThemeStyle: DWord;\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g: TTMSFNCGraphics;\r\n  {$ENDIF}\r\n  bmp: TBitmap;\r\n{$ENDIF}\r\nbegin\r\n  if Assigned(FCheckedFocusRd) then\r\n  begin\r\n    FCheckedFocusRd.Free;\r\n    FCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedRd) then\r\n  begin\r\n    FUnCheckedRd.Free;\r\n    FUnCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedRd) then\r\n  begin\r\n    FCheckedRd.Free;\r\n    FCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusRd) then\r\n  begin\r\n    FUnCheckedFocusRd.Free;\r\n    FUnCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledRd) then\r\n  begin\r\n    FUnCheckedDisabledRd.Free;\r\n    FUnCheckedDisabledRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledRd) then\r\n  begin\r\n    FCheckedDisabledRd.Free;\r\n    FCheckedDisabledRd := nil;\r\n  end;\r\n\r\n  {$IFDEF FMXLIB}\r\n  Rd := TRadioButton.Create(Self);\r\n  Rd.Width := Rd.Height;\r\n  Rd.Text := '';\r\n  Rd.Parent := Self;\r\n  Rd.IsChecked := false;\r\n  Rd.NeedStyleLookup;\r\n  Rd.ApplyStyleLookup;\r\n\r\n  {$IFDEF FMXMOBILE}\r\n  Rd.Width := 25;\r\n  Rd.Height := 25;\r\n  {$ENDIF}\r\n\r\n  TurnOffAnimation(Rd);\r\n  FUnCheckedRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.IsChecked := true;\r\n  FCheckedRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.Enabled := False;\r\n  Rd.IsChecked := False;\r\n  FUnCheckedDisabledRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.IsChecked := true;\r\n  FCheckedDisabledRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.Enabled := True;\r\n\r\n  f := TTMSFNCUtils.GetParentForm(Self);\r\n  fo := nil;\r\n  if Assigned(f) then\r\n    fo := f.Focused;\r\n\r\n  Rd.SetFocus;\r\n  Rd.IsChecked := false;\r\n  FUnCheckedFocusRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.IsChecked := true;\r\n  FCheckedFocusRd := TTMSFNCBitmap(Rd.MakeScreenshot);\r\n  Rd.Parent := nil;\r\n  Rd.Free;\r\n\r\n  if Assigned(fo) then\r\n    fo.SetFocus;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  bmp := TBitmap.Create;\r\n  {$IFDEF VCLLIB}\r\n  rc := Bounds(0, 0, 16, 16);\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n  {$ENDIF}\r\n  try\r\n    {$IFNDEF WEBLIB}\r\n    bmp.PixelFormat := pf24bit;\r\n    bmp.TransparentMode := tmFixed;\r\n    bmp.Transparent := True;\r\n    bmp.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    bmp.SetSize(16, 16);\r\n\r\n    FUnCheckedRd := TTMSFNCBitmap.Create;\r\n    FUnCheckedRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO;\r\n    ThemeStyle := RBS_UNCHECKEDNORMAL;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), False, False, True);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedRd.Assign(bmp);\r\n\r\n    FCheckedRd := TTMSFNCBitmap.Create;\r\n    FCheckedRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO or DFCS_CHECKED;\r\n    ThemeStyle := RBS_CHECKEDNORMAL;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), True, False, True);\r\n    {$ENDIF}\r\n\r\n    FCheckedRd.Assign(bmp);\r\n\r\n    FUnCheckedFocusRd := TTMSFNCBitmap.Create;\r\n    FUnCheckedFocusRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO or DFCS_HOT;\r\n    ThemeStyle := RBS_UNCHECKEDHOT;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), False, True, True);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedFocusRd.Assign(bmp);\r\n\r\n    FCheckedFocusRd := TTMSFNCBitmap.Create;\r\n    FCheckedFocusRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO or DFCS_CHECKED or DFCS_HOT;\r\n    ThemeStyle := RBS_CHECKEDHOT;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), True, True, True);\r\n    {$ENDIF}\r\n\r\n    FCheckedFocusRd.Assign(bmp);\r\n\r\n    FUnCheckedDisabledRd := TTMSFNCBitmap.Create;\r\n    FUnCheckedDisabledRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO or DFCS_INACTIVE;\r\n    ThemeStyle := RBS_UNCHECKEDDISABLED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), False, False, False);\r\n    {$ENDIF}\r\n\r\n    FUnCheckedDisabledRd.Assign(bmp);\r\n\r\n    FCheckedDisabledRd := TTMSFNCBitmap.Create;\r\n    FCheckedDisabledRd.OnChange := @DoBitmapChanged;\r\n\r\n    {$IFDEF VCLLIB}\r\n    bmp.Canvas.Brush.Color := gcWhite;\r\n    bmp.Canvas.Brush.Style := bsSolid;\r\n    bmp.Canvas.FillRect(rc);\r\n\r\n    DChecked := DFCS_BUTTONRADIO or DFCS_CHECKED or DFCS_INACTIVE;\r\n    ThemeStyle := RBS_CHECKEDDISABLED;\r\n    if IsThemeActive and not (csDesigning in ComponentState) then\r\n    begin\r\n      hth := OpenThemeData(Self.Handle,'button');\r\n      DrawThemeBackground(hth, bmp.Canvas.Handle, BP_RADIOBUTTON, ThemeStyle,@rc,nil);\r\n      CloseThemeData(hth);\r\n    end\r\n    else\r\n      DrawFrameControl(bmp.Canvas.Handle,rc,DFC_BUTTON, DChecked);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Fill.Kind := gfkSolid;\r\n    g.Fill.Color := gcWhite;\r\n    g.Stroke.Kind := gskSolid;\r\n    g.Stroke.Color := gcWhite;\r\n    g.DrawRectangle(RectF(0, 0, bmp.Width, bmp.Height));\r\n    g.DrawRadioButton(RectF(0, 0, bmp.Width, bmp.Height), True, False, False);\r\n    {$ENDIF}\r\n\r\n    FCheckedDisabledRd.Assign(bmp);\r\n  finally\r\n    {$IFDEF LCLWEBLIB}\r\n    g.Free;\r\n    {$ENDIF}\r\n    bmp.Free;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetButtonBitmap(AWidth, AHeight: Single; ADown: Boolean = False; AFocused: Boolean = False; AEnabled: Boolean = True): TTMSFNCBitmap;\r\nbegin\r\n  CreateButtonBitmaps(AWidth, AHeight);\r\n\r\n  if ADown then\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FDownFocusBtn\r\n      else\r\n        Result := FDownBtn;\r\n    end\r\n    else\r\n      Result := FNormalDisabledBtn;\r\n  end\r\n  else\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FNormalFocusBtn\r\n      else\r\n        Result := FNormalBtn;\r\n    end\r\n    else\r\n      Result := FNormalDisabledBtn;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetCheckBoxBitmap(AChecked: Boolean; AFocused: Boolean; AEnabled: Boolean): TTMSFNCBitmap;\r\nbegin\r\n  if (not Assigned(FCheckedChk) or not Assigned(FCheckedFocusChk) or not Assigned(FUnCheckedChk)\r\n    or not Assigned(FUnCheckedFocusChk) or not Assigned(FCheckedDisabledChk) or not Assigned(FUnCheckedDisabledChk)) then\r\n    CreateCheckBoxBitmaps;\r\n\r\n  if AChecked then\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FCheckedFocusChk\r\n      else\r\n        Result := FCheckedChk;\r\n    end\r\n    else\r\n      Result := FCheckedDisabledChk;\r\n  end\r\n  else\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FUnCheckedFocusChk\r\n      else\r\n        Result := FUnCheckedChk;\r\n    end\r\n    else\r\n      Result := FUnCheckedDisabledChk;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetRadioButtonBitmap(AChecked: Boolean; AFocused: Boolean; AEnabled: Boolean): TTMSFNCBitmap;\r\nbegin\r\n  if (not Assigned(FCheckedRd) or not Assigned(FCheckedFocusRd) or not Assigned(FUnCheckedRd)\r\n    or not Assigned(FUnCheckedFocusRd) or not Assigned(FCheckedDisabledRd) or not Assigned(FUnCheckedDisabledRd)) then\r\n    CreateRadioButtonBitmaps;\r\n\r\n  if AChecked then\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FCheckedFocusRd\r\n      else\r\n        Result := FCheckedRd;\r\n    end\r\n    else\r\n      Result := FCheckedDisabledRd;\r\n  end\r\n  else\r\n  begin\r\n    if AEnabled then\r\n    begin\r\n      if AFocused then\r\n        Result := FUnCheckedFocusRd\r\n      else\r\n        Result := FUnCheckedRd;\r\n    end\r\n    else\r\n      Result := FUnCheckedDisabledRd;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsDesignTime: Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(Owner) then\r\n    Result := (csDesigning in ComponentState) and not ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState));\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsReading: Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(Owner) then\r\n    Result := (csReading in Owner.ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsDesigning: Boolean;\r\nbegin\r\n  Result := (csDesigning in ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsDesignerForm: Boolean;\r\nvar\r\n  frm: TCustomForm;\r\nbegin\r\n  frm := TTMSFNCUtils.GetOwnerForm(Self);\r\n  Result := IsDesigning;\r\n  if Assigned(frm) then\r\n    Result := Result or (frm is TTMSFNCCustomDesignerForm);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsDestroying: Boolean;\r\nbegin\r\n  Result := (csDestroying in ComponentState);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.IsLoading: Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(Owner) then\r\n    Result := (csLoading in Owner.ComponentState)\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.ResetToDefaultStyle;\r\nbegin\r\n  inherited;\r\n  Fill.Color := gcWhite;\r\n  Stroke.Color := gcSilver;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.RegisterRuntimeClasses;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.&Export({%H-}AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF);\r\nbegin\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.ApplyStyle;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundFillColor(c) then\r\n    Fill.Color := c;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleLineFillColor(c) then\r\n    Stroke.Color := c;\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.DestroyGraphicElements;\r\nbegin\r\n  if Assigned(FDownBtn) then\r\n  begin\r\n    FDownBtn.Free;\r\n    FDownBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalBtn) then\r\n  begin\r\n    FNormalBtn.Free;\r\n    FNormalBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FDownFocusBtn) then\r\n  begin\r\n    FDownFocusBtn.Free;\r\n    FDownFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalFocusBtn) then\r\n  begin\r\n    FNormalFocusBtn.Free;\r\n    FNormalFocusBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FNormalDisabledBtn) then\r\n  begin\r\n    FNormalDisabledBtn.Free;\r\n    FNormalDisabledBtn := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedChk) then\r\n  begin\r\n    FCheckedChk.Free;\r\n    FCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedFocusChk) then\r\n  begin\r\n    FCheckedFocusChk.Free;\r\n    FCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledChk) then\r\n  begin\r\n    FUnCheckedDisabledChk.Free;\r\n    FUnCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledChk) then\r\n  begin\r\n    FCheckedDisabledChk.Free;\r\n    FCheckedDisabledChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedChk) then\r\n  begin\r\n    FUnCheckedChk.Free;\r\n    FUnCheckedChk := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusChk) then\r\n  begin\r\n    FUnCheckedFocusChk.Free;\r\n    FUnCheckedFocusChk := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedRd) then\r\n  begin\r\n    FCheckedRd.Free;\r\n    FCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedFocusRd) then\r\n  begin\r\n    FCheckedFocusRd.Free;\r\n    FCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedRd) then\r\n  begin\r\n    FUnCheckedRd.Free;\r\n    FUnCheckedRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedFocusRd) then\r\n  begin\r\n    FUnCheckedFocusRd.Free;\r\n    FUnCheckedFocusRd := nil;\r\n  end;\r\n\r\n  if Assigned(FUnCheckedDisabledRd) then\r\n  begin\r\n    FUnCheckedDisabledRd.Free;\r\n    FUnCheckedDisabledRd := nil;\r\n  end;\r\n\r\n  if Assigned(FCheckedDisabledRd) then\r\n  begin\r\n    FCheckedDisabledRd.Free;\r\n    FCheckedDisabledRd := nil;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetControlRect: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, Width, Height);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetContentRect: TRectF;\r\nbegin\r\n  Result := GetControlRect;\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.GetVersion: String;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.CanSaveProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if AObject = Self then\r\n    Result := (TTMSFNCUtils.IndexOfTextInArray(APropertyName, ExcludePropertyList) = -1)\r\n  else\r\n    Result := True;\r\n  {$ENDIF}\r\n\r\n  DoCanSaveProperty(AObject, APropertyName, APropertyType, Result);\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.CanLoadProperty(AObject: TObject; APropertyName: string; APropertyType: TTypeKind): Boolean;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if AObject = Self then\r\n    Result := (TTMSFNCUtils.IndexOfTextInArray(APropertyName, ExcludePropertyList) = -1)\r\n  else\r\n    Result := True;\r\n  {$ENDIF}\r\n\r\n  DoCanLoadProperty(AObject, APropertyName, APropertyType, Result);\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCCustomControl.SaveSettingsToFile(AFileName: string);\r\nbegin\r\n  TTMSFNCPersistence.SaveSettingsToFile(Self, AFileName);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.LoadSettingsFromFile(AFileName: string);\r\nbegin\r\n  TTMSFNCPersistence.LoadSettingsFromFile(Self, AFileName);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.SaveSettingsToStream(AStream: TStream);\r\nbegin\r\n  TTMSFNCPersistence.SaveSettingsToStream(Self, AStream);\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.LoadSettingsFromStream(AStream: TStream);\r\nbegin\r\n  TTMSFNCPersistence.LoadSettingsFromStream(Self, AStream);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomControl.LocalToScreenEx(APoint: TPointF): TPointF;\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  pt: TPoint;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := LocalToScreen(APoint);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  pt := ClientToScreen(Point(Round(APoint.X), Round(APoint.Y)));\r\n  Result := PointF(pt.X, pt.Y);\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomControl.ScreenToLocalEx(APoint: TPointF): TPointF;\r\n{$IFDEF CMNWEBLIB}\r\nvar\r\n  pt: TPoint;\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := ScreenToLocal(APoint);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  pt := ScreenToClient(Point(Round(APoint.X), Round(APoint.Y)));\r\n  Result := PointF(pt.X, pt.Y);\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomControl.TurnOffAnimation(chk: TFmxObject);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if Assigned(chk) then\r\n  begin\r\n    if chk is TAnimation then\r\n      (chk as TAnimation).Duration := 0;\r\n\r\n    for I := 0 to chk.ChildrenCount - 1 do\r\n    begin\r\n      TurnOffAnimation(chk.Children[I]);\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomControl.CaptureEx;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Capture;\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  SetCapture(Self.Handle);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  MouseCapture := True;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  Capture;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControl.ReleaseCaptureEx;\r\nbegin\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ReleaseCapture;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  MouseCapture := False;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ReleaseCapture;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.GetControlMargins(var ALeft: Single; var ATop: Single; var ARight: Single; var ABottom: Single);\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFDEF VCLLIB}\r\n  if not AlignWithMargins then\r\n    Exit;\r\n  {$ENDIF}\r\n  ALeft := Margins.Left;\r\n  ATop := Margins.Top;\r\n  ARight := Margins.Right;\r\n  ABottom := Margins.Bottom;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ALeft := BorderSpacing.Left;\r\n  ATop := BorderSpacing.Top;\r\n  ARight := BorderSpacing.Right;\r\n  ABottom := BorderSpacing.Bottom;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.SetControlMargins(ALeft: Single; ATop: Single; ARight: Single; ABottom: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Margins.Left := ALeft;\r\n  Margins.Top := ATop;\r\n  Margins.Right := ARight;\r\n  Margins.Bottom := ABottom;\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  AlignWithMargins := True;\r\n  Margins.Left := Round(ALeft);\r\n  Margins.Top := Round(ATop);\r\n  Margins.Right := Round(ARight);\r\n  Margins.Bottom := Round(ABottom);\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  BorderSpacing.Left := Round(ALeft);\r\n  BorderSpacing.Top := Round(ATop);\r\n  BorderSpacing.Right := Round(ARight);\r\n  BorderSpacing.Bottom := Round(ABottom);\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomControlBaseCommon.BeginDrag;\r\n{$IFDEF FMXLIB}\r\n{$HINTS OFF}\r\n{$IF COMPILERVERSION > 27}\r\nvar\r\n  Svc: IFMXDragDropService;\r\n  DragData: TDragObject;\r\n  DragImage: TTMSFNCBitmap;\r\nbegin\r\n  if TPlatformServices.Current.SupportsPlatformService(IFMXDragDropService, Svc) then\r\n  begin\r\n    DragData.Source := Self;\r\n    DragImage := TTMSFNCBitmap.Create;\r\n    DragImage.Width := 1;\r\n    DragImage.Height := 1;\r\n    try\r\n      DragData.Data := DragImage;\r\n      Svc.BeginDragDrop(TTMSFNCUtils.GetParentForm(Self), DragData, DragImage);\r\n    finally\r\n      DragImage.Free;\r\n    end;\r\n  end;\r\n{$IFEND}\r\n{$IF COMPILERVERSION <= 27}\r\nbegin\r\n{$IFEND}\r\n{$HINTS ON}\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\nbegin\r\n  inherited BeginDrag(True);\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\nbegin\r\n{$ENDIF}\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomControlBaseCommon.CancelHint;\r\nbegin\r\n  {$WARNINGS OFF}\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 29}\r\n  Application.CancelHint;\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$WARNINGS ON}\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomControlBaseCommon.GetDragObjectScreenShot: TTMSFNCBitmap;\r\nbegin\r\n  Result := nil;\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomControlBaseCommon.CancelHint;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  Application.CancelHint;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBase.GetHintString: string;\r\nbegin\r\n  Result := '';\r\nend;\r\n\r\nfunction TTMSFNCCustomControlBase.HasHint: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n{$ENDIF}\r\n\r\n{ TTMSFNCControl }\r\n\r\nprocedure TTMSFNCControl.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCControl);\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\n{$IFNDEF LCLLIB}\r\n{$IFNDEF FMXMOBILE}\r\n{$IFDEF FREEWARE}\r\n{$I TMSProductTrial.inc}\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\nend.\r\n\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCPlannerBase;\r\n\r\ninterface\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  Windows,\r\n  {$ENDIF}\r\n  Classes, WEBLib.TMSFNCCustomControl, WEBLib.TMSFNCTypes, WEBLib.StdCtrls\r\n  {$IFNDEF LCLLIB}\r\n  ,Types\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,SysUtils\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  {$IFDEF LCLLIB}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 15;\r\n  {$ELSE}\r\n  {$IFDEF MSWINDOWS}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 15;\r\n  {$ENDIF}\r\n  {$IFDEF MACOS}\r\n  {$IFDEF IOS}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 200;\r\n  {$ELSE}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 200;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF ANDROID}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 100;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  {$IFDEF LINUX}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 200;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  SWIPECOUNT = 300;\r\n  DOWNCOUNT = 100;\r\n  {$ENDIF}\r\n\r\ntype\r\n  TTMSFNCPlannerBase = class;\r\n\r\n  TTMSFNCPlannerDoubleListItem = class(TCollectionItem)\r\n  private\r\n    FOwner: TTMSFNCPlannerBase;\r\n    FValue: Double;\r\n    FCellVal: Integer;\r\n    procedure SetCellData(const Value: Double);\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n  published\r\n    property Value: Double read FValue write SeTCellData;\r\n    property CellVal: Integer read FCellVal write FCellVal;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerDoubleList = class(TTMSFNCOwnedCollection)\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerDoubleList = class({$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<TTMSFNCPlannerDoubleListItem>)\r\n  {$ENDIF}\r\n  private\r\n    FOwner: TTMSFNCPlannerBase;\r\n    FOnChange: TNotifyEvent;\r\n    function GetItem(Index: Integer): TTMSFNCPlannerDoubleListItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerDoubleListItem);\r\n  protected\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  public\r\n    function IndexOf(ACellVal: Integer): Integer;\r\n    constructor Create(AOwner: TTMSFNCPlannerBase);\r\n    property Items[Index: Integer]: TTMSFNCPlannerDoubleListItem read GetItem write SetItem; default;\r\n    function Add: TTMSFNCPlannerDoubleListItem;\r\n    function Insert(Index: Integer): TTMSFNCPlannerDoubleListItem;\r\n  end;\r\n\r\n  TTMSFNCPlannerScrollMode = (smPixelScrolling, smCellScrolling);\r\n\r\n  TTMSFNCPlannerCell = record\r\n    Col, Row: Integer\r\n  end;\r\n\r\n  TTMSFNCPlannerTime = record\r\n    StartTime, EndTime: TDateTime;\r\n  end;\r\n\r\n  TTMSFNCPlannerSelection = record\r\n    StartCell, EndCell: TTMSFNCPlannerCell;\r\n  end;\r\n\r\n  TTMSFNCPlannerOrientationMode = (pomHorizontal, pomVertical);\r\n\r\n  TTMSFNCPlannerItemCachingMode = (picmNoCaching, picmDelayedCaching, picmFullCaching);\r\n\r\n  TTMSFNCPlannerBase = class(TTMSFNCCustomControl)\r\n  private\r\n    FTotalRowHeight: Double;\r\n    FTotalColumnWidth: Double;\r\n    FStartCol, FStopCol, FStartRow, FStopRow: Integer;\r\n    FStartX, FStopX, FStartY, FStopY: Double;\r\n    FBlockScrollingUpdate: Boolean;\r\n    FUpdateCount: Integer;\r\n    FVerticalScrollBar, FHorizontalScrollBar: TScrollBar;\r\n    FRowCount: Integer;\r\n    FColumnCount: Integer;\r\n    FColumnW, FRowH, FColumnP, FRowP: TTMSFNCPlannerDoubleList;\r\n    FDefaultRowHeight: Double;\r\n    FDefaultColumnWidth: Double;\r\n    FVerticalScrollBarVisible: Boolean;\r\n    FHorizontalScrollBarVisible: Boolean;\r\n    FScrollMode: TTMSFNCPlannerScrollMode;\r\n    FOrientationMode: TTMSFNCPlannerOrientationMode;\r\n    FIsMouseDown: Boolean;\r\n    FDelayedLoading: Boolean;\r\n    FItemCachingMode: TTMSFNCPlannerItemCachingMode;\r\n    FStretchScrollBars: Boolean;\r\n    procedure SetColumnCount(const Value: Integer);\r\n    procedure SetRowCount(const Value: Integer);\r\n    procedure SetDefaultColumnWidth(const Value: Double);\r\n    procedure SetDefaultRowHeight(const Value: Double);\r\n    procedure SetHorizontalScrollBarVisible(const Value: Boolean);\r\n    procedure SetVerticalScrollBarVisible(const Value: Boolean);\r\n    procedure SetScrollMode(const Value: TTMSFNCPlannerScrollMode);\r\n    procedure SetColWidths(Col: Integer; const Value: Double);\r\n    procedure SetRowHeights(Row: Integer; const Value: Double);\r\n    procedure SetColumnP(const Value: TTMSFNCPlannerDoubleList);\r\n    procedure SetRowP(const Value: TTMSFNCPlannerDoubleList);\r\n    procedure SetColumnW(const Value: TTMSFNCPlannerDoubleList);\r\n    procedure SetRowH(const Value: TTMSFNCPlannerDoubleList);\r\n    procedure SetOrientationMode(const Value: TTMSFNCPlannerOrientationMode);\r\n    procedure SetItemCachingMode(const Value: TTMSFNCPlannerItemCachingMode);\r\n    function GetColWidths(Col: integer): Double;\r\n    function GetRowHeights(Row: integer): Double;\r\n    function GetColPos(Col: integer): Double;\r\n    function GetRowPos(Row: integer): Double;\r\n    procedure SetColPos(Col: Integer; const Value: Double);\r\n    procedure SetRowPos(Row: Integer; const Value: Double);\r\n    procedure SetStretchScrollBars(const Value: Boolean);\r\n  protected\r\n    procedure UpdateVisualRange; virtual;\r\n    procedure UpdateControlAfterResize; override;\r\n    procedure StretchColumn(ACol: Integer = -1; ANewWidth: Double = -1); virtual;\r\n    procedure StretchRow(ARow: Integer = -1; ANewHeight: Double = -1); virtual;\r\n    procedure StopAnimationTimer; virtual; abstract;\r\n    procedure Scroll(AHorizontalPos, AVerticalPos: Double);\r\n    procedure UpdateDisplay; virtual;\r\n    procedure VerticalScrollPositionChanged; virtual; abstract;\r\n    procedure HorizontalScrollPositionChanged; virtual; abstract;\r\n    procedure VScrollChanged(Sender: TObject);\r\n    procedure HScrollChanged(Sender: TObject);\r\n    procedure UpdateAutoSizing; virtual; abstract;\r\n    procedure UpdateColumnRowCalculations; virtual; abstract;\r\n    procedure UpdateScrollBars(AUpdate: Boolean = True; ACalculate: Boolean = True);\r\n    procedure UpdateScrollPosition(AForce: Boolean = True); virtual; abstract;\r\n    procedure UpdateCalculations(AForce: Boolean = False); virtual; abstract;\r\n    procedure UpdatePositionsCache; virtual; abstract;\r\n    procedure UpdateGroupsCache; virtual; abstract;\r\n    procedure UpdateTimeLinesCache; virtual; abstract;\r\n    procedure UpdateGridCache; virtual; abstract;\r\n    procedure UpdatePlannerDisplay; virtual;\r\n    procedure DirtyItems; virtual; abstract;\r\n    procedure Loaded; override;\r\n    procedure SetHScrollValue(AValue: Single); virtual;\r\n    procedure SetVScrollValue(AValue: Single); virtual;\r\n    function ColumnStretchingActive: Boolean; virtual; abstract;\r\n    function GetVViewPortSize: Single; virtual;\r\n    function GetHViewPortSize: Single; virtual;\r\n    function GetHScrollValue: Single; virtual;\r\n    function GetVScrollValue: Single; virtual;\r\n    function GetUpdateCount: Integer;\r\n    function GetCalculationRect: TRectF; virtual;\r\n    function GetContentRect: TRectF; override;\r\n    property TotalColumnWidth: Double read FTotalColumnWidth write FTotalColumnWidth;\r\n    property TotalRowHeight: Double read FTotalRowHeight write FTotalRowHeight;\r\n    property ItemCachingMode: TTMSFNCPlannerItemCachingMode read FItemCachingMode write SetItemCachingMode default picmNoCaching;\r\n    property IsMouseDown: Boolean read FIsMouseDown write FIsMouseDown;\r\n    property DefaultRowHeight: Double read FDefaultRowHeight write SetDefaultRowHeight;\r\n    property DefaultColumnWidth: Double read FDefaultColumnWidth write SetDefaultColumnWidth;\r\n    property HorizontalScrollBarVisible: Boolean read FHorizontalScrollBarVisible write SetHorizontalScrollBarVisible default True;\r\n    property VerticalScrollBarVisible: Boolean read FVerticalScrollBarVisible write SetVerticalScrollBarVisible default True;\r\n    property RowCount: Integer read FRowCount write SetRowCount;\r\n    property ColumnCount: Integer read FColumnCount write SetColumnCount;\r\n    property ScrollMode: TTMSFNCPlannerScrollMode read FScrollMode write SetScrollMode default smPixelScrolling;\r\n    property OrientationMode: TTMSFNCPlannerOrientationMode read FOrientationMode write SetOrientationMode default pomVertical;\r\n    property RowPositions[Row: Integer]: Double read GetRowPos write SetRowPos;\r\n    property ColumnPositions[Col: Integer]: Double read GetColPos write SetColPos;\r\n    property ColumnWidths[Col: Integer]: Double read GetColWidths write SetColWidths;\r\n    property RowHeights[Row: Integer]: Double read GetRowHeights write SetRowHeights;\r\n    property ColumnW: TTMSFNCPlannerDoubleList read FColumnW write SetColumnW;\r\n    property RowH: TTMSFNCPlannerDoubleList read FRowH write SetRowH;\r\n    property ColumnP: TTMSFNCPlannerDoubleList read FColumnP write SetColumnP;\r\n    property RowP: TTMSFNCPlannerDoubleList read FRowP write SetRowP;\r\n    property BlockScrollingUpdate: Boolean read FBlockScrollingUpdate write FBlockScrollingUpdate;\r\n    property StretchScrollBars: Boolean read FStretchScrollBars write SetStretchScrollBars default False;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    property UpdateCount: Integer read GetUpdateCount;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate; override;\r\n    procedure EndUpdate; override;\r\n    procedure UpdateConflicts; virtual; abstract;\r\n    procedure UpdatePlannerCache(ADirtyItems: Boolean = True); virtual;\r\n    procedure UpdateItemsCache; virtual; abstract;\r\n    function GetColumnViewPortSize: Double; virtual;\r\n    function GetRowViewPortSize: Double; virtual;\r\n    function GetVerticalScrollPosition: Double; virtual;\r\n    function GetHorizontalScrollPosition: Double; virtual;\r\n    function HorizontalScrollBar: TScrollBar;\r\n    function VerticalScrollBar: TScrollBar;\r\n    function XYToCell(X, Y: Double): TTMSFNCPlannerCell; virtual;\r\n    function StartCol: Integer;\r\n    function StopCol: Integer;\r\n    function StartX: Double;\r\n    function StopX: Double;\r\n    function StartRow: Integer;\r\n    function StopRow: Integer;\r\n    function StartY: Double;\r\n    function StopY: Double;\r\n    function GetTotalColumnWidth: Double;\r\n    function GetTotalRowHeight: Double;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Controls, WEBLib.Forms, Math\r\n  {$IFNDEF WEBLIB}\r\n  ,SysUtils\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types\r\n  {$ENDIF}\r\n  ;\r\n\r\n{ TTMSFNCPlannerBase }\r\n\r\nprocedure TTMSFNCPlannerBase.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCPlannerBase then\r\n  begin\r\n    FItemCachingMode := (Source as TTMSFNCPlannerBase).ItemCachingMode;\r\n    FOrientationMode := (Source as TTMSFNCPlannerBase).OrientationMode;\r\n    FScrollMode := (Source as TTMSFNCPlannerBase).ScrollMode;\r\n    FStretchScrollBars := (Source as TTMSFNCPlannerBase).StretchScrollBars;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.BeginUpdate;\r\nbegin\r\n  inherited;\r\n  Inc(FUpdateCount);\r\nend;\r\n\r\nconstructor TTMSFNCPlannerBase.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FDelayedLoading := False;\r\n  FStretchScrollBars := False;\r\n  FOrientationMode := pomVertical;\r\n  FItemCachingMode := picmNoCaching;\r\n\r\n  FVerticalScrollBar := TScrollBar.Create(Self);\r\n  FVerticalScrollBar.Parent := Self;\r\n  FHorizontalScrollBar := TScrollBar.Create(Self);\r\n  FHorizontalScrollBar.Parent := Self;\r\n\r\n  {$IFDEF FMXLIB}\r\n  FVerticalScrollBar.Stored := False;\r\n  FHorizontalScrollBar.Stored := False;\r\n  FVerticalScrollBar.Orientation := TOrientation.Vertical;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  FVerticalScrollBar.DoubleBuffered := False;\r\n  FHorizontalScrollBar.DoubleBuffered := False;\r\n  FVerticalScrollBar.Kind := sbVertical;\r\n  {$ENDIF}\r\n\r\n  FVerticalScrollBar.Visible := True;\r\n  FHorizontalScrollBar.Visible := True;\r\n  FVerticalScrollBar.OnChange := @VScrollChanged;\r\n  FHorizontalScrollBar.OnChange := @HScrollChanged;\r\n\r\n  FScrollMode := smPixelScrolling;\r\n\r\n  FColumnW := TTMSFNCPlannerDoubleList.Create(Self);\r\n  FRowH := TTMSFNCPlannerDoubleList.Create(Self);\r\n  FRowP := TTMSFNCPlannerDoubleList.Create(Self);\r\n  FColumnP := TTMSFNCPlannerDoubleList.Create(Self);\r\n\r\n  FDefaultRowHeight := 30;\r\n  FDefaultColumnWidth := 75;\r\n  FColumnCount := 10;\r\n  FRowCount := 24;\r\n  FVerticalScrollBarVisible := True;\r\n  FHorizontalScrollBarVisible := True;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerBase.Destroy;\r\nbegin\r\n  FColumnP.Free;\r\n  FRowP.Free;\r\n  FColumnW.Free;\r\n  FRowH.Free;\r\n  FVerticalScrollBar.Free;\r\n  FHorizontalScrollBar.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetContentRect: TRectF;\r\nbegin\r\n  Result := inherited GetContentRect;\r\n  if HorizontalScrollBar.Visible then\r\n    Result.Bottom := Result.Bottom - HorizontalScrollBar.Height - 1;\r\n\r\n  if VerticalScrollBar.Visible then\r\n    Result.Right := Result.Right - VerticalScrollBar.Width - 1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetCalculationRect: TRectF;\r\nbegin\r\n  Result := LocalRect;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetHorizontalScrollPosition: Double;\r\nvar\r\n  hVal, scrollh: Double;\r\nbegin\r\n  hVal := GetHScrollValue;\r\n  if ScrollMode = smCellScrolling then\r\n  begin\r\n    case OrientationMode of\r\n      pomHorizontal: scrollh := RowPositions[Round(hval)];\r\n      pomVertical: scrollh := ColumnPositions[Round(hval)];\r\n      else\r\n        scrollh := 0;\r\n    end;\r\n\r\n    hVal := scrollh;\r\n  end;\r\n\r\n  Result := hVal;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetHScrollValue: Single;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := Min(HorizontalScrollBar.Max - HorizontalScrollBar.ViewportSize, Max(0, HorizontalScrollBar.Value));\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  Result := Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, Round(HorizontalScrollBar.Position)));\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  Result := {%H-}Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, Round(HorizontalScrollBar.Position)));\r\n  {$ELSE}\r\n  case ScrollMode of\r\n    smPixelScrolling: Result := {%H-}Min(HorizontalScrollBar.Max, Max(0, Round(HorizontalScrollBar.Position - HorizontalScrollBar.Position * (HorizontalScrollBar.PageSize / HorizontalScrollBar.Max))));\r\n    smCellScrolling: Result := {%H-}Min(HorizontalScrollBar.Max, Max(0, Round(HorizontalScrollBar.Position)));\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetHViewPortSize: Single;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := HorizontalScrollBar.ViewportSize;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := HorizontalScrollBar.PageSize;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetRowHeights(Row: Integer): Double;\r\nvar\r\n  idx: Integer;\r\nbegin\r\n  idx := RowH.IndexOf(Row);\r\n  if idx <> -1 then\r\n    Result := RowH[idx].Value\r\n  else\r\n    Result := DefaultRowHeight;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetRowPos(Row: Integer): Double;\r\nvar\r\n  idx: Integer;\r\nbegin\r\n  idx := RowP.IndexOf(Row);\r\n  if idx <> -1 then\r\n    Result := RowP[idx].Value\r\n  else\r\n    Result := -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetRowViewPortSize: Double;\r\nvar\r\n  I,cnt: Integer;\r\n  h: Double;\r\n  ch: Double;\r\n  cr: TRectF;\r\nbegin\r\n  cr := GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal: ch := cr.Right - cr.Left;\r\n    pomVertical: ch := cr.Bottom - cr.Top;\r\n    else\r\n      ch := 0;\r\n  end;\r\n  Result := 0;\r\n  h := 0;\r\n  cnt := 0;\r\n  for I := RowCount - 1 downto 0 do\r\n  begin\r\n    h := h + RowHeights[I];\r\n    if h > ch then\r\n    begin\r\n      Result := Max(1, cnt);\r\n      Break;\r\n    end;\r\n    Inc(cnt);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetTotalColumnWidth: Double;\r\nbegin\r\n  Result := TotalColumnWidth;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetTotalRowHeight: Double;\r\nbegin\r\n  Result := TotalRowHeight;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetVerticalScrollPosition: Double;\r\nvar\r\n  vVal, scrollv: Double;\r\nbegin\r\n  vVal := GetVScrollValue;\r\n\r\n  if ScrollMode = smCellScrolling then\r\n  begin\r\n    case OrientationMode of\r\n      pomHorizontal: scrollv := ColumnPositions[Round(vval)];\r\n      pomVertical: scrollv := RowPositions[Round(vval)];\r\n      else\r\n        scrollv := 0;\r\n    end;\r\n\r\n    vVal := scrollv;\r\n  end;\r\n\r\n  Result := vVal;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetVScrollValue: Single;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := Min(VerticalScrollBar.Max - VerticalScrollBar.ViewportSize, Max(0, VerticalScrollBar.Value));\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  Result := Round(Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, VerticalScrollBar.Position)));\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  Result := {%H-}Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, Round(VerticalScrollBar.Position)));\r\n  {$ELSE}\r\n  case ScrollMode of\r\n    smPixelScrolling: Result := {%H-}Min(VerticalScrollBar.Max, Max(0, Round(VerticalScrollBar.Position - VerticalScrollBar.Position * (VerticalScrollBar.PageSize / VerticalScrollBar.Max))));\r\n    smCellScrolling: Result := {%H-}Min(VerticalScrollBar.Max, Max(0, Round(VerticalScrollBar.Position)));\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetVViewPortSize: Single;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := VerticalScrollBar.ViewportSize;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := VerticalScrollBar.PageSize;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.HorizontalScrollBar: TScrollBar;\r\nbegin\r\n  Result := FHorizontalScrollBar;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.HScrollChanged(Sender: TObject);\r\nbegin\r\n  if FBlockScrollingUpdate then\r\n    Exit;\r\n\r\n  if not IsMouseDown then\r\n    StopAnimationTimer;\r\n\r\n  HorizontalScrollPositionChanged;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.Loaded;\r\nbegin\r\n  inherited;\r\n  UpdatePlannerCache;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.VerticalScrollBar: TScrollBar;\r\nbegin\r\n  Result := FVerticalScrollBar;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.VScrollChanged(Sender: TObject);\r\nbegin\r\n  if FBlockScrollingUpdate then\r\n    Exit;\r\n\r\n  if not IsMouseDown then\r\n    StopAnimationTimer;\r\n\r\n  VerticalScrollPositionChanged;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.XYToCell(X, Y: Double): TTMSFNCPlannerCell;\r\nvar\r\n  I: Integer;\r\n  val: Double;\r\n  xv, yv: Double;\r\n  cr: TRectF;\r\nbegin\r\n  cr := GetContentRect;\r\n  Result.Row := -1;\r\n  Result.Col := -1;\r\n\r\n  if PtInRectEx(GetContentRect, PointF(X, Y)) then\r\n  begin\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        yv := X + GetHorizontalScrollPosition - cr.Left;\r\n        xv := Y + GetVerticalScrollPosition - cr.Top;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        xv := X + GetHorizontalScrollPosition - cr.Left;\r\n        yv := Y + GetVerticalScrollPosition - cr.Top;\r\n      end;\r\n      else\r\n      begin\r\n        xv := 0;\r\n        yv := 0;\r\n      end;\r\n    end;\r\n    val := 0;\r\n    for I := 0 to RowCount - 1 do\r\n    begin\r\n      val := val + RowHeights[I];\r\n      if val >= yv then\r\n      begin\r\n        Result.Row := I;\r\n        Break;\r\n      end;\r\n    end;\r\n\r\n    val := 0;\r\n    for I := 0 to ColumnCount - 1 do\r\n    begin\r\n      val := val + ColumnWidths[I];\r\n      if val >= xv then\r\n      begin\r\n        Result.Col := I;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.EndUpdate;\r\nbegin\r\n  inherited;\r\n  Dec(FUpdateCount);\r\n  if FUpdateCount = 0 then\r\n    UpdatePlannerCache(False);\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetColumnViewPortSize: Double;\r\nvar\r\n  I,cnt: Integer;\r\n  w: Double;\r\n  cw: Double;\r\n  cr: TRectF;\r\nbegin\r\n  cr := GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal: cw := cr.Bottom - cr.Top;\r\n    pomVertical: cw := cr.Right - cr.Left;\r\n    else\r\n      cw := 0;\r\n  end;\r\n  Result := 0;\r\n  w := 0;\r\n  cnt := 0;\r\n  for I := ColumnCount - 1 downto 0 do\r\n  begin\r\n    w := w + ColumnWidths[I];\r\n    if w > cw then\r\n    begin\r\n      Result := Max(1, cnt);\r\n      Break;\r\n    end;\r\n    Inc(cnt);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetColWidths(Col: Integer): Double;\r\nvar\r\n  idx: Integer;\r\nbegin\r\n  idx := ColumnW.IndexOf(Col);\r\n  if idx <> -1 then\r\n    Result := ColumnW[idx].Value\r\n  else\r\n    Result := DefaultColumnWidth;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetColPos(Col: Integer): Double;\r\nvar\r\n  idx: Integer;\r\nbegin\r\n  idx := ColumnP.IndexOf(Col);\r\n  if idx <> -1 then\r\n    Result := ColumnP[idx].Value\r\n  else\r\n    Result := -1;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.Scroll(AHorizontalPos, AVerticalPos: Double);\r\nbegin\r\n  FBlockScrollingUpdate := True;\r\n  SetHScrollValue(AHorizontalPos);\r\n  SetVScrollValue(AVerticalPos);\r\n  FBlockScrollingUpdate := False;\r\n  UpdateDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetColumnCount(const Value: Integer);\r\nbegin\r\n  if FColumnCount <> Value then\r\n    FColumnCount := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetColumnW(const Value: TTMSFNCPlannerDoubleList);\r\nbegin\r\n  FColumnW.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetColumnP(const Value: TTMSFNCPlannerDoubleList);\r\nbegin\r\n  FColumnP.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetColWidths(Col: Integer; const Value: Double);\r\nvar\r\n  idx: Integer;\r\n  c: TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  idx := ColumnW.IndexOf(Col);\r\n  if (idx >= 0) and (idx <= ColumnW.Count - 1) then\r\n  begin\r\n    if Value = DefaultColumnWidth then\r\n      ColumnW.Delete(idx)\r\n    else\r\n    begin\r\n      ColumnW[idx].Value := Max(0, Value);\r\n      ColumnW[idx].CellVal := Col;\r\n    end;\r\n  end\r\n  else if Value <> DefaultColumnWidth then\r\n  begin\r\n    c := ColumnW.Add;\r\n    c.Value := Max(0, Value);\r\n    c.CellVal := Col;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetColPos(Col: Integer; const Value: Double);\r\nvar\r\n  idx: Integer;\r\n  c: TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  idx := ColumnP.IndexOf(Col);\r\n  if (idx >= 0) and (idx <= ColumnP.Count - 1) then\r\n  begin\r\n    if Value = -1 then\r\n      ColumnP.Delete(idx)\r\n    else\r\n    begin\r\n      ColumnP[idx].Value := Max(0, Value);\r\n      ColumnP[idx].CellVal := Col;\r\n    end;\r\n  end\r\n  else if Value <> -1 then\r\n  begin\r\n    c := ColumnP.Add;\r\n    c.Value := Max(0, Value);\r\n    c.CellVal := Col;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetDefaultColumnWidth(const Value: Double);\r\nbegin\r\n  if FDefaultColumnWidth <> Value then\r\n    FDefaultColumnWidth := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetDefaultRowHeight(const Value: Double);\r\nbegin\r\n  if FDefaultRowHeight <> Value then\r\n    FDefaultRowHeight := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetHorizontalScrollBarVisible(\r\n  const Value: Boolean);\r\nbegin\r\n  if FHorizontalScrollBarVisible <> Value then\r\n  begin\r\n    FHorizontalScrollBarVisible := Value;\r\n    UpdatePlannerCache(True);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetHScrollValue(AValue: Single);\r\nbegin\r\n {$IFDEF FMXLIB}\r\n  HorizontalScrollBar.Value := Min(HorizontalScrollBar.Max - HorizontalScrollBar.ViewportSize, Max(0, AValue));\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  HorizontalScrollBar.Position := Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  HorizontalScrollBar.Position := Round(Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, AValue)));\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  HorizontalScrollBar.Position := {%H-}Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  {$ELSE}\r\n  case ScrollMode of\r\n    smPixelScrolling: HorizontalScrollBar.Position := {%H-}Min(HorizontalScrollBar.Max, Max(0, Round(AValue + AValue * (HorizontalScrollBar.PageSize / (HorizontalScrollBar.Max - HorizontalScrollBar.PageSize)))));\r\n    smCellScrolling: HorizontalScrollBar.Position := {%H-}Min(HorizontalScrollBar.Max - HorizontalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetItemCachingMode(\r\n  const Value: TTMSFNCPlannerItemCachingMode);\r\nbegin\r\n  if FItemCachingMode <> Value then\r\n  begin\r\n    FItemCachingMode := Value;\r\n    UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetOrientationMode(const Value: TTMSFNCPlannerOrientationMode);\r\nbegin\r\n  if FOrientationMode <> Value then\r\n  begin\r\n    FOrientationMode := Value;\r\n    UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetRowH(const Value: TTMSFNCPlannerDoubleList);\r\nbegin\r\n  FRowH.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetRowP(const Value: TTMSFNCPlannerDoubleList);\r\nbegin\r\n  FRowP.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetRowHeights(Row: Integer; const Value: Double);\r\nvar\r\n  idx: Integer;\r\n  r: TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  idx := RowH.IndexOf(Row);\r\n  if (idx >= 0) and (idx <= RowH.Count - 1) then\r\n  begin\r\n    if Value = DefaultRowHeight then\r\n      RowH.Delete(idx)\r\n    else\r\n    begin\r\n      RowH[idx].Value := Max(0, Value);\r\n      RowH[idx].CellVal := Row;\r\n    end;\r\n  end\r\n  else if Value <> DefaultRowHeight then\r\n  begin\r\n    r := RowH.Add;\r\n    r.Value := Max(0, Value);\r\n    r.CellVal := Row;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetRowPos(Row: Integer; const Value: Double);\r\nvar\r\n  idx: Integer;\r\n  r: TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  idx := RowP.IndexOf(Row);\r\n  if (idx >= 0) and (idx <= RowP.Count - 1) then\r\n  begin\r\n    if Value = -1 then\r\n      RowP.Delete(idx)\r\n    else\r\n    begin\r\n      RowP[idx].Value := Max(0, Value);\r\n      RowP[idx].CellVal := Row;\r\n    end;\r\n  end\r\n  else if Value <> -1 then\r\n  begin\r\n    r := RowP.Add;\r\n    r.Value := Max(0, Value);\r\n    r.CellVal := Row;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetRowCount(const Value: Integer);\r\nbegin\r\n  if FRowCount <> Value then\r\n    FRowCount := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetScrollMode(\r\n  const Value: TTMSFNCPlannerScrollMode);\r\nbegin\r\n  if FScrollMode <> Value then\r\n  begin\r\n    FScrollMode := Value;\r\n    UpdatePlannerDisplay;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetStretchScrollBars(const Value: Boolean);\r\nbegin\r\n  if FStretchScrollBars <> Value then\r\n  begin\r\n    FStretchScrollBars := Value;\r\n    UpdatePlannerDisplay;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetVerticalScrollBarVisible(\r\n  const Value: Boolean);\r\nbegin\r\n  if FVerticalScrollBarVisible <> Value then\r\n  begin\r\n    FVerticalScrollBarVisible := Value;\r\n    UpdatePlannerCache(True);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.SetVScrollValue(AValue: Single);\r\nbegin\r\n {$IFDEF FMXLIB}\r\n  VerticalScrollBar.Value := Min(VerticalScrollBar.Max - VerticalScrollBar.ViewportSize, Max(0, AValue));\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  VerticalScrollBar.Position := Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  VerticalScrollBar.Position := Round(Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, AValue)));\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  VerticalScrollBar.Position := {%H-}Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  {$ELSE}\r\n  case ScrollMode of\r\n    smPixelScrolling: VerticalScrollBar.Position := {%H-}Min(VerticalScrollBar.Max, Max(0, Round(AValue + AValue * (VerticalScrollBar.PageSize / (VerticalScrollBar.Max - VerticalScrollBar.PageSize)))));\r\n    smCellScrolling: VerticalScrollBar.Position := {%H-}Min(VerticalScrollBar.Max - VerticalScrollBar.PageSize, Max(0, Round(AValue)));\r\n  end;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StartCol: Integer;\r\nbegin\r\n  Result := FStartCol;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StartRow: Integer;\r\nbegin\r\n  Result := FStartRow;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StartX: Double;\r\nbegin\r\n  Result := FStartX;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StartY: Double;\r\nbegin\r\n  Result := FStartY;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StopCol: Integer;\r\nbegin\r\n  Result := FStopCol;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StopRow: Integer;\r\nbegin\r\n  Result := FStopRow;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StopX: Double;\r\nbegin\r\n  Result := FStopX;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.StopY: Double;\r\nbegin\r\n  Result := FStopY;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.StretchColumn(ACol: Integer = -1; ANewWidth: Double = -1);\r\nvar\r\n  i: Integer;\r\n  w, nw, d: Double;\r\n  cnt: Integer;\r\n  horz, vert: TScrollBar;\r\n  stretch, stretchall: Boolean;\r\n  r: TRectF;\r\nbegin\r\n  stretch := True;\r\n  stretchall := True;\r\n  horz := HorizontalScrollBar;\r\n  vert := VerticalScrollBar;\r\n  if not Assigned(vert) or not Assigned(horz) then\r\n    Exit;\r\n\r\n  if ANewWidth = -1 then\r\n  begin\r\n    r := GetContentRect;\r\n    case OrientationMode of\r\n      pomHorizontal: nw := r.Bottom - r.Top;\r\n      pomVertical: nw := r.Right - r.Left;\r\n      else\r\n        nw := 0;\r\n    end;\r\n  end\r\n  else\r\n    nw := ANewWidth;\r\n\r\n  cnt := ColumnCount;\r\n\r\n  if ACol = - 1 then\r\n    ACol := cnt - 1;\r\n\r\n  if ACol >= cnt then\r\n    raise Exception.Create('Stretch column index out of range');\r\n\r\n  if (cnt = 0) or not stretch then\r\n    Exit;\r\n\r\n  if cnt = 1 then\r\n  begin\r\n    ColumnWidths[0] := nw;\r\n    Exit;\r\n  end;\r\n\r\n  w := 0;\r\n\r\n  if stretchall then\r\n  begin\r\n    if (cnt > 0) then\r\n    begin\r\n      d := nw;\r\n\r\n      w := d / cnt;\r\n\r\n      for i := 0 to cnt - 1 do\r\n        ColumnWidths[i] := w;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    for i := 0 to cnt - 1 do\r\n    begin\r\n      if i <> ACol then\r\n        w := w + ColumnWidths[i];\r\n    end;\r\n\r\n    ColumnWidths[ACol] := nw - w {- 1};\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.StretchRow(ARow: Integer = -1; ANewHeight: Double = -1);\r\nvar\r\n  i: Integer;\r\n  w, nw, d: Double;\r\n  cnt: Integer;\r\n  stretch, stretchall: Boolean;\r\n  r: TRectF;\r\nbegin\r\n  stretch := True;\r\n  stretchall := True;\r\n\r\n  if ANewHeight = -1 then\r\n  begin\r\n    r := GetContentRect;\r\n    case OrientationMode of\r\n      pomHorizontal: nw := r.Right - r.Left;\r\n      pomVertical: nw := r.Bottom - r.Top;\r\n      else\r\n        nw := 0;\r\n    end;\r\n  end\r\n  else\r\n    nw := ANewHeight;\r\n\r\n  cnt := RowCount;\r\n\r\n  if ARow = - 1 then\r\n    ARow := cnt - 1;\r\n\r\n  if ARow >= cnt then\r\n    raise Exception.Create('Stretch Row index out of range');\r\n\r\n  if (cnt = 0) or not stretch then\r\n    Exit;\r\n\r\n  if cnt = 1 then\r\n  begin\r\n    RowHeights[0] := nw;\r\n    Exit;\r\n  end;\r\n\r\n  w := 0;\r\n\r\n  if stretchall then\r\n  begin\r\n    if (cnt > 0) then\r\n    begin\r\n      d := nw;\r\n\r\n      w := d / cnt;\r\n      for i := 0 to cnt - 1 do\r\n        RowHeights[i] := w;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    for i := 0 to cnt - 1 do\r\n    begin\r\n      if i <> ARow then\r\n        w := w + RowHeights[i];\r\n    end;\r\n\r\n    RowHeights[ARow] := nw - w;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdateControlAfterResize;\r\nbegin\r\n  UpdatePlannerCache;\r\nend;\r\n\r\nfunction TTMSFNCPlannerBase.GetUpdateCount: Integer;\r\nbegin\r\n  Result := FUpdateCount;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdateVisualRange;\r\nvar\r\n  c, r: Integer;\r\n  xval, yval: Double;\r\n  cw, ch: Double;\r\n  vpos, hpos: Double;\r\n  cr: TRectF;\r\nbegin\r\n  hpos := GetHorizontalScrollPosition;\r\n  vpos := GetVerticalScrollPosition;\r\n  cr := GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      xval := -vpos;\r\n      yval := -hpos;\r\n      cw := cr.Bottom - cr.Top;\r\n      ch := cr.Right - cr.Left;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      xval := -hpos;\r\n      yval := -vpos;\r\n      cw := cr.Right - cr.Left;\r\n      ch := cr.Bottom - cr.Top;\r\n    end;\r\n    else\r\n    begin\r\n      xval := 0;\r\n      yval := 0;\r\n      cw := 0;\r\n      ch := 0;\r\n    end;\r\n  end;\r\n  FStartCol := -1;\r\n  FStartRow := -1;\r\n  FStopCol := -1;\r\n  FStopRow := -1;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      FStartX := cr.Top;\r\n      FStopX := cr.Top;\r\n      FStartY := cr.Left;\r\n      FStopY := cr.Left;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      FStartX := cr.Left;\r\n      FStopX := cr.Left;\r\n      FStartY := cr.Top;\r\n      FStopY := cr.Top;\r\n    end;\r\n  end;\r\n\r\n  for c := 0 to ColumnCount - 1 do\r\n  begin\r\n    xval := xval + ColumnWidths[c];\r\n    if (xval > 0) and (FStartCol = -1) then\r\n    begin\r\n      FStartCol := c;\r\n      FStartX := FStartX + int(xval - ColumnWidths[c]);\r\n    end;\r\n\r\n    if (xval >= cw) and (FStopCol = -1) then\r\n    begin\r\n      FStopCol := c;\r\n      FStopX := FStopX + int(xval);\r\n    end;\r\n\r\n    if (FStartCol > -1) and (FStopCol > -1) then\r\n      Break;\r\n  end;\r\n\r\n  for r := 0 to RowCount - 1 do\r\n  begin\r\n    yval := yval + RowHeights[r];\r\n    if (yval > 0) and (FStartRow = -1) then\r\n    begin\r\n      FStartRow := r;\r\n      FStartY := FStartY + int(yval - RowHeights[r]);\r\n    end;\r\n\r\n    if (yval >= ch) and (FStopRow = -1) then\r\n    begin\r\n      FStopRow := r;\r\n      FStopY := FStopY + int(yval);\r\n    end;\r\n\r\n    if (FStartRow > -1) and (FStopRow > -1) then\r\n      Break;\r\n  end;\r\n\r\n  if (FStartRow > -1) and (FStopRow = -1) then\r\n    FStopRow := RowCount - 1;\r\n\r\n  if (FStartCol > -1) and (FStopCol = -1) then\r\n    FStopCol := ColumnCount - 1;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdateDisplay;\r\nbegin\r\n  UpdateVisualRange;\r\n  if (ItemCachingMode = picmDelayedCaching) and (UpdateCount = 0) then\r\n    UpdateItemsCache;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdatePlannerCache(ADirtyItems: Boolean = True);\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  UpdateCalculations;\r\n  if ADirtyItems then\r\n    DirtyItems;\r\n\r\n  UpdateConflicts;\r\n  UpdateScrollBars;\r\n  UpdateVisualRange;\r\n  UpdateGridCache;\r\n  UpdateGroupsCache;\r\n  UpdatePositionsCache;\r\n  UpdateTimeLinesCache;\r\n  UpdateItemsCache;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdatePlannerDisplay;\r\nbegin\r\n  UpdateScrollBars;\r\n  UpdateDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerBase.UpdateScrollBars(AUpdate: Boolean = True; ACalculate: Boolean = True);\r\nvar\r\n  vs, hs: TScrollBar;\r\n  w, h: Double;\r\n  cw, ch: Double;\r\n  cr: TRectF;\r\n  vmgr: TTMSFNCMargins;\r\n  hmgr: TTMSFNCMargins;\r\nbegin\r\n  if (FBlockScrollingUpdate) or (UpdateCount > 0) or (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  FBlockScrollingUpdate := True;\r\n\r\n  if ACalculate then\r\n  begin\r\n    UpdateAutoSizing;\r\n    UpdateColumnRowCalculations;\r\n  end;\r\n\r\n  vs := VerticalScrollBar;\r\n  hs := HorizontalScrollBar;\r\n  if Assigned(vs) and Assigned(hs) then\r\n  begin\r\n    if AUpdate then\r\n      cr := GetCalculationRect\r\n    else\r\n      cr := GetContentRect;\r\n\r\n    cw := cr.Right - cr.Left;\r\n    ch := cr.Bottom - cr.Top;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        h := TotalColumnWidth;\r\n        w := TotalRowHeight;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        w := TotalColumnWidth;\r\n        h := TotalRowHeight;\r\n      end;\r\n      else\r\n      begin\r\n        w := 0;\r\n        h := 0;\r\n      end;\r\n    end;\r\n\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        hs.Visible := (w > 0) and (CompareValueEx(w, cw) = 1) and HorizontalScrollBarVisible;\r\n        vs.Visible := (h > 0) and (CompareValueEx(h, ch) = 1) and VerticalScrollBarVisible and not ColumnStretchingActive;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        hs.Visible := (w > 0) and (CompareValueEx(w, cw) = 1) and HorizontalScrollBarVisible and not ColumnStretchingActive;\r\n        vs.Visible := (h > 0) and (CompareValueEx(h, ch) = 1) and VerticalScrollBarVisible;\r\n      end;\r\n    end;\r\n\r\n    {$IFDEF CMNWEBLIB}\r\n    if vs.Visible then\r\n      vs.Parent := Self\r\n    else\r\n      vs.Parent := nil;\r\n\r\n    if hs.Visible then\r\n      hs.Parent := Self\r\n    else\r\n      hs.Parent := nil;\r\n    {$ENDIF}\r\n\r\n    vmgr := TTMSFNCMargins.Create;\r\n    hmgr := TTMSFNCMargins.Create;\r\n\r\n    if vs.Visible and StretchScrollBars then\r\n      hmgr.Right := vs.Width + 1\r\n    else\r\n      hmgr.Right := 1;\r\n\r\n    vmgr.Top := 1;\r\n    vmgr.Right := 1;\r\n    hmgr.Bottom := 1;\r\n    hmgr.Left := 1;\r\n\r\n    if hs.Visible then\r\n      vmgr.Bottom := hs.Height + 1\r\n    else\r\n      vmgr.Bottom := 1;\r\n\r\n    if not StretchScrollBars then\r\n    begin\r\n      cr := GetCalculationRect;\r\n      hmgr.Left := hmgr.Left + cr.Left;\r\n      hmgr.Right := hmgr.Right + (Width - cr.Right);\r\n      vmgr.Top := vmgr.Top + cr.Top;\r\n      vmgr.Bottom := vmgr.Bottom + (Height - cr.Bottom);\r\n    end;\r\n\r\n    {$IFDEF FMXLIB}\r\n    hs.Position.X := hmgr.Left;\r\n    hs.Position.Y := Height - hmgr.Bottom - hs.Height;\r\n    vs.Position.X := Width - vmgr.Right - vs.Width;\r\n    vs.Position.Y := vmgr.Top;\r\n    hs.Width := Width - hmgr.Right - hmgr.Left;\r\n    vs.Height := Height - vmgr.Bottom - vmgr.Top;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    hs.Left := Round(hmgr.Left);\r\n    hs.Top := Round(Height - hmgr.Bottom - hs.Height);\r\n    vs.Left := Round(Width - vmgr.Right - vs.Width);\r\n    vs.Top := Round(vmgr.Top);\r\n    hs.Width := Round(Max(0, Width - hmgr.Right - hmgr.Left));\r\n    vs.Height := Round(Max(0, Height - vmgr.Bottom - vmgr.Top));\r\n    {$IFDEF MSWINDOWS}\r\n    vs.Width := GetSystemMetrics(SM_CYVSCROLL);\r\n    hs.Height := GetSystemMetrics(SM_CYHSCROLL);\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    hmgr.Free;\r\n    vmgr.Free;\r\n\r\n    cr := GetContentRect;\r\n    cw := cr.Right - cr.Left;\r\n    ch := cr.Bottom - cr.Top;\r\n\r\n    {$IFDEF FMXLIB}\r\n    if ScrollMode = smCellScrolling then\r\n    begin\r\n      vs.ViewportSize := GetRowViewPortSize;\r\n      vs.Max := RowCount;\r\n    end\r\n    else\r\n    begin\r\n      vs.ViewPortSize := Min(h, ch);\r\n      vs.Max := h;\r\n      vs.SmallChange := Round(DefaultRowHeight);\r\n      vs.Value := Min(vs.Value, vs.Max - vs.ViewportSize);\r\n    end;\r\n\r\n    if ScrollMode = smCellScrolling then\r\n    begin\r\n      hs.ViewportSize := GetColumnViewPortSize;\r\n      hs.Max := ColumnCount;\r\n    end\r\n    else\r\n    begin\r\n      hs.ViewPortSize := Min(w, cw);\r\n      hs.Max := w;\r\n      hs.Value := Min(hs.Value, hs.Max - hs.ViewportSize);\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    if ScrollMode = smCellScrolling then\r\n    begin\r\n      vs.PageSize := Round(Max(0, GetRowViewPortSize));\r\n      vs.Max := Max(vs.PageSize, RowCount);\r\n    end\r\n    else\r\n    begin\r\n      vs.PageSize := Round(Max(0, Min(h, ch)));\r\n      vs.Max := Round(Max(0, h));\r\n      vs.SmallChange := Round(DefaultRowHeight);\r\n      vs.LargeChange := vs.PageSize;\r\n      vs.Position := Min(vs.Position, vs.Max);\r\n    end;\r\n\r\n    if ScrollMode = smCellScrolling then\r\n    begin\r\n      hs.PageSize := Round(Max(0, GetColumnViewPortSize));\r\n      hs.Max := Max(hs.PageSize, ColumnCount);\r\n    end\r\n    else\r\n    begin\r\n      hs.PageSize := Round(Max(0, Min(w, cw)));\r\n      hs.Max := Round(Max(hs.PageSize, w));\r\n      hs.Position := Min(hs.Position, hs.Max);\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  FBlockScrollingUpdate := False;\r\n\r\n  if AUpdate then\r\n    UpdateScrollBars(False)\r\n  else\r\n    UpdateScrollPosition(False);\r\nend;\r\n\r\n{ TTMSFNCPlannerDoubleListItem }\r\n\r\nconstructor TTMSFNCPlannerDoubleListItem.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  if Assigned(Collection) then\r\n    FOwner := (Collection as TTMSFNCPlannerDoubleList).FOwner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDoubleListItem.SetCellData(const Value: Double);\r\nbegin\r\n  FValue := Value;\r\nend;\r\n\r\n{ TTMSFNCPlannerDoubleList }\r\n\r\nfunction TTMSFNCPlannerDoubleList.Add: TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  Result := TTMSFNCPlannerDoubleListItem(inherited Add);\r\nend;\r\n\r\nconstructor TTMSFNCPlannerDoubleList.Create(AOwner: TTMSFNCPlannerBase);\r\nbegin\r\n  inherited Create(AOwner, TTMSFNCPlannerDoubleListItem);\r\n  FOwner := AOwner;\r\nend;\r\n\r\nfunction TTMSFNCPlannerDoubleList.GetItem(\r\n  Index: Integer): TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  Result := TTMSFNCPlannerDoubleListItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCPlannerDoubleList.IndexOf(ACellVal: Integer): Integer;\r\nvar\r\n  r: Integer;\r\nbegin\r\n  Result := -1;\r\n  for r := 0 to Count - 1 do\r\n  begin\r\n    if Items[r].CellVal = ACellVal then\r\n    begin\r\n      Result := r;\r\n      Exit;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerDoubleList.Insert(\r\n  Index: Integer): TTMSFNCPlannerDoubleListItem;\r\nbegin\r\n  Result := TTMSFNCPlannerDoubleListItem(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDoubleList.SetItem(Index: Integer;\r\n  const Value: TTMSFNCPlannerDoubleListItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nend.\r\n","{$mode objfpc}\r\n{$h+}\r\n{\r\n    This file is part of the Free Pascal run time library.\r\n    Copyright (c) 1999-2000 by the Free Pascal development team\r\n\r\n    Delphi/Kylix compatibility unit, provides Date/Time handling routines.\r\n\r\n    See the file COPYING.FPC, included in this distribution,\r\n    for details about the copyright.\r\n\r\n    This program is distributed in the hope that it will be useful,\r\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\r\n\r\n **********************************************************************}\r\n\r\nunit DateUtils;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Math;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Various constants\r\n  ---------------------------------------------------------------------}\r\n\r\nconst\r\n  DaysPerWeek        = 7;\r\n  WeeksPerFortnight  = 2;\r\n  MonthsPerYear      = 12;\r\n  YearsPerDecade     = 10;\r\n  YearsPerCentury    = 100;\r\n  YearsPerMillennium = 1000;\r\n\r\n  // ISO day numbers.\r\n  DayMonday    = 1;\r\n  DayTuesday   = 2;\r\n  DayWednesday = 3;\r\n  DayThursday  = 4;\r\n  DayFriday    = 5;\r\n  DaySaturday  = 6;\r\n  DaySunday    = 7;\r\n\r\n  // Fraction of a day\r\n  OneHour        = TDateTime(1)/HoursPerDay;\r\n  OneMinute      = TDateTime(1)/MinsPerDay;\r\n  OneSecond      = TDateTime(1)/SecsPerDay;\r\n  OneMillisecond = TDateTime(1)/MSecsPerDay;\r\n\r\n  { This is actual days per year but you need to know if it's a leap year}\r\n  DaysPerYear: array [Boolean] of Word = (365, 366);\r\n\r\n  { Used in RecodeDate, RecodeTime and RecodeDateTime for those datetime }\r\n  {  fields you want to leave alone }\r\n  RecodeLeaveFieldAsIs = 65535;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Global variables used in this unit\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n\r\n  { Average over a 4 year span. Valid for next 100 years }\r\n  ApproxDaysPerMonth: Double = 30.4375;\r\n  ApproxDaysPerYear: Double  = 365.25;\r\n\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Simple trimming functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateOf(const AValue: TDateTime): TDateTime;\r\nFunction TimeOf(const AValue: TDateTime): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Identification functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction IsInLeapYear(const AValue: TDateTime): Boolean;\r\nFunction IsPM(const AValue: TDateTime): Boolean;\r\nFunction IsValidDate(const AYear, AMonth, ADay: Word): Boolean;\r\nFunction IsValidTime(const AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nFunction IsValidDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nFunction IsValidDateDay(const AYear, ADayOfYear: Word): Boolean;\r\nFunction IsValidDateWeek(const AYear, AWeekOfYear, ADayOfWeek: Word): Boolean;\r\nFunction IsValidDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Enumeration functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeeksInYear(const AValue: TDateTime): Word;\r\nFunction WeeksInAYear(const AYear: Word): Word;\r\nFunction DaysInYear(const AValue: TDateTime): Word;\r\nFunction DaysInAYear(const AYear: Word): Word;\r\nFunction DaysInMonth(const AValue: TDateTime): Word;\r\nFunction DaysInAMonth(const AYear, AMonth: Word): Word;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Variations on current date/time.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction Today: TDateTime;\r\nFunction Yesterday: TDateTime;\r\nFunction Tomorrow: TDateTime;\r\nFunction IsToday(const AValue: TDateTime): Boolean;\r\nFunction IsSameDay(const AValue, ABasis: TDateTime): Boolean;\r\nfunction IsSameMonth(const Avalue, ABasis: TDateTime): Boolean;\r\nFunction PreviousDayOfWeek (DayOfWeek : Word) : Word;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Extraction functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearOf(const AValue: TDateTime): Word;\r\nFunction MonthOf(const AValue: TDateTime): Word;\r\nFunction WeekOf(const AValue: TDateTime): Word;\r\nFunction DayOf(const AValue: TDateTime): Word;\r\nFunction HourOf(const AValue: TDateTime): Word;\r\nFunction MinuteOf(const AValue: TDateTime): Word;\r\nFunction SecondOf(const AValue: TDateTime): Word;\r\nFunction MilliSecondOf(const AValue: TDateTime): Word;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheYear(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheYear(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAYear(const AYear: Word): TDateTime;\r\nFunction EndOfAYear(const AYear: Word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheMonth(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheMonth(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAMonth(const AYear, AMonth: Word): TDateTime;\r\nFunction EndOfAMonth(const AYear, AMonth: Word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheWeek(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheWeek(const AValue: TDateTime): TDateTime;\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // ADayOFWeek 1\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // const ADayOfWeek: Word = 7\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheDay(const AValue: TDateTime): TDateTime;\r\nFunction EndOfTheDay(const AValue: TDateTime): TDateTime;\r\nFunction StartOfADay(const AYear, AMonth, ADay: Word): TDateTime; overload;\r\nFunction StartOfADay(const AYear, ADayOfYear: Word): TDateTime; overload;\r\nFunction EndOfADay(const AYear, AMonth, ADay: Word): TDateTime; overload;\r\nFunction EndOfADay(const AYear, ADayOfYear: Word): TDateTime; overload;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MonthOfTheYear(const AValue: TDateTime): Word;\r\nFunction WeekOfTheYear(const AValue: TDateTime): Word; overload;\r\nFunction WeekOfTheYear(const AValue: TDateTime; out AYear: Word): Word; overload;\r\nFunction DayOfTheYear(const AValue: TDateTime): Word;\r\nFunction HourOfTheYear(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheYear(const AValue: TDateTime): LongWord;\r\nFunction SecondOfTheYear(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheYear(const AValue: TDateTime): NativeLargeInt;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime): Word; overload;\r\nFunction WeekOfTheMonth(const AValue: TDateTime; out AYear, AMonth: Word): Word; overload;\r\nFunction DayOfTheMonth(const AValue: TDateTime): Word;\r\nFunction HourOfTheMonth(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheMonth(const AValue: TDateTime): Word;\r\nFunction SecondOfTheMonth(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DayOfTheWeek(const AValue: TDateTime): Word;\r\nFunction HourOfTheWeek(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheWeek(const AValue: TDateTime): Word;\r\nFunction SecondOfTheWeek(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction HourOfTheDay(const AValue: TDateTime): Word;\r\nFunction MinuteOfTheDay(const AValue: TDateTime): Word;\r\nFunction SecondOfTheDay(const AValue: TDateTime): LongWord;\r\nFunction MilliSecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of hour functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MinuteOfTheHour(const AValue: TDateTime): Word;\r\nFunction SecondOfTheHour(const AValue: TDateTime): Word;\r\nFunction MilliSecondOfTheHour(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of minute functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction SecondOfTheMinute(const AValue: TDateTime): Word;\r\nFunction MilliSecondOfTheMinute(const AValue: TDateTime): LongWord;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of second functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MilliSecondOfTheSecond(const AValue: TDateTime): Word;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Range checking functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WithinPastYears(const ANow, AThen: TDateTime; const AYears: Integer): Boolean;\r\nFunction WithinPastMonths(const ANow, AThen: TDateTime; const AMonths: Integer): Boolean;\r\nFunction WithinPastWeeks(const ANow, AThen: TDateTime; const AWeeks: Integer): Boolean;\r\nFunction WithinPastDays(const ANow, AThen: TDateTime; const ADays: Integer): Boolean;\r\nFunction WithinPastHours(const ANow, AThen: TDateTime; const AHours: NativeLargeInt): Boolean;\r\nFunction WithinPastMinutes(const ANow, AThen: TDateTime; const AMinutes: NativeLargeInt): Boolean;\r\nFunction WithinPastSeconds(const ANow, AThen: TDateTime; const ASeconds: NativeLargeInt): Boolean;\r\nFunction WithinPastMilliSeconds(const ANow, AThen: TDateTime; const AMilliSeconds: NativeLargeInt): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Period functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\nFunction MonthsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\nFunction WeeksBetween(const ANow, AThen: TDateTime): Integer;\r\nFunction DaysBetween(const ANow, AThen: TDateTime): Integer;\r\nFunction HoursBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction MinutesBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction SecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nFunction MilliSecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nProcedure PeriodBetween(const ANow, AThen: TDateTime; Out Years, months, days : Word); \r\n\r\n{ ---------------------------------------------------------------------\r\n    Timespan in xxx functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{ YearSpan and MonthSpan are approximate values }\r\nFunction YearSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MonthSpan(const ANow, AThen: TDateTime): Double;\r\nFunction WeekSpan(const ANow, AThen: TDateTime): Double;\r\nFunction DaySpan(const ANow, AThen: TDateTime): Double;\r\nFunction HourSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MinuteSpan(const ANow, AThen: TDateTime): Double;\r\nFunction SecondSpan(const ANow, AThen: TDateTime): Double;\r\nFunction MilliSecondSpan(const ANow, AThen: TDateTime): Double;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Increment/decrement functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction IncYear(const AValue: TDateTime; const ANumberOfYears: Integer ): TDateTime;\r\nFunction IncYear(const AValue: TDateTime): TDateTime; // ; const ANumberOfYears: Integer = 1)\r\n// Function IncMonth is in SysUtils\r\nFunction IncWeek(const AValue: TDateTime; const ANumberOfWeeks: Integer): TDateTime;\r\nFunction IncWeek(const AValue: TDateTime): TDateTime; // ; const ANumberOfWeeks: Integer = 1)\r\nFunction IncDay(const AValue: TDateTime; const ANumberOfDays: Integer): TDateTime;\r\nFunction IncDay(const AValue: TDateTime): TDateTime; //; const ANumberOfDays: Integer = 1)\r\nFunction IncHour(const AValue: TDateTime; const ANumberOfHours: NativeLargeInt): TDateTime;\r\nFunction IncHour(const AValue: TDateTime): TDateTime; //; const ANumberOfHours: NativeLargeInt = 1\r\nFunction IncMinute(const AValue: TDateTime; const ANumberOfMinutes: NativeLargeInt): TDateTime;\r\nFunction IncMinute(const AValue: TDateTime): TDateTime; // ; const ANumberOfMinutes: NativeLargeInt = 1\r\nFunction IncSecond(const AValue: TDateTime; const ANumberOfSeconds: NativeLargeInt): TDateTime;\r\nFunction IncSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfSeconds: NativeLargeInt = 1\r\nFunction IncMilliSecond(const AValue: TDateTime; const ANumberOfMilliSeconds: NativeLargeInt): TDateTime;\r\nFunction IncMilliSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfMilliSeconds: NativeLargeInt = 1\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/Decode of complete timestamp\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nProcedure DecodeDateTime(const AValue: TDateTime; out AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word);\r\nFunction TryEncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of year and day of week\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word): TDateTime; //; const ADayOfWeek: Word = 1\r\nProcedure DecodeDateWeek(const AValue: TDateTime; out AYear, AWeekOfYear, ADayOfWeek: Word);\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime; const ADayOfWeek: Word): Boolean;\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime): Boolean; //; const ADayOfWeek: Word = 1\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying day of year\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateDay(const AYear, ADayOfYear: Word): TDateTime;\r\nProcedure DecodeDateDay(const AValue: TDateTime; out AYear, ADayOfYear: Word);\r\nFunction TryEncodeDateDay(const AYear, ADayOfYear: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of month\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): TDateTime;\r\nProcedure DecodeDateMonthWeek(const AValue: TDateTime; out AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nFunction TryEncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode time interval, allowing hours>24\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryEncodeTimeInterval(Hour, Min, Sec, MSec:word; Out Time : TDateTime) : boolean;\r\nfunction EncodeTimeInterval(Hour, Minute, Second, MilliSecond:word): TDateTime;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Replace given element with supplied value.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction RecodeYear(const AValue: TDateTime; const AYear: Word): TDateTime;\r\nFunction RecodeMonth(const AValue: TDateTime; const AMonth: Word): TDateTime;\r\nFunction RecodeDay(const AValue: TDateTime; const ADay: Word): TDateTime;\r\nFunction RecodeHour(const AValue: TDateTime; const AHour: Word): TDateTime;\r\nFunction RecodeMinute(const AValue: TDateTime; const AMinute: Word): TDateTime;\r\nFunction RecodeSecond(const AValue: TDateTime; const ASecond: Word): TDateTime;\r\nFunction RecodeMilliSecond(const AValue: TDateTime; const AMilliSecond: Word): TDateTime;\r\nFunction RecodeDate(const AValue: TDateTime; const AYear, AMonth, ADay: Word): TDateTime;\r\nFunction RecodeTime(const AValue: TDateTime; const AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nFunction RecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nFunction TryRecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AResult: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Comparision of date/time\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction CompareDateTime(const A, B: TDateTime): TValueRelationship;\r\nFunction CompareDate(const A, B: TDateTime): TValueRelationship;\r\nFunction CompareTime(const A, B: TDateTime): TValueRelationship;\r\nFunction SameDateTime(const A, B: TDateTime): Boolean;\r\nFunction SameDate(const A, B: TDateTime): Boolean;\r\nFunction SameTime(const A, B: TDateTime): Boolean;\r\n\r\n{ For a given date these Functions tell you the which day of the week of the\r\n  month (or year).  If its a Thursday, they will tell you if its the first,\r\n  second, etc Thursday of the month (or year).  Remember, even though its\r\n  the first Thursday of the year it doesn't mean its the first week of the\r\n  year.  See ISO 8601 above for more information. }\r\n\r\nFunction NthDayOfWeek(const AValue: TDateTime): Word;\r\n\r\nProcedure DecodeDayOfWeekInMonth(const AValue: TDateTime; out AYear, AMonth, ANthDayOfWeek, ADayOfWeek: Word);\r\n\r\nFunction EncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word): TDateTime;\r\nFunction TryEncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Exception throwing routines\r\n  ---------------------------------------------------------------------}\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; const ABaseDate: TDateTime);\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word); // const ABaseDate: TDateTime = 0\r\nProcedure InvalidDateWeekError(const AYear, AWeekOfYear, ADayOfWeek: Word);\r\nProcedure InvalidDateDayError(const AYear, ADayOfYear: Word);\r\nProcedure InvalidDateMonthWeekError(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nProcedure InvalidDayOfWeekInMonthError(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word);\r\n\r\n{ ---------------------------------------------------------------------\r\n    Julian and Modified Julian Date conversion support\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToJulianDate(const AValue: TDateTime): Double;\r\nFunction JulianDateToDateTime(const AValue: Double): TDateTime;\r\nFunction TryJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\n\r\nFunction DateTimeToModifiedJulianDate(const AValue: TDateTime): Double;\r\nFunction ModifiedJulianDateToDateTime(const AValue: Double): TDateTime;\r\nFunction TryModifiedJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Unix timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToUnix(const AValue: TDateTime): NativeLargeInt;\r\nFunction UnixToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nFunction UnixTimeStampToMac(const AValue: NativeLargeInt): NativeLargeInt;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Mac timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToMac(const AValue: TDateTime): NativeLargeInt;\r\nFunction MacToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nFunction MacTimeStampToUnix(const AValue: NativeLargeInt): NativeLargeInt;\r\n\r\n{ .....................................................................\r\n    Dos <-> Delphi datetime support\r\n  .....................................................................}\r\n\r\nFunction DateTimeToDosDateTime(const AValue: TDateTime): longint;\r\nFunction DosDateTimeToDateTime( AValue: longint): TDateTime;\r\n\r\n{ UTC <-> Local time }\r\n\r\nFunction UniversalTimeToLocal(UT: TDateTime): TDateTime;\r\nFunction UniversalTimeToLocal(UT: TDateTime; TZOffset : Integer): TDateTime;\r\nFunction LocalTimeToUniversal(LT: TDateTime): TDateTime;\r\nFunction LocalTimeToUniversal(LT: TDateTime; TZOffset: Integer): TDateTime;\r\n\r\n{ RFC 3339 support }\r\n\r\nFunction DateTimeToRFC3339(ADate :TDateTime):string;\r\nFunction DateToRFC3339(ADate :TDateTime):string;\r\nFunction TimeToRFC3339(ADate :TDateTime):string;\r\nFunction TryRFC3339ToDateTime(const Avalue: String; out ADateTime: TDateTime): Boolean;\r\nFunction RFC3339ToDateTime(const Avalue: String): TDateTime;\r\n\r\nType\r\n  {\r\n    Inverse of formatdatetime, destined for the dateutils unit of FPC.\r\n\r\n    Limitations/implementation details:\r\n    - An inverse of FormatDateTime is not 100% an inverse, simply because one can put e.g. time tokens twice in the format string,\r\n         and scandatetime wouldn't know which time to pick.\r\n    - Strings like hn can't be reversed safely. E.g. 1:2 (2 minutes after 1) delivers 12 which is parsed as 12:00 and then\r\n         misses chars for the \"n\" part.\r\n    - trailing characters are ignored.\r\n    - no support for Eastern Asian formatting characters since they are windows only.\r\n    - no MBCS support.\r\n\r\n    Extensions\r\n    - #9 eats whitespace.\r\n    - whitespace at the end of a pattern is optional.\r\n    - ? matches any char.\r\n    - Quote the above chars to really match the char.\r\n  }\r\n\r\n  { TDateTimeScanner }\r\n\r\n  TDateTimeScanner = Class\r\n  Private\r\n    FPattern: String;\r\n    FText: String;\r\n    FPatternOffset,\r\n    FLen,FPatternLen: Integer;\r\n    FPatternPos,FPos : Integer;\r\n    FY,FM,FD : Word;\r\n    FTimeval : TDateTime;\r\n    procedure ArrayMatchError;\r\n    procedure DoDateTime;\r\n    procedure SetPattern(AValue: String);\r\n    procedure SetText(AValue: String);\r\n    function ScanFixedInt(maxv:integer):integer;\r\n    function ScanPatternLength :integer;\r\n    procedure MatchChar(c:char);\r\n    function FindIMatch(const values :array of string; aTerm : string):integer;\r\n    function FindMatch(const Values : array of string):integer;\r\n    Procedure MatchPattern(const aPattern : String);\r\n    Procedure DoYear;\r\n    Procedure DoMonth;\r\n    Procedure DoDay;\r\n    Procedure DoTime;\r\n    Procedure DoAMPM;\r\n  Public\r\n    Function Scan(StartPos: integer = -1) : TDateTime;\r\n    property Pattern : String Read FPattern Write SetPattern;\r\n    Property Text : String Read FText Write SetText;\r\n    Property PatternOffset : Integer Read FPatternOffset;\r\n    Property Position: Integer read FPos;\r\n  end;\r\n\r\n  // Easy access function\r\nFunction ScanDateTime(APattern,AValue: String; APos : integer = 1) : TDateTime;\r\n\r\nimplementation\r\n\r\nuses js, rtlconsts;\r\n\r\nconst\r\n  TDateTimeEpsilon = 2.2204460493e-16;\r\n  HalfMilliSecond = OneMillisecond /2 ;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Simple trimming functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateOf(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(AValue);\r\nend;\r\n\r\n\r\nFunction TimeOf(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Frac(Avalue);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Identification functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction IsInLeapYear(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=IsLeapYear(YearOf(AValue));\r\nend;\r\n\r\n\r\nFunction IsPM(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=(HourOf(AValue)>=12);\r\nend;\r\n\r\n\r\nFunction IsValidMonth(AMonth : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(AMonth>=1) and (AMonth<=12);\r\nend;\r\n\r\nFunction IsValidDayOfWeek(ADayOfWeek : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(ADayOfWeek>=1) and (ADayOfWeek<=7);\r\nend;\r\n\r\nFunction IsValidWeekOfMonth(AWeekOfMonth : Word) : Boolean;\r\n\r\nbegin\r\n  Result:=(AWeekOfMonth>=1) and (AWeekOfMonth<=5);\r\nend;\r\n\r\nFunction IsValidDate(const AYear, AMonth, ADay: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidMonth(AMonth)\r\n          and (ADay<>0) and (ADay<=MonthDays[IsleapYear(AYear),AMonth]);\r\nend;\r\n\r\n\r\nFunction IsValidTime(const AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nbegin\r\n  Result:=(AHour=HoursPerDay) and (AMinute=0) and (ASecond=0) and (AMillisecond=0);\r\n  Result:=Result or\r\n          ((AHour<HoursPerDay) and (AMinute<MinsPerHour) and (ASecond<SecsPerMin) and\r\n           (AMillisecond<MSecsPerSec));\r\nend;\r\n\r\n\r\nFunction IsValidDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): Boolean;\r\nbegin\r\n  Result:=IsValidDate(AYear,AMonth,ADay) and\r\n          IsValidTime(AHour,AMinute,ASecond,AMillisecond)\r\nend;\r\n\r\n\r\nFunction IsValidDateDay(const AYear, ADayOfYear: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (ADayOfYear<>0) and (AYear<10000) and\r\n          (ADayOfYear<=DaysPerYear[IsLeapYear(AYear)]);\r\nend;\r\n\r\n\r\nFunction IsValidDateWeek(const AYear, AWeekOfYear, ADayOfWeek: Word): Boolean;\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidDayOfWeek(ADayOfWeek)\r\n          and (AWeekOfYear<>0)\r\n          and (AWeekOfYear<=WeeksInaYear(AYear));\r\n  { should we not also check whether the day of the week is not\r\n    larger than the last day of the last week in the year 9999 ?? }\r\nend;\r\n\r\n\r\nFunction IsValidDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): Boolean;\r\n\r\nbegin\r\n  Result:=(AYear<>0) and (AYear<10000)\r\n          and IsValidMonth(AMonth)\r\n          and IsValidWeekOfMonth(AWeekOfMonth)\r\n          and IsValidDayOfWeek(ADayOfWeek);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Enumeration functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WeeksInYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=WeeksInAYear(YearOf(AValue));\r\nend;\r\n\r\n\r\nFunction WeeksInAYear(const AYear: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  Result:=52;\r\n  DOW:=DayOfTheWeek(StartOfAYear(AYear));\r\n  If (DOW=4) or ((DOW=3) and IsLeapYear(AYear)) then\r\n    Inc(Result);\r\nend;\r\n\r\n\r\nFunction DaysInYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=DaysPerYear[IsLeapYear(YearOf(AValue))];\r\nend;\r\n\r\n\r\nFunction DaysInAYear(const AYear: Word): Word;\r\nbegin\r\n  Result:=DaysPerYear[Isleapyear(AYear)];\r\nend;\r\n\r\n\r\nFunction DaysInMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  Decodedate(AValue,Y,M,D);\r\n  Result:=MonthDays[IsLeapYear(Y),M];\r\nend;\r\n\r\n\r\nFunction DaysInAMonth(const AYear, AMonth: Word): Word;\r\nbegin\r\n  Result:=MonthDays[IsLeapYear(AYear),AMonth];\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Variations on current date/time.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction Today: TDateTime;\r\nbegin\r\n  Result:=Date();\r\nend;\r\n\r\n\r\nFunction Yesterday: TDateTime;\r\nbegin\r\n  Result:=Date()-1;\r\nend;\r\n\r\n\r\nFunction Tomorrow: TDateTime; \r\nbegin\r\n  Result:=Date()+1;\r\nend;\r\n\r\n\r\nFunction IsToday(const AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=IsSameDay(AValue,Date());\r\nend;\r\n\r\n\r\nFunction IsSameDay(const AValue, ABasis: TDateTime): Boolean;\r\n\r\nVar\r\n  D : TDateTime;\r\n\r\nbegin\r\n  D:=AValue-Trunc(ABasis);\r\n  Result:=(D>=0) and (D<1);\r\nend;\r\n\r\nfunction IsSameMonth(const Avalue, ABasis: TDateTime): Boolean;\r\nbegin\r\n     result:=( YearOf(Avalue) = YearOf(Abasis) );\r\n     result:=result and ( MonthOf(AValue) = MonthOf(ABasis) );\r\nend;\r\n\r\nconst\r\n  DOWMap: array [1..7] of Word = (7, 1, 2, 3, 4, 5, 6);\r\n\r\nFunction PreviousDayOfWeek (DayOfWeek : Word) : Word;\r\n\r\nbegin\r\n  If Not IsValidDayOfWeek(DayOfWeek) then\r\n    Raise EConvertError.CreateFmt(SErrInvalidDayOfWeek,[DayOfWeek]);\r\n  Result:=DOWMap[DayOfWeek];\r\nend;\r\n\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Extraction functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction YearOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  D,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Result,D,M);\r\nend;\r\n\r\n\r\nFunction MonthOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,Result,D);\r\nend;\r\n\r\n\r\nFunction WeekOf(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=WeekOfTheYear(AValue);\r\nend;\r\n\r\n\r\nFunction DayOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,Result);\r\nend;\r\n\r\n\r\nFunction HourOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,Result,N,S,MS);\r\nend;\r\n\r\n\r\nFunction MinuteOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,Result,S,MS);\r\nend;\r\n\r\n\r\nFunction SecondOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,N,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,N,Result,MS);\r\nend;\r\n\r\n\r\nFunction MilliSecondOf(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,N,S : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,N,S,Result);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheYear(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(YearOf(AValue),1,1);\r\nend;\r\n\r\n\r\nFunction EndOfTheYear(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EncodeDateTime(YearOf(AValue),12,31,23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfAYear(const AYear: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,1,1);\r\nend;\r\n\r\n\r\nFunction EndOfAYear(const AYear: Word): TDateTime;\r\n\r\nbegin\r\n  Result:=(EncodeDateTime(AYear,12,31,23,59,59,999));\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheMonth(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDate(Y,M,1);\r\n//  MonthDays[IsLeapYear(Y),M])\r\nend;\r\n\r\n\r\nFunction EndOfTheMonth(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDateTime(Y,M,MonthDays[IsLeapYear(Y),M],23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfAMonth(const AYear, AMonth: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,AMonth,1);\r\nend;\r\n\r\n\r\nFunction EndOfAMonth(const AYear, AMonth: Word): TDateTime;\r\n\r\nbegin\r\n  Result:=EncodeDateTime(AYear,AMonth,MonthDays[IsLeapYear(AYear),AMonth],23,59,59,999);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction StartOfTheWeek(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(AValue)-DayOfTheWeek(AValue)+1;\r\nend;\r\n\r\n\r\nFunction EndOfTheWeek(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=EndOfTheDay(AValue-DayOfTheWeek(AValue)+7);\r\nend;\r\n\r\n\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDateWeek(AYear,AWeekOfYear,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction StartOfAWeek(const AYear, AWeekOfYear: Word): TDateTime;  // ADayOFWeek 1\r\nbegin\r\n  Result:=StartOfAWeek(AYear,AWeekOfYear,1)\r\nend;\r\n\r\n\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  Result := EndOfTheDay(EncodeDateWeek(AYear, AWeekOfYear, ADayOfWeek));\r\nend;\r\n\r\n\r\nFunction EndOfAWeek(const AYear, AWeekOfYear: Word): TDateTime; // const ADayOfWeek: Word = 7\r\n\r\n\r\nbegin\r\n  Result:=EndOfAWeek(AYear,AWeekOfYear,7);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Start/End of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction StartOfTheDay(const AValue: TDateTime): TDateTime;\r\nbegin\r\n  Result:=Trunc(Avalue);\r\nend;\r\n\r\n\r\nFunction EndOfTheDay(const AValue: TDateTime): TDateTime;\r\n\r\nVar\r\n  Y,M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,D);\r\n  Result:=EncodeDateTime(Y,M,D,23,59,59,999);\r\nend;\r\n\r\n\r\nFunction StartOfADay(const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result:=EncodeDate(AYear,AMonth,ADay);\r\nend;\r\n\r\n\r\nFunction StartOfADay(const AYear, ADayOfYear: Word): TDateTime;\r\nbegin\r\n  Result:=StartOfAYear(AYear)+ADayOfYear-1;\r\nend;\r\n\r\n\r\nFunction EndOfADay(const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result:=EndOfTheDay(EncodeDate(AYear,AMonth,ADay));\r\nend;\r\n\r\n\r\nFunction EndOfADay(const AYear, ADayOfYear: Word): TDateTime;\r\n\r\n\r\nbegin\r\n  Result:=StartOfAYear(AYear)+ADayOfYear-1+EncodeTime(23,59,59,999);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of year functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction MonthOfTheYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MonthOf(AValue);\r\nend;\r\n\r\n\r\nFunction WeekOfTheYear(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,DOW : Word;\r\n\r\nbegin\r\n  DecodeDateWeek(AValue,Y,Result,DOW)\r\nend;\r\n\r\n\r\nFunction WeekOfTheYear(const AValue: TDateTime; out AYear: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  DecodeDateWeek(AValue,AYear,Result,DOW);\r\nend;\r\n\r\n\r\nFunction DayOfTheYear(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=Trunc(AValue-StartOfTheYear(AValue)+1);\r\nend;\r\n\r\n\r\nFunction HourOfTheYear(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=H+((DayOfTheYear(AValue)-1)*24);\r\nend;\r\n\r\n\r\nFunction MinuteOfTheYear(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=M+(H+((DayOfTheYear(AValue)-1)*24))*60;\r\nend;\r\n\r\n\r\nFunction SecondOfTheYear(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(M+(H+((DayOfTheYear(AValue)-1)*24))*60)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheYear(const AValue: TDateTime): NativeLargeInt;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((M+(H+((NativeLargeInt(DayOfTheYear(AValue))-1)*24))*60)*60+S)*1000+MS;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of month functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nvar\r\n  Y,M,DOW : word;\r\n\r\nbegin\r\n  DecodeDateMonthWeek(AValue,Y,M,Result,DOW);\r\nend;\r\n\r\n\r\nFunction WeekOfTheMonth(const AValue: TDateTime; out AYear, AMonth: Word): Word;\r\n\r\nVar\r\n  DOW : Word;\r\n\r\nbegin\r\n  DecodeDateMonthWeek(AValue,AYear,AMonth,Result,DOW);\r\nend;\r\n\r\n\r\nFunction DayOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,Y,M,Result);\r\nend;\r\n\r\n\r\nFunction HourOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=(D-1)*24+H;\r\nend;\r\n\r\n\r\nFunction MinuteOfTheMonth(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=((D-1)*24+H)*60+N;\r\nend;\r\n\r\n\r\nFunction SecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=(((D-1)*24+H)*60+N)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheMonth(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Result:=((((D-1)*24+H)*60+N)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of week functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction DayOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nbegin\r\n  Result:=DowMAP[DayOfWeek(AValue)];\r\nend;\r\n\r\n\r\nFunction HourOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(DayOfTheWeek(AValue)-1)*24+H;\r\nend;\r\n\r\n\r\nFunction MinuteOfTheWeek(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((DayOfTheWeek(AValue)-1)*24+H)*60+M;\r\nend;\r\n\r\n\r\nFunction SecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(((DayOfTheWeek(AValue)-1)*24+H)*60+M)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheWeek(const AValue: TDateTime): LongWord;\r\n\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((((DayOfTheWeek(AValue)-1)*24+H)*60+M)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of day functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction HourOfTheDay(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=HourOf(AValue);\r\nend;\r\n\r\n\r\nFunction MinuteOfTheDay(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(H*60)+M;\r\nend;\r\n\r\n\r\nFunction SecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=((H*60)+M)*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheDay(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,M,S,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(((H*60)+M)*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of hour functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction MinuteOfTheHour(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MinuteOf(AValue);\r\nend;\r\n\r\n\r\nFunction SecondOfTheHour(const AValue: TDateTime): Word;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=M*60+S;\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheHour(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=(M*60+S)*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of minute functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction SecondOfTheMinute(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=SecondOf(AValue);\r\nend;\r\n\r\n\r\nFunction MilliSecondOfTheMinute(const AValue: TDateTime): LongWord;\r\n\r\nVar\r\n  H,S,M,MS : Word;\r\n\r\nbegin\r\n  DecodeTime(AValue,H,M,S,MS);\r\n  Result:=S*1000+MS;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Part of second functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction MilliSecondOfTheSecond(const AValue: TDateTime): Word;\r\nbegin\r\n  Result:=MilliSecondOf(AValue);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Range checking functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction WithinPastYears(const ANow, AThen: TDateTime; const AYears: Integer): Boolean;\r\nbegin\r\n  Result:=YearsBetween(ANow,AThen)<=AYears;\r\nend;\r\n\r\n\r\nFunction WithinPastMonths(const ANow, AThen: TDateTime; const AMonths: Integer): Boolean;\r\nbegin\r\n  Result:=MonthsBetween(ANow,AThen)<=AMonths;\r\nend;\r\n\r\n\r\nFunction WithinPastWeeks(const ANow, AThen: TDateTime; const AWeeks: Integer): Boolean;\r\nbegin\r\n  Result:=WeeksBetween(ANow,AThen)<=AWeeks;\r\nend;\r\n\r\n\r\nFunction WithinPastDays(const ANow, AThen: TDateTime; const ADays: Integer): Boolean;\r\nbegin\r\n  Result:=DaysBetween(ANow,AThen)<=ADays;\r\nend;\r\n\r\n\r\nFunction WithinPastHours(const ANow, AThen: TDateTime; const AHours: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=HoursBetween(ANow,AThen)<=AHours;\r\nend;\r\n\r\n\r\nFunction WithinPastMinutes(const ANow, AThen: TDateTime; const AMinutes: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=MinutesBetween(ANow,AThen)<=AMinutes;\r\nend;\r\n\r\n\r\nFunction WithinPastSeconds(const ANow, AThen: TDateTime; const ASeconds: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=SecondsBetween(ANow,Athen)<=ASeconds;\r\nend;\r\n\r\n\r\nFunction WithinPastMilliSeconds(const ANow, AThen: TDateTime; const AMilliSeconds: NativeLargeInt): Boolean;\r\nbegin\r\n  Result:=MilliSecondsBetween(ANow,AThen)<=AMilliSeconds;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Period functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{\r\n  These functions are declared as approximate by Borland.\r\n  A bit strange, since it can be calculated exactly ?\r\n\r\n  -- No, because you need rounding or truncating (JM)\r\n}\r\n\r\n\r\nFunction DateTimeDiff(const ANow, AThen: TDateTime): TDateTime;\r\nbegin\r\n  Result:= ANow - AThen;\r\n  if (ANow>0) and (AThen<0) then\r\n    Result:=Result-0.5\r\n  else if (ANow<-1.0) and (AThen>-1.0) then\r\n    Result:=Result+0.5;\r\nend;\r\n\r\n\r\nFunction YearsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\n\r\nvar\r\n  yy, mm, dd: Word;\r\n  \r\nbegin\r\n  if AExact and (ANow >= -DateDelta) and (AThen >= -DateDelta) and\r\n     (ANow <= MaxDateTime) and (AThen <= MaxDateTime) then\r\n    begin\r\n    PeriodBetween(ANow, AThen, yy , mm, dd);\r\n    Result := yy;\r\n    end\r\n  else\r\n    Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)/ApproxDaysPerYear);\r\nend;\r\n\r\n\r\nFunction MonthsBetween(const ANow, AThen: TDateTime; AExact : Boolean = False): Integer;\r\n\r\nvar\r\n  y, m, d: Word;\r\n\r\nbegin\r\n  if AExact and (ANow >= -DateDelta) and (AThen >= -DateDelta) and\r\n     (ANow <= MaxDateTime) and (AThen <= MaxDateTime) then\r\n    begin\r\n    PeriodBetween(ANow, AThen, y, m, d);\r\n    Result := y*12 + m;\r\n    end\r\n  else\r\n    Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)/ApproxDaysPerMonth);\r\nend;\r\n\r\n\r\nFunction WeeksBetween(const ANow, AThen: TDateTime): Integer;\r\nbegin\r\n  Result:=Trunc(Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond) div 7;\r\nend;\r\n\r\n\r\nFunction DaysBetween(const ANow, AThen: TDateTime): Integer;\r\nbegin\r\n  Result:=Trunc(Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond);\r\nend;\r\n\r\n\r\nFunction HoursBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*HoursPerDay);\r\nend;\r\n\r\n\r\nFunction MinutesBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*MinsPerDay);\r\nend;\r\n\r\n\r\nFunction SecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*SecsPerDay);\r\nend;\r\n\r\n\r\nFunction MilliSecondsBetween(const ANow, AThen: TDateTime): NativeLargeInt;\r\nbegin\r\n  Result:=Trunc((Abs(DateTimeDiff(ANow,AThen))+HalfMilliSecond)*MSecsPerDay);\r\nend;\r\n\r\nProcedure PeriodBetween(Const ANow, AThen: TDateTime; Out Years, months, days : Word); \r\n\r\nvar\r\n  Y1, Y2, M1, M2, D1, D2: word;\r\n\r\nbegin\r\n  if (AThen>ANow) then\r\n    begin\r\n    DecodeDate(ANow,Y1,M1,D1);\r\n    DecodeDate(AThen,Y2,M2,D2);\r\n    end\r\n  else\r\n    begin  \r\n    DecodeDate(AThen,Y1,M1,D1);\r\n    DecodeDate(ANow,Y2,M2,D2);\r\n    end;\r\n  Years:=Y2-Y1;\r\n  if (M1>M2) or ((M1=M2) and (D1>D2)) then Dec(Years);\r\n  if (M1>M2) then Inc(M2,12); //already adjusted Years in that case\r\n  Months:=M2-M1;\r\n  if (D2>=D1) then\r\n    Days:=D2-D1\r\n  else\r\n    begin\r\n    if (Months=0) then\r\n      Months:=11\r\n    else\r\n      Dec(Months);\r\n    Days:=(DaysInAMonth(Y1,M1)-D1)+D2;\r\n    end;\r\nend;                    \r\n\r\n{ ---------------------------------------------------------------------\r\n    Timespan in xxx functions.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction YearSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))/ApproxDaysPerYear;\r\nend;\r\n\r\n\r\nFunction MonthSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))/ApproxDaysPerMonth;\r\nend;\r\n\r\n\r\nFunction WeekSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen)) / 7\r\nend;\r\n\r\n\r\nFunction DaySpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen));\r\nend;\r\n\r\n\r\nFunction HourSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*HoursPerDay;\r\nend;\r\n\r\n\r\nFunction MinuteSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*MinsPerDay;\r\nend;\r\n\r\n\r\nFunction SecondSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*SecsPerDay;\r\nend;\r\n\r\n\r\nFunction MilliSecondSpan(const ANow, AThen: TDateTime): Double;\r\nbegin\r\n  Result:=Abs(DateTimeDiff(ANow,AThen))*MSecsPerDay;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Increment/decrement functions.\r\n  ---------------------------------------------------------------------}\r\n\r\n{ TDateTime is not defined in the interval [-1.0..0.0[. Additionally, when\r\n  negative the time part must be treated using its absolute value (0.25 always\r\n  means \"6 a.m.\") -> skip the gap and convert the time part when crossing the\r\n  gap -- and take care of rounding errors }\r\nProcedure MaybeSkipTimeWarp(OldDate: TDateTime; var NewDate: TDateTime);\r\nbegin\r\n  if (OldDate>=0) and (NewDate<-TDateTimeEpsilon) then\r\n    NewDate:=int(NewDate-1.0+TDateTimeEpsilon)-frac(1.0+frac(NewDate))\r\n  else if (OldDate<=-1.0) and (NewDate>-1.0+TDateTimeEpsilon) then\r\n    NewDate:=int(NewDate+1.0-TDateTimeEpsilon)+frac(1.0-abs(frac(1.0+NewDate)));\r\nend;\r\n\r\n\r\nfunction IncNegativeTime(AValue, Addend: TDateTime): TDateTime;\r\nvar\r\n  newtime: tdatetime;\r\nbegin\r\n  newtime:=-frac(Avalue)+frac(Addend);\r\n  { handle rounding errors }\r\n  if SameValue(newtime,int(newtime)+1,TDateTimeEpsilon) then\r\n    newtime:=int(newtime)+1\r\n  else if SameValue(newtime,int(newtime),TDateTimeEpsilon) then\r\n    newtime:=int(newtime);\r\n  { time underflow -> previous day }\r\n  if newtime<-TDateTimeEpsilon then\r\n    begin\r\n      newtime:=1.0+newtime;\r\n      avalue:=int(avalue)-1;\r\n    end\r\n  { time overflow -> next day }\r\n  else if newtime>=1.0-TDateTimeEpsilon then\r\n    begin\r\n      newtime:=newtime-1.0;\r\n      avalue:=int(avalue)+1;\r\n    end;\r\n  Result:=int(AValue)+int(Addend)-newtime;\r\nend;\r\n\r\nFunction IncYear(const AValue: TDateTime; const ANumberOfYears: Integer ): TDateTime;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  Y:=Y+ANumberOfYears;\r\n  If (M=2) and (D=29) And (Not IsLeapYear(Y)) then\r\n    D:=28;\r\n  Result:=EncodeDateTime(Y,M,D,H,N,S,MS);\r\nend;\r\n\r\n\r\nFunction IncYear(const AValue: TDateTime): TDateTime; // ; const ANumberOfYears: Integer = 1)\r\nbegin\r\n  Result:=IncYear(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncWeek(const AValue: TDateTime; const ANumberOfWeeks: Integer): TDateTime;\r\nbegin\r\n  Result:=AValue+ANumberOfWeeks*7;\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncWeek(const AValue: TDateTime): TDateTime; // ; const ANumberOfWeeks: Integer = 1)\r\nbegin\r\n  Result:=IncWeek(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncDay(const AValue: TDateTime; const ANumberOfDays: Integer): TDateTime;\r\nbegin\r\n  Result:=AValue+ANumberOfDays;\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncDay(const AValue: TDateTime): TDateTime; //; const ANumberOfDays: Integer = 1)\r\nbegin\r\n  Result:=IncDay(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncHour(const AValue: TDateTime; const ANumberOfHours: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfHours/HoursPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfHours/HoursPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncHour(const AValue: TDateTime): TDateTime; //; const ANumberOfHours: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncHour(AValue,1);\r\nend;\r\n\r\n\r\nFunction IncMinute(const AValue: TDateTime; const ANumberOfMinutes: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfMinutes/MinsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfMinutes/MinsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncMinute(const AValue: TDateTime): TDateTime; // ; const ANumberOfMinutes: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncMinute(AValue,1);\r\nend;\r\n\r\n\r\nFunction IncSecond(const AValue: TDateTime; const ANumberOfSeconds: NativeLargeInt): TDateTime;\r\nbegin\r\n  if AValue>=0 then\r\n    Result:=AValue+ANumberOfSeconds/SecsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfSeconds/SecsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfSeconds: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncSecond(Avalue,1);\r\nend;\r\n\r\n\r\nFunction IncMilliSecond(const AValue: TDateTime; const ANumberOfMilliSeconds: NativeLargeInt): TDateTime;\r\nbegin\r\n  if Avalue>=0 then\r\n    Result:=AValue+ANumberOfMilliSeconds/MSecsPerDay\r\n  else\r\n    Result:=IncNegativeTime(Avalue,ANumberOfMilliSeconds/MSecsPerDay);\r\n  MaybeSkipTimeWarp(AValue,Result);\r\nend;\r\n\r\n\r\nFunction IncMilliSecond(const AValue: TDateTime): TDateTime; // ; const ANumberOfMilliSeconds: NativeLargeInt = 1\r\nbegin\r\n  Result:=IncMilliSecond(AValue,1);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/Decode of complete timestamp\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction EncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateTime(AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond,Result) then\r\n    InvalidDateTimeError(AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond)\r\nend;\r\n\r\n\r\nProcedure DecodeDateTime(const AValue: TDateTime; out AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word);\r\nbegin\r\n  DecodeTime(AValue,AHour,AMinute,ASecond,AMilliSecond);\r\n  if AHour=24 then // can happen due rounding issues mantis 17123\r\n    begin\r\n      AHour:=0; // rest is already zero\r\n      DecodeDate(round(AValue),AYear,AMonth,ADay);\r\n    end\r\n  else\r\n    DecodeDate(AValue,AYear,AMonth,ADay);\r\nend;\r\n\r\n\r\nFunction TryEncodeDateTime(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AValue: TDateTime): Boolean;\r\n\r\nVar\r\n tmp : TDateTime;\r\n\r\nbegin\r\n  Result:=TryEncodeDate(AYear,AMonth,ADay,AValue);\r\n  Result:=Result and TryEncodeTime(AHour,AMinute,ASecond,Amillisecond,Tmp);\r\n  If Result then\r\n    Avalue:=ComposeDateTime(AValue,Tmp);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of year and day of week\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word; const ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateWeek(AYear,AWeekOfYear,Result,ADayOfWeek) then\r\n    InvalidDateWeekError(AYear,AWeekOfYear,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction EncodeDateWeek(const AYear, AWeekOfYear: Word): TDateTime; //; const ADayOfWeek: Word = 1\r\nbegin\r\n  Result := EncodeDateWeek(AYear,AWeekOfYear,1);\r\nend;\r\n\r\n\r\nProcedure DecodeDateWeek(const AValue: TDateTime; out AYear, AWeekOfYear, ADayOfWeek: Word);\r\n\r\nvar\r\n  DOY : Integer;\r\n  D: Word;\r\n  YS : TDateTime;\r\n  YSDOW, YEDOW: Word;\r\n\r\nbegin\r\n  AYear:=YearOf(AValue);\r\n  // Correct to ISO DOW\r\n  ADayOfWeek:=DayOfWeek(AValue)-1;\r\n  If ADAyOfWeek=0 then\r\n    ADayofweek:=7;\r\n  YS:=StartOfAYear(AYear);\r\n  DOY:=Trunc(AValue-YS)+1;\r\n  YSDOW:=DayOfTheWeek(YS);\r\n  // Correct week if later than wednesday. First week never starts later than wednesday\r\n  if (YSDOW<5) then\r\n    Inc(DOY,YSDOW-1)\r\n  else\r\n    Dec(DOY,8-YSDOW);\r\n  if (DOY<=0) then // Day is in last week of previous year.\r\n    DecodeDateWeek(YS-1,AYear,AWeekOfYear,D)\r\n  else\r\n    begin\r\n    AWeekOfYear:=DOY div 7;\r\n    if ((DOY mod 7)<>0) then\r\n      Inc(AWeekOfYear);\r\n    if (AWeekOfYear>52) then // Maybe in first week of next year ?\r\n      begin\r\n      YEDOW:=YSDOW;\r\n      if IsLeapYear(AYear) then\r\n        begin\r\n        Inc(YEDOW);\r\n        if (YEDOW>7) then\r\n          YEDOW:=1;\r\n        end;\r\n      if (YEDOW<4) then // Really next year.\r\n        begin\r\n        Inc(AYear);\r\n        AWeekOfYear:=1;\r\n        end;\r\n      end;\r\n  end;\r\nend;\r\n\r\n\r\n\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime; const ADayOfWeek: Word): Boolean;\r\n\r\nVar\r\n  DOW : Word;\r\n  Rest : Integer;\r\n\r\nbegin\r\n  Result:=IsValidDateWeek(Ayear,AWeekOfYear,ADayOfWeek);\r\n  If Result then\r\n    begin\r\n    AValue:=EncodeDate(AYear,1,1)+(7*(AWeekOfYear-1));\r\n    DOW:=DayOfTheWeek(AValue);\r\n    Rest:=ADayOfWeek-DOW;\r\n    If (DOW>4) then\r\n      Inc(Rest,7);\r\n    AValue:=AValue+Rest;\r\n    end;\r\nend;\r\n\r\n\r\nFunction TryEncodeDateWeek(const AYear, AWeekOfYear: Word; out AValue: TDateTime): Boolean; //; const ADayOfWeek: Word = 1\r\nbegin\r\n  Result:=TryEncodeDateWeek(AYear,AWeekOfYear,AValue,1);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying day of year\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction EncodeDateDay(const AYear, ADayOfYear: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateDay(AYear,ADayOfYear,Result) then\r\n    InvalidDateDayError(AYear,ADayOfYear);\r\nend;\r\n\r\n\r\nProcedure DecodeDateDay(const AValue: TDateTime; out AYear, ADayOfYear: Word);\r\n\r\nVar\r\n  M,D : Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,AYear,M,D);\r\n  ADayOfyear:=Trunc(AValue-EncodeDate(AYear,1,1))+1;\r\nend;\r\n\r\n\r\nFunction TryEncodeDateDay(const AYear, ADayOfYear: Word; out AValue: TDateTime): Boolean;\r\nbegin\r\n  Result:=(ADayOfYear<>0) and (ADayOfYear<=DaysPerYear [IsleapYear(AYear)]);\r\n  If Result then\r\n    AValue:=EncodeDate(AYear,1,1)+ADayOfYear-1;\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode/decode date, specifying week of month\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction EncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDateMonthWeek(Ayear,AMonth,AWeekOfMonth,ADayOfWeek,Result) then\r\n    InvalidDateMonthWeekError(AYear,AMonth,AWeekOfMonth,ADayOfWeek);\r\nend;\r\n\r\nProcedure DecodeDateMonthWeek(const AValue: TDateTime; out AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\n\r\nVar\r\n  D,SDOM,EDOM : Word;\r\n  SOM : TdateTime;\r\n  DOM : Integer;\r\nbegin\r\n  DecodeDate(AValue,AYear,AMonth,D);\r\n  ADayOfWeek:=DayOfTheWeek(AValue);\r\n  SOM:=EncodeDate(Ayear,Amonth,1);\r\n  SDOM:=DayOfTheWeek(SOM);\r\n  DOM:=D-1+SDOM;\r\n  If SDOM>4 then\r\n    Dec(DOM,7);\r\n  // Too early in the month. First full week is next week, day is after thursday.\r\n  If DOM<=0 Then\r\n    DecodeDateMonthWeek(SOM-1,AYear,AMonth,AWeekOfMonth,D)\r\n  else\r\n    begin\r\n    AWeekOfMonth:=(DOM div 7);\r\n    if (DOM mod 7)<>0 then\r\n      Inc(AWeekOfMonth);\r\n    EDOM:=DayOfTheWeek(EndOfAMonth(Ayear,AMonth));\r\n    // In last days of last long week, so in next month...\r\n    If (EDOM<4) and ((DaysInAMonth(AYear,Amonth)-D)<EDOM) then\r\n      begin\r\n      AWeekOfMonth:=1;\r\n      Inc(AMonth);\r\n      If (AMonth=13) then\r\n        begin\r\n        AMonth:=1;\r\n        Inc(AYear);\r\n        end;\r\n      end;\r\n    end;\r\nend;\r\n\r\nFunction TryEncodeDateMonthWeek(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\nvar\r\n  S : Word;\r\n  DOM : Integer;\r\n\r\nbegin\r\n  Result:=IsValidDateMonthWeek(AYear,AMonth,AWeekOfMonth,ADayOfWeek);\r\n  if Result then\r\n    begin\r\n    AValue:=EncodeDate(AYear,AMonth,1);\r\n    DOM:=(AWeekOfMonth-1)*7+ADayOfWeek-1;\r\n    { Correct for first week in last month.}\r\n    S:=DayOfTheWeek(AValue);\r\n    Dec(DOM,S-1);\r\n    if (S=DayFriday) or (S=DaySaturday) or (S=DaySunday) then\r\n      Inc(DOM,7);\r\n    AValue:=AValue+DOM;\r\n    end;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Encode time interval, allowing hours>24\r\n  ---------------------------------------------------------------------}\r\n\r\nfunction TryEncodeTimeInterval(Hour, Min, Sec, MSec: word; out Time: TDateTime): boolean;\r\nbegin\r\n Result:= (Min<60) and (Sec<60) and (MSec<1000);\r\n If Result then\r\n   Time:=TDateTime(cardinal(Hour)*3600000+cardinal(Min)*60000+cardinal(Sec)*1000+MSec)/MSecsPerDay;\r\nend;\r\n\r\nfunction EncodeTimeInterval(Hour, Minute, Second, MilliSecond: word): TDateTime;\r\nbegin\r\n   If not TryEncodeTimeInterval(Hour,Minute,Second,MilliSecond,Result) then\r\n     Raise EConvertError.CreateFmt(SerrInvalidHourMinuteSecMsec,\r\n                               [Hour,Minute,Second,MilliSecond]);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Replace given element with supplied value.\r\n  ---------------------------------------------------------------------}\r\n\r\nConst\r\n  LFAI = RecodeLeaveFieldAsIS; // Less typing, readable code\r\n{\r\n  Note: We have little choice but to implement it like Borland did:\r\n  If AValue contains some 'wrong' value, it will throw an error.\r\n  To simulate this we'd have to check in each function whether\r\n  both arguments are correct. To avoid it, all is routed through\r\n  the 'central' RecodeDateTime function as in Borland's implementation.\r\n}\r\n\r\nFunction RecodeYear(const AValue: TDateTime; const AYear: Word): TDateTime;\r\n\r\nbegin\r\n  Result := RecodeDateTime(AValue,AYear,LFAI,LFAI,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMonth(const AValue: TDateTime; const AMonth: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,AMonth,LFAI,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeDay(const AValue: TDateTime; const ADay: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,ADay,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeHour(const AValue: TDateTime; const AHour: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,AHour,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMinute(const AValue: TDateTime; const AMinute: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,AMinute,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeSecond(const AValue: TDateTime; const ASecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,LFAI,ASecond,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeMilliSecond(const AValue: TDateTime; const AMilliSecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,LFAI,LFAI,LFAI,AMilliSecond);\r\nend;\r\n\r\n\r\nFunction RecodeDate(const AValue: TDateTime; const AYear, AMonth, ADay: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,AYear,AMonth,ADay,LFAI,LFAI,LFAI,LFAI);\r\nend;\r\n\r\n\r\nFunction RecodeTime(const AValue: TDateTime; const AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  Result := RecodeDateTime(AValue,LFAI,LFAI,LFAI,AHour,AMinute,ASecond,AMilliSecond);\r\nend;\r\n\r\n\r\nFunction RecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word): TDateTime;\r\nbegin\r\n  If Not TryRecodeDateTime(AValue,AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,Result) then\r\n    InvalidDateTimeError(AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,AValue);\r\nend;\r\n\r\n\r\nFunction TryRecodeDateTime(const AValue: TDateTime; const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; out AResult: TDateTime): Boolean;\r\n\r\n  Procedure FV (var AV{%H-} : Word; Arg : Word);\r\n\r\n  begin\r\n    If (Arg<>LFAI) then\r\n      AV:=Arg;\r\n  end;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n\r\nbegin\r\n  DecodeDateTime(AValue,Y,M,D,H,N,S,MS);\r\n  FV(Y,AYear);\r\n  FV(M,AMonth);\r\n  FV(D,ADay);\r\n  FV(H,AHour);\r\n  FV(N,AMinute);\r\n  FV(S,ASecond);\r\n  FV(MS,AMillisecond);\r\n  Result:=TryEncodeDateTime(Y,M,D,H,N,S,MS,AResult);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Comparision of date/time\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\nFunction CompareDateTime(const A, B: TDateTime): TValueRelationship;\r\nbegin\r\n  If SameDateTime(A,B) then\r\n    Result:=EqualsValue\r\n  else if trunc(a)=trunc(b) then\r\n    begin\r\n    if abs(frac(a))>abs(frac(b)) then \r\n      result:=GreaterThanValue\r\n    else \r\n      result:=LessThanValue;\r\n    end \r\n  else \r\n    begin\r\n    if a>b then \r\n      result:=GreaterThanValue\r\n    else \r\n      result:=LessThanValue;\r\n    end;\r\nend;\r\n\r\n\r\nFunction CompareDate(const A, B: TDateTime): TValueRelationship;\r\nbegin\r\n  If SameDate(A,B) then\r\n    Result:=EQualsValue\r\n  else if A<B then\r\n    Result:=LessThanValue\r\n  else\r\n    Result:=GreaterThanValue;\r\nend;\r\n\r\n\r\nFunction CompareTime(const A, B: TDateTime): TValueRelationship;\r\n\r\nbegin\r\n  If SameTime(A,B) then\r\n    Result:=EQualsValue\r\n  else If Frac(A)<Frac(B) then\r\n    Result:=LessThanValue\r\n  else\r\n    Result:=GreaterThanValue;\r\nend;\r\n\r\n\r\nFunction SameDateTime(const A, B: TDateTime): Boolean;\r\nbegin\r\n  Result:=Abs(A-B)<OneMilliSecond;\r\nend;\r\n\r\n\r\nFunction SameDate(const A, B: TDateTime): Boolean;\r\nbegin\r\n  Result:=Trunc(A)=Trunc(B);\r\nend;\r\n\r\n\r\nFunction SameTime(const A, B: TDateTime): Boolean;\r\n\r\nbegin\r\n  Result:=Frac(Abs(A-B))<OneMilliSecond;\r\nend;\r\n\r\n\r\nFunction InternalNthDayOfWeek(DoM : Word) : Word;\r\n\r\nbegin\r\n  Result:=(Dom-1) div 7 +1;\r\nend;\r\n\r\nFunction NthDayOfWeek(const AValue: TDateTime): Word;\r\n\r\nbegin\r\n  Result:=InternalNthDayOfWeek(DayOfTheMonth(AValue));\r\nend;\r\n\r\n\r\nProcedure DecodeDayOfWeekInMonth(const AValue: TDateTime; out AYear, AMonth, ANthDayOfWeek, ADayOfWeek: Word);\r\n\r\nvar\r\n  D: Word;\r\n\r\nbegin\r\n  DecodeDate(AValue,AYear,AMonth,D);\r\n  ADayOfWeek:=DayOfTheWeek(AValue);\r\n  ANthDayOfWeek:=InternalNthDayOfWeek(D);\r\nend;\r\n\r\n\r\nFunction EncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word): TDateTime;\r\nbegin\r\n  If Not TryEncodeDayOfWeekInMonth(AYear,AMonth,ANthDayOfWeek,ADayOfWeek,Result) then\r\n    InvalidDayOfWeekInMonthError(AYear,AMonth,ANthDayOfWeek,ADayOfWeek);\r\nend;\r\n\r\n\r\nFunction TryEncodeDayOfWeekInMonth(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word; out AValue: TDateTime): Boolean;\r\n\r\nVar\r\n  SOM,D : Word;\r\n\r\nbegin\r\n  SOM:=DayOfTheWeek(EncodeDate(Ayear,AMonth,1));\r\n  D:=1+ADayOfWeek-SOM+7*(ANthDayOfWeek-1);\r\n  If SOM>ADayOfWeek then\r\n    D:=D+7; // Clearer would have been Inc(ANthDayOfweek) but it's a const\r\n  Result:=TryEncodeDate(Ayear,AMonth,D,AValue);\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Exception throwing routines\r\n  ---------------------------------------------------------------------}\r\n\r\n\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word; const ABaseDate: TDateTime);\r\n\r\n  Function DoField(Arg,Def : Word; Unknown: String) : String;\r\n\r\n  begin\r\n    if Def=0 then ;\r\n    If (Arg<>LFAI) then\r\n      Result:=Format('%.*d',[Length(Unknown),Arg])\r\n    else if (ABaseDate=0) then\r\n      Result:=Unknown\r\n    else\r\n      Result:=Format('%.*d',[Length(Unknown),Arg]);\r\n  end;\r\n\r\nVar\r\n  Y,M,D,H,N,S,MS : Word;\r\n  Msg : String;\r\n\r\nbegin\r\n  DecodeDateTime(ABasedate,Y,M,D,H,N,S,MS);\r\n  Msg:=DoField(AYear,Y,'????');\r\n  Msg:=Msg+DateSeparator+DoField(AMonth,M,'??');\r\n  Msg:=Msg+DateSeparator+DoField(ADay,D,'??');\r\n  Msg:=Msg+' '+DoField(AHour,H,'??');\r\n  Msg:=Msg+TimeSeparator+DoField(AMinute,N,'??');\r\n  Msg:=Msg+TimeSeparator+Dofield(ASecond,S,'??');\r\n  Msg:=Msg+DecimalSeparator+DoField(AMilliSecond,MS,'???');\r\n  Raise EConvertError.CreateFmt(SErrInvalidTimeStamp,[Msg]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateTimeError(const AYear, AMonth, ADay, AHour, AMinute, ASecond, AMilliSecond: Word); // const ABaseDate: TDateTime = 0\r\nbegin\r\n  InvalidDateTimeError(AYear,AMonth,ADay,AHour,AMinute,ASecond,AMilliSecond,0);\r\nend;\r\n\r\n\r\nProcedure InvalidDateWeekError(const AYear, AWeekOfYear, ADayOfWeek: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDateWeek,[AYear,AWeekOfYear,ADayOfWeek]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateDayError(const AYear, ADayOfYear: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDayOfYear,[AYear,ADayOfYear]);\r\nend;\r\n\r\n\r\nProcedure InvalidDateMonthWeekError(const AYear, AMonth, AWeekOfMonth, ADayOfWeek: Word);\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDateMonthWeek,[Ayear,AMonth,AWeekOfMonth,ADayOfWeek]);\r\nend;\r\n\r\n\r\nProcedure InvalidDayOfWeekInMonthError(const AYear, AMonth, ANthDayOfWeek,  ADayOfWeek: Word);\r\n\r\nbegin\r\n  Raise EConvertError.CreateFmt(SErrInvalidDayOfWeekInMonth,[AYear,AMonth,ANthDayOfWeek,ADayOfWeek]);\r\nend;\r\n\r\n\r\n{ ---------------------------------------------------------------------\r\n    Julian and Modified Julian Date conversion support\r\n  ---------------------------------------------------------------------}\r\n\r\n{$push}\r\n{$R-}\r\n{$Q-}\r\n\r\nFunction DateTimeToJulianDate(const AValue: TDateTime): Double;\r\nvar\r\n  day,month,year: word;\r\n  a,y,m: longint;\r\nbegin\r\n  DecodeDate ( AValue, year, month, day );\r\n  a := (14-month) div 12;\r\n  y := year + 4800 - a;\r\n  m := month + (12*a) - 3;\r\n  result := day + ((153*m+2) div 5) + (365*y)\r\n    + (y div 4) - (y div 100) + (y div 400) - 32045.5 + frac(avalue);\r\nend;\r\n\r\n\r\nFunction JulianDateToDateTime(const AValue: Double): TDateTime;\r\nbegin\r\n  if not TryJulianDateToDateTime(AValue, Result) then\r\n    raise EConvertError.CreateFmt(SInvalidJulianDate, [AValue]);\r\nend;\r\n\r\n\r\nFunction TryJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\nvar\r\n  a,b,c,d,e,m:longint;\r\n  day,month,year: word;\r\nbegin\r\n  a := trunc(AValue + 32044.5);\r\n  b := (4*a + 3) div 146097;\r\n  c := a - (146097*b div 4);\r\n  d := (4*c + 3) div 1461;\r\n  e := c - (1461*d div 4);\r\n  m := (5*e+2) div 153;\r\n  day := e - ((153*m + 2) div 5) + 1;\r\n  month := m + 3 - 12 *  ( m div 10 );\r\n  year := (100*b) + d - 4800 + ( m div 10 );\r\n  result := TryEncodeDate ( Year, Month, Day, ADateTime );\r\n  if Result then\r\n//    ADateTime:=IncMilliSecond(IncHour(ADateTime,-12),MillisecondOfTheDay(Abs(Frac(aValue))));\r\n    ADateTime:=ADateTime+frac(AValue-0.5);\r\nend;\r\n\r\nFunction DateTimeToModifiedJulianDate(const AValue: TDateTime): Double;\r\nbegin\r\n  result := DateTimeToJulianDate(AValue) - 2400000.5;\r\nend;\r\n\r\n\r\nFunction ModifiedJulianDateToDateTime(const AValue: Double): TDateTime;\r\nbegin\r\n  result := JulianDateToDateTime(AValue + 2400000.5);\r\nend;\r\n\r\n\r\nFunction TryModifiedJulianDateToDateTime(const AValue: Double; out ADateTime: TDateTime): Boolean;\r\nbegin\r\n  Result:=TryJulianDateToDateTime(AValue + 2400000.5, ADateTime);\r\nend;\r\n\r\n{$pop}//{$R-}{$Q-} for Julian conversion functions\r\n\r\n{ ---------------------------------------------------------------------\r\n    Unix timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToUnix(const AValue: TDateTime): NativeLargeInt;\r\n\r\nbegin\r\n  Result:=Round(DateTimeDiff(RecodeMillisecond(AValue,0),UnixEpoch)*SecsPerDay);\r\nend;\r\n\r\n\r\nFunction UnixToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nbegin\r\n  Result:=IncSecond(UnixEpoch, AValue);\r\nend;\r\n\r\n\r\nFunction UnixTimeStampToMac(const AValue: NativeLargeInt): NativeLargeInt;\r\nconst\r\n  Epoch=24107 * 24 * 3600;\r\nbegin\r\n  Result:=AValue + Epoch;\r\nend;\r\n\r\n{ ---------------------------------------------------------------------\r\n    Mac timestamp support.\r\n  ---------------------------------------------------------------------}\r\n\r\nFunction DateTimeToMac(const AValue: TDateTime): NativeLargeInt;\r\nvar\r\n  Epoch:TDateTime;\r\nbegin\r\n  Epoch:=EncodeDateTime( 1904, 1, 1, 0, 0, 0, 0 );\r\n  Result:=SecondsBetween( Epoch, AValue );\r\nend;\r\n\r\n\r\nFunction MacToDateTime(const AValue: NativeLargeInt): TDateTime;\r\nvar\r\n  Epoch:TDateTime;\r\nbegin\r\n  Epoch:=EncodeDateTime( 1904, 1, 1, 0, 0, 0, 0 );\r\n  Result:=IncSecond( Epoch, AValue );\r\nend;\r\n\r\n\r\nFunction MacTimeStampToUnix(const AValue: NativeLargeInt): NativeLargeInt;\r\nconst\r\n  Epoch=24107 * 24 * 3600;\r\nbegin\r\n  Result:=AValue - Epoch;\r\nend;\r\n\r\nFunction DateTimeToDosDateTime(const AValue: TDateTime): longint;\r\nvar year,month,day,hour,min,sec,msec : word;\r\n    zs : longint;\r\nbegin\r\n  decodedatetime(avalue,year,month,day,hour,min,sec,msec);\r\n  result:=-1980;\r\n  result:=result+year and 127;\r\n  result:=result shl 4;\r\n  result:=result+month;\r\n  result:=result shl 5;\r\n  result:=result+day;\r\n  result:=result shl 16;\r\n  zs:=hour;\r\n  zs:=zs shl 6;\r\n  zs:=zs+min;\r\n  zs:=zs shl 5;\r\n  zs:=zs+sec div 2;\r\n  result:=result+(zs and $ffff);\r\nend;\r\n\r\nFunction DosDateTimeToDateTime( AValue: longint): TDateTime;\r\nvar year,month,day,hour,min,sec : integer;\r\nbegin\r\n  sec:=(AValue and 31) * 2;\r\n  avalue:=AValue shr 5;\r\n  min:=AValue and 63;\r\n  avalue:=AValue shr 6;\r\n  hour:=AValue and 31;\r\n  avalue:=AValue shr 5;\r\n  day:=AValue and 31;\r\n  avalue:=AValue shr 5;\r\n  month:=AValue and 15;\r\n  avalue:=AValue shr 4;\r\n  year:=AValue+1980;\r\n  result:=EncodeDateTime(year,month,day,hour,min,sec,0);\r\nend;\r\n\r\n\r\n\r\nconst whitespace  = [' ',#13,#10];\r\n      hrfactor    = 1/(24);\r\n      minfactor   = 1/(24*60);\r\n      secfactor   = 1/(24*60*60);\r\n      mssecfactor = 1/(24*60*60*1000);\r\n\r\nconst AMPMformatting : array[0..2] of string =('am/pm','a/p','ampm');\r\n\r\nprocedure raiseexception(const s:string);\r\n\r\nbegin\r\n  raise EConvertError.Create(s);\r\nend;\r\n\r\n{ Conversion of UTC to local time and vice versa }\r\n\r\nFunction GetLocalTimeOffset : Integer;\r\n\r\nbegin\r\n  Result:=TJSDate.New.getTimezoneOffset();\r\nend;\r\n\r\nfunction UniversalTimeToLocal(UT: TDateTime): TDateTime;\r\n\r\nbegin\r\n  Result:=UniversalTimeToLocal(UT,-GetLocalTimeOffset);\r\nend;\r\n\r\nfunction UniversalTimeToLocal(UT: TDateTime; TZOffset : Integer): TDateTime;\r\n\r\nbegin\r\n  if (TZOffset > 0) then\r\n    Result := UT + EncodeTime(TZOffset div 60, TZOffset mod 60, 0, 0)\r\n  else if (TZOffset < 0) then\r\n    Result := UT - EncodeTime(Abs(TZOffset) div 60, Abs(TZOffset) mod 60, 0, 0)\r\n  else\r\n    Result := UT;\r\nend;\r\n \r\nFunction LocalTimeToUniversal(LT: TDateTime): TDateTime;\r\n\r\nbegin\r\n  Result:=LocalTimeToUniversal(LT,-GetLocalTimeOffset);\r\nend;\r\n\r\nFunction LocalTimeToUniversal(LT: TDateTime;TZOffset: Integer): TDateTime;\r\n\r\nbegin\r\n  if (TZOffset > 0) then\r\n    Result := LT - EncodeTime(TZOffset div 60, TZOffset mod 60, 0, 0)\r\n  else if (TZOffset < 0) then\r\n    Result := LT + EncodeTime(Abs(TZOffset) div 60, Abs(TZOffset) mod 60, 0, 0)\r\n  else\r\n    Result := LT;\r\nend;\r\n\r\n\r\n{ RFC 3339 }\r\n\r\nfunction DateTimeToRFC3339(ADate :TDateTime):string;\r\n\r\nbegin\r\n  Result:=FormatDateTime('yyyy-mm-dd\"T\"hh\":\"nn\":\"ss\".\"zzz\"Z\"',ADate);\r\nend;\r\n\r\nfunction DateToRFC3339(ADate: TDateTime): string;\r\nbegin\r\n  Result:=FormatDateTime('yyyy-mm-dd',ADate);\r\nend;\r\n\r\nfunction TimeToRFC3339(ADate :TDateTime):string;\r\n\r\nbegin\r\n  Result:=FormatDateTime('hh\":\"nn\":\"ss\".\"zzz',ADate);\r\nend;\r\n\r\nFunction TryRFC3339ToDateTime(const Avalue: String; out ADateTime: TDateTime): Boolean;\r\n\r\n//          1         2\r\n// 12345678901234567890123\r\n// yyyy-mm-ddThh:nn:ss.zzz\r\n\r\nType\r\n  TPartPos = (ppTime,ppYear,ppMonth,ppDay,ppHour,ppMinute,ppSec);\r\n  TPos = Array [TPartPos] of byte;\r\n\r\nConst\r\n  P : TPos = (11,1,6,9,12,15,18);\r\n\r\nvar\r\n  lY, lM, lD, lH, lMi, lS: Integer;\r\n\r\nbegin\r\n  if Trim(AValue) = '' then\r\n    begin\r\n    Result:=True;\r\n    ADateTime:=0;\r\n    end;\r\n  lY:=StrToIntDef(Copy(AValue,P[ppYear],4),-1);\r\n  lM:=StrToIntDef(Copy(AValue,P[ppMonth],2),-1);\r\n  lD:=StrToIntDef(Copy(AValue,P[ppDay],2),-1);\r\n  if (Length(AValue)>=P[ppTime]) then\r\n    begin\r\n    lH:=StrToIntDef(Copy(AValue,P[ppHour],2),-1);\r\n    lMi:=StrToIntDef(Copy(AValue,P[ppMinute],2),-1);\r\n    lS:=StrToIntDef(Copy(AValue,P[ppSec],2),-1);\r\n    end\r\n  else\r\n    begin\r\n    lH:=0;\r\n    lMi:=0;\r\n    lS:=0;\r\n    end;\r\n  Result:=(lY>=0) and (lM>=0) and (lD>=0) and (lH>=0) and (lMi>=0) and (ls>=0);\r\n  if Not Result then\r\n    ADateTime:=0\r\n  else\r\n    { Cannot EncodeDate if any part equals 0. EncodeTime is okay. }\r\n    if (lY = 0) or (lM = 0) or (lD = 0) then\r\n      ADateTime:=EncodeTime(lH, lMi, lS, 0)\r\n    else\r\n      ADateTime:=EncodeDate(lY, lM, lD) + EncodeTime(lH, lMi, lS, 0);\r\nend;\r\n\r\nFunction RFC3339ToDateTime(const Avalue: String): TDateTime;\r\n\r\nbegin\r\n  if Not TryRFC3339ToDateTime(AValue,Result) then\r\n    Result:=0;\r\nend;\r\n\r\nconst\r\n\r\n  SPatternCharMismatch = 'Pattern mismatch char \"%s\" at position %d.';\r\n  SNoCharMatch         = 'Mismatch char \"%s\" <> \"%s\" at pattern position %d, string position %d.';\r\n  SHHMMError           = 'mm in a sequence hh:mm is interpreted as minutes. No longer versions allowed! (Position : %d).' ;\r\n  SNoArrayMatch        = 'Can''t match any allowed value at pattern position %d, string position %d.';\r\n  //SFullpattern         = 'Couldn''t match entire pattern string. Input too short at pattern position %d.';\r\n\r\n\r\n{ TDateTimeScanner }\r\nprocedure TDateTimeScanner.ArrayMatchError;\r\n\r\nbegin\r\n  raiseexception(format(SNoArrayMatch,[FPatternPos+1,FPos]))\r\nend;\r\n\r\nprocedure TDateTimeScanner.SetPattern(AValue: String);\r\nbegin\r\n  if FPattern=AValue then Exit;\r\n  FPattern:=AValue;\r\n  FPatternLen:=Length(FPattern);\r\nend;\r\n\r\nprocedure TDateTimeScanner.SetText(AValue: String);\r\nbegin\r\n  if FText=AValue then Exit;\r\n  FText:=AValue;\r\n  FLen:=Length(FText);\r\nend;\r\n\r\nfunction TDateTimeScanner.ScanFixedInt(maxv:integer):integer;\r\n\r\nvar\r\n  c,n : char;\r\n  oi:integer;\r\n\r\nbegin\r\n  Result:=0;\r\n  oi:=FPos;\r\n  c:=FPattern[FPatternPos];\r\n  while (FPatternPos<=FPatternLen) and (FPattern[FPatternPos]=c) do\r\n    Inc(FPatternPos);\r\n  N:=FText[FPos];\r\n  while (maxv>0) and (FPos<=FLen) and (N IN ['0'..'9']) do\r\n    begin\r\n    Result:=(Result*10)+ord(N)-48;\r\n    inc(FPos);\r\n    dec(maxv);\r\n    if FPos<=FLen then\r\n      N:=FText[FPos];\r\n    end;\r\n  if (OI=FPos) then\r\n    raiseexception(format(SPatternCharMismatch,[c,oi]));\r\nend;\r\n\r\nfunction TDateTimeScanner.FindIMatch(const values :array of string; aTerm : string):integer;\r\n\r\nvar\r\n  l,i : integer;\r\n\r\nbegin\r\n  Result:=-1;\r\n  l:=high(values);\r\n  i:=0;\r\n  while (i<=l) and (result=-1) do\r\n    begin\r\n    if SameText(Copy(aTerm,1,Length(values[i])),values[i]) then\r\n      Result:=i;\r\n    inc(i);\r\n    end;\r\nend;\r\n\r\nfunction TDateTimeScanner.FindMatch(const Values : array of string):integer;\r\n\r\nbegin\r\n  result:=FindIMatch(Values,Copy(FText,FPos,FLen-FPos+1));\r\n  if result=-1 then\r\n    arraymatcherror\r\n  else\r\n    begin\r\n    inc(FPos,length(Values[result])+1);\r\n    inc(FPatternPos,length(Values[result])+1);\r\n    inc(result); // was 0 based.\r\n    end;\r\nend;\r\n\r\n\r\nprocedure TDateTimeScanner.MatchChar(c:char);\r\n\r\nVar\r\n  N : Char;\r\n\r\nbegin\r\n  if (FPos<=Flen) then\r\n    N:=FText[FPos]\r\n  else\r\n    N:='?';\r\n  if (N<>c) then\r\n    raiseexception(format(SNoCharMatch,[N,C,FPatternPos+FPatternOffset,FPos]));\r\n  inc(FPatternPos);\r\n  inc(FPos);\r\nend;\r\n\r\nfunction TDateTimeScanner.ScanPatternLength :integer;\r\n\r\nvar\r\n  c : char;\r\n  i : Integer;\r\n\r\nbegin\r\n  result:=FPatternPos;\r\n  I:=FPatternPos;\r\n  c:=FPattern[I];\r\n  while (I<=FPatternLen) and (FPattern[i]=c) do\r\n    inc(I);\r\n  Result:=I-Result;\r\nend;\r\n\r\nprocedure TDateTimeScanner.MatchPattern(const aPattern: String);\r\n\r\nVar\r\n  T : String;\r\n  cPos: Integer;\r\n\r\nbegin\r\n  T:=FPattern;\r\n  cPos:=FPatternPos;\r\n  FPatternOffset:=FPatternPos;\r\n  FPattern:=aPattern;\r\n  FPatternLen:=Length(aPattern);\r\n  try\r\n    Scan;\r\n  finally\r\n    FPattern:=T;\r\n    FPatternLen:=Length(aPattern);\r\n    FPatternPos:=cPos;\r\n    FPatternOffset:=0;\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoDay;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  case i of\r\n  1,2 : FD:=scanfixedint(2);\r\n  3   : FD:=findmatch(shortDayNames);\r\n  4   : FD:=findmatch(longDayNames);\r\n  5   : matchpattern(shortdateformat);\r\n  6   : matchpattern(longdateformat);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoYear;\r\n\r\nVar\r\n  I : integer;\r\n  pivot : Integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  FY:=scanfixedint(4);\r\n  if i<=2 then\r\n    begin\r\n    Pivot:=YearOf(Now)-TwoDigitYearCenturyWindow;\r\n    inc(FY, Pivot div 100 * 100);\r\n    if (TwoDigitYearCenturyWindow > 0) and (FY < Pivot) then\r\n      inc(FY, 100);\r\n    end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoMonth;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  I:=ScanPatternLength;\r\n  case i of\r\n  1,2: FM:=scanfixedint(2);\r\n  3:   FM:=findmatch(ShortMonthNames);\r\n  4:   FM:=findmatch(LongMonthNames);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoTime;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=ScanPatternLength;\r\n  case i of\r\n    1: matchpattern(ShortTimeFormat);\r\n    2: matchpattern(LongTimeFormat);\r\n  end;\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoDateTime;\r\n\r\nbegin\r\n  MatchPattern(ShortDateFormat);\r\n  MatchPattern(#9);\r\n  MatchPattern(LongTimeFormat);\r\n  inc(FPatternPos);\r\nend;\r\n\r\nprocedure TDateTimeScanner.DoAMPM;\r\n\r\nVar\r\n  I : integer;\r\n\r\nbegin\r\n  i:=FindIMatch(AMPMformatting,Copy(FPattern,FPatternPos,5));\r\n  case i of\r\n  0:\r\n    begin\r\n    i:=FindIMatch(['AM','PM'],Copy(FText,FPos,2));\r\n    case i of\r\n      0: ;\r\n      1: FTimeval:=FTimeval+12*hrfactor;\r\n    else\r\n      ArrayMatchError\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[0]));\r\n    inc(FPos,2);\r\n    end;\r\n  1:\r\n    begin\r\n    case Upcase(FText[FPos]) of\r\n      'A' : ;\r\n      'P' : FTimeval:=FTimeval+12*hrfactor;\r\n    else\r\n      ArrayMatchError\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[1]));\r\n    inc(FPos);\r\n    end;\r\n  2:\r\n    begin\r\n    i:=FindIMatch([timeamstring,timepmstring],Copy(FText,FPos,5));\r\n    case i of\r\n    0: inc(FPos,length(timeamstring));\r\n    1: begin\r\n       FTimeval:=FTimeval+12*hrfactor;\r\n       inc(FPos,length(timepmstring));\r\n       end;\r\n    else\r\n      arraymatcherror\r\n    end;\r\n    inc(FPatternPos,length(AMPMformatting[2]));\r\n    inc(FPatternPos,2);\r\n    inc(FPos,2);\r\n    end;\r\n  else  // no AM/PM match. Assume 'a' is simply a char\r\n     MatchChar(FPattern[FPatternPos]);\r\n  end;\r\nend;\r\n\r\nfunction TDateTimeScanner.Scan(StartPos: integer): TDateTime;\r\n\r\nvar\r\n  lasttoken,\r\n  activequote,\r\n  lch : char;\r\n  i : Integer;\r\n\r\nbegin\r\n  if StartPos<1 then\r\n    StartPos:=1;\r\n  if FPos<StartPos then\r\n    FPos:=StartPos;\r\n  FPatternPos:=1;\r\n  activequote:=#0;\r\n  lasttoken:=' ';\r\n  while (FPos<=FLen) and (FPatternPos<=FPatternlen) do\r\n    begin\r\n    lch:=upcase(FPattern[FPatternPos]);\r\n    if activequote<>#0 then\r\n      begin\r\n      if (activequote<>lch) then\r\n        MatchChar(lch)\r\n      else\r\n        begin\r\n        activequote:=#0;\r\n        inc(FPatternPos);\r\n        end\r\n      end\r\n    else\r\n      begin\r\n      if (lch='M') and (lasttoken='H') then\r\n        begin\r\n        i:=ScanPatternLength;\r\n        if i>2 then\r\n           raiseexception(format(SHHMMError,[FPatternOffset+FPatternPos+1]));\r\n        FTimeval:=FTimeval+scanfixedint(2)* minfactor;\r\n        end\r\n      else\r\n        case lch of\r\n        'Y': DoYear;\r\n        'M': DoMonth;\r\n        'D': DoDay;\r\n        'T': DoTime;\r\n        'H': FTimeval:=FTimeval+scanfixedint(2)* hrfactor;\r\n        'N': FTimeval:=FTimeval+scanfixedint(2)* minfactor;\r\n        'S': FTimeval:=FTimeval+scanfixedint(2)* secfactor;\r\n        'Z': FTimeval:=FTimeval+scanfixedint(3)* mssecfactor;\r\n        'A': DoAMPM;\r\n        '/': MatchChar(DateSeparator);\r\n        ':': begin\r\n             MatchChar(TimeSeparator);\r\n             lch:=lasttoken;\r\n             end;\r\n        #39,'\"' :\r\n             begin\r\n             activequote:=lch;\r\n             inc(FPatternPos);\r\n             end;\r\n        'C': DoDateTime;\r\n        '?': begin\r\n             inc(FPatternPos);\r\n             inc(FPos)\r\n             end;\r\n        #9: begin\r\n            while (FPos<=FLen) and (FText[FPos] in WhiteSpace) do\r\n              inc(FPos);\r\n            inc(FPatternPos);\r\n            end;\r\n        else\r\n          MatchChar(FPattern[FPatternPos]);\r\n        end; {case}\r\n      lasttoken:=lch;\r\n      end\r\n  end;\r\n//  if (FPatternPos<FLen) and (FPatternLen>0) and (FPattern[FPatternLen-1]<>#9) then  // allow omission of trailing whitespace\r\n//    RaiseException(format(SFullpattern,[FPatternOffset+FPatternPos]));\r\n  Result:=FTimeval;\r\n  if (FY>0) and (FM>0) and (FD>0) then\r\n    Result:=Result+EncodeDate(FY,FM,FD);\r\nend;\r\n\r\nFunction ScanDateTime(APattern,AValue: String; APos : integer = 1) : TDateTime;\r\n\r\nVar\r\n  T : TDateTimeScanner;\r\n\r\nbegin\r\n  T:=TDateTimeScanner.Create;\r\n  try\r\n    T.Pattern:=APattern;\r\n    T.Text:=AValue;\r\n    Result:=T.Scan(APos);\r\n  finally\r\n    T.Free;\r\n  end;\r\nend;\r\n\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCPlannerData;\r\n\r\ninterface\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCTypes, WEBLib.TMSFNCPlannerBase, WEBLib.Graphics, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFNDEF WEBLIB}\r\n  {$IFNDEF LCLLIB}\r\n  ,Generics.Collections, Types, UITypes\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,SysUtils\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,fgl\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  {$IFDEF FMXLIB}\r\n  TMSFNCPlannerColor = $FFD7E4EC;\r\n  TMSFNCPlannerFontColor = $FF116F9F;\r\n  TMSFNCPlannerSelectedColor = $FF1BADF8;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TMSFNCPlannerColor = $ECE4D7;\r\n  TMSFNCPlannerFontColor = $9F6F11;\r\n  TMSFNCPlannerSelectedColor = $F8AD1B;\r\n  {$ENDIF}\r\n\r\nresourcestring\r\n  sTMSFNCPlannerGroup = 'Group';\r\n  sTMSFNCPlannerResource = 'Resource';\r\n\r\ntype\r\n  TTMSFNCPlannerData = class;\r\n\r\n  TTMSFNCPlannerItem = class;\r\n  TTMSFNCPlannerGroup = class;\r\n  TTMSFNCPlannerResource = class;\r\n\r\n  TTMSFNCPlannerCacheItemKind = (ikCell, ikItem, ikPositionTop, ikPositionBottom, ikGroupTop, ikGroupBottom, ikTimeLineLeft, ikTimeLineRight);\r\n\r\n  TTMSFNCPlannerCacheItem = class\r\n  private\r\n    FBitmap: TBitmap;\r\n    FRect: TRectF;\r\n    FDrawRect: TRectF;\r\n    FKind: TTMSFNCPlannerCacheItemKind;\r\n    FItem: TTMSFNCPlannerItem;\r\n    FGroup: Integer;\r\n    FPosition: Integer;\r\n    FValue: Double;\r\n    FStartTime: TDateTime;\r\n    FEndTime: TDateTime;\r\n    FRow: Integer;\r\n    FCol: Integer;\r\n    FIdx: Integer;\r\n    FStartPosition: Integer;\r\n    FEndPosition: Integer;\r\n  public\r\n    class function CreateCache(ARect: TRectF; ABitmap: TBitmap; AKind: TTMSFNCPlannerCacheItemKind; APosition: Integer = -1): TTMSFNCPlannerCacheItem;\r\n\r\n    class function CreateCell(ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime; APosition: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreateItem(ARect: TRectF; APosition: Integer; AItem: TTMSFNCPlannerItem; AIndex: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreatePositionTop(ARect: TRectF; APosition: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreateGroupTop(ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreateTimeLineLeft(ARect: TRectF; AValue: Double; ARow: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreatePositionBottom(ARect: TRectF; APosition: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreateGroupBottom(ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer): TTMSFNCPlannerCacheItem;\r\n    class function CreateTimeLineRight(ARect: TRectF; AValue: Double; ARow: Integer): TTMSFNCPlannerCacheItem;\r\n\r\n    property Rect: TRectF read FRect write FRect;\r\n    property DrawRect: TRectF read FDrawRect write FDrawRect;\r\n    property Bitmap: TBitmap read FBitmap write FBitmap;\r\n    property Kind: TTMSFNCPlannerCacheItemKind read FKind write FKind;\r\n    property Item: TTMSFNCPlannerItem read FItem write FItem;\r\n    property Group: Integer read FGroup write FGroup;\r\n    property StartPosition: Integer read FStartPosition write FStartPosition;\r\n    property EndPosition: Integer read FEndPosition write FEndPosition;\r\n    property Position: Integer read FPosition write FPosition;\r\n    property Col: Integer read FCol write FCol;\r\n    property Row: Integer read FRow write FRow;\r\n    property StartTime: TDateTime read FStartTime write FStartTime;\r\n    property EndTime: TDateTime read FEndTime write FEndTime;\r\n    property Value: Double read FValue write FValue;\r\n    property Idx: Integer read FIdx write FIdx;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerCacheItemList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerCacheItem read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCPlannerIntegerList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): Integer;\r\n    procedure SetItem(Index: Integer; const Value: Integer);\r\n  public\r\n    property Items[Index: Integer]: Integer read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerCacheItemList = class(TList<TTMSFNCPlannerCacheItem>);\r\n  TTMSFNCPlannerIntegerList = class(TList<Integer>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerItemLinkType = (iltFull, iltStartEnd, iltEndStart, iltEndEnd, iltStartStart, iltNone);\r\n  TTMSFNCPlannerItemLinkArrow = (ilaNone, ilaFromTo, ilaToFrom, ilaBoth);\r\n\r\n  TTMSFNCPlannerItem = class(TCollectionItem)\r\n  private\r\n    FCanUpdate: Boolean;\r\n    FUpdatingLinkedItem: Boolean;\r\n    FBlockUpdate: Boolean;\r\n    FCacheList: TTMSFNCPlannerCacheItemList;\r\n    FUpdateCount: Integer;\r\n    FTag: NativeInt;\r\n    FDataString: String;\r\n    FDataObject: TObject;\r\n    FDataInteger: NativeInt;\r\n    FPlanner: TTMSFNCPlannerData;\r\n    FText: String;\r\n    FStartTime: TDateTime;\r\n    FEndTime: TDateTime;\r\n    FResource: Integer;\r\n    FVisible: Boolean;\r\n    FConflictsPosList: TTMSFNCPlannerIntegerList;\r\n    FConflictsList: TTMSFNCPlannerIntegerList;\r\n    FTitle: String;\r\n    FEnabled: Boolean;\r\n    FEditable: Boolean;\r\n    FSelectable: Boolean;\r\n    FColor: TTMSFNCGraphicsColor;\r\n    FTitleColor: TTMSFNCGraphicsColor;\r\n    FDisabledTitleFontColor: TTMSFNCGraphicsColor;\r\n    FSelectedTitleColor: TTMSFNCGraphicsColor;\r\n    FActiveTitleColor: TTMSFNCGraphicsColor;\r\n    FDisabledColor: TTMSFNCGraphicsColor;\r\n    FSelectedColor: TTMSFNCGraphicsColor;\r\n    FActiveColor: TTMSFNCGraphicsColor;\r\n    FTitleFontColor: TTMSFNCGraphicsColor;\r\n    FDisabledFontColor: TTMSFNCGraphicsColor;\r\n    FDisabledTitleColor: TTMSFNCGraphicsColor;\r\n    FSelectedFontColor: TTMSFNCGraphicsColor;\r\n    FActiveFontColor: TTMSFNCGraphicsColor;\r\n    FFontColor: TTMSFNCGraphicsColor;\r\n    FSelectedTitleFontColor: TTMSFNCGraphicsColor;\r\n    FActiveTitleFontColor: TTMSFNCGraphicsColor;\r\n    FDirtyList: TTMSFNCPlannerIntegerList;\r\n    FCleanupList: TTMSFNCPlannerIntegerList;\r\n    FHint: String;\r\n    FPositionsList, FOldPositionsList: TTMSFNCPlannerIntegerList;\r\n    FStartTimeExt: TDateTime;\r\n    FEndTimeExt: TDateTime;\r\n    FConflictsExt: integer;\r\n    FConflictsPosExt: integer;\r\n    FMovable: Boolean;\r\n    FSizeable: Boolean;\r\n    FFixedResource: Boolean;\r\n    FShowTitle: Boolean;\r\n    FDBKey: String;\r\n    FOverlappable: Boolean;\r\n    FCallPosition: Integer;\r\n    FDataBoolean: Boolean;\r\n    FRecurrency: string;\r\n    FRecurrent: Boolean;\r\n    FMasterItem: TTMSFNCPlannerItem;\r\n    FOldEndTime: TDateTime;\r\n    FOldStartTime: TDateTime;\r\n    FMasterStartDateTime: TDateTime;\r\n    FMasterEndDateTime: TDateTime;\r\n    FDeletable: Boolean;\r\n    FLinkedItem: TTMSFNCPlannerItem;\r\n    FLinkType: TTMSFNCPlannerItemLinkType;\r\n    FNewPosition: Integer;\r\n    FNewStartTime: TDateTime;\r\n    FNewEndTime: TDateTime;\r\n    FUpdatingLinked: Boolean;\r\n    FLinkArrow: TTMSFNCPlannerItemLinkArrow;\r\n    FSelectedLinkColor: TTMSFNCGraphicsColor;\r\n    FLinkColor: TTMSFNCGraphicsColor;\r\n    FDisabledFontStyle: TFontStyles;\r\n    FSelectedFontStyle: TFontStyles;\r\n    FActiveFontStyle: TFontStyles;\r\n    FFontStyle: TFontStyles;\r\n    FDisabledTitleFontStyle: TFontStyles;\r\n    FSelectedTitleFontStyle: TFontStyles;\r\n    FActiveTitleFontStyle: TFontStyles;\r\n    FTitleFontStyle: TFontStyles;\r\n    FUseDefaultAppearance: Boolean;\r\n    FDisabledFontName: string;\r\n    FSelectedFontName: string;\r\n    FActiveFontName: string;\r\n    FDisabledTitleFontName: string;\r\n    FSelectedTitleFontName: string;\r\n    FActiveTitleFontName: string;\r\n    FTitleFontName: string;\r\n    FFontName: string;\r\n    FTextVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTitleHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTextHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTitleVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FActiveFontSize: Single;\r\n    FFontSize: Single;\r\n    FDisabledTitleFontSize: Single;\r\n    FSelectedTitleFontSize: Single;\r\n    FActiveTitleFontSize: Single;\r\n    FTitleFontSize: Single;\r\n    FDisabledFontSize: Single;\r\n    FSelectedFontSize: Single;\r\n    FDataPointer: Pointer;\r\n    procedure SetText(const Value: String);\r\n    procedure SetEndTime(const Value: TDateTime);\r\n    procedure SetStartTime(const Value: TDateTime);\r\n    procedure SetResource(const Value: Integer);\r\n    procedure SetVisible(const Value: Boolean);\r\n    procedure SetTitle(const Value: String);\r\n    procedure SetEditable(const Value: Boolean);\r\n    procedure SetEnabled(const Value: Boolean);\r\n    procedure SetSelectable(const Value: Boolean);\r\n    procedure SetColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetTitleColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDisabledColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDisabledFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDisabledTitleColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDisabledTitleFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSelectedColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSelectedFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSelectedTitleColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSelectedTitleFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetActiveColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetActiveFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetActiveTitleColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetActiveTitleFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetTitleFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetHint(const Value: String);\r\n    procedure SetMovable(const Value: Boolean);\r\n    procedure SetSizeable(const Value: Boolean);\r\n    procedure SetFixedResource(const Value: Boolean);\r\n    procedure SetShowTitle(const Value: Boolean);\r\n    procedure SetOverlappable(const Value: Boolean);\r\n    procedure SetDeletable(const Value: Boolean);\r\n    procedure SetLinkedItem(const Value: TTMSFNCPlannerItem);\r\n    procedure SetLinkType(const Value: TTMSFNCPlannerItemLinkType);\r\n    procedure SetLinkArrow(const Value: TTMSFNCPlannerItemLinkArrow);\r\n    procedure SetLinkColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSelectedLinkColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetActiveFontStyle(const Value: TFontStyles);\r\n    procedure SetActiveTitleFontStyle(const Value: TFontStyles);\r\n    procedure SetDisabledFontStyle(const Value: TFontStyles);\r\n    procedure SetDisabledTitleFontStyle(const Value: TFontStyles);\r\n    procedure SetFontStyle(const Value: TFontStyles);\r\n    procedure SetSelectedFontStyle(const Value: TFontStyles);\r\n    procedure SetSelectedTitleFontStyle(const Value: TFontStyles);\r\n    procedure SetTitleFontStyle(const Value: TFontStyles);\r\n    procedure SetActiveFontName(const Value: string);\r\n    procedure SetActiveTitleFontName(const Value: string);\r\n    procedure SetDisabledFontName(const Value: string);\r\n    procedure SetDisabledTitleFontName(const Value: string);\r\n    procedure SetSelectedFontName(const Value: string);\r\n    procedure SetSelectedTitleFontName(const Value: string);\r\n    procedure SetTitleFontName(const Value: string);\r\n    procedure SetUseDefaultAppearance(const Value: Boolean);\r\n    procedure SetFontName(const Value: string);\r\n    procedure SetTextHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTextVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTitleHorizontalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTitleVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    function IsActiveFontSizeStored: Boolean;\r\n    function IsActiveTitleFontSizeStored: Boolean;\r\n    function IsDisabledFontSizeStored: Boolean;\r\n    function IsDisabledTitleFontSizeStored: Boolean;\r\n    function IsFontSizeStored: Boolean;\r\n    function IsSelectedFontSizeStored: Boolean;\r\n    function IsSelectedTitleFontSizeStored: Boolean;\r\n    function IsTitleFontSizeStored: Boolean;\r\n    procedure SetActiveFontSize(const Value: Single);\r\n    procedure SetActiveTitleFontSize(const Value: Single);\r\n    procedure SetDisabledFontSize(const Value: Single);\r\n    procedure SetDisabledTitleFontSize(const Value: Single);\r\n    procedure SetFontSize(const Value: Single);\r\n    procedure SetSelectedFontSize(const Value: Single);\r\n    procedure SetSelectedTitleFontSize(const Value: Single);\r\n    procedure SetTitleFontSize(const Value: Single);\r\n  protected\r\n    property ConflictsList: TTMSFNCPlannerIntegerList read FConflictsList write FConflictsList;\r\n    property ConflictsPosList: TTMSFNCPlannerIntegerList read FConflictsPosList write FConflictsPosList;\r\n    property PositionsList: TTMSFNCPlannerIntegerList read FPositionsList write FPositionsList;\r\n    property OldPositionsList: TTMSFNCPlannerIntegerList read FOldPositionsList write FOldPositionsList;\r\n    property DirtyList: TTMSFNCPlannerIntegerList read FDirtyList write FDirtyList;\r\n    property CleanupList: TTMSFNCPlannerIntegerList read FCleanupList write FCleanupList;\r\n    property CacheList: TTMSFNCPlannerCacheItemList read FCacheList write FCacheList;\r\n    property StartTimeExt: TDateTime read FStartTimeExt write FStartTimeExt;\r\n    property EndTimeExt: TDateTime read FEndTimeExt write FEndTimeExt;\r\n    property ConflictsExt: integer read FConflictsExt write FConflictsExt;\r\n    property ConflictsPosExt: integer read FConflictsPosExt write FConflictsPosExt;\r\n    property CallPosition: Integer read FCallPosition write FCallPosition;\r\n    property CanUpdate: Boolean read FCanUpdate write FCanUpdate;\r\n    property NewStartTime: TDateTime read FNewStartTime write FNewStartTime;\r\n    property NewEndTime: TDateTime read FNewEndTime write FNewEndTime;\r\n    property NewPosition: Integer read FNewPosition write FNewPosition;\r\n    property UpdatingLinked: Boolean read FUpdatingLinked write FUpdatingLinked;\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure DirtyItem;\r\n    procedure UpdateItem(ANeedsConflictsUpdate: Boolean = False; ADirty: Boolean = True);\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure BeginUpdate;\r\n    procedure EndUpdate(ADirty: Boolean = True; AUpdate: Boolean = True);\r\n    function ConflictsForPosition(APosition: Integer): Integer;\r\n    function ConflictsPosForPosition(APosition: Integer): Integer;\r\n    function Planner: TTMSFNCPlannerData;\r\n    function GetRect(AIndex: Integer = -1): TRectF; virtual;\r\n    function GetFirstRect: TRectF; virtual;\r\n    function GetLastRect: TRectF; virtual;\r\n    function RectCount: Integer; virtual;\r\n    property DataPointer: Pointer read FDataPointer write FDataPointer;\r\n    property DataBoolean: Boolean read FDataBoolean write FDataBoolean;\r\n    property DataObject: TObject read FDataObject write FDataObject;\r\n    property DataString: String read FDataString write FDataString;\r\n    property DataInteger: NativeInt read FDataInteger write FDataInteger;\r\n    property DBKey: String read FDBKey write FDBKey;\r\n    property Recurrency: string read FRecurrency write FRecurrency;\r\n    property Recurrent: Boolean read FRecurrent write FRecurrent;\r\n    property OldStartTime: TDateTime read FOldStartTime write FOldStartTime;\r\n    property OldEndTime: TDateTime read FOldEndTime write FOldEndTime;\r\n    property LinkedItem: TTMSFNCPlannerItem read FLinkedItem write SetLinkedItem;\r\n    property LinkType: TTMSFNCPlannerItemLinkType read FLinkType write SetLinkType default iltNone;\r\n    property MasterStartDateTime: TDateTime read FMasterStartDateTime write FMasterStartDateTime;\r\n    property MasterEndDateTime: TDateTime read FMasterEndDateTime write FMasterEndDateTime;\r\n  published\r\n    property Text: String read FText write SetText;\r\n    property Title: String read FTitle write SetTitle;\r\n    property Resource: Integer read FResource write SetResource default 0;\r\n    property StartTime: TDateTime read FStartTime write SetStartTime;\r\n    property EndTime: TDateTime read FEndTime write SetEndTime;\r\n    property Visible: Boolean read FVisible write SetVisible default True;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default True;\r\n    property Editable: Boolean read FEditable write SetEditable default True;\r\n    property Selectable: Boolean read FSelectable write SetSelectable default True;\r\n    property Deletable: Boolean read FDeletable write SetDeletable default True;\r\n    property FixedResource: Boolean read FFixedResource write SetFixedResource default False;\r\n    property ShowTitle: Boolean read FShowTitle write SetShowTitle default True;\r\n    property Movable: Boolean read FMovable write SetMovable default True;\r\n    property Sizeable: Boolean read FSizeable write SetSizeable default True;\r\n    property Color: TTMSFNCGraphicsColor read FColor write SetColor default TMSFNCPlannerColor;\r\n    property TitleColor: TTMSFNCGraphicsColor read FTitleColor write SetTitleColor default gcNull;\r\n    property SelectedColor: TTMSFNCGraphicsColor read FSelectedColor write SetSelectedColor default TMSFNCPlannerSelectedColor;\r\n    property SelectedTitleColor: TTMSFNCGraphicsColor read FSelectedTitleColor write SetSelectedTitleColor default gcNull;\r\n    property ActiveColor: TTMSFNCGraphicsColor read FActiveColor write SetActiveColor default TMSFNCPlannerSelectedColor;\r\n    property ActiveTitleColor: TTMSFNCGraphicsColor read FActiveTitleColor write SetActiveTitleColor default gcNull;\r\n    property DisabledColor: TTMSFNCGraphicsColor read FDisabledColor write SetDisabledColor default gcDarkGray;\r\n    property DisabledTitleColor: TTMSFNCGraphicsColor read FDisabledTitleColor write SetDisabledTitleColor default gcNull;\r\n    property FontColor: TTMSFNCGraphicsColor read FFontColor write SetFontColor default TMSFNCPlannerFontColor;\r\n    property TitleFontColor: TTMSFNCGraphicsColor read FTitleFontColor write SetTitleFontColor default TMSFNCPlannerFontColor;\r\n    property SelectedFontColor: TTMSFNCGraphicsColor read FSelectedFontColor write SetSelectedFontColor default gcWhite;\r\n    property SelectedTitleFontColor: TTMSFNCGraphicsColor read FSelectedTitleFontColor write SetSelectedTitleFontColor default gcWhite;\r\n    property ActiveFontColor: TTMSFNCGraphicsColor read FActiveFontColor write SetActiveFontColor default gcWhite;\r\n    property ActiveTitleFontColor: TTMSFNCGraphicsColor read FActiveTitleFontColor write SetActiveTitleFontColor default gcWhite;\r\n    property DisabledFontColor: TTMSFNCGraphicsColor read FDisabledFontColor write SetDisabledFontColor default gcWhitesmoke;\r\n    property DisabledTitleFontColor: TTMSFNCGraphicsColor read FDisabledTitleFontColor write SetDisabledTitleFontColor default gcWhitesmoke;\r\n    property FontStyle: TFontStyles read FFontStyle write SetFontStyle default [];\r\n    property TitleFontStyle: TFontStyles read FTitleFontStyle write SetTitleFontStyle default [TFontStyle.fsBold];\r\n    property SelectedFontStyle: TFontStyles read FSelectedFontStyle write SetSelectedFontStyle default [];\r\n    property SelectedTitleFontStyle: TFontStyles read FSelectedTitleFontStyle write SetSelectedTitleFontStyle default [TFontStyle.fsBold];\r\n    property ActiveFontStyle: TFontStyles read FActiveFontStyle write SetActiveFontStyle default [];\r\n    property ActiveTitleFontStyle: TFontStyles read FActiveTitleFontStyle write SetActiveTitleFontStyle default [TFontStyle.fsBold];\r\n    property DisabledFontStyle: TFontStyles read FDisabledFontStyle write SetDisabledFontStyle default [];\r\n    property DisabledTitleFontStyle: TFontStyles read FDisabledTitleFontStyle write SetDisabledTitleFontStyle default [TFontStyle.fsBold];\r\n    property FontName: string read FFontName write SetFontName;\r\n    property TitleFontName: string read FTitleFontName write SetTitleFontName;\r\n    property SelectedFontName: string read FSelectedFontName write SetSelectedFontName;\r\n    property SelectedTitleFontName: string read FSelectedTitleFontName write SetSelectedTitleFontName;\r\n    property ActiveFontName: string read FActiveFontName write SetActiveFontName;\r\n    property ActiveTitleFontName: string read FActiveTitleFontName write SetActiveTitleFontName;\r\n    property DisabledFontName: string read FDisabledFontName write SetDisabledFontName;\r\n    property DisabledTitleFontName: string read FDisabledTitleFontName write SetDisabledTitleFontName;\r\n    property FontSize: Single read FFontSize write SetFontSize stored IsFontSizeStored nodefault;\r\n    property TitleFontSize: Single read FTitleFontSize write SetTitleFontSize stored IsTitleFontSizeStored nodefault;\r\n    property SelectedFontSize: Single read FSelectedFontSize write SetSelectedFontSize stored IsSelectedFontSizeStored nodefault;\r\n    property SelectedTitleFontSize: Single read FSelectedTitleFontSize write SetSelectedTitleFontSize stored IsSelectedTitleFontSizeStored nodefault;\r\n    property ActiveFontSize: Single read FActiveFontSize write SetActiveFontSize stored IsActiveFontSizeStored nodefault;\r\n    property ActiveTitleFontSize: Single read FActiveTitleFontSize write SetActiveTitleFontSize stored IsActiveTitleFontSizeStored nodefault;\r\n    property DisabledFontSize: Single read FDisabledFontSize write SetDisabledFontSize stored IsDisabledFontSizeStored nodefault;\r\n    property DisabledTitleFontSize: Single read FDisabledTitleFontSize write SetDisabledTitleFontSize stored IsDisabledTitleFontSizeStored nodefault;\r\n    property UseDefaultAppearance: Boolean read FUseDefaultAppearance write SetUseDefaultAppearance default False;\r\n    property LinkColor: TTMSFNCGraphicsColor read FLinkColor write SetLinkColor default gcDarkgray;\r\n    property SelectedLinkColor: TTMSFNCGraphicsColor read FSelectedLinkColor write SetSelectedLinkColor default TMSFNCPlannerSelectedColor;\r\n    property LinkArrow: TTMSFNCPlannerItemLinkArrow read FLinkArrow write SetLinkArrow default ilaNone;\r\n    property TitleHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTitleHorizontalTextAlign write SetTitleHorizontalTextAlign default gtaLeading;\r\n    property TitleVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTitleVerticalTextAlign write SetTitleVerticalTextAlign default gtaLeading;\r\n    property TextHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTextHorizontalTextAlign write SetTextHorizontalTextAlign default gtaLeading;\r\n    property TextVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTextVerticalTextAlign write SetTextVerticalTextAlign default gtaLeading;\r\n    property Overlappable: Boolean read FOverlappable write SetOverlappable default True;\r\n    property Hint: String read FHint write SetHint;\r\n    property Tag: NativeInt read FTag write FTag default 0;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerItems = class(TTMSFNCOwnedCollection)\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerItems = class({$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<TTMSFNCPlannerItem>)\r\n  {$ENDIF}\r\n  private\r\n    FPlanner: TTMSFNCPlannerData;\r\n    function GetItem(Index: Integer): TTMSFNCPlannerItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerItem);\r\n  protected\r\n    function GetItemClass: TCollectionItemClass; virtual;\r\n  public\r\n    procedure Clear;\r\n    function Planner: TTMSFNCPlannerData;\r\n    constructor Create(APlanner: TTMSFNCPlannerData);\r\n    function Add: TTMSFNCPlannerItem;\r\n    function Insert(Index: Integer): TTMSFNCPlannerItem;\r\n    property Items[Index: Integer]: TTMSFNCPlannerItem read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TTMSFNCPlannerResourceDate = record\r\n    DateTime: TDateTime;\r\n    X: integer;\r\n    Y: integer;\r\n    Z: array of boolean;\r\n    {$IFDEF LCLLIB}\r\n    class operator = (z1, z2 : TTMSFNCPlannerResourceDate) b : Boolean;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerResourceItems = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerItem);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerItem read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCPlannerResourceDates = class(TList);\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerResourceItems = class(TList<TTMSFNCPlannerItem>);\r\n  TTMSFNCPlannerResourceDates = class(TList<TTMSFNCPlannerResourceDate>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerResource = class(TCollectionItem)\r\n  private\r\n    FTag: NativeInt;\r\n    FDataString: String;\r\n    FDataObject: TObject;\r\n    FDataInteger: NativeInt;\r\n    FPlanner: TTMSFNCPlannerData;\r\n    FText: String;\r\n    FName: String;\r\n    FDBKey: String;\r\n    FDataBoolean: Boolean;\r\n    FDataPointer: Pointer;\r\n    procedure SetText(const Value: String);\r\n    procedure SetName(const Value: String);\r\n  protected\r\n    procedure UpdateResource;\r\n    function GetText: String; virtual;\r\n    function GetResourceText: String; virtual;\r\n  public\r\n    function Planner: TTMSFNCPlannerData;\r\n    constructor Create(ACollection: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    property DataPointer: Pointer read FDataPointer write FDataPointer;\r\n    property DataBoolean: Boolean read FDataBoolean write FDataBoolean;\r\n    property DataObject: TObject read FDataObject write FDataObject;\r\n    property DataString: String read FDataString write FDataString;\r\n    property DataInteger: NativeInt read FDataInteger write FDataInteger;\r\n    property DBKey: String read FDBKey write FDBKey;\r\n  published\r\n    property Name: String read FName write SetName;\r\n    property Text: String read FText write SetText;\r\n    property Tag: NativeInt read FTag write FTag default 0;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerResources = class(TTMSFNCOwnedCollection)\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerResources = class({$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<TTMSFNCPlannerResource>)\r\n  {$ENDIF}\r\n  private\r\n    FPlanner: TTMSFNCPlannerData;\r\n    function GetItem(Index: Integer): TTMSFNCPlannerResource;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerResource);\r\n  protected\r\n    function GetItemClass: TCollectionItemClass; virtual;\r\n  public\r\n    function Planner: TTMSFNCPlannerData;\r\n    constructor Create(APlanner: TTMSFNCPlannerData);\r\n    function Add: TTMSFNCPlannerResource;\r\n    function Insert(Index: Integer): TTMSFNCPlannerResource;\r\n    property Items[Index: Integer]: TTMSFNCPlannerResource read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TTMSFNCPlannerGroup = class(TCollectionItem)\r\n  private\r\n    FTag: NativeInt;\r\n    FDataString: String;\r\n    FDataObject: TObject;\r\n    FDataInteger: NativeInt;\r\n    FPlanner: TTMSFNCPlannerData;\r\n    FText: String;\r\n    FStartPosition: Integer;\r\n    FEndPosition: Integer;\r\n    FName: String;\r\n    FDBKey: String;\r\n    FDataBoolean: Boolean;\r\n    FDataPointer: Pointer;\r\n    procedure SetText(const Value: String);\r\n    procedure SetStartPosition(const Value: Integer);\r\n    procedure SetEndPosition(const Value: Integer);\r\n    procedure SetName(const Value: String);\r\n  protected\r\n    procedure UpdateGroup;\r\n  public\r\n    function Planner: TTMSFNCPlannerData;\r\n    constructor Create(ACollection: TCollection); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    property DataPointer: Pointer read FDataPointer write FDataPointer;\r\n    property DataBoolean: Boolean read FDataBoolean write FDataBoolean;\r\n    property DataObject: TObject read FDataObject write FDataObject;\r\n    property DataString: String read FDataString write FDataString;\r\n    property DataInteger: NativeInt read FDataInteger write FDataInteger;\r\n    property DBKey: String read FDBKey write FDBKey;\r\n    function GetText: String; virtual;\r\n  published\r\n    property Name: String read FName write SetName;\r\n    property Text: String read FText write SetText;\r\n    property StartPosition: Integer read FStartPosition write SetStartPosition default 0;\r\n    property EndPosition: Integer read FEndPosition write SetEndPosition default 0;\r\n    property Tag: NativeInt read FTag write FTag default 0;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerGroups = class(TTMSFNCOwnedCollection)\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerGroups = class({$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<TTMSFNCPlannerGroup>)\r\n  {$ENDIF}\r\n  private\r\n    FPlanner: TTMSFNCPlannerData;\r\n    function GetItem(Index: Integer): TTMSFNCPlannerGroup;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerGroup);\r\n  protected\r\n    function GetItemClass: TCollectionItemClass; virtual;\r\n  public\r\n    function Planner: TTMSFNCPlannerData;\r\n    constructor Create(APlanner: TTMSFNCPlannerData);\r\n    function Add: TTMSFNCPlannerGroup;\r\n    function Insert(Index: Integer): TTMSFNCPlannerGroup;\r\n    property Items[Index: Integer]: TTMSFNCPlannerGroup read GetItem write SetItem; default;\r\n  end;\r\n\r\n  TTMSFNCPlannerData = class(TTMSFNCPlannerBase)\r\n  private\r\n    FItems: TTMSFNCPlannerItems;\r\n    FResources: TTMSFNCPlannerResources;\r\n    FGroups: TTMSFNCPlannerGroups;\r\n    procedure SetItems(const Value: TTMSFNCPlannerItems);\r\n    procedure SetResources(const Value: TTMSFNCPlannerResources);\r\n    procedure SetGroups(const Value: TTMSFNCPlannerGroups);\r\n  protected\r\n    procedure DirtyItems; override;\r\n    procedure DirtyItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure RemoveItemsFromCache(AList: TTMSFNCPlannerCacheItemList; APosition: Integer = -1); virtual; abstract;\r\n    procedure RemoveAllItemsFromCache; virtual; abstract;\r\n    procedure NeedsConflictsUpdate(AItem: TTMSFNCPlannerItem = nil); virtual; abstract;\r\n    procedure RemoveLinkedItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure UpdateLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartTime, ADiffEndTime: TDateTime; ADiffPosition: Integer); virtual; abstract;\r\n    function CreateItems: TTMSFNCPlannerItems; virtual;\r\n    function CreateResources: TTMSFNCPlannerResources; virtual;\r\n    function CreateGroups: TTMSFNCPlannerGroups; virtual;\r\n    function GetDefaultItem: TTMSFNCPlannerItem; virtual; abstract;\r\n    function GetActiveItem: TTMSFNCPlannerItem; virtual; abstract;\r\n    procedure UpdateActiveItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    property Items: TTMSFNCPlannerItems read FItems write SetItems;\r\n    property Resources: TTMSFNCPlannerResources read FResources write SetResources;\r\n    property Groups: TTMSFNCPlannerGroups read FGroups write SetGroups;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function FindResourceByName(AName: String): TTMSFNCPlannerResource; virtual;\r\n    function FindGroupByName(AName: String): TTMSFNCPlannerGroup; virtual;\r\n    function FindResourceIndexByName(AName: String): Integer; virtual;\r\n    function FindGroupIndexByName(AName: String): Integer; virtual;\r\n  end;\r\n\r\nfunction TranslateTextEx(AText: String): String;\r\n\r\nimplementation\r\n\r\nuses\r\n  DateUtils\r\n  {$IFNDEF WEBLIB}\r\n  ,SysUtils\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  ,StrUtils\r\n  {$ENDIF}\r\n  ;\r\n\r\nfunction TranslateTextEx(AText: String): String;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  Result := TranslateText(AText);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result := AText;\r\n  {$ENDIF}\r\nend;\r\n\r\n{ TTMSFNCPlannerData }\r\n\r\nprocedure TTMSFNCPlannerData.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCPlannerData then\r\n  begin\r\n    FItems.Assign((Source as TTMSFNCPlannerData).Items);\r\n    FResources.Assign((Source as TTMSFNCPlannerData).Resources);\r\n    FGroups.Assign((Source as TTMSFNCPlannerData).Groups);\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerData.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FItems := CreateItems;\r\n  FResources := CreateResources;\r\n  FGroups := CreateGroups;\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.CreateGroups: TTMSFNCPlannerGroups;\r\nbegin\r\n  Result := TTMSFNCPlannerGroups.Create(Self);\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.CreateItems: TTMSFNCPlannerItems;\r\nbegin\r\n  Result := TTMSFNCPlannerItems.Create(Self);\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.CreateResources: TTMSFNCPlannerResources;\r\nbegin\r\n  Result := TTMSFNCPlannerResources.Create(Self);\r\nend;\r\n\r\ndestructor TTMSFNCPlannerData.Destroy;\r\nbegin\r\n  FGroups.Free;\r\n  FResources.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerData.DirtyItems;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to Items.Count - 1 do\r\n    Items[I].DirtyItem;\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.FindGroupByName(AName: String): TTMSFNCPlannerGroup;\r\nvar\r\n  I: Integer;\r\n  grp: TTMSFNCPlannerGroup;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to Groups.Count - 1 do\r\n  begin\r\n    grp := Groups[I];\r\n    if grp.Name = AName then\r\n    begin\r\n      Result := grp;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.FindGroupIndexByName(AName: String): Integer;\r\nvar\r\n  grp: TTMSFNCPlannerGroup;\r\nbegin\r\n  Result := -1;\r\n  grp := FindGroupByName(AName);\r\n  if Assigned(grp) then\r\n    Result := grp.Index;\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.FindResourceByName(\r\n  AName: String): TTMSFNCPlannerResource;\r\nvar\r\n  I: Integer;\r\n  res: TTMSFNCPlannerResource;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to Resources.Count - 1 do\r\n  begin\r\n    res := Resources[I];\r\n    if res.Name = AName then\r\n    begin\r\n      Result := res;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerData.FindResourceIndexByName(AName: String): Integer;\r\nvar\r\n  res: TTMSFNCPlannerResource;\r\nbegin\r\n  Result := -1;\r\n  res := FindResourceByName(AName);\r\n  if Assigned(res) then\r\n    Result := res.Index;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerData.SetGroups(const Value: TTMSFNCPlannerGroups);\r\nbegin\r\n  FGroups.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerData.SetItems(const Value: TTMSFNCPlannerItems);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerData.SetResources(const Value: TTMSFNCPlannerResources);\r\nbegin\r\n  FResources.Assign(Value);\r\nend;\r\n\r\n{ TTMSFNCPlannerItem }\r\n\r\nprocedure TTMSFNCPlannerItem.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerItem then\r\n  begin\r\n    FBlockUpdate := True;\r\n    FRecurrency := (Source as TTMSFNCPlannerItem).Recurrency;\r\n    FRecurrent := (Source as TTMSFNCPlannerItem).Recurrent;\r\n    FOverlappable := (Source as TTMSFNCPlannerItem).Overlappable;\r\n    FLinkArrow := (Source as TTMSFNCPlannerItem).LinkArrow;\r\n    FLinkColor := (Source as TTMSFNCPlannerItem).LinkColor;\r\n    FSelectedLinkColor := (Source as TTMSFNCPlannerItem).SelectedLinkColor;\r\n    FTag := (Source as TTMSFNCPlannerItem).Tag;\r\n    FText := (Source as TTMSFNCPlannerItem).Text;\r\n    FStartTime := (Source as TTMSFNCPlannerItem).StartTime;\r\n    FEndTime := (Source as TTMSFNCPlannerItem).EndTime;\r\n    FResource := (Source as TTMSFNCPlannerItem).Resource;\r\n    FTitle := (Source as TTMSFNCPlannerItem).Title;\r\n    FVisible := (Source as TTMSFNCPlannerItem).Visible;\r\n    FEditable := (Source as TTMSFNCPlannerItem).Editable;\r\n    FShowTitle := (Source as TTMSFNCPlannerItem).ShowTitle;\r\n    FEnabled := (Source as TTMSFNCPlannerItem).Enabled;\r\n    FSelectable := (Source as TTMSFNCPlannerItem).Selectable;\r\n    FDeletable := (Source as TTMSFNCPlannerItem).Deletable;\r\n    FSizeable := (Source as TTMSFNCPlannerItem).Sizeable;\r\n    FMovable := (Source as TTMSFNCPlannerItem).Movable;\r\n    FFixedResource := (Source as TTMSFNCPlannerItem).FixedResource;\r\n    FColor := (Source as TTMSFNCPlannerItem).Color;\r\n    FFontColor := (Source as TTMSFNCPlannerItem).FontColor;\r\n    FFontStyle := (Source as TTMSFNCPlannerItem).FontStyle;\r\n    FFontName := (Source as TTMSFNCPlannerItem).FontName;\r\n    FFontSize := (Source as TTMSFNCPlannerItem).FontSize;\r\n    FTitleColor := (Source as TTMSFNCPlannerItem).TitleColor;\r\n    FTitleFontColor := (Source as TTMSFNCPlannerItem).TitleFontColor;\r\n    FTitleFontStyle := (Source as TTMSFNCPlannerItem).TitleFontStyle;\r\n    FTitleFontName := (Source as TTMSFNCPlannerItem).TitleFontName;\r\n    FTitleFontSize := (Source as TTMSFNCPlannerItem).TitleFontSize;\r\n    FSelectedColor := (Source as TTMSFNCPlannerItem).SelectedColor;\r\n    FSelectedFontColor := (Source as TTMSFNCPlannerItem).SelectedFontColor;\r\n    FSelectedFontName := (Source as TTMSFNCPlannerItem).SelectedFontName;\r\n    FSelectedFontSize := (Source as TTMSFNCPlannerItem).SelectedFontSize;\r\n    FSelectedFontStyle := (Source as TTMSFNCPlannerItem).SelectedFontStyle;\r\n    FSelectedTitleColor := (Source as TTMSFNCPlannerItem).SelectedTitleColor;\r\n    FSelectedTitleFontColor := (Source as TTMSFNCPlannerItem).SelectedTitleFontColor;\r\n    FSelectedTitleFontStyle := (Source as TTMSFNCPlannerItem).SelectedTitleFontStyle;\r\n    FSelectedTitleFontName := (Source as TTMSFNCPlannerItem).SelectedTitleFontName;\r\n    FSelectedTitleFontSize := (Source as TTMSFNCPlannerItem).SelectedTitleFontSize;\r\n    FActiveColor := (Source as TTMSFNCPlannerItem).ActiveColor;\r\n    FActiveFontColor := (Source as TTMSFNCPlannerItem).ActiveFontColor;\r\n    FActiveTitleColor := (Source as TTMSFNCPlannerItem).ActiveTitleColor;\r\n    FActiveTitleFontColor := (Source as TTMSFNCPlannerItem).ActiveTitleFontColor;\r\n    FActiveFontStyle := (Source as TTMSFNCPlannerItem).ActiveFontStyle;\r\n    FActiveFontName := (Source as TTMSFNCPlannerItem).ActiveFontName;\r\n    FActiveFontSize := (Source as TTMSFNCPlannerItem).ActiveFontSize;\r\n    FActiveTitleFontStyle := (Source as TTMSFNCPlannerItem).ActiveTitleFontStyle;\r\n    FActiveTitleFontName := (Source as TTMSFNCPlannerItem).ActiveTitleFontName;\r\n    FActiveTitleFontSize := (Source as TTMSFNCPlannerItem).ActiveTitleFontSize;\r\n    FDisabledColor := (Source as TTMSFNCPlannerItem).DisabledColor;\r\n    FDisabledFontColor := (Source as TTMSFNCPlannerItem).DisabledFontColor;\r\n    FDisabledTitleColor := (Source as TTMSFNCPlannerItem).DisabledTitleColor;\r\n    FDisabledTitleFontColor := (Source as TTMSFNCPlannerItem).DisabledTitleFontColor;\r\n    FDisabledFontName := (Source as TTMSFNCPlannerItem).DisabledFontName;\r\n    FDisabledFontSize := (Source as TTMSFNCPlannerItem).DisabledFontSize;\r\n    FDisabledFontStyle := (Source as TTMSFNCPlannerItem).DisabledFontStyle;\r\n    FDisabledTitleFontName := (Source as TTMSFNCPlannerItem).DisabledTitleFontName;\r\n    FDisabledTitleFontStyle := (Source as TTMSFNCPlannerItem).DisabledTitleFontStyle;\r\n    FDisabledTitleFontSize := (Source as TTMSFNCPlannerItem).DisabledTitleFontSize;\r\n    FUseDefaultAppearance := (Source as TTMSFNCPlannerItem).UseDefaultAppearance;\r\n    FTextVerticalTextAlign := (Source as TTMSFNCPlannerItem).TextVerticalTextAlign;\r\n    FTextHorizontalTextAlign := (Source as TTMSFNCPlannerItem).TextHorizontalTextAlign;\r\n    FTitleVerticalTextAlign := (Source as TTMSFNCPlannerItem).TitleVerticalTextAlign;\r\n    FTitleHorizontalTextAlign := (Source as TTMSFNCPlannerItem).TitleHorizontalTextAlign;\r\n    FHint := (Source as TTMSFNCPlannerItem).Hint;\r\n    FBlockUpdate := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.BeginUpdate;\r\nbegin\r\n  Inc(FUpdateCount);\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.ConflictsForPosition(APosition: Integer): Integer;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := 1;\r\n  for I := 0 to PositionsList.Count - 1 do\r\n  begin\r\n    if (PositionsList[I] = APosition) and (I >= 0) and (I <= ConflictsList.Count - 1) then\r\n    begin\r\n      Result := ConflictsList[I];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.ConflictsPosForPosition(\r\n  APosition: Integer): Integer;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := 1;\r\n  for I := 0 to PositionsList.Count - 1 do\r\n  begin\r\n    if (PositionsList[I] = APosition) and (I >= 0) and (I <= ConflictsPosList.Count - 1) then\r\n    begin\r\n      Result := ConflictsPosList[I];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerItem.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  if Assigned(Collection) then\r\n  begin\r\n    FPlanner := (Collection as TTMSFNCPlannerItems).Planner;\r\n    FTitle := 'Item ' + inttostr(FPlanner.Items.Count - 1);\r\n  end;\r\n\r\n  FOldPositionsList := TTMSFNCPlannerIntegerList.Create;\r\n  FPositionsList := TTMSFNCPlannerIntegerList.Create;\r\n  FDirtyList := TTMSFNCPlannerIntegerList.Create;\r\n  FCleanupList := TTMSFNCPlannerIntegerList.Create;\r\n  FConflictsPosList := TTMSFNCPlannerIntegerList.Create;\r\n  FConflictsList := TTMSFNCPlannerIntegerList.Create;\r\n  FCacheList := TTMSFNCPlannerCacheItemList.Create;\r\n\r\n  FResource := 0;\r\n  FOverlappable := True;\r\n  FShowTitle := True;\r\n  FVisible := True;\r\n  FSelectable := True;\r\n  FDeletable := True;\r\n  FMovable := True;\r\n  FSizeable := True;\r\n  FFixedResource := False;\r\n  FLinkColor := gcDarkgray;\r\n  FSelectedLinkColor := TMSFNCPlannerSelectedColor;\r\n  FLinkArrow := ilaNone;\r\n  FLinkType := iltNone;\r\n\r\n  FColor := TMSFNCPlannerColor;\r\n  FFontColor := TMSFNCPlannerFontColor;\r\n  FTitleColor := gcNull;\r\n  FTitleFontColor := TMSFNCPlannerFontColor;\r\n  FSelectedColor := TMSFNCPlannerSelectedColor;\r\n  FSelectedFontColor := gcWhite;\r\n  FSelectedTitleColor := gcNull;\r\n  FSelectedTitleFontColor := gcWhite;\r\n  FActiveColor := TMSFNCPlannerSelectedColor;\r\n  FActiveFontColor := gcWhite;\r\n  FActiveTitleColor := gcNull;\r\n  FActiveTitleFontColor := gcWhite;\r\n  FDisabledColor := gcDarkGray;\r\n  FDisabledFontColor := gcWhitesmoke;\r\n  FDisabledTitleColor := gcNull;\r\n  FDisabledTitleFontColor := gcWhitesmoke;\r\n  FStartTime := Int(Now) + EncodeTime(6, 30, 0, 0);\r\n  FEndTime := FStartTime + EncodeTime(2, 30, 0, 0);\r\n\r\n  FFontStyle := [];\r\n  FActiveFontStyle := [];\r\n  FDisabledFontStyle := [];\r\n  FSelectedFontStyle := [];\r\n\r\n  FTitleFontStyle := [TFontStyle.fsBold];\r\n  FActiveTitleFontStyle := [TFontStyle.fsBold];\r\n  FDisabledTitleFontStyle := [TFontStyle.fsBold];\r\n  FSelectedTitleFontStyle := [TFontStyle.fsBold];\r\n\r\n  FUseDefaultAppearance := False;\r\n\r\n  FFontName := '';\r\n  FActiveFontName := '';\r\n  FDisabledFontName := '';\r\n  FSelectedFontName := '';\r\n\r\n  FTitleFontName := '';\r\n  FActiveTitleFontName := '';\r\n  FDisabledTitleFontName := '';\r\n  FSelectedTitleFontName := '';\r\n\r\n  FFontSize := -1;\r\n  FActiveFontSize := -1;\r\n  FDisabledFontSize := -1;\r\n  FSelectedFontSize := -1;\r\n\r\n  FTitleFontSize := -1;\r\n  FActiveTitleFontSize := -1;\r\n  FDisabledTitleFontSize := -1;\r\n  FSelectedTitleFontSize := -1;\r\n\r\n  FEditable := True;\r\n  FEnabled := True;\r\n\r\n  FTitleVerticalTextAlign := gtaLeading;\r\n  FTitleHorizontalTextAlign := gtaLeading;\r\n  FTextHorizontalTextAlign := gtaLeading;\r\n  FTextVerticalTextAlign := gtaLeading;\r\n\r\n  if Assigned(FPlanner) then\r\n    Assign(FPlanner.GetDefaultItem);\r\n\r\n  UpdateItem(True);\r\nend;\r\n\r\ndestructor TTMSFNCPlannerItem.Destroy;\r\nbegin\r\n  if Assigned(FPlanner) and (FPlanner.GetActiveItem = Self) then\r\n    FPlanner.UpdateActiveItem(nil);\r\n\r\n  if Assigned(FCacheList) and Assigned(FPlanner) and not (csDestroying in Planner.ComponentState) then\r\n    FPlanner.RemoveItemsFromCache(FCacheList);\r\n\r\n  if Assigned(FPlanner) then\r\n    FPlanner.NeedsConflictsUpdate(Self);\r\n\r\n  if Assigned(FPlanner) then\r\n    FPlanner.RemoveLinkedItem(Self);\r\n\r\n  FMasterItem := nil;\r\n  FLinkedItem := nil;\r\n  FConflictsPosList.Free;\r\n  FConflictsList.Free;\r\n  FOldPositionsList.Free;\r\n  FPositionsList.Free;\r\n  FDirtyList.Free;\r\n  FCleanupList.Free;\r\n  FCacheList.Free;\r\n  inherited;\r\n  UpdateItem(True);\r\n  FPlanner := nil;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.DirtyItem;\r\nbegin\r\n  if Assigned(FPlanner) then\r\n    FPlanner.DirtyItem(Self);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectable(const Value: Boolean);\r\nbegin\r\n  if FSelectable <> Value then\r\n    FSelectable := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSelectedColor <> Value then\r\n  begin\r\n    FSelectedColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedLinkColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSelectedLinkColor <> Value then\r\n  begin\r\n    FSelectedLinkColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedFontColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSelectedFontColor <> Value then\r\n  begin\r\n    FSelectedFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedFontName(const Value: string);\r\nbegin\r\n  if FSelectedFontName <> Value then\r\n  begin\r\n    FSelectedFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedFontSize(const Value: Single);\r\nbegin\r\n  if FSelectedFontSize <> Value then\r\n  begin\r\n    FSelectedFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FSelectedFontStyle <> Value then\r\n  begin\r\n    FSelectedFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedTitleColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSelectedTitleColor <> Value then\r\n  begin\r\n    FSelectedTitleColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedTitleFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSelectedTitleFontColor <> Value then\r\n  begin\r\n    FSelectedTitleFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedTitleFontName(const Value: string);\r\nbegin\r\n  if FSelectedTitleFontName <> Value then\r\n  begin\r\n    FSelectedTitleFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedTitleFontSize(const Value: Single);\r\nbegin\r\n  if FSelectedTitleFontSize <> Value then\r\n  begin\r\n    FSelectedTitleFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSelectedTitleFontStyle(\r\n  const Value: TFontStyles);\r\nbegin\r\n  if FSelectedTitleFontStyle <> Value then\r\n  begin\r\n    FSelectedTitleFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetShowTitle(const Value: Boolean);\r\nbegin\r\n  if FShowTitle <> Value then\r\n  begin\r\n    FShowTitle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FActiveColor <> Value then\r\n  begin\r\n    FActiveColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveFontColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FActiveFontColor <> Value then\r\n  begin\r\n    FActiveFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveFontName(const Value: string);\r\nbegin\r\n  if FActiveFontName <> Value then\r\n  begin\r\n    FActiveFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveFontSize(const Value: Single);\r\nbegin\r\n  if FActiveFontSize <> Value then\r\n  begin\r\n    FActiveFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FActiveFontStyle <> Value then\r\n  begin\r\n    FActiveFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveTitleColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FActiveTitleColor <> Value then\r\n  begin\r\n    FActiveTitleColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveTitleFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FActiveTitleFontColor <> Value then\r\n  begin\r\n    FActiveTitleFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveTitleFontName(const Value: string);\r\nbegin\r\n  if FActiveTitleFontName <> Value then\r\n  begin\r\n    FActiveTitleFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveTitleFontSize(const Value: Single);\r\nbegin\r\n  if FActiveTitleFontSize <> Value then\r\n  begin\r\n    FActiveTitleFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetActiveTitleFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FActiveTitleFontStyle <> Value then\r\n  begin\r\n    FActiveTitleFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetSizeable(const Value: Boolean);\r\nbegin\r\n  if FSizeable <> Value then\r\n  begin\r\n    FSizeable := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.EndUpdate(ADirty: Boolean = True; AUpdate: Boolean = True);\r\nbegin\r\n  Dec(FUpdateCount);\r\n  if (FUpdateCount = 0) and AUpdate then\r\n    UpdateItem(False, ADirty);\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.GetFirstRect: TRectF;\r\nbegin\r\n  Result := EmptyRect;\r\n  if (CacheList.Count > 0) then\r\n    Result := CacheList[CacheList.Count - 1].DrawRect;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.GetLastRect: TRectF;\r\nbegin\r\n  Result := EmptyRect;\r\n  if (CacheList.Count > 0) then\r\n    Result := CacheList[0].DrawRect;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.GetRect(AIndex: Integer): TRectF;\r\nbegin\r\n  Result := EmptyRect;\r\n  if (AIndex >= 0) and (AIndex <= CacheList.Count - 1) then\r\n    Result := CacheList[AIndex].DrawRect\r\n  else\r\n    Result := GetFirstRect;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsActiveFontSizeStored: Boolean;\r\nbegin\r\n  Result := ActiveFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsActiveTitleFontSizeStored: Boolean;\r\nbegin\r\n  Result := ActiveTitleFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsDisabledFontSizeStored: Boolean;\r\nbegin\r\n  Result := DisabledFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsDisabledTitleFontSizeStored: Boolean;\r\nbegin\r\n  Result := DisabledTitleFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsFontSizeStored: Boolean;\r\nbegin\r\n  Result := FontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsSelectedFontSizeStored: Boolean;\r\nbegin\r\n  Result := SelectedFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsSelectedTitleFontSizeStored: Boolean;\r\nbegin\r\n  Result := SelectedTitleFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.IsTitleFontSizeStored: Boolean;\r\nbegin\r\n  Result := TitleFontSize <> -1;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItem.RectCount: Integer;\r\nbegin\r\n  Result := CacheList.Count;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FColor <> Value then\r\n  begin\r\n    FColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDeletable(const Value: Boolean);\r\nbegin\r\n  if FDeletable <> Value then\r\n  begin\r\n    FDeletable := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDisabledColor <> Value then\r\n  begin\r\n    FDisabledColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledFontColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDisabledFontColor <> Value then\r\n  begin\r\n    FDisabledFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledFontName(const Value: string);\r\nbegin\r\n  if FDisabledFontName <> Value then\r\n  begin\r\n    FDisabledFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledFontSize(const Value: Single);\r\nbegin\r\n  if FDisabledFontSize <> Value then\r\n  begin\r\n    FDisabledFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FDisabledFontStyle <> Value then\r\n  begin\r\n    FDisabledFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledTitleColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDisabledTitleColor <> Value then\r\n  begin\r\n    FDisabledTitleColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledTitleFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDisabledTitleFontColor <> Value then\r\n  begin\r\n    FDisabledTitleFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledTitleFontName(const Value: string);\r\nbegin\r\n  if FDisabledTitleFontName <> Value then\r\n  begin\r\n    FDisabledTitleFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledTitleFontSize(const Value: Single);\r\nbegin\r\n  if FDisabledTitleFontSize <> Value then\r\n  begin\r\n    FDisabledTitleFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetDisabledTitleFontStyle(\r\n  const Value: TFontStyles);\r\nbegin\r\n  if FDisabledTitleFontStyle <> Value then\r\n  begin\r\n    FDisabledTitleFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetEditable(const Value: Boolean);\r\nbegin\r\n  if FEditable <> Value then\r\n    FEditable := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetEnabled(const Value: Boolean);\r\nbegin\r\n  if FEnabled <> Value then\r\n  begin\r\n    FEnabled := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetEndTime(const Value: TDateTime);\r\nvar\r\n  dst, det: Double;\r\n  drs: Integer;\r\nbegin\r\n  if (CompareDateTime(FEndTime, Value) <> 0) and not FUpdatingLinkedItem then\r\n  begin\r\n    FUpdatingLinkedItem := True;\r\n    dst := 0;\r\n    det := Value - FEndTime;\r\n    drs := 0;\r\n    FEndTime := Value;\r\n    if Assigned(FPlanner) then\r\n      FPlanner.UpdateLinkedItems(Self, dst, det, drs);\r\n    UpdateItem(True);\r\n    FUpdatingLinkedItem := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetFixedResource(const Value: Boolean);\r\nbegin\r\n  if FFixedResource <> Value then\r\n  begin\r\n    FFixedResource := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetFontColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FFontColor <> Value then\r\n  begin\r\n    FFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetFontName(const Value: string);\r\nbegin\r\n  if FFontName <> Value then\r\n  begin\r\n    FFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetFontSize(const Value: Single);\r\nbegin\r\n  if FFontSize <> Value then\r\n  begin\r\n    FFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FFontStyle <> Value then\r\n  begin\r\n    FFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetHint(const Value: String);\r\nbegin\r\n  if FHint <> Value then\r\n    FHint := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetLinkArrow(\r\n  const Value: TTMSFNCPlannerItemLinkArrow);\r\nbegin\r\n  if FLinkArrow <> Value then\r\n  begin\r\n    FLinkArrow := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetLinkColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FLinkColor <> Value then\r\n  begin\r\n    FLinkColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetLinkedItem(const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  if FLinkedItem <> Value then\r\n    FLinkedItem := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetLinkType(\r\n  const Value: TTMSFNCPlannerItemLinkType);\r\nbegin\r\n  if FLinkType <> Value then\r\n    FLinkType := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetMovable(const Value: Boolean);\r\nbegin\r\n  if FMovable <> Value then\r\n  begin\r\n    FMovable := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetOverlappable(const Value: Boolean);\r\nbegin\r\n  if FOverlappable <> Value then\r\n    FOverlappable := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetResource(const Value: Integer);\r\nvar\r\n  dst, det: Double;\r\n  drs: Integer;\r\nbegin\r\n  if (FResource <> Value) and not FUpdatingLinkedItem then\r\n  begin\r\n    FUpdatingLinkedItem := True;\r\n    dst := 0;\r\n    det := 0;\r\n    drs := Value - FResource;\r\n    FResource := Value;\r\n    if Assigned(FPlanner) then\r\n      FPlanner.UpdateLinkedItems(Self, dst, det, drs);\r\n    UpdateItem(True);\r\n    FUpdatingLinkedItem := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetStartTime(const Value: TDateTime);\r\nvar\r\n  dst, det: Double;\r\n  drs: Integer;\r\nbegin\r\n  if (CompareDateTime(FStartTime, Value) <> 0) and not FUpdatingLinkedItem then\r\n  begin\r\n    FUpdatingLinkedItem := True;\r\n    dst := Value - FStartTime;\r\n    det := 0;\r\n    drs := 0;\r\n    FStartTime := Value;\r\n    if Assigned(FPlanner) then\r\n      FPlanner.UpdateLinkedItems(Self, dst, det, drs);\r\n    UpdateItem(True);\r\n    FUpdatingLinkedItem := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetText(const Value: String);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTextHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTextHorizontalTextAlign <> Value then\r\n  begin\r\n    FTextHorizontalTextAlign := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTextVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTextVerticalTextAlign <> Value then\r\n  begin\r\n    FTextVerticalTextAlign := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitle(const Value: String);\r\nbegin\r\n  if FTitle <> Value then\r\n  begin\r\n    FTitle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FTitleColor <> Value then\r\n  begin\r\n    FTitleColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleFontColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FTitleFontColor <> Value then\r\n  begin\r\n    FTitleFontColor := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleFontName(const Value: string);\r\nbegin\r\n  if FTitleFontName <> Value then\r\n  begin\r\n    FTitleFontName := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleFontSize(const Value: Single);\r\nbegin\r\n  if FTitleFontSize <> Value then\r\n  begin\r\n    FTitleFontSize := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleFontStyle(const Value: TFontStyles);\r\nbegin\r\n  if FTitleFontStyle <> Value then\r\n  begin\r\n    FTitleFontStyle := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTitleHorizontalTextAlign <> Value then\r\n  begin\r\n    FTitleHorizontalTextAlign := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetTitleVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTitleVerticalTextAlign <> Value then\r\n  begin\r\n    FTitleVerticalTextAlign := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetUseDefaultAppearance(const Value: Boolean);\r\nbegin\r\n  if FUseDefaultAppearance <> Value then\r\n  begin\r\n    FUseDefaultAppearance := Value;\r\n    UpdateItem;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.SetVisible(const Value: Boolean);\r\nbegin\r\n  if FVisible <> Value then\r\n  begin\r\n    FVisible := Value;\r\n    UpdateItem(True);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItem.UpdateItem(ANeedsConflictsUpdate: Boolean = False; ADirty: Boolean = True);\r\nvar\r\n  c: TTMSFNCPlannerData;\r\nbegin\r\n  if FBlockUpdate or (Assigned(FPlanner) and (csDestroying in FPlanner.ComponentState)) then\r\n    Exit;\r\n\r\n  c := Planner;\r\n  if Assigned(c) then\r\n  begin\r\n    if Assigned(Self.Collection) then\r\n    begin\r\n      if ADirty then\r\n        DirtyItem;\r\n      if ANeedsConflictsUpdate then\r\n        c.NeedsConflictsUpdate(Self);\r\n    end;\r\n\r\n    if (FUpdateCount > 0) or (Assigned(FPlanner) and (FPlanner.UpdateCount > 0)) then\r\n      Exit;\r\n\r\n    c.UpdateConflicts;\r\n    c.UpdateItemsCache;\r\n    c.Invalidate;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerItems }\r\n\r\nfunction TTMSFNCPlannerItems.Add: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := TTMSFNCPlannerItem(inherited Add);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItems.Clear;\r\nvar\r\n  p: TTMSFNCPlannerData;\r\nbegin\r\n  p := Planner;\r\n  if Assigned(p) and not (csDestroying in p.ComponentState) then\r\n    p.RemoveAllItemsFromCache;\r\n\r\n  inherited Clear;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerItems.Create(APlanner: TTMSFNCPlannerData);\r\nbegin\r\n  inherited Create(APlanner, GetItemClass);\r\n  FPlanner := APlanner;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItems.GetItem(Index: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := TTMSFNCPlannerItem(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCPlannerItems.GetItemClass: TCollectionItemClass;\r\nbegin\r\n  Result := TTMSFNCPlannerItem;\r\nend;\r\n\r\nfunction TTMSFNCPlannerItems.Insert(Index: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := TTMSFNCPlannerItem(inherited Insert(Index));\r\nend;\r\n\r\nfunction TTMSFNCPlannerItems.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItems.SetItem(Index: Integer;\r\n  const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TTMSFNCPlannerGroup }\r\n\r\nprocedure TTMSFNCPlannerGroup.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerGroup then\r\n  begin\r\n    FTag := (Source as TTMSFNCPlannerGroup).Tag;\r\n    FText := (Source as TTMSFNCPlannerGroup).Text;\r\n    FStartPosition := (Source as TTMSFNCPlannerGroup).StartPosition;\r\n    FEndPosition := (Source as TTMSFNCPlannerGroup).EndPosition;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerGroup.Create(ACollection: TCollection);\r\nvar\r\n  grp: TTMSFNCPlannerGroup;\r\nbegin\r\n  inherited;\r\n  if Assigned(Collection) then\r\n    FPlanner := (Collection as TTMSFNCPlannerGroups).Planner;\r\n  FText := TranslateTextEx(sTMSFNCPlannerGroup) + ' ' + inttostr(FPlanner.Groups.Count - 1);\r\n  if FPlanner.Groups.Count < 2 then\r\n  begin\r\n    FStartPosition := 0;\r\n    FEndPosition := 0\r\n  end\r\n  else\r\n  begin\r\n    grp := FPlanner.Groups[FPlanner.Groups.Count - 2];\r\n    FStartPosition := grp.StartPosition + 1;\r\n    FEndPosition := FStartPosition;\r\n  end;\r\n  UpdateGroup;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerGroup.Destroy;\r\nbegin\r\n  inherited;\r\n  UpdateGroup;\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroup.GetText: String;\r\nbegin\r\n  Result  := Text;\r\n  if Result = '' then\r\n  begin\r\n    Result := Name;\r\n    if Result = '' then\r\n      Result := TranslateTextEx(sTMSFNCPlannerGroup) + ' ' + inttostr(Index);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroup.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroup.SetStartPosition(const Value: Integer);\r\nbegin\r\n  if FStartPosition <> Value then\r\n  begin\r\n    FStartPosition := Value;\r\n    UpdateGroup;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroup.SetEndPosition(const Value: Integer);\r\nbegin\r\n  if FEndPosition <> Value then\r\n  begin\r\n    FEndPosition := Value;\r\n    UpdateGroup;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroup.SetName(const Value: String);\r\nbegin\r\n  if FName <> Value then\r\n  begin\r\n    FName := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroup.SetText(const Value: String);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    UpdateGroup;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroup.UpdateGroup;\r\nvar\r\n  c: TTMSFNCPlannerData;\r\nbegin\r\n  c := Planner;\r\n  if Assigned(c) then\r\n    c.UpdatePlannerCache;\r\nend;\r\n\r\n{ TTMSFNCPlannerGroups }\r\n\r\nfunction TTMSFNCPlannerGroups.Add: TTMSFNCPlannerGroup;\r\nbegin\r\n  Result := TTMSFNCPlannerGroup(inherited Add);\r\nend;\r\n\r\nconstructor TTMSFNCPlannerGroups.Create(APlanner: TTMSFNCPlannerData);\r\nbegin\r\n  inherited Create(APlanner, GetItemClass);\r\n  FPlanner := APlanner;\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroups.GetItem(Index: Integer): TTMSFNCPlannerGroup;\r\nbegin\r\n  Result := TTMSFNCPlannerGroup(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroups.GetItemClass: TCollectionItemClass;\r\nbegin\r\n  Result := TTMSFNCPlannerGroup;\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroups.Insert(Index: Integer): TTMSFNCPlannerGroup;\r\nbegin\r\n  Result := TTMSFNCPlannerGroup(inherited Insert(Index));\r\nend;\r\n\r\nfunction TTMSFNCPlannerGroups.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroups.SetItem(Index: Integer;\r\n  const Value: TTMSFNCPlannerGroup);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TTMSFNCPlannerResource }\r\n\r\nprocedure TTMSFNCPlannerResource.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerResource then\r\n  begin\r\n    FTag := (Source as TTMSFNCPlannerResource).Tag;\r\n    FText := (Source as TTMSFNCPlannerResource).Text;\r\n    FName := (Source as TTMSFNCPlannerResource).Name;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerResource.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  if Assigned(Collection) then\r\n    FPlanner := (Collection as TTMSFNCPlannerResources).Planner;\r\n\r\n  if Assigned(FPlanner) then\r\n    FText := TranslateTextEx(sTMSFNCPlannerResource) + ' ' + inttostr(FPlanner.Resources.Count - 1);\r\n\r\n  FName := StringReplace(FText, ' ', '', [rfReplaceAll]);\r\n  UpdateResource;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerResource.Destroy;\r\nbegin\r\n  inherited;\r\n  UpdateResource;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResource.GetResourceText: String;\r\nbegin\r\n  Result := Text;\r\n  if (Result = '') or (AnsiPos('</', Result) > 0) or (AnsiPos('/>', Result) > 0) or (AnsiPos('<BR>', UpperCase(Result)) > 0) then\r\n  begin\r\n    Result := Name;\r\n    if Result = '' then\r\n      Result := TranslateTextEx(sTMSFNCPlannerResource) + ' ' + inttostr(Index);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResource.GetText: String;\r\nbegin\r\n  Result := Text;\r\n  if Result = '' then\r\n  begin\r\n    Result := Name;\r\n    if Result = '' then\r\n      Result := TranslateTextEx(sTMSFNCPlannerResource) + ' ' + inttostr(Index);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResource.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerResource.SetName(const Value: String);\r\nbegin\r\n  if FName <> Value then\r\n  begin\r\n    FName := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerResource.SetText(const Value: String);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    UpdateResource;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerResource.UpdateResource;\r\nvar\r\n  c: TTMSFNCPlannerData;\r\nbegin\r\n  c := Planner;\r\n  if Assigned(c) then\r\n    c.UpdatePlannerCache;\r\nend;\r\n\r\n{ TTMSFNCPlannerResources }\r\n\r\nfunction TTMSFNCPlannerResources.Add: TTMSFNCPlannerResource;\r\nbegin\r\n  Result := TTMSFNCPlannerResource(inherited Add);\r\nend;\r\n\r\nconstructor TTMSFNCPlannerResources.Create(APlanner: TTMSFNCPlannerData);\r\nbegin\r\n  inherited Create(APlanner, GetItemClass);\r\n  FPlanner := APlanner;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResources.GetItem(Index: Integer): TTMSFNCPlannerResource;\r\nbegin\r\n  Result := TTMSFNCPlannerResource(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCPlannerResources.GetItemClass: TCollectionItemClass;\r\nbegin\r\n  Result := TTMSFNCPlannerResource;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResources.Insert(Index: Integer): TTMSFNCPlannerResource;\r\nbegin\r\n  Result := TTMSFNCPlannerResource(inherited Insert(Index));\r\nend;\r\n\r\nfunction TTMSFNCPlannerResources.Planner: TTMSFNCPlannerData;\r\nbegin\r\n  Result := FPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerResources.SetItem(Index: Integer;\r\n  const Value: TTMSFNCPlannerResource);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TTMSFNCPlannerCacheItem }\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateCache(ARect: TRectF;\r\n  ABitmap: TBitmap; AKind: TTMSFNCPlannerCacheItemKind; APosition: Integer = -1): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := AKind;\r\n  Result.Position := APosition;\r\n  Result.Rect := ARect;\r\n  Result.Bitmap := ABitmap;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateCell(ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime; APosition: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikCell;\r\n  Result.Rect := ARect;\r\n  Result.Col := ACol;\r\n  Result.Row := ARow;\r\n  Result.StartTime := AStartTime;\r\n  Result.EndTime := AEndTime;\r\n  Result.Position := APosition;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateGroupBottom(\r\n  ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikGroupBottom;\r\n  Result.Group := AGroup;\r\n  Result.StartPosition := AStartPosition;\r\n  Result.EndPosition := AEndPosition;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateGroupTop(\r\n  ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikGroupTop;\r\n  Result.Group := AGroup;\r\n  Result.StartPosition := AStartPosition;\r\n  Result.EndPosition := AEndPosition;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateItem(ARect: TRectF; APosition: Integer; AItem: TTMSFNCPlannerItem; AIndex: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikItem;\r\n  Result.Rect := ARect;\r\n  Result.Position := APosition;\r\n  Result.Idx := AIndex;\r\n  Result.Item := AItem;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreatePositionTop(ARect: TRectF; APosition: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikPositionTop;\r\n  Result.Position := APosition;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreatePositionBottom(ARect: TRectF; APosition: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikPositionBottom;\r\n  Result.Position := APosition;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateTimeLineLeft(ARect: TRectF; AValue: Double; ARow: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikTimeLineLeft;\r\n  Result.Value := AValue;\r\n  Result.Row := ARow;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\nclass function TTMSFNCPlannerCacheItem.CreateTimeLineRight(ARect: TRectF; AValue: Double; ARow: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem.Create;\r\n  Result.Kind := ikTimeLineRight;\r\n  Result.Value := AValue;\r\n  Result.Row := ARow;\r\n  Result.Rect := ARect;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerCacheItem.Destroy;\r\nbegin\r\n  if Assigned(FItem) then\r\n    FItem.FCacheList.Remove(Self);\r\n\r\n  FItem := nil;\r\n\r\n  if Assigned(FBitmap) then\r\n    FBitmap.Free;\r\n  inherited;\r\nend;\r\n\r\n{$IFDEF LCLLIB}\r\nclass operator TTMSFNCPlannerResourceDate.=(z1, z2: TTMSFNCPlannerResourceDate)b: boolean;\r\nbegin\r\n  Result := z1.DateTime = z2.DateTime;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nfunction TTMSFNCPlannerCacheItemList.GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerCacheItemList.SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerIntegerList.GetItem(Index: Integer): Integer;\r\nbegin\r\n  Result := Integer(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerIntegerList.SetItem(Index: Integer; const Value: Integer);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerResourceItems.GetItem(Index: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := TTMSFNCPlannerItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerResourceItems.SetItem(Index: Integer; const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCImage;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCCustomControl, WEBLib.TMSFNCBitmapContainer,\r\n  WEBLib.TMSFNCTypes, WEBLib.TMSFNCGraphics, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  , UITypes, Types\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 0; // Release nr.\r\n  BLD_VER = 0; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : First Release\r\n\r\ntype\r\n  TBool2DArray = array of array of boolean;\r\n\r\n  {$IFDEF FNCLIB}\r\n  TTMSFNCCustomImage = class(TTMSFNCCustomControl, ITMSFNCBitmapContainer)\r\n  {$ENDIF}\r\n  {$IFNDEF FNCLIB}\r\n  TTMSFNCCustomImage = class(TTMSFNCCustomControl)\r\n  {$ENDIF}\r\n  private\r\n    FBitmap: TTMSFNCBitmap;\r\n    FBitmapContainer: TTMSFNCBitmapContainer;\r\n    FStretch: Boolean;\r\n    FBitmaps: TTMSFNCScaledBitmaps;\r\n    FCropping: Boolean;\r\n    FCenter: Boolean;\r\n    FAutoSize: Boolean;\r\n    FAspectRatio: Boolean;\r\n    FOnBitmapChanged: TNotifyEvent;\r\n    procedure SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\n    procedure SetStretch(const Value: Boolean);\r\n    procedure SetBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetCropping(const Value: Boolean);\r\n    procedure SetCenter(const Value: Boolean);\r\n    procedure SetAS(const Value: Boolean);\r\n    procedure SetAspectRatio(const Value: Boolean);\r\n    procedure SetBitmap(const Value: TTMSFNCBitmap);\r\n    function GetBitmapContainer: TTMSFNCBitmapContainer;\r\n  protected\r\n    function GetVersion: string; override;\r\n    procedure ApplyAutoSize;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure BitmapChanged(Sender: TObject);\r\n    property AspectRatio: Boolean read FAspectRatio write SetAspectRatio default True;\r\n    property Version: String read GetVersion;\r\n    property Bitmaps: TTMSFNCScaledBitmaps read FBitmaps write SetBitmaps;\r\n    property BitmapContainer: TTMSFNCBitmapContainer read GetBitmapContainer write SetBitmapContainer;\r\n    property Stretch: Boolean read FStretch write SetStretch default False;\r\n    property Cropping: Boolean read FCropping write SetCropping default False;\r\n    property Center: Boolean read FCenter write SetCenter default True;\r\n    property AutoSize: Boolean read FAutoSize write SetAS default False;\r\n    property Bitmap: TTMSFNCBitmap read FBitmap write SetBitmap;\r\n  public\r\n    procedure Clear;\r\n    function GetPaintRectangle: TRectF;\r\n    function GetBitmap: TTMSFNCBitmap;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    property OnBitmapChanged: TNotifyEvent read FOnBitmapChanged write FOnBitmapChanged;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCImage = class(TTMSFNCCustomImage)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  published\r\n    property AspectRatio;\r\n    property Bitmap;\r\n    property Version;\r\n    property Bitmaps;\r\n    property BitmapContainer;\r\n    property Stretch;\r\n    property Cropping;\r\n    property Center;\r\n    property AutoSize;\r\n    property Fill;\r\n    property Stroke;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Controls, WEBLib.Graphics, WEBLib.TMSFNCUtils;\r\n\r\nprocedure TTMSFNCCustomImage.ApplyAutoSize;\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  bmp := GetBitmap;\r\n  if Assigned(bmp) then\r\n  begin\r\n    if FAutoSize and not IsBitmapEmpty(bmp) then\r\n    begin\r\n      Self.Width := bmp.Width;\r\n      Self.Height := bmp.Height;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.BitmapChanged(Sender: TObject);\r\nbegin\r\n  if Assigned(OnBitmapChanged) then\r\n    OnBitmapChanged(Self);\r\n\r\n  ApplyAutoSize;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.Clear;\r\nbegin\r\n  Bitmaps.Clear;\r\nend;\r\n\r\nconstructor TTMSFNCCustomImage.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  if IsDesignTime then\r\n    DisableBackground;\r\n\r\n  FCenter := True;\r\n  FStretch := False;\r\n  FAspectRatio := True;\r\n  FCropping := False;\r\n  FBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FBitmaps.OnChange := @BitmapChanged;\r\n  FBitmap := TTMSFNCBitmap.Create;\r\n  FBitmap.OnChange := @BitmapChanged;\r\n  Width := 100;\r\n  Height := 100;\r\nend;\r\n\r\ndestructor TTMSFNCCustomImage.Destroy;\r\nbegin\r\n  FBitmap.Free;\r\n  FBitmaps.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCCustomImage.GetBitmap: TTMSFNCBitmap;\r\nbegin\r\n  if not IsBitmapEmpty(FBitmap) then\r\n    Result := FBitmap\r\n  else\r\n    Result := TTMSFNCGraphics.GetScaledBitmap(Bitmaps, 0, FBitmapContainer);\r\nend;\r\n\r\nfunction TTMSFNCCustomImage.GetBitmapContainer: TTMSFNCBitmapContainer;\r\nbegin\r\n  Result := FBitmapContainer;\r\nend;\r\n\r\nfunction TTMSFNCCustomImage.GetPaintRectangle: TRectF;\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\n  rdest: TRectF;\r\n  w, h: Single;\r\n  x, y: Single;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  bmp := GetBitmap;\r\n  if Assigned(bmp) then\r\n  begin\r\n    x := 0;\r\n    y := 0;\r\n    w := 0;\r\n    h := 0;\r\n    TTMSFNCGraphics.GetAspectSize(w, h, bmp.Width, bmp.Height, Width, Height, AspectRatio, Stretch, Cropping);\r\n    if Center or Cropping then\r\n    begin\r\n      x := (width - w) / 2;\r\n      y := (height - h) / 2;\r\n    end;\r\n\r\n    rdest := RectF(x, y, x + w, y + h);\r\n    Result := rdest;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomImage.GetVersion: string;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FBitmapContainer) then\r\n    FBitmapContainer := nil;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\n   rdest: TRectF;\r\n  w, h: Single;\r\n  x, y: Single;\r\nbegin\r\n  inherited;\r\n  if csDesigning in ComponentState then\r\n  begin\r\n    AGraphics.Stroke.Kind := gskDot;\r\n    AGraphics.DrawRectangle(ARect);\r\n  end;\r\n\r\n  bmp := GetBitmap;\r\n  if Assigned(bmp) then\r\n  begin\r\n    x := 0;\r\n    y := 0;\r\n    w := 0;\r\n    h := 0;\r\n    TTMSFNCGraphics.GetAspectSize(w, h, bmp.Width, bmp.Height, Width, Height, AspectRatio, Stretch, Cropping);\r\n    if Center or Cropping then\r\n    begin\r\n      x := (width - w) / 2;\r\n      y := (height - h) / 2;\r\n    end;\r\n\r\n    x := Round(x);\r\n    y := Round(y);\r\n\r\n    rdest := RectF(x, y, x + w, y + h);\r\n    AGraphics.DrawBitmap(rdest, BitmapToDrawBitmap(bmp));\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetAspectRatio(const Value: Boolean);\r\nbegin\r\n  FAspectRatio := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetAS(const Value: Boolean);\r\nbegin\r\n  FAutoSize := Value;\r\n  ApplyAutoSize;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetBitmaps(const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FBitmaps.Assign(Value);\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetBitmap(const Value: TTMSFNCBitmap);\r\nbegin\r\n  FBitmap.Assign(Value);\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetBitmapContainer(\r\n  const Value: TTMSFNCBitmapContainer);\r\nbegin\r\n  FBitmapContainer := Value;\r\n  ApplyAutoSize;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetCenter(const Value: Boolean);\r\nbegin\r\n  FCenter := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetCropping(const Value: Boolean);\r\nbegin\r\n  FCropping := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomImage.SetStretch(const Value: Boolean);\r\nbegin\r\n  FStretch := Value;\r\n  Invalidate;\r\nend;\r\n\r\n{ TTMSFNCImage }\r\n\r\nprocedure TTMSFNCImage.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCImage);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016 - 2017                                 }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCPopup;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  {$IFDEF MSWINDOWS}\r\n  Windows,\r\n  {$ENDIF}\r\n  Classes, WEBLib.Controls, WEBLib.TMSFNCCustomComponent, WEBLib.TMSFNCGraphics, WEBLib.Graphics,\r\n  WEBLib.TMSFNCTypes, WEBLib.TMSFNCGraphicsTypes, WEBLib.Forms, WEBLib.ExtCtrls\r\n  {$IFNDEF LCLLIB}\r\n  ,Types\r\n  {$HINTS OFF}\r\n  {$IF COMPILERVERSION > 22}\r\n  ,UITypes\r\n  {$IFEND}\r\n  {$HINTS ON}\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,Messages\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  {$IFNDEF MSWINDOWS}\r\n  ,LMessages\r\n  {$ENDIF}\r\n  ,LCLType, LCLIntf\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 0; // Release nr.\r\n  BLD_VER = 3; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : first release\r\n  // v1.0.0.1 : Fixed: Issue with popup on Android\r\n  // v1.0.0.2 : Fixed: Issue with multi-monitor screen detection\r\n  // v1.0.0.3 : Fixed: Issue with multi-moniutor screen detection on LCL and VCL\r\n\r\ntype\r\n  TTMSFNCPopupPlacement = (ppBottom, ppTop, ppLeft, ppRight, ppCenter, ppBottomCenter, ppTopCenter, ppLeftCenter, ppRightCenter, ppAbsolute,\r\n    ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter);\r\n\r\n  TTMSFNCPopupPaint = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF) of object;\r\n\r\n  TTMSFNCCustomPopupFormClass = class of TTMSFNCCustomPopupForm;\r\n\r\n  TTMSFNCCustomPopup = class;\r\n\r\n  TTMSFNCCustomPopupForm = class(TCustomForm)\r\n  private\r\n    FPreferedDisplayIndex: Integer;\r\n    FHintWindow: Boolean;\r\n    FTimer: TTimer;\r\n    FFirstShow: Boolean;\r\n    FOwner: TComponent;\r\n    FShowModal: Boolean;\r\n    FPlacement: TTMSFNCPopupPlacement;\r\n    FRealPlacement: TTMSFNCPopupPlacement;\r\n    FPlacementControl: TControl;\r\n    FOffset: TPointF;\r\n    FSize: TSizeF;\r\n    FPlacementRectangle: TTMSFNCMargins;\r\n    FScreenPlacementRect: TRectF;\r\n    FPlacementChanged: Boolean;\r\n    FDragWithParent: Boolean;\r\n    FOnBeforeClose: TNotifyEvent;\r\n    FOnBeforeShow: TNotifyEvent;\r\n    FScreenContentRect: TRectF;\r\n    FContentPadding: TTMSFNCMargins;\r\n    FContentControl: TControl;\r\n    FOnRealPlacementChanged: TNotifyEvent;\r\n    FOnPopupPaint: TTMSFNCPopupPaint;\r\n    procedure SetOffset(const Value: TPointF);\r\n    procedure SetSize(const Value: TSizeF);\r\n    procedure TimerProc(Sender: TObject);\r\n    procedure SetPlacementRectangle(const Value: TTMSFNCMargins);\r\n    procedure SetPlacement(const Value: TTMSFNCPopupPlacement);\r\n    procedure SetPlacementControl(const Value: TControl);\r\n    procedure SetDragWithParent(const Value: Boolean);\r\n    procedure SetContentPadding(const Value: TTMSFNCMargins);\r\n    procedure SetContentControl(const Value: TControl);\r\n    function GetPopup: TTMSFNCCustomPopup;\r\n  protected\r\n    procedure DoBeforeShow; virtual;\r\n    procedure DoBeforeClose; virtual;\r\n    procedure UpdateBounds(LRect: TRectF); virtual;\r\n    procedure DoClose(var CloseAction: TCloseAction); override;\r\n    procedure DoApplyPlacement; virtual;\r\n    procedure Loaded; override;\r\n    procedure Updated; override;\r\n    procedure HandleFocusedControl;\r\n    function GetPopupParent: TControl;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure DoRealPlacementChanged; virtual;\r\n    property DragWithParent: Boolean read FDragWithParent write SetDragWithParent;\r\n    property Popup: TTMSFNCCustomPopup read GetPopup;\r\n  public\r\n    {$IFDEF CMNWEBLIB}\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer  = 0); override;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    constructor CreateNew(AOwner: TComponent; Dummy: NativeInt = 0); override;\r\n    {$ENDIF}\r\n    constructor Create(AOwner: TComponent; APlacementControl: TControl = nil); reintroduce;\r\n    destructor Destroy; override;\r\n    procedure ApplyPlacement; virtual;\r\n    procedure KeyDown(var Key: Word; {$IFDEF FMXLIB}var KeyChar: WideChar;{$ENDIF} Shift: TShiftState); override;\r\n    function CloseQuery: Boolean; override;\r\n    property HintWindow: Boolean read FHintWindow write FHintWindow;\r\n    property ContentControl: TControl read FContentControl write SetContentControl;\r\n    property ContentPadding: TTMSFNCMargins read FContentPadding write SetContentPadding;\r\n    property Offset: TPointF read FOffset write SetOffset;\r\n    property Placement: TTMSFNCPopupPlacement read FPlacement write SetPlacement;\r\n    property PlacementRectangle: TTMSFNCMargins read FPlacementRectangle write SetPlacementRectangle;\r\n    property PlacementControl: TControl read FPlacementControl write SetPlacementControl;\r\n    property RealPlacement: TTMSFNCPopupPlacement read FRealPlacement;\r\n    property ScreenContentRect: TRectF read FScreenContentRect;\r\n    property ScreenPlacementRect: TRectF read FScreenPlacementRect;\r\n    property Size: TSizeF read FSize write SetSize;\r\n    property OnBeforeShow: TNotifyEvent read FOnBeforeShow write FOnBeforeShow;\r\n    property OnBeforeClose: TNotifyEvent read FOnBeforeClose write FOnBeforeClose;\r\n    property OnRealPlacementChanged: TNotifyEvent read FOnRealPlacementChanged write FOnRealPlacementChanged;\r\n    property OnPopupPaint: TTMSFNCPopupPaint read FOnPopupPaint write FOnPopupPaint;\r\n  end;\r\n\r\n  TTMSFNCCustomPopup = class(TTMSFNCCustomComponent)\r\n  private\r\n    {$IFDEF FMXLIB}\r\n    FPopup: TPopup;\r\n    {$ENDIF}\r\n    FOwner: TComponent;\r\n    FCustomOwner: TComponent;\r\n    FPlacementControl: TControl;\r\n    FPopupForm: TTMSFNCCustomPopupForm;\r\n    FStaysOpen: Boolean;\r\n    FPlacement: TTMSFNCPopupPlacement;\r\n    FPlacementRectangle: TTMSFNCMargins;\r\n    FHorizontalOffset: Single;\r\n    FVerticalOffset: Single;\r\n    FDragWithParent: Boolean;\r\n    FModalResult: TModalResult;\r\n    FModal: Boolean;\r\n    FOnClosePopup: TNotifyEvent;\r\n    FOnPopup: TNotifyEvent;\r\n    FPopupFormSize: TSizeF;\r\n    FContentControl: TControl;\r\n    FDropDownHeight: Single;\r\n    FDropDownWidth: Single;\r\n    FFocusable: Boolean;\r\n    FFocusedControl: TControl;\r\n    FOnPopupPaint: TTMSFNCPopupPaint;\r\n    FOnPopupShown: TNotifyEvent;\r\n    FIsOpen: Boolean;\r\n    procedure SetIsOpen(const Value: Boolean);\r\n    procedure SetPlacementRectangle(const Value: TTMSFNCMargins);\r\n    procedure SetModalResult(const Value: TModalResult);\r\n    procedure SetPlacementControl(const Value: TControl);\r\n    procedure SetPlacement(const Value: TTMSFNCPopupPlacement);\r\n    procedure SetDragWithParent(const Value: Boolean);\r\n    procedure BeforeShowProc(Sender: TObject);\r\n    procedure BeforeCloseProc(Sender: TObject);\r\n    procedure CloseProc(Sender: TObject; var {%H-}CloseAction: TCloseAction);\r\n    procedure ShowProc(Sender: TObject);\r\n    procedure DeactivateProc(Sender: TObject);\r\n    procedure SetPopupFormSize(const Value: TSizeF);\r\n    procedure UpdatePopupSize;\r\n    procedure SetContentControl(const Value: TControl);\r\n    procedure SetDropDownHeight(const Value: Single);\r\n    procedure SetDropDownWidth(const Value: Single);\r\n  protected\r\n    function GetInstance: NativeUInt; override;\r\n    function GetVersion: String; override;\r\n    {$IFDEF FNCLIB}\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    {$ENDIF}\r\n    procedure ShowPopup(AModal: Boolean); virtual;\r\n    procedure HandleFocusedControl;\r\n    {$IFDEF FMXLIB}\r\n    procedure FormPaint(Sender: TObject; Canvas: TCanvas; const ARect: TRectF);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure FormPaint(Sender: TObject);\r\n    {$ENDIF}\r\n    procedure DoPopupPaint(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF); virtual;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure MarginsChanged(Sender: TObject);\r\n    procedure DoClosePopup; virtual;\r\n    procedure DoPopup; virtual;\r\n    procedure DoPopupShown; virtual;\r\n    procedure ClosePopup; virtual;\r\n    procedure DoCreatePopup(const AShowModal: Boolean = False); virtual;\r\n    function GetPopupFormClass: TTMSFNCCustomPopupFormClass; virtual;\r\n    function GetParent: TControl;\r\n    function CreatePopupForm: TTMSFNCCustomPopupForm; virtual;\r\n    property IsOpen: Boolean read FIsOpen write SetIsOpen;\r\n    property ModalResult: TModalResult read FModalResult write SetModalResult;\r\n    property PopupFormSize: TSizeF read FPopupFormSize write SetPopupFormSize;\r\n    property DragWithParent: Boolean read FDragWithParent write SetDragWithParent default False;\r\n    property PopupForm: TTMSFNCCustomPopupForm read FPopupForm;\r\n    property StaysOpen: Boolean read FStaysOpen write FStaysOpen default False;\r\n    property DropDownHeight: Single read FDropDownHeight write SetDropDownHeight;\r\n    property DropDownWidth: Single read FDropDownWidth write SetDropDownWidth;\r\n    property HorizontalOffset: Single read FHorizontalOffset write FHorizontalOffset;\r\n    property Placement: TTMSFNCPopupPlacement read FPlacement write SetPlacement default ppBottom;\r\n    property PlacementRectangle: TTMSFNCMargins read FPlacementRectangle write SetPlacementRectangle;\r\n    property PlacementControl: TControl read FPlacementControl write SetPlacementControl;\r\n    property VerticalOffset: Single read FVerticalOffset write FVerticalOffset;\r\n    property FocusedControl: TControl read FFocusedControl write FFocusedControl;\r\n    property ContentControl: TControl read FContentControl write SetContentControl;\r\n    property OnClosePopup: TNotifyEvent read FOnClosePopup write FOnClosePopup;\r\n    property OnPopupPaint: TTMSFNCPopupPaint read FOnPopupPaint write FOnPopupPaint;\r\n    property OnPopup: TNotifyEvent read FOnPopup write FOnPopup;\r\n    property CustomOwner: TComponent read FCustomOwner write FCustomOwner;\r\n    property OnPopupShown: TNotifyEvent read FOnPopupShown write FOnPopupShown;\r\n    property Version: String read GetVersion;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    destructor Destroy; override;\r\n    function HasPopupForm: Boolean;\r\n    function PointInPopup(APoint: TPointF): Boolean; virtual;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCPopup = class(TTMSFNCCustomPopup)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  public\r\n    function PopupModal: TModalResult; virtual;\r\n    procedure Popup(const AShowModal: Boolean = False); virtual;\r\n    property AdaptToStyle;\r\n    property ModalResult;\r\n    property IsOpen;\r\n    property PopupFormSize;\r\n    property DragWithParent;\r\n    property PopupForm;\r\n  published\r\n    property StaysOpen;\r\n    property DropDownHeight;\r\n    property DropDownWidth;\r\n    property HorizontalOffset;\r\n    property Placement;\r\n    property PlacementRectangle;\r\n    property PlacementControl;\r\n    property VerticalOffset;\r\n    property FocusedControl;\r\n    property ContentControl;\r\n    property OnClosePopup;\r\n    property OnPopupPaint;\r\n    property OnPopup;\r\n    property OnPopupShown;\r\n    property Version;\r\n  end;\r\n\r\n{$IFDEF CMNLIB}\r\n{$IFDEF MSWINDOWS}\r\ntype\r\n  LInteger = LONG_PTR;\r\n  IntPtr = Pointer;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\ntype\r\n  TTMSFNCCustomNonFocusablePopupForm = class(TTMSFNCCustomPopupForm)\r\n  private\r\n    {$IFDEF CMNLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    procedure WMActivate(var Message: TWMActivate); message WM_ACTIVATE;\r\n    procedure WMNCHitTest(var Message: TWMNCHitTest); message WM_NCHITTEST;\r\n    {$ELSE}\r\n    procedure WMActivate(var Message: TLMActivate); message LM_ACTIVATE;\r\n    procedure WMNCHitTest(var Message: TLMessage); message LM_NCHITTEST;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  protected\r\n    procedure UpdateBounds(LRect: TRectF); override;\r\n    {$IFDEF CMNLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    procedure CreateParams(var Params: TCreateParams); override;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  public\r\n    {$IFDEF CMNLIB}\r\n    {$IFDEF MSWINDOWS}\r\n    constructor CreateNew(AOwner: TComponent; Dummy: Integer  = 0); override;\r\n    destructor Destroy; override;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  end;\r\n\r\n  TTMSFNCCustomNonFocusablePopup = class(TTMSFNCCustomPopup)\r\n  private\r\n    {$IFDEF CMNLIB}\r\n    FActiveWindow: HWND;\r\n    {$ENDIF}\r\n  protected\r\n    procedure ActivatePreviousWindow; virtual;\r\n    procedure ShowPopup({%H-}AModal: Boolean); override;\r\n    function GetPopupFormClass: TTMSFNCCustomPopupFormClass; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TTMSFNCNonFocusablePopup = class(TTMSFNCCustomNonFocusablePopup)\r\n  public\r\n    procedure Deactivate; virtual;\r\n    procedure Activate; virtual;\r\n  published\r\n    property ContentControl;\r\n    property Placement;\r\n    property PlacementRectangle;\r\n    property PlacementControl;\r\n  end;\r\n\r\nimplementation\r\n\r\n{$R TMSFNCPopup.res}\r\n\r\nuses\r\n  SysUtils, WEBLib.TMSFNCUtils, Math\r\n  {$IFDEF FNCLIB}\r\n  , WEBLib.TMSFNCStyles\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  , Web\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  , FMX.Platform\r\n  {$ENDIF}\r\n  ;\r\n\r\n{$IFDEF CMNLIB}\r\n{$IFDEF MSWINDOWS}\r\ntype\r\n  WndProcRec = record\r\n    FWindowHandle: HWND;\r\n    FProc: LInteger;\r\n  end;\r\n\r\nvar\r\n  PrevWndProcs: array of WndProcRec;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\n{ TTMSFNCPopup }\r\n\r\nconstructor TTMSFNCCustomPopup.Create(AOwner: TComponent);\r\nbegin\r\n  inherited Create(AOwner);\r\n  FOwner := AOwner;\r\n  FPlacement := ppBottom;\r\n  FFocusable := True;\r\n  FStaysOpen := False;\r\n  FPlacementRectangle := TTMSFNCMargins.Create;\r\n  FPlacementRectangle.OnChange := @MarginsChanged;\r\nend;\r\n\r\ndestructor TTMSFNCCustomPopup.Destroy;\r\nbegin\r\n  FContentControl := nil;\r\n  ClosePopup;\r\n  if HasPopupForm then\r\n  begin\r\n    FreeAndNil(FPopupForm);\r\n  end;\r\n  FreeAndNil(FPlacementRectangle);\r\n  {$IFDEF FMXLIB}\r\n  FreeAndNil(FPopup);\r\n  {$ENDIF}\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DeactivateProc(Sender: TObject);\r\nbegin\r\n  if Assigned(FPopupForm) and not FPopupForm.FShowModal and not StaysOpen then\r\n  begin\r\n    FPopupForm.Visible := False;\r\n    FPopupForm.Close;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.HandleFocusedControl;\r\nvar\r\n  frm: TCustomForm;\r\nbegin\r\n  if Assigned(FPopupForm) and Assigned(FocusedControl) then\r\n  begin\r\n    if not FPopupForm.FShowModal then\r\n    begin\r\n      frm := TTMSFNCUtils.GetParentForm(FocusedControl);\r\n      if Assigned(frm) and (frm <> FPopupForm) then\r\n      begin\r\n        {$IFDEF FMXLIB}\r\n        frm.Activate;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        frm.SetFocus;\r\n        {$ENDIF}\r\n      end;\r\n    end;\r\n\r\n    {$IFDEF FMXLIB}\r\n    if FocusedControl.CanFocus then\r\n      FocusedControl.SetFocus;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    if FocusedControl is TWinControl then\r\n    begin\r\n      if (FocusedControl as TWinControl).CanFocus then\r\n        (FocusedControl as TWinControl).SetFocus;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    if FocusedControl is TControl then\r\n    begin\r\n      if (FocusedControl as TControl).CanFocus then\r\n        (FocusedControl as TControl).SetFocus;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.HasPopupForm: Boolean;\r\nbegin\r\n  Result := FPopupForm <> nil;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.MarginsChanged(Sender: TObject);\r\nbegin\r\n  if (FPopupForm <> nil) then\r\n    FPopupForm.PlacementRectangle := PlacementRectangle;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.CreatePopupForm: TTMSFNCCustomPopupForm;\r\nvar\r\n  NewForm: TTMSFNCCustomPopupForm;\r\n  cls: TTMSFNCCustomPopupFormClass;\r\nbegin\r\n  NewForm := nil;\r\n  try\r\n    cls := GetPopupFormClass;\r\n    {$IFDEF FMXLIB}\r\n    FPopup := TPopup.Create(Self);\r\n    NewForm := cls.Create(FPopup, PlacementControl);\r\n    {$ELSE}\r\n    NewForm := cls.Create(Self, PlacementControl);\r\n    {$ENDIF}\r\n  except\r\n    FreeAndNil(NewForm);\r\n    Raise;\r\n  end;\r\n  Result := NewForm;\r\nend;\r\n\r\nprocedure TTMSFNCPopup.Popup(const AShowModal: Boolean = False);\r\nbegin\r\n  DoCreatePopup(AShowModal);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetModalResult(const Value: TModalResult);\r\nbegin\r\n  FModalResult := Value;\r\n  if Assigned(FPopupForm) then\r\n    FPopupForm.ModalResult := FModalResult;\r\nend;\r\n\r\nfunction TTMSFNCPopup.PopupModal: TModalResult;\r\nvar\r\n  LStaysOpen : Boolean;\r\nbegin\r\n  Result := 0;\r\n  if FIsOpen then\r\n    Exit;\r\n\r\n  if HasPopupForm then\r\n    FPopupForm.Close;\r\n\r\n  LStaysOpen := FStaysOpen;\r\n  try\r\n    FStaysOpen := True;\r\n    Popup(True);\r\n    Result := FModalResult;\r\n    IsOpen := False;\r\n  finally\r\n    FStaysOpen := LStaysOpen;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPopup.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCPopup);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.ClosePopup;\r\nvar\r\n  p: TControl;\r\nbegin\r\n  if not HasPopupForm then\r\n    Exit;\r\n  if FModal and (FModalResult = 0) then\r\n  begin\r\n    ModalResult := mrCancel;\r\n    Exit;\r\n  end;\r\n\r\n  FIsOpen := False;\r\n  if Assigned(FContentControl) then\r\n  begin\r\n    p := GetParent;\r\n    FContentControl.Visible := False;\r\n    {$IFDEF FMXLIB}\r\n    FContentControl.Parent := p;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    if Assigned(p) and (p is TWinControl) then\r\n      FContentControl.Parent := p as TWinControl;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  if not (csDestroying in ComponentState) then\r\n  begin\r\n    if HasPopupForm then\r\n    begin\r\n      if Self is TTMSFNCNonFocusablePopup then\r\n        FPopupForm.Free;\r\n      DoClosePopup;\r\n      FPopupForm := nil;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DoClosePopup;\r\nbegin\r\n  if Assigned(FOnClosePopup) then\r\n    FOnClosePopup(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DoCreatePopup(const AShowModal: Boolean = False);\r\n{$IFDEF FNCLIB}\r\nvar\r\n  ia: ITMSFNCAdaptToStyle;\r\n{$ENDIF}\r\nbegin\r\n  if FIsOpen then\r\n    Exit;\r\n\r\n  if HasPopupForm then\r\n    FPopupForm.Close;\r\n\r\n  FPopupForm := CreatePopupForm;\r\n  try\r\n    try\r\n      {$IFDEF FMXLIB}\r\n      {$IFDEF FMXMOBILE}\r\n      if AShowModal then\r\n        FPopupForm.FormStyle := TFormStyle.Normal;\r\n      {$ENDIF}\r\n      {$IFNDEF FMXMOBILE}\r\n      FPopupForm.FormStyle := TFormStyle.StayOnTop;\r\n      {$ENDIF}\r\n      if Assigned(CustomOwner) and (CustomOwner is TFmxObject) then\r\n        FPopupForm.Parent := (CustomOwner as TFmxObject)\r\n      else if Assigned(Owner) and (Owner is TFmxObject) then\r\n        FPopupForm.Parent := TFmxObject(Owner);\r\n      {$ENDIF}\r\n\r\n      {$IFDEF CMNWEBLIB}\r\n      FPopupForm.FormStyle := fsStayOnTop;\r\n      {$ENDIF}\r\n\r\n      FPopupForm.OnPaint := FormPaint;\r\n      FPopupForm.OnPopupPaint := DoPopupPaint;\r\n\r\n      TComponent(FPopupForm).FreeNotification(Self);\r\n      FPopupForm.Placement := Placement;\r\n      FPopupForm.Offset := PointF(Self.HorizontalOffset, Self.VerticalOffset);\r\n      FPopupForm.PlacementRectangle := Self.PlacementRectangle;\r\n      FPopupForm.DragWithParent := DragWithParent;\r\n      UpdatePopupSize;\r\n      FPopupForm.OnDeactivate := DeactivateProc;\r\n      FPopupForm.OnBeforeShow := BeforeShowProc;\r\n      FPopupForm.OnBeforeClose := BeforeCloseProc;\r\n      FPopupForm.OnClose := CloseProc;\r\n      FPopupForm.OnShow := ShowProc;\r\n      FPopupForm.FShowModal := AShowModal;\r\n\r\n      FPopupForm.ContentControl := FContentControl;\r\n      {$IFDEF FNCLIB}\r\n      if Supports(FContentControl, ITMSFNCAdaptToStyle, ia) then\r\n        ia.AdaptToStyle := AdaptToStyle;\r\n      {$ENDIF}\r\n      {$IFDEF FMXLIB}\r\n      if Assigned(FContentControl) then\r\n        FContentControl.Align := TAlignLayout.Client;\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      if Assigned(FContentControl) then\r\n        FContentControl.Align := alClient;\r\n      {$ENDIF}\r\n    finally\r\n    end;\r\n  except\r\n    FreeAndNil(FPopupForm);\r\n    Raise;\r\n  end;\r\n\r\n  if (not (csDestroying in ComponentState)) then\r\n    FPopupForm.DoBeforeShow;\r\n\r\n  ShowPopup(AShowModal);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.Notification(AComponent: TComponent; Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if Operation = opRemove then\r\n  begin\r\n    if AComponent = FContentControl then\r\n      FContentControl := nil;\r\n\r\n    if AComponent = FFocusedControl then\r\n      FFocusedControl := nil;\r\n\r\n    if (AComponent = FPopupForm) then\r\n      FPopupForm := nil;\r\n    if (AComponent = FPlacementControl) then\r\n    begin\r\n      FPlacementControl := nil;\r\n      if HasPopupForm then\r\n        FPopupForm.PlacementControl := nil;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.PointInPopup(APoint: TPointF): Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(FPopupForm) then\r\n    Result := PtInRectEx(RectF(FPopupForm.Left, FPopupForm.Top, FPopupForm.Left + FPopupForm.Width, FPopupForm.Top + FPopupForm.Height), APoint);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetIsOpen(const Value: Boolean);\r\nbegin\r\n  if FIsOpen <> Value then\r\n  begin\r\n    if csDesigning in ComponentState then\r\n    begin\r\n      FIsOpen := False;\r\n      Exit;\r\n    end;\r\n    if Value then\r\n      DoCreatePopup\r\n    else\r\n    begin\r\n      if HasPopupForm then\r\n        FPopupForm.Close\r\n      else\r\n        FIsOpen := Value;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.BeforeShowProc(Sender: TObject);\r\nbegin\r\n  FIsOpen := True;\r\n  DoPopup;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.UpdatePopupSize;\r\nvar\r\n  LSize: TSizeF;\r\nbegin\r\n  if FPopupForm <> nil then\r\n  begin\r\n    if (FPopupFormSize.cx > 0) then\r\n      LSize.cx := FPopupFormSize.cx\r\n    else\r\n      LSize.cx := DropDownWidth;\r\n    if (FPopupFormSize.cy > 0) then\r\n      LSize.cy := FPopupFormSize.cy\r\n    else\r\n      LSize.cy := DropDownHeight;\r\n\r\n    FPopupForm.Size := LSize;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomPopup then\r\n  begin\r\n    FModalResult := (Source as TTMSFNCCustomPopup).ModalResult;\r\n    FPopupFormSize := (Source as TTMSFNCCustomPopup).PopupFormSize;\r\n    FDragWithParent := (Source as TTMSFNCCustomPopup).DragWithParent;\r\n    FStaysOpen := (Source as TTMSFNCCustomPopup).StaysOpen;\r\n    FDropDownHeight := (Source as TTMSFNCCustomPopup).DropDownHeight;\r\n    FDropDownWidth := (Source as TTMSFNCCustomPopup).DropDownWidth;\r\n    FHorizontalOffset := (Source as TTMSFNCCustomPopup).HorizontalOffset;\r\n    FPlacementControl := (Source as TTMSFNCCustomPopup).PlacementControl;\r\n    FPlacement := (Source as TTMSFNCCustomPopup).Placement;\r\n    FPlacementRectangle.Assign((Source as TTMSFNCCustomPopup).PlacementRectangle);\r\n    FVerticalOffset := (Source as TTMSFNCCustomPopup).VerticalOffset;\r\n    FFocusedControl := (Source as TTMSFNCCustomPopup).FocusedControl;\r\n    FContentControl := (Source as TTMSFNCCustomPopup).ContentControl;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.BeforeCloseProc(Sender: TObject);\r\nbegin\r\n  FIsOpen := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.CloseProc(Sender: TObject; var CloseAction: TCloseAction);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if Assigned(PopupForm) and (PopupForm.FormStyle = TFormStyle.Popup) then\r\n  begin\r\n    if not StaysOpen then\r\n      ClosePopup\r\n    else\r\n      CloseAction := TCloseAction.caNone;\r\n  end\r\n  else\r\n    ClosePopup;\r\n  {$ELSE}\r\n  ClosePopup;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DoPopup;\r\nbegin\r\n  if Assigned(FOnPopup) then\r\n    FOnPopup(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DoPopupPaint(Sender: TObject; AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF);\r\nbegin\r\n  if Assigned(OnPopupPaint) then\r\n    OnPopupPaint(Self, AGraphics, ARect);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.DoPopupShown;\r\nbegin\r\n  if Assigned(FOnPopupShown) then\r\n    FOnPopupShown(Self);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomPopup.FormPaint(Sender: TObject; Canvas: TCanvas; const ARect: TRectF);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomPopup.FormPaint(Sender: TObject);\r\n{$ENDIF}\r\nvar\r\n  g: TTMSFNCGraphics;\r\n  r: TRectF;\r\nbegin\r\n  if Assigned(FPopupForm) then\r\n  begin\r\n    g := TTMSFNCGraphics.Create(FPopupForm.Canvas);\r\n    try\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Fill.Color := TTMSFNCGraphics.DefaultPopupFillColor;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultPopupStrokeColor;\r\n      r := RectF(0, 0, FPopupForm.Width, FPopupForm.Height);\r\n      g.DrawRectangle(r);\r\n\r\n      if Assigned(OnPopupPaint) then\r\n        OnPopupPaint(Self, g, r);\r\n    finally\r\n      g.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.GetInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.GetParent: TControl;\r\nbegin\r\n  Result := PlacementControl;\r\n  if not Assigned(Result) and (FOwner is TControl) then\r\n    Result := FOwner as TControl;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.GetPopupFormClass: TTMSFNCCustomPopupFormClass;\r\nbegin\r\n  Result := TTMSFNCCustomPopupForm;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopup.GetVersion: String;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetPlacement(const Value: TTMSFNCPopupPlacement);\r\nbegin\r\n  if FPlacement <> Value then\r\n  begin\r\n    FPlacement := Value;\r\n    if HasPopupForm then\r\n      PopupForm.Placement := FPlacement;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetPlacementRectangle(const Value: TTMSFNCMargins);\r\nbegin\r\n  FPlacementRectangle.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetPlacementControl(const Value: TControl);\r\nbegin\r\n  if FPlacementControl <> Value then\r\n  begin\r\n    if FPlacementControl <> nil then\r\n      FPlacementControl.RemoveFreeNotification(self);\r\n    FPlacementControl := Value;\r\n    if HasPopupForm then\r\n      FPopupForm.PlacementControl := FPlacementControl;\r\n    if FPlacementControl <> nil then\r\n      FPlacementControl.FreeNotification(self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetPopupFormSize(const Value: TSizeF);\r\nbegin\r\n  if (FPopupFormSize.cx <> Value.cx) or (FPopupFormSize.cy <> Value.cy) then\r\n  begin\r\n    FPopupFormSize := Value;\r\n    UpdatePopupSize;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.ShowPopup(AModal: Boolean);\r\nbegin\r\n  if AModal then\r\n    FModalResult := FPopupForm.ShowModal\r\n  else\r\n  begin\r\n    FPopupForm.Show;\r\n    {$IFDEF CMNLIB}\r\n    {$IFNDEF MSWINDOWS}\r\n    BorderStyle := bsNone;\r\n    BorderStyle := bsSingle;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    HandleFocusedControl;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.ShowProc(Sender: TObject);\r\nbegin\r\n  if Assigned(FPopupForm) and FPopupForm.FShowModal then\r\n    HandleFocusedControl;\r\n\r\n  DoPopupShown;\r\nend;\r\n\r\n{$IFDEF FNCLIB}\r\nprocedure TTMSFNCCustomPopup.SetAdaptToStyle(const Value: Boolean);\r\nvar\r\n  ia: ITMSFNCAdaptToStyle;\r\nbegin\r\n  inherited;\r\n  if Assigned(ContentControl) then\r\n  begin\r\n    if Supports(ContentControl, ITMSFNCAdaptToStyle, ia) then\r\n      ia.AdaptToStyle := AdaptToStyle;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomPopup.SetContentControl(const Value: TControl);\r\nbegin\r\n  if Value = nil then\r\n  begin\r\n    if Assigned(FContentControl) then\r\n      FContentControl.Visible := True;\r\n  end;\r\n\r\n  FContentControl := Value;\r\n  if Assigned(FContentControl) then\r\n  begin\r\n    FContentControl.Visible := False;\r\n    DropDownWidth := FContentControl.Width;\r\n    DropDownHeight := FContentControl.Height;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetDragWithParent(const Value: Boolean);\r\nbegin\r\n  if FDragWithParent <> Value then\r\n  begin\r\n    FDragWithParent := Value;\r\n    if HasPopupForm then\r\n      FPopupForm.DragWithParent := FDragWithParent;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetDropDownHeight(const Value: Single);\r\nbegin\r\n  if FDropDownHeight <> Value then\r\n  begin\r\n    FDropDownHeight := Value;\r\n    if Assigned(PopupForm) then\r\n      PopupForm.Height := Round(Value);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopup.SetDropDownWidth(const Value: Single);\r\nbegin\r\n  if FDropDownWidth <> Value then\r\n  begin\r\n    FDropDownWidth := Value;\r\n    if Assigned(PopupForm) then\r\n      PopupForm.Width := Round(Value);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCCustomPopupForm }\r\n\r\nconstructor TTMSFNCCustomPopupForm.Create(AOwner: TComponent; APlacementControl: TControl = nil);\r\nbegin\r\n  CreateNew(AOwner);\r\n  try\r\n    if APlacementControl <> nil then\r\n      FPlacementControl := APlacementControl;\r\n    if FPlacementControl <> nil then\r\n      TComponent(FPlacementControl).FreeNotification(Self);\r\n  finally\r\n  end;\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nconstructor TTMSFNCCustomPopupForm.CreateNew(AOwner: TComponent; Dummy: Integer);\r\n{$ENDIF}\r\n{$IFDEF FMXLIB}\r\nconstructor TTMSFNCCustomPopupForm.CreateNew(AOwner: TComponent; Dummy: NativeInt);\r\n{$ENDIF}\r\n  function FindUniqueFormName(const Name: string): string;\r\n  var\r\n    I: Integer;\r\n  begin\r\n    I := 0;\r\n    Result := Name;\r\n    while (FindGlobalComponent(Result) <> nil) or\r\n          ((AOwner <> nil) and (AOwner.FindComponent(Result) <> nil)) do\r\n    begin\r\n      Inc(I);\r\n      Result := Format('%s_%d', [Name, I]);\r\n    end;\r\n  end;\r\nbegin\r\n  Name := FindUniqueFormName('CustomPopupForm');\r\n  inherited;\r\n  FPreferedDisplayIndex := -1;\r\n  FOwner := AOwner;\r\n  FDragWithParent := True;\r\n  FPlacementRectangle := TTMSFNCMargins.Create;\r\n  FContentPadding := TTMSFNCMargins.Create;\r\n  FSize.cx := 320;\r\n  FSize.cy := 200;\r\n  FPlacement := ppBottom;\r\n  FRealPlacement := FPlacement;\r\n  Visible := False;\r\n  try\r\n    {$IFDEF FMXLIB}\r\n    BeginUpdate;\r\n    FormStyle := TFormStyle.Popup;\r\n    Position := TFormPosition.Designed;\r\n    BorderStyle := TFmxFormBorderStyle.None;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    KeyPreview := True;\r\n    Position := poDesigned;\r\n    BorderStyle := bsNone;\r\n    BorderIcons := [];\r\n    {$IFDEF VCLLIB}\r\n    Ctl3D := False;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  finally\r\n    {$IFDEF FMXLIB}\r\n    EndUpdate;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\ndestructor TTMSFNCCustomPopupForm.Destroy;\r\nbegin\r\n  FreeAndNil(FTimer);\r\n  if FPlacementControl <> nil then\r\n  begin\r\n    TComponent(FPlacementControl).RemoveFreeNotification(Self);\r\n    FPlacementControl := nil;\r\n  end;\r\n  FreeAndNil(FContentPadding);\r\n  FreeAndNil(FPlacementRectangle);\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.DoClose(var CloseAction: TCloseAction);\r\nbegin\r\n  {$IFNDEF FMXMOBILE}\r\n  CloseAction := TCloseAction.caFree;\r\n  {$ENDIF}\r\n  inherited;\r\n  if CloseAction <> TCloseAction.caNone then\r\n  begin\r\n    if Assigned(FTimer) then\r\n      FTimer.Enabled := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.DoRealPlacementChanged;\r\nbegin\r\n  if Assigned(FOnRealPlacementChanged) then\r\n    FOnRealPlacementChanged(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.KeyDown(var Key: Word; {$IFDEF FMXLIB}var KeyChar: WideChar;{$ENDIF} Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if Shift <> [] then\r\n    Exit;\r\n\r\n  case Key of\r\n    KEY_ESCAPE, KEY_F4: Close;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopupForm.GetPopup: TTMSFNCCustomPopup;\r\nbegin\r\n  Result := nil;\r\n  if FOwner is TTMSFNCCustomPopup then\r\n    Result := FOwner as TTMSFNCCustomPopup;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopupForm.GetPopupParent: TControl;\r\nbegin\r\n  Result := nil;\r\n  if Assigned(FOwner) and (FOwner is TTMSFNCCustomPopup) then\r\n    Result := (FOwner as TTMSFNCCustomPopup).GetParent;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.HandleFocusedControl;\r\nbegin\r\n  if Assigned(Popup) then\r\n    Popup.HandleFocusedControl;\r\nend;\r\n\r\nfunction TTMSFNCCustomPopupForm.CloseQuery: Boolean;\r\nbegin\r\n  Result := inherited CloseQuery;\r\n  if Result and (not (csDestroying in ComponentState)) then\r\n    DoBeforeClose;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.Notification(AComponent: TComponent; Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if Operation = opRemove then\r\n  begin\r\n    if AComponent = FPlacementControl then\r\n    begin\r\n      FPlacementControl := nil;\r\n      ApplyPlacement;\r\n    end;\r\n    if AComponent = FContentControl then\r\n      FContentControl := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetDragWithParent(const Value: Boolean);\r\nbegin\r\n  FDragWithParent := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetContentControl(const Value: TControl);\r\nbegin\r\n  if FContentControl <> Value then\r\n  begin\r\n    if FContentControl <> nil then\r\n      TComponent(FContentControl).RemoveFreeNotification(Self);\r\n    FContentControl := Value;\r\n    if FContentControl <> nil then\r\n    begin\r\n      TComponent(FContentControl).FreeNotification(Self);\r\n      try\r\n        FContentControl.Parent := Self;\r\n        {$IFDEF FMXLIB}\r\n        FContentControl.Align := TAlignLayout.None;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        FContentControl.Align := alNone;\r\n        {$ENDIF}\r\n        FContentControl.Visible := True;\r\n      finally\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetContentPadding(const Value: TTMSFNCMargins);\r\nbegin\r\n  FContentPadding.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetOffset(const Value: TPointF);\r\nbegin\r\n  if (FOffset.X <> Value.X) or (FOffset.Y <> Value.Y) then\r\n  begin\r\n    FOffset := Value;\r\n    ApplyPlacement;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetPlacement(const Value: TTMSFNCPopupPlacement);\r\nbegin\r\n  if FPlacement <> Value then\r\n  begin\r\n    FPlacement := Value;\r\n    ApplyPlacement;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetPlacementRectangle(const Value: TTMSFNCMargins);\r\nbegin\r\n  FPlacementRectangle.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetPlacementControl(const Value: TControl);\r\nbegin\r\n  if FPlacementControl <> Value then\r\n  begin\r\n    if FPlacementControl <> nil then\r\n      TComponent(FPlacementControl).RemoveFreeNotification(self);\r\n    FPlacementControl := Value;\r\n    if FPlacementControl <> nil then\r\n      TComponent(FPlacementControl).FreeNotification(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.SetSize(const Value: TSizeF);\r\nbegin\r\n  if (FSize.cx <> Value.cx) or (FSize.cy <> Value.cy) then\r\n  begin\r\n    FSize := Value;\r\n    ApplyPlacement;\r\n  end;\r\nend;\r\n\r\n\r\nprocedure TTMSFNCCustomPopupForm.Loaded;\r\nbegin\r\n  inherited;\r\n  if FPlacementChanged then\r\n    ApplyPlacement;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.UpdateBounds(LRect: TRectF);\r\nbegin\r\n  SetBounds(Round(LRect.Left), Round(LRect.Top), Round(LRect.Right - LRect.Left), Round(LRect.Bottom - LRect.Top));\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.Updated;\r\nbegin\r\n  inherited;\r\n  if FPlacementChanged then\r\n    ApplyPlacement;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.DoApplyPlacement;\r\nvar\r\n  {$IFDEF FMXLIB}\r\n  Pos: TPointF;\r\n  AbsolutePos: TPointF;\r\n  MouseSvc: IFMXMouseService;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  pt, Pos, AbsolutePos: TPoint;\r\n  {$ENDIF}\r\n  LRect: TRectF;\r\n  LPlacement: TTMSFNCPopupPlacement;\r\n  LOffset: TPointF;\r\n  LStep: Byte;\r\n  LSoGood: Boolean;\r\n  SourceSize: TSizeF;\r\n  PlacementByTarget: Boolean;\r\n  function UpdateRectByScreen(var R: TRectF; cs: TComponentState): Boolean;\r\n  var\r\n    WorkareaRect: TRect;\r\n    WorkareaRectF: TRectF;\r\n    W, H: Single;\r\n    {$IFDEF FMXLIB}\r\n    P: TPointF;\r\n    {$ENDIF}\r\n    {$IFNDEF FMXLIB}\r\n    P: TPoint;\r\n    {$ENDIF}\r\n  begin\r\n    Result := True;\r\n    R.Left := Round(R.Left);\r\n    R.Top := Round(R.Top);\r\n    R.Right := Round(R.Right);\r\n    R.Bottom := Round(R.Bottom);\r\n    {$IFDEF FMXLIB}\r\n    {$HINTS OFF}\r\n    {$IF COMPILERVERSION > 27}\r\n    case LPlacement of\r\n      ppAbsolute:\r\n        WorkareaRect := Screen.DisplayFromRect(R).WorkareaRect;\r\n      ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter:\r\n        WorkareaRect := Screen.DisplayFromPoint(Screen.MousePos).WorkareaRect\r\n    else\r\n      if not InRange(FPreferedDisplayIndex, 0, Screen.DisplayCount - 1) then\r\n      begin\r\n        if (PlacementControl <> nil) and (PlacementControl.Root is TCommonCustomForm) and\r\n          TCommonCustomForm(PlacementControl.Root).Visible then\r\n        begin\r\n          P := PointF(PlacementControl.Width / 2, PlacementControl.Height / 2);\r\n          P := PlacementControl.LocalToAbsolute(P);\r\n          FPreferedDisplayIndex := Screen.DisplayFromForm(TCommonCustomForm(PlacementControl.Root), P).Index;\r\n        end\r\n        else\r\n          FPreferedDisplayIndex := Screen.DisplayFromForm(Self).Index;\r\n      end;\r\n      WorkareaRect := Screen.Displays[FPreferedDisplayIndex].WorkareaRect;\r\n    end;\r\n    {$ELSE}\r\n    WorkareaRect := Rect(0, 0, Screen.Size.Width, Screen.Size.Height);\r\n    {$IFEND}\r\n    {$HINTS ON}\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    WorkareaRect.Left := 0;\r\n    WorkareaRect.Top := 0;\r\n    WorkareaRect.Right := window.innerWidth;\r\n    WorkareaRect.Bottom := window.innerHeight;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    case LPlacement of\r\n      ppAbsolute:\r\n        WorkareaRect := Screen.MonitorFromRect(ConvertToRect(R)).WorkareaRect;\r\n      ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter:\r\n        WorkareaRect := Screen.MonitorFromPoint(ConvertToPoint(TTMSFNCUtils.GetMousePos)).WorkareaRect\r\n    else\r\n      if not InRange(FPreferedDisplayIndex, 0, Screen.MonitorCount - 1) then\r\n      begin\r\n        if (PlacementControl <> nil) and (TTMSFNCUtils.GetParentForm(PlacementControl) is TCustomForm) and\r\n          TCustomForm(TTMSFNCUtils.GetParentForm(PlacementControl)).Visible then\r\n        begin\r\n          P := Point(PlacementControl.Width div 2, PlacementControl.Height div 2);\r\n          P := PlacementControl.ClientToScreen(P);\r\n          FPreferedDisplayIndex := Screen.MonitorFromWindow(TTMSFNCUtils.GetParentForm(PlacementControl).Handle).MonitorNum;\r\n        end\r\n        else\r\n          FPreferedDisplayIndex := Screen.MonitorFromWindow(Self.Handle).MonitorNum;\r\n      end;\r\n      WorkareaRect := Screen.Monitors[FPreferedDisplayIndex].WorkareaRect;\r\n    end;\r\n    {$ENDIF}\r\n    WorkareaRectF := RectF(WorkareaRect.Left - ContentPadding.Left, WorkareaRect.Top - ContentPadding.Top,\r\n      WorkareaRect.Right + ContentPadding.Right, WorkareaRect.Bottom + ContentPadding.Bottom);\r\n    if not (csDesigning in cs) then\r\n    begin\r\n      W := R.Right - R.Left;\r\n      H := R.Bottom - R.Top;\r\n      if R.Left > WorkareaRectF.Left then\r\n      begin\r\n        if R.Left > WorkareaRectF.Right - W then\r\n        begin\r\n          R.Left := WorkareaRectF.Right - W;\r\n          if LPlacement = ppRight then\r\n          begin\r\n            LPlacement := ppLeft;\r\n            Result := False;\r\n          end;\r\n          if LPlacement = ppRightCenter then\r\n          begin\r\n            LPlacement := ppLeftCenter;\r\n            Result := False;\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        R.Left := WorkareaRectF.Left;\r\n        if LPlacement = ppLeft then\r\n        begin\r\n          LPlacement := ppRight;\r\n          Result := False;\r\n        end;\r\n        if LPlacement = ppLeftCenter then\r\n        begin\r\n          LPlacement := ppRightCenter;\r\n          Result := False;\r\n        end;\r\n      end;\r\n      if R.Top > WorkareaRectF.Top then\r\n      begin\r\n        if R.Top > WorkareaRectF.Bottom - H then\r\n        begin\r\n          R.Top := WorkareaRectF.Bottom - H;\r\n          if LPlacement = ppBottom then\r\n          begin\r\n            LPlacement := ppTop;\r\n            Result := False;\r\n          end;\r\n          if LPlacement = ppBottomCenter then\r\n          begin\r\n            LPlacement := ppTopCenter;\r\n            Result := False;\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        R.Top := WorkareaRectF.Top;\r\n        if LPlacement = ppTop then\r\n        begin\r\n          LPlacement := ppBottom;\r\n          Result := False;\r\n        end;\r\n        if LPlacement = ppTopCenter then\r\n        begin\r\n          LPlacement := ppBottomCenter;\r\n          Result := False;\r\n        end;\r\n      end;\r\n      R.Right := R.Left + W;\r\n      R.Bottom := R.Top + H;\r\n    end;\r\n  end;\r\nbegin\r\n  FPlacementChanged := False;\r\n  LOffset := Offset;\r\n  LPlacement := Placement;\r\n  LStep := 0;\r\n  repeat\r\n    LRect := RectF(FPlacementRectangle.Left, FPlacementRectangle.Top, FPlacementRectangle.Right, FPlacementRectangle.Bottom);\r\n    if (PlacementControl <> nil) and FPlacementRectangle.Empty then\r\n      LRect := RectF(0, 0, PlacementControl.Width, PlacementControl.Height);\r\n    if (PlacementControl = nil) and PlacementRectangle.Empty and\r\n       (not (LPlacement in [ppAbsolute, ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter])) then\r\n    begin\r\n      {$IFDEF FMXLIB}\r\n      if not TPlatformServices.Current.SupportsPlatformService(IFMXMouseService, IInterface(MouseSvc)) then\r\n        LPlacement := ppAbsolute\r\n      else\r\n        LPlacement := ppMouse;\r\n      {$ENDIF}\r\n    end;\r\n    FScreenPlacementRect := LRect;\r\n    // Vertical Offset\r\n    if LPlacement in [ppTop, ppTopCenter] then\r\n      OffsetRectEx(LRect, 0, ContentPadding.Bottom - LOffset.Y)\r\n    else\r\n      OffsetRectEx(LRect, 0, LOffset.Y - ContentPadding.Top);\r\n    // Horizontal Offset\r\n    if LPlacement in [ppLeft, ppLeftCenter] then\r\n      OffsetRectEx(LRect, ContentPadding.Right - LOffset.X, 0)\r\n    else\r\n      OffsetRectEx(LRect, LOffset.X - ContentPadding.Left, 0);\r\n    // Offset by rect\r\n    PlacementByTarget := not (LPlacement in [ppAbsolute, ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter]);\r\n    SourceSize := Size;\r\n\r\n    case LPlacement of\r\n      ppBottom:\r\n        OffsetRectEx(LRect, 0, (LRect.Bottom - LRect.Top));\r\n      ppTop:\r\n        OffsetRectEx(LRect, 0, -SourceSize.cy);\r\n      ppLeft:\r\n        OffsetRectEx(LRect, -SourceSize.cx, 0);\r\n      ppRight:\r\n        OffsetRectEx(LRect, (LRect.Right - LRect.Top), 0);\r\n      ppCenter:\r\n        OffsetRectEx(LRect, ((LRect.Right - LRect.Top) - SourceSize.cx) / 2, ((LRect.Bottom - LRect.Top) - SourceSize.cy) / 2);\r\n      ppBottomCenter:\r\n        OffsetRectEx(LRect, ((LRect.Right - LRect.Top) - SourceSize.cx) / 2, (LRect.Bottom - LRect.Top));\r\n      ppTopCenter:\r\n        OffsetRectEx(LRect, ((LRect.Right - LRect.Top) - SourceSize.cx) / 2, -SourceSize.cy);\r\n      ppLeftCenter:\r\n        OffsetRectEx(LRect, -SourceSize.cx, ((LRect.Bottom - LRect.Top) - SourceSize.cy) / 2);\r\n      ppRightCenter:\r\n        OffsetRectEx(LRect, (LRect.Right - LRect.Top), ((LRect.Bottom - LRect.Top) - SourceSize.cy) / 2);\r\n      ppAbsolute:\r\n        begin\r\n          if FPlacementRectangle.Empty then\r\n            LRect := RectF(FPlacementRectangle.Rect.Left, FPlacementRectangle.Rect.Top, FPlacementRectangle.Rect.Left + SourceSize.cx, FPlacementRectangle.Rect.Top + SourceSize.cy)\r\n          else\r\n            LRect := FPlacementRectangle.Rect;\r\n        end;\r\n      ppMouse, ppMouseCenter, ppAboveMouse, ppAboveMouseCenter:\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          Pos := Screen.MousePos;\r\n          {$ENDIF}\r\n          {$IFDEF CMNLIB}\r\n          Pos := Mouse.CursorPos;\r\n          {$ENDIF}\r\n          LRect := RectF(Pos.X, Pos.Y, Pos.X + SourceSize.cx, Pos.Y + SourceSize.cy);\r\n          if LPlacement = ppMouseCenter then\r\n            OffsetRectEx(LRect, -SourceSize.cx / 2, -SourceSize.cy / 2);\r\n          if LPlacement = ppAboveMouseCenter then\r\n            OffsetRectEx(LRect, -SourceSize.cx / 2, -SourceSize.cy - 5);\r\n          if LPlacement = ppAboveMouse then\r\n            OffsetRectEx(LRect, 0, -SourceSize.cy - 5);\r\n        end;\r\n    end;\r\n    // use border\r\n    if PlacementByTarget then\r\n    begin\r\n      {$IFDEF FMXLIB}\r\n      AbsolutePos := PointF(LRect.Left, LRect.Top);\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      AbsolutePos := Point(Round(LRect.Left), Round(LRect.Top));\r\n      {$ENDIF}\r\n      if PlacementControl <> nil then\r\n      begin\r\n        {$IFDEF FMXLIB}\r\n        AbsolutePos := PlacementControl.LocalToAbsolute(AbsolutePos);\r\n        FScreenPlacementRect.TopLeft := PlacementControl.LocalToAbsolute(FScreenPlacementRect.TopLeft);\r\n        FScreenPlacementRect.BottomRight := PlacementControl.LocalToAbsolute(FScreenPlacementRect.BottomRight);\r\n        if PlacementControl.Scene <> nil then\r\n        begin\r\n          AbsolutePos := PlacementControl.Scene.LocalToScreen(AbsolutePos);\r\n          FScreenPlacementRect.TopLeft := PlacementControl.Scene.LocalToScreen(FScreenPlacementRect.TopLeft);\r\n          FScreenPlacementRect.BottomRight := PlacementControl.Scene.LocalToScreen(FScreenPlacementRect.BottomRight);\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        AbsolutePos := PlacementControl.ClientToScreen(AbsolutePos);\r\n        pt := Point(Round(FScreenPlacementRect.Left), Round(FScreenPlacementRect.Top));\r\n        pt := PlacementControl.ClientToScreen(pt);\r\n        FScreenPlacementRect.Left := pt.X;\r\n        FScreenPlacementRect.Top := pt.Y;\r\n        pt := Point(Round(FScreenPlacementRect.Right), Round(FScreenPlacementRect.Bottom));\r\n        pt := PlacementControl.ClientToScreen(pt);\r\n        FScreenPlacementRect.Right := pt.X;\r\n        FScreenPlacementRect.Bottom := pt.Y;\r\n        {$ENDIF}\r\n      end;\r\n      LRect := RectF(AbsolutePos.X, AbsolutePos.Y, AbsolutePos.X + Size.cx, AbsolutePos.Y + Size.cy);\r\n    end;\r\n    LSoGood := UpdateRectByScreen(LRect, ComponentState);\r\n    Inc(LStep);\r\n  until LSoGood or (LStep > 1);\r\n  FScreenContentRect := LRect;\r\n  FScreenContentRect := RectF(FScreenContentRect.Left + FContentPadding.Left, FScreenContentRect.Top + FContentPadding.Top, FScreenContentRect.Right - FContentPadding.Right, FScreenContentRect.Bottom - FContentPadding.Bottom);\r\n  FRealPlacement := LPlacement;\r\n  UpdateBounds(LRect);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.DoBeforeClose;\r\nbegin\r\n  if Assigned(OnBeforeClose) then\r\n    OnBeforeClose(self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.DoBeforeShow;\r\nbegin\r\n  FHintWindow := False;\r\n  if Assigned(OnBeforeShow) then\r\n    OnBeforeShow(self);\r\n\r\n  FFirstShow := True;\r\n\r\n  if not Assigned(FTimer) then\r\n    FTimer := TTimer.Create(Self);\r\n\r\n  FTimer.Interval := 20;\r\n  FTimer.OnTimer := TimerProc;\r\n  FTimer.Enabled := True;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.TimerProc(Sender: TObject);\r\nbegin\r\n  if (Visible or FHintWindow) and (FFirstShow or FDragWithParent) then\r\n    ApplyPlacement;\r\n  if (Visible or FHintWindow) and (FFirstShow) then\r\n  begin\r\n    FFirstShow := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPopupForm.ApplyPlacement;\r\nvar\r\n  OldRect, NewRect: TRect;\r\n  OldRealPlacement: TTMSFNCPopupPlacement;\r\nbegin\r\n  {$IFNDEF WEBLIB}\r\n  if not (csLoading in ComponentState) and not (csUpdating in ComponentState) and not (csDestroying in ComponentState) then\r\n  {$ENDIF}\r\n  begin\r\n    OldRect := Rect(Left, Top, Left + Width, Top + Height);\r\n    OldRealPlacement := FRealPlacement;\r\n    DoApplyPlacement;\r\n    NewRect := Rect(Left, Top, Left + Width, Top + Height);\r\n    if (NewRect.Left <> OldRect.Left) or (NewRect.Top <> OldRect.Top) or (NewRect.Bottom <> OldRect.Bottom) or (NewRect.Right <> OldRect.Right)\r\n      or (OldRealPlacement <> RealPlacement) then\r\n      DoRealPlacementChanged;\r\n  end\r\n  {$IFNDEF WEBLIB}\r\n  else\r\n    FPlacementChanged := True;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopup.ActivatePreviousWindow;\r\nbegin\r\n  {$IFDEF CMNLIB}\r\n  SetActiveWindow(FActiveWindow);\r\n  {$ENDIF}\r\nend;\r\n\r\nconstructor TTMSFNCCustomNonFocusablePopup.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  StaysOpen := True;\r\nend;\r\n\r\ndestructor TTMSFNCCustomNonFocusablePopup.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCCustomNonFocusablePopup.GetPopupFormClass: TTMSFNCCustomPopupFormClass;\r\nbegin\r\n  Result := TTMSFNCCustomNonFocusablePopupForm;\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopup.ShowPopup(AModal: Boolean);\r\n{$IFDEF CMNLIB}\r\n{$IFDEF MSWINDOWS}\r\nvar\r\n  hWin: HWND;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  PopupForm.FormStyle := TFormStyle.Popup;\r\n  inherited;\r\n  {$ENDIF}\r\n  {$IFDEF CMNLIB}\r\n  FActiveWindow := GetActiveWindow;\r\n  {$IFDEF MSWINDOWS}\r\n  PopupForm.HintWindow := True;\r\n  hWin := PopupForm.Handle;\r\n  SetWindowPos(hwin, HWND_TOPMOST, PopupForm.Left, PopupForm.Top, PopupForm.Width, PopupForm.Height, SWP_NOACTIVATE);\r\n  ShowWindow(hWin, SW_SHOWNOACTIVATE);\r\n  PopupForm.Visible := True;\r\n  {$ELSE}\r\n  PopupForm.SetBounds(PopupForm.Left, PopupForm.Top, PopupForm.Width, PopupForm.Height);\r\n  PopupForm.Visible := True;\r\n  PopupForm.BorderStyle := bsSingle;\r\n  PopupForm.BorderStyle := bsNone;\r\n  {$ENDIF}\r\n  SetActiveWindow(FActiveWindow);\r\n  {$ENDIF}\r\n\r\n  FIsOpen := True;\r\nend;\r\n\r\n{ TTMSFNCCustomNonFocusablePopupForm }\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.UpdateBounds(LRect: TRectF);\r\n{$IFDEF CMNLIB}\r\n{$IFDEF MSWINDOWS}\r\nvar\r\n  hWin: HWND;\r\n{$ENDIF}\r\n{$ENDIF}\r\nbegin\r\n  inherited;\r\n  {$IFDEF CMNLIB}\r\n  {$IFDEF MSWINDOWS}\r\n  hWin := Handle;\r\n  SetWindowPos(hwin, HWND_TOPMOST, Round(LRect.Left), Round(LRect.Top), Round((LRect.Right - LRect.Left)), Round((LRect.Bottom - LRect.Top)), SWP_NOACTIVATE);\r\n  {$ELSE}\r\n  SetBounds(Round(LRect.Left), Round(LRect.Top), Round((LRect.Right - LRect.Top)), Round((LRect.Bottom - LRect.Top)));\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF CMNLIB}\r\n{$IFDEF MSWINDOWS}\r\nfunction HintWindowProc(hWnd: hWnd; uMsg: Integer; WParam: WParam;\r\n  lParam: lParam): LRESULT; stdcall;\r\nvar\r\n  I: Integer;\r\n  pr: LInteger;\r\nbegin\r\n  case uMsg of\r\n    WM_MOUSEACTIVATE:\r\n    begin\r\n      Result := MA_NOACTIVATE;\r\n      Exit;\r\n    end;\r\n  end;\r\n\r\n  pr := 0;\r\n  for I := 0 to Length(PrevWndProcs) - 1 do\r\n  begin\r\n    if PrevWndProcs[I].FWindowHandle = hWnd then\r\n      pr := PrevWndProcs[I].FProc;\r\n  end;\r\n\r\n  Result := CallWindowProc({%H-}IntPtr(pr), hWnd, uMsg, WParam, lParam);\r\nend;\r\n\r\ndestructor TTMSFNCCustomNonFocusablePopupForm.Destroy;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  for I := 0 to Length(PrevWndProcs) - 1 do\r\n  begin\r\n    if PrevWndProcs[I].FWindowHandle = Self.Handle then\r\n      SetWindowLongPtr(Self.Handle, GWL_WNDPROC, PrevWndProcs[I].FProc);\r\n  end;\r\n  inherited;\r\nend;\r\n\r\nconstructor TTMSFNCCustomNonFocusablePopupForm.CreateNew(AOwner: TComponent; Dummy: Integer  = 0);\r\nvar\r\n  r: WndProcRec;\r\nbegin\r\n  inherited;\r\n  SetLength(PrevWndProcs, Length(PrevWndProcs) + 1);\r\n  r.FWindowHandle := Self.Handle;\r\n  r.FProc := SetWindowLongPtr(Self.Handle, GWL_WNDPROC, {%H-}LInteger(@HintWindowProc));\r\n  PrevWndProcs[Length(PrevWndProcs) - 1] := r;\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.CreateParams(var Params: TCreateParams);\r\nbegin\r\n  inherited CreateParams(Params);\r\n  with Params do\r\n  begin\r\n    Style := WS_POPUP;\r\n    WindowClass.Style := WindowClass.Style or CS_SAVEBITS;\r\n    if NewStyleControls then\r\n      ExStyle := WS_EX_TOOLWINDOW or WS_EX_NOACTIVATE;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.WMNCHitTest(var Message: TWMNCHitTest);\r\nbegin\r\n  Message.Result := HTTRANSPARENT;\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.WMActivate(var Message: TWMActivate);\r\nbegin\r\n  Message.Result := 1;\r\nend;\r\n\r\n{$ELSE}\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.WMNCHitTest(var Message: TLMessage);\r\nbegin\r\n  Message.Result := HTTRANSPARENT;\r\nend;\r\n\r\nprocedure TTMSFNCCustomNonFocusablePopupForm.WMActivate(var Message: TLMActivate);\r\nbegin\r\n  Message.Result := 1;\r\n  if (Owner is TTMSFNCCustomNonFocusablePopup) then\r\n    (Owner as TTMSFNCCustomNonFocusablePopup).ActivatePreviousWindow;\r\nend;\r\n{$ENDIF}\r\n{$ENDIF}\r\n\r\n{ TTMSFNCNonFocusablePopup }\r\n\r\nprocedure TTMSFNCNonFocusablePopup.Deactivate;\r\nbegin\r\n  ClosePopup;\r\nend;\r\n\r\nprocedure TTMSFNCNonFocusablePopup.Activate;\r\nbegin\r\n  DoCreatePopup(False);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCToolBarRes;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\ninterface\r\n\r\n{$IFDEF WEBLIB}\r\nconst\r\n  TMSFNCTOOLBAREXPAND = 'data:image/PNG;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOvwAADr8B'+\r\n                        'OAVTJAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4zjOaXUAAAACVJREFUGFdj+P//P07MEBYW9h8Xxi8J'+\r\n                        'AjglYACnBAzglMAEDAwARZ1DA4NRF38AAAAASUVORK5CYII=';\r\n  TMSFNCTOOLBAREXPANDLARGE = TMSFNCTOOLBAREXPAND;\r\n\r\n  TMSFNCTOOLBAREXPAND2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOvgAADr4'+\r\n                         'B6kKxwAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xNkRpr/UAAAA3SURBVBhXY3j69KktLgyS/I8LE5RsQxeE4jaQpCKIgSQIlgBi'+\r\n                         'RQYQADGgAqgSMABVkI2QYGAAANnukE/t/B6ZAAAAAElFTkSuQmCC';\r\n  TMSFNCTOOLBAREXPAND2LARGE = TMSFNCTOOLBAREXPAND;\r\n\r\n  TMSFNCTOOLBAROPTIONSMENU = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAJCAYAAAD+WDajAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOvwA'+\r\n                             'ADr8BOAVTJAAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4zjOaXUAAAACpJREFUKFNjwAvCwsL+48IM///jxvh1YhOEYZz2giVg'+\r\n                             'AKcEDOCUwAQMDAAqj1EKDJG5XAAAAABJRU5ErkJggg==';\r\n  TMSFNCTOOLBAROPTIONSMENULARGE = TMSFNCTOOLBAROPTIONSMENU;\r\n\r\n  TMSFNCTOOLBARQUICKMENU = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADs'+\r\n                           'IBFShKgAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xNkRpr/UAAAAlSURBVBhXYwCC/9gwEAApKAMbJl4SnY0igCQIw3gkcUowMP'+\r\n                           'wHALBNZJw15C+yAAAAAElFTkSuQmCC';\r\n  TMSFNCTOOLBARQUICKMENU2 = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAA'+\r\n                            'AAJcEhZcwAADsMAAA7DAcdvqGQAAAAZdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuMTZEaa/1AAAAL0lEQVQYV2P4jxswwCRBNAYGESCA'+\r\n                            'IQHCIAIEYAIgAGejC8D4YEBQEqvE/////wMA7H6pV7j5gXMAAAAASUVORK5CYII=';\r\n{$ENDIF}\r\n\r\n{$R TMSFNCToolBar.res}\r\n\r\nimplementation\r\n\r\n{$IFDEF WEBLIB}\r\nuses\r\n  WEBLib.TMSFNCTypes;\r\n\r\ninitialization\r\nbegin\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCTOOLBAREXPAND);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCTOOLBAREXPAND2);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCTOOLBAROPTIONSMENU);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCTOOLBARQUICKMENU);\r\n  TTMSFNCBitmap.CreateFromResource(TMSFNCTOOLBARQUICKMENU2);\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright (c) 2018                                      }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.Menus;\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, SysUtils, WebLib.Controls;\r\n\r\ntype\r\n  TMainMenu = class;\r\n  TMenuItem = class;\r\n\r\n  TMainMenuChangeEvent = procedure(Sender: TObject; Source: TMenuItem; Rebuild: boolean) of object;\r\n\r\n  TMenuItem = class(TComponent)\r\n  private\r\n    FCaption: string;\r\n    FItems: TList;\r\n    FParent: TComponent;\r\n    FUpdateCount: integer;\r\n    FOnClick: TNotifyEvent;\r\n  protected\r\n    function GetCount: integer;\r\n  public\r\n    procedure BeginUpdate; virtual; reintroduce;\r\n    procedure EndUpdate; virtual; reintroduce;\r\n    procedure SetParentComponent(Value: TComponent); override;\r\n    procedure Add(Item: TMenuItem);\r\n    procedure Insert(Index: Integer; Item: TMenuItem); reintroduce;\r\n  published\r\n    property Caption: string read FCaption write FCaption;\r\n    property Items: TList read FItems write FItems;\r\n    property Count: integer read GetCount;\r\n    property OnClick: TNotifyEvent read FOnClick write FOnClick;\r\n  end;\r\n\r\n  TMainMenu = class(TCustomControl)\r\n  private\r\n    FItems: TMenuItem;\r\n    FOnChange: TMainMenuChangeEvent;\r\n  protected\r\n    procedure Loaded; override;\r\n    procedure UpdateElement; override;\r\n  public\r\n    procedure CreateInitialize; override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Items: TMenuItem read FItems write FItems;\r\n    property OnChange: TMainMenuChangeEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\nimplementation\r\n\r\n{ TMainMenu }\r\n\r\nprocedure TMainMenu.CreateInitialize;\r\nbegin\r\n  inherited;\r\n\r\n  FItems := TMenuItem.Create;\r\nend;\r\n\r\ndestructor TMainMenu.Destroy;\r\nbegin\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TMainMenu.Loaded;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\n\r\n  if Assigned(ElementHandle) then\r\n  begin\r\n    UpdateElement;\r\n  end;\r\nend;\r\n\r\nprocedure TMainMenu.UpdateElement;\r\nbegin\r\n  inherited;\r\n\r\n  if IsUpdating then\r\n    Exit;\r\nend;\r\n\r\n{ TMenuItem }\r\n\r\nprocedure TMenuItem.BeginUpdate;\r\nbegin\r\n  inc(FUpdateCount);\r\nend;\r\n\r\nprocedure TMenuItem.EndUpdate;\r\nbegin\r\n  if (FUpdateCount > 0) then\r\n  begin\r\n    dec(FUpdateCount);\r\n\r\n    if FUpdateCount = 0 then\r\n      TMainMenu(FParent).UpdateElement;\r\n  end;\r\nend;\r\n\r\nfunction TMenuItem.GetCount: integer;\r\nbegin\r\n  if FItems = nil then\r\n    Result := 0\r\n  else\r\n    Result := FItems.Count;\r\nend;\r\n\r\nprocedure TMenuItem.Insert(Index: Integer; Item: TMenuItem);\r\nbegin\r\n  if FItems = nil then\r\n    FItems := TList.Create;\r\n  FItems.Insert(Index, Item);\r\n//  Item.Parent := Self;\r\nend;\r\n\r\nprocedure TMenuItem.Add(Item: TMenuItem);\r\nbegin\r\n  Insert(GetCount, Item);\r\nend;\r\n\r\nprocedure TMenuItem.SetParentComponent(Value: TComponent);\r\nbegin\r\n  inherited;\r\n//  if FParent <> nil then FParent.Remove(Self);\r\n  if Value <> nil then\r\n    if Value is TMainMenu then\r\n      TMainMenu(Value).Items.Add(Self)\r\n    else if Value is TMenuItem then\r\n      TMenuItem(Value).Add(Self);\r\nend;\r\n\r\nend.","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCToolBar;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE VCLWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF VCLLIB}\r\n{$DEFINE VCLWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCGraphics, WEBLib.TMSFNCCustomControl, WEBLib.Controls, Types, WEBLib.TMSFNCBitmapSelector,\r\n  WEBLib.TMSFNCPopup, WEBLib.TMSFNCTypes, WEBLib.TMSFNCBitmapContainer, WEBLib.StdCtrls, WEBLib.TMSFNCColorSelector,\r\n  {%H-}WEBLib.TMSFNCToolBarRes, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,UITypes, Generics.Collections, Generics.Defaults\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.ListBox, FMX.Menus, FMX.Types, FMX.Edit\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,Menus\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,Contnrs, WEBLib.Menus\r\n  {$ENDIF}\r\n  ,WEBLib.ExtCtrls\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,fgl\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 1; // Release nr.\r\n  BLD_VER = 3; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : first release\r\n  // v1.0.1.0 : New : DisabledBitmaps property\r\n  // v1.0.1.1 : Fixed : Issue with DropDownButton on VCL\r\n  // v1.0.1.2 : Fixed : Issue with bounds loop on LCL\r\n  // v1.0.1.3 : Fixed : Issue with Tag property being overriden\r\n\r\ntype\r\n  TTMSFNCCustomToolBar = class;\r\n  TTMSFNCCustomDockPanel = class;\r\n  TTMSFNCCustomToolBarSeparator = class;\r\n  TTMSFNCDefaultToolBarButton = class;\r\n  TTMSFNCToolBarButton = class;\r\n  TTMSFNCToolBarDropDownButton = class;\r\n\r\n  TTMSFNCToolBarCustomButtonAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TTMSFNCDefaultToolBarButton;\r\n    FHoverStroke: TTMSFNCGraphicsStroke;\r\n    FDownFill: TTMSFNCGraphicsFill;\r\n    FNormalFill: TTMSFNCGraphicsFill;\r\n    FDownStroke: TTMSFNCGraphicsStroke;\r\n    FDisabledFill: TTMSFNCGraphicsFill;\r\n    FNormalStroke: TTMSFNCGraphicsStroke;\r\n    FDisabledStroke: TTMSFNCGraphicsStroke;\r\n    FHoverFill: TTMSFNCGraphicsFill;\r\n    FCorners: TTMSFNCGraphicsCorners;\r\n    FRounding: Single;\r\n    FTransparent: Boolean;\r\n    FShowInnerStroke: Boolean;\r\n    FInnerStroke: TTMSFNCGraphicsStroke;\r\n    FFlatStyle: Boolean;\r\n    FOnChange: TNotifyEvent;\r\n    procedure SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetDisabledStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetDownFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetDownStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetHoverFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetHoverStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetNormalFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetNormalStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetCorners(const Value: TTMSFNCGraphicsCorners); virtual;\r\n    procedure SetRounding(const Value: Single); virtual;\r\n    procedure SetInnerStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetShowInnerStroke(const Value: Boolean);\r\n    procedure SetTransparent(const Value: Boolean);\r\n    function IsRoundingStored: Boolean;\r\n    procedure SetFlatStyle(const Value: Boolean);\r\n  protected\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure StrokeChanged(Sender: TObject);\r\n    procedure Changed; virtual;\r\n    property Transparent: Boolean read FTransparent write SetTransparent default False;\r\n    property ShowInnerStroke: Boolean read FShowInnerStroke write SetShowInnerStroke default True;\r\n    property Rounding: Single read FRounding write SetRounding stored IsRoundingStored nodefault;\r\n    property Corners: TTMSFNCGraphicsCorners read FCorners write SetCorners default [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight];\r\n    property InnerStroke: TTMSFNCGraphicsStroke read FInnerStroke write SetInnerStroke;\r\n    property NormalFill: TTMSFNCGraphicsFill read FNormalFill write SetNormalFill;\r\n    property NormalStroke: TTMSFNCGraphicsStroke read FNormalStroke write SetNormalStroke;\r\n    property HoverFill: TTMSFNCGraphicsFill read FHoverFill write SetHoverFill;\r\n    property HoverStroke: TTMSFNCGraphicsStroke read FHoverStroke write SetHoverStroke;\r\n    property DownFill: TTMSFNCGraphicsFill read FDownFill write SetDownFill;\r\n    property DownStroke: TTMSFNCGraphicsStroke read FDownStroke write SetDownStroke;\r\n    property DisabledFill: TTMSFNCGraphicsFill read FDisabledFill write SetDisabledFill;\r\n    property DisabledStroke: TTMSFNCGraphicsStroke read FDisabledStroke write SetDisabledStroke;\r\n    property FlatStyle: Boolean read FFlatStyle write SetFlatStyle default False;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TTMSFNCDefaultToolBarButton);\r\n    destructor Destroy; override;\r\n    property OnChange: TNotifyEvent read FOnChange write FOnChange;\r\n  end;\r\n\r\n  TTMSFNCToolBarButtonAppearance = class(TTMSFNCToolBarCustomButtonAppearance)\r\n  published\r\n    property Transparent;\r\n    property ShowInnerStroke;\r\n    property Rounding;\r\n    property Corners;\r\n    property InnerStroke;\r\n    property NormalFill;\r\n    property NormalStroke;\r\n    property HoverFill;\r\n    property HoverStroke;\r\n    property DownFill;\r\n    property DownStroke;\r\n    property DisabledFill;\r\n    property DisabledStroke;\r\n    property FlatStyle;\r\n  end;\r\n\r\n  TTMSFNCToolBarCompactAppearance = class(TTMSFNCToolBarCustomButtonAppearance)\r\n  published\r\n    property NormalFill;\r\n    property NormalStroke;\r\n    property HoverFill;\r\n    property HoverStroke;\r\n    property DownFill;\r\n    property DownStroke;\r\n    property DisabledFill;\r\n    property DisabledStroke;\r\n    property FlatStyle;\r\n  end;\r\n\r\n  TTMSFNCToolBarQuickMenuButtonAppearance = class(TTMSFNCToolBarCustomButtonAppearance)\r\n  published\r\n    property NormalFill;\r\n    property NormalStroke;\r\n    property HoverFill;\r\n    property HoverStroke;\r\n    property DownFill;\r\n    property DownStroke;\r\n    property DisabledFill;\r\n    property DisabledStroke;\r\n    property FlatStyle;\r\n  end;\r\n\r\n  TTMSFNCToolBarElementState = (esNormal, esLarge);\r\n\r\n  TTMSFNCCustomToolBarElement = class(TTMSFNCCustomControl)\r\n  private\r\n    FBlockUpdate: Boolean;\r\n    FOnUpdateToolBar: TNotifyEvent;\r\n    FOnUpdateToolBarControl: TNotifyEvent;\r\n    FCanCopy: Boolean;\r\n    FState: TTMSFNCToolBarElementState;\r\n    FLastElement: Boolean;\r\n    FControlIndex: Integer;\r\n    procedure SetState(const Value: TTMSFNCToolBarElementState);\r\n    procedure SetLastElement(const Value: Boolean);\r\n  protected\r\n    procedure UpdateState; virtual;\r\n    procedure UpdateToolBar; virtual;\r\n    procedure UpdateToolBarControl; virtual;\r\n    {$IFDEF FMXLIB}\r\n    procedure SetVisible(const Value: Boolean); override;\r\n    procedure DoMatrixChanged(Sender: TObject); override;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure VisibleChanging; override;\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    procedure DefineProperties(Filer : TFiler); override;\r\n    procedure ReadControlIndex(Reader: TReader);\r\n    procedure WriteControlIndex(Writer: TWriter);\r\n    {$ENDIF}\r\n    procedure UpdateControlAfterResize; override;\r\n    property OnUpdateToolBar: TNotifyEvent read FOnUpdateToolBar write FOnUpdateToolBar;\r\n    property OnUpdateToolBarControl: TNotifyEvent read FOnUpdateToolBarControl write FOnUpdateToolBarControl;\r\n    property State: TTMSFNCToolBarElementState read FState write SetState default esNormal;\r\n    property LastElement: Boolean read FLastElement write SetLastElement default False;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    property CanCopy: Boolean read FCanCopy write FCanCopy default True;\r\n    property ControlIndex: Integer read FControlIndex write FControlIndex default -1;\r\n  end;\r\n\r\n  TTMSFNCToolBarButtonBitmapPosition = (bbpLeft, bbpTop);\r\n\r\n  TTMSFNCToolBarButtonLayout = (bblNone, bblBitmap, bblLabel, bblLarge);\r\n\r\n  {$IFDEF FNCLIB}\r\n  TTMSFNCDefaultToolBarButton = class(TTMSFNCCustomToolBarElement, ITMSFNCBitmapContainer)\r\n  {$ENDIF}\r\n  {$IFNDEF FNCLIB}\r\n  TTMSFNCDefaultToolBarButton = class(TTMSFNCCustomToolBarElement)\r\n  {$ENDIF}\r\n  private\r\n    FOldHeight: Single;\r\n    FBitmapVisible: Boolean;\r\n    FText: String;\r\n    FPopup: TTMSFNCPopup;\r\n    FPopupPlacement: TTMSFNCPopupPlacement;\r\n    FDropDownHeight: Single;\r\n    FDropDownWidth: Single;\r\n    FDown, FHover, FPrevHover: Boolean;\r\n    FAppearance: TTMSFNCToolBarButtonAppearance;\r\n    FBitmapContainer: TTMSFNCBitmapContainer;\r\n    FBitmaps: TTMSFNCScaledBitmaps;\r\n    FApplyName: Boolean;\r\n    FDropDownControl: TControl;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FOnBeforeDropDown: TNotifyEvent;\r\n    FCloseOnSelection: Boolean;\r\n    FDownState: Boolean;\r\n    FTextVisible: Boolean;\r\n    FOnCloseDropDown: TNotifyEvent;\r\n    FOnDropDown: TNotifyEvent;\r\n    FVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FWordWrapping: Boolean;\r\n    FTrimming: TTMSFNCGraphicsTextTrimming;\r\n    FBitmapSize: Single;\r\n    FStretchText: Boolean;\r\n    FDisabledBitmaps: TTMSFNCScaledBitmaps;\r\n    FHoverBitmaps: TTMSFNCScaledBitmaps;\r\n    FShowFocus: Boolean;\r\n    FDropDownAutoWidth: Boolean;\r\n    FHoverFontColor: TTMSFNCGraphicsColor;\r\n    FDownFontColor: TTMSFNCGraphicsColor;\r\n    FDisabledFontColor: TTMSFNCGraphicsColor;\r\n    FStretchBitmapIfNoText: Boolean;\r\n    FBitmapPosition: TTMSFNCToolBarButtonBitmapPosition;\r\n    FMaximumLayout: TTMSFNCToolBarButtonLayout;\r\n    FMinimumLayout: TTMSFNCToolBarButtonLayout;\r\n    FLayout: TTMSFNCToolBarButtonLayout;\r\n    FCompactLayout: TTMSFNCToolBarButtonLayout;\r\n    FLargeLayoutBitmapSize: Single;\r\n    FLargeLayoutBitmaps: TTMSFNCScaledBitmaps;\r\n    FLargeLayoutHoverBitmaps: TTMSFNCScaledBitmaps;\r\n    FLargeLayoutDisabledBitmaps: TTMSFNCScaledBitmaps;\r\n    FAutoBitmapSize: Boolean;\r\n    FLargeLayoutAutoBitmapSize: Boolean;\r\n    procedure SetAppearance(const Value: TTMSFNCToolBarButtonAppearance);\r\n    procedure SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\n    procedure SetBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetText(const Value: String);\r\n    procedure SetDropDownHeight(const Value: Single);\r\n    procedure SetDropDownWidth(const Value: Single);\r\n    procedure SetBitmapVisible(const Value: Boolean);\r\n    procedure SetTextVisible(const Value: Boolean);\r\n    procedure SetFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetDropDownControl(const Value: TControl);\r\n    procedure SetCloseOnSelection(const Value: Boolean);\r\n    procedure SetDownState(const Value: Boolean);\r\n    function IsDropDownHeightStored: Boolean;\r\n    function IsDropDownWidthStored: Boolean;\r\n    procedure SetHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetWordWrapping(const Value: Boolean);\r\n    procedure SetTrimming(const Value: TTMSFNCGraphicsTextTrimming);\r\n    function IsBitmapSizeStored: Boolean;\r\n    procedure SetBitmapSize(const Value: Single);\r\n    procedure SetStretchText(const Value: Boolean);\r\n    procedure SetDisabledBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetHoverBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    function GetBitmapContainer: TTMSFNCBitmapContainer;\r\n    procedure SetShowFocus(const Value: Boolean);\r\n    procedure SetDropDownAutoWidth(const Value: Boolean);\r\n    procedure SetDisabledFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDownFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetHoverFontColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetStretchBitmapIfNoText(const Value: Boolean);\r\n    procedure SetBitmapPosition(const Value: TTMSFNCToolBarButtonBitmapPosition);\r\n    procedure SetMaximumLayout(const Value: TTMSFNCToolBarButtonLayout);\r\n    procedure SetMinimumLayout(const Value: TTMSFNCToolBarButtonLayout);\r\n    procedure SetLayout(const Value: TTMSFNCToolBarButtonLayout);\r\n    procedure SetCompactLayout(const Value: TTMSFNCToolBarButtonLayout);\r\n    function IsLargeLayoutBitmapSizeStored: Boolean;\r\n    procedure SetLargeLayoutBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetLargeLayoutBitmapSize(const Value: Single);\r\n    procedure SetLargeLayoutDisabledBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetLargeLayoutHoverBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetAutoBitmapSize(const Value: Boolean);\r\n    procedure SetLargeLayoutAutoBitmapSize(const Value: Boolean);\r\n   protected\r\n    function CanDrawDesignTime: Boolean; virtual;\r\n    function HasHint: Boolean; override;\r\n    function GetHintString: String; override;\r\n    function GetText: String; virtual;\r\n    function GetTextSize: TSizeF; virtual;\r\n    procedure UpdateControlAfterResize; override;\r\n    procedure ApplyStyle; override;\r\n    procedure ResetToDefaultStyle; override;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure BitmapsChanged(Sender: TObject);\r\n    procedure DoFontChanged(Sender: TObject);\r\n    procedure UpdateLayout; virtual;\r\n    procedure DoClosePopup(Sender: TObject);\r\n    procedure DoPopup(Sender: TObject);\r\n    procedure InitializePopup; virtual;\r\n    procedure UpdateState; override;\r\n    procedure ChangeDPIScale(M, D: Integer); override;\r\n    procedure AppearanceChanged; virtual;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure SetName(const Value: TComponentName); override;\r\n    procedure HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseMove(Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleKeyUp(var Key: Word; Shift: TShiftState); override;\r\n    procedure HandleKeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure HandleKeyPress(var Key: Char); override;\r\n    procedure HandleMouseEnter; override;\r\n    procedure HandleMouseLeave; override;\r\n    procedure SelectFirstValue; virtual;\r\n    procedure SelectValueWithCharacter({%H-}ACharacter: Char); virtual;\r\n    procedure SelectLastValue; virtual;\r\n    procedure SelectNextValue; virtual;\r\n    procedure SelectPreviousValue; virtual;\r\n    procedure DrawText(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawBitmap(AGraphics: TTMSFNCGraphics; ARect: TRectF); virtual;\r\n    procedure DrawButton({%H-}AGraphics: TTMSFNCGraphics); virtual;\r\n    function CanDropDown: Boolean; virtual;\r\n    function CanChangeText: Boolean; virtual;\r\n    function GetTextRect: TRectF; virtual;\r\n    function GetDropDownRect: TRectF; virtual;\r\n    function GetBitmapRect: TRectF; overload; virtual;\r\n    function GetBitmapRect(ARect: TRectF): TRectF; overload; virtual;\r\n    function GetBitmapSize: Single; virtual;\r\n    function GetLargeLayoutBitmapSize: Single; virtual;\r\n    property Appearance: TTMSFNCToolBarButtonAppearance read FAppearance write SetAppearance;\r\n    property BitmapVisible: Boolean read FBitmapVisible write SetBitmapVisible default False;\r\n    property Bitmaps: TTMSFNCScaledBitmaps read FBitmaps write SetBitmaps;\r\n    property DisabledBitmaps: TTMSFNCScaledBitmaps read FDisabledBitmaps write SetDisabledBitmaps;\r\n    property HoverBitmaps: TTMSFNCScaledBitmaps read FHoverBitmaps write SetHoverBitmaps;\r\n    property LargeLayoutBitmaps: TTMSFNCScaledBitmaps read FLargeLayoutBitmaps write SetLargeLayoutBitmaps;\r\n    property LargeLayoutDisabledBitmaps: TTMSFNCScaledBitmaps read FLargeLayoutDisabledBitmaps write SetLargeLayoutDisabledBitmaps;\r\n    property LargeLayoutHoverBitmaps: TTMSFNCScaledBitmaps read FLargeLayoutHoverBitmaps write SetLargeLayoutHoverBitmaps;\r\n    property BitmapContainer: TTMSFNCBitmapContainer read GetBitmapContainer write SetBitmapContainer;\r\n    property BitmapSize: Single read FBitmapSize write SetBitmapSize stored IsBitmapSizeStored nodefault;\r\n    property AutoBitmapSize: Boolean read FAutoBitmapSize write SetAutoBitmapSize default false;\r\n    property LargeLayoutBitmapSize: Single read FLargeLayoutBitmapSize write SetLargeLayoutBitmapSize stored IsLargeLayoutBitmapSizeStored nodefault;\r\n    property LargeLayoutAutoBitmapSize: Boolean read FLargeLayoutAutoBitmapSize write SetLargeLayoutAutoBitmapSize default False;\r\n    property StretchBitmapIfNoText: Boolean read FStretchBitmapIfNoText write SetStretchBitmapIfNoText default True;\r\n    property Text: String read GetText write SetText;\r\n    property Trimming: TTMSFNCGraphicsTextTrimming read FTrimming write SetTrimming default gttCharacter;\r\n    property HorizontalTextAlign: TTMSFNCGraphicsTextAlign read FHorizontalTextAlign write SetHorizontalTextAlign default gtaCenter;\r\n    property VerticalTextAlign: TTMSFNCGraphicsTextAlign read FVerticalTextAlign write SetVerticalTextAlign default gtaCenter;\r\n    property Font: TTMSFNCGraphicsFont read FFont write SetFont;\r\n    property HoverFontColor: TTMSFNCGraphicsColor read FHoverFontColor write SetHoverFontColor default gcNull;\r\n    property DownFontColor: TTMSFNCGraphicsColor read FDownFontColor write SetDownFontColor default gcNull;\r\n    property DisabledFontColor: TTMSFNCGraphicsColor read FDisabledFontColor write SetDisabledFontColor default gcNull;\r\n    property TextVisible: Boolean read FTextVisible write SetTextVisible default True;\r\n    property StretchText: Boolean read FStretchText write SetStretchText default False;\r\n    property WordWrapping: Boolean read FWordWrapping write SetWordWrapping default False;\r\n    property DropDownAutoWidth: Boolean read FDropDownAutoWidth write SetDropDownAutoWidth default False;\r\n    property DropDownHeight: Single read FDropDownHeight write SetDropDownHeight stored IsDropDownHeightStored nodefault;\r\n    property DropDownWidth: Single read FDropDownWidth write SetDropDownWidth stored IsDropDownWidthStored nodefault;\r\n    property DropDownControl: TControl read FDropDownControl write SetDropDownControl;\r\n    property CloseOnSelection: Boolean read FCloseOnSelection write SetCloseOnSelection default True;\r\n    property OnBeforeDropDown: TNotifyEvent read FOnBeforeDropDown write FOnBeforeDropDown;\r\n    property OnDropDown: TNotifyEvent read FOnDropDown write FOnDropDown;\r\n    property OnCloseDropDown: TNotifyEvent read FOnCloseDropDown write FOnCloseDropDown;\r\n    property ApplyName: Boolean read FApplyName write FApplyName default True;\r\n    property ShowFocus: Boolean read FShowFocus write SetShowFocus default False;\r\n    property BitmapPosition: TTMSFNCToolBarButtonBitmapPosition read FBitmapPosition write SetBitmapPosition default bbpLeft;\r\n    property CompactLayout: TTMSFNCToolBarButtonLayout read FCompactLayout write SetCompactLayout default bblNone;\r\n    property Layout: TTMSFNCToolBarButtonLayout read FLayout write SetLayout default bblNone;\r\n    property MinimumLayout: TTMSFNCToolBarButtonLayout read FMinimumLayout write SetMinimumLayout default bblBitmap;\r\n    property MaximumLayout: TTMSFNCToolBarButtonLayout read FMaximumLayout write SetMaximumLayout default bblLarge;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    procedure DropDown; virtual;\r\n    procedure CloseDropDown; virtual;\r\n    function GetPopupControl: TTMSFNCPopup;\r\n    function GetBitmap: TTMSFNCBitmap; virtual;\r\n    property DownState: Boolean read FDownState write SetDownState;\r\n    property PopupPlacement: TTMSFNCPopupPlacement read FPopupPlacement write FPopupPlacement default ppBottom;\r\n  end;\r\n\r\n  TTMSFNCToolBarButtonDropDownKind = (ddkNormal, ddkDropDown, ddkDropDownButton);\r\n  TTMSFNCToolBarButtonDropDownPosition = (ddpRight, ddpBottom);\r\n\r\n  TTMSFNCToolBarDropDownButton = class(TTMSFNCDefaultToolBarButton)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n    function GetBitmapRect(ARect: TRectF): TRectF; override;\r\n  published\r\n    property Font;\r\n    property Text;\r\n    property ShowFocus;\r\n    property TextVisible;\r\n    property StretchText;\r\n    property WordWrapping;\r\n    property HorizontalTextAlign;\r\n    property VerticalTextAlign;\r\n    property Trimming;\r\n    property Bitmaps;\r\n    property DisabledBitmaps;\r\n    property HoverBitmaps;\r\n    property BitmapVisible;\r\n    property BitmapContainer;\r\n    property State;\r\n    property LastElement;\r\n    property Appearance;\r\n  end;\r\n\r\n  TTMSFNCToolBarDropDownButtonClass = class of TTMSFNCToolBarDropDownButton;\r\n\r\n\r\n  TTMSFNCCustomToolBarButton = class(TTMSFNCDefaultToolBarButton)\r\n  private\r\n    FDropDownButton: TTMSFNCToolBarDropDownButton;\r\n    FDropDownKind: TTMSFNCToolBarButtonDropDownKind;\r\n    FDropDownPosition: TTMSFNCToolBarButtonDropDownPosition;\r\n    FHidden: Boolean;\r\n    FAutoOptionsMenuText: String;\r\n    procedure SetDropDownKind(const Value: TTMSFNCToolBarButtonDropDownKind);\r\n    procedure SetDropDownPosition(\r\n      const Value: TTMSFNCToolBarButtonDropDownPosition);\r\n    procedure SetHidden(const Value: Boolean);\r\n  protected\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure DoFontChanged(Sender: TObject);\r\n    procedure AppearanceChanged; override;\r\n    procedure UpdateDropDownButton; virtual;\r\n    procedure HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure DropDownButtonClick(Sender: TObject);\r\n    procedure DrawButton(AGraphics: TTMSFNCGraphics); override;\r\n    {$IFDEF FMXLIB}\r\n    procedure SetEnabled(const Value: Boolean); override;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure SetEnabled(Value: Boolean); override;\r\n    {$ENDIF}\r\n    function GetDropDownButtonClass: TTMSFNCToolBarDropDownButtonClass; virtual;\r\n    function GetDropDownRect: TRectF; override;\r\n    function GetTextRect: TRectF; override;\r\n    function GetBitmapRect(ARect: TRectF): TRectF; overload; override;\r\n    function GetBitmapRect: TRectF; overload; override;\r\n    function CanDropDown: Boolean; override;\r\n    property DropDownKind: TTMSFNCToolBarButtonDropDownKind read FDropDownKind write SetDropDownKind default ddkNormal;\r\n    property DropDownPosition: TTMSFNCToolBarButtonDropDownPosition read FDropDownPosition write SetDropDownPosition default ddpRight;\r\n    property AutoOptionsMenuText: String read FAutoOptionsMenuText write FAutoOptionsMenuText;\r\n    property Hidden: Boolean read FHidden write SetHidden default False;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    function GetDropDownButtonControl: TTMSFNCToolBarDropDownButton;\r\n  end;\r\n\r\n  TTMSFNCCustomToolBarSeparatorAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TTMSFNCCustomToolBarSeparator;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FInnerStroke: TTMSFNCGraphicsStroke;\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetInnerStroke(const Value: TTMSFNCGraphicsStroke);\r\n  protected\r\n    procedure StrokeChanged(Sender: TObject);\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    property InnerStroke: TTMSFNCGraphicsStroke read FInnerStroke write SetInnerStroke;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TTMSFNCCustomToolBarSeparator);\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TTMSFNCToolBarSeparatorAppearance = class(TTMSFNCCustomToolBarSeparatorAppearance)\r\n  published\r\n    property Stroke;\r\n    property InnerStroke;\r\n  end;\r\n\r\n  TTMSFNCCustomToolBarSeparator = class(TTMSFNCCustomToolBarElement)\r\n  private\r\n    FAppearance: TTMSFNCToolBarSeparatorAppearance;\r\n    procedure SetAppearance(const Value: TTMSFNCToolBarSeparatorAppearance);\r\n  protected\r\n    procedure UpdateState; override;\r\n    property Appearance: TTMSFNCToolBarSeparatorAppearance read FAppearance write SetAppearance;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarButton = class(TTMSFNCCustomToolBarButton)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  public\r\n    property Hidden;\r\n  published\r\n    property Font;\r\n    property AutoOptionsMenuText;\r\n    property DropDownAutoWidth;\r\n    property DropDownKind;\r\n    property DropDownPosition;\r\n    property DropDownHeight;\r\n    property DropDownWidth;\r\n    property DropDownControl;\r\n    property OnBeforeDropDown;\r\n    property OnDropDown;\r\n    property OnCloseDropDown;\r\n    property Text;\r\n    property ShowFocus;\r\n    property TextVisible;\r\n    property StretchText;\r\n    property StretchBitmapIfNoText;\r\n    property HorizontalTextAlign;\r\n    property VerticalTextAlign;\r\n    property Trimming;\r\n    property Bitmaps;\r\n    property LargeLayoutBitmaps;\r\n    property Layout;\r\n    property CompactLayout;\r\n    property MinimumLayout;\r\n    property MaximumLayout;\r\n    property BitmapPosition;\r\n    property DisabledBitmaps;\r\n    property HoverBitmaps;\r\n    property LargeLayoutDisabledBitmaps;\r\n    property LargeLayoutHoverBitmaps;\r\n    property BitmapVisible;\r\n    property BitmapContainer;\r\n    property BitmapSize;\r\n    property AutoBitmapSize;\r\n    property LargeLayoutBitmapSize;\r\n    property LargeLayoutAutoBitmapSize;\r\n    property State;\r\n    property LastElement;\r\n    property Appearance;\r\n    property WordWrapping;\r\n  end;\r\n\r\n  TTMSFNCToolBarButtonClass = class of TTMSFNCToolBarButton;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarSeparator = class(TTMSFNCCustomToolBarSeparator)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  published\r\n    property State;\r\n    property LastElement;\r\n    property Appearance;\r\n  end;\r\n\r\n  TTMSFNCToolBarSeparatorClass = class of TTMSFNCToolBarSeparator;\r\n\r\n  TTMSFNCToolBarItemPickerItemSelected = procedure(Sender: TObject; AItemIndex: Integer) of object;\r\n\r\n  TTMSFNCToolBarCustomItemPicker = class(TTMSFNCToolBarButton)\r\n  private\r\n    FEdit: TEdit;\r\n    FTimer: TTimer;\r\n    FItemIndex: Integer;\r\n    FItems: TStringList;\r\n    FKeyboardUsed: Boolean;\r\n    FItemSelector: TListBox;\r\n    FOnItemSelected: TTMSFNCToolBarItemPickerItemSelected;\r\n    FEditable: Boolean;\r\n    FOnEditChange: TNotifyEvent;\r\n    function GetSelectedItemIndex: Integer;\r\n    procedure SetSelectedItemIndex(const Value: Integer);\r\n    function GetSelectedItem: String;\r\n    procedure SetSelectedItem(const Value: String);\r\n    procedure SetItems(const Value: TStringList);\r\n    procedure SetEditable(const Value: Boolean);\r\n  protected\r\n    function CanChangeText: Boolean; override;\r\n    function GetText: String; override;\r\n    procedure EnterTimerChanged(Sender: TObject);\r\n    procedure EditChange(Sender: TObject);\r\n    procedure HandleDialogKey(var Key: Word; Shift: TShiftState); override;\r\n    procedure InitializePopup; override;\r\n    procedure SelectValueWithString(AValue: string); virtual;\r\n    procedure SelectValueWithCharacter(ACharacter: Char); override;\r\n    procedure SelectFirstValue; override;\r\n    procedure SelectLastValue; override;\r\n    procedure SelectNextValue; override;\r\n    procedure SelectPreviousValue; override;\r\n    {$IFDEF FMXLIB}\r\n    procedure ItemKeyUp(Sender: TObject; var Key: Word; var KeyChar: WideChar; Shift: TShiftState);\r\n    procedure ItemKeyDown(Sender: TObject; var Key: Word; var KeyChar: WideChar; Shift: TShiftState);\r\n    procedure ItemSelected(const Sender: TCustomListBox; const Item: TListBoxItem);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure ItemKeyUp(Sender: TObject; var {%H-}Key: Word; {%H-}Shift: TShiftState);\r\n    procedure ItemKeyDown(Sender: TObject; var {%H-}Key: Word; {%H-}Shift: TShiftState);\r\n    procedure ItemSelected(Sender: TObject);\r\n    {$ENDIF}\r\n    procedure DoItemSelected; virtual;\r\n    procedure DoEnter; override;\r\n    property CloseOnSelection;\r\n    property Items: TStringList read FItems write SetItems;\r\n    property OnItemSelected: TTMSFNCToolBarItemPickerItemSelected read FOnItemSelected write FOnItemSelected;\r\n    property ListBox: TListBox read FItemSelector;\r\n    property SelectedItemIndex: Integer read GetSelectedItemIndex write SetSelectedItemIndex default -1;\r\n    property SelectedItem: String read GetSelectedItem write SetSelectedItem;\r\n    property Editable: Boolean read FEditable write SetEditable default False;\r\n    property OnEditChange: TNotifyEvent read FOnEditChange write FOnEditChange;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    destructor Destroy; override;\r\n    procedure DropDown; override;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarItemPicker = class(TTMSFNCToolBarCustomItemPicker)\r\n  published\r\n    property OnItemSelected;\r\n    property SelectedItemIndex;\r\n    property Items;\r\n    property Editable;\r\n    property OnEditChange;\r\n  end;\r\n\r\n  TTMSFNCToolBarFontNamePickerFontNameSelected = procedure(Sender: TObject; AFontName: String) of object;\r\n\r\n  TTMSFNCToolBarItemPickerClass = class of TTMSFNCToolBarItemPicker;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarFontNamePicker = class(TTMSFNCToolBarCustomItemPicker)\r\n  private\r\n    FOnFontNameSelected: TTMSFNCToolBarFontNamePickerFontNameSelected;\r\n    function GetSelectedFontName: String;\r\n    procedure SetSelectedFontName(const Value: String);\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure DoItemSelected; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property SelectedFontName: String read GetSelectedFontName write SetSelectedFontName;\r\n    property SelectedItemIndex;\r\n    property Items;\r\n  published\r\n    property OnFontNameSelected: TTMSFNCToolBarFontNamePickerFontNameSelected read FOnFontNameSelected write FOnFontNameSelected;\r\n    property CloseOnSelection;\r\n    property Editable;\r\n    property OnEditChange;\r\n  end;\r\n\r\n  TTMSFNCToolBarFontSizePickerFontSizeSelected = procedure(Sender: TObject; AFontSize: Single) of object;\r\n\r\n  TTMSFNCToolBarFontNamePickerClass = class of TTMSFNCToolBarFontNamePicker;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarFontSizePicker = class(TTMSFNCToolBarCustomItemPicker)\r\n  private\r\n    FOnFontSizeSelected: TTMSFNCToolBarFontSizePickerFontSizeSelected;\r\n    function GetSelectedFontSize: Single;\r\n    procedure SetSelectedFontSize(const Value: Single);\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure DoItemSelected; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property SelectedFontSize: Single read GetSelectedFontSize write SetSelectedFontSize;\r\n    property SelectedItemIndex;\r\n    property Items;\r\n  published\r\n    property OnFontSizeSelected: TTMSFNCToolBarFontSizePickerFontSizeSelected read FOnFontSizeSelected write FOnFontSizeSelected;\r\n    property CloseOnSelection;\r\n    property Editable;\r\n    property OnEditChange;\r\n  end;\r\n\r\n  TTMSFNCToolBarColorPickerColorSelected = procedure(Sender: TObject; AColor: TTMSFNCGraphicsColor) of object;\r\n\r\n  TTMSFNCToolBarFontSizePickerClass = class of TTMSFNCToolBarFontSizePicker;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarColorPicker = class(TTMSFNCToolBarButton)\r\n  private\r\n    FColorSelector: TTMSFNCColorSelector;\r\n    FOnColorSelected: TTMSFNCToolBarColorPickerColorSelected;\r\n    function GetSelectedColor: TTMSFNCGraphicsColor;\r\n    procedure SetSelectedColor(const Value: TTMSFNCGraphicsColor);\r\n    function GetSelectedItemIndex: Integer;\r\n    procedure SetSelectedItemIndex(const Value: Integer);\r\n    function GetItems: TTMSFNCColorSelectorItems;\r\n    procedure SetItems(const Value: TTMSFNCColorSelectorItems);\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure DrawColor(AColor: TTMSFNCGraphicsColor; ARect: TRectF; AGraphics: TTMSFNCGraphics);\r\n    procedure ColorSelected(Sender: TObject; AColor: TTMSFNCGraphicsColor);\r\n    procedure DoColorSelected(AColor: TTMSFNCGraphicsColor); virtual;\r\n    function CanChangeText: Boolean; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    function BlockChange: Boolean;\r\n    function ColorSelector: TTMSFNCColorSelector;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    procedure DrawSelectedColor(AGraphics: TTMSFNCGraphics; {%H-}ARect: TRectF); virtual;\r\n  published\r\n    property OnColorSelected: TTMSFNCToolBarColorPickerColorSelected read FOnColorSelected write FOnColorSelected;\r\n    property SelectedColor: TTMSFNCGraphicsColor read GetSelectedColor write SetSelectedColor default gcNull;\r\n    property SelectedItemIndex: Integer read GetSelectedItemIndex write SetSelectedItemIndex;\r\n    property Items: TTMSFNCColorSelectorItems read GetItems write SetItems;\r\n    property CloseOnSelection;\r\n  end;\r\n\r\n  TTMSFNCToolBarBitmapPickerBitmapSelected = procedure(Sender: TObject; ABitmap: TTMSFNCBitmap) of object;\r\n\r\n  TTMSFNCToolBarColorPickerClass = class of TTMSFNCToolBarColorPicker;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarBitmapPicker = class(TTMSFNCToolBarButton)\r\n  private\r\n    FBitmapSelector: TTMSFNCBitmapSelector;\r\n    FOnBitmapSelected: TTMSFNCToolBarBitmapPickerBitmapSelected;\r\n    function GetSelectedBitmap: TTMSFNCBitmap;\r\n    function GetSelectedItemIndex: Integer;\r\n    procedure SetSelectedItemIndex(const Value: Integer);\r\n    function GetItems: TTMSFNCBitmapSelectorItems;\r\n    procedure SetItems(const Value: TTMSFNCBitmapSelectorItems);\r\n  protected\r\n    function GetBitmapRect(ARect: TRectF): TRectF; override;\r\n    function CanChangeText: Boolean; override;\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure BitmapSelected(Sender: TObject; ABitmap: TTMSFNCBitmap);\r\n    procedure DoBitmapSelected(ABitmap: TTMSFNCBitmap); virtual;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    function BlockChange: Boolean;\r\n    function BitmapSelector: TTMSFNCBitmapSelector;\r\n    property SelectedBitmap: TTMSFNCBitmap read GetSelectedBitmap;\r\n  published\r\n    property OnBitmapSelected: TTMSFNCToolBarBitmapPickerBitmapSelected read FOnBitmapSelected write FOnBitmapSelected;\r\n    property SelectedItemIndex: Integer read GetSelectedItemIndex write SetSelectedItemIndex;\r\n    property Items: TTMSFNCBitmapSelectorItems read GetItems write SetItems;\r\n    property CloseOnSelection;\r\n  end;\r\n\r\n  TTMSFNCToolBarBitmapPickerClass = class of TTMSFNCToolBarBitmapPicker;\r\n\r\n  TTMSFNCCustomToolBarAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TTMSFNCCustomToolBar;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FVerticalSpacing: Single;\r\n    FHorizontalSpacing: Single;\r\n    FDragGripColor: TTMSFNCGraphicsColor;\r\n    FDragGrip: Boolean;\r\n    FFlatStyle: Boolean;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FSeparatorStroke: TTMSFNCGraphicsStroke;\r\n    FSeparator: Boolean;\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetHorizontalSpacing(const Value: Single);\r\n    procedure SetVerticalSpacing(const Value: Single);\r\n    procedure SetDragGrip(const Value: Boolean);\r\n    procedure SetDragGripColor(const Value: TTMSFNCGraphicsColor);\r\n    function IsHorizontalSpacingStored: Boolean;\r\n    function IsVerticalSpacingStored: Boolean;\r\n    procedure SetFlatStyle(const Value: Boolean);\r\n    procedure SetSeparator(const Value: Boolean);\r\n    procedure SetSeparatorStroke(const Value: TTMSFNCGraphicsStroke);\r\n  protected\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure StrokeChanged(Sender: TObject);\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    property HorizontalSpacing: Single read FHorizontalSpacing write SetHorizontalSpacing stored IsHorizontalSpacingStored nodefault;\r\n    property VerticalSpacing: Single read FVerticalSpacing write SetVerticalSpacing stored IsVerticalSpacingStored nodefault;\r\n    property DragGrip: Boolean read FDragGrip write SetDragGrip default True;\r\n    property DragGripColor: TTMSFNCGraphicsColor read FDragGripColor write SetDragGripColor default gcLightgray;\r\n    property FlatStyle: Boolean read FFlatStyle write SetFlatStyle default False;\r\n    property Separator: Boolean read FSeparator write SetSeparator default False;\r\n    property SeparatorStroke: TTMSFNCGraphicsStroke read FSeparatorStroke write SetSeparatorStroke;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TTMSFNCCustomToolBar);\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TTMSFNCToolBarAppearance = class(TTMSFNCCustomToolBarAppearance)\r\n  published\r\n    property FlatStyle;\r\n    property Fill;\r\n    property Stroke;\r\n    property Separator;\r\n    property SeparatorStroke;\r\n    property HorizontalSpacing;\r\n    property VerticalSpacing;\r\n    property DragGrip;\r\n    property DragGripColor;\r\n  end;\r\n\r\n  TTMSFNCToolBarOptionMenuItem = class(TMenuItem)\r\n  private\r\n    FControl: TControl;\r\n    FGlyphWidth: Single;\r\n    FCalculate: Boolean;\r\n  protected\r\n    property Calculate: Boolean read FCalculate write FCalculate;\r\n    property GlyphWidth: Single read FGlyphWidth write FGlyphWidth;\r\n  public\r\n    property Control: TControl read FControl write FControl;\r\n  end;\r\n\r\n  TTMSFNCToolBarControl = class(TPersistent)\r\n  private\r\n    FControlIndex: Integer;\r\n    FControl: TControl;\r\n    FLayout: TTMSFNCToolBarButtonLayout;\r\n    FBitmap: TTMSFNCBitmap;\r\n  public\r\n    constructor Create;\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TControlClass = class of TControl;\r\n\r\n  TTMSFNCToolBarCustomizeOptionsMenu = procedure(Sender: TObject; APopupMenu: TPopupMenu) of object;\r\n  TTMSFNCToolBarCustomizeOptionsMenuItem = procedure(Sender: TObject; AControl: TControl; AMenuItem: TMenuItem) of object;\r\n  TTMSFNCToolBarCanShowOptionsMenuItem = procedure(Sender: TObject; AControl: TControl; var ACanShowItem: Boolean) of object;\r\n  TTMSFNCToolBarOptionsMenuItemClick = procedure(Sender: TObject; AControl: TControl; AMenuItem: TMenuItem; var AExecuteDefaultAction: Boolean) of object;\r\n  TTMSFNCToolBarIsLastElement = procedure(Sender: TObject; AControl: TControl; var AIsLastElement: Boolean) of object;\r\n\r\n  TTMSFNCCustomToolBarOptionsMenu = class(TPersistent)\r\n  private\r\n    FOwner: TTMSFNCCustomToolBar;\r\n    FShowItemText: Boolean;\r\n    FShowItemBitmap: Boolean;\r\n    FShowButton: Boolean;\r\n    FItemBitmapWidth: Single;\r\n    FAutoItemBitmapWidth: Boolean;\r\n    procedure SetShowButton(const Value: Boolean);\r\n    procedure SetShowItemBitmap(const Value: Boolean);\r\n    procedure SetShowItemText(const Value: Boolean);\r\n    procedure SetAutoItemBitmapWidth(const Value: Boolean);\r\n    procedure SetItemBitmapWidth(const Value: Single);\r\n    function IsItemBitmapWidthStored: Boolean;\r\n  protected\r\n    property ShowButton: Boolean read FShowButton write SetShowButton default True;\r\n    property ShowItemBitmap: Boolean read FShowItemBitmap write SetShowItemBitmap default True;\r\n    property ShowItemText: Boolean read FShowItemText write SetShowItemText default True;\r\n    property AutoItemBitmapWidth: Boolean read FAutoItemBitmapWidth write SetAutoItemBitmapWidth default True;\r\n    property ItemBitmapWidth: Single read FItemBitmapWidth write SetItemBitmapWidth stored IsItemBitmapWidthStored nodefault;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TTMSFNCCustomToolBar);\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TTMSFNCToolBarOptionsMenu = class(TTMSFNCCustomToolBarOptionsMenu)\r\n  published\r\n    property ShowButton;\r\n    property ShowItemBitmap;\r\n    property ShowItemText;\r\n    property AutoItemBitmapWidth;\r\n    property ItemBitmapWidth;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCToolBarControlObjectList = class(TObjectList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCToolBarControl;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCToolBarControl);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCToolBarControl read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCToolBarControlList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCToolBarControl;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCToolBarControl);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCToolBarControl read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCControlList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TControl;\r\n    procedure SetItem(Index: Integer; const Value: TControl);\r\n  public\r\n    property Items[Index: Integer]: TControl read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCToolBarControlObjectList = TObjectList<TTMSFNCToolBarControl>;\r\n  TTMSFNCToolBarControlList = TList<TTMSFNCToolBarControl>;\r\n  TTMSFNCControlList = TList<TControl>;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCToolBarDragGripMovingEvent = procedure(Sender: TObject; DeltaX: Double; DeltaY: Double) of object;\r\n\r\n  TTMSFNCToolBarPopup = class(TTMSFNCNonFocusablePopup)\r\n  public\r\n    property OnClosePopup;\r\n  end;\r\n\r\n  {$IFDEF FNCLIB}\r\n  TTMSFNCCustomToolBar = class(TTMSFNCCustomControl, ITMSFNCBitmapContainer)\r\n  {$ENDIF}\r\n  {$IFNDEF FNCLIB}\r\n  TTMSFNCCustomToolBar = class(TTMSFNCCustomControl)\r\n  {$ENDIF}\r\n  private\r\n    FCompactToolbar: TTMSFNCCustomToolBar;\r\n    FCompactPopup: TTMSFNCToolBarPopup;\r\n    FHover, FHoverP, FQuickMenuButtonHover, FQuickMenuButtonHoverP: Boolean;\r\n    FDown, FQuickMenuButtonDown: Boolean;\r\n    FOldWidth: Single;\r\n    FOldMenuButtonState: Boolean;\r\n    FBitmapContainer: TTMSFNCBitmapContainer;\r\n    FInsideDrag, FDragGripMoving, FDragGripDown: Boolean;\r\n    FDragGripDownPt: TPointF;\r\n    FTotalOptionsMenuWidth: Single;\r\n    {$IFNDEF LCLLIB}\r\n    {$IFNDEF WEBLIB}\r\n    FCompareControls: IComparer<TControl>;\r\n    FCompareHiddenControls: IComparer<TTMSFNCToolBarControl>;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FHiddenControls: TTMSFNCToolBarControlObjectList;\r\n    FCompactControls: TTMSFNCToolBarControlObjectList;\r\n    FBlockUpdate, FBlockResize: Boolean;\r\n    FAutoSize: Boolean;\r\n    FAppearance: TTMSFNCToolBarAppearance;\r\n    FAutoAlign: Boolean;\r\n    FOptionsMenuButton: TTMSFNCToolBarDropDownButton;\r\n    FAutoOptionsMenu: TPopupMenu;\r\n    FOnOptionsMenuCustomize: TTMSFNCToolBarCustomizeOptionsMenu;\r\n    FOnOptionsMenuItemCustomize: TTMSFNCToolBarCustomizeOptionsMenuItem;\r\n    FOnOptionsMenuButtonClick: TNotifyEvent;\r\n    FOptionsMenu: TTMSFNCToolBarOptionsMenu;\r\n    FCustomOptionsMenu: TPopupMenu;\r\n    FOnOptionsMenuItemCanShow: TTMSFNCToolBarCanShowOptionsMenuItem;\r\n    FState: TTMSFNCToolBarElementState;\r\n    FOnOptionsMenuItemClick: TTMSFNCToolBarOptionsMenuItemClick;\r\n    FOnOptionsMenuItemApplyStyle: TTMSFNCToolBarCustomizeOptionsMenuItem;\r\n    FOnUpdateDockPanel: TNotifyEvent;\r\n    FOnUpdateControls: TNotifyEvent;\r\n    FOnIsLastElement: TTMSFNCToolBarIsLastElement;\r\n    FOnDragGripMoving: TTMSFNCToolBarDragGripMovingEvent;\r\n    FAutoMoveToolBar: Boolean;\r\n    FOnInternalDblClick: TNotifyEvent;\r\n    FOnInternalMouseDown: TNotifyEvent;\r\n    FOnInternalMouseMove: TNotifyEvent;\r\n    FOnInternalMouseUp: TNotifyEvent;\r\n    FAutoHeight: Boolean;\r\n    FAutoWidth: Boolean;\r\n    FOnInternalInsertControl: TNotifyEvent;\r\n    FAutoStretchHeight: Boolean;\r\n    FText: string;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTrimming: TTMSFNCGraphicsTextTrimming;\r\n    FHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FWordWrapping: Boolean;\r\n    FTextVisible: Boolean;\r\n    FMinimumWidth: Single;\r\n    FCompact: Boolean;\r\n    FCanCompact: Boolean;\r\n    FCompactWidth: Single;\r\n    FCompactAppearance: TTMSFNCToolBarCompactAppearance;\r\n    FCompactBitmaps: TTMSFNCScaledBitmaps;\r\n    FOnCompactClick: TNotifyEvent;\r\n    FCompactBitmapSize: Single;\r\n    FCompactBitmapVisible: Boolean;\r\n    FCompactExpanderBitmaps: TTMSFNCScaledBitmaps;\r\n    FQuickMenuButton: Boolean;\r\n    FQuickMenuButtonAppearance: TTMSFNCToolBarQuickMenuButtonAppearance;\r\n    FOnQuickMenuButtonClick: TNotifyEvent;\r\n    FQuickMenuButtonBitmaps: TTMSFNCScaledBitmaps;\r\n    FQuickMenuButtonHint: string;\r\n    FCompactAutoBitmapSize: Boolean;\r\n    procedure SetAppearance(const Value: TTMSFNCToolBarAppearance);\r\n    procedure SetAS(const Value: Boolean);\r\n    procedure SetAutoAlign(const Value: Boolean);\r\n    procedure SetOptionsMenu(const Value: TTMSFNCToolBarOptionsMenu);\r\n    procedure SetState(const Value: TTMSFNCToolBarElementState);\r\n    procedure SetAutoHeight(const Value: Boolean);\r\n    procedure SetAutoWidth(const Value: Boolean);\r\n    procedure SetAutoStretchHeight(const Value: Boolean);\r\n    procedure SetText(const Value: string);\r\n    function GetBitmapContainer: TTMSFNCBitmapContainer;\r\n    procedure SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\n    procedure SetFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTrimming(const Value: TTMSFNCGraphicsTextTrimming);\r\n    procedure SetVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetWordWrapping(const Value: Boolean);\r\n    procedure SetTextVisible(const Value: Boolean);\r\n    function IsMinimumWidthStored: Boolean;\r\n    procedure SetMinimumWidth(const Value: Single);\r\n    procedure SetCompact(const Value: Boolean);\r\n    procedure SetCanCompact(const Value: Boolean);\r\n    function IsCompactWidthStored: Boolean;\r\n    procedure SetCompactWidth(const Value: Single);\r\n    procedure SetCompactAppearance(const Value: TTMSFNCToolBarCompactAppearance);\r\n    procedure SetCompactBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    function IsCompactBitmapSizeStored: Boolean;\r\n    procedure SetCompactBitmapSize(const Value: Single);\r\n    procedure SetCompactBitmapVisible(const Value: Boolean);\r\n    procedure SetCompactExpanderBitmaps(const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetQuickMenuButton(const Value: Boolean);\r\n    procedure SetQuickMenuButtonAppearance(\r\n      const Value: TTMSFNCToolBarQuickMenuButtonAppearance);\r\n    procedure SetQuickMenuButtonBitmaps(\r\n      const Value: TTMSFNCScaledBitmaps);\r\n    procedure SetCompactAutoBitmapSize(const Value: Boolean);\r\n  protected\r\n    function GetVersion: String; override;\r\n    function CanDrawDesignTime: Boolean; virtual;\r\n    function CanBuildControls: Boolean; virtual;\r\n    function GetOptionsMenuButtonClass: TTMSFNCToolBarDropDownButtonClass; virtual;\r\n    function GetBitmapPickerClass: TTMSFNCToolBarBitmapPickerClass; virtual;\r\n    function GetToolBarButtonClass: TTMSFNCToolBarButtonClass; virtual;\r\n    function GetColorPickerClass: TTMSFNCToolBarColorPickerClass; virtual;\r\n    function GetItemPickerClass: TTMSFNCToolBarItemPickerClass; virtual;\r\n    function GetFontNamePickerClass: TTMSFNCToolBarFontNamePickerClass; virtual;\r\n    function GetFontSizePickerClass: TTMSFNCToolBarFontSizePickerClass; virtual;\r\n    function GetToolBarSeparatorClass: TTMSFNCToolBarSeparatorClass; virtual;\r\n    function GetTextSize: TSizeF; virtual;\r\n    function GetHiddenControl(AControl: TControl): TTMSFNCToolBarControl; virtual;\r\n    function GetCompactControl(AControl: TControl): TTMSFNCToolBarControl; virtual;\r\n    function GetHiddenControlCount(AControl: TControl): Integer; virtual;\r\n    function GetCompactControlCount: Integer; virtual;\r\n    function GetCompactTextRect: TRectF; virtual;\r\n    function GetCompactBitmapRect(ARect: TRectF): TRectF; virtual;\r\n    function GetCompactBitmapSize: Single; virtual;\r\n    function GetQuickMenuButtonRect: TRectF; virtual;\r\n    function HasHint: Boolean; override;\r\n    function GetHintString: String; override;\r\n    procedure ChangeDPIScale(M, D: Integer); override;\r\n    procedure HandleQuickMenuButton; virtual;\r\n    procedure CompactAppearanceChanged(Sender: TObject);\r\n    procedure QuickMenuButtonAppearanceChanged(Sender: TObject);\r\n    procedure CompactBitmapsChanged(Sender: TObject);\r\n    procedure CompactExpanderBitmapsChanged(Sender: TObject);\r\n    procedure QuickMenuButtonBitmapsChanged(Sender: TObject);    \r\n    procedure ApplyFlatStyle; virtual;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure ApplyStyle; override;\r\n    procedure ResetToDefaultStyle; override;\r\n    procedure HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseMove(Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseLeave; override;\r\n    procedure HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleCompact; virtual;\r\n    procedure DeactivateAllPopups; virtual;\r\n    procedure DoCompactClick; virtual;\r\n    procedure HandleDblClick({%H-}X, {%H-}Y: Single); override;\r\n    procedure UpdateDockPanel; virtual;\r\n    procedure InsertToolBarControl(AControl: TControl; {%H-}AIndex: Integer);\r\n    procedure DoDragGripMoving(ADeltaX, ADeltaY: Double); virtual;\r\n    {$IFDEF FMXLIB}\r\n    procedure SetVisible(const Value: Boolean); override;\r\n    procedure DoMatrixChanged(Sender: TObject); override;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure VisibleChanging; override;\r\n    {$ENDIF}\r\n    function GetDragGripRect(AInteraction: Boolean = False): TRectF;\r\n    procedure CompactControls; virtual;\r\n    procedure UncompactControls; virtual;\r\n    procedure DoCustomizeOptionsMenu; virtual;\r\n    procedure DoCustomizeOptionsMenuItem(AControl: TControl; AMenuItem: TMenuItem); virtual;\r\n    procedure DoCanShowOptionsMenuItem(AControl: TControl; var ACanShowItem: Boolean); virtual;\r\n    procedure UpdateToolBar(Sender: TObject);\r\n    procedure DoIsLastElement(AControl: TControl; var ALastElement: Boolean);\r\n    procedure UpdateToolBarControl(Sender: TObject);\r\n    procedure OptionMenuItemClick(Sender: TObject);\r\n    {$IFDEF FMXLIB}\r\n    procedure OptionMenuItemApplyStyleLookup(Sender: TObject);\r\n    {$ENDIF}\r\n    procedure OptionsButtonClick(Sender: TObject);\r\n    procedure DoCloseCompactPopup(Sender: TObject);\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n\r\n    {$IFDEF FMXLIB}\r\n    procedure DoRealign; override;\r\n    procedure DoAddObject(const AObject: TFmxObject); override;\r\n    procedure DoInsertObject(Index: Integer; const AObject: TFmxObject); override;\r\n    procedure DoRemoveObject(const AObject: TFmxObject); override;\r\n    {$ENDIF}\r\n\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure AlignControls(AControl: TControl; var Rect: TRect); override;\r\n    {$ENDIF}\r\n    procedure UpdateControlAfterResize; override;\r\n    procedure UpdateControls; virtual;\r\n    procedure InitializeOptionsMenu; virtual;\r\n    procedure DrawDragGrip(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawText(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawCompactBitmap(AGraphics: TTMSFNCGraphics; ARect: TRectF); virtual;\r\n    procedure DrawCompactText(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawCompactExpander(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure ShowOptionsMenu(X, Y: Single); virtual;\r\n    property BlockUpdate: Boolean read FBlockUpdate write FBlockUpdate;\r\n    property OnCompactClick: TNotifyEvent read FOnCompactClick write FOnCompactClick;\r\n    property OnUpdateControls: TNotifyEvent read FOnUpdateControls write FOnUpdateControls;\r\n    property OnUpdateDockPanel: TNotifyEvent read FOnUpdateDockPanel write FOnUpdateDockPanel;\r\n    property OnInternalMouseDown: TNotifyEvent read FOnInternalMouseDown write FOnInternalMouseDown;\r\n    property OnInternalInsertControl: TNotifyEvent read FOnInternalInsertControl write FOnInternalInsertControl;\r\n    property OnInternalMouseUp: TNotifyEvent read FOnInternalMouseUp write FOnInternalMouseUp;\r\n    property OnInternalMouseMove: TNotifyEvent read FOnInternalMouseMove write FOnInternalMouseMove;\r\n    property OnInternalDblClick: TNotifyEvent read FOnInternalDblClick write FOnInternalDblClick;\r\n    property Version: String read GetVersion;\r\n    property AutoSize: Boolean read FAutoSize write SetAS default True;\r\n    property AutoHeight: Boolean read FAutoHeight write SetAutoHeight default True;\r\n    property AutoWidth: Boolean read FAutoWidth write SetAutoWidth default True;\r\n    property AutoAlign: Boolean read FAutoAlign write SetAutoAlign default True;\r\n    property AutoStretchHeight: Boolean read FAutoStretchHeight write SetAutoStretchHeight default False;\r\n    property AutoMoveToolBar: Boolean read FAutoMoveToolBar write FAutoMoveToolBar default True;\r\n    property Appearance: TTMSFNCToolBarAppearance read FAppearance write SetAppearance;\r\n    property WordWrapping: Boolean read FWordWrapping write SetWordWrapping default False;\r\n    property Text: string read FText write SetText;\r\n    property TextVisible: Boolean read FTextVisible write SetTextVisible default True;\r\n    property Trimming: TTMSFNCGraphicsTextTrimming read FTrimming write SetTrimming default gttCharacter;\r\n    property HorizontalTextAlign: TTMSFNCGraphicsTextAlign read FHorizontalTextAlign write SetHorizontalTextAlign default gtaCenter;\r\n    property VerticalTextAlign: TTMSFNCGraphicsTextAlign read FVerticalTextAlign write SetVerticalTextAlign default gtaCenter;\r\n    property Font: TTMSFNCGraphicsFont read FFont write SetFont;\r\n    property OptionsMenu: TTMSFNCToolBarOptionsMenu read FOptionsMenu write SetOptionsMenu;\r\n    property OnOptionsMenuItemCanShow: TTMSFNCToolBarCanShowOptionsMenuItem read FOnOptionsMenuItemCanShow write FOnOptionsMenuItemCanShow;\r\n    property OnOptionsMenuCustomize: TTMSFNCToolBarCustomizeOptionsMenu read FOnOptionsMenuCustomize write FOnOptionsMenuCustomize;\r\n    property OnOptionsMenuItemCustomize: TTMSFNCToolBarCustomizeOptionsMenuItem read FOnOptionsMenuItemCustomize write FOnOptionsMenuItemCustomize;\r\n    property OnOptionsMenuItemApplyStyle: TTMSFNCToolBarCustomizeOptionsMenuItem read FOnOptionsMenuItemApplyStyle write FOnOptionsMenuItemApplyStyle;\r\n    property OnOptionsMenuButtonClick: TNotifyEvent read FOnOptionsMenuButtonClick write FOnOptionsMenuButtonClick;\r\n    property OnOptionsMenuItemClick: TTMSFNCToolBarOptionsMenuItemClick read FOnOptionsMenuItemClick write FOnOptionsMenuItemClick;\r\n    property CustomOptionsMenu: TPopupMenu read FCustomOptionsMenu write FCustomOptionsMenu;\r\n    property State: TTMSFNCToolBarElementState read FState write SetState default esNormal;\r\n    property OnIsLastElement: TTMSFNCToolBarIsLastElement read FOnIsLastElement write FOnIsLastElement;\r\n    property OnDragGripMoving: TTMSFNCToolBarDragGripMovingEvent read FOnDragGripMoving write FOnDragGripMoving;\r\n    property AutoOptionsMenu: TPopupMenu read FAutoOptionsMenu;\r\n    property BitmapContainer: TTMSFNCBitmapContainer read GetBitmapContainer write SetBitmapContainer;\r\n    property MinimumWidth: Single read FMinimumWidth write SetMinimumWidth stored IsMinimumWidthStored nodefault;\r\n    property CompactBitmapVisible: Boolean read FCompactBitmapVisible write SetCompactBitmapVisible default False;\r\n    property CompactAutoBitmapSize: Boolean read FCompactAutoBitmapSize write SetCompactAutoBitmapSize default False;\r\n    property CompactBitmaps: TTMSFNCScaledBitmaps read FCompactBitmaps write SetCompactBitmaps;\r\n    property Compact: Boolean read FCompact write SetCompact default False;\r\n    property QuickMenuButton: Boolean read FQuickMenuButton write SetQuickMenuButton default False;\r\n    property QuickMenuButtonHint: string read FQuickMenuButtonHint write FQuickMenuButtonHint;\r\n    property CompactWidth: Single read FCompactWidth write SetCompactWidth stored IsCompactWidthStored nodefault;\r\n    property CanCompact: Boolean read FCanCompact write SetCanCompact default True;\r\n    property CompactAppearance: TTMSFNCToolBarCompactAppearance read FCompactAppearance write SetCompactAppearance;\r\n    property QuickMenuButtonAppearance: TTMSFNCToolBarQuickMenuButtonAppearance read FQuickMenuButtonAppearance write SetQuickMenuButtonAppearance;\r\n    property CompactBitmapSize: Single read FCompactBitmapSize write SetCompactBitmapSize stored IsCompactBitmapSizeStored nodefault;\r\n    property CompactExpanderBitmaps: TTMSFNCScaledBitmaps read FCompactExpanderBitmaps write SetCompactExpanderBitmaps;\r\n    property QuickMenuButtonBitmaps: TTMSFNCScaledBitmaps read FQuickMenuButtonBitmaps write SetQuickMenuButtonBitmaps;    \r\n    property OnQuickMenuButtonClick: TNotifyEvent read FOnQuickMenuButtonClick write FOnQuickMenuButtonClick;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    function CanExpand: Boolean; virtual;\r\n    function CanShrink: Boolean; virtual;\r\n    function DropDownActive: Boolean; virtual;\r\n    procedure CloseCompactPopup; virtual;\r\n    procedure AddCustomControl(AControl: TControl; AIndex: Integer = -1); virtual;\r\n    function AddCustomControlClass(AControlClass: TControlClass; AIndex: Integer = -1): TControl; virtual;\r\n    function AddButton(AWidth: Single = -1; AHeight: Single = -1; AResource: String = ''; AResourceLarge: String = ''; AText: String = '';\r\n      AIndex: Integer = -1): TTMSFNCToolBarButton; overload; virtual;\r\n    function AddSeparator(AIndex: Integer = -1): TTMSFNCToolBarSeparator; virtual;\r\n    function AddFontNamePicker(AIndex: Integer = -1): TTMSFNCToolBarFontNamePicker; virtual;\r\n    function AddFontSizePicker(AIndex: Integer = -1): TTMSFNCToolBarFontSizePicker; virtual;\r\n    function AddColorPicker(AIndex: Integer = -1): TTMSFNCToolBarColorPicker; virtual;\r\n    function AddItemPicker(AIndex: Integer = -1): TTMSFNCToolBarItemPicker; virtual;\r\n    function AddBitmapPicker(AIndex: Integer = -1): TTMSFNCToolBarBitmapPicker; virtual;\r\n    function GetOptionsMenuButtonControl: TTMSFNCToolBarDropDownButton; virtual;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBar = class(TTMSFNCCustomToolBar)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  published\r\n    property OnOptionsMenuButtonClick;\r\n    property OnOptionsMenuItemCanShow;\r\n    property OnOptionsMenuCustomize;\r\n    property OnOptionsMenuItemCustomize;\r\n    property OnOptionsMenuItemApplyStyle;\r\n    property OnOptionsMenuItemClick;\r\n    property OnIsLastElement;\r\n    property OnDragGripMoving;\r\n    property OnQuickMenuButtonClick;\r\n    //\r\n    property Version;\r\n    property AutoHeight;\r\n    property AutoWidth;\r\n    property AutoSize;\r\n    property AutoAlign;\r\n    property AutoStretchHeight;\r\n    property AutoMoveToolBar;\r\n    property Appearance;\r\n    property CanCompact;\r\n    property OnCompactClick;\r\n    property CompactBitmapVisible;\r\n    property CompactBitmaps;\r\n    property Compact;\r\n    property CompactWidth;\r\n    property CompactAppearance;\r\n    property CompactBitmapSize;\r\n    property CompactAutoBitmapSize;\r\n    property QuickMenuButtonHint;\r\n    property QuickMenuButton;\r\n    property QuickMenuButtonAppearance;\r\n    property MinimumWidth;\r\n    property WordWrapping;\r\n    property Text;\r\n    property Trimming;\r\n    property HorizontalTextAlign;\r\n    property VerticalTextAlign;\r\n    property Font;\r\n    property OptionsMenu;\r\n    property CustomOptionsMenu;\r\n    property State;\r\n  end;\r\n\r\n  TTMSFNCCustomDockPanelAppearance = class(TPersistent)\r\n  private\r\n    FOwner: TTMSFNCCustomDockPanel;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FMargins: TTMSFNCMargins;\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetMargins(const Value: TTMSFNCMargins);\r\n  protected\r\n    procedure FillChanged(Sender: TObject);\r\n    procedure StrokeChanged(Sender: TObject);\r\n    procedure MarginsChanged(Sender: TObject);\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    property Margins: TTMSFNCMargins read FMargins write SetMargins;\r\n  public\r\n    constructor Create(AOwner: TTMSFNCCustomDockPanel);\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  TTMSFNCDockPanelAppearance = class(TTMSFNCCustomDockPanelAppearance)\r\n  published\r\n    property Fill;\r\n    property Stroke;\r\n  end;\r\n\r\n  TTMSFNCCustomDockPanel = class(TTMSFNCCustomControl)\r\n  private\r\n    FBlockUpdate: Boolean;\r\n    FAppearance: TTMSFNCDockPanelAppearance;\r\n    FAutoSize: Boolean;\r\n    FAutoAlign: Boolean;\r\n    FState: TTMSFNCToolBarElementState;\r\n    procedure SetAppearance(const Value: TTMSFNCDockPanelAppearance);\r\n    procedure SetAutoAlign(const Value: Boolean);\r\n    procedure SetAS(const Value: Boolean);\r\n    procedure SetState(const Value: TTMSFNCToolBarElementState);\r\n  protected\r\n    function GetVersion: String; override;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure UpdateControls; virtual;\r\n    procedure InitializeControls; virtual;\r\n    procedure RearrangeControls; virtual;\r\n    procedure UpdateDockPanel(Sender: TObject);\r\n    procedure ApplyStyle; override;\r\n    procedure ResetToDefaultStyle; override;\r\n\r\n    {$IFDEF FMXLIB}\r\n    procedure DoRealign; override;\r\n    procedure DoAddObject(const AObject: TFmxObject); override;\r\n    procedure DoInsertObject(Index: Integer; const AObject: TFmxObject); override;\r\n    procedure DoRemoveObject(const AObject: TFmxObject); override;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    procedure AlignControls(AControl: TControl; var Rect: TRect); override;\r\n    {$ENDIF}\r\n\r\n    property Version: String read GetVersion;\r\n    property Appearance: TTMSFNCDockPanelAppearance read FAppearance write SetAppearance;\r\n    property AutoSize: Boolean read FAutoSize write SetAS default True;\r\n    property AutoAlign: Boolean read FAutoAlign write SetAutoAlign default True;\r\n    property State: TTMSFNCToolBarElementState read FState write SetState default esNormal;\r\n  public\r\n    procedure Assign(Source: TPersistent); override;\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    function AddToolBar({%H-}AIndex: Integer = -1): TTMSFNCToolBar;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCDockPanel = class(TTMSFNCCustomDockPanel)\r\n  published\r\n    property Version;\r\n    property Appearance;\r\n    property AutoSize;\r\n    property AutoAlign;\r\n    property State;\r\n  end;\r\n\r\n  {$IFDEF CMNLIB}\r\n  TTMSFNCToolBarParent = TWinControl;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCToolBarParent = TControl;\r\n  {$ENDIF}\r\n\r\nimplementation\r\n\r\nuses\r\n  Math, SysUtils, WEBLib.TMSFNCUtils, WEBLib.Graphics, {%H-}StrUtils, WEBLib.TMSFNCStyles;\r\n\r\nfunction TTMSFNCCustomToolBar.AddBitmapPicker(\r\n  AIndex: Integer): TTMSFNCToolBarBitmapPicker;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetBitmapPickerClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddButton(AWidth: Single = -1; AHeight: Single = -1;\r\n  AResource: String = ''; AResourceLarge: String = ''; AText: String = ''; AIndex: Integer = -1): TTMSFNCToolBarButton;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetToolBarButtonClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  Result.Text := AText;\r\n  if AWidth <> -1 then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    Result.Width := AWidth;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    Result.Width := Round(AWidth);\r\n    {$ENDIF}\r\n  end;\r\n\r\n  if AHeight <> -1 then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    Result.Height := AHeight;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    Result.Height := Round(AHeight);\r\n    {$ENDIF}\r\n  end;\r\n\r\n  if AResource <> '' then\r\n  begin\r\n    Result.Bitmaps.AddBitmapFromResource(AResource, HInstance, 1.0);\r\n    Result.DisabledBitmaps.AddBitmapFromResource(AResource, HInstance, 1.0);\r\n    Result.HoverBitmaps.AddBitmapFromResource(AResource, HInstance, 1.0);\r\n  end;\r\n\r\n  if AResourceLarge <> '' then\r\n  begin\r\n    Result.Bitmaps.AddBitmapFromResource(AResourceLarge, HInstance, 1.5);\r\n    Result.DisabledBitmaps.AddBitmapFromResource(AResourceLarge, HInstance, 1.5);\r\n    Result.HoverBitmaps.AddBitmapFromResource(AResourceLarge, HInstance, 1.5);\r\n  end;\r\n\r\n  InsertToolBarControl(Result, AIndex);\r\n\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddColorPicker(\r\n  AIndex: Integer): TTMSFNCToolBarColorPicker;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetColorPickerClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.AddCustomControl(AControl: TControl; AIndex: Integer = -1);\r\nbegin\r\n  FBlockUpdate := True;\r\n  InsertToolBarControl(AControl, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddCustomControlClass(AControlClass: TControlClass;\r\n  AIndex: Integer = -1): TControl;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := AControlClass.Create(Self);\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddFontNamePicker(\r\n  AIndex: Integer): TTMSFNCToolBarFontNamePicker;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetFontNamePickerClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddFontSizePicker(\r\n  AIndex: Integer): TTMSFNCToolBarFontSizePicker;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetFontSizePickerClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddItemPicker(\r\n  AIndex: Integer): TTMSFNCToolBarItemPicker;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetItemPickerClass.Create(Self);\r\n  Result.Appearance.FlatStyle := Appearance.FlatStyle;\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.AddSeparator(AIndex: Integer = -1): TTMSFNCToolBarSeparator;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := GetToolBarSeparatorClass.Create(Self);\r\n  InsertToolBarControl(Result, AIndex);\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.ApplyFlatStyle;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if c is TTMSFNCDefaultToolBarButton then\r\n      (c as TTMSFNCDefaultToolBarButton).Appearance.FlatStyle := Appearance.FlatStyle;\r\n\r\n    if c is TTMSFNCCustomToolBar then\r\n      (c as TTMSFNCCustomToolBar).Appearance.FlatStyle := Appearance.FlatStyle;\r\n  end;\r\n\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.ApplyStyle;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleHeaderFillColor(c) then\r\n  begin\r\n    Appearance.Fill.Kind := gfkSolid;\r\n    Appearance.Fill.Color := c;\r\n  end;\r\n\r\n  if TTMSFNCStyles.GetStyleHeaderFillColorTo(c) then\r\n  begin\r\n    Appearance.Fill.Kind := gfkGradient;\r\n    Appearance.Fill.ColorTo := c;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.Assign(Source: TPersistent);\r\nvar\r\n  c, cc: TControl;\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomToolBar then\r\n  begin\r\n    FCompactAppearance.Assign((Source as TTMSFNCCustomToolBar).CompactAppearance);\r\n    FQuickMenuButtonAppearance.Assign((Source as TTMSFNCCustomToolBar).QuickMenuButtonAppearance);\r\n    FQuickMenuButton := (Source as TTMSFNCCustomToolBar).QuickMenuButton;\r\n    FCompactBitmaps.Assign((Source as TTMSFNCCustomToolBar).CompactBitmaps);\r\n    FCompact := (Source as TTMSFNCCustomToolBar).Compact;\r\n    FCanCompact := (Source as TTMSFNCCustomToolBar).CanCompact;\r\n    FMinimumWidth := (Source as TTMSFNCCustomToolBar).MinimumWidth;\r\n    FCompactWidth := (Source as TTMSFNCCustomToolBar).CompactWidth;\r\n    FCompactBitmapSize := (Source as TTMSFNCCustomToolBar).CompactBitmapSize;\r\n    FCompactAutoBitmapSize := (Source as TTMSFNCCustomToolBar).CompactAutoBitmapSize;\r\n    FCompactExpanderBitmaps.Assign((Source as TTMSFNCCustomToolBar).CompactExpanderBitmaps);\r\n    FQuickMenuButtonBitmaps.Assign((Source as TTMSFNCCustomToolBar).QuickMenuButtonBitmaps);    \r\n    FCompactBitmapVisible := (Source as TTMSFNCCustomToolBar).CompactBitmapVisible;\r\n    FText := (Source as TTMSFNCCustomToolBar).Text;\r\n    FTextVisible := (Source as TTMSFNCCustomToolBar).TextVisible;\r\n    FWordWrapping := (Source as TTMSFNCCustomToolBar).WordWrapping;\r\n    FHorizontalTextAlign := (Source as TTMSFNCCustomToolBar).HorizontalTextAlign;\r\n    FVerticalTextAlign := (Source as TTMSFNCCustomToolBar).VerticalTextAlign;\r\n    FTrimming := (Source as TTMSFNCCustomToolBar).Trimming;\r\n    FFont.Assign((Source as TTMSFNCCustomToolBar).Font);\r\n    FAutoSize := (Source as TTMSFNCCustomToolBar).AutoSize;\r\n    FAutoHeight := (Source as TTMSFNCCustomToolBar).AutoHeight;\r\n    FAutoWidth := (Source as TTMSFNCCustomToolBar).AutoWidth;\r\n    FAutoAlign := (Source as TTMSFNCCustomToolBar).AutoAlign;\r\n    FAutoStretchHeight := (Source as TTMSFNCCustomToolBar).AutoStretchHeight;\r\n    FAutoMoveToolBar := (Source as TTMSFNCCustomToolBar).AutoMoveToolBar;\r\n    FAppearance.Assign((Source as TTMSFNCCustomToolBar).Appearance);\r\n    for I := 0 to (Source as TTMSFNCCustomToolBar).ControlCount - 1 do\r\n    begin\r\n      cc := (Source as TTMSFNCCustomToolBar).Controls[I];\r\n      if ((cc is TTMSFNCDefaultToolBarButton) and (cc as TTMSFNCDefaultToolBarButton).CanCopy) or not ((cc is TTMSFNCDefaultToolBarButton) and (cc is TControl)) then\r\n      begin\r\n        if cc is TTMSFNCDefaultToolBarButton then\r\n          (cc as TTMSFNCDefaultToolBarButton).ApplyName := False;\r\n\r\n        c := (TTMSFNCUtils.Clone(cc) as TControl);\r\n        if cc is TTMSFNCDefaultToolBarButton then\r\n          (cc as TTMSFNCDefaultToolBarButton).ApplyName := True;\r\n\r\n        AddCustomControl(c);\r\n      end;\r\n    end;\r\n    Invalidate;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.ChangeDPIScale(M, D: Integer);\r\nbegin\r\n  inherited;\r\n  Font.Height := TTMSFNCUtils.MulDivInt(Font.Height, M, D);\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.CanShrink: Boolean;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\n  btn: TTMSFNCDefaultToolBarButton;\r\nbegin\r\n  Result := False;\r\n\r\n  if not Compact and CanCompact then\r\n  begin\r\n    Result := True;\r\n    Exit;\r\n  end;\r\n\r\n  for I := Self.ControlCount - 1 downto 0 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if c <> FOptionsMenuButton then\r\n    begin\r\n      if c is TTMSFNCDefaultToolBarButton then\r\n      begin\r\n        btn := c as TTMSFNCDefaultToolBarButton;\r\n        if (Integer(btn.Layout) > Integer(btn.MinimumLayout)) and (btn.Layout <> bblNone) then\r\n        begin\r\n          Result := True;\r\n          Break;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.CloseCompactPopup;\r\nbegin\r\n  if Assigned(FCompactPopup) then\r\n    FCompactPopup.Deactivate;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.CanBuildControls: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.CanDrawDesignTime: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.CanExpand: Boolean;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\n  btn: TTMSFNCDefaultToolBarButton;\r\nbegin\r\n  Result := False;\r\n\r\n  if Compact then\r\n  begin\r\n    Result := True;\r\n    Exit;\r\n  end;\r\n\r\n  for I := Self.ControlCount - 1 downto 0 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if c <> FOptionsMenuButton then\r\n    begin\r\n      if c is TTMSFNCDefaultToolBarButton then\r\n      begin\r\n        btn := c as TTMSFNCDefaultToolBarButton;\r\n        if (Integer(btn.Layout) < Integer(btn.MaximumLayout)) and (btn.Layout <> bblNone) then\r\n        begin\r\n          Result := True;\r\n          Break;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.CompactAppearanceChanged(Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.CompactBitmapsChanged(Sender: TObject);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  bmp := TTMSFNCGraphics.GetScaledBitmap(CompactBitmaps, 0, BitmapContainer);\r\n  CompactBitmapVisible := Assigned(bmp) and not IsBitmapEmpty(bmp);\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.CompactControls;\r\nvar\r\n  I: Integer;\r\n  cc: TTMSFNCToolBarControl;\r\n  c: TControl;\r\nbegin\r\n  FBlockUpdate := True;\r\n  FCompactControls.Clear;\r\n  for I := Self.ControlCount - 1 downto 0 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if c <> FOptionsMenuButton then\r\n    begin\r\n      cc := TTMSFNCToolBarControl.Create;\r\n      cc.FControl := c;\r\n      if c is TTMSFNCDefaultToolBarButton then\r\n      begin\r\n        cc.FLayout := (c as TTMSFNCDefaultToolBarButton).Layout;\r\n        if ((c as TTMSFNCDefaultToolBarButton).CompactLayout = bblNone) and ((c as TTMSFNCDefaultToolBarButton).Layout <> bblNone) then\r\n          (c as TTMSFNCDefaultToolBarButton).CompactLayout := (c as TTMSFNCDefaultToolBarButton).MaximumLayout;\r\n      end;\r\n\r\n      if c is TTMSFNCCustomToolBarElement then\r\n        cc.FControlIndex := (c as TTMSFNCCustomToolBarElement).ControlIndex\r\n      else\r\n        cc.FControlIndex := c.Tag;\r\n\r\n      c.Parent := nil;\r\n      c.Visible := False;\r\n      FCompactControls.Add(cc);\r\n    end;\r\n  end;\r\n  FBlockUpdate := True;\r\n  UpdateControls;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.CompactExpanderBitmapsChanged(Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBar.Create(AOwner: TComponent);\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  FHiddenControls := TTMSFNCToolBarControlObjectList.Create;\r\n  FCompactControls := TTMSFNCToolBarControlObjectList.Create;\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  FCompareControls := TDelegatedComparer<TControl>.Create(\r\n    function(const Item1, Item2: TControl): Integer\r\n    var\r\n      c1, c2: Integer;\r\n    begin\r\n      if Item1 is TTMSFNCCustomToolBarElement then\r\n        c1 := (Item1 as TTMSFNCCustomToolBarElement).ControlIndex\r\n      else\r\n        c1 := Item1.Tag;\r\n\r\n      if Item2 is TTMSFNCCustomToolBarElement then\r\n        c2 := (Item2 as TTMSFNCCustomToolBarElement).ControlIndex\r\n      else\r\n        c2 := Item2.Tag;\r\n\r\n      Result := CompareValue(c1, c2);\r\n    end);\r\n  FCompareHiddenControls := TDelegatedComparer<TTMSFNCToolBarControl>.Create(\r\n    function(const Item1, Item2: TTMSFNCToolBarControl): Integer\r\n    begin\r\n      Result := CompareValue(Item1.FControlIndex, Item2.FControlIndex);\r\n    end);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  FState := esNormal;\r\n  FAppearance := TTMSFNCToolBarAppearance.Create(Self);\r\n  FCompactAppearance := TTMSFNCToolBarCompactAppearance.Create(nil);\r\n  FCompactAppearance.OnChange := @CompactAppearanceChanged;\r\n  FQuickMenuButtonAppearance := TTMSFNCToolBarQuickMenuButtonAppearance.Create(nil);\r\n  FQuickMenuButtonAppearance.OnChange := @QuickMenuButtonAppearanceChanged;\r\n  FCompactBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FCompactBitmaps.OnChange := @CompactBitmapsChanged;\r\n  FOptionsMenu := TTMSFNCToolBarOptionsMenu.Create(Self);\r\n  FMinimumWidth := 30;\r\n  FCompactWidth := 50;\r\n  FCompactBitmapSize := 24;\r\n  FCompactAutoBitmapSize := False;\r\n  FCompactBitmapVisible := False;\r\n  FCompactExpanderBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FCompactExpanderBitmaps.OnChange := @CompactExpanderBitmapsChanged;\r\n  FQuickMenuButtonBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FQuickMenuButtonBitmaps.OnChange := @QuickMenuButtonBitmapsChanged;  \r\n  FCanCompact := True;\r\n  FQuickMenuButton := False;\r\n  FCompact := False;\r\n  FAutoSize := True;\r\n  FAutoWidth := True;\r\n  FAutoHeight := True;\r\n  FAutoAlign := True;\r\n  FAutoStretchHeight := False;\r\n  FAutoMoveToolBar := True;\r\n  FOptionsMenuButton := GetOptionsMenuButtonClass.Create(Self);\r\n  FOptionsMenuButton.Appearance.NormalFill.Kind := gfkSolid;\r\n  c := gcLightgray;\r\n  FOptionsMenuButton.Appearance.NormalFill.Color := c;\r\n  FOptionsMenuButton.Appearance.ShowInnerStroke := False;\r\n  FOptionsMenuButton.Appearance.Rounding := 0;\r\n\r\n  FOptionsMenuButton.Appearance.HoverFill.Assign(FOptionsMenuButton.Appearance.NormalFill);\r\n  FOptionsMenuButton.Appearance.DisabledFill.Assign(FOptionsMenuButton.Appearance.NormalFill);\r\n  FOptionsMenuButton.Appearance.DownFill.Assign(FOptionsMenuButton.Appearance.NormalFill);\r\n\r\n  FOptionsMenuButton.Appearance.HoverFill.Color := gcLightblue;\r\n  FOptionsMenuButton.Appearance.DownFill.Color := gcLightsteelblue;\r\n  FOptionsMenuButton.Appearance.DisabledFill.Color := gcLightgray;\r\n\r\n  {$IFDEF VCLWEBLIB}\r\n  FOptionsMenuButton.AlignWithMargins := True;\r\n  {$ENDIF}\r\n  \r\n  {$IFNDEF LCLLIB}\r\n  FOptionsMenuButton.Margins.Top := 3;\r\n  FOptionsMenuButton.Margins.Bottom := 3;\r\n  FOptionsMenuButton.Margins.Right := 3;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  FOptionsMenuButton.BorderSpacing.Top := 3;\r\n  FOptionsMenuButton.BorderSpacing.Bottom := 3;\r\n  FOptionsMenuButton.BorderSpacing.Right := 3;\r\n  {$ENDIF}\r\n\r\n  FOptionsMenuButton.CanCopy := False;\r\n  FAutoOptionsMenu := TPopupMenu.Create(Self);\r\n  {$IFDEF FMXLIB}\r\n  FAutoOptionsMenu.Parent := Self;\r\n  FAutoOptionsMenu.Stored := False;\r\n  {$ENDIF}\r\n  FOptionsMenuButton.OnClick := OptionsButtonClick;\r\n  FOptionsMenuButton.Width := 17;\r\n  FOptionsMenuButton.Text := '';\r\n  FOptionsMenuButton.Stored := False;\r\n\r\n  FOptionsMenuButton.Bitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENU, HInstance, 1.0);\r\n  FOptionsMenuButton.Bitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENULARGE, HInstance, 1.5);\r\n  FOptionsMenuButton.DisabledBitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENU, HInstance, 1.0);\r\n  FOptionsMenuButton.DisabledBitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENULARGE, HInstance,1.5);\r\n  FOptionsMenuButton.HoverBitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENU, HInstance, 1.0);\r\n  FOptionsMenuButton.HoverBitmaps.AddBitmapFromResource(TMSFNCTOOLBAROPTIONSMENULARGE, HInstance,1.5);\r\n\r\n  FHorizontalTextAlign := gtaCenter;\r\n  FVerticalTextAlign := gtaCenter;\r\n  FTrimming := gttCharacter;\r\n  FWordWrapping := False;\r\n  FTextVisible := True;\r\n\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n\r\n  FCompactPopup := TTMSFNCToolBarPopup.Create(Self);\r\n  FCompactPopup.OnClosePopup := DoCloseCompactPopup;\r\n  FCompactPopup.PlacementControl := Self;\r\n\r\n  FCompactExpanderBitmaps.AddBitmapFromResource(TMSFNCGRAPHICSDOWN, HInstance, 1.0);\r\n  FQuickMenuButtonBitmaps.AddBitmapFromResource(TMSFNCTOOLBARQUICKMENU, HInstance, 1.0);  \r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DeactivateAllPopups;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  {$IFDEF WEBLIB}\r\n  if Assigned(Parent) and (Parent is TWinControl) then\r\n    for I := 0 to (Parent as TWinControl).ControlCount - 1 do\r\n      if (Parent as TWinControl).Controls[I] is TTMSFNCCustomToolBar then\r\n        ((Parent as TWinControl).Controls[I] as TTMSFNCCustomToolBar).CloseCompactPopup;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  if Assigned(Parent) and (Parent is TTMSFNCToolBarParent) then\r\n    for I := 0 to (Parent as TTMSFNCToolBarParent).ControlCount - 1 do\r\n      if (Parent as TTMSFNCToolBarParent).Controls[I] is TTMSFNCCustomToolBar then\r\n        ((Parent as TTMSFNCToolBarParent).Controls[I] as TTMSFNCCustomToolBar).CloseCompactPopup;\r\n  {$ENDIF}\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBar.Destroy;\r\nbegin\r\n  FQuickMenuButtonBitmaps.Free;\r\n  FCompactExpanderBitmaps.Free;\r\n  FCompactPopup.Free;\r\n  FQuickMenuButtonAppearance.Free;\r\n  FCompactAppearance.Free;\r\n  FCompactBitmaps.Free;\r\n  FFont.Free;\r\n  FOptionsMenu.Free;\r\n  FAppearance.Free;\r\n  FHiddenControls.Free;\r\n  FCompactControls.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoCanShowOptionsMenuItem(AControl: TControl;\r\n  var ACanShowItem: Boolean);\r\nbegin\r\n  if Assigned(OnOptionsMenuItemCanShow) then\r\n    OnOptionsMenuItemCanShow(Self, AControl, ACanShowItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoCloseCompactPopup(Sender: TObject);\r\nvar\r\n  I: Integer;\r\n  cc: TTMSFNCToolBarControl;\r\nbegin\r\n  FCompactPopup.ContentControl := nil;\r\n\r\n  for I := 0 to FCompactControls.Count - 1 do\r\n  begin\r\n    cc := TTMSFNCToolBarControl(FCompactControls[I]);\r\n    if Assigned(cc.FControl) then\r\n    begin\r\n      if cc.FControl is TTMSFNCDefaultToolBarButton then\r\n        (cc.FControl as TTMSFNCDefaultToolBarButton).Layout := cc.FLayout;\r\n\r\n      cc.FControl.Parent := nil;\r\n      cc.FControl.Visible := False;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(FCompactToolbar) then\r\n  begin\r\n    FCompactToolbar.Free;\r\n    FCompactToolbar := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoCompactClick;\r\nbegin\r\n  if Assigned(OnCompactClick) then\r\n    OnCompactClick(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoCustomizeOptionsMenu;\r\nbegin\r\n  if Assigned(OnOptionsMenuCustomize) then\r\n    OnOptionsMenuCustomize(Self, FAutoOptionsMenu);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoCustomizeOptionsMenuItem(AControl: TControl; AMenuItem: TMenuItem);\r\nbegin\r\n  if Assigned(OnOptionsMenuItemCustomize) then\r\n    OnOptionsMenuItemCustomize(Self, AControl, AMenuItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoDragGripMoving(ADeltaX, ADeltaY: Double);\r\nbegin\r\n  if Assigned(OnDragGripMoving) then\r\n    OnDragGripMoving(Self, ADeltaX, ADeltaY);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoIsLastElement(AControl: TControl; var ALastElement: Boolean);\r\nbegin\r\n  if Assigned(OnIsLastElement) then\r\n    OnIsLastElement(Self, AControl, ALastElement);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleQuickMenuButton;\r\nbegin\r\n  if Assigned(OnQuickMenuButtonClick) then\r\n    OnQuickMenuButtonClick(Self);\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.HasHint: Boolean;\r\nbegin\r\n  Result := inherited HasHint;\r\n  if FQuickMenuButtonHover then\r\n    Result := QuickMenuButtonHint <> '';\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBar.DoMatrixChanged(Sender: TObject);\r\nbegin\r\n  inherited;\r\n  UpdateDockPanel;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleMouseLeave;\r\nbegin\r\n  inherited;\r\n  FHover := False;\r\n  FQuickMenuButtonHover := False;\r\n  Cursor := crDefault;\r\n  FInsideDrag := False;\r\n  Invalidate;\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomToolBar.AlignControls(AControl: TControl; var Rect: TRect);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBar.DoAddObject(const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoInsertObject(Index: Integer;\r\n  const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoRealign;\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DoRemoveObject(const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomToolBar.DrawDragGrip(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  cnt: Integer;\r\n\r\n  procedure DrawDots(ARect: TRectF);\r\n  var\r\n    i: integer;\r\n    rdg: TRectF;\r\n    sz: Integer;\r\n  begin\r\n    if State = esLarge then\r\n      sz := 3\r\n    else\r\n      sz := 2;\r\n\r\n    ARect.Left := ARect.Left;\r\n    ARect.Top := ARect.Top;\r\n    cnt := Round(ARect.Bottom) div (Round(sz) * 2);\r\n    for i := 1 to cnt do\r\n    begin\r\n      rdg := RectF(ARect.Left + ((ARect.Right - ARect.Left) - sz) / 2, ARect.Top + 1, ARect.Left + sz + ((ARect.Right - ARect.Left) - sz) / 2, ARect.Top + 1 + sz);\r\n      rdg := RectF(int(rdg.Left), int(rdg.Top), int(rdg.Right), int(rdg.Bottom));\r\n      AGraphics.DrawRectangle(rdg);\r\n      ARect.Top := ARect.Top + sz * 2;\r\n    end;\r\n  end;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  AGraphics.Fill.Color := Appearance.DragGripColor;\r\n  AGraphics.Fill.Kind := gfkSolid;\r\n  r := GetDragGripRect;\r\n  DrawDots(r);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DrawText(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  sz, h: Single;\r\n  r: TRectF;\r\nbegin\r\n  if TextVisible and (Text <> '') then\r\n  begin\r\n    sz := 0;\r\n    if Appearance.DragGrip then\r\n    begin\r\n      if State = esLarge then\r\n        sz := 3\r\n      else\r\n        sz := 2;\r\n    end;\r\n\r\n    r := LocalRect;\r\n    r := RectF(r.Left + sz, r.Top, r.Right, r.Bottom);\r\n    InflateRectEx(r, -2, -2);\r\n\r\n    AGraphics.Font.Assign(Font);\r\n\r\n    h := GetTextSize.cy;\r\n\r\n    r := RectF(r.Left, r.Bottom - h, r.Right, r.Bottom);\r\n    AGraphics.DrawText(r, Text, WordWrapping, HorizontalTextAlign, VerticalTextAlign, Trimming);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.DropDownActive: Boolean;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    if c is TTMSFNCDefaultToolBarButton then\r\n    begin\r\n      if Assigned((c as TTMSFNCDefaultToolBarButton).FPopup) then\r\n      begin\r\n        Result := (c as TTMSFNCDefaultToolBarButton).FPopup.IsOpen;\r\n        if Result then\r\n          Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetBitmapContainer: TTMSFNCBitmapContainer;\r\nbegin\r\n  Result := FBitmapContainer;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetBitmapPickerClass: TTMSFNCToolBarBitmapPickerClass;\r\nbegin\r\n  Result := TTMSFNCToolBarBitmapPicker;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetCompactBitmapRect(ARect: TRectF): TRectF;\r\nvar\r\n  r: TRectF;\r\n  bs: Single;\r\nbegin\r\n  r := ARect;\r\n  Result := RectF(r.Left, r.Top, r.Right, r.Top);\r\n  if CompactBitmapVisible then\r\n  begin\r\n    bs := GetCompactBitmapSize;\r\n    if not TextVisible or (Text = '') then\r\n    begin\r\n      Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, r.Bottom - 3);\r\n      if (bs <> -1) then\r\n      begin\r\n        Result.Left := Round(r.Left + ((r.Right - r.Left) - bs) / 2);\r\n        Result.Top := Round(r.Top + ((r.Bottom - r.Top) - bs) / 2);\r\n        Result.Right := Result.Left + bs;\r\n        Result.Bottom := Result.Top + bs;\r\n      end;\r\n    end\r\n    else if TextVisible and not (Text = '') then\r\n      Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, r.Top + bs);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetCompactBitmapSize: Single;\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  Result := CompactBitmapSize;\r\n  if CompactAutoBitmapSize then\r\n  begin\r\n    bmp := TTMSFNCGraphics.GetScaledBitmap(CompactBitmaps, 0, BitmapContainer);\r\n    if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n      Result := Max(bmp.Height, bmp.Width);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetColorPickerClass: TTMSFNCToolBarColorPickerClass;\r\nbegin\r\n  Result := TTMSFNCToolBarColorPicker;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetCompactControl(\r\n  AControl: TControl): TTMSFNCToolBarControl;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to FCompactControls.Count - 1 do\r\n  begin\r\n    if TTMSFNCToolBarControl(FCompactControls[I]).FControl = AControl then\r\n    begin\r\n      Result := TTMSFNCToolBarControl(FCompactControls[I]);\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetCompactControlCount: Integer;\r\nbegin\r\n  Result := FCompactControls.Count;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetDragGripRect(AInteraction: Boolean = False): TRectF;\r\nvar\r\n  r: TRectF;\r\n  f: Single;\r\nbegin\r\n  r := LocalRect;\r\n  f := 1;\r\n  if State = esLarge then\r\n    f := 1.75;\r\n\r\n  if AInteraction then\r\n    Result := RectF(r.Left, r.Top, r.Left + (8 * f), r.Bottom)\r\n  else\r\n    Result := RectF(r.Left + 3, r.Top + 3, r.Left + (6 * f), r.Bottom - 3);\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetFontNamePickerClass: TTMSFNCToolBarFontNamePickerClass;\r\nbegin\r\n  Result := TTMSFNCToolBarFontNamePicker;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetFontSizePickerClass: TTMSFNCToolBarFontSizePickerClass;\r\nbegin\r\n  Result := TTMSFNCToolBarFontSizePicker;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetHiddenControl(\r\n  AControl: TControl): TTMSFNCToolBarControl;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to FHiddenControls.Count - 1 do\r\n  begin\r\n    if TTMSFNCToolBarControl(FHiddenControls[I]).FControl = AControl then\r\n    begin\r\n      Result := TTMSFNCToolBarControl(FHiddenControls[I]);\r\n      Break;\r\n    end;\r\n  end;              \r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetHiddenControlCount(\r\n  AControl: TControl): Integer;\r\nvar\r\n  I: Integer;\r\n  lst: TTMSFNCToolBarControlList;\r\nbegin\r\n  lst := TTMSFNCToolBarControlList.Create;\r\n  for I := 0 to FHiddenControls.Count - 1 do\r\n    lst.Add(FHiddenControls[I]);\r\n\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  lst.Sort(FCompareHiddenControls);\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  Result := 0;\r\n  for I := 0 to lst.Count - 1 do\r\n  begin\r\n    if TTMSFNCToolBarControl(lst[I]).FControl = AControl then\r\n      Break\r\n    else\r\n      Inc(Result);\r\n  end;\r\n  lst.Free;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetHintString: String;\r\nbegin\r\n  Result := inherited GetHintString;\r\n  if FQuickMenuButtonHover then\r\n    Result := QuickMenuButtonHint\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetItemPickerClass: TTMSFNCToolBarItemPickerClass;\r\nbegin\r\n  Result := TTMSFNCToolBarItemPicker;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetOptionsMenuButtonClass: TTMSFNCToolBarDropDownButtonClass;\r\nbegin\r\n  Result := TTMSFNCToolBarDropDownButton;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetOptionsMenuButtonControl: TTMSFNCToolBarDropDownButton;\r\nbegin\r\n  Result := FOptionsMenuButton;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetQuickMenuButtonRect: TRectF;\r\nbegin\r\n  Result := RectF(Width - 16, Height - 16, Width, Height);\r\n  if Appearance.Separator then\r\n  begin\r\n    Result.Left := Result.Left - Appearance.SeparatorStroke.Width;\r\n    Result.Right := Result.Right - Appearance.SeparatorStroke.Width;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetCompactTextRect: TRectF;\r\nvar\r\n  bmpr: TRectF;\r\n  r: TRectF;\r\nbegin\r\n  r := LocalRect;\r\n  bmpr := GetCompactBitmapRect(r);\r\n  Result := RectF(r.Left + 3, bmpr.Bottom + 3, r.Right - 3, r.Bottom - 23)\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetTextSize: TSizeF;\r\nvar\r\n  g: TTMSFNCGraphics;\r\n  sz: Single;\r\n  r: TRectF;\r\nbegin\r\n  Result.cx := 0;\r\n  Result.cy := 0;\r\n  if TextVisible and (Text <> '') then\r\n  begin\r\n    g := TTMSFNCGraphics.CreateBitmapCanvas(1, 1, NativeCanvas);\r\n    g.BitmapContainer := BitmapContainer;\r\n    g.OptimizedHTMLDrawing := OptimizedHTMLDrawing;\r\n    try\r\n      sz := 0;\r\n      if Appearance.DragGrip then\r\n      begin\r\n        if State = esLarge then\r\n          sz := 3\r\n        else\r\n          sz := 2;\r\n      end;\r\n\r\n      r := LocalRect;\r\n      r := RectF(r.Left + sz, r.Top, r.Right, r.Bottom);\r\n      InflateRectEx(r, -2, -2);\r\n      Result := g.CalculateTextSize(Text, r, WordWrapping);\r\n    finally\r\n      g.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetToolBarButtonClass: TTMSFNCToolBarButtonClass;\r\nbegin\r\n  Result := TTMSFNCToolBarButton;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetToolBarSeparatorClass: TTMSFNCToolBarSeparatorClass;\r\nbegin\r\n  Result := TTMSFNCToolBarSeparator;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.GetVersion: String;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UpdateToolBar(Sender: TObject);\r\nbegin\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UpdateToolBarControl(Sender: TObject);\r\nvar\r\n  tb: TTMSFNCToolBarControl;\r\n  bmp: TTMSFNCBitmap;\r\n  c: TControl;\r\n  tc: TControl;\r\n  tci: Integer;\r\nbegin\r\n  if not Assigned(Sender) then\r\n    Exit;\r\n\r\n  FBlockUpdate := True;\r\n\r\n  c := Sender as TControl;\r\n\r\n  tb := GetHiddenControl(c);\r\n  if Assigned(tb) then\r\n  begin\r\n    tc := tb.FControl;\r\n    tci := Max(0, Min(ControlCount, tb.FControlIndex - GetHiddenControlCount(tc)));\r\n    FHiddenControls.Remove(tb);\r\n    InsertToolBarControl(tc, tci);\r\n    tc.Visible := True;\r\n  end\r\n  else\r\n  begin\r\n    tb := TTMSFNCToolBarControl.Create;\r\n\r\n    if c is TTMSFNCCustomToolBarElement then\r\n      tb.FControlIndex := (c as TTMSFNCCustomToolBarElement).ControlIndex\r\n    else\r\n      tb.FControlIndex := c.Tag;\r\n\r\n    tb.FControl := c;\r\n    FBlockUpdate := True;\r\n    {$IFDEF WEBLIB}\r\n    bmp := TTMSFNCBitmap(c.MakeScreenshot);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    bmp := c.MakeScreenshot;\r\n    {$ENDIF}\r\n    FBlockUpdate := False;\r\n    tb.FBitmap.Assign(bmp);\r\n    bmp.Free;\r\n    FHiddenControls.Add(tb);\r\n    c.Parent := nil;\r\n    c.Visible := False;\r\n  end;\r\n\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.InitializeOptionsMenu;\r\n{$IFDEF WEBLIB}\r\nbegin\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nvar\r\n  mnu: TTMSFNCToolBarOptionMenuItem;\r\n  bmp: TTMSFNCBitmap;\r\n  I: Integer;\r\n  c: TControl;\r\n  lst: TTMSFNCControlList;\r\n  tb: TTMSFNCToolBarControl;\r\n  sh: Boolean;\r\n  bmpw, bw, bh: Single;\r\n  {$IFDEF FMXLIB}\r\n  o: TFmxObject;\r\n  {$ENDIF}\r\n  maxh: Single;\r\nbegin\r\n  lst := nil;\r\n  try\r\n    lst := TTMSFNCControlList.Create;\r\n    for I := 0 to Self.ControlCount - 1 do\r\n      lst.Add(Controls[I]);\r\n\r\n    for I := 0 to FHiddenControls.Count - 1 do\r\n      lst.Add(TTMSFNCToolBarControl(FHiddenControls[I]).FControl);\r\n\r\n    {$IFNDEF LCLLIB}\r\n    {$IFNDEF WEBLIB}\r\n    lst.Sort(FCompareControls);\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    {$IFDEF FMXLIB}\r\n    FAutoOptionsMenu.Clear;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    FAutoOptionsMenu.Items.Clear;\r\n    {$ENDIF}\r\n\r\n    FTotalOptionsMenuWidth := 0;\r\n\r\n    for I := 0 to lst.Count - 1 do\r\n    begin\r\n      c := TControl(lst[I]);\r\n\r\n      {$IFDEF FMXLIB}\r\n      if Supports(c, IDesignerControl) then\r\n        Continue;\r\n      {$ENDIF}\r\n\r\n      if not (c = FOptionsMenuButton) and not (c is TTMSFNCCustomToolBarSeparator) then\r\n      begin\r\n        sh := True;\r\n        DoCanShowOptionsMenuItem(c, sh);\r\n        if sh then\r\n        begin\r\n          mnu := TTMSFNCToolBarOptionMenuItem.Create(FAutoOptionsMenu);\r\n          mnu.OnClick := OptionMenuItemClick;\r\n          {$IFDEF FMXLIB}\r\n          mnu.OnApplyStyleLookup := OptionMenuItemApplyStyleLookup;\r\n          mnu.Calculate := True;\r\n          mnu.ApplyStyleLookup;\r\n          {$ENDIF}\r\n\r\n          bmpw := 0;\r\n          bw := 0;\r\n          bh := 0;\r\n          {$IFDEF FMXLIB}\r\n          o := mnu.FindStyleResource('checkmark');\r\n          if Assigned(o) and (o is TControl) then\r\n            bmpw := (o as TControl).Width;\r\n          {$ENDIF}\r\n\r\n          maxh := 20;\r\n          if OptionsMenu.ShowItemBitmap then\r\n          begin\r\n            tb := GetHiddenControl(c);\r\n            if Assigned(tb) then\r\n            begin\r\n              bmp := tb.FBitmap;\r\n              mnu.Bitmap.Assign(bmp);\r\n              bw := bmp.Width;\r\n              bh := bmp.Height;\r\n            end\r\n            else\r\n            begin\r\n              FBlockUpdate := True;\r\n              bmp := c.MakeScreenshot;\r\n              FBlockUpdate := False;\r\n              mnu.Bitmap.Assign(bmp);\r\n              bw := bmp.Width;\r\n              bh := bmp.Height;\r\n              bmp.Free;\r\n            end;\r\n          end;\r\n\r\n          TTMSFNCGraphics.GetAspectSize(bw, bh, bw, bh, bw, maxh, True, False, False);\r\n          bmpw := bmpw + int(bw);\r\n\r\n          if OptionsMenu.ShowItemText then\r\n          begin\r\n            if c is TTMSFNCCustomToolBarButton then\r\n              mnu.Text := (c as TTMSFNCCustomToolBarButton).AutoOptionsMenuText;\r\n\r\n            if mnu.Text = '' then\r\n              mnu.Text := c.Name;\r\n          end;\r\n\r\n          mnu.Control := c;\r\n          mnu.IsChecked := Assigned(c.Parent);\r\n\r\n          DoCustomizeOptionsMenuItem(c, mnu);\r\n\r\n          {$IFDEF FMXLIB}\r\n          FAutoOptionsMenu.AddObject(mnu);\r\n          {$ENDIF}\r\n          {$IFDEF CMNLIB}\r\n          FAutoOptionsMenu.Items.Add(mnu);\r\n          {$ENDIF}\r\n          FTotalOptionsMenuWidth := Max(FTotalOptionsMenuWidth, bmpw);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    {$IFDEF FMXLIB}\r\n    for I := 0 to FAutoOptionsMenu.ItemsCount - 1 do\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    for I := 0 to FAutoOptionsMenu.Items.Count - 1 do\r\n    {$ENDIF}\r\n    begin\r\n      if FAutoOptionsMenu.Items[I] is TTMSFNCToolBarOptionMenuItem then\r\n      begin\r\n        mnu := (FAutoOptionsMenu.Items[I] as TTMSFNCToolBarOptionMenuItem);\r\n        {$IFDEF FMXLIB}\r\n        mnu.NeedStyleLookup;\r\n        mnu.Calculate := False;\r\n        {$ENDIF}\r\n        if OptionsMenu.AutoItemBitmapWidth then\r\n          mnu.GlyphWidth := FTotalOptionsMenuWidth\r\n        else\r\n          mnu.GlyphWidth := OptionsMenu.ItemBitmapWidth;\r\n      end;\r\n    end;\r\n\r\n  finally\r\n    if Assigned(lst) then\r\n      lst.Free;\r\n  end;\r\n{$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.InsertToolBarControl(AControl: TControl;\r\n  AIndex: Integer);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if (AIndex >= 0) and (AIndex <= Self.ControlCount - 1) then\r\n    InsertObject(AIndex, AControl)\r\n  else\r\n    AddObject(AControl);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  AControl.Parent := Self;\r\n  if AIndex > -1 then\r\n    SetChildOrder(AControl, AIndex);\r\n  {$ENDIF}\r\n\r\n  if Assigned(OnInternalInsertControl) then\r\n    OnInternalInsertControl(AControl);\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.IsCompactBitmapSizeStored: Boolean;\r\nbegin\r\n  Result := CompactBitmapSize <> 24;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.IsCompactWidthStored: Boolean;\r\nbegin\r\n  Result := CompactWidth <> 50;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBar.IsMinimumWidthStored: Boolean;\r\nbegin\r\n  Result := MinimumWidth <> 30;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleCompact;\r\nvar\r\n  I: Integer;\r\n  cc: TTMSFNCToolBarControl;\r\nbegin\r\n  inherited;\r\n\r\n  DeactivateAllPopups;\r\n\r\n  if Assigned(FCompactToolbar) then\r\n  begin\r\n    FCompactToolbar.Free;\r\n    FCompactToolbar := nil;\r\n  end;\r\n\r\n  FCompactToolbar := TTMSFNCCustomToolBar.Create(FCompactPopup);\r\n  FCompactToolbar.Assign(Self);\r\n  FCompactToolbar.Compact := False;\r\n  FCompactToolbar.AutoSize := True;\r\n  FCompactToolbar.AutoHeight := False;\r\n  FCompactToolbar.AutoWidth := True;\r\n  FCompactToolbar.AutoStretchHeight := False;\r\n  FCompactToolbar.Appearance.Separator := False;\r\n  FCompactToolbar.SetControlMargins(1, 1, 1, 1);\r\n  FCompactToolbar.Height := Height + 2;\r\n\r\n  for I := FCompactControls.Count - 1 downto 0 do\r\n  begin\r\n    cc := TTMSFNCToolBarControl(FCompactControls[I]);\r\n    if Assigned(cc.FControl) then\r\n    begin\r\n      if cc.FControl is TTMSFNCDefaultToolBarButton then\r\n        (cc.FControl as TTMSFNCDefaultToolBarButton).Layout := (cc.FControl as TTMSFNCDefaultToolBarButton).CompactLayout;\r\n      cc.FControl.Visible := True;\r\n      cc.FControl.Parent := FCompactToolbar;\r\n    end;\r\n  end;\r\n\r\n  FCompactToolbar.UpdateControls;\r\n  FCompactPopup.ContentControl := FCompactToolbar;\r\n  FCompactPopup.Activate;\r\n  DoCompactClick;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleDblClick(X, Y: Single);\r\nbegin\r\n  inherited;\r\n  if Assigned(OnInternalDblClick) then\r\n    OnInternalDblClick(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleMouseDown(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  if Appearance.DragGrip and not FDragGripMoving then\r\n  begin\r\n    FDragGripDown := PtInRectEx(GetDragGripRect(True), PointF(X, Y));\r\n    FDragGripDownPt := PointF(X, Y);\r\n  end;\r\n\r\n  if not FDragGripDown then\r\n  begin\r\n    if Compact then\r\n    begin\r\n      FDown := True;\r\n      Invalidate;\r\n      CaptureEx;\r\n    end\r\n    else if QuickMenuButton then\r\n    begin\r\n      FQuickMenuButtonDown := PtInRectEx(GetQuickMenuButtonRect, PointF(X, Y));\r\n      if FQuickMenuButtonDown then\r\n      begin\r\n        Invalidate;\r\n        CaptureEx;\r\n      end;              \r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnInternalMouseDown) and not (Button = TTMSFNCMouseButton.mbRight) then\r\n    OnInternalMouseDown(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleMouseMove(Shift: TShiftState; X, Y: Single);\r\nvar\r\n  r: TRectF;\r\n  absx, absy: Single;\r\n  pt: TPointF;\r\n  d: TTMSFNCCustomDockPanel;\r\nbegin\r\n  inherited;\r\n\r\n  if Compact then\r\n  begin\r\n    FHoverP := FHover;\r\n    FHover := True;\r\n    if FHover <> FHoverP then\r\n      Invalidate;\r\n  end\r\n  else if QuickMenuButton then\r\n  begin\r\n    FQuickMenuButtonHoverP := FQuickMenuButtonHover;\r\n    FQuickMenuButtonHover := PtInRectEx(GetQuickMenuButtonRect, PointF(X, Y));\r\n    if FQuickMenuButtonHover <> FQuickMenuButtonHoverP then\r\n      Invalidate;\r\n  end;\r\n\r\n  if Appearance.DragGrip then\r\n  begin\r\n    if FDragGripDown then\r\n    begin\r\n      if not FDragGripMoving then\r\n      begin\r\n        CaptureEx;\r\n        FDragGripMoving := True;\r\n      end;\r\n\r\n      if FDragGripMoving then\r\n      begin\r\n        absx := (FDragGripDownPt.X - X);\r\n        absy := (FDragGripDownPt.Y - Y);\r\n        if AutoMoveToolBar then\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          pt := PointF(Position.Point.X - absx, Position.Point.Y - absy);\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          pt := PointF(Left - absx, Top - absy);\r\n          {$ENDIF}\r\n\r\n          if Parent is TTMSFNCCustomDockPanel then\r\n          begin\r\n            d := Parent as TTMSFNCCustomDockPanel;\r\n            if d.AutoAlign then\r\n            begin\r\n              if pt.Y < d.Appearance.Margins.Top then\r\n                pt.Y := Round(d.Appearance.Margins.Top);\r\n              if pt.X < d.Appearance.Margins.Left then\r\n                pt.X := Round(d.Appearance.Margins.Left)\r\n              else if pt.X + Width > d.Width - d.Appearance.Margins.Right then\r\n                pt.X := Round(d.Width - d.Appearance.Margins.Right - Width);\r\n\r\n              SetBounds(Round(pt.X), Round(pt.Y), Width, Height);\r\n            end;\r\n          end;\r\n        end;\r\n        FDragGripDownPt := PointF(X + absx, Y + absy);\r\n        DoDragGripMoving(absx, absy);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      r := GetDragGripRect(True);\r\n      if PtInRectEx(r, PointF(X, Y)) then\r\n      begin\r\n        if not FInsideDrag then\r\n        begin\r\n          FInsideDrag := True;\r\n          Cursor := crSize;\r\n        end;\r\n      end\r\n      else if FInsideDrag then\r\n      begin\r\n        FInsideDrag := False;\r\n        Cursor := crDefault;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnInternalMouseMove) then\r\n    OnInternalMouseMove(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState;\r\n  X, Y: Single);\r\nbegin\r\n  inherited;\r\n  if FDragGripDown then\r\n    ReleaseCaptureEx\r\n  else if FDown and Compact then\r\n  begin\r\n    Invalidate;\r\n    ReleaseCaptureEx;\r\n    HandleCompact;\r\n  end\r\n  else if FQuickMenuButtonDown and QuickMenuButton and not Compact then\r\n  begin\r\n    Invalidate;\r\n    ReleaseCaptureEx;\r\n    HandleQuickMenuButton;\r\n  end;                      \r\n\r\n  FDragGripDown := False;\r\n  FDragGripMoving := False;\r\n  FDown := False;\r\n  FQuickMenuButtonDown := False;\r\n\r\n  if Assigned(OnInternalMouseUp) and not (Button = TTMSFNCMouseButton.mbRight) then\r\n    OnInternalMouseUp(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FBitmapContainer) then\r\n    FBitmapContainer := nil;\r\n\r\n  if (Operation = opRemove) and (AComponent = FCustomOptionsMenu) then\r\n    FCustomOptionsMenu := nil;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBar.OptionMenuItemApplyStyleLookup(Sender: TObject);\r\nvar\r\n  c: TControl;\r\nbegin\r\n  c := nil;\r\n  if (Sender is TTMSFNCToolBarOptionMenuItem) then\r\n    c := (Sender as TTMSFNCToolBarOptionMenuItem).FControl;\r\n\r\n  if Assigned(OnOptionsMenuItemApplyStyle) and (Sender is TMenuItem) then\r\n    OnOptionsMenuItemApplyStyle(Self, c, Sender as TMenuItem);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomToolBar.OptionMenuItemClick(Sender: TObject);\r\nvar\r\n  a: Boolean;\r\n  c: TControl;\r\nbegin\r\n  a := True;\r\n  c := nil;\r\n  if (Sender is TTMSFNCToolBarOptionMenuItem) then\r\n    c := (Sender as TTMSFNCToolBarOptionMenuItem).FControl;\r\n\r\n  if Assigned(OnOptionsMenuItemClick) and (Sender is TMenuItem) then\r\n    OnOptionsMenuItemClick(Self, c, Sender as TMenuItem, a);\r\n\r\n  if a then\r\n    UpdateToolBarControl(c);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.OptionsButtonClick(Sender: TObject);\r\nvar\r\n  pt: TPointF;\r\nbegin\r\n  if Assigned(OnOptionsMenuButtonClick) then\r\n    OnOptionsMenuButtonClick(Self)\r\n  else\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    pt := FOptionsMenuButton.Position.Point;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    pt := PointF(FOptionsMenuButton.Left, FOptionsMenuButton.Top);\r\n    {$ENDIF}\r\n    pt := LocalToScreenEx(PointF(pt.X, pt.Y + FOptionsMenuButton.Height));\r\n    ShowOptionsMenu(pt.X, pt.Y);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.QuickMenuButtonAppearanceChanged(\r\n  Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.QuickMenuButtonBitmapsChanged(\r\n  Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.ResetToDefaultStyle;\r\nbegin\r\n  inherited;\r\n  Appearance.DragGripColor := gcLightgray;\r\n  Appearance.Fill.Color := gcWhite;\r\n  Appearance.Stroke.Color := gcGray;\r\n  Appearance.Fill.Kind := gfkGradient;\r\n  Appearance.Stroke.Kind := gskSolid;\r\n  Appearance.Fill.Color := gcWhite;\r\n  Appearance.Fill.ColorTo := MakeGraphicsColor(230, 230, 230);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  qr, r: TRectF;\r\n  w: Single;  \r\nbegin\r\n  inherited;\r\n\r\n  r := LocalRect;\r\n\r\n  if Compact then\r\n  begin\r\n    if FDown then\r\n    begin\r\n      AGraphics.Fill.Assign(CompactAppearance.DownFill);\r\n      AGraphics.Stroke.Assign(CompactAppearance.DownStroke);\r\n    end\r\n    else if FHover then\r\n    begin\r\n      AGraphics.Fill.Assign(CompactAppearance.HoverFill);\r\n      AGraphics.Stroke.Assign(CompactAppearance.HoverStroke);\r\n    end\r\n    else\r\n    begin\r\n      AGraphics.Fill.Assign(CompactAppearance.NormalFill);\r\n      AGraphics.Stroke.Assign(CompactAppearance.NormalStroke);\r\n    end;\r\n\r\n    if CompactAppearance.FlatStyle then\r\n      AGraphics.Fill.Kind := gfkSolid;\r\n\r\n    AGraphics.DrawRectangle(RectF(r.Left, r.Top + 2, r.Right - 3, r.Bottom - 2));\r\n  end\r\n  else\r\n  begin\r\n    AGraphics.Fill.Assign(Appearance.Fill);\r\n    AGraphics.Stroke.Assign(Appearance.Stroke);\r\n\r\n    if Appearance.FlatStyle then\r\n      AGraphics.Fill.Kind := gfkSolid;\r\n\r\n    AGraphics.DrawRectangle(r);\r\n  end;\r\n\r\n  if Compact then\r\n  begin\r\n    DrawCompactBitmap(AGraphics, ARect);\r\n    DrawCompactText(AGraphics);\r\n    DrawCompactExpander(AGraphics);\r\n  end\r\n  else\r\n  begin\r\n    if Appearance.DragGrip then\r\n      DrawDragGrip(AGraphics);\r\n\r\n    DrawText(AGraphics);\r\n\r\n    if QuickMenuButton then\r\n    begin\r\n      if FQuickMenuButtonDown then\r\n      begin\r\n        AGraphics.Fill.Assign(QuickMenuButtonAppearance.DownFill);\r\n        AGraphics.Stroke.Assign(QuickMenuButtonAppearance.DownStroke);\r\n      end\r\n      else if FQuickMenuButtonHover then\r\n      begin\r\n        AGraphics.Fill.Assign(QuickMenuButtonAppearance.HoverFill);\r\n        AGraphics.Stroke.Assign(QuickMenuButtonAppearance.HoverStroke);\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Fill.Assign(QuickMenuButtonAppearance.NormalFill);\r\n        AGraphics.Stroke.Assign(QuickMenuButtonAppearance.NormalStroke);\r\n      end;\r\n\r\n      if QuickMenuButtonAppearance.FlatStyle then\r\n        AGraphics.Fill.Kind := gfkSolid;\r\n      \r\n      qr := GetQuickMenuButtonRect;\r\n      AGraphics.DrawRectangle(qr);\r\n\r\n      InflateRectEx(qr, -2, -2);\r\n      AGraphics.DrawScaledBitmap(qr, QuickMenuButtonBitmaps);      \r\n    end;\r\n  end;\r\n\r\n  if Appearance.Separator then\r\n  begin\r\n    AGraphics.Stroke.Assign(Appearance.SeparatorStroke);\r\n    w := Appearance.SeparatorStroke.Width;\r\n    AGraphics.DrawLine(PointF(r.Right - w, r.Top + 4), PointF(r.Right - w, r.Bottom - 4));\r\n  end;\r\n\r\n  if IsDesignTime and CanDrawDesignTime then\r\n    AGraphics.DrawFocusRectangle(ARect, gcBlack);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DrawCompactBitmap(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := GetCompactBitmapRect(ARect);\r\n  AGraphics.BitmapContainer := BitmapContainer;\r\n  AGraphics.DrawScaledBitmap(r, CompactBitmaps)\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DrawCompactExpander(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := LocalRect;\r\n  r := RectF(r.Left, r.Bottom - 20, r.Right, r.Bottom);\r\n  InflateRectEx(r, -2, -2);\r\n  AGraphics.DrawScaledBitmap(r, CompactExpanderBitmaps);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.DrawCompactText(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  tr: TRectF;\r\n  st: TTMSFNCGraphicsSaveState;\r\nbegin\r\n  if not TextVisible or (Text = '') then\r\n    Exit;\r\n\r\n  tr := GetCompactTextRect;\r\n  st := AGraphics.SaveState;\r\n  try\r\n    AGraphics.ClipRect(tr);\r\n    AGraphics.Font.Assign(Font);\r\n    AGraphics.DrawText(tr, Text, WordWrapping, HorizontalTextAlign, VerticalTextAlign, Trimming);\r\n  finally\r\n    AGraphics.RestoreState(st);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UncompactControls;\r\nvar\r\n  I: Integer;\r\n  cc: TTMSFNCToolBarControl;\r\n  c: TControl;\r\nbegin\r\n  FBlockUpdate := True;\r\n  for I := FCompactControls.Count - 1 downto 0 do\r\n  begin\r\n    cc := TTMSFNCToolBarControl(FCompactControls[I]);\r\n    c := cc.FControl;\r\n    if Assigned(c) then\r\n    begin\r\n      if c is TTMSFNCCustomToolBarElement then\r\n        (c as TTMSFNCCustomToolBarElement).FBlockUpdate := True;\r\n      c.Parent := Self;\r\n      c.Visible := True;\r\n      if c is TTMSFNCCustomToolBarElement then\r\n        (c as TTMSFNCCustomToolBarElement).FBlockUpdate := False;\r\n    end;\r\n  end;\r\n\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\n\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UpdateControlAfterResize;\r\nbegin\r\n  inherited;\r\n  UpdateDockPanel;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAppearance(\r\n  const Value: TTMSFNCToolBarAppearance);\r\nbegin\r\n  FAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetOptionsMenu(\r\n  const Value: TTMSFNCToolBarOptionsMenu);\r\nbegin\r\n  FOptionsMenu.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetQuickMenuButton(const Value: Boolean);\r\nbegin\r\n  if FQuickMenuButton <> Value then\r\n  begin\r\n    FQuickMenuButton := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetQuickMenuButtonAppearance(\r\n  const Value: TTMSFNCToolBarQuickMenuButtonAppearance);\r\nbegin\r\n  FQuickMenuButtonAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetQuickMenuButtonBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FQuickMenuButtonBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetState(const Value: TTMSFNCToolBarElementState);\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  if FState <> Value then\r\n  begin\r\n    FState := Value;\r\n    for I := 0 to Self.ControlCount - 1 do\r\n    begin\r\n      c := Self.Controls[I];\r\n      if c is TTMSFNCCustomToolBarElement then\r\n        (c as TTMSFNCCustomToolBarElement).State := FState;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetText(const Value: string);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetTextVisible(const Value: Boolean);\r\nbegin\r\n  if FTextVisible <> Value then\r\n  begin\r\n    FTextVisible := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetTrimming(\r\n  const Value: TTMSFNCGraphicsTextTrimming);\r\nbegin\r\n  if FTrimming <> Value then\r\n  begin\r\n    FTrimming := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FVerticalTextAlign <> Value then\r\n  begin\r\n    FVerticalTextAlign := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetWordWrapping(const Value: Boolean);\r\nbegin\r\n  if FWordWrapping <> Value then\r\n  begin\r\n    FWordWrapping := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAutoAlign(const Value: Boolean);\r\nbegin\r\n  if FAutoAlign <> Value then\r\n  begin\r\n    FAutoAlign := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAutoHeight(const Value: Boolean);\r\nbegin\r\n  if FAutoHeight <> Value then\r\n  begin\r\n    FAutoHeight := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAutoStretchHeight(const Value: Boolean);\r\nbegin\r\n  if FAutoStretchHeight <> Value then\r\n  begin\r\n    FAutoStretchHeight := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAutoWidth(const Value: Boolean);\r\nbegin\r\n  if FAutoWidth <> Value then\r\n  begin\r\n    FAutoWidth := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetBitmapContainer(\r\n  const Value: TTMSFNCBitmapContainer);\r\nvar\r\n  I: Integer;\r\n  {$IFDEF FNCLIB}\r\n  c: TControl;\r\n  b: ITMSFNCBitmapContainer;\r\n  {$ENDIF}\r\nbegin\r\n  FBitmapContainer := Value;\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    {$IFDEF FNCLIB}\r\n    {$IFNDEF WEBLIB}\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    {$IFDEF FNCLIB}\r\n    if Supports(c, ITMSFNCBitmapContainer, b) then\r\n      b.BitmapContainer := Value;\r\n    {$ENDIF}\r\n  end;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCanCompact(const Value: Boolean);\r\nbegin\r\n  if FCanCompact <> Value then\r\n    FCanCompact := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompact(const Value: Boolean);\r\nbegin\r\n  if FCompact <> Value then\r\n  begin\r\n    if CanCompact then\r\n    begin\r\n      FCompact := Value;\r\n      if Compact then\r\n      begin\r\n        FOldMenuButtonState := OptionsMenu.ShowButton;\r\n        OptionsMenu.ShowButton := False;\r\n        FOldWidth := Width;\r\n        CompactControls;\r\n        Width := Round(CompactWidth);\r\n      end\r\n      else\r\n      begin\r\n        Width := Round(FOldWidth);\r\n        UncompactControls;\r\n        OptionsMenu.ShowButton := FOldMenuButtonState;\r\n      end;\r\n\r\n      UpdateControls;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactAppearance(\r\n  const Value: TTMSFNCToolBarCompactAppearance);\r\nbegin\r\n  FCompactAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactAutoBitmapSize(const Value: Boolean);\r\nbegin\r\n  if FCompactAutoBitmapSize <> Value then\r\n  begin\r\n    FCompactAutoBitmapSize := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FCompactBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactBitmapSize(const Value: Single);\r\nbegin\r\n  if FCompactBitmapSize <> Value then\r\n  begin\r\n    FCompactBitmapSize := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactBitmapVisible(const Value: Boolean);\r\nbegin\r\n  if FCompactBitmapVisible <> Value then\r\n  begin\r\n    FCompactBitmapVisible := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactExpanderBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FCompactExpanderBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetCompactWidth(const Value: Single);\r\nbegin\r\n  if FCompactWidth <> Value then\r\n  begin\r\n    FCompactWidth := Value;\r\n    if Compact then\r\n      Width := Round(CompactWidth);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  FFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FHorizontalTextAlign <> Value then\r\n  begin\r\n    FHorizontalTextAlign := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetMinimumWidth(const Value: Single);\r\nbegin\r\n  if FMinimumWidth <> Value then\r\n  begin\r\n    FMinimumWidth := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.SetAS(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBar.SetVisible(const Value: Boolean);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomToolBar.VisibleChanging;\r\n{$ENDIF}\r\nbegin\r\n  inherited;\r\n  UpdateDockPanel;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.ShowOptionsMenu(X, Y: Single);\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  if not Assigned(CustomOptionsMenu) then\r\n  begin\r\n    InitializeOptionsMenu;\r\n    DoCustomizeOptionsMenu;\r\n    if FAutoOptionsMenu.ItemsCount > 0 then\r\n      FAutoOptionsMenu.Popup(X, Y);\r\n  end\r\n  else\r\n    CustomOptionsMenu.Popup(X, Y);\r\n {$ENDIF}\r\n {$IFDEF CMNLIB}\r\n  if not Assigned(CustomOptionsMenu) then\r\n  begin\r\n    InitializeOptionsMenu;\r\n    DoCustomizeOptionsMenu;\r\n    if FAutoOptionsMenu.Items.Count > 0 then\r\n      FAutoOptionsMenu.Popup(Round(X), Round(Y));\r\n  end\r\n  else\r\n    CustomOptionsMenu.Popup(Round(X), Round(Y));\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UpdateControls;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\n  idx: Integer;\r\n  fu: Boolean;\r\n  hc: TTMSFNCToolBarControl;\r\n  {$IFDEF FMXLIB}\r\n  maxx, x, w, y, h, hs, hsm, vs, xs, ys, txth, txtw: Single;\r\n  mgr: TBounds;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  maxx, x, w, y, h, hs, hsm, vs, xs, ys, txth, txtw: Integer;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  mgr: TControlBorderSpacing;\r\n  {$ENDIF}\r\n  {$IFDEF VCLWEBLIB}\r\n  mgr: TMargins;\r\n  {$ENDIF}\r\n  l: Boolean;\r\n  {$IFDEF FNCLIB}\r\n  ia: ITMSFNCAdaptToStyle;\r\n  {$ENDIF}\r\n  sz: TSizeF;\r\n  cn: TControl;\r\n  lm, tm, rm, bm: Single;\r\n\r\n  function GetControl(AIndex: Integer): TControl;\r\n  begin\r\n    Result := nil;\r\n\r\n    if (AIndex >= 0) and (AIndex <= Self.ControlCount - 1) then\r\n    begin\r\n      if Self.Controls[AIndex].Visible then\r\n      begin\r\n        Result := Self.Controls[AIndex];\r\n        Exit;\r\n      end;\r\n    end;\r\n\r\n    while (AIndex >= 0) and (AIndex <= Self.ControlCount - 1) do\r\n    begin\r\n      Inc(AIndex);\r\n      if (AIndex >= 0) and (AIndex <= Self.ControlCount - 1) then\r\n      begin\r\n        if Self.Controls[AIndex].Visible then\r\n        begin\r\n          Result := Self.Controls[AIndex];\r\n          Exit;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nbegin\r\n  if FBlockUpdate or FBlockResize or IsLoading or IsDestroying or not CanBuildControls then\r\n    Exit;\r\n\r\n  FBlockUpdate := True;\r\n  {$IFDEF FMXLIB}\r\n  hs := Appearance.HorizontalSpacing;\r\n  vs := Appearance.VerticalSpacing;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  hs := Round(Appearance.HorizontalSpacing);\r\n  vs := Round(Appearance.VerticalSpacing);\r\n  {$ENDIF}\r\n\r\n  x := hs;\r\n  if Appearance.DragGrip then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    x := x + GetDragGripRect.Right;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    x := x + Round(GetDragGripRect.Right);\r\n    {$ENDIF}\r\n    if hs = 0 then\r\n      x := x + 3;\r\n  end;\r\n\r\n  y := vs;\r\n\r\n  xs := x;\r\n  ys := y;\r\n\r\n  hsm := 30;\r\n  txth := 0;\r\n  txtw := 0;\r\n  sz := GetTextSize;\r\n  if sz.cy > 0 then\r\n    txth := Round(sz.cy + 4);\r\n\r\n  if sz.cx > 0 then\r\n    txtw := Round(sz.cx + 8);\r\n\r\n  w := txtw;\r\n  maxx := 0;\r\n  h := 0;\r\n  idx := 0;\r\n\r\n  fu := False;\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    hc := GetHiddenControl(c);\r\n    fu := not Assigned(hc);\r\n    if fu then\r\n      Break;\r\n  end;\r\n\r\n  l := False;\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    {$IFDEF FNCLIB}\r\n    if Supports(c, ITMSFNCAdaptToStyle, ia) then\r\n      ia.AdaptToStyle := AdaptToStyle;\r\n    {$ENDIF}\r\n\r\n    if l then\r\n    begin\r\n      x := xs;\r\n      y := ys + h - vs;\r\n      ys := y;\r\n    end;\r\n\r\n    l := False;\r\n    if c is TTMSFNCCustomToolBarElement then\r\n    begin\r\n      l := (c as TTMSFNCCustomToolBarElement).LastElement;\r\n      (c as TTMSFNCCustomToolBarElement).OnUpdateToolBar := UpdateToolBar;\r\n      (c as TTMSFNCCustomToolBarElement).OnUpdateToolBarControl := UpdateToolBarControl;\r\n    end;\r\n\r\n    DoIsLastElement(c, l);\r\n\r\n    if l then\r\n      l := true;\r\n\r\n    if not (c = FOptionsMenuButton) then\r\n    begin\r\n      if fu then\r\n      begin\r\n        if c is TTMSFNCCustomToolBarElement then\r\n          (c as TTMSFNCCustomToolBarElement).ControlIndex := idx\r\n        else\r\n          c.Tag := idx;\r\n      end;\r\n\r\n      if c.Visible then\r\n      begin\r\n        {$IFDEF FMXLIB}\r\n        if AutoAlign then\r\n        begin\r\n          c.Position.X := x + c.Margins.Left;\r\n          c.Position.Y := y + c.Margins.Top;\r\n        end;\r\n\r\n        if AutoStretchHeight or ((c is TTMSFNCDefaultToolBarButton) and ((c as TTMSFNCDefaultToolBarButton).Layout = bblLarge)) then\r\n        begin\r\n          h := Height - c.Margins.Bottom - txth - y;\r\n          c.Height := h;\r\n        end\r\n        else\r\n          h := Max(h, c.Position.y + c.Height + vs + c.Margins.Bottom);\r\n\r\n        cn := GetControl(I + 1);\r\n        if Assigned(cn) and (cn is TTMSFNCDefaultToolBarButton) then\r\n        begin\r\n          case (cn as TTMSFNCDefaultToolBarButton).Layout of\r\n            bblBitmap, bblLabel:\r\n            begin\r\n              y := Max(y, c.Position.Y + c.Height + vs + c.Margins.Bottom);\r\n              if y + cn.Margins.Top + cn.Height > Height - cn.Margins.Bottom - txth then\r\n              begin\r\n                x := Max(x, Max(maxx, c.Position.x + c.Width + hs + c.Margins.Right));\r\n                y := ys;\r\n              end\r\n              else\r\n              begin\r\n                c.Position.X := x + c.Margins.Left;\r\n                maxx := Max(x, Max(maxx, c.Position.x + c.Width + hs + c.Margins.Right));\r\n              end;\r\n            end;\r\n            bblNone, bblLarge:\r\n            begin\r\n              y := ys;\r\n              x := Max(x, c.Position.x + c.Width + hs + c.Margins.Right);\r\n            end;\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          y := ys;\r\n          x := Max(x, Max(maxx, c.Position.x + c.Width + hs + c.Margins.Right));\r\n        end;\r\n\r\n        {$ENDIF}\r\n        {$IFDEF VCLWEBLIB}\r\n        if c.AlignWithMargins then\r\n        begin\r\n          if AutoAlign then\r\n          begin\r\n            c.Left := x + c.Margins.Left;\r\n            c.Top := y + c.Margins.Top;\r\n          end;\r\n\r\n          if AutoStretchHeight or ((c is TTMSFNCDefaultToolBarButton) and ((c as TTMSFNCDefaultToolBarButton).Layout = bblLarge)) then\r\n          begin\r\n            h := Height - c.Margins.Bottom - txth - y;\r\n            c.Height := h;\r\n          end\r\n          else\r\n            h := Max(h, c.Top + c.Height + vs + c.Margins.Bottom);\r\n\r\n          cn := GetControl(I + 1);\r\n          if Assigned(cn) and (cn is TTMSFNCDefaultToolBarButton) then\r\n          begin\r\n            case (cn as TTMSFNCDefaultToolBarButton).Layout of\r\n              bblBitmap, bblLabel:\r\n              begin\r\n                y := Max(y, c.Top + c.Height + vs + c.Margins.Bottom);\r\n                if y + cn.Margins.Top + cn.Height > Height - cn.Margins.Bottom - txth then\r\n                begin\r\n                  x := Max(x, Max(maxx, c.Left + c.Width + hs + c.Margins.Right));\r\n                  y := ys;\r\n                end\r\n                else\r\n                begin\r\n                  c.Left := x + c.Margins.Left;\r\n                  maxx := Max(x, Max(maxx, c.Left + c.Width + hs + c.Margins.Right));\r\n                end;\r\n              end;\r\n              bblNone, bblLarge:\r\n              begin\r\n                x := Max(x, c.Left + c.Width + hs + c.Margins.Right);\r\n                y := ys;\r\n              end;\r\n            end;\r\n          end\r\n          else\r\n          begin\r\n            x := Max(x, Max(maxx, c.Left + c.Width + hs + c.Margins.Right));\r\n            y := ys;\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          if AutoAlign then\r\n          begin\r\n            c.Left := x;\r\n            c.Top := y;\r\n          end;\r\n\r\n          if AutoStretchHeight or ((c is TTMSFNCDefaultToolBarButton) and ((c as TTMSFNCDefaultToolBarButton).Layout = bblLarge)) then\r\n          begin\r\n            h := Height - txth - y;\r\n            c.Height := h\r\n          end\r\n          else\r\n            h := Max(h, c.Top + c.Height + vs);\r\n\r\n          cn := GetControl(I + 1);\r\n          if Assigned(cn) and (cn is TTMSFNCDefaultToolBarButton) then\r\n          begin\r\n            case (cn as TTMSFNCDefaultToolBarButton).Layout of\r\n              bblBitmap, bblLabel:\r\n              begin\r\n                y := Max(y, c.Top + c.Height + vs);\r\n                if y + cn.Height > Height - txth then\r\n                begin\r\n                  x := Max(x, Max(maxx, c.Left + c.Width + hs));\r\n                  y := ys;\r\n                end\r\n                else\r\n                begin\r\n                  c.Left := x;\r\n                  maxx := Max(x, Max(maxx, c.Left + c.Width + hs));\r\n                end;\r\n              end;\r\n              bblNone, bblLarge:\r\n              begin\r\n                x := Max(x, c.Left + c.Width + hs);\r\n                y := ys;\r\n              end;\r\n            end;\r\n          end\r\n          else\r\n          begin\r\n            x := Max(x, Max(maxx, c.Left + c.Width + hs));\r\n            y := ys;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF LCLLIB}\r\n        if AutoAlign then\r\n        begin\r\n          c.Left := x + c.BorderSpacing.Left;\r\n          c.Top := y + c.BorderSpacing.Top;\r\n        end;\r\n\r\n        if AutoStretchHeight or ((c is TTMSFNCDefaultToolBarButton) and ((c as TTMSFNCDefaultToolBarButton).Layout = bblLarge)) then\r\n        begin\r\n          h := Height - c.BorderSpacing.Bottom - txth - y;\r\n          c.Height := h;\r\n        end\r\n        else\r\n          h := Max(h, c.Top + c.Height + vs + c.BorderSpacing.Bottom);\r\n\r\n        cn := GetControl(I + 1);\r\n        if Assigned(cn) and (cn is TTMSFNCDefaultToolBarButton) then\r\n        begin\r\n          case (cn as TTMSFNCDefaultToolBarButton).Layout of\r\n            bblBitmap, bblLabel:\r\n            begin\r\n              y := Max(y, c.Top + c.Height + vs + c.BorderSpacing.Bottom);\r\n              if y + cn.BorderSpacing.Top + cn.Height > Height - cn.BorderSpacing.Bottom - txth then\r\n              begin\r\n                x := Max(x, Max(maxx, c.Left + c.Width + hs + c.BorderSpacing.Right));\r\n                y := ys;\r\n              end\r\n              else\r\n              begin\r\n                c.Left := x + c.BorderSpacing.Left;\r\n                maxx := Max(x, Max(maxx, c.Left + c.Width + hs + c.BorderSpacing.Right));\r\n              end;\r\n            end;\r\n            bblNone, bblLarge:\r\n            begin\r\n              x := Max(x, c.Left + c.Width + hs + c.BorderSpacing.Right);\r\n              y := ys;\r\n            end;\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          x := Max(x, Max(maxx, c.Left + c.Width + hs + c.BorderSpacing.Right));\r\n          y := ys;\r\n        end;\r\n\r\n        {$ENDIF}\r\n        w := Max(w, x);\r\n      end;\r\n      inc(idx);\r\n    end;\r\n  end;\r\n\r\n  if h = 0 then\r\n    h := hsm;\r\n\r\n  FOptionsMenuButton.Visible := OptionsMenu.ShowButton;\r\n  if OptionsMenu.ShowButton then\r\n    FOptionsMenuButton.Parent := Self\r\n  else\r\n    FOptionsMenuButton.Parent := nil;\r\n\r\n  {$IFDEF FMXLIB}\r\n  if FOptionsMenuButton.Visible then\r\n  begin\r\n    FOptionsMenuButton.Index := Self.ControlCount;\r\n    FOptionsMenuButton.ControlIndex := Self.ControlCount - 1;\r\n    FOptionsMenuButton.Position.Y := FOptionsMenuButton.Margins.Top;\r\n    mgr := FOptionsMenuButton.Margins;\r\n\r\n    if AutoSize then\r\n    begin\r\n      FOptionsMenuButton.Position.X := w + mgr.Left;\r\n      if AutoHeight then\r\n        FOptionsMenuButton.Height := h - mgr.Bottom - mgr.Top - txth\r\n      else if AutoStretchHeight then\r\n        FOptionsMenuButton.Height := Height - mgr.Bottom - mgr.Top - txth;\r\n    end\r\n    else\r\n    begin\r\n      FOptionsMenuButton.Position.X := Width - FOptionsMenuButton.Width - mgr.Right;\r\n      FOptionsMenuButton.Height := Height - mgr.Bottom - mgr.Top - txth;\r\n    end;\r\n    w := w + FOptionsMenuButton.Width + mgr.Right + mgr.Left;\r\n  end;\r\n\r\n  if AutoSize then\r\n  begin\r\n    if Appearance.Separator then\r\n      w := w + Appearance.SeparatorStroke.Width;\r\n\r\n    w := Round(Max(MinimumWidth, w));\r\n\r\n    if ControlAlignment = caNone then\r\n    begin\r\n      lm := 0;\r\n      rm := 0;\r\n      tm := 0;\r\n      bm := 0;\r\n      GetControlMargins(lm, tm, rm, bm);\r\n      w := w + lm + rm;\r\n    end;\r\n\r\n    h := h + txth;\r\n\r\n    if AutoHeight and AutoWidth and (ControlAlignment = caNone) then\r\n      SetBounds(Position.X, Position.Y, w, h)\r\n    else if AutoHeight and not (ControlAlignment in [caLeft, caRight, caClient]) then\r\n      SetBounds(Position.X, Position.Y, Width, h)\r\n    else if AutoWidth and not (ControlAlignment in [caTop, caBottom, caClient]) then\r\n      SetBounds(Position.X, Position.Y, w, Height);\r\n  end;\r\n\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  if FOptionsMenuButton.Visible then\r\n  begin\r\n    FOptionsMenuButton.ControlIndex := Self.ControlCount - 1;\r\n    {$IFDEF LCLLIB}\r\n    FOptionsMenuButton.Top := FOptionsMenuButton.BorderSpacing.Top;\r\n    mgr := FOptionsMenuButton.BorderSpacing;\r\n    {$ENDIF}\r\n    {$IFDEF VCLWEBLIB}\r\n    FOptionsMenuButton.Top := FOptionsMenuButton.Margins.Top;\r\n    mgr := FOptionsMenuButton.Margins;\r\n    if not FOptionsMenuButton.AlignWithMargins then\r\n    begin\r\n      mgr.Left := 0;\r\n      mgr.Top := 0;\r\n      mgr.Right := 0;\r\n      mgr.Bottom := 0;\r\n    end;\r\n    {$ENDIF}\r\n\r\n    if AutoSize then\r\n    begin\r\n      FOptionsMenuButton.Left := w + mgr.Left;\r\n      if AutoHeight then\r\n        FOptionsMenuButton.Height := h - mgr.Bottom - mgr.Top\r\n      else if AutoStretchHeight then\r\n        FOptionsMenuButton.Height := Height - mgr.Bottom - txth - mgr.Top;\r\n    end\r\n    else\r\n    begin\r\n      FOptionsMenuButton.Left := Width - FOptionsMenuButton.Width - mgr.Right;\r\n      FOptionsMenuButton.Height := Height - mgr.Bottom - mgr.Top - txth;\r\n    end;\r\n    w := w + FOptionsMenuButton.Width + mgr.Right + mgr.Left;\r\n  end;\r\n\r\n  if AutoSize then\r\n  begin\r\n    if Appearance.Separator then\r\n      w := w + Round(Appearance.SeparatorStroke.Width);\r\n\r\n    w := Round(Max(MinimumWidth, w));\r\n\r\n    if ControlAlignment = caNone then\r\n    begin\r\n      lm := 0;\r\n      rm := 0;\r\n      tm := 0;\r\n      bm := 0;\r\n      GetControlMargins(lm, tm, rm, bm);\r\n      w := w + Round(lm + rm);\r\n    end;\r\n\r\n    h := h + txth;\r\n\r\n    if AutoHeight and AutoWidth and (ControlAlignment = caNone) then\r\n      SetBounds(Left, Top, w, h)\r\n    else if AutoHeight and not (ControlAlignment in [caLeft, caRight, caClient]) then\r\n      SetBounds(Left, Top, Width, h)\r\n    else if AutoWidth and not (ControlAlignment in [caTop, caBottom, caClient]) then\r\n      SetBounds(Left, Top, w, Height);\r\n  end;\r\n  {$ENDIF}\r\n\r\n  if Assigned(OnUpdateControls) then\r\n    OnUpdateControls(Self);\r\n\r\n  FBlockUpdate := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBar.UpdateDockPanel;\r\nbegin\r\n  if Assigned(OnUpdateDockPanel) then\r\n    OnUpdateDockPanel(Self);\r\nend;\r\n\r\n{ TTMSFNCDefaultToolBarButton }\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.AppearanceChanged;\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.ApplyStyle;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundFillColor(c) then\r\n  begin\r\n    Appearance.NormalFill.Color := c;\r\n    Appearance.NormalFill.Kind := gfkSolid;\r\n    Appearance.DisabledFill.Color := Blend(c, gcDarkgray, 20);\r\n    Appearance.DisabledFill.Kind := gfkSolid;\r\n    Appearance.InnerStroke.Color := Blend(Appearance.NormalFill.Color, Appearance.NormalStroke.Color, 75);\r\n    Appearance.InnerStroke.Kind := gskSolid;\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleTextFontColor(c) then\r\n    Font.Color := c;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundStrokeColor(c) then\r\n  begin\r\n    Appearance.NormalStroke.Color := c;\r\n    Appearance.DownStroke.Color := c;\r\n    Appearance.DisabledStroke.Color := c;\r\n    Appearance.NormalStroke.Color := c;\r\n    Appearance.DownStroke.Color := c;\r\n    Appearance.DisabledStroke.Color := c;\r\n    Appearance.HoverStroke.Color := c;\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleSelectionFillColor(c) then\r\n  begin\r\n    Appearance.HoverFill.Color := c;\r\n    Appearance.HoverFill.Kind := gfkSolid;\r\n    Appearance.DownFill.Color := Blend(c, Fill.Color, 20);\r\n    Appearance.DownFill.Kind := gfkSolid;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCDefaultToolBarButton then\r\n  begin\r\n    FLayout := (Source as TTMSFNCDefaultToolBarButton).Layout;\r\n    FCompactLayout := (Source as TTMSFNCDefaultToolBarButton).CompactLayout;\r\n    FMinimumLayout := (Source as TTMSFNCDefaultToolBarButton).MinimumLayout;\r\n    FMaximumLayout := (Source as TTMSFNCDefaultToolBarButton).MaximumLayout;\r\n    FBitmapPosition := (Source as TTMSFNCDefaultToolBarButton).BitmapPosition;\r\n    FBitmapSize := (Source as TTMSFNCDefaultToolBarButton).BitmapSize;\r\n    FLargeLayoutBitmapSize := (Source as TTMSFNCDefaultToolBarButton).LargeLayoutBitmapSize;\r\n    FAutoBitmapSize := (Source as TTMSFNCDefaultToolBarButton).AutoBitmapSize;\r\n    FLargeLayoutAutoBitmapSize := (Source as TTMSFNCDefaultToolBarButton).LargeLayoutAutoBitmapSize;\r\n    FStretchBitmapIfNoText := (Source as TTMSFNCDefaultToolBarButton).StretchBitmapIfNoText;\r\n    FAppearance.Assign((Source as TTMSFNCDefaultToolBarButton).Appearance);\r\n    FBitmapContainer := (Source as TTMSFNCDefaultToolBarButton).BitmapContainer;\r\n    FBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).Bitmaps);\r\n    FDisabledBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).DisabledBitmaps);\r\n    FLargeLayoutHoverBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).LargeLayoutHoverBitmaps);\r\n    FLargeLayoutBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).LargeLayoutBitmaps);\r\n    FLargeLayoutDisabledBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).LargeLayoutDisabledBitmaps);\r\n    FHoverBitmaps.Assign((Source as TTMSFNCDefaultToolBarButton).HoverBitmaps);\r\n    FBitmapVisible := (Source as TTMSFNCDefaultToolBarButton).BitmapVisible;\r\n    FText := (Source as TTMSFNCDefaultToolBarButton).Text;\r\n    FTextVisible := (Source as TTMSFNCDefaultToolBarButton).TextVisible;\r\n    FDropDownHeight := (Source as TTMSFNCDefaultToolBarButton).DropDownHeight;\r\n    FDropDownWidth := (Source as TTMSFNCDefaultToolBarButton).DropDownWidth;\r\n    FDropDownAutoWidth := (Source as TTMSFNCDefaultToolBarButton).DropDownAutoWidth;\r\n    FWordWrapping := (Source as TTMSFNCDefaultToolBarButton).WordWrapping;\r\n    FHorizontalTextAlign := (Source as TTMSFNCDefaultToolBarButton).HorizontalTextAlign;\r\n    FVerticalTextAlign := (Source as TTMSFNCDefaultToolBarButton).VerticalTextAlign;\r\n    FTrimming := (Source as TTMSFNCDefaultToolBarButton).Trimming;\r\n    FFont.Assign((Source as TTMSFNCDefaultToolBarButton).Font);\r\n    FHoverFontColor := (Source as TTMSFNCDefaultToolBarButton).HoverFontColor;\r\n    FDownFontColor := (Source as TTMSFNCDefaultToolBarButton).DownFontColor;\r\n    FDisabledFontColor := (Source as TTMSFNCDefaultToolBarButton).DisabledFontColor;\r\n    FStretchText := (Source as TTMSFNCDefaultToolBarButton).StretchText;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.BitmapsChanged(Sender: TObject);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  bmp := TTMSFNCGraphics.GetScaledBitmap(Bitmaps, 0, BitmapContainer);\r\n  BitmapVisible := Assigned(bmp) and not IsBitmapEmpty(bmp);\r\n\r\n  if not BitmapVisible and (Layout = bblLarge) then\r\n  begin\r\n    bmp := TTMSFNCGraphics.GetScaledBitmap(LargeLayoutBitmaps, 0, BitmapContainer);\r\n    BitmapVisible := Assigned(bmp) and not IsBitmapEmpty(bmp);\r\n  end;\r\n\r\n  Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.CanChangeText: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.CanDrawDesignTime: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.CanDropDown: Boolean;\r\nbegin\r\n  Result := False;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.ChangeDPIScale(M, D: Integer);\r\nbegin\r\n  inherited;\r\n  BitmapSize := TTMSFNCUtils.MulDivSingle(BitmapSize, M, D);\r\n  LargeLayoutBitmapSize := TTMSFNCUtils.MulDivSingle(LargeLayoutBitmapSize, M, D);\r\n//  Font.Height := TTMSFNCUtils.MulDivInt(Font.Height, M, D);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.CloseDropDown;\r\nbegin\r\n  if not Assigned(FPopup) then\r\n    Exit;\r\n\r\n  if FPopup.IsOpen then\r\n    FPopup.IsOpen := False;\r\nend;\r\n\r\nconstructor TTMSFNCDefaultToolBarButton.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FOldHeight := -1;\r\n  FLayout := bblNone;\r\n  FCompactLayout := bblNone;\r\n  FMinimumLayout := bblBitmap;\r\n  FMaximumLayout := bblLarge;\r\n\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FFont.OnChanged := @DoFontChanged;\r\n\r\n  FHoverFontColor := gcNull;\r\n  FDownFontColor := gcNull;\r\n  FDisabledFontColor := gcNull;\r\n\r\n  FDownState := False;\r\n  FApplyName := True;\r\n  FCloseOnSelection := True;\r\n  FBitmapSize := 24;\r\n  FLargeLayoutBitmapSize := 32;\r\n  FAutoBitmapSize := False;\r\n  FLargeLayoutAutoBitmapSize := False;\r\n  FStretchBitmapIfNoText := True;\r\n  FStretchText := False;\r\n\r\n  FDropDownWidth := 135;\r\n  FDropDownHeight := 135;\r\n  FDropDownAutoWidth := False;\r\n  FPopup := TTMSFNCPopup.Create(Self);\r\n  FPopup.PlacementControl := Self;\r\n  FPopup.DragWithParent := True;\r\n  FPopup.DropDownWidth := FDropDownWidth;\r\n  FPopup.DropDownHeight := FDropDownHeight;\r\n  FPopup.OnPopup := DoPopup;\r\n  FPopup.OnClosePopup := DoClosePopup;\r\n  FPopupPlacement := ppBottom;\r\n\r\n  FBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FBitmaps.OnChange := @BitmapsChanged;\r\n  FDisabledBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FDisabledBitmaps.OnChange := @BitmapsChanged;\r\n  FHoverBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FHoverBitmaps.OnChange := @BitmapsChanged;\r\n\r\n  FLargeLayoutBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FLargeLayoutBitmaps.OnChange := @BitmapsChanged;\r\n  FLargeLayoutDisabledBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FLargeLayoutDisabledBitmaps.OnChange := @BitmapsChanged;\r\n  FLargeLayoutHoverBitmaps := TTMSFNCScaledBitmaps.Create(Self);\r\n  FLargeLayoutHoverBitmaps.OnChange := @BitmapsChanged;\r\n\r\n  FAppearance := TTMSFNCToolBarButtonAppearance.Create(Self);\r\n\r\n  FTextVisible := True;\r\n  FBitmapVisible := False;\r\n  FWordWrapping := False;\r\n  FHorizontalTextAlign := gtaCenter;\r\n  FVerticalTextAlign := gtaCenter;\r\n  FTrimming := gttCharacter;\r\n  FBitmapPosition := bbpLeft;\r\n\r\n  Width := 100;\r\n  Height := 24;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDisabledBitmaps(const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FDisabledBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDisabledFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDisabledFontColor <> Value then\r\n  begin\r\n    FDisabledFontColor := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetHoverBitmaps(const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FHoverBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDownFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDownFontColor <> Value then\r\n  begin\r\n    FDownFontColor := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetHoverFontColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FHoverFontColor <> Value then\r\n  begin\r\n    FHoverFontColor := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetMaximumLayout(\r\n  const Value: TTMSFNCToolBarButtonLayout);\r\nbegin\r\n  if FMaximumLayout <> Value then\r\n  begin\r\n    FMaximumLayout := Value;\r\n    UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetMinimumLayout(\r\n  const Value: TTMSFNCToolBarButtonLayout);\r\nbegin\r\n  if FMinimumLayout <> Value then\r\n  begin\r\n    FMinimumLayout := Value;\r\n    UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDownState(const Value: Boolean);\r\nbegin\r\n  FDownState := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDropDownControl(const Value: TControl);\r\nbegin\r\n  FDropDownControl := Value;\r\n  if Assigned(FDropDownControl) then\r\n  begin\r\n    if not (csDesigning in ComponentState) then\r\n    begin\r\n      if Assigned(FPopup) then\r\n      begin\r\n        FPopup.ContentControl := FDropDownControl;\r\n        FPopup.FocusedControl := FDropDownControl;\r\n      end;\r\n    end\r\n    else if (csDesigning in ComponentState) then\r\n    begin\r\n      DropDownHeight := FDropDownControl.Height;\r\n      DropDownWidth := FDropDownControl.Width;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDropDownAutoWidth(\r\n  const Value: Boolean);\r\nbegin\r\n  if FDropDownAutoWidth <> Value then\r\n  begin\r\n    FDropDownAutoWidth := Value;\r\n    if Assigned(FPopup) then\r\n    begin\r\n      if FDropDownAutoWidth then\r\n        FPopup.DropDownWidth := Width\r\n      else\r\n        FPopup.DropDownWidth := FDropDownWidth;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDropDownHeight(const Value: Single);\r\nbegin\r\n  FDropDownHeight := Value;\r\n  if Assigned(FPopup) and not DropDownAutoWidth then\r\n    FPopup.DropDownHeight := FDropDownHeight;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetDropDownWidth(const Value: Single);\r\nbegin\r\n  FDropDownWidth := Value;\r\n  if Assigned(FPopup) then\r\n    FPopup.DropDownWidth := FDropDownWidth;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  FFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FHorizontalTextAlign <> Value then\r\n  begin\r\n    FHorizontalTextAlign := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(FDropDownButton) then\r\n    FDropDownButton.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.SetDropDownKind(\r\n  const Value: TTMSFNCToolBarButtonDropDownKind);\r\nbegin\r\n  if FDropDownKind <> Value then\r\n  begin\r\n    FDropDownKind := Value;\r\n    if Assigned(FDropDownButton) then\r\n    begin\r\n      case DropDownKind of\r\n        ddkNormal:\r\n        begin\r\n          FDropDownButton.Visible := False;\r\n          FDropDownButton.Parent := nil;\r\n          {$IFDEF FMXLIB}\r\n          FDropDownButton.HitTest := True;\r\n          {$ENDIF}\r\n          FDropDownButton.Appearance.Transparent := False;\r\n        end;\r\n        ddkDropDown:\r\n        begin\r\n          FDropDownButton.Visible := False;\r\n          FDropDownButton.Parent := Self;\r\n          {$IFDEF FMXLIB}\r\n          FDropDownButton.HitTest := False;\r\n          {$ENDIF}\r\n          FDropDownButton.Appearance.Transparent := True;\r\n        end;\r\n        ddkDropDownButton:\r\n        begin\r\n          FDropDownButton.Visible := True;\r\n          FDropDownButton.Parent := Self;\r\n          {$IFDEF FMXLIB}\r\n          FDropDownButton.HitTest := True;\r\n          {$ENDIF}\r\n          FDropDownButton.Appearance.Transparent := False;\r\n        end;\r\n      end;\r\n    end;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.SetDropDownPosition(\r\n  const Value: TTMSFNCToolBarButtonDropDownPosition);\r\nbegin\r\n  if FDropDownPosition <> Value then\r\n  begin\r\n    FDropDownPosition := Value;\r\n    if Assigned(FDropDownButton) then\r\n    begin\r\n      case Value of\r\n        ddpRight:\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          FDropDownButton.Align := TAlignLayout.Right;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          FDropDownButton.Align := alRight;\r\n          {$ENDIF}\r\n          FDropDownButton.Width := 17;\r\n          FDropDownButton.Appearance.Corners := [gcTopRight, gcBottomRight];\r\n        end;\r\n        ddpBottom:\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          FDropDownButton.Align := TAlignLayout.Bottom;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          FDropDownButton.Align := alBottom;\r\n          {$ENDIF}\r\n          FDropDownButton.Height := 10;\r\n          FDropDownButton.Appearance.Corners := [gcBottomLeft, gcBottomRight];\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBarButton.SetEnabled(const Value: Boolean);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomToolBarButton.SetEnabled(Value: Boolean);\r\n{$ENDIF}\r\nvar\r\n  d: TTMSFNCToolBarDropDownButton;\r\nbegin\r\n  inherited;\r\n  d := GetDropDownButtonControl;\r\n  if Assigned(d) then\r\n    d.Enabled := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.SetHidden(const Value: Boolean);\r\nbegin\r\n  if FHidden <> Value then\r\n  begin\r\n    FHidden := Value;\r\n    UpdateToolBarControl;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.UpdateDropDownButton;\r\nbegin\r\n  if Assigned(FDropDownButton) then\r\n    FDropDownButton.Appearance.Rounding := Appearance.Rounding;\r\nend;\r\n\r\ndestructor TTMSFNCDefaultToolBarButton.Destroy;\r\nbegin\r\n  FFont.Free;\r\n  FPopup.Free;\r\n  FBitmaps.Free;\r\n  FDisabledBitmaps.Free;\r\n  FHoverBitmaps.Free;\r\n  FLargeLayoutBitmaps.Free;\r\n  FLargeLayoutDisabledBitmaps.Free;\r\n  FLargeLayoutHoverBitmaps.Free;\r\n  FAppearance.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DoPopup(Sender: TObject);\r\nbegin\r\n  InitializePopup;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleMouseEnter;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleMouseLeave;\r\nbegin\r\n  inherited;\r\n  FDown := False;\r\n  FHover := False;\r\n  FPrevHover := False;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.DoFontChanged(Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.AppearanceChanged;\r\nbegin\r\n  inherited;\r\n  UpdateDropDownButton;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomToolBarButton then\r\n  begin\r\n    FDropDownKind := (Source as TTMSFNCCustomToolBarButton).DropDownKind;\r\n    FDropDownPosition := (Source as TTMSFNCCustomToolBarButton).DropDownPosition;\r\n    FAutoOptionsMenuText := (Source as TTMSFNCCustomToolBarButton).AutoOptionsMenuText;\r\n    FHidden := (Source as TTMSFNCCustomToolBarButton).Hidden;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.CanDropDown: Boolean;\r\nbegin\r\n  Result := DropDownKind <> ddkNormal;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarButton.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FHidden := False;\r\n  FDropDownPosition := ddpRight;\r\n  FDropDownButton := GetDropDownButtonClass.Create(Self);\r\n  FDropDownButton.TabStop := False;\r\n  FDropDownButton.Text := '';\r\n  FDropDownButton.OnClick := DropDownButtonClick;\r\n  FDropDownButton.Visible := False;\r\n  FDropDownButton.Width := 17;\r\n  FDropDownButton.Appearance.Corners := [gcTopRight, gcBottomRight];\r\n  {$IFDEF FMXLIB}\r\n  FDropDownButton.Align := TAlignLayout.Right;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  FDropDownButton.Align := alRight;\r\n  {$ENDIF}\r\n  FDropDownButton.Stored := False;\r\n\r\n  FDropDownButton.Bitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPAND, HInstance, 1.0);\r\n  FDropDownButton.Bitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPANDLARGE, HInstance, 1.5);\r\n  FDropDownButton.DisabledBitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPAND, HInstance, 1.0);\r\n  FDropDownButton.DisabledBitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPANDLARGE, HInstance, 1.5);\r\n  FDropDownButton.HoverBitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPAND, HInstance, 1.0);\r\n  FDropDownButton.HoverBitmaps.AddBitmapFromResource(TMSFNCTOOLBAREXPANDLARGE, HInstance, 1.5);\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarButton.Destroy;\r\nbegin\r\n  FDropDownButton.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.DrawButton(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  inherited;\r\n  if Assigned(FDropDownButton) and (DropDownKind = ddkDropDown) then\r\n  begin\r\n    case DropDownPosition of\r\n      ddpRight: r := RectF(Width - FDropDownButton.Width, 0, Width, Height);\r\n      ddpBottom: r := RectF(0, Height - FDropDownButton.Height, Width, Height);\r\n    end;\r\n    FDropDownButton.DrawBitmap(AGraphics, r);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.DropDownButtonClick(Sender: TObject);\r\nbegin\r\n  DropDown;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DrawBitmap(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  r: TRectF;\r\n  bmpa: TBitmap;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  if not BitmapVisible then\r\n    Exit;\r\n\r\n  r := GetBitmapRect(ARect);\r\n\r\n  if (Self is TTMSFNCToolBarDropDownButton) and AdaptToStyle then\r\n  begin\r\n    bmpa := TBitmap.Create;\r\n    bmpa.SetSize(7, 7);\r\n    {$IFDEF CMNLIB}\r\n    bmpa.TransparentMode := tmFixed;\r\n    bmpa.Transparent := True;\r\n    bmpa.TransparentColor := gcWhite;\r\n    {$ENDIF}\r\n    g := TTMSFNCGraphics.Create(bmpa.Canvas);\r\n    try\r\n      g.BeginScene;\r\n      {$IFDEF CMNLIB}\r\n      g.Fill.Color := gcWhite;\r\n      g.Fill.Kind := gfkSolid;\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := gcWhite;\r\n      g.DrawRectangle(0, 0, bmpa.Width, bmpa.Height);\r\n      {$ENDIF}\r\n      g.Stroke.Kind := gskSolid;\r\n      g.Stroke.Color := TTMSFNCGraphics.DefaultSelectionFillColor;\r\n      g.DrawLine(PointF(0, 1), PointF(6, 1), gcpmRightDown);\r\n      g.DrawLine(PointF(0, 2), PointF(6, 2), gcpmRightDown);\r\n      g.DrawLine(PointF(1, 3), PointF(5, 3), gcpmRightDown);\r\n      g.DrawLine(PointF(2, 4), PointF(4, 4), gcpmRightDown);\r\n      g.DrawLine(PointF(3, 5), PointF(3, 5), gcpmRightDown);\r\n    finally\r\n      g.EndScene;\r\n      g.Free;\r\n    end;\r\n\r\n    try\r\n      {$IFDEF WEBLIB}\r\n      AGraphics.DrawBitmap(r, TTMSFNCBitmap(bmpa));\r\n      {$ENDIF}\r\n      {$IFNDEF WEBLIB}\r\n      AGraphics.DrawBitmap(r, bmpa);\r\n      {$ENDIF}\r\n    finally\r\n      bmpa.Free;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    AGraphics.BitmapContainer := BitmapContainer;\r\n\r\n    case Layout of\r\n      bblLarge:\r\n      begin\r\n        if Enabled then\r\n        begin\r\n          if FHover and (LargeLayoutHoverBitmaps.Count > 0) then\r\n            AGraphics.DrawScaledBitmap(r, LargeLayoutHoverBitmaps)\r\n          else if FHover and (HoverBitmaps.Count > 0) then\r\n            AGraphics.DrawScaledBitmap(r, HoverBitmaps)\r\n          else if LargeLayoutBitmaps.Count > 0 then\r\n            AGraphics.DrawScaledBitmap(r, LargeLayoutBitmaps)\r\n          else\r\n            AGraphics.DrawScaledBitmap(r, Bitmaps)\r\n        end\r\n        else\r\n        begin\r\n          if LargeLayoutDisabledBitmaps.Count > 0 then\r\n            AGraphics.DrawScaledBitmap(r, LargeLayoutDisabledBitmaps)\r\n          else if DisabledBitmaps.Count > 0 then\r\n            AGraphics.DrawScaledBitmap(r, DisabledBitmaps)\r\n          else\r\n            AGraphics.DrawScaledBitmap(r, Bitmaps)\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        if Enabled then\r\n        begin\r\n          if FHover and (HoverBitmaps.Count > 0) then\r\n            AGraphics.DrawScaledBitmap(r, HoverBitmaps)\r\n          else\r\n            AGraphics.DrawScaledBitmap(r, Bitmaps)\r\n        end\r\n        else if DisabledBitmaps.Count > 0 then\r\n          AGraphics.DrawScaledBitmap(r, DisabledBitmaps)\r\n        else\r\n          AGraphics.DrawScaledBitmap(r, Bitmaps)\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DrawButton(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DrawText(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  tr: TRectF;\r\n  st: TTMSFNCGraphicsSaveState;\r\nbegin\r\n  if not TextVisible or (Text = '') then\r\n    Exit;\r\n\r\n  tr := GetTextRect;\r\n  st := AGraphics.SaveState;\r\n  try\r\n    AGraphics.ClipRect(tr);\r\n    AGraphics.Font.Assign(Font);\r\n\r\n    if Enabled then\r\n    begin\r\n      if (FDown or FDownState) and (DownFontColor <> gcNull) then\r\n        AGraphics.Font.Color := DownFontColor\r\n      else if FHover and (HoverFontColor <> gcNull) then\r\n        AGraphics.Font.Color := HoverFontColor\r\n    end\r\n    else if DisabledFontColor <> gcNull then\r\n      AGraphics.Font.Color := DisabledFontColor;\r\n\r\n    AGraphics.DrawText(tr, Text, WordWrapping, HorizontalTextAlign, VerticalTextAlign, Trimming);\r\n  finally\r\n    AGraphics.RestoreState(st);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DropDown;\r\nbegin\r\n  if not Assigned(FPopup) then\r\n    Exit;\r\n\r\n  if not FPopup.IsOpen then\r\n  begin\r\n    if Assigned(OnBeforeDropDown) then\r\n      OnBeforeDropDown(Self);\r\n\r\n    if DropDownAutoWidth then\r\n      FPopup.DropDownWidth := Width;\r\n\r\n    FPopup.Placement := FPopupPlacement;\r\n    FPopup.IsOpen := True;\r\n    if Assigned(OnDropDown) then\r\n      OnDropDown(Self);\r\n  end\r\n  else\r\n    FPopup.IsOpen := False;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DoFontChanged(Sender: TObject);\r\nbegin\r\n  Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetBitmapRect: TRectF;\r\nbegin\r\n  Result := inherited GetBitmapRect;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetBitmapRect(ARect: TRectF): TRectF;\r\nvar\r\n  r: TRectF;\r\n  dr: TRectf;\r\n  bs: Single;\r\nbegin\r\n  bs := GetBitmapSize;\r\n  case Layout of\r\n    bblLarge: bs := GetLargeLayoutBitmapSize;\r\n  end;\r\n\r\n  r := ARect;\r\n  Result := RectF(r.Left, r.Top, r.Left, r.Bottom);\r\n  if BitmapVisible then\r\n  begin\r\n    if DropDownKind <> ddkNormal then\r\n    begin\r\n      dr := GetDropDownRect;\r\n      case BitmapPosition of\r\n        bbpLeft:\r\n        begin\r\n          case DropDownPosition of\r\n            ddpRight: Result := RectF(Result.Left + 3, Result.Top + 3, Result.Left + 3 + bs, Result.Bottom - 3);\r\n            ddpBottom: Result := RectF(Result.Left + 3, Result.Top + 3, Result.Left + 3 + bs, dr.Top - 3);\r\n          end;\r\n        end;\r\n        bbpTop:\r\n        begin\r\n          case DropDownPosition of\r\n            ddpRight: Result := RectF(Result.Left + 3, Result.Top + 3, dr.Left - 3, Result.Top + 3 + bs);\r\n            ddpBottom: Result := RectF(Result.Left + 3, Result.Top + 3, r.Right - 3, Result.Top + 3 + bs);\r\n          end;\r\n        end;\r\n      end;\r\n    end\r\n    else if not TextVisible or (Text = '') then\r\n    begin\r\n      Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, r.Bottom - 3);\r\n      if (bs <> -1) and not StretchBitmapIfNoText then\r\n      begin\r\n        Result.Left := Round(r.Left + ((r.Right - r.Left) - bs) / 2);\r\n        Result.Top := Round(r.Top + ((r.Bottom - r.Top) - bs) / 2);\r\n        Result.Right := Result.Left + bs;\r\n        Result.Bottom := Result.Top + bs;\r\n      end;      \r\n    end\r\n    else if TextVisible and not (Text = '') then\r\n    begin\r\n      case BitmapPosition of\r\n        bbpLeft: Result := RectF(r.Left + 3, r.Top + 3, r.Left + 3 + bs, r.Bottom - 3);\r\n        bbpTop: Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, r.Top + 3 + bs);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetDropDownButtonClass: TTMSFNCToolBarDropDownButtonClass;\r\nbegin\r\n  Result := TTMSFNCToolBarDropDownButton;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetDropDownButtonControl: TTMSFNCToolBarDropDownButton;\r\nbegin\r\n  Result := FDropDownButton;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetDropDownRect: TRectF;\r\nbegin\r\n  Result := inherited GetDropDownRect;\r\n  if Assigned(FDropDownButton) and (DropDownKind <> ddkNormal) then\r\n  begin\r\n    if DropDownKind = ddkDropDown then\r\n    begin\r\n      case DropDownPosition of\r\n        ddpRight: Result := RectF(Width - FDropDownButton.Width, 0, Width, Height);\r\n        ddpBottom: Result := RectF(0, Height - FDropDownButton.Height, Width, Height);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      {$IFDEF FMXLIB}\r\n      Result := RectF(FDropDownButton.Position.X, FDropDownButton.Position.Y, FDropDownButton.Position.X + FDropDownButton.Width, FDropDownButton.Position.Y + FDropDownButton.Height);\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      Result := RectF(FDropDownButton.Left, FDropDownButton.Top, FDropDownButton.Left + FDropDownButton.Width, FDropDownButton.Top + FDropDownButton.Height);\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarButton.GetTextRect: TRectF;\r\nvar\r\n  bmpr: TRectF;\r\n  dr: TRectF;\r\n  r: TRectF;\r\nbegin\r\n  r := LocalRect;\r\n  bmpr := GetBitmapRect(r);\r\n  dr := GetDropDownRect;\r\n  if DropDownKind <> ddkNormal then\r\n  begin\r\n    if not StretchText then\r\n    begin\r\n      case BitmapPosition of\r\n        bbpLeft:\r\n        begin\r\n          case DropDownPosition of\r\n            ddpRight: Result := RectF(bmpr.Right + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\n            ddpBottom: Result := RectF(bmpr.Right + 3, r.Top + 3, r.Right - 3, dr.Top - 3);\r\n          end;\r\n        end;\r\n        bbpTop:\r\n        begin\r\n          case DropDownPosition of\r\n            ddpRight: Result := RectF(r.Left + 3, bmpr.Bottom + 3, dr.Left - 3, r.Bottom - 3);\r\n            ddpBottom: Result := RectF(r.Left + 3, bmpr.Bottom + 3, r.Right - 3, dr.Top - 3);\r\n          end;\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      case DropDownPosition of\r\n        ddpRight: Result := RectF(r.Left + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\n        ddpBottom: Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, dr.Top - 3);\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if not StretchText then\r\n    begin\r\n      case BitmapPosition of\r\n        bbpLeft: Result := RectF(bmpr.Right + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\n        bbpTop: Result := RectF(r.Left + 3, bmpr.Bottom + 3, dr.Left - 3, r.Bottom - 3)\r\n      end;\r\n    end\r\n    else\r\n      Result := RectF(r.Left + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarButton.HandleMouseDown(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  if DropDownKind = ddkDropDown then\r\n    DropDown;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetBitmap: TTMSFNCBitmap;\r\nbegin\r\n  Result := TTMSFNCGraphics.GetScaledBitmap(Bitmaps, 0, FBitmapContainer);\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetBitmapContainer: TTMSFNCBitmapContainer;\r\nbegin\r\n  Result := FBitmapContainer;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetBitmapRect(ARect: TRectF): TRectF;\r\nvar\r\n  r: TRectF;\r\n  bs: Single;\r\nbegin\r\n  bs := GetBitmapSize;\r\n  case Layout of\r\n    bblLarge: bs := GetLargeLayoutBitmapSize;\r\n  end;\r\n\r\n  r := ARect;\r\n  Result := RectF(r.Left, r.Top, r.Left, r.Bottom);\r\n  if BitmapVisible then\r\n  begin\r\n    case BitmapPosition of\r\n      bbpLeft: Result := RectF(Result.Left + 3, Result.Top + 3, Result.Left + 3 + bs, Result.Bottom - 3);\r\n      bbpTop: Result := RectF(Result.Left + 3, Result.Top + 3, Result.Right - 3, Result.Top + 3 + bs);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetBitmapSize: Single;\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  Result := BitmapSize;\r\n  if AutoBitmapSize then\r\n  begin\r\n    bmp := TTMSFNCGraphics.GetScaledBitmap(Bitmaps, 0, BitmapContainer);\r\n    if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n      Result := Max(bmp.Height, bmp.Width);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetBitmapRect: TRectF;\r\nbegin\r\n  Result := GetBitmapRect(LocalRect);\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetDropDownRect: TRectF;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := LocalRect;\r\n  Result := RectF(r.Right, r.Top, r.Right, r.Bottom);\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetHintString: String;\r\nbegin\r\n  Result := Hint;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetLargeLayoutBitmapSize: Single;\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  Result := LargeLayoutBitmapSize;\r\n  if LargeLayoutAutoBitmapSize then\r\n  begin\r\n    bmp := TTMSFNCGraphics.GetScaledBitmap(LargeLayoutBitmaps, 0, BitmapContainer);\r\n    if Assigned(bmp) and not IsBitmapEmpty(bmp) then\r\n      Result := Max(bmp.Height, bmp.Width);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetPopupControl: TTMSFNCPopup;\r\nbegin\r\n  Result := FPopup;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetText: String;\r\nbegin\r\n  Result := FText;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetTextRect: TRectF;\r\nvar\r\n  bmpr: TRectF;\r\n  dr: TRectF;\r\n  r: TRectF;\r\nbegin\r\n  r := LocalRect;\r\n  bmpr := GetBitmapRect;\r\n  dr := GetDropDownRect;\r\n  if not StretchText then\r\n  begin\r\n    case BitmapPosition of\r\n      bbpLeft: Result := RectF(bmpr.Right + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\n      bbpTop: Result := RectF(r.Left + 3, bmpr.Bottom + 3, dr.Left - 3, r.Bottom - 3);\r\n    end;\r\n  end\r\n  else\r\n    Result := RectF(r.Left + 3, r.Top + 3, dr.Left - 3, r.Bottom - 3);\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.GetTextSize: TSizeF;\r\nvar\r\n  g: TTMSFNCGraphics;\r\n  r: TRectF;\r\nbegin\r\n  Result.cx := 0;\r\n  Result.cy := 0;\r\n  if TextVisible and (Text <> '') then\r\n  begin\r\n    g := TTMSFNCGraphics.CreateBitmapCanvas(1, 1, NativeCanvas);\r\n    g.BitmapContainer := BitmapContainer;\r\n    g.OptimizedHTMLDrawing := OptimizedHTMLDrawing;\r\n    try\r\n      r := LocalRect;\r\n      InflateRectEx(r, -2, -2);\r\n      Result := g.CalculateTextSize(Text, r, WordWrapping);\r\n    finally\r\n      g.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.InitializePopup;\r\nbegin\r\n\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.IsBitmapSizeStored: Boolean;\r\nbegin\r\n  Result := BitmapSize <> 24;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.IsDropDownHeightStored: Boolean;\r\nbegin\r\n  Result := DropDownHeight <> 135;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.IsDropDownWidthStored: Boolean;\r\nbegin\r\n  Result := DropDownWidth <> 135;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.IsLargeLayoutBitmapSizeStored: Boolean;\r\nbegin\r\n  Result := LargeLayoutBitmapSize <> 32;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleKeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  case Key of\r\n    KEY_HOME: SelectFirstValue;\r\n    KEY_END: SelectLastValue;\r\n    KEY_UP, KEY_LEFT:  SelectPreviousValue;\r\n    KEY_DOWN, KEY_RIGHT: SelectNextValue;\r\n    KEY_SPACE: Click;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleKeyPress(var Key: Char);\r\nbegin\r\n  inherited;\r\n  if (Key >= #32) and not (Ord(Key) in [KEY_F2, KEY_RETURN, KEY_SPACE, KEY_ESCAPE, KEY_HOME, KEY_END, KEY_UP, KEY_LEFT, KEY_DOWN, KEY_RIGHT]) then\r\n    SelectValueWithCharacter(Key);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleKeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if Shift <> [] then\r\n    Exit;\r\n\r\n  case Key of\r\n    KEY_RETURN, KEY_F4:\r\n    begin\r\n      if CanDropDown then\r\n        DropDown;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleMouseDown(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  if CanFocus then\r\n    SetFocus;\r\n\r\n  FDown := True;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleMouseMove(Shift: TShiftState; X,\r\n  Y: Single);\r\nbegin\r\n  inherited;\r\n  FHover := True;\r\n  if FPrevHover <> FHover then\r\n    Invalidate;\r\n\r\n  FPrevHover := FHover;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.HandleMouseUp(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  FDown := False;\r\n  Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCDefaultToolBarButton.HasHint: Boolean;\r\nbegin\r\n  Result := Hint <> '';\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FBitmapContainer) then\r\n    FBitmapContainer := nil;\r\n\r\n  if (Operation = opRemove) and (AComponent = FDropDownControl) then\r\n    FDropDownControl := nil;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  inherited;\r\n  if not Appearance.Transparent then\r\n  begin\r\n    if Enabled then\r\n    begin\r\n      if FDown or FDownState then\r\n      begin\r\n        AGraphics.Fill.Assign(Appearance.DownFill);\r\n        AGraphics.Stroke.Assign(Appearance.DownStroke);\r\n      end\r\n      else if FHover then\r\n      begin\r\n        AGraphics.Fill.Assign(Appearance.HoverFill);\r\n        AGraphics.Stroke.Assign(Appearance.HoverStroke);\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Fill.Assign(Appearance.NormalFill);\r\n        AGraphics.Stroke.Assign(Appearance.NormalStroke);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      AGraphics.Fill.Assign(Appearance.DisabledFill);\r\n      AGraphics.Stroke.Assign(Appearance.DisabledStroke);\r\n    end;\r\n\r\n    r := LocalRect;\r\n\r\n    if Appearance.FlatStyle then\r\n    begin\r\n      AGraphics.Fill.Kind := gfkSolid;\r\n      AGraphics.DrawRectangle(r);\r\n    end\r\n    else\r\n      AGraphics.DrawRoundRectangle(r, Appearance.Rounding, Appearance.Corners);\r\n\r\n    if Appearance.ShowInnerStroke and not Appearance.FlatStyle then\r\n    begin\r\n      InflateRectEx(r, -1, -1);\r\n      AGraphics.Stroke.Assign(Appearance.InnerStroke);\r\n      AGraphics.Fill.Kind := gfkNone;\r\n      AGraphics.DrawRoundRectangle(r, Appearance.Rounding, Appearance.Corners);\r\n    end;\r\n  end;\r\n\r\n  DrawBitmap(AGraphics, ARect);\r\n  DrawText(AGraphics);\r\n  DrawButton(AGraphics);\r\n\r\n  if ShowFocus and IsFocused then\r\n  begin\r\n    r := GetTextRect;\r\n    AGraphics.DrawFocusRectangle(r);\r\n  end;\r\n\r\n  if IsDesignTime and CanDrawDesignTime then\r\n    AGraphics.DrawFocusRectangle(ARect, gcBlack);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.DoClosePopup(Sender: TObject);\r\nbegin\r\n  if Assigned(OnCloseDropDown) then\r\n    OnCloseDropDown(Self);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.ResetToDefaultStyle;\r\nbegin\r\n  inherited;\r\n  Font.Color := gcBlack;\r\n  Appearance.NormalFill.Color := gcWhite;\r\n  Appearance.HoverFill.Color := gcWhite;\r\n  Appearance.DownFill.Color := gcWhite;\r\n  Appearance.DisabledFill.Color := gcLightgray;\r\n  Appearance.NormalStroke.Color := gcGray;\r\n  Appearance.InnerStroke.Color := gcWhite;\r\n  Appearance.HoverStroke.Color := gcGray;\r\n  Appearance.DownStroke.Color := gcGray;\r\n  Appearance.DisabledStroke.Color := gcGray;\r\n\r\n  Appearance.NormalFill.Kind := gfkGradient;\r\n  Appearance.HoverFill.Kind := gfkGradient;\r\n  Appearance.DownFill.Kind := gfkGradient;\r\n  Appearance.DisabledFill.Kind := gfkSolid;\r\n  Appearance.NormalStroke.Kind := gskSolid;\r\n  Appearance.InnerStroke.Kind := gskSolid;\r\n  Appearance.HoverStroke.Kind := gskSolid;\r\n  Appearance.DownStroke.Kind := gskSolid;\r\n  Appearance.DisabledStroke.Kind := gskSolid;\r\n\r\n  Appearance.NormalFill.Color := MakeGraphicsColor(249, 251, 252);\r\n  Appearance.NormalFill.ColorTo := MakeGraphicsColor(230, 235, 235);\r\n  Appearance.NormalFill.ColorMirror := MakeGraphicsColor(220, 220, 236);\r\n  Appearance.NormalFill.ColorMirrorTo := MakeGraphicsColor(220, 225, 236);\r\n\r\n  Appearance.HoverFill.Color := MakeGraphicsColor(229, 231, 232);\r\n  Appearance.HoverFill.ColorTo := MakeGraphicsColor(210, 215, 215);\r\n  Appearance.HoverFill.ColorMirror := MakeGraphicsColor(200, 200, 216);\r\n  Appearance.HoverFill.ColorMirrorTo := MakeGraphicsColor(200, 205, 216);\r\n\r\n  Appearance.DownFill.Color := MakeGraphicsColor(219, 221, 222);\r\n  Appearance.DownFill.ColorTo := MakeGraphicsColor(200, 205, 205);\r\n  Appearance.DownFill.ColorMirror := MakeGraphicsColor(190, 190, 206);\r\n  Appearance.DownFill.ColorMirrorTo := MakeGraphicsColor(190, 195, 206);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SelectFirstValue;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SelectLastValue;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SelectNextValue;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SelectPreviousValue;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SelectValueWithCharacter(\r\n  ACharacter: Char);\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(FPopup) then\r\n    FPopup.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetAppearance(\r\n  const Value: TTMSFNCToolBarButtonAppearance);\r\nbegin\r\n  FAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetAutoBitmapSize(const Value: Boolean);\r\nbegin\r\n  if FAutoBitmapSize <> Value then\r\n  begin\r\n    FAutoBitmapSize := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetBitmaps(const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetBitmapSize(const Value: Single);\r\nbegin\r\n  if FBitmapSize <> Value then\r\n  begin\r\n    FBitmapSize := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetBitmapContainer(\r\n  const Value: TTMSFNCBitmapContainer);\r\nbegin\r\n  FBitmapContainer := Value;\r\n  UpdateLayout;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetBitmapPosition(\r\n  const Value: TTMSFNCToolBarButtonBitmapPosition);\r\nbegin\r\n  if FBitmapPosition <> Value then\r\n  begin\r\n    FBitmapPosition := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetBitmapVisible(const Value: Boolean);\r\nbegin\r\n  FBitmapVisible := Value;\r\n  UpdateLayout;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLargeLayoutAutoBitmapSize(\r\n  const Value: Boolean);\r\nbegin\r\n  if FLargeLayoutAutoBitmapSize <> Value then\r\n  begin\r\n    FLargeLayoutAutoBitmapSize := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLargeLayoutBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FLargeLayoutBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLargeLayoutBitmapSize(\r\n  const Value: Single);\r\nbegin\r\n  if FLargeLayoutBitmapSize <> Value then\r\n  begin\r\n    FLargeLayoutBitmapSize := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLargeLayoutDisabledBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FLargeLayoutDisabledBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLargeLayoutHoverBitmaps(\r\n  const Value: TTMSFNCScaledBitmaps);\r\nbegin\r\n  FLargeLayoutHoverBitmaps.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetLayout(\r\n  const Value: TTMSFNCToolBarButtonLayout);\r\nbegin\r\n  if FLayout <> Value then\r\n  begin\r\n    FLayout := Value;\r\n    UpdateLayout;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetCloseOnSelection(const Value: Boolean);\r\nbegin\r\n  if FCloseOnSelection <> Value then\r\n  begin\r\n    FCloseOnSelection := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetCompactLayout(\r\n  const Value: TTMSFNCToolBarButtonLayout);\r\nbegin\r\n  if FCompactLayout <> Value then\r\n    FCompactLayout := Value;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetName(const Value: TComponentName);\r\nvar\r\n  ChangeText: Boolean;\r\nbegin\r\n  ChangeText := not (csLoading in ComponentState) and (Name = Text) and\r\n    ((not Assigned(Owner)) or not (Owner is TComponent) or not (csLoading in TComponent(Owner).ComponentState));\r\n  inherited SetName(Value);\r\n  if ChangeText and ApplyName and CanChangeText then\r\n    Text := StringReplace(Text, 'TMSFNCToolBar', '', [rfReplaceAll]);\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetShowFocus(const Value: Boolean);\r\nbegin\r\n  if FShowFocus <> Value then\r\n  begin\r\n    FShowFocus := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetStretchBitmapIfNoText(\r\n  const Value: Boolean);\r\nbegin\r\n  if FStretchBitmapIfNoText <> Value then\r\n  begin\r\n    FStretchBitmapIfNoText := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetStretchText(const Value: Boolean);\r\nbegin\r\n  if FStretchText <> Value then\r\n  begin\r\n    FStretchText := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetText(const Value: String);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    FTextVisible := Value <> '';\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetTextVisible(const Value: Boolean);\r\nbegin\r\n  if FTextVisible <> Value then\r\n  begin\r\n    FTextVisible := Value;\r\n    UpdateLayout;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetTrimming(\r\n  const Value: TTMSFNCGraphicsTextTrimming);\r\nbegin\r\n  if FTrimming <> Value then\r\n  begin\r\n    FTrimming := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FVerticalTextAlign <> Value then\r\n  begin\r\n    FVerticalTextAlign := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.SetWordWrapping(const Value: Boolean);\r\nbegin\r\n  if FWordWrapping <> Value then\r\n  begin\r\n    FWordWrapping := Value;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.UpdateControlAfterResize;\r\nbegin\r\n  inherited;\r\n  if Layout = bblLarge then\r\n    FOldHeight := Height;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.UpdateLayout;\r\nvar\r\n  sz: TSizeF;\r\n  w: Single;\r\nbegin\r\n  if (Layout = bblNone) or FBlockUpdate then\r\n    Exit;\r\n\r\n  FBlockUpdate := True;\r\n  case Layout of\r\n    bblBitmap:\r\n    begin\r\n      TextVisible := False;\r\n      BitmapPosition := bbpLeft;\r\n      StretchText := False;\r\n      Height := Round(GetBitmapSize + 6);\r\n      Width := Round(GetBitmapSize + 6);\r\n    end;\r\n    bblLabel:\r\n    begin\r\n      TextVisible := True;\r\n      BitmapPosition := bbpLeft;\r\n      StretchText := False;\r\n      sz := GetTextSize;\r\n      if BitmapVisible then\r\n      begin\r\n        Height := Round(Max(GetBitmapSize, sz.cy) + 6);\r\n        Width := Round(GetBitmapSize + sz.cx + 12);\r\n      end\r\n      else if TextVisible and (Text <> '') then\r\n      begin\r\n        Height := Round(sz.cy + 6);\r\n        Width := Round(sz.cx + 6);\r\n      end\r\n      else\r\n      begin\r\n        Width := 75;\r\n        Height := 24;\r\n      end;\r\n    end;\r\n    bblLarge:\r\n    begin\r\n      TextVisible := True;\r\n      BitmapPosition := bbpTop;\r\n      StretchText := not BitmapVisible;\r\n\r\n      sz := GetTextSize;\r\n      w := 30;\r\n      if BitmapVisible then\r\n        w := Max(w, GetLargeLayoutBitmapSize + 6);\r\n\r\n      if TextVisible and (Text <> '') then\r\n        w := Max(w, sz.cx + 12);\r\n\r\n      Width := Round(w);\r\n\r\n      if FOldHeight <> -1 then\r\n        Height := Round(FOldHeight);\r\n    end;\r\n  end;\r\n  FBlockUpdate := False;\r\n\r\n  UpdateToolBar;\r\nend;\r\n\r\nprocedure TTMSFNCDefaultToolBarButton.UpdateState;\r\nvar\r\n  f: Single;\r\nbegin\r\n  inherited;\r\n  case FState of\r\n    esNormal: f := 0.8;\r\n    esLarge: f := 1.25;\r\n    else\r\n      f := 1;\r\n  end;\r\n\r\n  if not (csLoading in ComponentState) then\r\n  begin\r\n    DropDownWidth := DropDownWidth * f;\r\n    DropDownHeight := DropDownHeight * f;\r\n    {$IFDEF FMXLIB}\r\n    Font.Size := Font.Size * f;\r\n    SetBounds(Position.X, Position.Y, int(Width * f), int(Height * f));\r\n    {$ENDIF}\r\n    {$IFDEF VCLWEBLIB}\r\n    Font.Size := Round(Font.Size * f);\r\n    SetBounds(Left, Top, Round(Width * f), Round(Height * f));\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetCorners(const Value: TTMSFNCGraphicsCorners);\r\nbegin\r\n  if FCorners <> Value then\r\n  begin\r\n    FCorners := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetRounding(const Value: Single);\r\nbegin\r\n  if FRounding <> Value then\r\n  begin\r\n    FRounding := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.StrokeChanged(Sender: TObject);\r\nbegin\r\n  Changed;\r\nend;\r\n\r\n{ TTMSFNCCustomToolBarSeparator }\r\n\r\nprocedure TTMSFNCCustomToolBarSeparator.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomToolBarSeparator then\r\n  begin\r\n    FAppearance.Assign((Source as TTMSFNCCustomToolBarSeparator).Appearance);\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarSeparator.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  {$IFDEF FMXLIB}\r\n  Width := 3;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Width := 2;\r\n  {$ENDIF}\r\n  Height := 30;\r\n  FAppearance := TTMSFNCToolBarSeparatorAppearance.Create(Self);\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarSeparator.Destroy;\r\nbegin\r\n  FAppearance.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparator.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  cp: TPointF;\r\n  r: TRectF;\r\nbegin\r\n  inherited;\r\n  r := LocalRect;\r\n  {$IFDEF FMXLIB}\r\n  cp := r.CenterPoint;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  cp := PointF(r.Left, r.Top);\r\n  {$ENDIF}\r\n  AGraphics.Stroke.Assign(Appearance.Stroke);\r\n  AGraphics.DrawLine(PointF(cp.X, r.Top), PointF(cp.X, r.Bottom));\r\n  AGraphics.Stroke.Assign(Appearance.InnerStroke);\r\n  AGraphics.DrawLine(PointF(cp.X + 1, r.Top), PointF(cp.X + 1, r.Bottom));\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparator.SetAppearance(\r\n  const Value: TTMSFNCToolBarSeparatorAppearance);\r\nbegin\r\n  FAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparator.UpdateState;\r\nvar\r\n  f: Single;\r\nbegin\r\n  inherited;\r\n  case State of\r\n    esNormal: f := 0.8;\r\n    esLarge: f := 1.25;\r\n    else\r\n      f := 1;\r\n  end;\r\n\r\n  if not (csLoading in ComponentState) then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    SetBounds(Position.X, Position.Y, Width, int(Height * f));\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    SetBounds(Left, Top, Width, Round(Height * f));\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCToolBarCustomButtonAppearance }\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCToolBarCustomButtonAppearance then\r\n  begin\r\n    FNormalFill.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).NormalFill);\r\n    FDisabledFill.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).DisabledFill);\r\n    FHoverFill.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).HoverFill);\r\n    FDownFill.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).DownFill);\r\n    FNormalStroke.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).NormalStroke);\r\n    FDisabledStroke.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).DisabledStroke);\r\n    FHoverStroke.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).HoverStroke);\r\n    FDownStroke.Assign((Source as TTMSFNCToolBarCustomButtonAppearance).DownStroke);\r\n    FRounding := (Source as TTMSFNCToolBarCustomButtonAppearance).Rounding;\r\n    FCorners := (Source as TTMSFNCToolBarCustomButtonAppearance).Corners;\r\n    FShowInnerStroke := (Source as TTMSFNCToolBarCustomButtonAppearance).ShowInnerStroke;\r\n    FTransparent := (Source as TTMSFNCToolBarCustomButtonAppearance).Transparent;\r\n    FFlatStyle := (Source as TTMSFNCToolBarCustomButtonAppearance).FlatStyle;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.Changed;\r\nbegin\r\n  if Assigned(FOwner) then\r\n    FOwner.AppearanceChanged\r\n  else if Assigned(OnChange) then\r\n    OnChange(Self);\r\nend;\r\n\r\nconstructor TTMSFNCToolBarCustomButtonAppearance.Create(AOwner: TTMSFNCDefaultToolBarButton);\r\nbegin\r\n  FOwner := AOwner;\r\n  FCorners := [gcTopLeft, gcTopRight, gcBottomLeft, gcBottomRight];\r\n  FRounding := 3;\r\n  FTransparent := False;\r\n  FShowInnerStroke := True;\r\n  FFlatStyle := False;\r\n\r\n  FNormalFill := TTMSFNCGraphicsFill.Create(gfkGradient);\r\n  FHoverFill := TTMSFNCGraphicsFill.Create(gfkGradient);\r\n  FDownFill := TTMSFNCGraphicsFill.Create(gfkGradient);\r\n  FDisabledFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcLightgray);\r\n  FNormalStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n  FInnerStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcWhite);\r\n  FHoverStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n  FDownStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n  FDisabledStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n\r\n  FNormalFill.OnChanged := @FillChanged;\r\n  FHoverFill.OnChanged := @FillChanged;\r\n  FDownFill.OnChanged := @FillChanged;\r\n  FDisabledFill.OnChanged := @FillChanged;\r\n\r\n  FInnerStroke.OnChanged := @StrokeChanged;\r\n  FNormalStroke.OnChanged := @StrokeChanged;\r\n  FHoverStroke.OnChanged := @StrokeChanged;\r\n  FDownStroke.OnChanged := @StrokeChanged;\r\n  FDisabledStroke.OnChanged := @StrokeChanged;\r\n\r\n  FNormalFill.Color := MakeGraphicsColor(249, 251, 252);\r\n  FNormalFill.ColorTo := MakeGraphicsColor(230, 235, 235);\r\n  FNormalFill.ColorMirror := MakeGraphicsColor(220, 220, 236);\r\n  FNormalFill.ColorMirrorTo := MakeGraphicsColor(220, 225, 236);\r\n\r\n  FHoverFill.Color := MakeGraphicsColor(229, 231, 232);\r\n  FHoverFill.ColorTo := MakeGraphicsColor(210, 215, 215);\r\n  FHoverFill.ColorMirror := MakeGraphicsColor(200, 200, 216);\r\n  FHoverFill.ColorMirrorTo := MakeGraphicsColor(200, 205, 216);\r\n\r\n  FDownFill.Color := MakeGraphicsColor(219, 221, 222);\r\n  FDownFill.ColorTo := MakeGraphicsColor(200, 205, 205);\r\n  FDownFill.ColorMirror := MakeGraphicsColor(190, 190, 206);\r\n  FDownFill.ColorMirrorTo := MakeGraphicsColor(190, 195, 206);\r\nend;\r\n\r\ndestructor TTMSFNCToolBarCustomButtonAppearance.Destroy;\r\nbegin\r\n  FNormalFill.Free;\r\n  FHoverFill.Free;\r\n  FDownFill.Free;\r\n  FDisabledFill.Free;\r\n\r\n  FInnerStroke.Free;\r\n  FNormalStroke.Free;\r\n  FHoverStroke.Free;\r\n  FDownStroke.Free;\r\n  FDisabledStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.FillChanged(Sender: TObject);\r\nbegin\r\n  Changed;\r\nend;\r\n\r\nfunction TTMSFNCToolBarCustomButtonAppearance.IsRoundingStored: Boolean;\r\nbegin\r\n  Result := Rounding <> 3;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FDisabledFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetDisabledStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FDisabledStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetDownFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FDownFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetDownStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FDownStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetFlatStyle(const Value: Boolean);\r\nvar\r\n  c: TControl;\r\n  I: Integer;\r\nbegin\r\n  if FFlatStyle <> Value then\r\n  begin\r\n    FFlatStyle := Value;\r\n    if Assigned(FOwner) then\r\n    begin\r\n      for I := 0 to FOwner.ControlCount - 1 do\r\n      begin\r\n        c := FOwner.Controls[I];\r\n        {$IFDEF FMXLIB}\r\n        if Supports(c, IDesignerControl) then\r\n          Continue;\r\n        {$ENDIF}\r\n\r\n        if c is TTMSFNCDefaultToolBarButton then\r\n          (c as TTMSFNCDefaultToolBarButton).Appearance.FlatStyle := FlatStyle;\r\n\r\n        if c is TTMSFNCCustomToolBar then\r\n          (c as TTMSFNCCustomToolBar).Appearance.FlatStyle := FlatStyle;\r\n      end;\r\n    end;\r\n\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetHoverFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FHoverFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetHoverStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FHoverStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetInnerStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FInnerStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetNormalFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FNormalFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetNormalStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FNormalStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetShowInnerStroke(\r\n  const Value: Boolean);\r\nbegin\r\n  if FShowInnerStroke <> Value then\r\n  begin\r\n    FShowInnerStroke := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomButtonAppearance.SetTransparent(\r\n  const Value: Boolean);\r\nbegin\r\n  if FTransparent <> Value then\r\n  begin\r\n    FTransparent := Value;\r\n    Changed;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCCustomToolBarAppearance }\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomToolBarAppearance then\r\n  begin\r\n    FSeparatorStroke.Assign((Source as TTMSFNCCustomToolBarAppearance).SeparatorStroke);\r\n    FSeparator := (Source as TTMSFNCCustomToolBarAppearance).Separator;\r\n    FFill.Assign((Source as TTMSFNCCustomToolBarAppearance).Fill);\r\n    FStroke.Assign((Source as TTMSFNCCustomToolBarAppearance).Stroke);\r\n    FHorizontalSpacing := (Source as TTMSFNCCustomToolBarAppearance).HorizontalSpacing;\r\n    FVerticalSpacing := (Source as TTMSFNCCustomToolBarAppearance).VerticalSpacing;\r\n    FDragGripColor := (Source as TTMSFNCCustomToolBarAppearance).DragGripColor;\r\n    FDragGrip := (Source as TTMSFNCCustomToolBarAppearance).DragGrip;\r\n    FFlatStyle := (Source as TTMSFNCCustomToolBarAppearance).FlatStyle;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarAppearance.Create(AOwner: TTMSFNCCustomToolBar);\r\nbegin\r\n  FOwner := AOwner;\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FFlatStyle := False;\r\n  FHorizontalSpacing := 3;\r\n  FVerticalSpacing := 3;\r\n  FDragGrip := True;\r\n  FDragGripColor := gcLightgray;\r\n  FFill := TTMSFNCGraphicsFill.Create(gfkGradient);\r\n  FStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n\r\n  FFill.OnChanged := @FillChanged;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n\r\n  FFill.Color := gcWhite;\r\n  FFill.ColorTo := MakeGraphicsColor(230, 230, 230);\r\n\r\n  FSeparatorStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcWhite);\r\n  FSeparatorStroke.OnChanged := @StrokeChanged;\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarAppearance.Destroy;\r\nbegin\r\n  FSeparatorStroke.Free;\r\n  FFont.Free;\r\n  FFill.Free;\r\n  FStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.FillChanged(Sender: TObject);\r\nbegin\r\n  FOwner.Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarAppearance.IsHorizontalSpacingStored: Boolean;\r\nbegin\r\n  Result := HorizontalSpacing <> 3;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarAppearance.IsVerticalSpacingStored: Boolean;\r\nbegin\r\n  Result := VerticalSpacing <> 3;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetDragGrip(const Value: Boolean);\r\nbegin\r\n  if FDragGrip <> Value then\r\n  begin\r\n    FDragGrip := Value;\r\n    FOwner.UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetDragGripColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDragGripColor <> Value then\r\n  begin\r\n    FDragGripColor := Value;\r\n    FOwner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetFlatStyle(const Value: Boolean);\r\nbegin\r\n  if FFlatStyle <> Value then\r\n  begin\r\n    FFlatStyle := Value;\r\n    if Assigned(FOwner) then\r\n      FOwner.ApplyFlatStyle;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetHorizontalSpacing(\r\n  const Value: Single);\r\nbegin\r\n  if FHorizontalSpacing <> Value then\r\n  begin\r\n    FHorizontalSpacing := Value;\r\n    FOwner.UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetSeparator(const Value: Boolean);\r\nbegin\r\n  if FSeparator <> Value then\r\n  begin\r\n    FSeparator := Value;\r\n    FOwner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetSeparatorStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FSeparatorStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.SetVerticalSpacing(\r\n  const Value: Single);\r\nbegin\r\n  if FVerticalSpacing <> Value then\r\n  begin\r\n    FVerticalSpacing := Value;\r\n    FOwner.UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarAppearance.StrokeChanged(Sender: TObject);\r\nbegin\r\n  FOwner.Invalidate;\r\nend;\r\n\r\n{ TTMSFNCCustomToolBarSeparatorAppearance }\r\n\r\nprocedure TTMSFNCCustomToolBarSeparatorAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomToolBarSeparatorAppearance then\r\n  begin\r\n    Stroke.Assign((Source as TTMSFNCCustomToolBarSeparatorAppearance).Stroke);\r\n    InnerStroke.Assign((Source as TTMSFNCCustomToolBarSeparatorAppearance).InnerStroke);\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarSeparatorAppearance.Create(\r\n  AOwner: TTMSFNCCustomToolBarSeparator);\r\nbegin\r\n  FOwner := AOwner;\r\n  FStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n  FStroke.OnChanged := @StrokeChanged;\r\n  FInnerStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcWhite);\r\n  FInnerStroke.OnChanged := @StrokeChanged;\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarSeparatorAppearance.Destroy;\r\nbegin\r\n  FInnerStroke.Free;\r\n  FStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparatorAppearance.SetInnerStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FInnerStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparatorAppearance.SetStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarSeparatorAppearance.StrokeChanged(\r\n  Sender: TObject);\r\nbegin\r\n  FOwner.Invalidate;\r\nend;\r\n\r\n{ TTMSFNCCustomDockPanel }\r\n\r\nfunction TTMSFNCCustomDockPanel.AddToolBar(AIndex: Integer = -1): TTMSFNCToolBar;\r\nbegin\r\n  FBlockUpdate := True;\r\n  Result := TTMSFNCToolBar.Create(Self);\r\n  {$IFDEF FMXLIB}\r\n  if (AIndex >= 0) and (AIndex <= Self.ControlCount - 1) then\r\n    InsertObject(AIndex, Result)\r\n  else\r\n    AddObject(Result);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result.Parent := Self;\r\n  {$ENDIF}\r\n\r\n  FBlockUpdate := False;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.ApplyStyle;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleHeaderFillColor(c) then\r\n  begin\r\n    Appearance.Fill.Kind := gfkSolid;\r\n    Appearance.Fill.Color := c;\r\n  end;\r\n\r\n  if TTMSFNCStyles.GetStyleHeaderFillColorTo(c) then\r\n  begin\r\n    Appearance.Fill.Kind := gfkGradient;\r\n    Appearance.Fill.ColorTo := c;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomDockPanel then\r\n  begin\r\n    Appearance.Assign((Source as TTMSFNCCustomDockPanel).Appearance);\r\n    AutoSize := (Source as TTMSFNCCustomDockPanel).AutoSize;\r\n    AutoAlign := (Source as TTMSFNCCustomDockPanel).AutoAlign;\r\n    State := (Source as TTMSFNCCustomDockPanel).State;\r\n  end\r\n  else\r\n    inherited;\r\nend;\r\n\r\nconstructor TTMSFNCCustomDockPanel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FState := esNormal;\r\n  FAppearance := TTMSFNCDockPanelAppearance.Create(Self);\r\n  FAutoSize := True;\r\n  FAutoAlign := True;\r\n  {$IFDEF FMXLIB}\r\n  Align := TAlignLayout.Top;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Align := alTop;\r\n  {$ENDIF}\r\n  Height := 40;\r\nend;\r\n\r\ndestructor TTMSFNCCustomDockPanel.Destroy;\r\nbegin\r\n  FAppearance.Free;\r\n  inherited;\r\nend;\r\n\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomDockPanel.AlignControls(AControl: TControl; var Rect: TRect);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomDockPanel.DoAddObject(const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.DoInsertObject(Index: Integer;\r\n  const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.DoRealign;\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.DoRemoveObject(\r\n  const AObject: TFmxObject);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomDockPanel.GetVersion: String;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.InitializeControls;\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if c is TTMSFNCCustomToolBar then\r\n    begin\r\n      (c as TTMSFNCCustomToolBar).OnUpdateDockPanel := UpdateDockPanel;\r\n      if (c as TTMSFNCCustomToolBar).FDragGripMoving then\r\n        Continue;\r\n    end;\r\n\r\n    if c.Visible then\r\n    begin\r\n      {$IFDEF FMXLIB}\r\n      if c.Position.y < Appearance.Margins.Top then\r\n        c.Position.y := Appearance.Margins.Top;\r\n      if c.Position.x < Appearance.Margins.Left then\r\n        c.Position.x := Appearance.Margins.Left\r\n      else if c.Position.x + c.Width > Width - Appearance.Margins.Right then\r\n        c.Position.x := Width - Appearance.Margins.Right - c.Width;\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      if c.Top < Appearance.Margins.Top then\r\n        c.Top := Round(Appearance.Margins.Top);\r\n      if c.Left < Appearance.Margins.Left then\r\n        c.Left := Round(Appearance.Margins.Left)\r\n      else if c.Left + c.Width > Width - Appearance.Margins.Right then\r\n        c.Left := Round(Width - Appearance.Margins.Right - c.Width);\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  inherited;\r\n  AGraphics.Fill.Assign(Appearance.Fill);\r\n  AGraphics.Stroke.Assign(Appearance.Stroke);\r\n\r\n  r := LocalRect;\r\n  AGraphics.DrawRectangle(r);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.RearrangeControls;\r\nvar\r\n  c, cl: TControl;\r\n  cr, clr: TRectF;\r\n  I, J: Integer;\r\nbegin\r\n  for I := 0 to Self.ControlCount - 1 do\r\n  begin\r\n    c := Self.Controls[I];\r\n\r\n    {$IFDEF FMXLIB}\r\n    if Supports(c, IDesignerControl) then\r\n      Continue;\r\n    {$ENDIF}\r\n\r\n    if not c.Visible then\r\n      Continue;\r\n\r\n    if c is TTMSFNCCustomToolBar then\r\n    begin\r\n      if (c as TTMSFNCCustomToolBar).FDragGripMoving then\r\n        Continue;\r\n    end;\r\n\r\n    for J := 0 to Self.ControlCount - 1 do\r\n    begin\r\n      cl := Self.Controls[J];\r\n\r\n      if (cl = c) or not cl.Visible then\r\n        Continue;\r\n\r\n      {$IFDEF FMXLIB}\r\n      if Supports(cl, IDesignerControl) then\r\n        Continue;\r\n      {$ENDIF}\r\n\r\n      {$IFDEF FMXLIB}\r\n      cr := RectF(c.Position.X, c.Position.Y, c.Position.X + c.Width, c.Position.Y + c.Height);\r\n      clr := RectF(cl.Position.X, cl.Position.Y, cl.Position.X + cl.Width, cl.Position.Y + cl.Height);\r\n\r\n      if (clr.Left >= cr.Left - 3) and (clr.Left <= cr.Right + 3) then\r\n      begin\r\n        if (clr.Top < CenterPointEx(cr).Y) and (clr.Top >= cr.Top - 3) then\r\n        begin\r\n          cl.Position.X := c.Position.X + c.Width + 3;\r\n          cl.Position.Y := c.Position.Y;\r\n        end\r\n        else if (clr.Top >= CenterPointEx(cr).Y) and (clr.Top <= cr.Bottom + 3) then\r\n        begin\r\n          cl.Position.Y := c.Position.Y + c.Height + 3;\r\n          cl.Position.X := c.Position.X;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n\r\n      {$IFDEF CMNWEBLIB}\r\n      cr := RectF(c.Left, c.Top, c.Left + c.Width, c.Top + c.Height);\r\n      clr := RectF(cl.Left, cl.Top, cl.Left + cl.Width, cl.Top + cl.Height);\r\n\r\n      if (clr.Left >= cr.Left - 3) and (clr.Left <= cr.Right + 3) then\r\n      begin\r\n        if (clr.Top < CenterPointEx(cr).Y) and (clr.Top >= cr.Top - 3) then\r\n        begin\r\n          cl.Left := c.Left + c.Width + 3;\r\n          cl.Top := c.Top;\r\n        end\r\n        else if (clr.Top >= CenterPointEx(cr).Y) and (clr.Top <= cr.Bottom + 3) then\r\n        begin\r\n          cl.Top := c.Top + c.Height + 3;\r\n          cl.Left := c.Left;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.ResetToDefaultStyle;\r\nbegin\r\n  inherited;\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.SetAppearance(\r\n  const Value: TTMSFNCDockPanelAppearance);\r\nbegin\r\n  FAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.SetAutoAlign(const Value: Boolean);\r\nbegin\r\n  if FAutoAlign <> Value then\r\n  begin\r\n    FAutoAlign := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.SetAS(const Value: Boolean);\r\nbegin\r\n  if FAutoSize <> Value then\r\n  begin\r\n    FAutoSize := Value;\r\n    UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.SetState(\r\n  const Value: TTMSFNCToolBarElementState);\r\nvar\r\n  I: Integer;\r\n  c: TControl;\r\nbegin\r\n  if FState <> Value then\r\n  begin\r\n    FState := Value;\r\n    for I := 0 to Self.ControlCount - 1 do\r\n    begin\r\n      c := Self.Controls[I];\r\n      if c is TTMSFNCCustomToolBar then\r\n        (c as TTMSFNCCustomToolBar).State := FState;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.UpdateControls;\r\nvar\r\n  I: Integer;\r\n  {$IFDEF FMXLIB}\r\n  h, hsm: Single;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  h, hsm: Integer;\r\n  {$ENDIF}\r\n  c: TControl;\r\n  {$IFDEF FNCLIB}\r\n  ia: ITMSFNCAdaptToStyle;\r\n  {$ENDIF}\r\nbegin\r\n  if FBlockUpdate or IsLoading or IsDestroying then\r\n    Exit;\r\n\r\n  FBlockUpdate := True;\r\n  h := 0;\r\n  hsm := 30;\r\n\r\n  if AutoAlign then\r\n  begin\r\n    InitializeControls;\r\n    RearrangeControls;\r\n  end;\r\n\r\n  if AutoSize then\r\n  begin\r\n    for I := 0 to Self.ControlCount - 1 do\r\n    begin\r\n      c := Self.Controls[I];\r\n      {$IFDEF FMXLIB}\r\n      if Supports(c, IDesignerControl) then\r\n        Continue;\r\n\r\n      if c.Visible then\r\n        h := Max(h, c.Position.y + c.Height + Appearance.Margins.Bottom);\r\n      {$ENDIF}\r\n\r\n      {$IFDEF FNCLIB}\r\n      if Supports(c, ITMSFNCAdaptToStyle, ia) then\r\n        ia.AdaptToStyle := AdaptToStyle;\r\n      {$ENDIF}\r\n\r\n      {$IFDEF CMNWEBLIB}\r\n      if c.Visible then\r\n        h := Round(Max(h, c.Top + c.Height + Appearance.Margins.Bottom));\r\n      {$ENDIF}\r\n    end;\r\n\r\n    if h = 0 then\r\n      h := hsm;\r\n\r\n    if csDesigning in ComponentState then\r\n      h := h + 15;\r\n\r\n    {$IFDEF FMXLIB}\r\n    SetBounds(Position.X, Position.Y, Width, h);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    SetBounds(Left, Top, Width, h);\r\n    {$ENDIF}\r\n  end;\r\n\r\n  FBlockUpdate := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanel.UpdateDockPanel(Sender: TObject);\r\nbegin\r\n  UpdateControls;\r\nend;\r\n\r\n{ TTMSFNCCustomDockPanelAppearance }\r\n\r\nconstructor TTMSFNCCustomDockPanelAppearance.Create(AOwner: TTMSFNCCustomDockPanel);\r\nbegin\r\n  FOwner := AOwner;\r\n  FFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcGray);\r\n\r\n  FFill.OnChanged := @FillChanged;\r\n  FStroke.OnChanged := @StrokeChanged;\r\n  FMargins := TTMSFNCMargins.Create;\r\n  FMargins.Left := 3;\r\n  FMargins.Top := 3;\r\n  FMargins.Bottom := 3;\r\n  FMargins.Right := 3;\r\nend;\r\n\r\ndestructor TTMSFNCCustomDockPanelAppearance.Destroy;\r\nbegin\r\n  FMargins.Free;\r\n  FFill.Free;\r\n  FStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.FillChanged(Sender: TObject);\r\nbegin\r\n  FOwner.Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.MarginsChanged(\r\n  Sender: TObject);\r\nbegin\r\n  FOwner.UpdateControls;\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.SetMargins(\r\n  const Value: TTMSFNCMargins);\r\nbegin\r\n  FMargins.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.SetStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  FStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomDockPanelAppearance.StrokeChanged(Sender: TObject);\r\nbegin\r\n  FOwner.Invalidate;\r\nend;\r\n\r\n{ TTMSFNCCustomToolBarElement }\r\n\r\nprocedure TTMSFNCCustomToolBarElement.UpdateToolBarControl;\r\nbegin\r\n  if Assigned(OnUpdateToolBarControl) then\r\n    OnUpdateToolBarControl(Self);\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCCustomToolBarElement.ReadControlIndex(Reader: TReader);\r\nbegin\r\n  ControlIndex := Reader.ReadInteger;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarElement.WriteControlIndex(Writer: TWriter);\r\nbegin\r\n  Writer.WriteInteger(ControlIndex);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomToolBarElement.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomToolBarElement then\r\n  begin\r\n    FState := (Source as TTMSFNCCustomToolBarElement).State;\r\n    FLastElement := (Source as TTMSFNCCustomToolBarElement).LastElement;\r\n    FCanCopy := (Source as TTMSFNCCustomToolBarElement).CanCopy;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarElement.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  DisableBackground;\r\n  {$IFDEF CMNLIB}\r\n  ParentColor := True;\r\n  {$IFDEF VCLLIB}\r\n  ParentBackground := True;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  FLastElement := False;\r\n  FCanCopy := True;\r\n  FState := esNormal;\r\nend;\r\n\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCCustomToolBarElement.DefineProperties(Filer: TFiler);\r\nbegin\r\n  inherited;\r\n  {$IFDEF LCLLIB}\r\n  Filer.DefineProperty('ControlIndex', @ReadControlIndex, @WriteControlIndex, True);\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  Filer.DefineProperty('ControlIndex', ReadControlIndex, WriteControlIndex, True);\r\n  {$ENDIF}\r\nend;\r\n{$ENDIF}\r\n\r\ndestructor TTMSFNCCustomToolBarElement.Destroy;\r\nbegin\r\n  inherited;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBarElement.DoMatrixChanged(Sender: TObject);\r\nbegin\r\n  inherited;\r\n  UpdateToolBar;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomToolBarElement.UpdateControlAfterResize;\r\nbegin\r\n  inherited;\r\n  UpdateToolBar;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarElement.SetLastElement(const Value: Boolean);\r\nbegin\r\n  if FLastElement <> Value then\r\n  begin\r\n    FLastElement := Value;\r\n    UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarElement.SetState(\r\n  const Value: TTMSFNCToolBarElementState);\r\nbegin\r\n  if FState <> Value then\r\n  begin\r\n    FState := Value;\r\n    UpdateState;\r\n  end;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomToolBarElement.SetVisible(const Value: Boolean);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCCustomToolBarElement.VisibleChanging;\r\n{$ENDIF}\r\nbegin\r\n  inherited;\r\n  UpdateToolBar;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarElement.UpdateState;\r\nbegin\r\n\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarElement.UpdateToolBar;\r\nbegin\r\n  if Assigned(OnUpdateToolBar) and not FBlockUpdate then\r\n    OnUpdateToolBar(Self);\r\nend;\r\n\r\n{ TTMSFNCToolBarControl }\r\n\r\nconstructor TTMSFNCToolBarControl.Create;\r\nbegin\r\n  FBitmap := TTMSFNCBitmap.Create;\r\nend;\r\n\r\ndestructor TTMSFNCToolBarControl.Destroy;\r\nbegin \r\n  FBitmap.Free;\r\n  inherited;\r\nend;\r\n\r\n{ TTMSFNCCustomToolBarOptionsMenu }\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCCustomToolBarOptionsMenu then\r\n  begin\r\n    FShowItemText := (Source as TTMSFNCCustomToolBarOptionsMenu).ShowItemText;\r\n    FShowItemBitmap := (Source as TTMSFNCCustomToolBarOptionsMenu).ShowItemBitmap;\r\n    FShowButton := (Source as TTMSFNCCustomToolBarOptionsMenu).ShowButton;\r\n    FAutoItemBitmapWidth := (Source as TTMSFNCCustomToolBarOptionsMenu).AutoItemBitmapWidth;\r\n    FItemBitmapWidth := (Source as TTMSFNCCustomToolBarOptionsMenu).ItemBitmapWidth;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCCustomToolBarOptionsMenu.Create(\r\n  AOwner: TTMSFNCCustomToolBar);\r\nbegin\r\n  FOwner := AOwner;\r\n  FShowItemText := True;\r\n  FShowButton := True;\r\n  FShowItemBitmap := True;\r\n  FAutoItemBitmapWidth := True;\r\n  FItemBitmapWidth := 50;\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarOptionsMenu.Destroy;\r\nbegin\r\n\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarOptionsMenu.IsItemBitmapWidthStored: Boolean;\r\nbegin\r\n  Result := ItemBitmapWidth <> 50;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.SetAutoItemBitmapWidth(\r\n  const Value: Boolean);\r\nbegin\r\n  if FAutoItemBitmapWidth <> Value then\r\n  begin\r\n    FAutoItemBitmapWidth := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.SetItemBitmapWidth(\r\n  const Value: Single);\r\nbegin\r\n  if FItemBitmapWidth <> Value then\r\n  begin\r\n    FItemBitmapWidth := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.SetShowButton(const Value: Boolean);\r\nbegin\r\n  if FShowButton <> Value then\r\n  begin\r\n    FShowButton := Value;\r\n    FOwner.FOptionsMenuButton.Visible := FShowButton;\r\n    if FShowButton then\r\n      FOwner.FOptionsMenuButton.Parent := FOwner\r\n    else\r\n      FOwner.FOptionsMenuButton.Parent := nil;\r\n\r\n    FOwner.UpdateControls;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.SetShowItemBitmap(\r\n  const Value: Boolean);\r\nbegin\r\n  if FShowItemBitmap <> Value then\r\n  begin\r\n    FShowItemBitmap := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarOptionsMenu.SetShowItemText(const Value: Boolean);\r\nbegin\r\n  if FShowItemText <> Value then\r\n  begin\r\n    FShowItemText := Value;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCToolBarFontNamePicker }\r\n\r\nconstructor TTMSFNCToolBarFontNamePicker.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  AutoOptionsMenuText := 'Font Name';\r\n  TTMSFNCUtils.GetFonts(FItems);\r\n  {$IFDEF LCLLIB}\r\n  FItems.Insert(0, 'Default');\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontNamePicker.DoItemSelected;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnFontNameSelected) then\r\n    OnFontNameSelected(Self, SelectedFontName);\r\nend;\r\n\r\nfunction TTMSFNCToolBarFontNamePicker.GetSelectedFontName: String;\r\nbegin\r\n  Result := GetSelectedItem;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontNamePicker.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarFontNamePicker);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontNamePicker.SetSelectedFontName(const Value: String);\r\nbegin\r\n  SelectedItem := Value;\r\nend;\r\n\r\n{ TTMSFNCToolBarFontNamePicker }\r\n\r\nconstructor TTMSFNCToolBarFontSizePicker.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  AutoOptionsMenuText := 'Font Size';\r\n  FItems.Add('8');\r\n  FItems.Add('9');\r\n  FItems.Add('10');\r\n  FItems.Add('11');\r\n  FItems.Add('12');\r\n  FItems.Add('14');\r\n  FItems.Add('16');\r\n  FItems.Add('18');\r\n  FItems.Add('20');\r\n  FItems.Add('22');\r\n  FItems.Add('24');\r\n  FItems.Add('26');\r\n  FItems.Add('28');\r\n  FItems.Add('36');\r\n  FItems.Add('48');\r\n  FItems.Add('72');\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontSizePicker.DoItemSelected;\r\nbegin\r\n  inherited;\r\n  if Assigned(OnFontSizeSelected) then\r\n    OnFontSizeSelected(Self, SelectedFontSize);\r\nend;\r\n\r\nfunction TTMSFNCToolBarFontSizePicker.GetSelectedFontSize: Single;\r\nvar\r\n  s: String;\r\nbegin\r\n  Result := -1;\r\n  s := GetSelectedItem;\r\n  if s <> '' then\r\n    Result := StrToFloat(GetSelectedItem)\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontSizePicker.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarFontSizePicker);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarFontSizePicker.SetSelectedFontSize(const Value: Single);\r\nbegin\r\n  SelectedItem := FloatToStr(Value);\r\nend;\r\n\r\n{ TTMSFNCToolBarColorPicker }\r\n\r\nfunction TTMSFNCToolBarColorPicker.BlockChange: Boolean;\r\nbegin\r\n  Result := FColorSelector.BlockChange;\r\nend;\r\n\r\nfunction TTMSFNCToolBarColorPicker.CanChangeText: Boolean;\r\nbegin\r\n  Result := not (csLoading in ComponentState) and not (csDesigning in ComponentState);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.ColorSelected(Sender: TObject;\r\n  AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if CloseOnSelection and not BlockChange then\r\n    CloseDropDown;\r\n  DoColorSelected(AColor);\r\n  Invalidate;\r\nend;\r\n\r\nfunction TTMSFNCToolBarColorPicker.ColorSelector: TTMSFNCColorSelector;\r\nbegin\r\n  Result := FColorSelector;\r\nend;\r\n\r\nconstructor TTMSFNCToolBarColorPicker.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Width := 40;\r\n  Height := 24;\r\n  AutoOptionsMenuText := 'Color';\r\n  FColorSelector := TTMSFNCColorSelector.Create(Self);\r\n  FColorSelector.Appearance.HorizontalSpacing := 2;\r\n  FColorSelector.Appearance.VerticalSpacing := 2;\r\n  FColorSelector.Mode := csmExtended;\r\n  FColorSelector.Width := 175;\r\n  FColorSelector.Height := 125;\r\n  FColorSelector.Stored := False;\r\n  FColorSelector.SelectedColor := gcBlack;\r\n  FColorSelector.OnColorSelected := ColorSelected;\r\n\r\n  DropDownControl := FColorSelector;\r\n  DropDownWidth := FColorSelector.Width;\r\n  DropDownHeight := FColorSelector.Height;\r\n  DropDownKind := ddkDropDownButton;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.DoColorSelected(AColor: TTMSFNCGraphicsColor);\r\nbegin\r\n  if Assigned(OnColorSelected) then\r\n    OnColorSelected(Self, AColor);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.DrawColor(AColor: TTMSFNCGraphicsColor;\r\n  ARect: TRectF; AGraphics: TTMSFNCGraphics);\r\nvar\r\n  r: TRectF;\r\n  I, J: Integer;\r\n  st: TTMSFNCGraphicsSaveState;\r\nbegin\r\n  R := ARect;\r\n  InflateRectEx(R, -3.5, -3.5);\r\n  OffsetRectEx(R, 0.5, 0.5);\r\n  st := AGraphics.SaveState;\r\n  try\r\n    AGraphics.ClipRect(R);\r\n    AGraphics.Stroke.Kind := gskNone;\r\n    AGraphics.Fill.Kind := gfkSolid;\r\n    AGraphics.Stroke.Width := 1;\r\n    AGraphics.Fill.Color := MakeGraphicsColor(255, 255, 255);\r\n    AGraphics.DrawRectangle(R);\r\n    AGraphics.Fill.Color := MakeGraphicsColor(211 , 211 , 211 );\r\n    for I := 0 to Trunc((r.Right - r.Left) / 5) + 1 do\r\n      for J := 0 to Trunc((r.Bottom - r.Top) / 5) + 1 do\r\n        if Odd(I + J) then\r\n          AGraphics.DrawRectangle(RectF(I * 5, J * 5, (I + 1) * 5, (J + 1) * 5), gcrmNone);\r\n\r\n    AGraphics.Fill.Kind := gfkSolid;\r\n    AGraphics.Fill.Color := AColor;\r\n    AGraphics.Stroke.Color := gcBlack;\r\n    AGraphics.Stroke.Kind := gskSolid;\r\n    AGraphics.DrawRectangle(R);\r\n  finally\r\n    AGraphics.RestoreState(st);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.DrawSelectedColor(\r\n  AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  R: TRectF;\r\n  c: TTMSFNCGraphicsColor;\r\n  ct: TTMSFNCToolBarDropDownButton;\r\nbegin\r\n  ct := GetDropDownButtonControl;\r\n  if Assigned(ct) then\r\n  begin\r\n    R := RectF(0, 0, Width - ct.Width, Height);\r\n    c := SelectedColor;\r\n    DrawColor(c, r, AGraphics);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCToolBarColorPicker.GetItems: TTMSFNCColorSelectorItems;\r\nbegin\r\n  Result := FColorSelector.Items;\r\nend;\r\n\r\nfunction TTMSFNCToolBarColorPicker.GetSelectedColor: TTMSFNCGraphicsColor;\r\nbegin\r\n  Result := FColorSelector.SelectedColor;\r\nend;\r\n\r\nfunction TTMSFNCToolBarColorPicker.GetSelectedItemIndex: Integer;\r\nbegin\r\n  Result := FColorSelector.SelectedItemIndex;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarColorPicker);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nbegin\r\n  inherited;\r\n  DrawSelectedColor(AGraphics, ARect);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(FColorSelector) then\r\n    FColorSelector.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.SetItems(\r\n  const Value: TTMSFNCColorSelectorItems);\r\nbegin\r\n  FColorSelector.Items.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.SetSelectedColor(const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  FColorSelector.SelectedColor := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarColorPicker.SetSelectedItemIndex(const Value: Integer);\r\nbegin\r\n  FColorSelector.SelectedItemIndex := Value;\r\n  Invalidate;\r\nend;\r\n\r\n{ TTMSFNCToolBarBitmapPicker }\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.BitmapSelector: TTMSFNCBitmapSelector;\r\nbegin\r\n  Result := FBitmapSelector;\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.BlockChange: Boolean;\r\nbegin\r\n  Result := FBitmapSelector.BlockChange;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.BitmapSelected(Sender: TObject;\r\n  ABitmap: TTMSFNCBitmap);\r\nbegin\r\n  Bitmaps.Clear;\r\n  DisabledBitmaps.Clear;\r\n  HoverBitmaps.Clear;\r\n  Bitmaps.AddBitmap(ABitmap);\r\n  DisabledBitmaps.AddBitmap(ABitmap);\r\n  HoverBitmaps.AddBitmap(ABitmap);\r\n\r\n  if CloseOnSelection and not BlockChange then\r\n    CloseDropDown;\r\n  DoBitmapSelected(ABitmap);\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.CanChangeText: Boolean;\r\nbegin\r\n  Result := not (csLoading in ComponentState) and not (csDesigning in ComponentState);\r\nend;\r\n\r\nconstructor TTMSFNCToolBarBitmapPicker.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Width := 40;\r\n  Height := 24;\r\n  AutoOptionsMenuText := 'Bitmap';\r\n  FBitmapSelector := TTMSFNCBitmapSelector.Create(Self);\r\n  FBitmapSelector.Appearance.HorizontalSpacing := 2;\r\n  FBitmapSelector.Appearance.VerticalSpacing := 2;\r\n  FBitmapSelector.Stored := False;\r\n  FBitmapSelector.OnBitmapSelected := BitmapSelected;\r\n\r\n  DropDownControl := FBitmapSelector;\r\n  DropDownWidth := FBitmapSelector.Width;\r\n  DropDownHeight := FBitmapSelector.Height;\r\n  DropDownKind := ddkDropDownButton;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.DoBitmapSelected(ABitmap: TTMSFNCBitmap);\r\nbegin\r\n  if Assigned(OnBitmapSelected) then\r\n    OnBitmapSelected(Self, ABitmap);\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.GetBitmapRect(ARect: TRectF): TRectF;\r\nvar\r\n  r: TRectF;\r\n  dr: TRectf;\r\nbegin\r\n  r := ARect;\r\n  Result := RectF(r.Left, r.Top, r.Right, r.Bottom);\r\n  if BitmapVisible then\r\n  begin\r\n    if DropDownKind <> ddkNormal then\r\n    begin\r\n      dr := GetDropDownRect;\r\n      case DropDownPosition of\r\n        ddpRight: Result := RectF(Result.Left + 3, Result.Top + 3, dr.Left - 3, Result.Bottom - 3);\r\n        ddpBottom: Result := RectF(Result.Left + 3, Result.Top + 3, Result.Right - 3, dr.Top - 3);\r\n      end;\r\n    end\r\n    else\r\n      Result := RectF(Result.Left + 3, Result.Top + 3, Result.Right - 3, Result.Bottom - 3);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.GetItems: TTMSFNCBitmapSelectorItems;\r\nbegin\r\n  Result := FBitmapSelector.Items;\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.GetSelectedBitmap: TTMSFNCBitmap;\r\nbegin\r\n  Result := FBitmapSelector.SelectedBitmap;\r\nend;\r\n\r\nfunction TTMSFNCToolBarBitmapPicker.GetSelectedItemIndex: Integer;\r\nbegin\r\n  Result := FBitmapSelector.SelectedItemIndex;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarBitmapPicker);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(FBitmapSelector) then\r\n    FBitmapSelector.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.SetItems(\r\n  const Value: TTMSFNCBitmapSelectorItems);\r\nbegin\r\n  FBitmapSelector.Items.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarBitmapPicker.SetSelectedItemIndex(const Value: Integer);\r\nbegin\r\n  FBitmapSelector.SelectedItemIndex := Value;\r\n  Bitmaps.Clear;\r\n  DisabledBitmaps.Clear;\r\n  HoverBitmaps.Clear;\r\n  Bitmaps.AddBitmap(SelectedBitmap);\r\n  DisabledBitmaps.AddBitmap(SelectedBitmap);\r\n  HoverBitmaps.AddBitmap(SelectedBitmap);\r\n  Invalidate;\r\nend;\r\n\r\n{ TTMSFNCToolBarDropDownButton }\r\n\r\nfunction TTMSFNCToolBarDropDownButton.GetBitmapRect(ARect: TRectF): TRectF;\r\nvar\r\n  r: TRectF;\r\nbegin\r\n  r := ARect;\r\n  Result := RectF(r.Left + 3, r.Top + 3, r.Right - 3, r.Bottom - 3);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarDropDownButton.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarDropDownButton);\r\nend;\r\n\r\n{ TTMSFNCToolBarCustomItemPicker }\r\n\r\nfunction TTMSFNCToolBarCustomItemPicker.CanChangeText: Boolean;\r\nbegin\r\n  Result := not (csLoading in ComponentState) and not (csDesigning in ComponentState);\r\nend;\r\n\r\nconstructor TTMSFNCToolBarCustomItemPicker.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FTimer := TTimer.Create(Self);\r\n  FTimer.Interval := 1;\r\n  FTimer.OnTimer := EnterTimerChanged;\r\n  FTimer.Enabled := False;\r\n\r\n  FEdit := TEdit.Create(Self);\r\n  FEdit.TabStop := True;\r\n  {$IFDEF FMXLIB}\r\n  FEdit.Align := TAlignLayout.Client;\r\n  FEdit.Stored := False;\r\n  FEdit.OnChangeTracking := EditChange;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  FEdit.Align := alClient;\r\n  FEdit.OnChange := @EditChange;\r\n  {$ENDIF}\r\n\r\n  Width := 100;\r\n  Height := 24;\r\n  HorizontalTextAlign := gtaLeading;\r\n  FItemIndex := -1;\r\n\r\n  FItemSelector := TListBox.Create(Self);\r\n  FItemSelector.Width := 200;\r\n  FItemSelector.Height := 150;\r\n  {$IFDEF LCLLIB}\r\n  FItemSelector.ClickOnSelChange := False;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  FItemSelector.Align := TAlignLayout.Client;\r\n  FItemSelector.OnItemClick := ItemSelected;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  FItemSelector.Align := alClient;\r\n  FItemSelector.OnClick := ItemSelected;\r\n  {$ENDIF}\r\n\r\n  FItemSelector.OnKeyUp := @ItemKeyUp;\r\n  FItemSelector.OnKeyDown := @ItemKeyDown;\r\n\r\n  DropDownControl := FItemSelector;\r\n  DropDownKind := ddkDropDownButton;\r\n  DropDownWidth := FItemSelector.Width;\r\n  DropDownHeight := FItemSelector.Height;\r\n\r\n  FItems := TStringList.Create;\r\nend;\r\n\r\ndestructor TTMSFNCToolBarCustomItemPicker.Destroy;\r\nbegin\r\n  FTimer.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.DoEnter;\r\nbegin\r\n  inherited;\r\n  FTimer.Enabled := Editable;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.DoItemSelected;\r\nbegin\r\n  if Assigned(FEdit) {$IFDEF CMNWEBLIB} and FEdit.HandleAllocated{$ENDIF} then\r\n  begin\r\n    FEdit.Text := SelectedItem;\r\n    FEdit.SelStart := Length(FEdit.Text);\r\n  end;\r\n\r\n  if Assigned(OnItemSelected) then\r\n    OnItemSelected(Self, SelectedItemIndex);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.Draw(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF);\r\nbegin\r\n  if not Editable then\r\n    inherited;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.DropDown;\r\nbegin\r\n  inherited;\r\n  if not Assigned(FPopup) then\r\n    Exit;\r\n\r\n  if FPopup.IsOpen and Assigned(FItemSelector) then\r\n  begin\r\n    FItemSelector.ItemIndex := -1;\r\n    FItemSelector.ItemIndex := SelectedItemIndex;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.EditChange(Sender: TObject);\r\nbegin\r\n  SelectedItem := FEdit.Text;\r\n  if Assigned(OnEditChange) then\r\n    OnEditChange(Self);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.EnterTimerChanged(Sender: TObject);\r\nbegin\r\n  FEdit.SetFocus;\r\n  FTimer.Enabled := False;\r\nend;\r\n\r\nfunction TTMSFNCToolBarCustomItemPicker.GetSelectedItem: String;\r\nbegin\r\n  Result := '';\r\n  if (FItemIndex >= 0) and (FItemIndex <= FItems.Count - 1) then\r\n    Result := FItems[FItemIndex]\r\nend;\r\n\r\nfunction TTMSFNCToolBarCustomItemPicker.GetSelectedItemIndex: Integer;\r\nbegin\r\n  Result := FItemIndex;\r\nend;\r\n\r\nfunction TTMSFNCToolBarCustomItemPicker.GetText: String;\r\nbegin\r\n  if Editable then\r\n    Result := FEdit.Text\r\n  else\r\n    Result := SelectedItem;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.HandleDialogKey(var Key: Word;\r\n  Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if Shift <> [] then\r\n    Exit;\r\n\r\n  if Editable and FEdit.IsFocused then\r\n  begin\r\n    case Key of\r\n      KEY_F4:\r\n      begin\r\n        if not (ssAlt in Shift) then\r\n          DropDown;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.InitializePopup;\r\nbegin\r\n  {$IFDEF FMXLIB}\r\n  FItemSelector.BeginUpdate;\r\n  {$ENDIF}\r\n  FItemSelector.Items.Clear;\r\n  FItemSelector.Items.Assign(FItems);\r\n  FItemSelector.ItemIndex := FItemIndex;\r\n  {$IFDEF FMXLIB}\r\n  FItemSelector.EndUpdate;\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemKeyDown(Sender: TObject; var Key: Word; var KeyChar: Char; Shift: TShiftState);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);\r\n{$ENDIF}\r\nbegin\r\n  FKeyboardUsed := True;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemKeyUp(Sender: TObject; var Key: Word; var KeyChar: Char; Shift: TShiftState);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemKeyUp(Sender: TObject; var Key: Word; Shift: TShiftState);\r\n{$ENDIF}\r\nbegin\r\n  if (Key = KEY_RETURN) or (Key = KEY_SPACE) then\r\n  begin\r\n    FItemIndex := FItemSelector.ItemIndex;\r\n    if CloseOnSelection then\r\n      DropDown;\r\n\r\n    DoItemSelected;\r\n    Invalidate;\r\n  end;\r\n\r\n  FKeyBoardUsed := False;\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemSelected(const Sender: TCustomListBox; const Item: TListBoxItem);\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nprocedure TTMSFNCToolBarCustomItemPicker.ItemSelected(Sender: TObject);\r\n{$ENDIF}\r\nbegin\r\n  if FKeyBoardUsed then\r\n    Exit;\r\n\r\n  FItemIndex := FItemSelector.ItemIndex;\r\n  if CloseOnSelection then\r\n    DropDown;\r\n\r\n  DoItemSelected;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectFirstValue;\r\nbegin\r\n  inherited;\r\n  FItemIndex := 0;\r\n  DoItemSelected;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectLastValue;\r\nbegin\r\n  inherited;\r\n  FItemIndex := FItems.Count - 1;\r\n  DoItemSelected;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectNextValue;\r\nbegin\r\n  inherited;\r\n  if FItemIndex = -1 then\r\n    FItemIndex := 0\r\n  else\r\n    FItemIndex := Min(FItems.Count - 1, FItemIndex + 1);\r\n\r\n  DoItemSelected;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectPreviousValue;\r\nbegin\r\n  inherited;\r\n  if FItemIndex = -1 then\r\n    FItemIndex := 0\r\n  else\r\n    FItemIndex := Max(0, FItemIndex - 1);\r\n\r\n  DoItemSelected;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectValueWithCharacter(\r\n  ACharacter: Char);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if TTMSFNCUtils.MatchStrEx(ACharacter + '*', Items[I], False) then\r\n    begin\r\n      FItemIndex := I;\r\n      DoItemSelected;\r\n      Invalidate;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SelectValueWithString(AValue: string);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if TTMSFNCUtils.MatchStrEx(AValue + '*', Items[I], False) then\r\n    begin\r\n      FItemIndex := I;\r\n      DoItemSelected;\r\n      Invalidate;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SetEditable(const Value: Boolean);\r\nbegin\r\n  if FEditable <> Value then\r\n  begin\r\n    FEditable := Value;\r\n    if Assigned(FEdit) then\r\n    begin\r\n      if FEditable then\r\n      begin\r\n        FEdit.Parent := Self;\r\n      end\r\n      else\r\n        FEdit.Parent := nil;\r\n\r\n      FEdit.Visible := FEditable;\r\n    end;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SetItems(const Value: TStringList);\r\nbegin\r\n  FItems.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SetSelectedItem(const Value: String);\r\nbegin\r\n  FItemIndex := FItems.IndexOf(Value);\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarCustomItemPicker.SetSelectedItemIndex(\r\n  const Value: Integer);\r\nbegin\r\n  FItemIndex := Value;\r\n  Invalidate;\r\nend;\r\n\r\n{ TTMSFNCToolBarButton }\r\n\r\nprocedure TTMSFNCToolBarButton.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarButton);\r\nend;\r\n\r\n{ TTMSFNCToolBarSeparator }\r\n\r\nprocedure TTMSFNCToolBarSeparator.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarSeparator);\r\nend;\r\n\r\n{ TTMSFNCToolBar }\r\n\r\nprocedure TTMSFNCToolBar.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBar);\r\nend;\r\n\r\n{$IFDEF WEBLIB}\r\nfunction TTMSFNCToolBarControlObjectList.GetItem(\r\n  Index: Integer): TTMSFNCToolBarControl;\r\nbegin\r\n  Result := TTMSFNCToolBarControl(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarControlObjectList.SetItem(Index: Integer; const Value: TTMSFNCToolBarControl);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCToolBarControlList.GetItem(\r\n  Index: Integer): TTMSFNCToolBarControl;\r\nbegin\r\n  Result := TTMSFNCToolBarControl(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCToolBarControlList.SetItem(Index: Integer; const Value: TTMSFNCToolBarControl);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCControlList.GetItem(Index: Integer): TControl;\r\nbegin\r\n  Result := TControl(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCControlList.SetItem(Index: Integer; const Value: TControl);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n{$ENDIF}\r\n\r\ninitialization\r\n  RegisterClass(TTMSFNCToolBarButton);\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCToolBarPopup;\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n\r\ninterface\r\n\r\nuses\r\n  Classes, WEBLib.TMSFNCPopup, WEBLib.TMSFNCToolBar, WEBLib.TMSFNCTypes\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Types\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 0; // Release nr.\r\n  BLD_VER = 0; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : first release\r\n\r\ntype\r\n  TTMSFNCCustomToolBarPopup = class;\r\n\r\n  TTMSFNCToolBarPopupButton = class(TCollectionItem)\r\n  private\r\n    FOwner: TTMSFNCCustomToolBarPopup;\r\n    FButton: TTMSFNCToolBarButton;\r\n    FText: String;\r\n    FDataBoolean: Boolean;\r\n    FTag: Integer;\r\n    FDataString: String;\r\n    FDataObject: TObject;\r\n    FDataInteger: NativeInt;\r\n    FWidth: Single;\r\n    FHeight: Single;\r\n    FEnabled: Boolean;\r\n    FVisible: Boolean;\r\n    FTop: Single;\r\n    FLeft: Single;\r\n    FLastElement: Boolean;\r\n    FBitmap: TTMSFNCBitmap;\r\n    FDataPointer: Pointer;\r\n    procedure SetText(const Value: string);\r\n    procedure SetHeight(const Value: Single);\r\n    procedure SetWidth(const Value: Single);\r\n    function IsHeightStored: Boolean;\r\n    function IsWidthStored: Boolean;\r\n    procedure SetEnabled(const Value: Boolean);\r\n    procedure SetVisible(const Value: Boolean);\r\n    function IsLeftStored: Boolean;\r\n    function IsTopStored: Boolean;\r\n    procedure SetLeft(const Value: Single);\r\n    procedure SetTop(const Value: Single);\r\n    procedure SetLastElement(const Value: Boolean);\r\n    procedure SetBitmap(const Value: TTMSFNCBitmap);\r\n  protected\r\n    procedure BitmapChanged(Sender: TObject);\r\n  public\r\n    constructor Create(ACollection: TCollection); override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    destructor Destroy; override;\r\n    property Button: TTMSFNCToolBarButton read FButton;\r\n    property DataPointer: Pointer read FDataPointer write FDataPointer;\r\n    property DataBoolean: Boolean read FDataBoolean write FDataBoolean;\r\n    property DataObject: TObject read FDataObject write FDataObject;\r\n    property DataString: String read FDataString write FDataString;\r\n    property DataInteger: NativeInt read FDataInteger write FDataInteger;\r\n  published\r\n    property Text: String read FText write SetText;\r\n    property Tag: Integer read FTag write FTag;\r\n    property Left: Single read FLeft write SetLeft stored IsLeftStored nodefault;\r\n    property Top: Single read FTop write SetTop stored IsTopStored nodefault;\r\n    property Width: Single read FWidth write SetWidth stored IsWidthStored nodefault;\r\n    property Height: Single read FHeight write SetHeight stored IsHeightStored nodefault;\r\n    property Enabled: Boolean read FEnabled write SetEnabled default True;\r\n    property Visible: Boolean read FVisible write SetVisible default True;\r\n    property LastElement: Boolean read FLastElement write SetLastElement default False;\r\n    property Bitmap: TTMSFNCBitmap read FBitmap write SetBitmap;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCToolBarPopupButtons = class(TTMSFNCOwnedCollection)\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCToolBarPopupButtons = class({$IFDEF LCLLIB}specialize {$ENDIF}TTMSFNCOwnedCollection<TTMSFNCToolBarPopupButton>)\r\n  {$ENDIF}\r\n  private\r\n    FOwner: TTMSFNCCustomToolBarPopup;\r\n    function GetItem(Index: Integer): TTMSFNCToolBarPopupButton;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCToolBarPopupButton);\r\n  protected\r\n    function CreateItemClass: TCollectionItemClass; virtual;\r\n    function GetOwner: TPersistent; override;\r\n  public\r\n    constructor Create(AOwner: TTMSFNCCustomToolBarPopup); virtual;\r\n    property Items[Index: Integer]: TTMSFNCToolBarPopupButton read GetItem write SetItem; default;\r\n    function Add: TTMSFNCToolBarPopupButton;\r\n    function Insert(Index: Integer): TTMSFNCToolBarPopupButton;\r\n  end;\r\n\r\n  TTMSFNCToolBarPopupButtonClickEvent = procedure(Sender: TObject; AButton: TTMSFNCToolBarPopupButton) of object;\r\n\r\n  TTMSFNCCustomToolBarPopup = class(TTMSFNCCustomNonFocusablePopup)\r\n  private\r\n    FActivate: Boolean;\r\n    FToolBar: TTMSFNCToolBar;\r\n    FButtons: TTMSFNCToolBarPopupButtons;\r\n    FButtonClick: TTMSFNCToolBarPopupButtonClickEvent;\r\n    FOnDeactivate: TNotifyEvent;\r\n    FOnActivate: TNotifyEvent;\r\n    procedure SetButtons(const Value: TTMSFNCToolBarPopupButtons);\r\n    function GetAutoAlign: Boolean;\r\n    procedure SetAutoAlign(const Value: Boolean);\r\n    function GetDragGrip: Boolean;\r\n    procedure SetDragGrip(const Value: Boolean);\r\n  protected\r\n    function GetVersion: String; override;\r\n    function CreateToolBar: TTMSFNCToolBar; virtual;\r\n    function FindPopupButton(AButton: TTMSFNCToolBarButton): TTMSFNCToolBarPopupButton; virtual;\r\n    procedure SetAdaptToStyle(const Value: Boolean); override;\r\n    procedure UpdateControls(Sender: TObject);\r\n    procedure UpdateToolBar; virtual;\r\n    procedure PrepareToolBar; virtual;\r\n    procedure ActivatePopup;\r\n    procedure DeactivatePopup;\r\n    procedure DoClosePopup; override;\r\n    procedure ToolBarClick(Sender: TObject);\r\n    procedure ToolBarButtonClick(Sender: TObject);\r\n    procedure DoDragGripMoving(Sender: TObject; ADeltaX: Double; ADeltaY: Double); virtual;\r\n    property Buttons: TTMSFNCToolBarPopupButtons read FButtons write SetButtons;\r\n    property OnButtonClick: TTMSFNCToolBarPopupButtonClickEvent read FButtonClick write FButtonClick;\r\n    property AutoAlign: Boolean read GetAutoAlign write SetAutoAlign default True;\r\n    property OnActivate: TNotifyEvent read FOnActivate write FOnActivate;\r\n    property OnDeactivate: TNotifyEvent read FOnDeactivate write FOnDeactivate;\r\n    property DragGrip: Boolean read GetDragGrip write SetDragGrip default False;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    destructor Destroy; override;\r\n    procedure Activate; virtual;\r\n    procedure Deactivate; virtual;\r\n    function DropDownActive: Boolean; virtual;\r\n    function Activated: Boolean;\r\n    property ToolBar: TTMSFNCToolBar read FToolBar;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatforms)]\r\n  {$ENDIF}\r\n  TTMSFNCToolBarPopup = class(TTMSFNCCustomToolBarPopup)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  published\r\n    property AdaptToStyle;\r\n    property OnButtonClick;\r\n    property AutoAlign;\r\n    property Buttons;\r\n    property Placement;\r\n    property PlacementRectangle;\r\n    property PlacementControl;\r\n    property OnActivate;\r\n    property OnDeactivate;\r\n    property Version;\r\n    property DragGrip;\r\n  end;\r\n\r\nimplementation\r\n\r\nuses\r\n  WEBLib.Forms, WEBLib.TMSFNCUtils\r\n  {$IFNDEF LCLLIB}\r\n  ,Types\r\n  {$ENDIF}\r\n  ;\r\n\r\n{$R 'TMSFNCToolBarPopup.res'}\r\n\r\ntype\r\n  TTMSFNCToolBarOpen = class(TTMSFNCToolBar);\r\n\r\n{ TTMSFNCCustomToolBarPopup }\r\n\r\nconstructor TTMSFNCCustomToolBarPopup.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  Placement := ppMouse;\r\n  FButtons := TTMSFNCToolBarPopupButtons.Create(Self);\r\n  FToolBar := CreateToolBar;\r\n  if not (csDesigning in ComponentState) then\r\n    FToolBar.Parent := Self;\r\n  FToolBar.AutoAlign := True;\r\n  FToolBar.OnClick := ToolBarClick;\r\n  FToolBar.TabStop := False;\r\n  FToolBar.AllowFocus := False;\r\n  FToolBar.OptionsMenu.ShowButton := False;\r\n  FToolBar.Appearance.DragGrip := False;\r\n  FToolBar.OnDragGripMoving := DoDragGripMoving;\r\n  FToolBar.AutoMoveToolBar := False;\r\n  TTMSFNCToolBarOpen(FToolBar).OnUpdateControls := UpdateControls;\r\n  ContentControl := FToolBar;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.CreateToolBar: TTMSFNCToolBar;\r\nbegin\r\n  Result := TTMSFNCToolBar.Create(Self)\r\nend;\r\n\r\ndestructor TTMSFNCCustomToolBarPopup.Destroy;\r\nbegin\r\n  FButtons.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.DoClosePopup;\r\nbegin\r\n  inherited;\r\n  {$IFDEF FNCLIB}\r\n  {$IFNDEF LCLLIB}\r\n  if Assigned(PopupForm) then\r\n    PopupForm.DisposeOf;\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  if Assigned(PopupForm) then\r\n    PopupForm.Free;\r\n  {$ENDIF}\r\n  {$ELSE}\r\n  if Assigned(PopupForm) then\r\n    PopupForm.Free;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.DoDragGripMoving(Sender: TObject; ADeltaX,\r\n  ADeltaY: Double);\r\nbegin\r\n  if Assigned(PopupForm) then\r\n  begin\r\n    PopupForm.Left := PopupForm.Left - Round(ADeltaX);\r\n    PopupForm.Top := PopupForm.Top - Round(ADeltaY);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.DropDownActive: Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(ToolBar) then\r\n    Result := ToolBar.DropDownActive;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.FindPopupButton(\r\n  AButton: TTMSFNCToolBarButton): TTMSFNCToolBarPopupButton;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to FButtons.Count - 1 do\r\n  begin\r\n    if AButton = FButtons[I].FButton then\r\n    begin\r\n      Result := FButtons[I];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.GetAutoAlign: Boolean;\r\nbegin\r\n  Result := TTMSFNCToolBarOpen(FToolBar).AutoAlign;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.GetDragGrip: Boolean;\r\nbegin\r\n  Result := TTMSFNCToolBarOpen(FToolBar).Appearance.DragGrip;\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.GetVersion: String;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.PrepareToolBar;\r\nbegin\r\n  if Assigned(FToolBar) then\r\n    FToolBar.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.SetAdaptToStyle(const Value: Boolean);\r\nbegin\r\n  inherited;\r\n  if Assigned(FToolBar) then\r\n    FToolBar.AdaptToStyle := AdaptToStyle;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.SetAutoAlign(const Value: Boolean);\r\nbegin\r\n  TTMSFNCToolBarOpen(FToolBar).AutoAlign := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.SetButtons(\r\n  const Value: TTMSFNCToolBarPopupButtons);\r\nbegin\r\n  FButtons.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.SetDragGrip(const Value: Boolean);\r\nbegin\r\n  TTMSFNCToolBarOpen(FToolBar).Appearance.DragGrip := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.ActivatePopup;\r\nbegin\r\n  DoCreatePopup(False);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.Assign(Source: TPersistent);\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomToolBarPopup then\r\n  begin\r\n    FButtons.Assign((Source as TTMSFNCCustomToolBarPopup).Buttons);\r\n    AutoAlign := (Source as TTMSFNCCustomToolBarPopup).AutoAlign;\r\n    DragGrip := (Source as TTMSFNCCustomToolBarPopup).DragGrip;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.ToolBarButtonClick(Sender: TObject);\r\nbegin\r\n  if Assigned(OnButtonClick) then\r\n    OnButtonClick(Self, FindPopupButton((Sender as TTMSFNCToolBarButton)));\r\n  ActivatePreviousWindow;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.ToolBarClick(Sender: TObject);\r\nbegin\r\n  ActivatePreviousWindow;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.UpdateControls(Sender: TObject);\r\nbegin\r\n  UpdateToolBar;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.UpdateToolBar;\r\nbegin\r\n  if (csLoading in ComponentState) or (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  DropDownWidth := FToolBar.Width;\r\n  DropDownHeight := FToolBar.Height;\r\n  {$IFDEF FMXLIB}\r\n  if Assigned(PopupForm) then\r\n    PopupForm.ApplyPlacement;\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.Activate;\r\nvar\r\n  {$IFDEF FMXLIB}\r\n  frm: TCommonCustomForm;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  frm: TForm;\r\n  {$ENDIF}\r\nbegin\r\n  if Activated then\r\n    Deactivate;\r\n\r\n  {$IFNDEF WEBLIB}\r\n  frm := Screen.ActiveForm;\r\n  if not Assigned(frm) then\r\n    frm := Application.MainForm;\r\n  {$ENDIF}\r\n\r\n  if Assigned(ToolBar) then\r\n  begin\r\n    ToolBar.Parent := frm;\r\n    ToolBar.Visible := False;\r\n  end;\r\n\r\n  PrepareToolBar;\r\n  ActivatePopup;\r\n  UpdateToolBar;\r\n  FActivate := True;\r\n  if Assigned(OnActivate) then\r\n    OnActivate(Self);\r\nend;\r\n\r\nfunction TTMSFNCCustomToolBarPopup.Activated: Boolean;\r\nbegin\r\n  Result := HasPopupForm;\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.Deactivate;\r\nbegin\r\n  DeactivatePopup;\r\n  FActivate := False;\r\n  if Assigned(OnDeactivate) then\r\n    OnDeactivate(Self);\r\nend;\r\n\r\nprocedure TTMSFNCCustomToolBarPopup.DeactivatePopup;\r\nbegin\r\n  ClosePopup;\r\nend;\r\n\r\n{ TTMSFNCToolBarPopupButton }\r\n\r\nprocedure TTMSFNCToolBarPopupButton.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCToolBarPopupButton then\r\n  begin\r\n    FText := (Source as TTMSFNCToolBarPopupButton).Text;\r\n    FWidth := (Source as TTMSFNCToolBarPopupButton).Width;\r\n    FHeight := (Source as TTMSFNCToolBarPopupButton).Height;\r\n    FLeft := (Source as TTMSFNCToolBarPopupButton).Left;\r\n    FTop := (Source as TTMSFNCToolBarPopupButton).Top;\r\n    FEnabled := (Source as TTMSFNCToolBarPopupButton).Enabled;\r\n    FVisible := (Source as TTMSFNCToolBarPopupButton).Visible;\r\n    FBitmap.Assign((Source as TTMSFNCToolBarPopupButton).Bitmap);\r\n    FLastElement := (Source as TTMSFNCToolBarPopupButton).LastElement;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.BitmapChanged(Sender: TObject);\r\nbegin\r\n  if Assigned(FButton) and not IsBitmapEmpty(FBitmap) then\r\n  begin\r\n    FButton.Bitmaps.Clear;\r\n    FButton.Bitmaps.AddBitmap(FBitmap);\r\n  end;\r\n\r\n  if Assigned(FOwner) then\r\n    FOwner.UpdateToolBar;\r\nend;\r\n\r\nconstructor TTMSFNCToolBarPopupButton.Create(ACollection: TCollection);\r\nbegin\r\n  inherited;\r\n  if Assigned(Collection) then\r\n    FOwner := (Collection as TTMSFNCToolBarPopupButtons).FOwner;\r\n\r\n  FBitmap := TTMSFNCBitmap.Create;\r\n  FBitmap.OnChange := @BitmapChanged;\r\n  FWidth := -1;\r\n  FHeight := -1;\r\n  FTop := -1;\r\n  FLeft := -1;\r\n  FVisible := True;\r\n  FEnabled := True;\r\n  FLastElement := False;\r\n\r\n  if Assigned(FOwner) and Assigned(FOwner.FToolBar) then\r\n  begin\r\n    FButton := TTMSFNCToolBarButton.Create(FOwner.FToolBar);\r\n    FButton.TabStop := False;\r\n    FButton.AllowFocus := False;\r\n    FButton.Parent := FOwner.FToolBar;\r\n    FButton.OnClick := FOwner.ToolBarButtonClick;\r\n  end;\r\n\r\n  if Assigned(FOwner) then\r\n  begin\r\n    if Assigned(FOwner.FToolBar) then\r\n      FOwner.FToolBar.AddCustomControl(FButton, Index);\r\n    FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\ndestructor TTMSFNCToolBarPopupButton.Destroy;\r\nbegin\r\n  FBitmap.Free;\r\n  inherited;\r\n  if Assigned(FOwner) then\r\n    FOwner.UpdateToolBar;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButton.IsHeightStored: Boolean;\r\nbegin\r\n  Result := Height <> -1;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButton.IsLeftStored: Boolean;\r\nbegin\r\n  Result := Left <> -1;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButton.IsTopStored: Boolean;\r\nbegin\r\n  Result := Top <> -1;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButton.IsWidthStored: Boolean;\r\nbegin\r\n  Result := Width <> -1;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetBitmap(const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FBitmap <> Value then\r\n  begin\r\n    FBitmap.Assign(Value);\r\n    if Assigned(FButton) and not IsBitmapEmpty(FBitmap) then\r\n    begin\r\n      FButton.Bitmaps.Clear;\r\n      FButton.Bitmaps.AddBitmap(FBitmap);\r\n    end;\r\n\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetEnabled(const Value: Boolean);\r\nbegin\r\n  if FEnabled <> Value then\r\n  begin\r\n    FEnabled := Value;\r\n    if Assigned(FButton) then\r\n      FButton.Enabled := FEnabled;\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetHeight(const Value: Single);\r\nbegin\r\n  if FHeight <> Value then\r\n  begin\r\n    FHeight := Value;\r\n    if Assigned(FButton) and (FHeight > -1) then\r\n      FButton.Height := Round(FHeight);\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetLastElement(const Value: Boolean);\r\nbegin\r\n  if FLastElement <> Value then\r\n  begin\r\n    FLastElement := Value;\r\n    if Assigned(FButton) then\r\n      FButton.LastElement := FLastElement;\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetLeft(const Value: Single);\r\nbegin\r\n  if FLeft <> Value then\r\n  begin\r\n    FLeft := Value;\r\n    if Assigned(FButton) and (FLeft > -1) then\r\n      FButton.Left := Round(FLeft);\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetText(const Value: String);\r\nbegin\r\n  if FText <> Value then\r\n  begin\r\n    FText := Value;\r\n    if Assigned(FButton) then\r\n      FButton.Text := FText;\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetTop(const Value: Single);\r\nbegin\r\n  if FTop <> Value then\r\n  begin\r\n    FTop := Value;\r\n    if Assigned(FButton) and (FTop > -1) then\r\n      FButton.Top := Round(FTop);\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetVisible(const Value: Boolean);\r\nbegin\r\n  if FVisible <> Value then\r\n  begin\r\n    FVisible := Value;\r\n    if Assigned(FButton) then\r\n      FButton.Visible := FVisible;\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButton.SetWidth(const Value: Single);\r\nbegin\r\n  if FWidth <> Value then\r\n  begin\r\n    FWidth := Value;\r\n    if Assigned(FButton) and (FWidth > -1) then\r\n      FButton.Width := Round(FWidth);\r\n    if Assigned(FOwner) then\r\n      FOwner.UpdateToolBar;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCToolBarPopupButtons }\r\n\r\nfunction TTMSFNCToolBarPopupButtons.Add: TTMSFNCToolBarPopupButton;\r\nbegin\r\n  Result := TTMSFNCToolBarPopupButton(inherited Add);\r\nend;\r\n\r\nconstructor TTMSFNCToolBarPopupButtons.Create(AOwner: TTMSFNCCustomToolBarPopup);\r\nbegin\r\n  inherited Create(AOwner, CreateItemClass);\r\n  FOwner := AOwner;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButtons.CreateItemClass: TCollectionItemClass;\r\nbegin\r\n  Result := TTMSFNCToolBarPopupButton;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButtons.GetItem(\r\n  Index: Integer): TTMSFNCToolBarPopupButton;\r\nbegin\r\n  Result := TTMSFNCToolBarPopupButton(inherited Items[Index]);\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButtons.GetOwner: TPersistent;\r\nbegin\r\n  Result := FOwner;\r\nend;\r\n\r\nfunction TTMSFNCToolBarPopupButtons.Insert(\r\n  Index: Integer): TTMSFNCToolBarPopupButton;\r\nbegin\r\n  Result := TTMSFNCToolBarPopupButton(inherited Insert(Index));\r\nend;\r\n\r\nprocedure TTMSFNCToolBarPopupButtons.SetItem(Index: Integer;\r\n  const Value: TTMSFNCToolBarPopupButton);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\n{ TTMSFNCToolBarPopup }\r\n\r\nprocedure TTMSFNCToolBarPopup.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCToolBarPopup);\r\nend;\r\n\r\nend.\r\n","{********************************************************************}\r\n{                                                                    }\r\n{ written by TMS Software                                            }\r\n{            copyright  2016                                        }\r\n{            Email : info@tmssoftware.com                            }\r\n{            Web : http://www.tmssoftware.com                        }\r\n{                                                                    }\r\n{ The source code is given as is. The author is not responsible      }\r\n{ for any possible damage done due to the use of this code.          }\r\n{ The complete source code remains property of the author and may    }\r\n{ not be distributed, published, given or sold in any form as such.  }\r\n{ No parts of the source code can be included in any other component }\r\n{ or application without written authorization of the author.        }\r\n{********************************************************************}\r\n\r\nunit WEBLib.TMSFNCPlanner;\r\n\r\ninterface\r\n\r\n{$I WEBLib.TMSFNCDefines.inc}\r\n\r\n{$IFDEF FMXLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF CMNLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF WEBLIB}\r\n{$DEFINE CMNWEBLIB}\r\n{$DEFINE LCLWEBLIB}\r\n{$DEFINE FMXWEBLIB}\r\n{$ENDIF}\r\n{$IFDEF LCLLIB}\r\n{$DEFINE LCLWEBLIB}\r\n{$ENDIF}\r\n\r\nuses\r\n  Classes, Types, WEBLib.Controls, WEBLib.TMSFNCCustomControl, WEBLib.TMSFNCImage, WEBLib.TMSFNCPlannerData, WEBLib.Graphics,\r\n  WEBLib.TMSFNCBitmapContainer, WEBLib.TMSFNCGraphics, WEBLib.StdCtrls, WEBLib.ExtCtrls, WEBLib.TMSFNCPopup,\r\n  WEBLib.TMSFNCPlannerBase, WEBLib.TMSFNCTypes, WEBLib.TMSFNCCustomComponent, WEBLib.TMSFNCToolBarPopup, WEBLib.TMSFNCGraphicsTypes\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.DateTimeCtrls, FMX.ListBox, FMX.Edit, FMX.Memo, FMX.Objects, FMX.Types\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,Generics.Collections, Generics.Defaults, UITypes\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  {$IFDEF VCLLIB}\r\n  ,ComCtrls\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,Contnrs\r\n  {$ENDIF}\r\n  {$IFDEF LCLLIB}\r\n  ,fgl, DateTimePicker\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  ,SysUtils\r\n  {$ENDIF}\r\n  ;\r\n\r\nconst\r\n  TTMSFNCPlannerDocURL = 'http://www.tmssoftware.biz/download/manuals/TMSFNCPlannerDevGuide.pdf';\r\n  CACHEWIDTH = 1000;\r\n  CACHEHEIGHT = 1000;\r\n  {$IFDEF ANDROID}\r\n  SCROLLINGDELAY = 40;\r\n  {$ELSE}\r\n  SCROLLINGDELAY = 0;\r\n  {$ENDIF}\r\n  {$IFDEF FMXLIB}\r\n  TMSFNCPlannerAreaColor = $BFA9A9A9;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TMSFNCPlannerAreaColor = $BDAA86;\r\n  {$ENDIF}\r\n\r\nconst\r\n  MAJ_VER = 1; // Major version nr.\r\n  MIN_VER = 0; // Minor version nr.\r\n  REL_VER = 0; // Release nr.\r\n  BLD_VER = 9; // Build nr.\r\n\r\n  // version history\r\n  // v1.0.0.0 : first release\r\n  // v1.0.0.1 : Fixed: Issue with displaying items in pmMultiMonth mode\r\n  //          : Fixed: Issue selecting multiple items programmatically\r\n  // v1.0.0.2 : Fixed: Issue with cell to custom datetime conversion\r\n  //          : Fixed: Issue with moving, sizing items in custom mode\r\n  // v1.0.0.3 : Improved: UnselectItem & UnselectAllItems\r\n  //          : Fixed: Issue with destroying planner on mobile operating systems\r\n  // v1.0.0.4 : Fixed: Issue with auto-sizing of labels\r\n  // v1.0.0.5 : Fixed: Issue with design-time initialization of SwipeToNextDateTime\r\n  // v1.0.0.6 : Improved: Exposed OnAfterItemChanged\r\n  // v1.0.0.7 : Fixed: Issue with minimum size of item\r\n  // v1.0.0.8 : Improved: Right mouse button excluded from being able to select a range\r\n  // v1.0.0.9 : Fixed: Issue getting current time in dmDay mode\r\n\r\nresourcestring\r\n  sTMSFNCPlannerOK = 'OK';\r\n  sTMSFNCPlannerCancel = 'Cancel';\r\n  sTMSFNCPlannerRemove = 'Remove';\r\n  sTMSFNCPlannerStartTime = 'Start Time';\r\n  sTMSFNCPlannerEndTime = 'End Time';\r\n  sTMSFNCPlannerPosition = 'Position';\r\n  sTMSFNCPlannerTitle = 'Title';\r\n  sTMSFNCPlannerText = 'Text';\r\n\r\ntype\r\n  TTMSFNCCustomPlanner = class;\r\n\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCPlannerDateEdit = class(TDateEdit);\r\n  TTMSFNCPlannerTimeEdit = class(TTimeEdit);\r\n  TTMSFNCPlannerMemo = class(TMemo);\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCPlannerDateEdit = class(TDateTimePicker);\r\n  TTMSFNCPlannerTimeEdit = class(TDateTimePicker);\r\n  TTMSFNCPlannerMemo = class(TMemo)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n  protected\r\n    procedure KeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure DoExit; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerCache = class(TObjectList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerCacheItem read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCPlannerDisplayList = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerCacheItem read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerCache = class(TObjectList<TTMSFNCPlannerCacheItem>);\r\n  TTMSFNCPlannerDisplayList = class(TList<TTMSFNCPlannerCacheItem>);\r\n  {$ENDIF}\r\n  TTMSFNCPlannerGridCache = class(TTMSFNCPlannerCache);\r\n  TTMSFNCPlannerItemCache = class(TTMSFNCPlannerCache);\r\n  TTMSFNCPlannerPositionsCache = class(TTMSFNCPlannerCache);\r\n  TTMSFNCPlannerPositionsTopCache = class(TTMSFNCPlannerPositionsCache);\r\n  TTMSFNCPlannerPositionsBottomCache = class(TTMSFNCPlannerPositionsCache);\r\n  TTMSFNCPlannerGroupsCache = class(TTMSFNCPlannerCache);\r\n  TTMSFNCPlannerGroupsTopCache = class(TTMSFNCPlannerGroupsCache);\r\n  TTMSFNCPlannerGroupsBottomCache = class(TTMSFNCPlannerGroupsCache);\r\n  TTMSFNCPlannerTimeLineCache = class(TTMSFNCPlannerCache);\r\n  TTMSFNCPlannerTimeLineLeftCache = class(TTMSFNCPlannerTimeLineCache);\r\n  TTMSFNCPlannerTimeLineRightCache = class(TTMSFNCPlannerTimeLineCache);\r\n\r\n  TTMSFNCPlannerGridDisplayList = class(TTMSFNCPlannerDisplayList);\r\n  TTMSFNCPlannerItemDisplayList = class(TTMSFNCPlannerDisplayList);\r\n  TTMSFNCPlannerPositionsDisplayList = class(TTMSFNCPlannerDisplayList);\r\n  TTMSFNCPlannerPositionsTopDisplayList = class(TTMSFNCPlannerPositionsDisplayList);\r\n  TTMSFNCPlannerPositionsBottomDisplayList = class(TTMSFNCPlannerPositionsDisplayList);\r\n  TTMSFNCPlannerGroupsDisplayList = class(TTMSFNCPlannerDisplayList);\r\n  TTMSFNCPlannerGroupsTopDisplayList = class(TTMSFNCPlannerGroupsDisplayList);\r\n  TTMSFNCPlannerGroupsBottomDisplayList = class(TTMSFNCPlannerGroupsDisplayList);\r\n  TTMSFNCPlannerTimeLineDisplayList = class(TTMSFNCPlannerDisplayList);\r\n  TTMSFNCPlannerTimeLineLeftDisplayList = class(TTMSFNCPlannerTimeLineDisplayList);\r\n  TTMSFNCPlannerTimeLineRightDisplayList = class(TTMSFNCPlannerTimeLineDisplayList);\r\n\r\n  TTMSFNCPlannerPositionsLayout = (pplTop, pplBottom);\r\n  TTMSFNCPlannerPositionsLayouts = set of TTMSFNCPlannerPositionsLayout;\r\n\r\n  TTMSFNCPlannerGroupLayout = (pglTop, pglBottom);\r\n  TTMSFNCPlannerGroupsLayouts = set of TTMSFNCPlannerGroupLayout;\r\n\r\n  TTMSFNCPlannerTimeLineLayout = (ptlLeft, ptlRight);\r\n  TTMSFNCPlannerTimeLineLayouts = set of TTMSFNCPlannerTimeLineLayout;\r\n\r\n  TTMSFNCPlannerDisplayGroup = record\r\n    StartPosition: Integer;\r\n    EndPosition: Integer;\r\n    {$IFDEF LCLLIB}\r\n    class operator = (z1, z2 : TTMSFNCPlannerDisplayGroup) b : Boolean;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  TTMSFNCPlannerAdapter = class(TTMSFNCCustomComponent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FActive: boolean;\r\n    procedure SetActive(const Value: boolean);\r\n  protected\r\n    function GetInstance: NativeUInt; override;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n  public\r\n    property Planner: TTMSFNCCustomPlanner read FPlanner write FPlanner;\r\n    procedure LoadItems; virtual;\r\n    procedure GetItems(PeriodFrom,PeriodTo: TDateTime); virtual; abstract;\r\n    procedure DeleteItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure InsertItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure UpdateItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure AfterUpdateItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure SelectItem(AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    procedure UpdateItems; virtual;\r\n    constructor Create(AOwner: TComponent); override;\r\n  published\r\n    property Active: Boolean read FActive write SetActive default False;\r\n  end;\r\n\r\n  {$IFDEF FMXLIB}\r\n  TTMSFNCPlannerInplaceEditor = TControl;\r\n  TTMSFNCPlannerEditingDialogContentPanel = TControl;\r\n  TTMSFNCPlannerCustomParent = TFmxObject;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  TTMSFNCPlannerInplaceEditor = TWinControl;\r\n  TTMSFNCPlannerEditingDialogContentPanel = TWinControl;\r\n  TTMSFNCPlannerCustomParent = TWinControl;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerInplaceEditorClass = class of TTMSFNCPlannerInplaceEditor;\r\n  {$ENDIF}\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerInplaceEditorClass = class of TWinControl;\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerCustomItemEditor = class(TTMSFNCCustomComponent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FCreated: Boolean;\r\n    FInitialized: Boolean;\r\n  protected\r\n    function GetInstance: NativeUInt; override;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    property Created: Boolean read FCreated write FCreated default False;\r\n    property Initialized: Boolean read FInitialized write FInitialized default False;\r\n  public\r\n    property Planner: TTMSFNCCustomPlanner read FPlanner write FPlanner;\r\n    function CreateInstance: TTMSFNCPlannerCustomItemEditor; virtual; abstract;\r\n    procedure CreateCustomContentPanel; virtual; abstract;\r\n    procedure InitializeCustomContentPanel; virtual; abstract;\r\n    procedure GetCustomContentPanel(AItem: TTMSFNCPlannerItem; var AContentPanel: TTMSFNCPlannerEditingDialogContentPanel); virtual; abstract;\r\n    procedure ItemToCustomContentPanel(AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel); virtual; abstract;\r\n    procedure CustomContentPanelToItem(AContentPanel: TTMSFNCPlannerEditingDialogContentPanel; AItem: TTMSFNCPlannerItem); virtual; abstract;\r\n    constructor Create(AOwner: TComponent); override;\r\n    procedure Assign({%H-}Source: TPersistent); override;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerDisplayGroups = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerDisplayGroup;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerDisplayGroup);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerDisplayGroup read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerDisplayGroups = class(TList<TTMSFNCPlannerDisplayGroup>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerConflict = class\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    {$IFNDEF LCLLIB}\r\n    {$IFNDEF WEBLIB}\r\n    FCompareResourceDates: IComparer<TTMSFNCPlannerResourceDate>;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FNeedsConflictsUpdate: Boolean;\r\n    FItems: TTMSFNCPlannerResourceItems;\r\n    FDates: TTMSFNCPlannerResourceDates;\r\n    FPosition: Integer;\r\n  protected\r\n    property NeedsConflictsUpdate: Boolean read FNeedsConflictsUpdate write FNeedsConflictsUpdate;\r\n    property Position: Integer read FPosition write FPosition;\r\n    property Items: TTMSFNCPlannerResourceItems read FItems write FItems;\r\n    property Dates: TTMSFNCPlannerResourceDates read FDates write FDates;\r\n    procedure UpdateItems;\r\n    procedure UpdateDates;\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerConflicts = class(TObjectList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerConflict;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerConflict);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerConflict read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerConflicts = class(TObjectList<TTMSFNCPlannerConflict>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerGridCellAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FVerticalStroke: TTMSFNCGraphicsStroke;\r\n    FHorizontalStroke: TTMSFNCGraphicsStroke;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FDisabledFill: TTMSFNCGraphicsFill;\r\n    FInActiveFill: TTMSFNCGraphicsFill;\r\n    FHorizontalSubStroke: TTMSFNCGraphicsStroke;\r\n    procedure SetHorizontalStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetVerticalStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetInActiveFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetHorizontalSubStroke(const Value: TTMSFNCGraphicsStroke);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property VerticalStroke: TTMSFNCGraphicsStroke read FVerticalStroke write SetVerticalStroke;\r\n    property HorizontalStroke: TTMSFNCGraphicsStroke read FHorizontalStroke write SetHorizontalStroke;\r\n    property HorizontalSubStroke: TTMSFNCGraphicsStroke read FHorizontalSubStroke write SetHorizontalSubStroke;\r\n    property InActiveFill: TTMSFNCGraphicsFill read FInActiveFill write SetInActiveFill;\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property DisabledFill: TTMSFNCGraphicsFill read FDisabledFill write SetDisabledFill;\r\n  end;\r\n\r\n  TTMSFNCPlannerLinkArrowShape = (lasNormal, lasFilled);\r\n\r\n  TTMSFNCPlannerItemsAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FGap: Double;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    FStroke: TTMSFNCGraphicsStroke;\r\n    FFont: TTMSFNCGraphicsFont;\r\n    FTitleFill: TTMSFNCGraphicsFill;\r\n    FTitleStroke: TTMSFNCGraphicsStroke;\r\n    FTitleFont: TTMSFNCGraphicsFont;\r\n    FDisabledTitleStroke: TTMSFNCGraphicsStroke;\r\n    FSelectedTitleStroke: TTMSFNCGraphicsStroke;\r\n    FActiveTitleStroke: TTMSFNCGraphicsStroke;\r\n    FDisabledFont: TTMSFNCGraphicsFont;\r\n    FSelectedFont: TTMSFNCGraphicsFont;\r\n    FActiveFont: TTMSFNCGraphicsFont;\r\n    FDisabledFill: TTMSFNCGraphicsFill;\r\n    FSelectedFill: TTMSFNCGraphicsFill;\r\n    FActiveFill: TTMSFNCGraphicsFill;\r\n    FDisabledStroke: TTMSFNCGraphicsStroke;\r\n    FDisabledTitleFont: TTMSFNCGraphicsFont;\r\n    FSelectedStroke: TTMSFNCGraphicsStroke;\r\n    FSelectedTitleFont: TTMSFNCGraphicsFont;\r\n    FActiveStroke: TTMSFNCGraphicsStroke;\r\n    FActiveTitleFont: TTMSFNCGraphicsFont;\r\n    FDisabledTitleFill: TTMSFNCGraphicsFill;\r\n    FSelectedTitleFill: TTMSFNCGraphicsFill;\r\n    FActiveTitleFill: TTMSFNCGraphicsFill;\r\n    FSizeAreaSize: Double;\r\n    FMoveAreaSize: Double;\r\n    FMoveAreaColor: TTMSFNCGraphicsColor;\r\n    FSizeAreaColor: TTMSFNCGraphicsColor;\r\n    FShowMoveArea: Boolean;\r\n    FShowSizeArea: Boolean;\r\n    FTextVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTitleHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTextHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTitleVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FShowItemHelpers: Boolean;\r\n    FShowItemSizeHandlers: Boolean;\r\n    FSizeHandlerWidth: Double;\r\n    FSizeHandlerHeight: Double;\r\n    FSizeHandlerUpBitmap: TTMSFNCBitmap;\r\n    FSizeHandlerLeftBitmap: TTMSFNCBitmap;\r\n    FSizeHandlerRightBitmap: TTMSFNCBitmap;\r\n    FSizeHandlerDownBitmap: TTMSFNCBitmap;\r\n    FDeleteHandlerBitmap: TTMSFNCBitmap;\r\n    FDeleteHandlerWidth: Double;\r\n    FDeleteHandlerHeight: Double;\r\n    FDeleteAreaSize: Double;\r\n    FDeleteAreaColor: TTMSFNCGraphicsColor;\r\n    FShowDeleteArea: Boolean;\r\n    FShowLinks: Boolean;\r\n    FLinkStroke: TTMSFNCGraphicsStroke;\r\n    FLinkArrowShape: TTMSFNCPlannerLinkArrowShape;\r\n    FLinkArrowSize: Double;\r\n    procedure SetGap(const Value: Double);\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetTitleFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTitleFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetDisabledFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetDisabledStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetDisabledTitleFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetDisabledTitleFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetDisabledTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetSelectedFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetSelectedFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetSelectedStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetSelectedTitleFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetSelectedTitleFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetSelectedTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetActiveFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetActiveFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetActiveStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetActiveTitleFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetActiveTitleFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetActiveTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetMoveAreaSize(const Value: Double);\r\n    procedure SetSizeAreaSize(const Value: Double);\r\n    procedure SetMoveAreaColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetSizeAreaColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetShowMoveArea(const Value: Boolean);\r\n    procedure SetShowSizeArea(const Value: Boolean);\r\n    procedure SetTextHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTextVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTitleHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTitleVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetShowItemHelpers(const Value: Boolean);\r\n    procedure SetSizeHandlerHeight(const Value: Double);\r\n    procedure SetSizeHandlerWidth(const Value: Double);\r\n    procedure SetSizeHandlerDownBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetSizeHandlerLeftBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetSizeHandlerRightBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetSizeHandlerUpBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetDeleteHandlerBitmap(const Value: TTMSFNCBitmap);\r\n    procedure SetDeleteHandlerHeight(const Value: Double);\r\n    procedure SetDeleteHandlerWidth(const Value: Double);\r\n    procedure SetDeleteAreaColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetDeleteAreaSize(const Value: Double);\r\n    procedure SetShowDeleteArea(const Value: Boolean);\r\n    procedure SetShowLinks(const Value: Boolean);\r\n    procedure SetLinkStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetLinkArrowShape(const Value: TTMSFNCPlannerLinkArrowShape);\r\n    procedure SetLinkArrowSize(const Value: Double);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    procedure Assign(Source: TPersistent); override;\r\n    destructor Destroy; override;\r\n  published\r\n    property Gap: Double read FGap write SetGap;\r\n    property MoveAreaSize: Double read FMoveAreaSize write SetMoveAreaSize;\r\n    property SizeAreaSize: Double read FSizeAreaSize write SetSizeAreaSize;\r\n    property DeleteAreaSize: Double read FDeleteAreaSize write SetDeleteAreaSize;\r\n    property DeleteHandlerBitmap: TTMSFNCBitmap read FDeleteHandlerBitmap write SetDeleteHandlerBitmap;\r\n    property SizeHandlerHeight: Double read FSizeHandlerHeight write SetSizeHandlerHeight;\r\n    property SizeHandlerWidth: Double read FSizeHandlerWidth write SetSizeHandlerWidth;\r\n    property DeleteHandlerHeight: Double read FDeleteHandlerHeight write SetDeleteHandlerHeight;\r\n    property DeleteHandlerWidth: Double read FDeleteHandlerWidth write SetDeleteHandlerWidth;\r\n    property SizeHandlerLeftBitmap: TTMSFNCBitmap read FSizeHandlerLeftBitmap write SetSizeHandlerLeftBitmap;\r\n    property SizeHandlerRightBitmap: TTMSFNCBitmap read FSizeHandlerRightBitmap write SetSizeHandlerRightBitmap;\r\n    property SizeHandlerUpBitmap: TTMSFNCBitmap read FSizeHandlerUpBitmap write SetSizeHandlerUpBitmap;\r\n    property SizeHandlerDownBitmap: TTMSFNCBitmap read FSizeHandlerDownBitmap write SetSizeHandlerDownBitmap;\r\n    property MoveAreaColor: TTMSFNCGraphicsColor read FMoveAreaColor write SetMoveAreaColor default TMSFNCPlannerAreaColor;\r\n    property SizeAreaColor: TTMSFNCGraphicsColor read FSizeAreaColor write SetSizeAreaColor default TMSFNCPlannerAreaColor;\r\n    property DeleteAreaColor: TTMSFNCGraphicsColor read FDeleteAreaColor write SetDeleteAreaColor default gcSteelBlue;\r\n    property ShowMoveArea: Boolean read FShowMoveArea write SetShowMoveArea default True;\r\n    property ShowSizeArea: Boolean read FShowSizeArea write SetShowSizeArea default True;\r\n    property ShowDeleteArea: Boolean read FShowDeleteArea write SetShowDeleteArea default False;\r\n    property ShowItemHelpers: Boolean read FShowItemHelpers write SetShowItemHelpers default True;\r\n    property ShowLinks: Boolean read FShowLinks write SetShowLinks default False;\r\n    property LinkStroke: TTMSFNCGraphicsStroke read FLinkStroke write SetLinkStroke;\r\n    property LinkArrowShape: TTMSFNCPlannerLinkArrowShape read FLinkArrowShape write SetLinkArrowShape default lasNormal;\r\n    property LinkArrowSize: Double read FLinkArrowSize write SetLinkArrowSize;\r\n\r\n\r\n    property TitleFill: TTMSFNCGraphicsFill read FTitleFill write SetTitleFill;\r\n    property TitleStroke: TTMSFNCGraphicsStroke read FTitleStroke write SetTitleStroke;\r\n    property TitleFont: TTMSFNCGraphicsFont read FTitleFont write SetTitleFont;\r\n\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n    property Stroke: TTMSFNCGraphicsStroke read FStroke write SetStroke;\r\n    property Font: TTMSFNCGraphicsFont read FFont write SetFont;\r\n\r\n    property SelectedTitleFill: TTMSFNCGraphicsFill read FSelectedTitleFill write SetSelectedTitleFill;\r\n    property SelectedTitleStroke: TTMSFNCGraphicsStroke read FSelectedTitleStroke write SetSelectedTitleStroke;\r\n    property SelectedTitleFont: TTMSFNCGraphicsFont read FSelectedTitleFont write SetSelectedTitleFont;\r\n\r\n    property ActiveTitleFill: TTMSFNCGraphicsFill read FActiveTitleFill write SetActiveTitleFill;\r\n    property ActiveTitleStroke: TTMSFNCGraphicsStroke read FActiveTitleStroke write SetActiveTitleStroke;\r\n    property ActiveTitleFont: TTMSFNCGraphicsFont read FActiveTitleFont write SetActiveTitleFont;\r\n\r\n    property SelectedFill: TTMSFNCGraphicsFill read FSelectedFill write SetSelectedFill;\r\n    property SelectedStroke: TTMSFNCGraphicsStroke read FSelectedStroke write SetSelectedStroke;\r\n    property SelectedFont: TTMSFNCGraphicsFont read FSelectedFont write SetSelectedFont;\r\n\r\n    property ActiveFill: TTMSFNCGraphicsFill read FActiveFill write SetActiveFill;\r\n    property ActiveStroke: TTMSFNCGraphicsStroke read FActiveStroke write SetActiveStroke;\r\n    property ActiveFont: TTMSFNCGraphicsFont read FActiveFont write SetActiveFont;\r\n\r\n    property DisabledTitleFill: TTMSFNCGraphicsFill read FDisabledTitleFill write SetDisabledTitleFill;\r\n    property DisabledTitleStroke: TTMSFNCGraphicsStroke read FDisabledTitleStroke write SetDisabledTitleStroke;\r\n    property DisabledTitleFont: TTMSFNCGraphicsFont read FDisabledTitleFont write SetDisabledTitleFont;\r\n\r\n    property DisabledFill: TTMSFNCGraphicsFill read FDisabledFill write SetDisabledFill;\r\n    property DisabledStroke: TTMSFNCGraphicsStroke read FDisabledStroke write SetDisabledStroke;\r\n    property DisabledFont: TTMSFNCGraphicsFont read FDisabledFont write SetDisabledFont;\r\n\r\n    property TitleHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTitleHorizontalTextAlign write SetTitleHorizontalTextAlign default gtaLeading;\r\n    property TitleVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTitleVerticalTextAlign write SetTitleVerticalTextAlign default gtaLeading;\r\n    property TextHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTextHorizontalTextAlign write SetTextHorizontalTextAlign default gtaLeading;\r\n    property TextVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTextVerticalTextAlign write SetTextVerticalTextAlign default gtaLeading;\r\n  end;\r\n\r\n  TTMSFNCPlannerSelectionAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FFill: TTMSFNCGraphicsFill;\r\n    procedure SetFill(const Value: TTMSFNCGraphicsFill);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Fill: TTMSFNCGraphicsFill read FFill write SetFill;\r\n  end;\r\n\r\n  TTMSFNCPlannerVerticalTextMode = (pvtmAuto, pvtmAlways, pvtmNone);\r\n\r\n  TTMSFNCPlannerTimeLineAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FLayouts: TTMSFNCPlannerTimeLineLayouts;\r\n    FLeftSize: Double;\r\n    FRightSize: Double;\r\n    FRightStroke: TTMSFNCGraphicsStroke;\r\n    FLeftFill: TTMSFNCGraphicsFill;\r\n    FLeftStroke: TTMSFNCGraphicsStroke;\r\n    FRightFill: TTMSFNCGraphicsFill;\r\n    FLeftFont: TTMSFNCGraphicsFont;\r\n    FRightFont: TTMSFNCGraphicsFont;\r\n    FStretch: Boolean;\r\n    FLeftSubUnitFontSize: Double;\r\n    FRightSubUnitFontSize: Double;\r\n    FCurrentTimeColor: TTMSFNCGraphicsColor;\r\n    FLeftSubVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FLeftVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FRightSubVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FLeftSubHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FRightVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FLeftHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FRightSubHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FRightHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FLeftSubStroke: TTMSFNCGraphicsStroke;\r\n    FRightSubStroke: TTMSFNCGraphicsStroke;\r\n    FLeftSubVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FLeftVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FRightSubVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FRightVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    procedure SetLayouts(const Value: TTMSFNCPlannerTimeLineLayouts);\r\n    procedure SetLeftSize(const Value: Double);\r\n    procedure SetRightSize(const Value: Double);\r\n    procedure SetLeftFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetLeftStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetRightFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetRightStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetLeftFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetRightFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetStretch(const Value: Boolean);\r\n    procedure SetLeftSubUnitFontSize(const Value: Double);\r\n    procedure SetRightSubUnitFontSize(const Value: Double);\r\n    procedure SetCurrentTimeColor(const Value: TTMSFNCGraphicsColor);\r\n    procedure SetLeftHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetLeftSubHorizontalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetLeftSubVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetLeftVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetRightHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetRightSubHorizontalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetRightSubVerticalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetRightVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetLeftSubStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetRightSubStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetLeftSubVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetLeftVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetRightSubVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetRightVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Layouts: TTMSFNCPlannerTimeLineLayouts read FLayouts write SetLayouts default [ptlLeft];\r\n    property Stretch: Boolean read FStretch write SetStretch default False;\r\n    property LeftSize: Double read FLeftSize write SetLeftSize;\r\n    property RightSize: Double read FRightSize write SetRightSize;\r\n    property LeftFill: TTMSFNCGraphicsFill read FLeftFill write SetLeftFill;\r\n    property RightFill: TTMSFNCGraphicsFill read FRightFill write SetRightFill;\r\n    property LeftStroke: TTMSFNCGraphicsStroke read FLeftStroke write SetLeftStroke;\r\n    property RightStroke: TTMSFNCGraphicsStroke read FRightStroke write SetRightStroke;\r\n    property LeftSubStroke: TTMSFNCGraphicsStroke read FLeftSubStroke write SetLeftSubStroke;\r\n    property RightSubStroke: TTMSFNCGraphicsStroke read FRightSubStroke write SetRightSubStroke;\r\n    property LeftFont: TTMSFNCGraphicsFont read FLeftFont write SetLeftFont;\r\n    property RightFont: TTMSFNCGraphicsFont read FRightFont write SetRightFont;\r\n    property LeftSubUnitFontSize: Double read FLeftSubUnitFontSize write SetLeftSubUnitFontSize;\r\n    property RightSubUnitFontSize: Double read FRightSubUnitFontSize write SetRightSubUnitFontSize;\r\n    property CurrentTimeColor: TTMSFNCGraphicsColor read FCurrentTimeColor write SetCurrentTimeColor default gcOrange;\r\n    property LeftHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FLeftHorizontalTextAlign write SetLeftHorizontalTextAlign default gtaLeading;\r\n    property LeftVerticalTextAlign: TTMSFNCGraphicsTextAlign read FLeftVerticalTextAlign write SetLeftVerticalTextAlign default gtaLeading;\r\n    property RightHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FRightHorizontalTextAlign write SetRightHorizontalTextAlign default gtaLeading;\r\n    property RightVerticalTextAlign: TTMSFNCGraphicsTextAlign read FRightVerticalTextAlign write SetRightVerticalTextAlign default gtaLeading;\r\n    property LeftSubHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FLeftSubHorizontalTextAlign write SetLeftSubHorizontalTextAlign default gtaTrailing;\r\n    property LeftSubVerticalTextAlign: TTMSFNCGraphicsTextAlign read FLeftSubVerticalTextAlign write SetLeftSubVerticalTextAlign default gtaTrailing;\r\n    property RightSubHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FRightSubHorizontalTextAlign write SetRightSubHorizontalTextAlign default gtaTrailing;\r\n    property RightSubVerticalTextAlign: TTMSFNCGraphicsTextAlign read FRightSubVerticalTextAlign write SetRightSubVerticalTextAlign default gtaTrailing;\r\n    property LeftVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FLeftVerticalTextMode write SetLeftVerticalTextMode default pvtmNone;\r\n    property RightVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FRightVerticalTextMode write SetRightVerticalTextMode default pvtmNone;\r\n    property LeftSubVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FLeftSubVerticalTextMode write SetLeftSubVerticalTextMode default pvtmNone;\r\n    property RightSubVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FRightSubVerticalTextMode write SetRightSubVerticalTextMode default pvtmNone;\r\n  end;\r\n\r\n  TTMSFNCPlannerPositionsAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FLayouts: TTMSFNCPlannerPositionsLayouts;\r\n    FStretch: Boolean;\r\n    FBottomSize: Double;\r\n    FTopSize: Double;\r\n    FBottomFill: TTMSFNCGraphicsFill;\r\n    FBottomStroke: TTMSFNCGraphicsStroke;\r\n    FTopFill: TTMSFNCGraphicsFill;\r\n    FTopStroke: TTMSFNCGraphicsStroke;\r\n    FTopFont: TTMSFNCGraphicsFont;\r\n    FBottomFont: TTMSFNCGraphicsFont;\r\n    FTopVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTopHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FBottomHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FBottomVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FSize: Double;\r\n    FTopVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FBottomVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FTopNavigationButtonStroke: TTMSFNCGraphicsStroke;\r\n    FBottomNavigationButtonFill: TTMSFNCGraphicsFill;\r\n    FBottomNavigationButtonStroke: TTMSFNCGraphicsStroke;\r\n    FTopNavigationButtonFill: TTMSFNCGraphicsFill;\r\n    FFillEmptySpaces: Boolean;\r\n    FBottomNavigationButtonDownFill: TTMSFNCGraphicsFill;\r\n    FTopNavigationButtonHoverFill: TTMSFNCGraphicsFill;\r\n    FBottomNavigationButtonDownStroke: TTMSFNCGraphicsStroke;\r\n    FTopNavigationButtonHoverStroke: TTMSFNCGraphicsStroke;\r\n    FTopNavigationButtonDownFill: TTMSFNCGraphicsFill;\r\n    FTopNavigationButtonDownStroke: TTMSFNCGraphicsStroke;\r\n    FBottomNavigationButtonHoverFill: TTMSFNCGraphicsFill;\r\n    FBottomNavigationButtonHoverStroke: TTMSFNCGraphicsStroke;\r\n    FTopRightNavigationButtonSize: Double;\r\n    FBottomLeftNavigationButtonSize: Double;\r\n    FBottomRightNavigationButtonSize: Double;\r\n    FTopLeftNavigationButtonSize: Double;\r\n    procedure SetLayouts(const Value: TTMSFNCPlannerPositionsLayouts);\r\n    procedure SetStretch(const Value: Boolean);\r\n    procedure SetBottomSize(const Value: Double);\r\n    procedure SetTopSize(const Value: Double);\r\n    procedure SetBottomFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetBottomStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTopFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTopStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetBottomFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetTopFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetTopHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTopVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetBottomHorizontalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetBottomVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetSize(const Value: Double);\r\n    procedure SetTopVerticalTextMode(const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetBottomVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetBottomNavigationButtonFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetBottomNavigationButtonStroke(\r\n      const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTopNavigationButtonFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTopNavigationButtonStroke(\r\n      const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetFillEmptySpaces(const Value: Boolean);\r\n    procedure SetBottomNavigationButtonDownFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetBottomNavigationButtonDownStroke(\r\n      const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetBottomNavigationButtonHoverFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetBottomNavigationButtonHoverStroke(\r\n      const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTopNavigationButtonDownFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTopNavigationButtonDownStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTopNavigationButtonHoverFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTopNavigationButtonHoverStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetBottomLeftNavigationButtonSize(const Value: Double);\r\n    procedure SetBottomRightNavigationButtonSize(const Value: Double);\r\n    procedure SetTopLeftNavigationButtonSize(const Value: Double);\r\n    procedure SetTopRightNavigationButtonSize(const Value: Double);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Size: Double read FSize write SetSize;\r\n    property Layouts: TTMSFNCPlannerPositionsLayouts read FLayouts write SetLayouts default [pplTop];\r\n    property Stretch: Boolean read FStretch write SetStretch default True;\r\n    property TopSize: Double read FTopSize write SetTopSize;\r\n    property BottomSize: Double read FBottomSize write SetBottomSize;\r\n    property TopFont: TTMSFNCGraphicsFont read FTopFont write SetTopFont;\r\n    property BottomFont: TTMSFNCGraphicsFont read FBottomFont write SetBottomFont;\r\n    property TopFill: TTMSFNCGraphicsFill read FTopFill write SetTopFill;\r\n    property BottomFill: TTMSFNCGraphicsFill read FBottomFill write SetBottomFill;\r\n    property TopStroke: TTMSFNCGraphicsStroke read FTopStroke write SetTopStroke;\r\n    property BottomStroke: TTMSFNCGraphicsStroke read FBottomStroke write SetBottomStroke;\r\n    property TopHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTopHorizontalTextAlign write SetTopHorizontalTextAlign default gtaCenter;\r\n    property TopVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTopVerticalTextAlign write SetTopVerticalTextAlign default gtaCenter;\r\n    property BottomHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FBottomHorizontalTextAlign write SetBottomHorizontalTextAlign default gtaCenter;\r\n    property BottomVerticalTextAlign: TTMSFNCGraphicsTextAlign read FBottomVerticalTextAlign write SetBottomVerticalTextAlign default gtaCenter;\r\n    property TopVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FTopVerticalTextMode write SetTopVerticalTextMode default pvtmAuto;\r\n    property BottomVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FBottomVerticalTextMode write SetBottomVerticalTextMode default pvtmAuto;\r\n    property TopNavigationButtonFill: TTMSFNCGraphicsFill read FTopNavigationButtonFill write SetTopNavigationButtonFill;\r\n    property BottomNavigationButtonFill: TTMSFNCGraphicsFill read FBottomNavigationButtonFill write SetBottomNavigationButtonFill;\r\n    property TopNavigationButtonStroke: TTMSFNCGraphicsStroke read FTopNavigationButtonStroke write SetTopNavigationButtonStroke;\r\n    property BottomNavigationButtonStroke: TTMSFNCGraphicsStroke read FBottomNavigationButtonStroke write SetBottomNavigationButtonStroke;\r\n    property TopNavigationButtonHoverFill: TTMSFNCGraphicsFill read FTopNavigationButtonHoverFill write SetTopNavigationButtonHoverFill;\r\n    property BottomNavigationButtonHoverFill: TTMSFNCGraphicsFill read FBottomNavigationButtonHoverFill write SetBottomNavigationButtonHoverFill;\r\n    property TopNavigationButtonHoverStroke: TTMSFNCGraphicsStroke read FTopNavigationButtonHoverStroke write SetTopNavigationButtonHoverStroke;\r\n    property BottomNavigationButtonHoverStroke: TTMSFNCGraphicsStroke read FBottomNavigationButtonHoverStroke write SetBottomNavigationButtonHoverStroke;\r\n    property TopNavigationButtonDownFill: TTMSFNCGraphicsFill read FTopNavigationButtonDownFill write SetTopNavigationButtonDownFill;\r\n    property BottomNavigationButtonDownFill: TTMSFNCGraphicsFill read FBottomNavigationButtonDownFill write SetBottomNavigationButtonDownFill;\r\n    property TopNavigationButtonDownStroke: TTMSFNCGraphicsStroke read FTopNavigationButtonDownStroke write SetTopNavigationButtonDownStroke;\r\n    property BottomNavigationButtonDownStroke: TTMSFNCGraphicsStroke read FBottomNavigationButtonDownStroke write SetBottomNavigationButtonDownStroke;\r\n    property TopLeftNavigationButtonSize: Double read FTopLeftNavigationButtonSize write SetTopLeftNavigationButtonSize;\r\n    property TopRightNavigationButtonSize: Double read FTopRightNavigationButtonSize write SetTopRightNavigationButtonSize;\r\n    property BottomLeftNavigationButtonSize: Double read FBottomLeftNavigationButtonSize write SetBottomLeftNavigationButtonSize;\r\n    property BottomRightNavigationButtonSize: Double read FBottomRightNavigationButtonSize write SetBottomRightNavigationButtonSize;\r\n    property FillEmptySpaces: Boolean read FFillEmptySpaces write SetFillEmptySpaces default True;\r\n  end;\r\n\r\n  TTMSFNCPlannerPositionEmptySpace = (ppesTopLeft, ppesTopRight, ppesBottomLeft, ppesBottomRight);\r\n  TTMSFNCPlannerGroupEmptySpace = (pgesTopLeft, pgesTopRight, pgesBottomLeft, pgesBottomRight);\r\n\r\n  TTMSFNCPlannerPositions = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FCount: Integer;\r\n    FFormat: String;\r\n    FViewStart: Integer;\r\n    procedure SetCount(const Value: Integer);\r\n    procedure SetFormat(const Value: String);\r\n    function GetViewStart: Integer;\r\n    procedure SetViewStart(const Value: Integer);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Count: Integer read FCount write SetCount default 3;\r\n    property Format: String read FFormat write SetFormat;\r\n    property ViewStart: Integer read GetViewStart write SetViewStart default 0;\r\n  end;\r\n\r\n  TTMSFNCPlannerGroupsAppearance = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FLayouts: TTMSFNCPlannerGroupsLayouts;\r\n    FBottomSize: Double;\r\n    FTopSize: Double;\r\n    FBottomFill: TTMSFNCGraphicsFill;\r\n    FBottomStroke: TTMSFNCGraphicsStroke;\r\n    FTopFill: TTMSFNCGraphicsFill;\r\n    FTopStroke: TTMSFNCGraphicsStroke;\r\n    FTopFont: TTMSFNCGraphicsFont;\r\n    FBottomFont: TTMSFNCGraphicsFont;\r\n    FBottomHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTopVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTopHorizontalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FBottomVerticalTextAlign: TTMSFNCGraphicsTextAlign;\r\n    FTopVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FBottomVerticalTextMode: TTMSFNCPlannerVerticalTextMode;\r\n    FFillEmptySpaces: Boolean;\r\n    procedure SetLayouts(const Value: TTMSFNCPlannerGroupsLayouts);\r\n    procedure SetBottomSize(const Value: Double);\r\n    procedure SetTopSize(const Value: Double);\r\n    procedure SetBottomFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetBottomStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetTopFill(const Value: TTMSFNCGraphicsFill);\r\n    procedure SetTopStroke(const Value: TTMSFNCGraphicsStroke);\r\n    procedure SetBottomFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetTopFont(const Value: TTMSFNCGraphicsFont);\r\n    procedure SetBottomHorizontalTextAlign(\r\n      const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetBottomVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTopHorizontalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTopVerticalTextAlign(const Value: TTMSFNCGraphicsTextAlign);\r\n    procedure SetTopVerticalTextMode(const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetBottomVerticalTextMode(\r\n      const Value: TTMSFNCPlannerVerticalTextMode);\r\n    procedure SetFillEmptySpaces(const Value: Boolean);\r\n  protected\r\n    procedure Changed(Sender: TObject);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property Layouts: TTMSFNCPlannerGroupsLayouts read FLayouts write SetLayouts default [pglTop];\r\n    property TopSize: Double read FTopSize write SetTopSize;\r\n    property BottomSize: Double read FBottomSize write SetBottomSize;\r\n    property TopFill: TTMSFNCGraphicsFill read FTopFill write SetTopFill;\r\n    property BottomFill: TTMSFNCGraphicsFill read FBottomFill write SetBottomFill;\r\n    property TopFont: TTMSFNCGraphicsFont read FTopFont write SetTopFont;\r\n    property BottomFont: TTMSFNCGraphicsFont read FBottomFont write SetBottomFont;\r\n    property TopStroke: TTMSFNCGraphicsStroke read FTopStroke write SetTopStroke;\r\n    property BottomStroke: TTMSFNCGraphicsStroke read FBottomStroke write SetBottomStroke;\r\n    property TopHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FTopHorizontalTextAlign write SetTopHorizontalTextAlign default gtaCenter;\r\n    property TopVerticalTextAlign: TTMSFNCGraphicsTextAlign read FTopVerticalTextAlign write SetTopVerticalTextAlign default gtaCenter;\r\n    property BottomHorizontalTextAlign: TTMSFNCGraphicsTextAlign read FBottomHorizontalTextAlign write SetBottomHorizontalTextAlign default gtaCenter;\r\n    property BottomVerticalTextAlign: TTMSFNCGraphicsTextAlign read FBottomVerticalTextAlign write SetBottomVerticalTextAlign default gtaCenter;\r\n    property TopVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FTopVerticalTextMode write SetTopVerticalTextMode default pvtmAuto;\r\n    property BottomVerticalTextMode: TTMSFNCPlannerVerticalTextMode read FBottomVerticalTextMode write SetBottomVerticalTextMode default pvtmAuto;\r\n    property FillEmptySpaces: Boolean read FFillEmptySpaces write SetFillEmptySpaces default True;\r\n  end;\r\n\r\n  TTMSFNCPlannerMode = (pmDay, pmDayPeriod, pmHalfDayPeriod, pmMultiDay, pmMultiResDay, pmMultiDayRes, pmMonth, pmMultiMonth, pmCustom);\r\n\r\n  TTMSFNCPlannerDisplayUnitType = (pduMilliSecond, pduSecond, pduMinute, pduHour, pduDay);\r\n\r\n  TTMSFNCPlannerCurrentTimeMode = (pctmNone, pctmLine, pctmText);\r\n\r\n  TTMSFNCPlannerCurrentTimePosition = (pctpUnderItems, pctpOverItems);\r\n\r\n  TTMSFNCPlannerTimeLine = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FDisplayUnit: Integer;\r\n    FDisplayUnitSize: Double;\r\n    FDisplayStart: Integer;\r\n    FDisplayEnd: Integer;\r\n    FDisplaySubUnitFormat: String;\r\n    FDisplayUnitType: TTMSFNCPlannerDisplayUnitType;\r\n    FDisplayOffsetType: TTMSFNCPlannerDisplayUnitType;\r\n    FDisplayOffset: Integer;\r\n    FDisplayUnitFormat: String;\r\n    FViewStart: TDateTime;\r\n    FCurrentTimeMode: TTMSFNCPlannerCurrentTimeMode;\r\n    FActiveStart: Integer;\r\n    FActiveEnd: Integer;\r\n    FCurrentTimePosition: TTMSFNCPlannerCurrentTimePosition;\r\n    procedure SetDisplayUnit(const Value: Integer);\r\n    procedure SetDisplayUnitSize(const Value: Double);\r\n    procedure SetDisplayEnd(const Value: Integer);\r\n    procedure SetDisplayStart(const Value: Integer);\r\n    procedure SetDisplaySubUnitFormat(const Value: String);\r\n    procedure SetDisplayUnitType(const Value: TTMSFNCPlannerDisplayUnitType);\r\n    procedure SetDisplayOffset(const Value: Integer);\r\n    procedure SetDisplayOffsetType(\r\n      const Value: TTMSFNCPlannerDisplayUnitType);\r\n    procedure SetDisplayUnitFormat(const Value: String);\r\n    procedure SetCurrentTimeMode(const Value: TTMSFNCPlannerCurrentTimeMode);\r\n    function GetViewStart: TDateTime;\r\n    procedure SetViewStart(const Value: TDateTime);\r\n    procedure SetActiveEnd(const Value: Integer);\r\n    procedure SetActiveStart(const Value: Integer);\r\n    procedure SetCurrentTimePosition(\r\n      const Value: TTMSFNCPlannerCurrentTimePosition);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property DisplayUnitFormat: String read FDisplayUnitFormat write SetDisplayUnitFormat;\r\n    property DisplaySubUnitFormat: String read FDisplaySubUnitFormat write SetDisplaySubUnitFormat;\r\n    property DisplayUnit: Integer read FDisplayUnit write SetDisplayUnit default 30;\r\n    property DisplayUnitType: TTMSFNCPlannerDisplayUnitType read FDisplayUnitType write SetDisplayUnitType default pduMinute;\r\n    property DisplayStart: Integer read FDisplayStart write SetDisplayStart default 0;\r\n    property DisplayEnd: Integer read FDisplayEnd write SetDisplayEnd default 47;\r\n    property ActiveStart: Integer read FActiveStart write SetActiveStart default 16;\r\n    property ActiveEnd: Integer read FActiveEnd write SetActiveEnd default 40;\r\n    property DisplayOffset: Integer read FDisplayOffset write SetDisplayOffset default 0;\r\n    property DisplayOffsetType: TTMSFNCPlannerDisplayUnitType read FDisplayOffsetType write SetDisplayOffsetType default pduMinute;\r\n    property DisplayUnitSize: Double read FDisplayUnitSize write SetDisplayUnitSize;\r\n    property ViewStart: TDateTime read GetViewStart write SetViewStart;\r\n    property CurrentTimeMode: TTMSFNCPlannerCurrentTimeMode read FCurrentTimeMode write SetCurrentTimeMode default pctmLine;\r\n    property CurrentTimePosition: TTMSFNCPlannerCurrentTimePosition read FCurrentTimePosition write SetCurrentTimePosition default pctpUnderItems;\r\n  end;\r\n\r\n  TTMSFNCPlannerGetTextMode = (pgtmDrawing, pgtmEditing);\r\n  TTMSFNCPlannerNavigationDirection = (pndPrevious, pndNext);\r\n  TTMSFNCPlannerNavigationButton = (pnbPrevious, pnbNext);\r\n  TTMSFNCPlannerNavigationButtons = set of TTMSFNCPlannerNavigationButton;\r\n  TTMSFNCPlannerNavigationButtonState = (pnbsNormal, pnbsDown, pnbsHover);\r\n  TTMSFNCPlannerItemDeleteMode = (pidmKeyboard, pidmDialog, pidmTouch);\r\n\r\n  TTMSFNCPlannerItemChangedEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeDrawPositionEmptySpaceEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawPositionEmptySpaceEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace) of object;\r\n  TTMSFNCPlannerBeforeDrawGroupEmptySpaceEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawGroupEmptySpaceEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace) of object;\r\n  TTMSFNCPlannerBeforeDrawItemLink = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; AItem, ALinkedItem: TTMSFNCPlannerItem; var ACanDrawLink: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemLink = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; AItem, ALinkedItem: TTMSFNCPlannerItem) of object;\r\n\r\n  TTMSFNCPlannerBeforeDrawTopNavigationButtonEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerBeforeDrawBottomNavigationButtonEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawTopNavigationButtonEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState) of object;\r\n  TTMSFNCPlannerAfterDrawBottomNavigationButtonEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState) of object;\r\n  TTMSFNCPlannerBeforeDrawCurrentTimeInTimeLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind; AValue: Double; ACurrentTime: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawCurrentTimeInTimeLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind; AValue: Double; ACurrentTime: TDateTime) of object;\r\n  TTMSFNCPlannerBeforeDrawCurrentTimeInGridEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ACurrentTime: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawCurrentTimeInGridEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ACurrentTime: TDateTime) of object;\r\n  TTMSFNCPlannerBeforeDrawCellEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawCellEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawCellVerticalLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawCellVerticalLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawCellHorizontalLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawCellHorizontalLineEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawPositionEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawPositionEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawGroupEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawGroupEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawTimeStrokeEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ASubUnit: Boolean; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawTimeStrokeEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ASubUnit: Boolean; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawTimeEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawTimeEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind) of object;\r\n  TTMSFNCPlannerBeforeDrawItemEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeDrawMoveAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawMoveAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeDrawSizeAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawSizeAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeDrawDeleteAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawDeleteAreaEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeDrawItemTitleEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemTitleEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String) of object;\r\n  TTMSFNCPlannerGetCustomContentPanelEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; var AContentPanel: TTMSFNCPlannerEditingDialogContentPanel) of object;\r\n  TTMSFNCPlannerInitializeCustomContentPanelEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel) of object;\r\n  TTMSFNCPlannerItemToCustomContentPanelEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel) of object;\r\n  TTMSFNCPlannerCustomContentPanelToItemEvent = procedure(Sender: TObject; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel; AItem: TTMSFNCPlannerItem) of object;\r\n\r\n  TTMSFNCPlannerGetPositionTextEvent = procedure(Sender: TObject; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AText: String) of object;\r\n  TTMSFNCPlannerBeforeDrawPositionTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawPositionTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String) of object;\r\n  TTMSFNCPlannerGetGroupTextEvent = procedure(Sender: TObject; AGroup: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AText: String) of object;\r\n  TTMSFNCPlannerBeforeDrawGroupTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawGroupTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String) of object;\r\n  TTMSFNCPlannerGetTimeTextEvent = procedure(Sender: TObject; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; var AText: String) of object;\r\n  TTMSFNCPlannerBeforeDrawTimeTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawTimeTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; AText: String) of object;\r\n  TTMSFNCPlannerItemAnchorClickEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AAnchor: String) of object;\r\n  TTMSFNCPlannerGetItemTextEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var AText: String) of object;\r\n  TTMSFNCPlannerBeforeDrawItemTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String) of object;\r\n  TTMSFNCPlannerGetItemTitleTextEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var ATitle: String) of object;\r\n  TTMSFNCPlannerBeforeDrawItemTitleTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemTitleTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String) of object;\r\n\r\n  TTMSFNCPlannerIsItemDeletableEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; var ADeletable: Boolean) of object;\r\n  TTMSFNCPlannerGetInplaceEditorEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var AInplaceEditorClass: TTMSFNCPlannerInplaceEditorClass) of object;\r\n  TTMSFNCPlannerIsDateTimeDisabledEvent = procedure(Sender: TObject; ADateTime: TDateTime; APosition: Integer; var ADisabled: Boolean) of object;\r\n  TTMSFNCPlannerIsDateTimeInActiveEvent = procedure(Sender: TObject; ADateTime: TDateTime; APosition: Integer; var AInActive: Boolean) of object;\r\n  TTMSFNCPlannerIsDateTimeSubEvent = procedure(Sender: TObject; ADateTime: TDateTime; var AIsSub: Boolean) of object;\r\n  TTMSFNCPlannerHasDateTimeSubEvent = procedure(Sender: TObject; var AHasSub: Boolean) of object;\r\n  TTMSFNCPlannerSelectTimeEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer) of object;\r\n  TTMSFNCPlannerSelectCellEvent = procedure(Sender: TObject; AStartCell, AEndCell: TTMSFNCPlannerCell) of object;\r\n  TTMSFNCPlannerBeforeInsertItemEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; var ATitle: String; var AText: String; var ACanInsert: Boolean) of object;\r\n  TTMSFNCPlannerAfterInsertItemEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeUpdateItemEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ATitle: String; var AText: String; var ACanUpdate: Boolean) of object;\r\n  TTMSFNCPlannerAfterUpdateItemEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeOpenInsertDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; var ACanOpen: Boolean) of object;\r\n  TTMSFNCPlannerAfterOpenInsertDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer) of object;\r\n  TTMSFNCPlannerBeforeOpenUpdateDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ACanOpen: Boolean) of object;\r\n  TTMSFNCPlannerAfterOpenUpdateDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerBeforeOpenInplaceEditorEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ACanOpen: Boolean) of object;\r\n  TTMSFNCPlannerAfterOpenInplaceEditorEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; AInplaceEditor: TTMSFNCPlannerInplaceEditor; AInplaceEditorRect: TRectF) of object;\r\n  TTMSFNCPlannerCloseInplaceEditorEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean) of object;\r\n  TTMSFNCPlannerCloseInsertDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean) of object;\r\n  TTMSFNCPlannerCloseUpdateDialogEvent = procedure(Sender: TObject; AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean) of object;\r\n\r\n  TTMSFNCPlannerBeforeDeleteItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerItemDeleteMode; var ACanDelete: Boolean) of object;\r\n  TTMSFNCPlannerBeforeSelectItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; var ACanSelect: Boolean) of object;\r\n  TTMSFNCPlannerAfterSelectItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem) of object;\r\n  TTMSFNCPlannerAfterDeleteItemEvent = procedure(Sender: TObject; AItemIndex: Integer; ADBKey: String; AMode: TTMSFNCPlannerItemDeleteMode) of object;\r\n  TTMSFNCPlannerBeforeMoveItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanMove: Boolean) of object;\r\n  TTMSFNCPlannerBeforeSizeItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanSize: Boolean) of object;\r\n  TTMSFNCPlannerAfterMoveItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer) of object;\r\n  TTMSFNCPlannerAfterSizeItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer) of object;\r\n  TTMSFNCPlannerMoveItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer) of object;\r\n  TTMSFNCPlannerSizeItemEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer) of object;\r\n  TTMSFNCPlannerScrollEvent = procedure(Sender: TObject; APosition: Single) of object;\r\n  TTMSFNCPlannerBeforeDrawItemHelperEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean) of object;\r\n  TTMSFNCPlannerBeforeDrawItemHelperTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; AText: String; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterDrawItemHelperEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime) of object;\r\n  TTMSFNCPlannerAfterDrawItemHelperTextEvent = procedure(Sender: TObject; AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; AText: String) of object;\r\n  TTMSFNCPlannerGetItemHelperTextEvent = procedure(Sender: TObject; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; var AText: String) of object;\r\n\r\n  TTMSFNCPlannerBeforeNavigateToDateTimeEvent = procedure(Sender: TObject; ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime: TDateTime; var ANewDateTime: TDateTime; var AAllow: Boolean) of object;\r\n  TTMSFNCPlannerAfterNavigateToDateTimeEvent = procedure(Sender: TObject; ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime: TDateTime; ANewDateTime: TDateTime) of object;\r\n\r\n  TTMSFNCPlannerInActiveDay = (padMonday, padTuesday, padWednesday, padThursday, padFriday, padSaturday, padSunday);\r\n  TTMSFNCPlannerInActiveDays = set of TTMSFNCPlannerInActiveDay;\r\n\r\n  TTMSFNCPlannerModeSettings = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FStartTime: TDateTime;\r\n    FEndTime: TDateTime;\r\n    FInActiveDays: TTMSFNCPlannerInActiveDays;\r\n    FOverlappableItems: Boolean;\r\n    procedure SetStartTime(const Value: TDateTime);\r\n    procedure SetEndTime(const Value: TDateTime);\r\n    procedure SetInActiveDays(const Value: TTMSFNCPlannerInActiveDays);\r\n    procedure SetOverlappableItems(const Value: Boolean);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property StartTime: TDateTime read FStartTime write SetStartTime;\r\n    property EndTime: TDateTime read FEndTime write SetEndTime;\r\n    property InActiveDays: TTMSFNCPlannerInActiveDays read FInActiveDays write SetInActiveDays default [padSaturday, padSunday];\r\n    property OverlappableItems: Boolean read FOverlappableItems write SetOverlappableItems default True;\r\n  end;\r\n\r\n  TTMSFNCPlannerMouseInsertMode = (pmimNone, pmimAfterSelection, pmimDialogAfterSelection);\r\n  TTMSFNCPlannerKeyboardInsertMode = (pkimNone, pkimSelection, pkimSelectionDialog);\r\n  TTMSFNCPlannerMouseEditMode = (pmemDoubleClick, pmemSingleClick, pmemSingleClickOnSelectedItem);\r\n  TTMSFNCPlannerUpdateMode = (pumNone, pumInplace, pumDialog);\r\n  TTMSFNCPlannerInplaceEditorMode = (piemText, piemTitle, piemItem);\r\n  TTMSFNCPlannerSizeMode = (psmDesktop, psmMobile, psmAuto);\r\n  TTMSFNCPlannerMoveMode = (pmmDesktop, pmmMobile, pmmAuto);\r\n  TTMSFNCPlannerDeleteMode = (pdmDesktop, pdmMobile, pdmAuto);\r\n  TTMSFNCPlannerMouseInteractionMode = (pmmMove, pmmSizeDown, pmmSizeUp);\r\n\r\n  TTMSFNCPlannerInteraction = class(TPersistent)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FMouseInsertMode: TTMSFNCPlannerMouseInsertMode;\r\n    FUpdateMode: TTMSFNCPlannerUpdateMode;\r\n    FMouseEditMode: TTMSFNCPlannerMouseEditMode;\r\n    FKeyboardDelete: Boolean;\r\n    FKeyboardInsertMode: TTMSFNCPlannerKeyboardInsertMode;\r\n    FMultiSelect: Boolean;\r\n    FTouchScrolling: Boolean;\r\n    FInplaceEditorMode: TTMSFNCPlannerInplaceEditorMode;\r\n    FKeyboardEdit: Boolean;\r\n    FSwipeToNextDateTime: Boolean;\r\n    FSwipeToPreviousDateTime: Boolean;\r\n    FKeepSelection: Boolean;\r\n    FTopNavigationButtons: TTMSFNCPlannerNavigationButtons;\r\n    FBottomNavigationButtons: TTMSFNCPlannerNavigationButtons;\r\n    FSizeMode: TTMSFNCPlannerSizeMode;\r\n    FMoveMode: TTMSFNCPlannerMoveMode;\r\n    FShowSelection: Boolean;\r\n    FReadOnly: Boolean;\r\n    FDeleteMode: TTMSFNCPlannerDeleteMode;\r\n    FAutoDeleteLinkedItems: Boolean;\r\n    FAutoSelectLinkedItems: Boolean;\r\n    FAutoOpenURL: Boolean;\r\n    procedure SetMouseInsertMode(const Value: TTMSFNCPlannerMouseInsertMode);\r\n    procedure SetUpdateMode(const Value: TTMSFNCPlannerUpdateMode);\r\n    procedure SetMouseEditMode(const Value: TTMSFNCPlannerMouseEditMode);\r\n    procedure SetKeyboardDelete(const Value: Boolean);\r\n    procedure SetKeyboardInsertMode(const Value: TTMSFNCPlannerKeyboardInsertMode);\r\n    procedure SetMultiSelect(const Value: Boolean);\r\n    procedure SetTouchScrolling(const Value: Boolean);\r\n    procedure SetInplaceEditorMode(const Value: TTMSFNCPlannerInplaceEditorMode);\r\n    procedure SetKeyboardEdit(const Value: Boolean);\r\n    procedure SetSwipeToNextDateTime(const Value: Boolean);\r\n    procedure SetSwipeToPreviousDateTime(const Value: Boolean);\r\n    procedure SetKeepSelection(const Value: Boolean);\r\n    procedure SetSizeMode(const Value: TTMSFNCPlannerSizeMode);\r\n    procedure SetTopNavigationButtons(const Value: TTMSFNCPlannerNavigationButtons);\r\n    procedure SetBottomNavigationButtons(const Value: TTMSFNCPlannerNavigationButtons);\r\n    procedure SetMoveMode(const Value: TTMSFNCPlannerMoveMode);\r\n    procedure SetShowSelection(const Value: Boolean);\r\n    procedure SetReadOnly(const Value: Boolean);\r\n    procedure SetDeleteMode(const Value: TTMSFNCPlannerDeleteMode);\r\n  public\r\n    constructor Create(APlanner: TTMSFNCCustomPlanner);\r\n    procedure Assign(Source: TPersistent); override;\r\n  published\r\n    property AutoOpenURL: Boolean read FAutoOpenURL write FAutoOpenURL default True;\r\n    property MouseInsertMode: TTMSFNCPlannerMouseInsertMode read FMouseInsertMode write SetMouseInsertMode default pmimNone;\r\n    property MouseEditMode: TTMSFNCPlannerMouseEditMode read FMouseEditMode write SetMouseEditMode default pmemSingleClickOnSelectedItem;\r\n    property KeyboardDelete: Boolean read FKeyboardDelete write SetKeyboardDelete default False;\r\n    property KeyboardEdit: Boolean read FKeyboardEdit write SetKeyboardEdit default True;\r\n    property KeyboardInsertMode: TTMSFNCPlannerKeyboardInsertMode read FKeyboardInsertMode write SetKeyboardInsertMode default pkimNone;\r\n    property UpdateMode: TTMSFNCPlannerUpdateMode read FUpdateMode write SetUpdateMode default pumInplace;\r\n    property MultiSelect: Boolean read FMultiSelect write SetMultiSelect default false;\r\n    property TouchScrolling: Boolean read FTouchScrolling write SetTouchScrolling default True;\r\n    property InplaceEditorMode: TTMSFNCPlannerInplaceEditorMode read FInplaceEditorMode write SetInplaceEditorMode default piemText;\r\n    property SwipeToNextDateTime: Boolean read FSwipeToNextDateTime write SetSwipeToNextDateTime default True;\r\n    property SwipeToPreviousDateTime: Boolean read FSwipeToPreviousDateTime write SetSwipeToPreviousDateTime default True;\r\n    property KeepSelection: Boolean read FKeepSelection write SetKeepSelection default True;\r\n    property ShowSelection: Boolean read FShowSelection write SetShowSelection default True;\r\n    property SizeMode: TTMSFNCPlannerSizeMode read FSizeMode write SetSizeMode default psmAuto;\r\n    property DeleteMode: TTMSFNCPlannerDeleteMode read FDeleteMode write SetDeleteMode default pdmAuto;\r\n    property MoveMode: TTMSFNCPlannerMoveMode read FMoveMode write SetMoveMode default pmmAuto;\r\n    property TopNavigationButtons: TTMSFNCPlannerNavigationButtons read FTopNavigationButtons write SetTopNavigationButtons default [];\r\n    property BottomNavigationButtons: TTMSFNCPlannerNavigationButtons read FBottomNavigationButtons write SetBottomNavigationButtons default [];\r\n    property ReadOnly: Boolean read FReadOnly write SetReadOnly default False;\r\n    property AutoSelectLinkedItems: Boolean read FAutoSelectLinkedItems write FAutoSelectLinkedItems default False;\r\n    property AutoDeleteLinkedItems: Boolean read FAutoDeleteLinkedItems write FAutoDeleteLinkedITems default False;\r\n  end;\r\n\r\n  TTMSFNCPlannerSizeHandlerPanelKind = (pshpkStartTime, pshpkEndTime);\r\n\r\n  TTMSFNCPlannerDeleteHandlerPanel = class(TTMSFNCCustomControl)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n  protected\r\n    {$IFDEF FMXLIB}\r\n    function GetClipRect: TRectF; override;\r\n    {$ENDIF}\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure Click; override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property Planner: TTMSFNCCustomPlanner read FPlanner write FPlanner;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n  end;\r\n\r\n  TTMSFNCPlannerSizeHandlerPanel = class(TTMSFNCCustomControl)\r\n  private\r\n    FDownPoint: TPointF;\r\n    FMouseDown: Boolean;\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FKind: TTMSFNCPlannerSizeHandlerPanelKind;\r\n  protected\r\n    {$IFDEF FMXLIB}\r\n    function GetClipRect: TRectF; override;\r\n    {$ENDIF}\r\n    procedure RegisterRuntimeClasses; override;\r\n    procedure HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseMove(Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property Planner: TTMSFNCCustomPlanner read FPlanner write FPlanner;\r\n    property Kind: TTMSFNCPlannerSizeHandlerPanelKind read FKind write FKind default pshpkStartTime;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n  end;\r\n\r\n  TTMSFNCPlannerDeleteHandler = record\r\n    Background: TTMSFNCPlannerDeleteHandlerPanel;\r\n  end;\r\n\r\n  TTMSFNCPlannerSizeHandler = record\r\n    Background: TTMSFNCPlannerSizeHandlerPanel;\r\n  end;\r\n\r\n  TTMSFNCPlannerHintPopup = record\r\n    Panel: TTMSFNCCustomControl;\r\n    TextLabel: TLabel;\r\n  end;\r\n\r\n  TTMSFNCPlannerEditingDialog = record\r\n    Background: TTMSFNCImage;\r\n    ResourcesComboBox: TComboBox;\r\n    Panel: TTMSFNCCustomControl;\r\n    StartTimeEdit: TTMSFNCPlannerTimeEdit;\r\n    StartDateEdit: TTMSFNCPlannerDateEdit;\r\n    EndTimeEdit: TTMSFNCPlannerTimeEdit;\r\n    EndDateEdit: TTMSFNCPlannerDateEdit;\r\n    TitleEdit: TEdit;\r\n    TextMemo: TMemo;\r\n    TitleLabel: TLabel;\r\n    TextLabel: TLabel;\r\n    StartTimeLabel: TLabel;\r\n    EndTimeLabel: TLabel;\r\n    BottomPanel: TTMSFNCCustomControl;\r\n    ButtonOK: TLabel;\r\n    ButtonRemove: TLabel;\r\n    ButtonCancel: TLabel;\r\n    ResourceLabel: TLabel;\r\n    ContentPanel: TTMSFNCPlannerEditingDialogContentPanel;\r\n    CustomContentPanel: Boolean;\r\n  end;\r\n\r\n  TTMSFNCPlannerSceneDrawingScale = record\r\n    SceneScale: Double;\r\n    DrawingScale: TPointF;\r\n  end;\r\n\r\n  {$IFDEF WEBLIB}\r\n  TTMSFNCPlannerDateTimes = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TDateTime;\r\n    procedure SetItem(Index: Integer; const Value: TDateTime);\r\n  public\r\n    property Items[Index: Integer]: TDateTime read GetItem write SetItem; default;\r\n  end;\r\n  TTMSFNCPlannerSelectedItems = class(TList)\r\n  private\r\n    function GetItem(Index: Integer): TTMSFNCPlannerItem;\r\n    procedure SetItem(Index: Integer; const Value: TTMSFNCPlannerItem);\r\n  public\r\n    property Items[Index: Integer]: TTMSFNCPlannerItem read GetItem write SetItem; default;\r\n  end;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  TTMSFNCPlannerDateTimes = class(TList<TDateTime>);\r\n  TTMSFNCPlannerSelectedItems = class(TList<TTMSFNCPlannerItem>);\r\n  {$ENDIF}\r\n\r\n  TTMSFNCPlannerInteractionDirection = (idNone, idLeft, idRight, idUp, idDown);\r\n\r\n  TTMSFNCPlannerLinkedItemArray = array of TTMSFNCPlannerItem;\r\n\r\n  TTMSFNCPlannerItemArray = array of integer;\r\n\r\n  TTMSFNCPlannerArrowKind = (pakLeft, pakRight, pakUp, pakDown);\r\n\r\n  TTMSFNCPlannerCustomToolBarPopup = class(TTMSFNCCustomToolBarPopup)\r\n  private\r\n    FPlanner: TTMSFNCCustomPlanner;\r\n    FPlannerItem: TTMSFNCPlannerItem;\r\n  protected\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    property Planner: TTMSFNCCustomPlanner read FPlanner write FPlanner;\r\n    property PlannerItem: TTMSFNCPlannerItem read FPlannerItem write FPlannerItem;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    property PlacementControl;\r\n    property PlacementRectangle;\r\n    property Placement;\r\n  end;\r\n\r\n  TTMSFNCCustomPlanner = class(TTMSFNCPlannerData, ITMSFNCBitmapContainer)\r\n  private\r\n    FToolBarPopup: TTMSFNCPlannerCustomToolBarPopup;\r\n    FClosing: Boolean;\r\n    FInplaceEditorClosed: Boolean;\r\n    FAdapter: TTMSFNCPlannerAdapter;\r\n    FCurrentPanel: TTMSFNCPlannerEditingDialogContentPanel;\r\n    FSaveHScrollPos, FSaveVScrollPos: Single;\r\n    FCallItemIndex: Integer;\r\n    FCallAfterMoveEvent: Boolean;\r\n    FCallAfterSizeEvent: Boolean;\r\n    FFindItemIndex: Integer;\r\n    FNavigationButtonDown: Boolean;\r\n    FTopLeftNavigationButtonState, FTopRightNavigationButtonState,\r\n    FBottomLeftNavigationButtonState, FBottomRightNavigationButtonState: TTMSFNCPlannerNavigationButtonState;\r\n    FDialogStartDate: TDate;\r\n    FDialogEndDate: TDate;\r\n    FDialogStartTime: TTime;\r\n    FDialogEndTime: TTime;\r\n    FDblClicked: Boolean;\r\n    FCloseWithDialogKey: Boolean;\r\n    FInplaceEditorActive, FEditorDialogActive: Boolean;\r\n    FInplaceEditorClass: TTMSFNCPlannerInplaceEditorClass;\r\n    FNeedsInitialization: Boolean;\r\n    FSelectedItems: TTMSFNCPlannerSelectedItems;\r\n    FDoItemAnchor: String;\r\n    FDoItemSizeUp, FDoItemSizeDown, FDoItemMove, FDoItemDelete: Boolean;\r\n    FInplaceEditor: TTMSFNCPlannerInplaceEditor;\r\n    FDrawItemHelpers: Boolean;\r\n    FCustomDatesList: TTMSFNCPlannerDateTimes;\r\n    {$IFNDEF LCLLIB}\r\n    {$IFNDEF WEBLIB}\r\n    FCompareCustomDates: IComparer<TDateTime>;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FNeedsConflictsUpdate: Boolean;\r\n    FInsertResource: Integer;\r\n    FUpdateItem: Integer;\r\n    FEditingDialogCreated, FHintPopupCreated, FDeleteHandlerCreated,\r\n    FStartTimeSizeHandlerCreated, FEndTimeSizeHandlerCreated: Boolean;\r\n    FEditingBackground: TTMSFNCImage;\r\n    FResourcesComboBox: TComboBox;\r\n    FEditingDialog, FBottomPanel, FContentPanel: TTMSFNCControl;\r\n    FStartTimeLabel, FResourceLabel: TLabel;\r\n    FStartTimeEdit: TTMSFNCPlannerTimeEdit;\r\n    FStartDateEdit: TTMSFNCPlannerDateEdit;\r\n    FEndTimeLabel: TLabel;\r\n    FEndTimeEdit: TTMSFNCPlannerTimeEdit;\r\n    FEndDateEdit: TTMSFNCPlannerDateEdit;\r\n    FTitleLabel: TLabel;\r\n    FTitleEdit: TEdit;\r\n    FTextLabel: TLabel;\r\n    FTextMemo: TMemo;\r\n    FDeletePanel: TTMSFNCPlannerDeleteHandlerPanel;\r\n    FStartTimeSizePanel, FEndTimeSizePanel: TTMSFNCPlannerSizeHandlerPanel;\r\n    FHintPanel: TTMSFNCControl;\r\n    FHintLabel: TLabel;\r\n    FButtonCancel, FButtonOK, FButtonRemove: TLabel;\r\n    FDisplayStartTime, FDisplayEndTime, FActiveStartTime, FActiveEndTime: TDateTime;\r\n    FDisplayStart, FDisplayEnd, FActiveStart, FActiveEnd: Integer;\r\n    FPrevSelection: TTMSFNCPlannerSelection;\r\n    FScrolling: Boolean;\r\n    FSelection: TTMSFNCPlannerSelection;\r\n    FDownOnPositions, FMoveOnPositions: Boolean;\r\n    FDownCell, FSizeCell, FRangeCell: TTMSFNCPlannerCell;\r\n    FDownItem, FActiveItem: TTMSFNCPlannerItem;\r\n    FDownCacheItemIdx: Integer;\r\n    FDoubleSelection, FRangeSelection: Boolean;\r\n    FDownTime: Integer;\r\n    FMouseUp, FAnimateVerticalPos, FAnimateHorizontalPos: Boolean;\r\n    FAnimating: Boolean;\r\n    FSpX, FSpY: Double;\r\n    FMovePositionPrevious, FMovePositionNext: Boolean;\r\n    FScrollX, FScrollY, FDownX, FDownY, FMouseX, FMouseY: Double;\r\n    FScrollVTo, FScrollHTo: Double;\r\n    FTimeStart, FTimeStop: Double;\r\n    FAnimateTimer, FDownTimer: TTimer;\r\n    FGridCache: TTMSFNCPlannerGridCache;\r\n    FItemCache: TTMSFNCPlannerItemCache;\r\n    FPositionsTopCache: TTMSFNCPlannerPositionsTopCache;\r\n    FPositionsBottomCache: TTMSFNCPlannerPositionsBottomCache;\r\n    FConflicts: TTMSFNCPlannerConflicts;\r\n    FDisplayGroups: TTMSFNCPlannerDisplayGroups;\r\n    FGroupsTopCache: TTMSFNCPlannerGroupsTopCache;\r\n    FGroupsBottomCache: TTMSFNCPlannerGroupsBottomCache;\r\n    FTimeLineLeftCache: TTMSFNCPlannerTimeLineLeftCache;\r\n    FTimeLineRightCache: TTMSFNCPlannerTimeLineRightCache;\r\n    FGridDisplay: TTMSFNCPlannerGridDisplayList;\r\n    FItemDisplay: TTMSFNCPlannerItemDisplayList;\r\n    FPositionsTopDisplay: TTMSFNCPlannerPositionsTopDisplayList;\r\n    FPositionsBottomDisplay: TTMSFNCPlannerPositionsBottomDisplayList;\r\n    FGroupsTopDisplay: TTMSFNCPlannerGroupsTopDisplayList;\r\n    FGroupsBottomDisplay: TTMSFNCPlannerGroupsBottomDisplayList;\r\n    FTimeLineLeftDisplay: TTMSFNCPlannerTimeLineLeftDisplayList;\r\n    FTimeLineRightDisplay: TTMSFNCPlannerTimeLineRightDisplayList;\r\n    FGridCaching: Boolean;\r\n    FItemsAppearance: TTMSFNCPlannerItemsAppearance;\r\n    FPositionsCaching: Boolean;\r\n    FGroupsCaching: Boolean;\r\n    FTimeLineCaching: Boolean;\r\n    FTimeLine: TTMSFNCPlannerTimeLine;\r\n    FGroupsAppearance: TTMSFNCPlannerGroupsAppearance;\r\n    FPositionsAppearance: TTMSFNCPlannerPositionsAppearance;\r\n    FTimeLineAppearance: TTMSFNCPlannerTimeLineAppearance;\r\n    FOnAfterDrawGroup: TTMSFNCPlannerAfterDrawGroupEvent;\r\n    FOnBeforeDrawPosition: TTMSFNCPlannerBeforeDrawPositionEvent;\r\n    FOnBeforeDrawItem: TTMSFNCPlannerBeforeDrawItemEvent;\r\n    FOnBeforeDrawTime: TTMSFNCPlannerBeforeDrawTimeEvent;\r\n    FOnAfterDrawPosition: TTMSFNCPlannerAfterDrawPositionEvent;\r\n    FOnBeforeDrawGroup: TTMSFNCPlannerBeforeDrawGroupEvent;\r\n    FOnAfterDrawItem: TTMSFNCPlannerAfterDrawItemEvent;\r\n    FOnAfterDrawTime: TTMSFNCPlannerAfterDrawTimeEvent;\r\n    FOnAfterDrawCell: TTMSFNCPlannerAfterDrawCellEvent;\r\n    FOnBeforeDrawCell: TTMSFNCPlannerBeforeDrawCellEvent;\r\n    FGridCellAppearance: TTMSFNCPlannerGridCellAppearance;\r\n    FOnBeforeDrawItemText: TTMSFNCPlannerBeforeDrawItemTextEvent;\r\n    FOnBeforeDrawTimeText: TTMSFNCPlannerBeforeDrawTimeTextEvent;\r\n    FOnAfterDrawPositionText: TTMSFNCPlannerAfterDrawPositionTextEvent;\r\n    FOnBeforeDrawGroupText: TTMSFNCPlannerBeforeDrawGroupTextEvent;\r\n    FOnAfterDrawItemText: TTMSFNCPlannerAfterDrawItemTextEvent;\r\n    FOnAfterDrawTimeText: TTMSFNCPlannerAfterDrawTimeTextEvent;\r\n    FOnAfterDrawGroupText: TTMSFNCPlannerAfterDrawGroupTextEvent;\r\n    FOnBeforeDrawPositionText: TTMSFNCPlannerBeforeDrawPositionTextEvent;\r\n    FSelectionAppearance: TTMSFNCPlannerSelectionAppearance;\r\n    FMode: TTMSFNCPlannerMode;\r\n    FModeSettings: TTMSFNCPlannerModeSettings;\r\n    FInteraction: TTMSFNCPlannerInteraction;\r\n    FOnSelectTime: TTMSFNCPlannerSelectTimeEvent;\r\n    FOnBeforeInsertItem: TTMSFNCPlannerBeforeInsertItemEvent;\r\n    FOnAfterInsertItem: TTMSFNCPlannerAfterInsertItemEvent;\r\n    FOnAfterUpdateItem: TTMSFNCPlannerAfterUpdateItemEvent;\r\n    FOnBeforeUpdateItem: TTMSFNCPlannerBeforeUpdateItemEvent;\r\n    FOnAfterDrawItemTitleText: TTMSFNCPlannerAfterDrawItemTitleTextEvent;\r\n    FOnBeforeDrawItemTitleText: TTMSFNCPlannerBeforeDrawItemTitleTextEvent;\r\n    FOnAfterDrawItemTitle: TTMSFNCPlannerAfterDrawItemTitleEvent;\r\n    FOnBeforeDrawItemTitle: TTMSFNCPlannerBeforeDrawItemTitleEvent;\r\n    FOnBeforeSelectItem: TTMSFNCPlannerBeforeSelectItemEvent;\r\n    FOnAfterSelectItem: TTMSFNCPlannerAfterSelectItemEvent;\r\n    FDefaultItem: TTMSFNCPlannerItem;\r\n    FOnBeforeOpenUpdateDialog: TTMSFNCPlannerBeforeOpenUpdateDialogEvent;\r\n    FOnBeforeOpenInsertDialog: TTMSFNCPlannerBeforeOpenInsertDialogEvent;\r\n    FOnAfterOpenUpdateDialog: TTMSFNCPlannerAfterOpenUpdateDialogEvent;\r\n    FOnAfterOpenInsertDialog: TTMSFNCPlannerAfterOpenInsertDialogEvent;\r\n    FOnBeforeDrawCellVerticalLine: TTMSFNCPlannerBeforeDrawCellVerticalLineEvent;\r\n    FOnBeforeDrawCellHorizontalLine: TTMSFNCPlannerBeforeDrawCellHorizontalLineEvent;\r\n    FOnAfterDrawCellVerticalLine: TTMSFNCPlannerAfterDrawCellVerticalLineEvent;\r\n    FOnAfterDrawCellHorizontalLine: TTMSFNCPlannerAfterDrawCellHorizontalLineEvent;\r\n    FPositions: TTMSFNCPlannerPositions;\r\n    FOnIsDateTimeDisabled: TTMSFNCPlannerIsDateTimeDisabledEvent;\r\n    FCustomDateTimes: TTMSFNCPlannerDateTimes;\r\n    FOnAfterMoveItem: TTMSFNCPlannerAfterMoveItemEvent;\r\n    FOnAfterSizeItem: TTMSFNCPlannerAfterSizeItemEvent;\r\n    FOnBeforeMoveItem: TTMSFNCPlannerBeforeMoveItemEvent;\r\n    FOnBeforeSizeItem: TTMSFNCPlannerBeforeSizeItemEvent;\r\n    FOnSelectingTime: TTMSFNCPlannerSelectTimeEvent;\r\n    FOnSelectCell: TTMSFNCPlannerSelectCellEvent;\r\n    FOnSelectingCell: TTMSFNCPlannerSelectCellEvent;\r\n    FOnBeforeOpenInplaceEditor: TTMSFNCPlannerBeforeOpenInplaceEditorEvent;\r\n    FOnAfterOpenInplaceEditor: TTMSFNCPlannerAfterOpenInplaceEditorEvent;\r\n    FOnGetInplaceEditor: TTMSFNCPlannerGetInplaceEditorEvent;\r\n    FBitmapContainer: TTMSFNCBitmapContainer;\r\n    FOnAfterDrawMoveArea: TTMSFNCPlannerAfterDrawMoveAreaEvent;\r\n    FOnAfterDrawSizeArea: TTMSFNCPlannerAfterDrawSizeAreaEvent;\r\n    FOnBeforeDrawMoveArea: TTMSFNCPlannerBeforeDrawMoveAreaEvent;\r\n    FOnBeforeDrawSizeArea: TTMSFNCPlannerBeforeDrawSizeAreaEvent;\r\n    FOnGetItemText: TTMSFNCPlannerGetItemTextEvent;\r\n    FOnGetTimeText: TTMSFNCPlannerGetTimeTextEvent;\r\n    FOnGetPositionText: TTMSFNCPlannerGetPositionTextEvent;\r\n    FOnGetGroupText: TTMSFNCPlannerGetGroupTextEvent;\r\n    FOnGetItemTitleText: TTMSFNCPlannerGetItemTitleTextEvent;\r\n    FOnItemAnchorClick: TTMSFNCPlannerItemAnchorClickEvent;\r\n    FOnBeforeDrawCurrentTimeInGrid: TTMSFNCPlannerBeforeDrawCurrentTimeInGridEvent;\r\n    FOnAfterDrawCurrentTimeInTimeLine: TTMSFNCPlannerAfterDrawCurrentTimeInTimeLineEvent;\r\n    FOnAfterDrawCurrentTimeInGrid: TTMSFNCPlannerAfterDrawCurrentTimeInGridEvent;\r\n    FOnBeforeDrawCurrentTimeInTimeLine: TTMSFNCPlannerBeforeDrawCurrentTimeInTimeLineEvent;\r\n    FOnCloseUpdateDialog: TTMSFNCPlannerCloseUpdateDialogEvent;\r\n    FOnCloseInsertDialog: TTMSFNCPlannerCloseInsertDialogEvent;\r\n    FOnCloseInplaceEditor: TTMSFNCPlannerCloseInplaceEditorEvent;\r\n    FOnVScroll: TTMSFNCPlannerScrollEvent;\r\n    FOnHScroll: TTMSFNCPlannerScrollEvent;\r\n    FOnIsDateTimeInActive: TTMSFNCPlannerIsDateTimeInActiveEvent;\r\n    FOnAfterDrawItemHelperText: TTMSFNCPlannerAfterDrawItemHelperTextEvent;\r\n    FOnAfterDrawItemHelper: TTMSFNCPlannerAfterDrawItemHelperEvent;\r\n    FOnBeforeDrawItemHelperText: TTMSFNCPlannerBeforeDrawItemHelperTextEvent;\r\n    FOnBeforeDrawItemHelper: TTMSFNCPlannerBeforeDrawItemHelperEvent;\r\n    FOnGetItemHelperText: TTMSFNCPlannerGetItemHelperTextEvent;\r\n    FOnBeforeDrawTimeStroke: TTMSFNCPlannerBeforeDrawTimeStrokeEvent;\r\n    FOnAfterDrawTimeStroke: TTMSFNCPlannerAfterDrawTimeStrokeEvent;\r\n    FOnAfterNavigateToDateTime: TTMSFNCPlannerAfterNavigateToDateTimeEvent;\r\n    FOnBeforeNavigateToDateTime: TTMSFNCPlannerBeforeNavigateToDateTimeEvent;\r\n    FOnBeforeDrawTopNavigationButton: TTMSFNCPlannerBeforeDrawTopNavigationButtonEvent;\r\n    FOnAfterDrawBottomNavigationButton: TTMSFNCPlannerAfterDrawBottomNavigationButtonEvent;\r\n    FOnAfterDrawTopNavigationButton: TTMSFNCPlannerAfterDrawTopNavigationButtonEvent;\r\n    FOnBeforeDrawBottomNavigationButton: TTMSFNCPlannerBeforeDrawBottomNavigationButtonEvent;\r\n    FOnBeforeDrawPositionEmptySpace: TTMSFNCPlannerBeforeDrawPositionEmptySpaceEvent;\r\n    FOnAfterDrawPositionEmptySpace: TTMSFNCPlannerAfterDrawPositionEmptySpaceEvent;\r\n    FOnBeforeDrawGroupEmptySpace: TTMSFNCPlannerBeforeDrawGroupEmptySpaceEvent;\r\n    FOnAfterDrawGroupEmptySpace: TTMSFNCPlannerAfterDrawGroupEmptySpaceEvent;\r\n    FOnAfterDeleteItem: TTMSFNCPlannerAfterDeleteItemEvent;\r\n    FOnBeforeDeleteItem: TTMSFNCPlannerBeforeDeleteItemEvent;\r\n    FOnMoveItem: TTMSFNCPlannerMoveItemEvent;\r\n    FOnSizeItem: TTMSFNCPlannerSizeItemEvent;\r\n    FOnItemChanged: TTMSFNCPlannerItemChangedEvent;\r\n    FOnAfterItemChanged: TTMSFNCPlannerItemChangedEvent;\r\n    FOnItemToCustomContentPanel: TTMSFNCPlannerItemToCustomContentPanelEvent;\r\n    FOnCustomContentPanelToItem: TTMSFNCPlannerCustomContentPanelToItemEvent;\r\n    FOnGetCustomContentPanel: TTMSFNCPlannerGetCustomContentPanelEvent;\r\n    FOnInitializeCustomContentPanel: TTMSFNCPlannerInitializeCustomContentPanelEvent;\r\n    FItemEditor: TTMSFNCPlannerCustomItemEditor;\r\n    FOnIsDateTimeSub: TTMSFNCPlannerIsDateTimeSubEvent;\r\n    FOnHasDateTimeSub: TTMSFNCPlannerHasDateTimeSubEvent;\r\n    FOnIsItemDeletable: TTMSFNCPlannerIsItemDeletableEvent;\r\n    FOnBeforeDrawDeleteArea: TTMSFNCPlannerBeforeDrawDeleteAreaEvent;\r\n    FOnAfterDrawDeleteArea: TTMSFNCPlannerAfterDrawDeleteAreaEvent;\r\n    FOnAfterDrawItemLink: TTMSFNCPlannerAfterDrawItemLink;\r\n    FOnBeforeDrawItemLink: TTMSFNCPlannerBeforeDrawItemLink;\r\n    procedure SetItemsAppearance(const Value: TTMSFNCPlannerItemsAppearance);\r\n    procedure SetTimeLine(const Value: TTMSFNCPlannerTimeLine);\r\n    procedure SetGroupsAppearance(const Value: TTMSFNCPlannerGroupsAppearance);\r\n    procedure SetPositionsAppearance(const Value: TTMSFNCPlannerPositionsAppearance);\r\n    procedure SetTimeLineAppearance(const Value: TTMSFNCPlannerTimeLineAppearance);\r\n    procedure SetGridCellAppearance(const Value: TTMSFNCPlannerGridCellAppearance);\r\n    procedure SetSelectionAppearance(const Value: TTMSFNCPlannerSelectionAppearance);\r\n    procedure SetMode(const Value: TTMSFNCPlannerMode);\r\n    procedure SetModeSettings(const Value: TTMSFNCPlannerModeSettings);\r\n    procedure SetInteraction(const Value: TTMSFNCPlannerInteraction);\r\n    procedure SetActiveItem(const Value: TTMSFNCPlannerItem);\r\n    procedure SetDefaultItem(const Value: TTMSFNCPlannerItem);\r\n    procedure SetPositions(const Value: TTMSFNCPlannerPositions);\r\n    procedure SetAdapter(const Value: TTMSFNCPlannerAdapter);\r\n    function GetViewRow: Integer;\r\n    procedure SetViewRow(const Value: Integer);\r\n    function GetViewCol: Integer;\r\n    procedure SetViewCol(const Value: Integer);\r\n    procedure SetItemEditor(const Value: TTMSFNCPlannerCustomItemEditor);\r\n    procedure SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\n    function GetBitmapContainer: TTMSFNCBitmapContainer;\r\n  protected\r\n    function GetDocURL: string; override;\r\n    function GetVersion: string; override;\r\n    procedure ApplyStyle; override;\r\n    procedure DestroyEditingDialog;\r\n    procedure ResetToDefaultStyle; override;\r\n    {$IFDEF FMXLIB}\r\n    procedure DoAbsoluteChanged; override;\r\n    procedure ApplyInplaceEditorStyleLookup(Sender: TObject);\r\n    {$ENDIF}\r\n    procedure FixStroke(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure ProcessNavigationButtonsMove(X, Y: Single); virtual;\r\n    procedure ProcessNavigationButtonsDown(X, Y: Single); virtual;\r\n    procedure ProcessNavigationButtonsUp(X, Y: Single); virtual;\r\n    procedure DrawArrow(AGraphics: TTMSFNCGraphics; ARect: TRectF; AArrowKind: TTMSFNCPlannerArrowKind); virtual;\r\n    procedure UpdateScrollPosition(AForce: Boolean = True); override;\r\n    procedure Notification(AComponent: TComponent; Operation: TOperation); override;\r\n    procedure DoBeforeDrawItemLink(AGraphics: TTMSFNCGraphics; AItem, ALinkedItem: TTMSFNCPlannerItem; var ACanDrawLink: Boolean); virtual;\r\n    procedure DoAfterDrawItemLink(AGraphics: TTMSFNCGraphics; AItem, ALinkedItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeDrawPositionEmptySpace(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\n    procedure DoAfterDrawPositionEmptySpace(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace);\r\n    procedure DoBeforeDrawGroupEmptySpace(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\n    procedure DoAfterDrawGroupEmptySpace(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace);\r\n    procedure DoBeforeDrawTopNavigationButton(AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\n    procedure DoBeforeDrawBottomNavigationButton(AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\n    procedure DoAfterDrawTopNavigationButton(AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState);\r\n    procedure DoAfterDrawBottomNavigationButton(AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton; AButtonState: TTMSFNCPlannerNavigationButtonState);\r\n    procedure DoBeforeDrawCurrentTimeInTimeLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind; AValue: Double; ACurrentTime: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawCurrentTimeInTimeLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind; AValue: Double; ACurrentTime: TDateTime); virtual;\r\n    procedure DoBeforeDrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ACurrentTime: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ACurrentTime: TDateTime); virtual;\r\n    procedure DoBeforeDrawPosition(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawPosition(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawCellVerticalLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawCellVerticalLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawCellHorizontalLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawCellHorizontalLine(AGraphics: TTMSFNCGraphics; ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawTimeStroke(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ASubUnit: Boolean; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawTimeStroke(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ASubUnit: Boolean; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DoBeforeDrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeDrawMoveArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawMoveArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeDrawSizeArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawSizeArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeDrawDeleteArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawDeleteArea(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeDrawItemTitle(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoAfterDrawItemTitle(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String); virtual;\r\n\r\n    procedure DoGetPositionText(APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AText: String); virtual;\r\n    procedure DoBeforeDrawPositionText(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawPositionText(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String); virtual;\r\n    procedure DoGetGroupText(AGroup: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AText: String); virtual;\r\n    procedure DoBeforeDrawGroupText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawGroupText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String); virtual;\r\n    procedure DoGetTimeText(AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; var AText: String); virtual;\r\n    procedure DoBeforeDrawTimeText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawTimeText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; AText: string); virtual;\r\n    procedure DoGetItemText(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var AText: String); virtual;\r\n    procedure DoBeforeDrawItemText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawItemText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String); virtual;\r\n    procedure DoGetItemTitleText(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var ATitle: String); virtual;\r\n    procedure DoBeforeDrawItemTitleText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawItemTitleText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String); virtual;\r\n    procedure DoGetCustomContentPanel(AItem: TTMSFNCPlannerItem; var AContentPanel: TTMSFNCPlannerEditingDialogContentPanel); virtual;\r\n    procedure DoInitializeCustomContentPanel(AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel); virtual;\r\n    procedure DoItemToCustomContentPanel(AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel); virtual;\r\n    procedure DoCustomContentPanelToItem(AContentPanel: TTMSFNCPlannerEditingDialogContentPanel; AItem: TTMSFNCPlannerItem); virtual;\r\n\r\n    procedure DoSelectTime(AStartTime, AEndTime: TDateTime; APosition: Integer); virtual;\r\n    procedure DoSelectingTime(AStartTime, AEndTime: TDateTime; APosition: Integer); virtual;\r\n    procedure DoSelectCell(AStartCell, AEndCell: TTMSFNCPlannerCell); virtual;\r\n    procedure DoSelectingCell(AStartCell, AEndCell: TTMSFNCPlannerCell); virtual;\r\n    procedure DoIsItemDeletable(AItem: TTMSFNCPlannerItem; var ADeletable: Boolean); virtual;\r\n    procedure DoIsDateTimeDisabled(ADateTime: TDateTime; APosition: Integer; var ADisabled: Boolean); virtual;\r\n    procedure DoIsDateTimeInActive(ADateTime: TDateTime; APosition: Integer; var AInActive: Boolean); virtual;\r\n    procedure DoIsDateTimeSub(ADateTime: TDateTime; var AIsSub: Boolean); virtual;\r\n    procedure DoHasDateTimeSub(var AHasSub: Boolean); virtual;\r\n    procedure DoBeforeInsertItem(AStartTime, AEndTime: TDateTime; APosition: Integer; var ATitle: String; var AText: String; var ACanInsert: Boolean); virtual;\r\n    procedure DoAfterInsertItem(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeOpenInsertDialog(AStartTime, AEndTime: TDateTime; APosition: Integer; var ACanOpen: Boolean); virtual;\r\n    procedure DoAfterOpenInsertDialog(AStartTime, AEndTime: TDateTime; APosition: Integer); virtual;\r\n    procedure DoBeforeOpenUpdateDialog(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ACanOpen: Boolean); virtual;\r\n    procedure DoAfterOpenUpdateDialog(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoCloseInsertDialog(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean); virtual;\r\n    procedure DoCloseUpdateDialog(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean); virtual;\r\n    procedure DoBeforeOpenInplaceEditor(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ACanOpen: Boolean); virtual;\r\n    procedure DoAfterOpenInplaceEditor(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; AInplaceEditor: TTMSFNCPlannerInplaceEditor; AInplaceEditorRect: TRectF); virtual;\r\n    procedure DoCloseInplaceEditor(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean); virtual;\r\n    procedure DoBeforeUpdateItem(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ATitle: String; var AText: String; var ACanUpdate: Boolean); virtual;\r\n    procedure DoAfterUpdateItem(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoItemAnchorClick(AItem: TTMSFNCPlannerItem; AAnchor: String); virtual;\r\n\r\n    procedure CallBeforeMoveLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer); virtual;\r\n    procedure CallBeforeSizeLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer); virtual;\r\n    procedure CallBeforeUpdateLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer); virtual;\r\n    procedure CallMoveLinkedItems(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure CallSizeLinkedItems(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure CallAfterMoveLinkedItems(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure CallAfterSizeLinkedItems(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure CallAfterUpdateLinkedItems(AItem: TTMSFNCPlannerItem); virtual;\r\n\r\n    procedure DoBeforeMoveItem(AItem: TTMSFNCPlannerItem; var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanMove: Boolean); virtual;\r\n    procedure DoBeforeSizeItem(AItem: TTMSFNCPlannerItem; var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanSize: Boolean); virtual;\r\n    procedure DoAfterMoveItem(AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer); virtual;\r\n    procedure DoAfterSizeItem(AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer); virtual;\r\n    procedure DoMoveItem(AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer); virtual;\r\n    procedure DoSizeItem(AItem: TTMSFNCPlannerItem; ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer); virtual;\r\n    procedure DoItemChanged(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoAfterItemChanged(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoBeforeSelectItem(AItem: TTMSFNCPlannerItem; var ACanSelect: Boolean); virtual;\r\n    procedure DoBeforeDeleteItem(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerItemDeleteMode; var ACanDelete: Boolean); virtual;\r\n    procedure DoBeforeNavigateToDateTime(ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime: TDateTime; var ANewDateTime: TDateTime; var AAllow: Boolean); virtual;\r\n    procedure DoAfterNavigateToDateTime(ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime: TDateTime; ANewDateTime: TDateTime); virtual;\r\n    procedure DoAfterSelectItem(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure DoAfterDeleteItem(AItemIndex: Integer; ADBKey: String; AMode: TTMSFNCPlannerItemDeleteMode); virtual;\r\n    procedure DoHScroll(APosition: Single); virtual;\r\n    procedure DoVScroll(APosition: Single); virtual;\r\n    procedure DoBeforeDrawItemHelper(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; var AAllow: Boolean; var ADefaultDraw: Boolean); virtual;\r\n    procedure DoBeforeDrawItemHelperText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; AText: String; var AAllow: Boolean); virtual;\r\n    procedure DoAfterDrawItemHelper(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime); virtual;\r\n    procedure DoAfterDrawItemHelperText(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; AText: String); virtual;\r\n    procedure DoGetItemHelperText(AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; var AText: String); virtual;\r\n    procedure DoGetInplaceEditor(AStartTime, AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var AInplaceEditorClass: TTMSFNCPlannerInplaceEditorClass); virtual;\r\n    procedure CloseInplaceEditor(ACancel: Boolean); virtual;\r\n\r\n    procedure Animate(Sender: TObject);\r\n    procedure DownTime(Sender: TObject);\r\n    procedure StopAnimationTimer; override;\r\n    procedure HandleDblClick(X, Y: Single); override;\r\n    procedure HandleSelection(AStartCell, AEndCell: TTMSFNCPlannerCell); virtual;\r\n    procedure HandleCellSelection(ASelecting: Boolean = False); virtual;\r\n    procedure HandleDateTimeNavigation(ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime, ANewDateTime: TDateTime); virtual;\r\n    procedure HandleItemInsert(ADialog: Boolean); virtual;\r\n    procedure HandleItemDelete(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerItemDeleteMode); virtual;\r\n    procedure HandleItemEditing(AItem: TTMSFNCPlannerItem; ACacheItem: TTMSFNCPlannerCacheItem = nil); virtual;\r\n    procedure ProcessSelection(ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState; AStepCol, AStepRow: Integer); virtual;\r\n    procedure BuildDisplay(ACache: TTMSFNCPlannerCache; ADisplay: TTMSFNCPlannerDisplayList); virtual;\r\n    procedure UpdateCalculations(AForce: Boolean = False); override;\r\n    procedure RemoveLinkedItem(AItem: TTMSFNCPlannerItem); override;\r\n    procedure NeedsConflictsUpdate(AItem: TTMSFNCPlannerItem = nil); overload; override;\r\n    procedure UpdateAutoSizing; override;\r\n    procedure UpdateColumnRowCalculations; override;\r\n    procedure UpdatePositionsCache; override;\r\n    procedure UpdatePositionCache(ACache: TTMSFNCPlannerCache); overload; virtual;\r\n    procedure UpdateGroupsCache; override;\r\n    procedure UpdateGroupCache(ACache: TTMSFNCPlannerCache); overload; virtual;\r\n    procedure UpdateTimeLinesCache; override;\r\n    procedure UpdateTimeLineCache(ACache: TTMSFNCPlannerCache); overload; virtual;\r\n    procedure UpdateGridCache; override;\r\n    procedure UpdateItemCache; virtual;\r\n    procedure RemoveItemsFromCache(AList: TTMSFNCPlannerCacheItemList; APosition: Integer = -1); override;\r\n    procedure RemoveAllItemsFromCache; override;\r\n    procedure UpdateDisplay; override;\r\n    procedure UpdatePositionsDisplay; virtual;\r\n    procedure UpdateGroupsDisplay; virtual;\r\n    procedure UpdateTimeLineDisplay; virtual;\r\n    procedure UpdateGridDisplay; virtual;\r\n    procedure UpdateItemDisplay; virtual;\r\n    procedure UpdateInplaceEditorPosition; virtual;\r\n    procedure VerticalScrollPositionChanged; override;\r\n    procedure HorizontalScrollPositionChanged; override;\r\n    procedure DrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ACacheIndex: Integer; ACaching: Boolean = False); virtual;\r\n    procedure DrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DrawPosition(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind); virtual;\r\n    procedure DrawSelection(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawItems(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawItemLinks(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawItemHelpers(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawGrid(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawPositions(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawGroups(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawTimeLine(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawCurrentTimeInTimeLine(AGraphics: TTMSFNCGraphics; ALeft: Boolean); virtual;\r\n    procedure DrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawBorders(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawNavigationButtons(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawEmptySpaces(AGraphics: TTMSFNCGraphics); virtual;\r\n    procedure DrawDisplay(AGraphics: TTMSFNCGraphics; ADisplay: TTMSFNCPlannerDisplayList); virtual;\r\n    procedure HandleMouseEnter; override;\r\n    procedure HandleMouseLeave; override;\r\n    procedure HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseMove(Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState; X, Y: Single); override;\r\n    procedure HandleKeyDown(var Key: Word; Shift: TShiftState); override;\r\n    procedure HandleDialogKey(var Key: Word; Shift: TShiftState); override;\r\n    procedure HandleKeyUp(var Key: Word; Shift: TShiftState); override;\r\n    procedure HandleMouseWheel(Shift: TShiftState; WheelDelta: Integer; var Handled: Boolean); override;\r\n    procedure StartDateEditChanged(Sender: TObject); virtual;\r\n    procedure EndDateEditChanged(Sender: TObject); virtual;\r\n    procedure StartTimeEditChanged(Sender: TObject); virtual;\r\n    procedure EndTimeEditChanged(Sender: TObject); virtual;\r\n    procedure EditingDialogCancel(Sender: TObject); virtual;\r\n    procedure EditingDialogRemove(Sender: TObject); virtual;\r\n    procedure EditingDialogValidate(Sender: TObject); virtual;\r\n    procedure DirtyItem(AItem: TTMSFNCPlannerItem); override;\r\n    {$IFDEF WEBLIB}\r\n    procedure ShowHintEx(AItem: TTMSFNCPlannerItem; X, Y: Double); virtual;\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    procedure ShowHint(AItem: TTMSFNCPlannerItem; X, Y: Double); virtual;\r\n    {$ENDIF}\r\n    procedure UpdateLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartTime, ADiffEndTime: TDateTime; ADiffPosition: Integer); override;\r\n    procedure ProcessNavigation(ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState; AStepCol, AStepRow: Integer); virtual;\r\n    procedure HandleItemKeyboardInteraction(AItem: TTMSFNCPlannerItem; ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState; AColValue, ARowValue: Integer; AStartCell, AEndCell: TTMSFNCPlannerCell); virtual;\r\n    procedure HandleSelectItem(AItem: TTMSFNCPlannerItem; AMultiSelect: Boolean = False); overload; virtual;\r\n    procedure HandleUnselectItem(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure HandleSelectLinkedItems(AItem: TTMSFNCPlannerItem; AMultiSelect: Boolean = False); virtual;\r\n    procedure UpdateSizeHandlers; virtual;\r\n    procedure UpdateDeleteHandler; virtual;\r\n    procedure GetNewDateTimeAndResource(AItem: TTMSFNCPlannerItem; ALinkType: TTMSFNCPlannerItemLinkType; ADiffStartDateTime, ADiffEndDateTime: TDateTime; var AStartDateTime: TDateTime; var AEndDateTime: TDateTime);\r\n    procedure SetEditingDialogTabOrder; virtual;\r\n    function ColumnStretchingActive: Boolean; override;\r\n    function AllowDesktopSize: Boolean; virtual;\r\n    function HandleAfterEvents: Boolean; virtual;\r\n    function AllowMobileSize: Boolean; virtual;\r\n    function AllowDesktopMove: Boolean; virtual;\r\n    function AllowMobileMove: Boolean; virtual;\r\n    function AllowDesktopDelete: Boolean; virtual;\r\n    function AllowMobileDelete: Boolean; virtual;\r\n    function CanNavigate: Boolean; virtual;\r\n    function GetNextDateTime: TDateTime; virtual;\r\n    function GetPreviousDateTime: TDateTime; virtual;\r\n    function CurrentTime: TDateTime; virtual;\r\n    function HandleItemMouseInteraction(AItem: TTMSFNCPlannerItem; AStartCell, AEndCell, ANewStartCell, ANewEndCell: TTMSFNCPlannerCell; AMode: TTMSFNCPlannerMouseInteractionMode): Boolean; virtual;\r\n    function GetModeName(AMode: TTMSFNCPlannerMode): String; virtual;\r\n    function GetInplaceEditorRect(ACacheItem: TTMSFNCPlannerCacheItem; AItem: TTMSFNCPlannerItem): TRectF; virtual;\r\n    function GetFirstRect(AItem: TTMSFNCPlannerItem): TRectF; virtual;\r\n    function GetLastRect(AItem: TTMSFNCPlannerItem): TRectF; virtual;\r\n    function CanMoveCacheItem({%H-}ACacheItem: TTMSFNCPlannerCacheItem): Boolean; virtual;\r\n    function CanSizeCacheItemEndTime(ACacheItem: TTMSFNCPlannerCacheItem): Boolean; virtual;\r\n    function CanSizeCacheItemStartTime(ACacheItem: TTMSFNCPlannerCacheItem): Boolean; virtual;\r\n    function CanDeleteCacheItem(ACacheItem: TTMSFNCPlannerCacheItem): Boolean; virtual;\r\n    function GetCacheItemEndTimeSizeRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemStartTimeSizeRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemMoveRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemTextRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemTitleRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemDeleteRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetCacheItemRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF; virtual;\r\n    function GetMaxPositionResources: Integer; virtual;\r\n    function CreateAndPrepareBitmap(var ABitmap: TBitmap; AWidth, AHeight: Double): Boolean; virtual;\r\n    {$IFDEF FMXLIB}\r\n    function GetSceneDrawingScale: TTMSFNCPlannerSceneDrawingScale; virtual;\r\n    {$ENDIF}\r\n    function GetDefaultItem: TTMSFNCPlannerItem; override;\r\n    function GetPositionFormat: String; virtual;\r\n    function GetPositionText(APosition: Integer): String; virtual;\r\n    function GetPositionResourceText(APosition: Integer): String; virtual;\r\n    function GetGroupText(AGroup: Integer): String;virtual;\r\n    function IsDateTimeSub(ADateTime: TDateTime): Boolean; virtual;\r\n    function HasDateTimeSub: Boolean; virtual;\r\n    function GetDateTimeText(ADateTime: TDateTime; ASub: Boolean): String; virtual;\r\n    function GetResourcesAvailable: Boolean; virtual;\r\n    function GetResources: TStringList; virtual;\r\n    function GetMaxDisplayUnitValue: Double; virtual;\r\n    function GetDisplayUnitValue: TDateTime; virtual;\r\n    function GetDisplayOffsetValue: TDateTime; virtual;\r\n    function GetPositionsTopSize: Double; virtual;\r\n    function GetPositionsBottomSize: Double; virtual;\r\n    function GetGroupsTopSize: Double; virtual;\r\n    function GetGroupsBottomSize: Double; virtual;\r\n    function GetTimeLineLeftSize: Double; virtual;\r\n    function GetTimeLineRightSize: Double; virtual;\r\n    function GetCalculationRect: TRectF; override;\r\n    function GetGroupsTopRect: TRectF; virtual;\r\n    function MaxPositionDateTime(ADateTime: TDatetime; AEndDatetime: Boolean; APosition: Integer): TDateTime; virtual;\r\n    function CalculatePositionDateTime(ADateTime: TDatetime; APosition: Integer): TDateTime; virtual;\r\n    function GetGroupsBottomRect: TRectF; virtual;\r\n    function GetPositionsTopRect: TRectF; virtual;\r\n    function GetPositionTopLeftEmptyRect: TRectF; virtual;\r\n    function GetPositionBottomLeftEmptyRect: TRectF; virtual;\r\n    function GetPositionBottomRightEmptyRect: TRectF; virtual;\r\n    function GetPositionTopRightEmptyRect: TRectF; virtual;\r\n    function GetGroupTopLeftEmptyRect: TRectF; virtual;\r\n    function GetGroupBottomLeftEmptyRect: TRectF; virtual;\r\n    function GetGroupBottomRightEmptyRect: TRectF; virtual;\r\n    function GetGroupTopRightEmptyRect: TRectF; virtual;\r\n    function GetTopLeftNavigationButtonRect: TRectF; virtual;\r\n    function GetTopRightNavigationButtonRect: TRectF; virtual;\r\n    function GetBottomLeftNavigationButtonRect: TRectF; virtual;\r\n    function GetBottomRightNavigationButtonRect: TRectF; virtual;\r\n    function GetPositionsBottomRect: TRectF; virtual;\r\n    function GetTimeLineLeftRect: TRectF; virtual;\r\n    function GetTimeLineRightRect: TRectF; virtual;\r\n    function GetCacheWidth: Integer; virtual;\r\n    function GetCacheHeight: Integer; virtual;\r\n    function GetDisplaySubUnitFormat: String; virtual;\r\n    function GetDisplayUnitFormat: String; virtual;\r\n    function GetNumDays: Integer; virtual;\r\n    function GetDisplayMode: TTMSFNCPlannerMode; virtual;\r\n    function GetActiveItem: TTMSFNCPlannerItem; override;\r\n    procedure UpdateActiveItem(AItem: TTMSFNCPlannerItem); override;\r\n    property Adapter: TTMSFNCPlannerAdapter read FAdapter write SetAdapter;\r\n    property ItemEditor: TTMSFNCPlannerCustomItemEditor read FItemEditor write SetItemEditor;\r\n    property SelectedItems: TTMSFNCPlannerSelectedItems read FSelectedItems;\r\n    property ActiveItem: TTMSFNCPlannerItem read FActiveItem write SetActiveItem;\r\n    property Selection: TTMSFNCPlannerSelection read FSelection;\r\n    property NeedsInitialization: Boolean read FNeedsInitialization write FNeedsInitialization;\r\n    property GridCaching: Boolean read FGridCaching write FGridCaching default False;\r\n    property PositionsCaching: Boolean read FPositionsCaching write FPositionsCaching default False;\r\n    property GroupsCaching: Boolean read FGroupsCaching write FGroupsCaching default False;\r\n    property TimeLineCaching: Boolean read FTimeLineCaching write FTimeLineCaching default False;\r\n    property ItemsAppearance: TTMSFNCPlannerItemsAppearance read FItemsAppearance write SetItemsAppearance;\r\n    property GridCellAppearance: TTMSFNCPlannerGridCellAppearance read FGridCellAppearance write SetGridCellAppearance;\r\n    property TimeLineAppearance: TTMSFNCPlannerTimeLineAppearance read FTimeLineAppearance write SetTimeLineAppearance;\r\n    property SelectionAppearance: TTMSFNCPlannerSelectionAppearance read FSelectionAppearance write SetSelectionAppearance;\r\n    property PositionsAppearance: TTMSFNCPlannerPositionsAppearance read FPositionsAppearance write SetPositionsAppearance;\r\n    property Positions: TTMSFNCPlannerPositions read FPositions write SetPositions;\r\n    property GroupsAppearance: TTMSFNCPlannerGroupsAppearance read FGroupsAppearance write SetGroupsAppearance;\r\n    property TimeLine: TTMSFNCPlannerTimeLine read FTimeLine write SetTimeLine;\r\n    property ModeSettings: TTMSFNCPlannerModeSettings read FModeSettings write SetModeSettings;\r\n    property OnBeforeDrawItemLink: TTMSFNCPlannerBeforeDrawItemLink read FOnBeforeDrawItemLink write FOnBeforeDrawItemLink;\r\n    property OnAfterDrawItemLink: TTMSFNCPlannerAfterDrawItemLink read FOnAfterDrawItemLink write FOnAfterDrawItemLink;\r\n\r\n    property OnBeforeDrawPositionEmptySpace: TTMSFNCPlannerBeforeDrawPositionEmptySpaceEvent read FOnBeforeDrawPositionEmptySpace write FOnBeforeDrawPositionEmptySpace;\r\n    property OnAfterDrawPositionEmptySpace: TTMSFNCPlannerAfterDrawPositionEmptySpaceEvent read FOnAfterDrawPositionEmptySpace write FOnAfterDrawPositionEmptySpace;\r\n    property OnBeforeDrawGroupEmptySpace: TTMSFNCPlannerBeforeDrawGroupEmptySpaceEvent read FOnBeforeDrawGroupEmptySpace write FOnBeforeDrawGroupEmptySpace;\r\n    property OnAfterDrawGroupEmptySpace: TTMSFNCPlannerAfterDrawGroupEmptySpaceEvent read FOnAfterDrawGroupEmptySpace write FOnAfterDrawGroupEmptySpace;\r\n    property OnItemChanged: TTMSFNCPlannerItemChangedEvent read FOnItemChanged write FOnItemChanged;\r\n    property OnAfterItemChanged: TTMSFNCPlannerItemChangedEvent read FOnAfterItemChanged write FOnAfterItemChanged;\r\n    property OnCustomContentPanelToItem: TTMSFNCPlannerCustomContentPanelToItemEvent read FOnCustomContentPanelToItem write FOnCustomContentPanelToItem;\r\n    property OnItemToCustomContentPanel: TTMSFNCPlannerItemToCustomContentPanelEvent read FOnItemToCustomContentPanel write FOnItemToCustomContentPanel;\r\n    property OnGetCustomContentPanel: TTMSFNCPlannerGetCustomContentPanelEvent read FOnGetCustomContentPanel write FOnGetCustomContentPanel;\r\n    property OnInitializeCustomContentPanel: TTMSFNCPlannerInitializeCustomContentPanelEvent read FOnInitializeCustomContentPanel write FOnInitializeCustomContentPanel;\r\n\r\n    property OnBeforeDrawTopNavigationButton: TTMSFNCPlannerBeforeDrawTopNavigationButtonEvent read FOnBeforeDrawTopNavigationButton write FOnBeforeDrawTopNavigationButton;\r\n    property OnBeforeDrawBottomNavigationButton: TTMSFNCPlannerBeforeDrawBottomNavigationButtonEvent read FOnBeforeDrawBottomNavigationButton write FOnBeforeDrawBottomNavigationButton;\r\n    property OnAfterDrawTopNavigationButton: TTMSFNCPlannerAfterDrawTopNavigationButtonEvent read FOnAfterDrawTopNavigationButton write FOnAfterDrawTopNavigationButton;\r\n    property OnAfterDrawBottomNavigationButton: TTMSFNCPlannerAfterDrawBottomNavigationButtonEvent read FOnAfterDrawBottomNavigationButton write FOnAfterDrawBottomNavigationButton;\r\n    property OnBeforeDrawCurrentTimeInTimeLine: TTMSFNCPlannerBeforeDrawCurrentTimeInTimeLineEvent read FOnBeforeDrawCurrentTimeInTimeLine write FOnBeforeDrawCurrentTimeInTimeLine;\r\n    property OnAfterDrawCurrentTimeInTimeLine: TTMSFNCPlannerAfterDrawCurrentTimeInTimeLineEvent read FOnAfterDrawCurrentTimeInTimeLine write FOnAfterDrawCurrentTimeInTimeLine;\r\n    property OnBeforeDrawCurrentTimeInGrid: TTMSFNCPlannerBeforeDrawCurrentTimeInGridEvent read FOnBeforeDrawCurrentTimeInGrid write FOnBeforeDrawCurrentTimeInGrid;\r\n    property OnAfterDrawCurrentTimeInGrid: TTMSFNCPlannerAfterDrawCurrentTimeInGridEvent read FOnAfterDrawCurrentTimeInGrid write FOnAfterDrawCurrentTimeInGrid;\r\n    property OnBeforeDrawPosition: TTMSFNCPlannerBeforeDrawPositionEvent read FOnBeforeDrawPosition write FOnBeforeDrawPosition;\r\n    property OnAfterDrawPosition: TTMSFNCPlannerAfterDrawPositionEvent read FOnAfterDrawPosition write FOnAfterDrawPosition;\r\n    property OnBeforeDrawCell: TTMSFNCPlannerBeforeDrawCellEvent read FOnBeforeDrawCell write FOnBeforeDrawCell;\r\n    property OnAfterDrawCell: TTMSFNCPlannerAfterDrawCellEvent read FOnAfterDrawCell write FOnAfterDrawCell;\r\n    property OnBeforeDrawCellVerticalLine: TTMSFNCPlannerBeforeDrawCellVerticalLineEvent read FOnBeforeDrawCellVerticalLine write FOnBeforeDrawCellVerticalLine;\r\n    property OnAfterDrawCellVerticalLine: TTMSFNCPlannerAfterDrawCellVerticalLineEvent read FOnAfterDrawCellVerticalLine write FOnAfterDrawCellVerticalLine;\r\n    property OnBeforeDrawCellHorizontalLine: TTMSFNCPlannerBeforeDrawCellHorizontalLineEvent read FOnBeforeDrawCellHorizontalLine write FOnBeforeDrawCellHorizontalLine;\r\n    property OnAfterDrawCellHorizontalLine: TTMSFNCPlannerAfterDrawCellHorizontalLineEvent read FOnAfterDrawCellHorizontalLine write FOnAfterDrawCellHorizontalLine;\r\n    property OnBeforeDrawGroup: TTMSFNCPlannerBeforeDrawGroupEvent read FOnBeforeDrawGroup write FOnBeforeDrawGroup;\r\n    property OnAfterDrawGroup: TTMSFNCPlannerAfterDrawGroupEvent read FOnAfterDrawGroup write FOnAfterDrawGroup;\r\n    property OnBeforeDrawTime: TTMSFNCPlannerBeforeDrawTimeEvent read FOnBeforeDrawTime write FOnBeforeDrawTime;\r\n    property OnAfterDrawTime: TTMSFNCPlannerAfterDrawTimeEvent read FOnAfterDrawTime write FOnAfterDrawTime;\r\n    property OnBeforeDrawTimeStroke: TTMSFNCPlannerBeforeDrawTimeStrokeEvent read FOnBeforeDrawTimeStroke write FOnBeforeDrawTimeStroke;\r\n    property OnAfterDrawTimeStroke: TTMSFNCPlannerAfterDrawTimeStrokeEvent read FOnAfterDrawTimeStroke write FOnAfterDrawTimeStroke;\r\n    property OnBeforeDrawItem: TTMSFNCPlannerBeforeDrawItemEvent read FOnBeforeDrawItem write FOnBeforeDrawItem;\r\n    property OnAfterDrawItem: TTMSFNCPlannerAfterDrawItemEvent read FOnAfterDrawItem write FOnAfterDrawItem;\r\n    property OnBeforeDrawMoveArea: TTMSFNCPlannerBeforeDrawMoveAreaEvent read FOnBeforeDrawMoveArea write FOnBeforeDrawMoveArea;\r\n    property OnAfterDrawMoveArea: TTMSFNCPlannerAfterDrawMoveAreaEvent read FOnAfterDrawMoveArea write FOnAfterDrawMoveArea;\r\n    property OnBeforeDrawSizeArea: TTMSFNCPlannerBeforeDrawSizeAreaEvent read FOnBeforeDrawSizeArea write FOnBeforeDrawSizeArea;\r\n    property OnAfterDrawSizeArea: TTMSFNCPlannerAfterDrawSizeAreaEvent read FOnAfterDrawSizeArea write FOnAfterDrawSizeArea;\r\n    property OnBeforeDrawDeleteArea: TTMSFNCPlannerBeforeDrawDeleteAreaEvent read FOnBeforeDrawDeleteArea write FOnBeforeDrawDeleteArea;\r\n    property OnAfterDrawDeleteArea: TTMSFNCPlannerAfterDrawDeleteAreaEvent read FOnAfterDrawDeleteArea write FOnAfterDrawDeleteArea;\r\n    property OnBeforeDrawItemTitle: TTMSFNCPlannerBeforeDrawItemTitleEvent read FOnBeforeDrawItemTitle write FOnBeforeDrawItemTitle;\r\n    property OnAfterDrawItemTitle: TTMSFNCPlannerAfterDrawItemTitleEvent read FOnAfterDrawItemTitle write FOnAfterDrawItemTitle;\r\n    property OnBeforeDrawPositionText: TTMSFNCPlannerBeforeDrawPositionTextEvent read FOnBeforeDrawPositionText write FOnBeforeDrawPositionText;\r\n    property OnGetPositionText: TTMSFNCPlannerGetPositionTextEvent read FOnGetPositionText write FOnGetPositionText;\r\n    property OnAfterDrawPositionText: TTMSFNCPlannerAfterDrawPositionTextEvent read FOnAfterDrawPositionText write FOnAfterDrawPositionText;\r\n    property OnBeforeDrawGroupText: TTMSFNCPlannerBeforeDrawGroupTextEvent read FOnBeforeDrawGroupText write FOnBeforeDrawGroupText;\r\n    property OnGetGroupText: TTMSFNCPlannerGetGroupTextEvent read FOnGetGroupText write FOnGetGroupText;\r\n    property OnAfterDrawGroupText: TTMSFNCPlannerAfterDrawGroupTextEvent read FOnAfterDrawGroupText write FOnAfterDrawGroupText;\r\n    property OnBeforeDrawTimeText: TTMSFNCPlannerBeforeDrawTimeTextEvent read FOnBeforeDrawTimeText write FOnBeforeDrawTimeText;\r\n    property OnGetTimeText: TTMSFNCPlannerGetTimeTextEvent read FOnGetTimeText write FOnGetTimeText;\r\n    property OnAfterDrawTimeText: TTMSFNCPlannerAfterDrawTimeTextEvent read FOnAfterDrawTimeText write FOnAfterDrawTimeText;\r\n    property OnBeforeDrawItemText: TTMSFNCPlannerBeforeDrawItemTextEvent read FOnBeforeDrawItemText write FOnBeforeDrawItemText;\r\n    property OnGetItemText: TTMSFNCPlannerGetItemTextEvent read FOnGetItemText write FOnGetItemText;\r\n    property OnAfterDrawItemText: TTMSFNCPlannerAfterDrawItemTextEvent read FOnAfterDrawItemText write FOnAfterDrawItemText;\r\n    property OnBeforeDrawItemTitleText: TTMSFNCPlannerBeforeDrawItemTitleTextEvent read FOnBeforeDrawItemTitleText write FOnBeforeDrawItemTitleText;\r\n    property OnGetItemTitleText: TTMSFNCPlannerGetItemTitleTextEvent read FOnGetItemTitleText write FOnGetItemTitleText;\r\n    property OnAfterDrawItemTitleText: TTMSFNCPlannerAfterDrawItemTitleTextEvent read FOnAfterDrawItemTitleText write FOnAfterDrawItemTitleText;\r\n    property OnSelectTime: TTMSFNCPlannerSelectTimeEvent read FOnSelectTime write FOnSelectTime;\r\n    property OnSelectingTime: TTMSFNCPlannerSelectTimeEvent read FOnSelectingTime write FOnSelectingTime;\r\n    property OnSelectCell: TTMSFNCPlannerSelectCellEvent read FOnSelectCell write FOnSelectCell;\r\n    property OnSelectingCell: TTMSFNCPlannerSelectCellEvent read FOnSelectingCell write FOnSelectingCell;\r\n    property OnBeforeInsertItem: TTMSFNCPlannerBeforeInsertItemEvent read FOnBeforeInsertItem write FOnBeforeInsertItem;\r\n    property OnAfterInsertItem: TTMSFNCPlannerAfterInsertItemEvent read FOnAfterInsertItem write FOnAfterInsertItem;\r\n    property OnBeforeUpdateItem: TTMSFNCPlannerBeforeUpdateItemEvent read FOnBeforeUpdateItem write FOnBeforeUpdateItem;\r\n    property OnAfterUpdateItem: TTMSFNCPlannerAfterUpdateItemEvent read FOnAfterUpdateItem write FOnAfterUpdateItem;\r\n    property OnBeforeOpenInsertDialog: TTMSFNCPlannerBeforeOpenInsertDialogEvent read FOnBeforeOpenInsertDialog write FOnBeforeOpenInsertDialog;\r\n    property OnAfterOpenInsertDialog: TTMSFNCPlannerAfterOpenInsertDialogEvent read FOnAfterOpenInsertDialog write FOnAfterOpenInsertDialog;\r\n    property OnBeforeOpenUpdateDialog: TTMSFNCPlannerBeforeOpenUpdateDialogEvent read FOnBeforeOpenUpdateDialog write FOnBeforeOpenUpdateDialog;\r\n    property OnAfterOpenUpdateDialog: TTMSFNCPlannerAfterOpenUpdateDialogEvent read FOnAfterOpenUpdateDialog write FOnAfterOpenUpdateDialog;\r\n    property OnBeforeOpenInplaceEditor: TTMSFNCPlannerBeforeOpenInplaceEditorEvent read FOnBeforeOpenInplaceEditor write FOnBeforeOpenInplaceEditor;\r\n    property OnBeforeNavigateToDateTime: TTMSFNCPlannerBeforeNavigateToDateTimeEvent read FOnBeforeNavigateToDateTime write FOnBeforeNavigateToDateTime;\r\n    property OnAfterNavigateToDateTime: TTMSFNCPlannerAfterNavigateToDateTimeEvent read FOnAfterNavigateToDateTime write FOnAfterNavigateToDateTime;\r\n    property OnCloseInplaceEditor: TTMSFNCPlannerCloseInplaceEditorEvent read FOnCloseInplaceEditor write FOnCloseInplaceEditor;\r\n    property OnCloseUpdateDialog: TTMSFNCPlannerCloseUpdateDialogEvent read FOnCloseUpdateDialog write FOnCloseUpdateDialog;\r\n    property OnCloseInsertDialog: TTMSFNCPlannerCloseInsertDialogEvent read FOnCloseInsertDialog write FOnCloseInsertDialog;\r\n    property OnAfterOpenInplaceEditor: TTMSFNCPlannerAfterOpenInplaceEditorEvent read FOnAfterOpenInplaceEditor write FOnAfterOpenInplaceEditor;\r\n    property OnBeforeSelectItem: TTMSFNCPlannerBeforeSelectItemEvent read FOnBeforeSelectItem write FOnBeforeSelectItem;\r\n    property OnBeforeDeleteItem: TTMSFNCPlannerBeforeDeleteItemEvent read FOnBeforeDeleteItem write FOnBeforeDeleteItem;\r\n    property OnBeforeMoveItem: TTMSFNCPlannerBeforeMoveItemEvent read FOnBeforeMoveItem write FOnBeforeMoveItem;\r\n    property OnBeforeSizeItem: TTMSFNCPlannerBeforeSizeItemEvent read FOnBeforeSizeItem write FOnBeforeSizeItem;\r\n    property OnAfterMoveItem: TTMSFNCPlannerAfterMoveItemEvent read FOnAfterMoveItem write FOnAfterMoveItem;\r\n    property OnAfterSizeItem: TTMSFNCPlannerAfterSizeItemEvent read FOnAfterSizeItem write FOnAfterSizeItem;\r\n    property OnMoveItem: TTMSFNCPlannerMoveItemEvent read FOnMoveItem write FOnMoveItem;\r\n    property OnSizeItem: TTMSFNCPlannerSizeItemEvent read FOnSizeItem write FOnSizeItem;\r\n    property OnAfterSelectItem: TTMSFNCPlannerAfterSelectItemEvent read FOnAfterSelectItem write FOnAfterSelectItem;\r\n    property OnAfterDeleteItem: TTMSFNCPlannerAfterDeleteItemEvent read FOnAfterDeleteItem write FOnAfterDeleteItem;\r\n    property OnIsItemDeletable: TTMSFNCPlannerIsItemDeletableEvent read FOnIsItemDeletable write FOnIsItemDeletable;\r\n    property OnIsDateTimeDisabled: TTMSFNCPlannerIsDateTimeDisabledEvent read FOnIsDateTimeDisabled write FOnIsDateTimeDisabled;\r\n    property OnIsDateTimeInActive: TTMSFNCPlannerIsDateTimeInActiveEvent read FOnIsDateTimeInActive write FOnIsDateTimeInActive;\r\n    property OnIsDateTimeSub: TTMSFNCPlannerIsDateTimeSubEvent read FOnIsDateTimeSub write FOnIsDateTimeSub;\r\n    property OnHasDateTimeSub: TTMSFNCPlannerHasDateTimeSubEvent read FOnHasDateTimeSub write FOnHasDateTimeSub;\r\n    property OnItemAnchorClick: TTMSFNCPlannerItemAnchorClickEvent read FOnItemAnchorClick write FOnItemAnchorClick;\r\n    property OnGetInplaceEditor: TTMSFNCPlannerGetInplaceEditorEvent read FOnGetInplaceEditor write FOnGetInplaceEditor;\r\n    property Mode: TTMSFNCPlannerMode read FMode write SetMode default pmMultiDay;\r\n    property Interaction: TTMSFNCPlannerInteraction read FInteraction write SetInteraction;\r\n    property DefaultItem: TTMSFNCPlannerItem read FDefaultItem write SetDefaultItem;\r\n    property CustomDateTimes: TTMSFNCPlannerDateTimes read FCustomDateTimes write FCustomDateTimes;\r\n    property BitmapContainer: TTMSFNCBitmapContainer read GetBitmapContainer write SetBitmapContainer;\r\n    property OnVScroll: TTMSFNCPlannerScrollEvent read FOnVScroll write FOnVScroll;\r\n    property OnHScroll: TTMSFNCPlannerScrollEvent read FOnHScroll write FOnHScroll;\r\n    property OnBeforeDrawItemHelper: TTMSFNCPlannerBeforeDrawItemHelperEvent read FOnBeforeDrawItemHelper write FOnBeforeDrawItemHelper;\r\n    property OnBeforeDrawItemHelperText: TTMSFNCPlannerBeforeDrawItemHelperTextEvent read FOnBeforeDrawItemHelperText write FOnBeforeDrawItemHelperText;\r\n    property OnAfterDrawItemHelper: TTMSFNCPlannerAfterDrawItemHelperEvent read FOnAfterDrawItemHelper write FOnAfterDrawItemHelper;\r\n    property OnAfterDrawItemHelperText: TTMSFNCPlannerAfterDrawItemHelperTextEvent read FOnAfterDrawItemHelperText write FOnAfterDrawItemHelperText;\r\n    property OnGetItemHelperText: TTMSFNCPlannerGetItemHelperTextEvent read FOnGetItemHelperText write FOnGetItemHelperText;\r\n    property Version: string read GetVersion;\r\n    property ToolBarPopup: TTMSFNCPlannerCustomToolBarPopup read FToolBarPopup write FToolBarPopup;\r\n  public\r\n    constructor Create(AOwner: TComponent); override;\r\n    destructor Destroy; override;\r\n    procedure Assign(Source: TPersistent); override;\r\n    procedure Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF); override;\r\n    procedure SelectCells(AStartCell, AEndCell: TTMSFNCPlannerCell); virtual;\r\n    procedure Navigate(ACell: TTMSFNCPlannerCell; AForceScroll: Boolean = False); virtual;\r\n    procedure InitSample;\r\n    procedure CloseEditingDialogAndRemoveItem; virtual;\r\n    procedure CloseEditingDialog(ACancel: Boolean); virtual;\r\n    procedure OpenEditingDialog(AStartTime, AEndTime: TDateTime; AResource: Integer; ATitle, AText: String; AUpdateItem: Integer = -1; ACustomParent: TTMSFNCPlannerCustomParent = nil); virtual;\r\n    procedure SelectItem(AItemIndex: Integer); overload; virtual;\r\n    procedure SelectItems(AItems: TTMSFNCPlannerItemArray); virtual;\r\n    procedure SelectItem(AItem: TTMSFNCPlannerItem); overload; virtual;\r\n    procedure UnselectItem(AItem: TTMSFNCPlannerItem); virtual;\r\n    procedure UnselectAllItems; virtual;\r\n    procedure NavigateToNextDateTime(ADateTime: TDateTime = -1); virtual;\r\n    procedure NavigateToPreviousDateTime(ADateTime: TDateTime = -1); virtual;\r\n    procedure SaveScrollPosition; virtual;\r\n    procedure RestoreScrollPosition; virtual;\r\n    procedure EditItem(AItem: TTMSFNCPlannerItem); overload; virtual;\r\n    procedure EditItem(AItemIndex: Integer); overload; virtual;\r\n    procedure StopEditing; virtual;\r\n    procedure CancelEditing; virtual;\r\n    procedure LinkItems(AItems: TTMSFNCPlannerLinkedItemArray; ACircular: Boolean = False; ALinkType: TTMSFNCPlannerItemLinkType = iltNone);\r\n    procedure UnlinkItems(AItems: TTMSFNCPlannerLinkedItemArray);\r\n    procedure SelectLinkedItems(AItem: TTMSFNCPlannerItem);\r\n    procedure UpdateConflicts; override;\r\n    procedure UpdateItemsCache; override;\r\n    procedure UpdatePlannerCache(ADirtyItems: Boolean = True); override;\r\n    function FindItemLinkedTo(AItem: TTMSFNCPlannerItem): TTMSFNCPlannerItem;\r\n    function GetContentClipRect: TRectF; virtual;\r\n    function GetContentRect: TRectF; override;\r\n    function IsEditing: Boolean; virtual;\r\n    function GetDeleteHandler: TTMSFNCPlannerDeleteHandler; virtual;\r\n    function GetStartTimeSizeHandler: TTMSFNCPlannerSizeHandler; virtual;\r\n    function GetEndTimeSizeHandler: TTMSFNCPlannerSizeHandler; virtual;\r\n    function GetHintPopup: TTMSFNCPlannerHintPopup; virtual;\r\n    function GetEditingDialog(AItemIndex: Integer = -1): TTMSFNCPlannerEditingDialog; virtual;\r\n    function AddItemAtSelection: TTMSFNCPlannerItem; virtual;\r\n    function AddItem(AStartTime, AEndTime: TDateTime): TTMSFNCPlannerItem; virtual;\r\n    function AddOrUpdateItem(AStartTime, AEndTime: TDateTime; ATitle: String; AText: String; AItemIndex: Integer = -1): TTMSFNCPlannerItem; overload; virtual;\r\n    function AddOrUpdateItem(AResource: Integer; AStartTime, AEndTime: TDateTime; ATitle: String = ''; AText: String = ''; AItemIndex: Integer = -1): TTMSFNCPlannerItem; overload; virtual;\r\n    function AddOrUpdateItem(AResourceName: String; AStartTime, AEndTime: TDateTime; ATitle: String = ''; AText: String = ''; AItemIndex: Integer = -1): TTMSFNCPlannerItem; overload; virtual;\r\n    function XYToCacheItem(X, Y: Double): TTMSFNCPlannerCacheItem; virtual;\r\n    function XYToItem(X, Y: Double): TTMSFNCPlannerItem; virtual;\r\n    function XYToCell(X, Y: Double): TTMSFNCPlannerCell; override;\r\n    function XYToTime(X, Y: Double): TTMSFNCPlannerTime; virtual;\r\n    function XYToItemAnchor(AItem: TTMSFNCPlannerItem; X, Y: Single): String; virtual;\r\n    function PositionToResource(APosition: Integer): Integer; virtual;\r\n    function ResourceToPosition(AResource: Integer): Integer; virtual;\r\n    function IsDateTimeDisabled(ADateTime: TDateTime; APosition: Integer = -1): Boolean; virtual;\r\n    function IsDateTimeInActive(ADateTime: TDateTime; APosition: Integer = -1): Boolean; virtual;\r\n    function IsCellDisabled(ACell: TTMSFNCPlannerCell): Boolean; virtual;\r\n    function IsCellInActive(ACell: TTMSFNCPlannerCell): Boolean; virtual;\r\n    function CellToDateTime(ACell: TTMSFNCPlannerCell): TDateTime; virtual;\r\n    function CellToStartDatetime(ACell: TTMSFNCPlannerCell): TDateTime; virtual;\r\n    function CellToEndDateTime(ACell: TTMSFNCPlannerCell): TDateTime; virtual;\r\n    function SelectedStartDateTime: TDateTime; virtual;\r\n    function SelectedEndDateTime: TDateTime; virtual;\r\n    function SelectedResource: Integer; virtual;\r\n    function DateTimeToCell(ADateTime: TDateTime; AEndDateTime: Boolean = false): TTMSFNCPlannerCell; virtual;\r\n    function ItemToStartCell(AItem: TTMSFNCPlannerItem): TTMSFNCPlannerCell; virtual;\r\n    function ItemToEndCell(AItem: TTMSFNCPlannerItem): TTMSFNCPlannerCell; virtual;\r\n    function HasItem(AStartTime, AEndTime: TDateTime; APosition: Integer; ACompareWithItemIndex: Integer = -1; ACheckOverlap: Boolean = True): Boolean; virtual;\r\n    function FindFirstItem(AStartTime, AEndTime: TDateTime; APosition: Integer): TTMSFNCPlannerItem; virtual;\r\n    function FindNextItem(AStartTime, AEndTime: TDateTime; APosition: Integer): TTMSFNCPlannerItem; virtual;\r\n    function FindItemWithDBKey(ADBKey: String): TTMSFNCPlannerItem; virtual;\r\n    function DateTimeToValue(ADateTime: TDateTime; AEndDateTime: Boolean = False; ACheckBounds: Boolean = True): Double; virtual;\r\n    function ValueToDateTime(AValue: Double; APosition: Integer = -1; ARow: Integer = -1): TDateTime; virtual;\r\n    function DateTimeToPosition(ADateTime: TDateTime; AEndDateTime: Boolean = False; ACheckBounds: Boolean = True): Integer; virtual;\r\n    function PositionToDateTime(APosition: Integer): TDateTime; virtual;\r\n    function SelectNextItem: TTMSFNCPlannerItem; virtual;\r\n    function SelectPreviousItem: TTMSFNCPlannerItem; virtual;\r\n    function IsValidItem(AItem: TTMSFNCPlannerItem): Boolean; virtual;\r\n    function GetInplaceEditor: TTMSFNCPlannerInplaceEditor; virtual;\r\n    function DisplayStartDateTime: TDateTime; virtual;\r\n    function DisplayEndDateTime: TDateTime; virtual;\r\n    property ViewCol: Integer read GetViewCol write SetViewCol;\r\n    property ViewRow: Integer read GetViewRow write SetViewRow;\r\n  end;\r\n\r\n  {$IFNDEF LCLLIB}\r\n  [ComponentPlatformsAttribute(TMSPlatformsWeb)]\r\n  {$ENDIF}\r\n  TTMSFNCPlanner = class(TTMSFNCCustomPlanner)\r\n  protected\r\n    procedure RegisterRuntimeClasses; override;\r\n  public\r\n    property ItemCachingMode;\r\n    property CustomDateTimes;\r\n    property Selection;\r\n    property ActiveItem;\r\n    property SelectedItems;\r\n  published\r\n    property Adapter;\r\n    property ToolBarPopup;\r\n    property ItemEditor;\r\n    property BitmapContainer;\r\n    property HorizontalScrollBarVisible;\r\n    property VerticalScrollBarVisible;\r\n    property DefaultItem;\r\n    property Fill;\r\n    property GridCellAppearance;\r\n    property Groups;\r\n    property GroupsAppearance;\r\n    property Interaction;\r\n    property Items;\r\n    property Mode;\r\n    property ModeSettings;\r\n    property OrientationMode;\r\n    property Positions;\r\n    property PositionsAppearance;\r\n    property Resources;\r\n    property SelectionAppearance;\r\n    property StretchScrollBars;\r\n    property Stroke;\r\n    property TimeLine;\r\n    property TimeLineAppearance;\r\n    property ItemsAppearance;\r\n    property Version;\r\n    property OnBeforeDrawTopNavigationButton;\r\n    property OnBeforeDrawBottomNavigationButton;\r\n    property OnAfterDrawTopNavigationButton;\r\n    property OnAfterDrawBottomNavigationButton;\r\n    property OnBeforeDrawCell;\r\n    property OnAfterDrawCell;\r\n    property OnBeforeDrawItemLink;\r\n    property OnAfterDrawItemLink;\r\n    property OnBeforeDrawCellVerticalLine;\r\n    property OnAfterDrawCellVerticalLine;\r\n    property OnBeforeDrawCellHorizontalLine;\r\n    property OnAfterDrawCellHorizontalLine;\r\n    property OnBeforeDrawCurrentTimeInTimeLine;\r\n    property OnAfterDrawCurrentTimeInTimeLine;\r\n    property OnBeforeDrawCurrentTimeInGrid;\r\n    property OnAfterDrawCurrentTimeInGrid;\r\n    property OnBeforeDrawSizeArea;\r\n    property OnBeforeDrawMoveArea;\r\n    property OnBeforeDrawDeleteArea;\r\n    property OnAfterDrawSizeArea;\r\n    property OnAfterDrawMoveArea;\r\n    property OnAfterDrawDeleteArea;\r\n    property OnBeforeDrawPosition;\r\n    property OnAfterDrawPosition;\r\n    property OnBeforeDrawGroup;\r\n    property OnAfterDrawGroup;\r\n    property OnBeforeDrawTime;\r\n    property OnAfterDrawTime;\r\n    property OnBeforeDrawTimeStroke;\r\n    property OnAfterDrawTimeStroke;\r\n    property OnBeforeDrawItem;\r\n    property OnAfterDrawItem;\r\n    property OnBeforeDrawItemTitle;\r\n    property OnAfterDrawItemTitle;\r\n    property OnBeforeDrawPositionText;\r\n    property OnGetPositionText;\r\n    property OnAfterDrawPositionText;\r\n    property OnBeforeDrawGroupText;\r\n    property OnGetGroupText;\r\n    property OnAfterDrawGroupText;\r\n    property OnBeforeDrawTimeText;\r\n    property OnBeforeNavigateToDateTime;\r\n    property OnAfterNavigateToDateTime;\r\n    property OnGetTimeText;\r\n    property OnAfterDrawTimeText;\r\n    property OnBeforeDrawItemText;\r\n    property OnGetItemText;\r\n    property OnAfterDrawItemText;\r\n    property OnBeforeDrawItemTitleText;\r\n    property OnGetItemTitleText;\r\n    property OnAfterDrawItemTitleText;\r\n    property OnSelectTime;\r\n    property OnSelectingTime;\r\n    property OnSelectCell;\r\n    property OnSelectingCell;\r\n    property OnIsItemDeletable;\r\n    property OnIsDateTimeDisabled;\r\n    property OnItemChanged;\r\n    property OnAfterItemChanged;\r\n    property OnIsDateTimeInActive;\r\n    property OnItemAnchorClick;\r\n    property OnIsDateTimeSub;\r\n    property OnHasDateTimeSub;\r\n    property OnBeforeUpdateItem;\r\n    property OnBeforeInsertItem;\r\n    property OnAfterUpdateItem;\r\n    property OnAfterInsertItem;\r\n    property OnBeforeOpenInsertDialog;\r\n    property OnAfterOpenInsertDialog;\r\n    property OnBeforeOpenUpdateDialog;\r\n    property OnAfterOpenUpdateDialog;\r\n    property OnBeforeOpenInplaceEditor;\r\n    property OnAfterOpenInplaceEditor;\r\n    property OnCloseInplaceEditor;\r\n    property OnCloseUpdateDialog;\r\n    property OnCloseInsertDialog;\r\n    property OnGetInplaceEditor;\r\n    property OnBeforeSelectItem;\r\n    property OnAfterSelectItem;\r\n    property OnBeforeDeleteItem;\r\n    property OnAfterDeleteItem;\r\n    property OnBeforeMoveItem;\r\n    property OnMoveItem;\r\n    property OnAfterMoveItem;\r\n    property OnBeforeSizeItem;\r\n    property OnSizeItem;\r\n    property OnAfterSizeItem;\r\n    property OnHScroll;\r\n    property OnVScroll;\r\n    property OnBeforeDrawPositionEmptySpace;\r\n    property OnAfterDrawPositionEmptySpace;\r\n    property OnBeforeDrawGroupEmptySpace;\r\n    property OnAfterDrawGroupEmptySpace;\r\n    property OnBeforeDrawItemHelper;\r\n    property OnBeforeDrawItemHelperText;\r\n    property OnAfterDrawItemHelper;\r\n    property OnAfterDrawItemHelperText;\r\n    property OnGetItemHelperText;\r\n    property OnCustomContentPanelToItem;\r\n    property OnItemToCustomContentPanel;\r\n    property OnGetCustomContentPanel;\r\n    property OnInitializeCustomContentPanel;\r\n  end;\r\n\r\nfunction MakeCell(ACol, ARow: Integer): TTMSFNCPlannerCell;\r\nfunction DateTimeInRangeEx(ADateTime: TDateTime; AStartDateTime, AEndDateTime: TDateTime; aInclusive: Boolean = True): Boolean;\r\n\r\nimplementation\r\n\r\n{$R TMSFNCPlanner.res}\r\n\r\nuses\r\n  {$IFNDEF WEBLIB}\r\n  SysUtils,\r\n  {$ENDIF}\r\n  DateUtils, Math, WEBLib.TMSFNCUtils, WEBLib.Forms, WEBLib.TMSFNCStyles\r\n  {$IFDEF FMXLIB}\r\n  ,FMX.Styles.Objects, FMX.Layouts\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  ,Rtti\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  ;\r\ntype\r\n  TTMSFNCPlannerItemOpen = class(TTMSFNCPlannerItem);\r\n  TTMSFNCPlannerResourceOpen = class(TTMSFNCPlannerResource);\r\n  TTMSFNCPlannerGroupOpen = class(TTMSFNCPlannerGroup);\r\n\r\n{$IFDEF LCLWEBLIB}\r\nfunction CompareRes({$IFDEF LCLLIB}const {$ENDIF}Item1, Item2: TTMSFNCPlannerResourceDate): Integer;\r\nbegin\r\n  Result := CompareDateTime(Item1.DateTime, Item2.DateTime);\r\nend;\r\n\r\nfunction CompareDT({$IFDEF LCLLIB}const {$ENDIF}Item1, Item2: TDateTime): Integer;\r\nbegin\r\n  Result := CompareDateTime(Item1, Item2);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction DateTimeInRangeEx(ADateTime: TDateTime; AStartDateTime, AEndDateTime: TDateTime; aInclusive: Boolean = True): Boolean;\r\nvar\r\n  vs, ve: TValueRelationship;\r\nbegin\r\n  vs := CompareDateTime(AStartDateTime, ADateTime);\r\n  ve := CompareDateTime(AEndDateTime, ADateTime);\r\n  if aInclusive then\r\n    Result := ((vs = EqualsValue) or (vs = LessThanValue)) and ((ve = EqualsValue) or (ve = GreaterThanValue))\r\n  else\r\n    Result := ((vs = LessThanValue)) and ((ve = GreaterThanValue))\r\nend;\r\n\r\nfunction IsValidCell(ACol, ARow: Integer): Boolean;\r\nbegin\r\n  Result := (ACol <> -1) and (ARow <> -1);\r\nend;\r\n\r\nfunction MakeCell(ACol, ARow: Integer): TTMSFNCPlannerCell;\r\nbegin\r\n  Result.Col := ACol;\r\n  Result.Row := ARow;\r\nend;\r\n\r\nfunction GetTickCountX: DWORD;\r\nvar\r\n  h, m, s, ms: Word;\r\nbegin\r\n  DecodeTime(Now, h, m, s, ms);\r\n  Result := ms + s * 1000 + m * 60 * 1000 + h * 60 * 60 * 1000;\r\nend;\r\n\r\nfunction AnimateDouble(var Start, Stop: Double; Delta, Margin: Double): Boolean;\r\nbegin\r\n  Result := true;\r\n  if (Start > Stop - Margin) and (Start < Stop + Margin) then\r\n  begin\r\n    Start := Stop;\r\n    Result := false;\r\n  end\r\n  else\r\n  begin\r\n    Delta := Max(Margin, Delta);\r\n    if Start < Stop then\r\n      Start := Start + Delta\r\n    else\r\n      Start := Start - Delta;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerCustomToolBarPopup }\r\n\r\nconstructor TTMSFNCPlannerCustomToolBarPopup.Create(AOwner: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  if Assigned(AOwner) and (AOwner is TCustomForm) then\r\n  begin\r\n    for I := 0 to AOwner.ComponentCount - 1 do\r\n    begin\r\n      if (AOwner.Components[i] is TTMSFNCCustomPlanner) then\r\n      begin\r\n        Planner := AOwner.Components[i] as TTMSFNCCustomPlanner;\r\n        Planner.ToolBarPopup := Self;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerCustomToolBarPopup.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = Planner) then\r\n    Planner := nil;\r\nend;\r\n\r\n{ TTMSFNCCustomPlanner }\r\n\r\nprocedure TTMSFNCCustomPlanner.SaveScrollPosition;\r\nbegin\r\n  FSaveHScrollPos := GetHScrollValue;\r\n  FSaveVScrollPos := GetVScrollValue;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SelectCells(AStartCell, AEndCell: TTMSFNCPlannerCell);\r\nbegin\r\n  inherited;\r\n  HandleSelection(AStartCell, AEndCell);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.SelectedEndDateTime: TDateTime;\r\nbegin\r\n  Result := CellToEndDateTime(Selection.EndCell);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.SelectedResource: Integer;\r\nbegin\r\n  Result := PositionToResource(Selection.StartCell.Col);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.SelectedStartDateTime: TDateTime;\r\nbegin\r\n  Result := CellToStartDatetime(Selection.StartCell);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SelectItem(AItemIndex: Integer);\r\nbegin\r\n  if (AItemIndex >= 0) and (AItemIndex <= Items.Count - 1) then\r\n    HandleSelectItem(Items[AItemIndex])\r\n  else\r\n    HandleSelectItem(nil);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SelectItems(AItems: TTMSFNCPlannerItemArray);\r\nvar\r\n  I: Integer;\r\n  it: Integer;\r\nbegin\r\n  for I := 0 to Length(AItems) - 1 do\r\n  begin\r\n    it := AItems[I];\r\n    if (it >= 0) and (it <= Items.Count - 1) then\r\n      HandleSelectItem(Items[it], True);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SelectLinkedItems(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  HandleSelectLinkedItems(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UnselectAllItems;\r\nbegin\r\n  SelectItem(nil);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UnSelectItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  HandleUnselectItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SelectItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  HandleSelectItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.Navigate(ACell: TTMSFNCPlannerCell; AForceScroll: Boolean = False);\r\nvar\r\n  hs, vs, rhs, rvs, vss, hss: Double;\r\n  cw, ch: Double;\r\n  hscroll, vscroll: TScrollbar;\r\n  totalh, totalw: Double;\r\n  cs, rs: Integer;\r\n  toth, totw: Double;\r\n  cl: TTMSFNCPlannerCell;\r\n  cr: TRectF;\r\nbegin\r\n  hscroll := HorizontalScrollBar;\r\n  vscroll := VerticalScrollBar;\r\n\r\n  if Assigned(hscroll) and Assigned(vscroll) then\r\n  begin\r\n    cr := GetContentRect;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        cw := cr.Bottom - cr.Top;\r\n        ch := cr.Right - cr.Left;\r\n        vs := GetHScrollValue;\r\n        hs := GetVScrollValue;\r\n\r\n        vss := vs;\r\n        hss := hs;\r\n\r\n        if ScrollMode = smCellScrolling then\r\n        begin\r\n          hss := GetVerticalScrollPosition;\r\n          vss := GetHorizontalScrollPosition;\r\n        end;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        cw := cr.Right -  cr.Left;\r\n        ch := cr.Bottom - cr.Top;\r\n        vs := GetVScrollValue;\r\n        hs := GetHScrollValue;\r\n\r\n        vss := vs;\r\n        hss := hs;\r\n\r\n        if ScrollMode = smCellScrolling then\r\n        begin\r\n          vss := GetVerticalScrollPosition;\r\n          hss := GetHorizontalScrollPosition;\r\n        end;\r\n      end;\r\n      else\r\n      begin\r\n        hs := 0;\r\n        vs := 0;\r\n        vss := 0;\r\n        hss := 0;\r\n        cw := 0;\r\n        ch := 0;\r\n      end;\r\n    end;\r\n\r\n    totalw := ColumnWidths[ACell.Col];\r\n    totalh := RowHeights[ACell.Row];\r\n\r\n    rvs := RowPositions[ACell.Row];\r\n    if AForceScroll then\r\n    begin\r\n      case ScrollMode of\r\n        smPixelScrolling: vs := rvs;\r\n        smCellScrolling: vs := ACell.Row;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if (rvs < vss) then\r\n      begin\r\n        case ScrollMode of\r\n          smPixelScrolling: vs := rvs;\r\n          smCellScrolling: vs := ACell.Row;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        case ScrollMode of\r\n          smPixelScrolling:\r\n          begin\r\n            if (rvs + totalh > vss + ch) then\r\n              vs := rvs + totalh - ch + 1;\r\n          end;\r\n          smCellScrolling:\r\n          begin\r\n            while (rvs + totalh > vss + ch) do\r\n            begin\r\n              vs := vs + 1;\r\n              cl := MakeCell(ACell.Col, Round(vs));\r\n              rs := 1;\r\n              if rs > 0 then\r\n                toth := RowPositions[cl.Row + rs - 1] - RowPositions[cl.Row]\r\n              else\r\n              begin\r\n                rs := 1;\r\n                toth := RowHeights[cl.Row];\r\n              end;\r\n\r\n              vs := vs + rs - 1;\r\n              vss := vss + toth;\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    rhs := ColumnPositions[ACell.Col];\r\n    if AForceScroll then\r\n    begin\r\n      case ScrollMode of\r\n        smPixelScrolling: hs := rhs;\r\n        smCellScrolling: hs := ACell.Col;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if (rhs < hss) then\r\n      begin\r\n        case ScrollMode of\r\n          smPixelScrolling: hs := rhs;\r\n          smCellScrolling: hs := ACell.Col;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        case ScrollMode of\r\n          smPixelScrolling:\r\n          begin\r\n            if (rhs + totalw > hss + cw) then\r\n              hs := rhs + totalw - cw + 1;\r\n          end;\r\n          smCellScrolling:\r\n          begin\r\n            while (rhs + totalw > hss + cw) do\r\n            begin\r\n              hs := hs + 1;\r\n              cl := MakeCell(Round(hs), ACell.Row);\r\n              cs := 1;\r\n              if cs > 0 then\r\n                totw := ColumnPositions[cl.Col] - ColumnPositions[cl.Col + cs - 1]\r\n              else\r\n              begin\r\n                cs := 1;\r\n                totw := ColumnWidths[cl.Col];\r\n              end;\r\n\r\n              hs := hs + cs - 1;\r\n              hss := hss + totw;\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n    case OrientationMode of\r\n      pomHorizontal: Scroll(vs, hs);\r\n      pomVertical: Scroll(hs, vs);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.NavigateToNextDateTime(ADateTime: TDateTime = -1);\r\nvar\r\n  stdt: TDateTime;\r\nbegin\r\n  BeginUpdate;\r\n  SaveScrollPosition;\r\n  stdt := ModeSettings.StartTime;\r\n\r\n  if ADateTime <> -1 then\r\n    ModeSettings.StartTime := ADateTime\r\n  else\r\n    ModeSettings.StartTime := GetNextDateTime;\r\n\r\n  ModeSettings.EndTime := ModeSettings.EndTime + (ModeSettings.StartTime - stdt);\r\n  RestoreScrollPosition;\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.NavigateToPreviousDateTime(ADateTime: TDateTime = -1);\r\nvar\r\n  stdt: TDateTime;\r\nbegin\r\n  BeginUpdate;\r\n  SaveScrollPosition;\r\n  stdt := ModeSettings.StartTime;\r\n\r\n  if ADateTime <> -1 then\r\n    ModeSettings.StartTime := ADateTime\r\n  else\r\n    ModeSettings.StartTime := GetPreviousDateTime;\r\n\r\n  ModeSettings.EndTime := ModeSettings.EndTime + (ModeSettings.StartTime - stdt);\r\n  RestoreScrollPosition;\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.NeedsConflictsUpdate(AItem: TTMSFNCPlannerItem = nil);\r\nvar\r\n  I: Integer;\r\n  pos: Integer;\r\n  lst: TTMSFNCPlannerIntegerList;\r\nbegin\r\n  if csDestroying in ComponentState then\r\n    Exit;\r\n\r\n  if UpdateCount > 0 then\r\n  begin\r\n    FNeedsConflictsUpdate := True;\r\n    Exit;\r\n  end;\r\n\r\n  if Assigned(AItem) then\r\n  begin\r\n    lst := TTMSFNCPlannerItemOpen(AItem).OldPositionsList;\r\n    for I := 0 to lst.Count - 1 do\r\n    begin\r\n      pos := lst[I];\r\n      if (pos >= 0) and (pos <= FConflicts.Count - 1) then\r\n        FConflicts[pos].NeedsConflictsUpdate := True;\r\n    end;\r\n\r\n    lst := TTMSFNCPlannerItemOpen(AItem).PositionsList;\r\n    for I := 0 to lst.Count - 1 do\r\n    begin\r\n      pos := lst[I];\r\n      if (pos >= 0) and (pos <= FConflicts.Count - 1) then\r\n        FConflicts[pos].NeedsConflictsUpdate := True;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    for I := 0 to FConflicts.Count - 1 do\r\n      FConflicts[I].NeedsConflictsUpdate := True;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (AComponent = FBitmapContainer) and (Operation = opRemove) then\r\n    FBitmapContainer := nil;\r\n\r\n  if (AComponent = FAdapter) and (Operation = opRemove) then\r\n    FAdapter := nil;\r\n\r\n  if (AComponent = FItemEditor) and (Operation = opRemove) then\r\n    FItemEditor := nil;\r\n\r\n  if (AComponent = FToolBarPopup) and (Operation = opRemove) then\r\n    FToolBarPopup := nil;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.OpenEditingDialog(AStartTime, AEndTime: TDateTime; AResource: Integer; ATitle, AText: String; AUpdateItem: Integer = -1; ACustomParent: TTMSFNCPlannerCustomParent = nil);\r\nvar\r\n  p: TTMSFNCPlannerEditingDialog;\r\n  s: TStringList;\r\n  fr: Boolean;\r\n  it: TTMSFNCPlannerItem;\r\n  d: Boolean;\r\n  itd: TTMSFNCPlannerItem;\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  prnt: TControl;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  prnt: TWinControl;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nbegin\r\n  FInsertResource := AResource;\r\n  FUpdateItem := AUpdateItem;\r\n\r\n  p := GetEditingDialog(FUpdateItem);\r\n\r\n  FDialogStartDate := Int(AStartTime);\r\n  if Assigned(p.StartDateEdit) then\r\n    p.StartDateEdit.Date := FDialogStartDate;\r\n\r\n  FDialogEndDate := Int(AEndTime);\r\n  if Assigned(p.EndDateEdit) then\r\n    p.EndDateEdit.Date := FDialogEndDate;\r\n\r\n  FDialogStartTime := Frac(AStartTime);\r\n  if Assigned(p.StartTimeEdit) then\r\n    p.StartTimeEdit.Time := FDialogStartTime;\r\n\r\n  FDialogEndTime := Frac(AEndTime);\r\n  if Assigned(p.EndTimeEdit) then\r\n    p.EndTimeEdit.Time := FDialogEndTime;\r\n\r\n  if Assigned(p.TitleEdit) then\r\n    p.TitleEdit.Text := ATitle;\r\n\r\n  if Assigned(p.TextMemo) then\r\n    p.TextMemo.Text := AText;\r\n\r\n  fr := false;\r\n  if (AUpdateItem >= 0) and (AUpdateItem <= Items.Count - 1) then\r\n    fr := Items[AUpdateItem].FixedResource;\r\n\r\n  if Assigned(p.ResourcesComboBox) then\r\n  begin\r\n    {$IFDEF CMNWEBLIB}\r\n    prnt := p.ResourcesComboBox.Parent;\r\n    if not Assigned(ACustomParent) then\r\n      p.ResourcesComboBox.Parent := Self\r\n    else\r\n      p.ResourcesComboBox.Parent := ACustomParent;\r\n    {$ENDIF}\r\n    p.ResourcesComboBox.Clear;\r\n    s := GetResources;\r\n    p.ResourcesComboBox.Items.Assign(s);\r\n    p.ResourcesComboBox.ItemIndex := PositionToResource(AResource);\r\n    p.ResourcesComboBox.Visible := GetResourcesAvailable and not fr;\r\n    {$IFDEF CMNWEBLIB}\r\n    p.ResourcesComboBox.Parent := prnt;\r\n    {$ENDIF}\r\n    s.Free;\r\n  end;\r\n\r\n  if Assigned(p.ResourceLabel) then\r\n    p.ResourceLabel.Visible := GetResourcesAvailable and not fr;\r\n\r\n  if Assigned(p.TitleLabel) then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    if Assigned(p.ResourceLabel) and p.ResourceLabel.Visible then\r\n      p.TitleLabel.Position.Y := p.ResourceLabel.Position.Y + p.ResourceLabel.Height + 15\r\n    else if Assigned(p.StartTimeLabel) then\r\n      p.TitleLabel.Position.Y := p.EndTimeLabel.Position.Y + p.EndTimeLabel.Height + 15;\r\n\r\n    if Assigned(p.TitleEdit) then\r\n      p.TitleEdit.Position.Y := p.TitleLabel.Position.Y + Int((p.TitleLabel.Height - p.TitleEdit.Height) / 2);\r\n\r\n    if Assigned(p.TextLabel) then\r\n      p.TextLabel.Position.Y := p.TitleLabel.Position.Y + p.TitleLabel.Height + 15;\r\n\r\n    if Assigned(p.TextMemo) then\r\n      p.TextMemo.Margins.Top := p.TextLabel.Position.Y + p.TextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    if Assigned(p.ResourceLabel) and p.ResourceLabel.Visible then\r\n      p.TitleLabel.Top := p.ResourceLabel.Top + p.ResourceLabel.Height + 15\r\n    else if Assigned(p.StartTimeLabel) then\r\n      p.TitleLabel.Top := p.EndTimeLabel.Top + p.EndTimeLabel.Height + 15;\r\n\r\n    if Assigned(p.TitleEdit) then\r\n      p.TitleEdit.Top := p.TitleLabel.Top + (p.TitleLabel.Height - p.TitleEdit.Height) div 2;\r\n\r\n    if Assigned(p.TextLabel) then\r\n      p.TextLabel.Top := p.TitleLabel.Top + p.TitleLabel.Height + 15;\r\n\r\n    {$IFNDEF LCLLIB}\r\n    if Assigned(p.TextMemo) then\r\n      p.TextMemo.Margins.Top := p.TextLabel.Top + p.TextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    if Assigned(p.TextMemo) then\r\n      p.TextMemo.BorderSpacing.Top := p.TextLabel.Top + p.TextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  end;\r\n\r\n  if Assigned(p.ButtonRemove) then\r\n  begin\r\n    if (AUpdateItem >= 0) and (AUpdateItem <= Items.Count - 1) then\r\n    begin\r\n      itd := Items[AUpdateItem];\r\n      d := itd.Deletable;\r\n      DoIsItemDeletable(itd, d);\r\n      p.ButtonRemove.Visible := d;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(p.Background) and not Assigned(ACustomParent) then\r\n    p.Background.Parent := Self;\r\n\r\n  if Assigned(p.Panel) then\r\n  begin\r\n    if Assigned(ACustomParent) then\r\n      p.Panel.Parent := ACustomParent\r\n    else\r\n      p.Panel.Parent := Self;\r\n  end;\r\n\r\n  if p.CustomContentPanel and Assigned(p.ContentPanel) then\r\n  begin\r\n    it := nil;\r\n    if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n      it := Items[FUpdateItem];\r\n\r\n    DoInitializeCustomContentPanel(it, p.ContentPanel);\r\n    DoItemToCustomContentPanel(it, p.ContentPanel);\r\n  end;\r\n\r\n  if Assigned(p.StartDateEdit) then\r\n    p.StartDateEdit.Date := p.StartDateEdit.Date;\r\n\r\n  if Assigned(p.EndDateEdit) then\r\n    p.EndDateEdit.Date := p.EndDateEdit.Date;\r\n\r\n  if Assigned(p.StartTimeEdit) then\r\n    p.StartTimeEdit.Time := p.StartTimeEdit.Time;\r\n\r\n  if Assigned(p.EndTimeEdit) then\r\n    p.EndTimeEdit.Time := p.EndTimeEdit.Time;\r\n\r\n  if Assigned(p.StartDateEdit) and not p.CustomContentPanel and p.StartDateEdit.CanFocus and not Assigned(ACustomParent) then\r\n    p.StartDateEdit.SetFocus;\r\n\r\n  if Assigned(p.Panel) then\r\n    p.Panel.Invalidate;\r\n\r\n  FEditorDialogActive := True;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawGroup) then\r\n    OnAfterDrawGroup(Self, AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawGroupEmptySpace(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace);\r\nbegin\r\n  if Assigned(OnAfterDrawGroupEmptySpace) then\r\n    OnAfterDrawGroupEmptySpace(Self, AGraphics, ARect, ASpace);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawGroupText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String);\r\nbegin\r\n  if Assigned(OnAfterDrawGroupText) then\r\n    OnAfterDrawGroupText(Self, AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterDrawItem) then\r\n    OnAfterDrawItem(Self, AGraphics, ARect, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemHelper(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem;\r\n  AIsStartTime: Boolean; AValue: TDateTime);\r\nbegin\r\n  if Assigned(OnAfterDrawItemHelper) then\r\n    OnAfterDrawItemHelper(Self, AGraphics, ARect, AItem, AIsStartTime, AValue);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemLink(AGraphics: TTMSFNCGraphics; AItem,\r\n  ALinkedItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterDrawItemLink) then\r\n    OnAfterDrawItemLink(Self, AGraphics, AItem, ALinkedItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemHelperText(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime;\r\n  AText: String);\r\nbegin\r\n  if Assigned(OnAfterDrawItemHelperText) then\r\n    OnAfterDrawItemHelperText(Self, AGraphics, ARect, AItem, AIsStartTime, AValue, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawMoveArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterDrawMoveArea) then\r\n    OnAfterDrawMoveArea(Self, AGraphics, ARect, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawSizeArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterDrawSizeArea) then\r\n    OnAfterDrawSizeArea(Self, AGraphics, ARect, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String);\r\nbegin\r\n  if Assigned(OnAfterDrawItemText) then\r\n    OnAfterDrawItemText(Self, AGraphics, ARect, AItem, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemTitleText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String);\r\nbegin\r\n  if Assigned(OnAfterDrawItemTitleText) then\r\n    OnAfterDrawItemTitleText(Self, AGraphics, ARect, AItem, ATitle);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nprocedure TTMSFNCCustomPlanner.ApplyInplaceEditorStyleLookup(Sender: TObject);\r\nvar\r\n  obj: TFmxObject;\r\nbegin\r\n  if Sender = FInplaceEditor then\r\n  begin\r\n    obj := FInplaceEditor.FindStyleResource('background');\r\n    if Assigned(obj) and (obj is TActiveStyleObject) then\r\n      TActiveStyleObject(obj).Source := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAbsoluteChanged;\r\nbegin\r\n  inherited;\r\n  if Parent is TScaledLayout then\r\n    UpdatePlannerCache;\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawBottomNavigationButton(\r\n  AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton;\r\n  AButtonState: TTMSFNCPlannerNavigationButtonState);\r\nbegin\r\n  if Assigned(OnAfterDrawBottomNavigationButton) then\r\n    OnAfterDrawBottomNavigationButton(Self, AGraphics, ARect, AButton, AButtonState);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawCell) then\r\n    OnAfterDrawCell(Self, AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawCellHorizontalLine(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime;\r\n  APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawCellHorizontalLine) then\r\n    OnAfterDrawCellHorizontalLine(Self, AGraphics, ARect, ASubUnit, ACol, ARow, ADateTime, APosition, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawCellVerticalLine(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawCellVerticalLine) then\r\n    OnAfterDrawCellVerticalLine(Self, AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AValue: Double; ACurrentTime: TDateTime);\r\nbegin\r\n  if Assigned(OnAfterDrawCurrentTimeInGrid) then\r\n    OnAfterDrawCurrentTimeInGrid(Self, AGraphics, ARect, AValue, ACurrentTime);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawCurrentTimeInTimeLine(\r\n  AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind;\r\n  AValue: Double; ACurrentTime: TDateTime);\r\nbegin\r\n  if Assigned(OnAfterDrawCurrentTimeInTimeLine) then\r\n    OnAfterDrawCurrentTimeInTimeLine(Self, AGraphics, ARect, AKind, AValue, ACurrentTime);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawDeleteArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterDrawDeleteArea) then\r\n    OnAfterDrawDeleteArea(Self, AGraphics, ARect, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawPosition(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawPosition) then\r\n    OnAfterDrawPosition(Self, AGraphics, ARect, APosition, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawPositionEmptySpace(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace);\r\nbegin\r\n  if Assigned(OnAfterDrawPositionEmptySpace) then\r\n    OnAfterDrawPositionEmptySpace(Self, AGraphics, ARect, ASpace);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawPositionText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String);\r\nbegin\r\n  if Assigned(OnAfterDrawPositionText) then\r\n    OnAfterDrawPositionText(Self, AGraphics, ARect, APosition, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawTime) then\r\n    OnAfterDrawTime(Self, AGraphics, ARect, AValue, ARow, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawTimeStroke(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AValue: Double; ASubUnit: Boolean; ARow: Integer;\r\n  AKind: TTMSFNCPlannerCacheItemKind);\r\nbegin\r\n  if Assigned(OnAfterDrawTimeStroke) then\r\n    OnAfterDrawTimeStroke(Self, AGraphics, ARect, AValue, ASubUnit, ARow, AKind);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawTimeText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind;\r\n  AText: string);\r\nbegin\r\n  if Assigned(OnAfterDrawTimeText) then\r\n    OnAfterDrawTimeText(Self, AGraphics, ARect, AValue, ARow, ASubUnit, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawTopNavigationButton(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton;\r\n  AButtonState: TTMSFNCPlannerNavigationButtonState);\r\nbegin\r\n  if Assigned(OnAfterDrawTopNavigationButton) then\r\n    OnAfterDrawTopNavigationButton(Self, AGraphics, ARect, AButton, AButtonState);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDrawItemTitle(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AItem: TTMSFNCPlannerItem; ATitle: String);\r\nbegin\r\n  if Assigned(OnAfterDrawItemTitle) then\r\n    OnAfterDrawItemTitle(Self, AGraphics, ARect, AItem, ATitle);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterInsertItem(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterInsertItem) then\r\n    OnAfterInsertItem(Self, AStartTime, AEndTime, APosition, AItem);\r\n\r\n  if Assigned(Adapter) then\r\n    Adapter.InsertItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterOpenInplaceEditor(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; AInplaceEditor: TTMSFNCPlannerInplaceEditor; AInplaceEditorRect: TRectF);\r\nbegin\r\n  if Assigned(OnAfterOpenInplaceEditor) then\r\n    OnAfterOpenInplaceEditor(Self, AStartTime, AEndTime, APosition, AItem, AInplaceEditor, AInplaceEditorRect);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterOpenInsertDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer);\r\nbegin\r\n  if Assigned(OnAfterOpenInsertDialog) then\r\n    OnAfterOpenInsertDialog(Self, AStartTime, AEndTime, APosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterOpenUpdateDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterOpenUpdateDialog) then\r\n    OnAfterOpenUpdateDialog(Self, AStartTime, AEndTime, APosition, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterUpdateItem(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterUpdateItem) then\r\n    OnAfterUpdateItem(Self, AStartTime, AEndTime, APosition, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawGroup) then\r\n    OnBeforeDrawGroup(Self, AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawGroupEmptySpace(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASpace: TTMSFNCPlannerGroupEmptySpace; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawGroupEmptySpace) then\r\n    OnBeforeDrawGroupEmptySpace(Self, AGraphics, ARect, ASpace, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawGroupText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AGroup, AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawGroupText) then\r\n    OnBeforeDrawGroupText(Self, AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind, AText, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AItem: TTMSFNCPlannerItem; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItem) then\r\n    OnBeforeDrawItem(Self, AGraphics, ARect, AItem, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemHelper(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem;\r\n  AIsStartTime: Boolean; AValue: TDateTime; var AAllow, ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemHelper) then\r\n    OnBeforeDrawItemHelper(Self, AGraphics, ARect, AItem, AIsStartTime, AValue, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemHelperText(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AItem: TTMSFNCPlannerItem; AIsStartTime: Boolean; AValue: TDateTime; AText: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemHelperText) then\r\n    OnBeforeDrawItemHelperText(Self, AGraphics, ARect, AItem, AIsStartTime, AValue, AText, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemLink(AGraphics: TTMSFNCGraphics; AItem,\r\n  ALinkedItem: TTMSFNCPlannerItem; var ACanDrawLink: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemLink) then\r\n    OnBeforeDrawItemLink(Self, AGraphics, AItem, ALinkedItem, ACanDrawLink);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawMoveArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow, ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawMoveArea) then\r\n    OnBeforeDrawMoveArea(Self, AGraphics, ARect, AItem, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawSizeArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow, ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawSizeArea) then\r\n    OnBeforeDrawSizeArea(Self, AGraphics, ARect, AItem, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; AText: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemText) then\r\n    OnBeforeDrawItemText(Self, AGraphics, ARect, AItem, AText, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemTitleText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemTitleText) then\r\n    OnBeforeDrawItemTitleText(Self, AGraphics, ARect, AItem, ATitle, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDeleteItem(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerItemDeleteMode;\r\n  var ACanDelete: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDeleteItem) then\r\n    OnBeforeDeleteItem(Self, AItem, AMode, ACanDelete);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawBottomNavigationButton(\r\n  AGraphics: TTMSFNCGraphics; ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton;\r\n  AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawBottomNavigationButton) then\r\n    OnBeforeDrawBottomNavigationButton(Self, AGraphics, ARect, AButton, AButtonState, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime: TDateTime; AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawCell) then\r\n    OnBeforeDrawCell(Self, AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawCellHorizontalLine(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASubUnit: Boolean; ACol, ARow: Integer; ADateTime: TDateTime;\r\n  APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawCellHorizontalLine) then\r\n    OnBeforeDrawCellHorizontalLine(Self, AGraphics, ARect, ASubUnit, ACol, ARow, ADateTime, APosition, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawCellVerticalLine(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawCellVerticalLine) then\r\n    OnBeforeDrawCellVerticalLine(Self, AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AValue: Double; ACurrentTime: TDateTime; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawCurrentTimeInGrid) then\r\n    OnBeforeDrawCurrentTimeInGrid(Self, AGraphics, ARect, AValue, ACurrentTime, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawCurrentTimeInTimeLine(\r\n  AGraphics: TTMSFNCGraphics; ARect: TRectF; AKind: TTMSFNCPlannerCacheItemKind;\r\n  AValue: Double; ACurrentTime: TDateTime; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawCurrentTimeInTimeLine) then\r\n    OnBeforeDrawCurrentTimeInTimeLine(Self, AGraphics, ARect, AKind, AValue, ACurrentTime, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawDeleteArea(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; var AAllow, ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawDeleteArea) then\r\n    OnBeforeDrawDeleteArea(Self, AGraphics, ARect, AItem, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawPosition(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawPosition) then\r\n    OnBeforeDrawPosition(Self, AGraphics, ARect, APosition, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawPositionEmptySpace(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; ASpace: TTMSFNCPlannerPositionEmptySpace; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawPositionEmptySpace) then\r\n    OnBeforeDrawPositionEmptySpace(Self, AGraphics, ARect, ASpace, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawPositionText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind; AText: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawPositionText) then\r\n    OnBeforeDrawPositionText(Self, AGraphics, ARect, APosition, AKind, AText, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawTime) then\r\n    OnBeforeDrawTime(Self, AGraphics, ARect, AValue, ARow, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawTimeStroke(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AValue: Double; ASubUnit: Boolean; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind; var AAllow: Boolean; var ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawTimeStroke) then\r\n    OnBeforeDrawTimeStroke(Self, AGraphics, ARect, AValue, ASubUnit, ARow, AKind, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawTimeText(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AValue: Double; ARow: Integer; ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind;\r\n  AText: String; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawTimeText) then\r\n    OnBeforeDrawTimeText(Self, AGraphics, ARect, AValue, ARow, ASubUnit, AKind, AText, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawTopNavigationButton(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AButton: TTMSFNCPlannerNavigationButton;\r\n  AButtonState: TTMSFNCPlannerNavigationButtonState; var AAllow,\r\n  ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawTopNavigationButton) then\r\n    OnBeforeDrawTopNavigationButton(Self, AGraphics, ARect, AButton, AButtonState, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeDrawItemTitle(AGraphics: TTMSFNCGraphics;\r\n  ARect: TRectF; AItem: TTMSFNCPlannerItem; ATitle: String; var AAllow, ADefaultDraw: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeDrawItemTitle) then\r\n    OnBeforeDrawItemTitle(Self, AGraphics, ARect, AItem, ATitle, AAllow, ADefaultDraw);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeInsertItem(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; var ATitle: String; var AText: String; var ACanInsert: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeInsertItem) then\r\n    OnBeforeInsertItem(Self, AStartTime, AEndTime, APosition, ATitle, AText, ACanInsert);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeMoveItem(AItem: TTMSFNCPlannerItem;\r\n  var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanMove: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeMoveItem) then\r\n    OnBeforeMoveItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition, ACanMove);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeNavigateToDateTime(ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime: TDateTime; var ANewDateTime: TDateTime; var AAllow: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeNavigateToDateTime) then\r\n    OnBeforeNavigateToDateTime(Self, ADirection, ACurrentDateTime, ANewDateTime, AAllow);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeOpenInplaceEditor(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ACanOpen: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeOpenInplaceEditor) then\r\n    OnBeforeOpenInplaceEditor(Self, AStartTime, AEndTime, APosition, AItem, ACanOpen);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeOpenInsertDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; var ACanOpen: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeOpenInsertDialog) then\r\n    OnBeforeOpenInsertDialog(Self, AStartTime, AEndTime, APosition, ACanOpen);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeOpenUpdateDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem;\r\n  var ACanOpen: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeOpenUpdateDialog) then\r\n    OnBeforeOpenUpdateDialog(Self, AStartTime, AEndTime, APosition, AItem, ACanOpen);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeSelectItem(AItem: TTMSFNCPlannerItem;\r\n  var ACanSelect: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeSelectItem) then\r\n    OnBeforeSelectItem(Self, AItem, ACanSelect);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeSizeItem(AItem: TTMSFNCPlannerItem;\r\n  var ANewStartTime: TDateTime; var ANewEndTime: TDateTime; var ANewPosition: Integer; var ACanSize: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeSizeItem) then\r\n    OnBeforeSizeItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition, ACanSize);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoBeforeUpdateItem(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; var ATitle: String; var AText: String;\r\n  var ACanUpdate: Boolean);\r\nbegin\r\n  if Assigned(OnBeforeUpdateItem) then\r\n    OnBeforeUpdateItem(Self, AStartTime, AEndTime, APosition, AItem, ATitle, AText, ACanUpdate);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoCloseInplaceEditor(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean);\r\nbegin\r\n  if Assigned(OnCloseInplaceEditor) then\r\n    OnCloseInplaceEditor(Self, AStartTime, AEndTime, APosition, AItem, ACancelled, ACanClose);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoCloseInsertDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean; var ACanClose: Boolean);\r\nbegin\r\n  if Assigned(OnCloseInsertDialog) then\r\n    OnCloseInsertDialog(Self, AStartTime, AEndTime, APosition, AItem, ACancelled, ACanClose);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoCloseUpdateDialog(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem; ACancelled: Boolean;\r\n  var ACanClose: Boolean);\r\nbegin\r\n  if Assigned(OnCloseUpdateDialog) then\r\n    OnCloseUpdateDialog(Self, AStartTime, AEndTime, APosition, AItem, ACancelled, ACanClose);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoCustomContentPanelToItem(\r\n  AContentPanel: TTMSFNCPlannerEditingDialogContentPanel; AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(ItemEditor) then\r\n    ItemEditor.CustomContentPanelToItem(AContentPanel, AItem);\r\n\r\n  if Assigned(OnCustomContentPanelToItem) then\r\n    OnCustomContentPanelToItem(Self, AContentPanel, AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterDeleteItem(AItemIndex: Integer; ADBKey: String; AMode: TTMSFNCPlannerItemDeleteMode);\r\nbegin\r\n  if Assigned(OnAfterDeleteItem) then\r\n    OnAfterDeleteItem(Self, AItemIndex, ADBKey, AMode);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetCustomContentPanel(\r\n  AItem: TTMSFNCPlannerItem; var AContentPanel: TTMSFNCPlannerEditingDialogContentPanel);\r\nbegin\r\n  if Assigned(ItemEditor) then\r\n  begin\r\n    if not ItemEditor.Created then\r\n    begin\r\n      ItemEditor.CreateCustomContentPanel;\r\n      ItemEditor.Created := True;\r\n    end;\r\n    ItemEditor.GetCustomContentPanel(AItem, AContentPanel);\r\n  end;\r\n\r\n  if Assigned(OnGetCustomContentPanel) then\r\n    OnGetCustomContentPanel(Self, AItem, AContentPanel);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoInitializeCustomContentPanel(\r\n  AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel);\r\nbegin\r\n  if Assigned(ItemEditor) then\r\n  begin\r\n    if not ItemEditor.Initialized then\r\n    begin\r\n      ItemEditor.InitializeCustomContentPanel;\r\n      ItemEditor.Initialized := True;\r\n    end;\r\n  end;\r\n\r\n  if Assigned(OnInitializeCustomContentPanel) then\r\n    OnInitializeCustomContentPanel(Self, AItem, AContentPanel);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetGroupText(AGroup: Integer;\r\n  AKind: TTMSFNCPlannerCacheItemKind; var AText: String);\r\nbegin\r\n  if Assigned(OnGetGroupText) then\r\n    OnGetGroupText(Self, AGroup, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetInplaceEditor(AStartTime,\r\n  AEndTime: TDateTime; APosition: Integer; AItem: TTMSFNCPlannerItem;\r\n  var AInplaceEditorClass: TTMSFNCPlannerInplaceEditorClass);\r\nbegin\r\n  if Assigned(OnGetInplaceEditor) then\r\n    OnGetInplaceEditor(Self, AStartTime, AEndTime, APosition, AItem, AInplaceEditorClass);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetItemHelperText(AItem: TTMSFNCPlannerItem;\r\n  AIsStartTime: Boolean; AValue: TDateTime; var AText: String);\r\nbegin\r\n  if Assigned(OnGetItemHelperText) then\r\n    OnGetItemHelperText(Self, AItem, AIsStartTime, AValue, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetItemText(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var AText: String);\r\nbegin\r\n  if Assigned(OnGetItemText) then\r\n    OnGetItemText(Self, AItem, AMode, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetItemTitleText(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerGetTextMode; var ATitle: String);\r\nbegin\r\n  if Assigned(OnGetItemTitleText) then\r\n    OnGetItemTitleText(Self, AItem, AMode, ATitle);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetPositionText(APosition: Integer;\r\n  AKind: TTMSFNCPlannerCacheItemKind; var AText: String);\r\nbegin\r\n  if Assigned(OnGetPositionText) then\r\n    OnGetPositionText(Self, APosition, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoGetTimeText(AValue: Double; ARow: Integer;\r\n  ASubUnit: Boolean; AKind: TTMSFNCPlannerCacheItemKind; var AText: String);\r\nbegin\r\n  if Assigned(OnGetTimeText) then\r\n    OnGetTimeText(Self, AValue, ARow, ASubUnit, AKind, AText);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoHScroll(APosition: Single);\r\nbegin\r\n  if Assigned(OnHScroll) then\r\n    OnHScroll(Self, APosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CloseInplaceEditor(ACancel: Boolean);\r\nvar\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  AContext: TRttiContext;\r\n  rt: TRttiType;\r\n  prop: TRttiProperty;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  str: String;\r\n  it: TTMSFNCPlannerItem;\r\n  sta, ste: TDateTime;\r\n  p: Integer;\r\n  b, c: Boolean;\r\n  t, n: String;\r\nbegin\r\n  if FClosing then\r\n    Exit;\r\n\r\n  FClosing := True;\r\n  if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n  begin\r\n    it := Items[FUpdateItem];\r\n    sta := it.StartTime;\r\n    ste := it.EndTime;\r\n    t := it.Title;\r\n    n := it.Text;\r\n    p := ItemToStartCell(it).Col;\r\n\r\n    if not ACancel then\r\n    begin\r\n      str := '';\r\n      {$IFNDEF LCLLIB}\r\n      {$IFNDEF WEBLIB}\r\n      AContext := TRttiContext.Create;\r\n      try\r\n        rt := AContext.GetType(FInplaceEditor.ClassInfo);\r\n        prop := rt.GetProperty('Text');\r\n        if Assigned(Prop) then\r\n          str := prop.GetValue(FInplaceEditor).AsString;\r\n      finally\r\n        AContext.Free;\r\n      end;\r\n      {$ENDIF}\r\n      {$ENDIF}\r\n      {$IFDEF LCLLIB}\r\n      if FInplaceEditor is TEdit then\r\n        str := (FInplaceEditor as TEdit).Text;\r\n      if FInplaceEditor is TComboBox then\r\n        str := (FInplaceEditor as TComboBox).Text;\r\n      if FInplaceEditor is TMemo then\r\n        str := (FInplaceEditor as TMemo).Text;\r\n      {$ENDIF}\r\n      {$IFDEF WEBLIB}\r\n      if FInplaceEditor is TEdit then\r\n        str := (FInplaceEditor as TEdit).Text;\r\n      if FInplaceEditor is TComboBox then\r\n        str := (FInplaceEditor as TComboBox).Text;\r\n      if FInplaceEditor is TMemo then\r\n        str := (FInplaceEditor as TMemo).Text;\r\n      {$ENDIF}\r\n\r\n      case Interaction.InplaceEditorMode of\r\n        piemText, piemItem: n := str;\r\n        piemTitle: t := str;\r\n      end;\r\n\r\n      b := True;\r\n      DoBeforeUpdateItem(sta, ste, p, it, t, n, b);\r\n      if b then\r\n      begin\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := True;\r\n        CallBeforeUpdateLinkedItems(it, sta - it.StartTime, ste - it.EndTime, PositionToResource(p) - it.Resource);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := False;\r\n        it := AddOrUpdateItem(PositionToResource(p), sta, ste, t, n, FUpdateItem);\r\n        DoAfterUpdateItem(sta, ste, p, it);\r\n        DoItemChanged(it);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := True;\r\n        CallAfterUpdateLinkedItems(it);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := False;\r\n      end;\r\n    end;\r\n\r\n    c := True;\r\n    DoCloseInplaceEditor(sta, ste, p, it, ACancel, c);\r\n    if c then\r\n    begin\r\n      if Assigned(FInplaceEditor) then\r\n      begin\r\n        FInplaceEditor.Parent := nil;\r\n        {$IFDEF FMXLIB}\r\n        FInplaceEditor.DisposeOf;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        FInplaceEditor.Free;\r\n        {$ENDIF}\r\n        FInplaceEditor := nil;\r\n        FInplaceEditorActive := False;\r\n        it.UpdateItem;\r\n      end;\r\n\r\n      if CanFocus then\r\n        SetFocus;\r\n    end;\r\n  end;\r\n\r\n  FClosing := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoIsDateTimeDisabled(ADateTime: TDateTime;\r\n  APosition: Integer; var ADisabled: Boolean);\r\nbegin\r\n  if Assigned(OnIsDateTimeDisabled) then\r\n    OnIsDateTimeDisabled(Self, ADateTime, APosition, ADisabled);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoIsDateTimeInActive(ADateTime: TDateTime;\r\n  APosition: Integer; var AInActive: Boolean);\r\nbegin\r\n  if Assigned(OnIsDateTimeInActive) then\r\n    OnIsDateTimeInActive(Self, ADateTime, APosition, AInActive);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoIsDateTimeSub(ADateTime: TDateTime;\r\n  var AIsSub: Boolean);\r\nbegin\r\n  if Assigned(OnIsDateTimeSub) then\r\n    OnIsDateTimeSub(Self, ADateTime, AIsSub);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoIsItemDeletable(AItem: TTMSFNCPlannerItem;\r\n  var ADeletable: Boolean);\r\nbegin\r\n  if Assigned(OnIsItemDeletable) then\r\n    OnIsItemDeletable(Self, AItem, ADeletable);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoItemAnchorClick(AItem: TTMSFNCPlannerItem;\r\n  AAnchor: String);\r\nbegin\r\n  if Assigned(OnItemAnchorClick) then\r\n    OnItemAnchorClick(Self, AItem, AAnchor)\r\n  else if Interaction.AutoOpenURL then\r\n    TTMSFNCUtils.OpenURL(AAnchor);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoItemChanged(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnItemChanged) then\r\n    OnItemChanged(Self, AItem);\r\n\r\n  if Assigned(Adapter) then\r\n    Adapter.UpdateItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterItemChanged(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterItemChanged) then\r\n    OnAfterItemChanged(Self, AItem);\r\n\r\n  if Assigned(Adapter) then\r\n    Adapter.AfterUpdateItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoItemToCustomContentPanel(\r\n  AItem: TTMSFNCPlannerItem; AContentPanel: TTMSFNCPlannerEditingDialogContentPanel);\r\nbegin\r\n  if Assigned(ItemEditor) then\r\n    ItemEditor.ItemToCustomContentPanel(AItem, AContentPanel);\r\n\r\n  if Assigned(OnItemToCustomContentPanel) then\r\n    OnItemToCustomContentPanel(Self, AItem, AContentPanel);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseEnter;\r\nbegin\r\n  inherited;\r\n  ProcessNavigationButtonsMove(-1, -1);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseLeave;\r\nvar\r\n  p: TPointF;\r\nbegin\r\n  inherited;\r\n  if Assigned(ToolBarPopup) and ToolBarPopup.Activated then\r\n  begin\r\n    p := TTMSFNCUtils.GetMousePos;\r\n    if not ToolBarPopup.PointInPopup(p) and not ToolBarPopup.DropDownActive then\r\n      ToolBarPopup.Deactivate;\r\n  end;\r\n\r\n  ProcessNavigationButtonsMove(-1, -1);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoMoveItem(AItem: TTMSFNCPlannerItem;\r\n  ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer);\r\nbegin\r\n  if Assigned(OnMoveItem) then\r\n    OnMoveItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterMoveItem(AItem: TTMSFNCPlannerItem;\r\n  ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer);\r\nbegin\r\n  if Assigned(OnAfterMoveItem) then\r\n    OnAfterMoveItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterNavigateToDateTime(ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime, ANewDateTime: TDateTime);\r\nbegin\r\n  if Assigned(OnAfterNavigateToDateTime) then\r\n    OnAfterNavigateToDateTime(Self, ADirection, ACurrentDateTime, ANewDateTime);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoSelectTime(AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer);\r\nbegin\r\n  if Assigned(OnSelectTime) then\r\n    OnSelectTime(Self, AStartTime, AEndTime, APosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoSizeItem(AItem: TTMSFNCPlannerItem;\r\n  ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer);\r\nbegin\r\n  if Assigned(OnSizeItem) then\r\n    OnSizeItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoSelectCell(AStartCell, AEndCell: TTMSFNCPlannerCell);\r\nbegin\r\n  if Assigned(OnSelectCell) then\r\n    OnSelectCell(Self, AStartCell, AEndCell);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoSelectingCell(AStartCell, AEndCell: TTMSFNCPlannerCell);\r\nbegin\r\n  if Assigned(OnSelectingCell) then\r\n    OnSelectingCell(Self, AStartCell, AEndCell);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoSelectingTime(AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer);\r\nbegin\r\n  if Assigned(OnSelectingTime) then\r\n    OnSelectingTime(Self, AStartTime, AEndTime, APosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterSizeItem(AItem: TTMSFNCPlannerItem;\r\n  ANewStartTime, ANewEndTime: TDateTime; ANewPosition: Integer);\r\nbegin\r\n  if Assigned(OnAfterSizeItem) then\r\n    OnAfterSizeItem(Self, AItem, ANewStartTime, ANewEndTime, ANewPosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoVScroll(APosition: Single);\r\nbegin\r\n  if Assigned(OnVScroll) then\r\n    OnVScroll(Self, APosition);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoAfterSelectItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(OnAfterSelectItem) then\r\n    OnAfterSelectItem(Self, AItem);\r\n\r\n  if Assigned(Adapter) then\r\n    Adapter.SelectItem(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DownTime(Sender: TObject);\r\nbegin\r\n  Inc(FDownTime);\r\n  if Assigned(FDownItem) then\r\n  begin\r\n    if (FDownTime = DOWNCOUNT) then\r\n    begin\r\n      FDownTimer.Enabled := False;\r\n      FDoItemMove := FDownItem.Movable and AllowMobileMove and not Interaction.ReadOnly;\r\n      FDrawItemHelpers := True;\r\n      if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n        HandleSelectLinkedItems(FDownItem)\r\n      else\r\n        HandleSelectItem(FDownItem);\r\n    end;\r\n  end\r\n  else if not Assigned(FDownItem) then\r\n  begin\r\n    if (FDownTime = DOWNCOUNT) or not Interaction.TouchScrolling then\r\n    begin\r\n      FRangeSelection := True;\r\n      FDownTimer.Enabled := False;\r\n      if IsValidCell(FDownCell.Col, FDownCell.Row) then\r\n      begin\r\n        HandleSelection(FDownCell, FDownCell);\r\n        HandleCellSelection(True);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AddOrUpdateItem(AStartTime, AEndTime: TDateTime;\r\n  ATitle, AText: String; AItemIndex: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := AddOrUpdateItem(0, AStartTime, AEndTime, ATitle, AText, AItemIndex);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AddOrUpdateItem(AResource: Integer; AStartTime,\r\n  AEndTime: TDateTime; ATitle, AText: String;\r\n  AItemIndex: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  if (AItemIndex >= 0) and (AItemIndex <= Items.Count - 1) then\r\n    Result := Items[AItemIndex]\r\n  else\r\n    Result := Items.Add;\r\n\r\n  Result.BeginUpdate;\r\n  Result.StartTime := AStartTime;\r\n  Result.EndTime := AEndTime;\r\n  Result.Resource := AResource;\r\n  Result.Text := AText;\r\n  Result.Title := ATitle;\r\n  Result.EndUpdate;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AddItem(AStartTime,\r\n  AEndTime: TDateTime): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := Items.Add;\r\n  Result.BeginUpdate;\r\n  Result.StartTime := AStartTime;\r\n  Result.EndTime := AEndTime;\r\n  Result.EndUpdate;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AddItemAtSelection: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := Items.Add;\r\n  Result.BeginUpdate;\r\n  Result.StartTime := CellToDateTime(Selection.StartCell);\r\n  Result.EndTime := CellToDateTime(MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + 1));\r\n  Result.EndUpdate;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AddOrUpdateItem(AResourceName: String; AStartTime,\r\n  AEndTime: TDateTime; ATitle, AText: String;\r\n  AItemIndex: Integer): TTMSFNCPlannerItem;\r\nvar\r\n  res: TTMSFNCPlannerResource;\r\nbegin\r\n  res := FindResourceByName(AResourceName);\r\n  Result := nil;\r\n  if Assigned(res) then\r\n    Result := AddOrUpdateItem(res.Index, AStartTime, AEndTime, ATitle, AText, AItemIndex);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowDesktopMove: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.MoveMode in [pmmDesktop];\r\n  {$ELSE}\r\n  Result := Interaction.MoveMode in [pmmDesktop, pmmAuto];\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowMobileMove: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.MoveMode in [pmmMobile, pmmAuto];\r\n  {$ELSE}\r\n  Result := Interaction.MoveMode in [pmmMobile];\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowDesktopDelete: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.DeleteMode in [pdmDesktop];\r\n  {$ELSE}\r\n  Result := Interaction.DeleteMode in [pdmDesktop, pdmAuto];\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowMobileDelete: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.DeleteMode in [pdmMobile, pdmAuto];\r\n  {$ELSE}\r\n  Result := Interaction.DeleteMode in [pdmMobile];\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowDesktopSize: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.SizeMode in [psmDesktop];\r\n  {$ELSE}\r\n  Result := Interaction.SizeMode in [psmDesktop, psmAuto];\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.AllowMobileSize: Boolean;\r\nbegin\r\n  {$IFDEF FMXMOBILE}\r\n  Result := Interaction.SizeMode in [psmMobile, psmAuto];\r\n  {$ELSE}\r\n  Result := Interaction.SizeMode in [psmMobile];\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.Animate(Sender: TObject);\r\nvar\r\n  dx, dy, posx, posy: Double;\r\n  animh, animv: Boolean;\r\nbegin\r\n  posy := GetVScrollValue;\r\n  posx := GetHScrollValue;\r\n  dx := Abs(FScrollHTo - posx) / Max(1, Abs(FSpX) * 6);\r\n  dy := Abs(FScrollVTo - posy) / Max(1, Abs(FSpY) * 6);\r\n  animv := False;\r\n  if FAnimateVerticalPos then\r\n    animv := AnimateDouble(posy, FScrollVTo, dy, 0.01);\r\n\r\n  animh := False;\r\n  if FAnimateHorizontalPos then\r\n    animh := AnimateDouble(posx, FScrollHTo, dx, 0.01);\r\n\r\n  FAnimating := animv or animh;\r\n  if FAnimating then\r\n    Scroll(posx, posy)\r\n  else\r\n  begin\r\n    FAnimateVerticalPos := False;\r\n    FAnimateTimer.Enabled := False;\r\n    FAnimateHorizontalPos := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.Assign(Source: TPersistent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  if Source is TTMSFNCCustomPlanner then\r\n  begin\r\n    FItemsAppearance.Assign((Source as TTMSFNCCustomPlanner).ItemsAppearance);\r\n    FTimeLineAppearance.Assign((Source as TTMSFNCCustomPlanner).TimeLineAppearance);\r\n    FPositionsAppearance.Assign((Source as TTMSFNCCustomPlanner).PositionsAppearance);\r\n    FPositions.Assign((Source as TTMSFNCCustomPlanner).Positions);\r\n    FGroupsAppearance.Assign((Source as TTMSFNCCustomPlanner).GroupsAppearance);\r\n    FTimeLine.Assign((Source as TTMSFNCCustomPlanner).TimeLine);\r\n    FModeSettings.Assign((Source as TTMSFNCCustomPlanner).ModeSettings);\r\n    FMode := (Source as TTMSFNCCustomPlanner).Mode;\r\n    FGridCellAppearance.Assign((Source as TTMSFNCCustomPlanner).GridCellAppearance);\r\n    FSelectionAppearance.Assign((Source as TTMSFNCCustomPlanner).SelectionAppearance);\r\n    FCustomDateTimes.Clear;\r\n    for I := 0 to (Source as TTMSFNCCustomPlanner).CustomDateTimes.Count - 1 do\r\n      FCustomDateTimes.Add((Source as TTMSFNCCustomPlanner).CustomDateTimes[I]);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.BuildDisplay(ACache: TTMSFNCPlannerCache; ADisplay: TTMSFNCPlannerDisplayList);\r\nvar\r\n  x, y: Double;\r\n  I: Integer;\r\n  cache: TTMSFNCPlannerCacheItem;\r\n  r, rrt, rrb, trl, trr, rg, grt, grb: TRectF;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or not Assigned(ACache) or not Assigned(ADisplay) then\r\n    Exit;\r\n\r\n  ADisplay.Clear;\r\n\r\n  x := -GetHorizontalScrollPosition;\r\n  y := -GetVerticalScrollPosition;\r\n  r := GetContentRect;\r\n  grt := GetGroupsTopRect;\r\n  grb := GetGroupsBottomRect;\r\n  rrt := GetPositionsTopRect;\r\n  rrb := GetPositionsBottomRect;\r\n  trl := GetTimeLineLeftRect;\r\n  trr := GetTimeLineRightRect;\r\n  for I := 0 to ACache.Count - 1 do\r\n  begin\r\n    cache := ACache[I];\r\n    rg := cache.Rect;\r\n    {$IFDEF FMXWEBLIB}\r\n    case cache.Kind of\r\n      ikGroupTop:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, grt.Left, int(y) + grt.Top);\r\n          pomVertical: OffsetRectEx(rg, int(x) + grt.Left, grt.Top);\r\n        end;\r\n      end;\r\n      ikGroupBottom:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, grb.Left - 1, int(y) + grb.Top);\r\n          pomVertical: OffsetRectEx(rg, int(x) + grb.Left, grb.Top - 1);\r\n        end;\r\n      end;\r\n      ikPositionTop:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, rrt.Left, int(y) + rrt.Top);\r\n          pomVertical: OffsetRectEx(rg, int(x) + rrt.Left, rrt.Top);\r\n        end;\r\n      end;\r\n      ikPositionBottom:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, rrb.Left - 1, int(y) + rrb.Top);\r\n          pomVertical: OffsetRectEx(rg, int(x) + rrb.Left, rrb.Top - 1);\r\n        end;\r\n      end;\r\n      ikTimeLineLeft:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, int(x) + trl.Left, trl.Top);\r\n          pomVertical: OffsetRectEx(rg, trl.Left, int(y) + trl.Top);\r\n        end;\r\n      end;\r\n      ikTimeLineRight:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, int(x) + trr.Left, trr.Top - 1);\r\n          pomVertical: OffsetRectEx(rg, trr.Left - 1, int(y) + trr.Top);\r\n        end;\r\n      end\r\n      else\r\n        OffsetRectEx(rg, int(x) + r.Left, int(y) + r.Top);\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    case cache.Kind of\r\n      ikGroupTop:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, grt.Left, y + grt.Top);\r\n          pomVertical: OffsetRectEx(rg, x + grt.Left, grt.Top);\r\n        end;\r\n      end;\r\n      ikGroupBottom:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, grb.Left - 1, y + grb.Top);\r\n          pomVertical: OffsetRectEx(rg, x + grb.Left, grb.Top - 1);\r\n        end;\r\n      end;\r\n      ikPositionTop:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, rrt.Left, y + rrt.Top);\r\n          pomVertical: OffsetRectEx(rg, x + rrt.Left, rrt.Top);\r\n        end;\r\n      end;\r\n      ikPositionBottom:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, rrb.Left - 1, y + rrb.Top);\r\n          pomVertical: OffsetRectEx(rg, x + rrb.Left, rrb.Top - 1);\r\n        end;\r\n      end;\r\n      ikTimeLineLeft:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, x + trl.Left, trl.Top);\r\n          pomVertical: OffsetRectEx(rg, trl.Left, y + trl.Top);\r\n        end;\r\n      end;\r\n      ikTimeLineRight:\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: OffsetRectEx(rg, x + trr.Left, trr.Top - 1);\r\n          pomVertical: OffsetRectEx(rg, trr.Left - 1, y + trr.Top);\r\n        end;\r\n      end\r\n      else\r\n        OffsetRectEx(rg, x + r.Left, y + r.Top);\r\n    end;\r\n    {$ENDIF}\r\n\r\n    cache.DrawRect := rg;\r\n    case cache.Kind of\r\n      ikItem, ikCell:\r\n      begin\r\n        if RectIntersectsWithEx(rg, r) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikPositionTop:\r\n      begin\r\n        if RectIntersectsWithEx(rg, rrt) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikPositionBottom:\r\n      begin\r\n        if RectIntersectsWithEx(rg, rrb) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikGroupTop:\r\n      begin\r\n        if RectIntersectsWithEx(rg, grt) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikGroupBottom:\r\n      begin\r\n        if RectIntersectsWithEx(rg, grb) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikTimeLineLeft:\r\n      begin\r\n        if RectIntersectsWithEx(rg, trl) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n      ikTimeLineRight:\r\n      begin\r\n        if RectIntersectsWithEx(rg, trr) then\r\n          ADisplay.Add(cache);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseDown(Button: TTMSFNCMouseButton; Shift: TShiftState;\r\n  X, Y: Single);\r\nvar\r\n  dc, c: TTMSFNCPlannerCacheItem;\r\n  it: TTMSFNCPlannerItemOpen;\r\n  d: Boolean;\r\nbegin\r\n  inherited;\r\n\r\n  if Button = TTMSFNCMouseButton.mbRight then\r\n    Exit;\r\n\r\n  CaptureEx;\r\n\r\n  ProcessNavigationButtonsDown(X, Y);\r\n  if FNavigationButtonDown then\r\n    Exit;\r\n\r\n  if not FDblClicked then\r\n  begin\r\n    if CanFocus then\r\n      SetFocus;\r\n\r\n    if FInplaceEditorActive then\r\n      CloseInplaceEditor(False);\r\n  end;\r\n\r\n  FDblClicked := False;\r\n  dc := XYToCacheItem(X, Y);\r\n  FDownCacheItemIdx := -1;\r\n  FDownItem := nil;\r\n  if Assigned(dc) then\r\n  begin\r\n    FDownItem := dc.Item;\r\n    FDownCacheItemIdx := TTMSFNCPlannerItemOpen(FDownItem).CacheList.IndexOf(dc);\r\n  end;\r\n\r\n  if Assigned(FDownItem) then\r\n  begin\r\n    it := TTMSFNCPlannerItemOpen(FDownItem);\r\n    if (FDownCacheItemIdx >= 0) and (FDownCacheItemIdx <= it.CacheList.Count - 1) then\r\n    begin\r\n      c := it.CacheList[FDownCacheItemIdx];\r\n      if (FDownItem = FActiveItem) then\r\n      begin\r\n        FDoItemSizeUp := PtInRectEx(GetCacheItemStartTimeSizeRect(c), PointF(X, Y)) and FDownItem.Sizeable and CanSizeCacheItemStartTime(c) and AllowDesktopSize and not Interaction.ReadOnly;\r\n        FDoItemSizeDown := PtInRectEx(GetCacheItemEndTimeSizeRect(c), PointF(X, Y)) and FDownItem.Sizeable and CanSizeCacheItemEndTime(c) and AllowDesktopSize and not Interaction.ReadOnly;\r\n        FDoItemMove := PtInRectEx(GetCacheItemMoveRect(c), PointF(X, Y)) and FDownItem.Movable and CanMoveCacheItem(c) and AllowDesktopMove and not Interaction.ReadOnly;\r\n      end;\r\n\r\n      d := FDownItem.Deletable;\r\n      DoIsItemDeletable(FDownItem, d);\r\n      FDoItemDelete := PtInRectEx(GetCacheItemDeleteRect(c), PointF(X, Y)) and d and CanDeleteCacheItem(c) and AllowDesktopDelete and ItemsAppearance.ShowDeleteArea and not Interaction.ReadOnly;\r\n    end;\r\n    \r\n    FDoItemAnchor := XYToItemAnchor(FDownItem, X, Y);\r\n  end;\r\n\r\n  FDownOnPositions := PtInRectEx(GetPositionsTopRect, PointF(X, Y))\r\n    or PtInRectEx(GetPositionsBottomRect, PointF(X, Y)) or PtInRectEx(GetGroupsTopRect, PointF(X, Y))\r\n    or PtInRectEx(GetGroupsBottomRect, PointF(X, Y));\r\n\r\n  FMoveOnPositions := FDownOnPositions;\r\n\r\n  FDownCell := XYToCell(X, Y);\r\n  FRangeCell := FDownCell;\r\n  FSizeCell := FDownCell;\r\n  IsMouseDown := True;\r\n  FTimeStart := GetTickCountX;\r\n  FTimeStop := FTimeStart;\r\n  FScrollVTo := GetVScrollValue;\r\n  FScrollHTo := GetHScrollValue;\r\n  FScrollX := X;\r\n  FScrollY := Y;\r\n  FDownX := X;\r\n  FDownY := Y;\r\n  FMouseX := X;\r\n  FMouseY := Y;\r\n  FMouseUp := False;\r\n  FMovePositionPrevious := False;\r\n  FMovePositionNext := False;\r\n  FDownTimer.Enabled := not (FDoItemSizeUp or FDoItemSizeDown or FDoItemMove or FDoItemDelete or (FDoItemAnchor <> ''));\r\n  FDoubleSelection := not FAnimateTimer.Enabled;\r\n  FRangeSelection := False;\r\n  FScrolling := False;\r\n  FDownTime := 0;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      FMovePositionPrevious := ((GetVScrollValue = 0) or not VerticalScrollBar.Visible) and Interaction.SwipeToPreviousDateTime and CanNavigate;\r\n      FMovePositionNext := ((GetVScrollValue = VerticalScrollBar.Max - GetVViewPortSize) or not VerticalScrollBar.Visible) and Interaction.SwipeToNextDateTime and CanNavigate;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      FMovePositionPrevious := ((GetHScrollValue = 0) or not HorizontalScrollBar.Visible) and Interaction.SwipeToPreviousDateTime and CanNavigate;\r\n      FMovePositionNext := ((GetHScrollValue = HorizontalScrollBar.Max - GetHViewPortSize) or not HorizontalScrollBar.Visible) and Interaction.SwipeToNextDateTime and CanNavigate;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseMove(Shift: TShiftState; X, Y: Single);\r\nvar\r\n  f: Double;\r\n  cls, cle, clsn, clen, cl: TTMSFNCPlannerCell;\r\n  it: TTMSFNCPlannerItem;\r\n  doscroll: Boolean;\r\n  dsp: TTMSFNCPlannerCacheItem;\r\n  m: TTMSFNCPlannerMouseInteractionMode;\r\n  domove: Boolean;\r\n  dtc, dtn: TDateTime;\r\n  d: TTMSFNCPlannerNavigationDirection;\r\n  del: Boolean;\r\n  r: TRectF;\r\n  pt: TPointF;\r\nbegin\r\n  inherited;\r\n  ProcessNavigationButtonsMove(X, Y);\r\n\r\n  if IsMouseDown and not (FDoItemAnchor <> '') then\r\n  begin\r\n    {$IFNDEF WEBLIB}\r\n    ShowHint(nil, -1, -1);\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    ShowHintEx(nil, -1, -1);\r\n    {$ENDIF}\r\n\r\n    doscroll := not FDoItemMove and not FDoItemSizeUp and not FDoItemSizeDown and not FDoItemDelete;\r\n    if doscroll then\r\n    begin\r\n      f := 1;\r\n      case ScrollMode of\r\n        smCellScrolling: f := 0.1;\r\n      end;\r\n\r\n      domove := False;\r\n      if FDownOnPositions and (Interaction.SwipeToNextDateTime or Interaction.SwipeToPreviousDateTime) and CanNavigate then\r\n      begin\r\n        domove := True;\r\n        FDownOnPositions := False;\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            FMovePositionNext := FMovePositionNext and (Y - FMouseY < 0);\r\n            FMovePositionPrevious := FMovePositionPrevious and (Y - FMouseY > 0);\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            FMovePositionNext := FMovePositionNext and (X - FMouseX < 0);\r\n            FMovePositionPrevious := FMovePositionPrevious and (X - FMouseX > 0);\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        FMovePositionPrevious := False;\r\n        FMovePositionNext := False;\r\n      end;\r\n\r\n      if not FMovePositionNext and not FMovePositionPrevious then\r\n      begin\r\n        if (FScrolling or (Abs(FMouseX - X) > 3) or (Abs(FMouseY - Y) > 3)) and not FRangeSelection and Interaction.TouchScrolling then\r\n        begin\r\n          if (Abs(X - FDownX) > SCROLLINGDELAY) or (Abs(Y - FDownY) > SCROLLINGDELAY) then\r\n          begin\r\n            FScrolling := True;\r\n            FDownTimer.Enabled := False;\r\n            FDoubleSelection := False;\r\n            if IsMouseDown and not FMouseUp then\r\n            begin\r\n              if FMoveOnPositions then\r\n              begin\r\n                case OrientationMode of\r\n                  pomHorizontal: Scroll(GetHScrollValue, GetVScrollValue - (Y - FDownY) * f);\r\n                  pomVertical: Scroll(GetHScrollValue - (X - FDownX) * f, GetVScrollValue);\r\n                end;\r\n              end\r\n              else\r\n                Scroll(GetHScrollValue - (X - FDownX) * f, GetVScrollValue - (Y - FDownY) * f);\r\n\r\n              FDownY := Y;\r\n              FDownX := X;\r\n            end;\r\n          end;\r\n        end\r\n        else if FRangeSelection then\r\n        begin\r\n          cl := XYToCell(X, Y);\r\n          if IsValidCell(cl.Col, cl.Row) and IsValidCell(FDownCell.Col, FDownCell.Row) then\r\n          begin\r\n            SelectCells(MakeCell(cl.Col, FDownCell.Row), cl);\r\n            if (cl.Col <> FRangeCell.Col) or (cl.Row <> FRangeCell.Row) then\r\n              HandleCellSelection(True);\r\n\r\n            FRangeCell := cl;\r\n          end;\r\n        end;\r\n      end\r\n      else if (FMovePositionNext or FMovePositionPrevious) and domove then\r\n      begin\r\n        if FMovePositionPrevious or FMovePositionNext then\r\n        begin\r\n          dtc := FDisplayStartTime;\r\n\r\n          if FMovePositionPrevious then\r\n          begin\r\n            dtn := GetPreviousDateTime;\r\n            d := pndPrevious;\r\n          end\r\n          else\r\n          begin\r\n            dtn := GetNextDateTime;\r\n            d := pndNext;\r\n          end;\r\n\r\n          HandleDateTimeNavigation(d, dtc, dtn);\r\n        end\r\n      end;\r\n    end\r\n    else if (FDoItemSizeUp or FDoItemSizeDown or FDoItemMove) and Assigned(FDownItem) then\r\n    begin\r\n      FDrawItemHelpers := True;\r\n      cl := XYToCell(X, Y);\r\n      if (cl.Col <> -1) and (cl.Row <> -1) then\r\n      begin\r\n        cls := ItemToStartCell(FDownItem);\r\n        cle := ItemToEndCell(FDownItem);\r\n\r\n        clsn.Col := cls.Col;\r\n        clen.Col := cle.Col;\r\n        clsn.Row := cls.Row;\r\n        clen.Row := cle.Row;\r\n\r\n        if FDoItemSizeUp then\r\n        begin\r\n          if ((cls.Row >= cle.Row) and (cle.Col - cl.Col > 0)) or ((cls.Row < cle.Row) and (cle.Col - cl.Col >= 0)) then\r\n            clsn.Col := cl.Col;\r\n\r\n          if clsn.Col = cle.Col then\r\n            clsn.Row := Min(cle.Row - 1, cl.Row)\r\n          else\r\n            clsn.Row := cl.Row;\r\n        end\r\n        else if FDoItemSizeDown then\r\n        begin\r\n          if ((cle.Row <= cls.Row) and (cl.Col - cls.Col > 0)) or ((cle.Row > cls.Row) and (cl.Col - cls.Col >= 0)) then\r\n            clen.Col := cl.Col;\r\n\r\n          if clen.Col = cls.Col then\r\n            clen.Row := Max(cls.Row + 1, cl.Row + 1)\r\n          else\r\n            clen.Row := cl.Row + 1;\r\n        end\r\n        else\r\n        begin\r\n          clsn.Col := clsn.Col + (cl.Col - FSizeCell.Col);\r\n          clsn.Row := clsn.Row + (cl.Row - FSizeCell.Row);\r\n          clen.Col := clen.Col + (cl.Col - FSizeCell.Col);\r\n          clen.Row := clen.Row + (cl.Row - FSizeCell.Row);\r\n\r\n          if (clsn.Row < 0) or (clen.Row > RowCount) then\r\n          begin\r\n            clsn.Row := cls.Row;\r\n            clen.Row := cle.Row;\r\n          end;\r\n\r\n          if (clsn.Col < 0) or (clen.Col > ColumnCount - 1) then\r\n          begin\r\n            clsn.Col := cls.Col;\r\n            clen.Col := cle.Col;\r\n          end;\r\n        end;\r\n\r\n        if FDoItemSizeUp then\r\n          m := pmmSizeUp\r\n        else if FDoItemSizeDown then\r\n          m := pmmSizeDown\r\n        else\r\n          m := pmmMove;\r\n\r\n        if HandleItemMouseInteraction(FDownItem, cls, cle, clsn, clen, m) then\r\n          FSizeCell := cl;\r\n      end;\r\n    end\r\n  end\r\n  else\r\n  begin\r\n    it := nil;\r\n    dsp := XYToCacheItem(X, Y);\r\n    if Assigned(dsp) then\r\n      it := dsp.Item;\r\n\r\n    if Assigned(ToolBarPopup) and Assigned(FActiveItem) and not ToolBarPopup.Activated then\r\n    begin\r\n      if it = FActiveItem then\r\n      begin\r\n        ToolBarPopup.PlacementControl := Self;\r\n        ToolBarPopup.Placement := ppAbsolute;\r\n        ToolBarPopup.Planner := Self;\r\n        ToolBarPopup.PlannerItem := it;\r\n        ToolBarPopup.Activate;\r\n        r := GetFirstRect(it);\r\n        pt := PointF(r.Left + ((r.Right - r.Left) - ToolBarPopup.ToolBar.Width) / 2, r.Top - ToolBarPopup.ToolBar.Height + 1);\r\n        pt := ConvertClientToScreen(pt);\r\n        ToolBarPopup.PlacementRectangle.Left := pt.X;\r\n        ToolBarPopup.PlacementRectangle.Top := pt.Y;\r\n        ToolBarPopup.PlacementRectangle.Right := pt.X;\r\n        ToolBarPopup.PlacementRectangle.Bottom := pt.Y;                  \r\n        Exit;\r\n      end;\r\n    end;\r\n\r\n    if Assigned(ToolBarPopup) and ToolBarPopup.Activated and not ToolBarPopup.DropDownActive and (it <> FActiveItem) then\r\n      ToolBarPopup.Deactivate;          \r\n\r\n    if Assigned(it) and Assigned(dsp) then\r\n    begin\r\n      del := it.Deletable;\r\n      DoIsItemDeletable(it, del);\r\n      if (FActiveItem = it) then\r\n      begin\r\n        if ((PtInRectEx(GetCacheItemStartTimeSizeRect(dsp), PointF(X, Y)) and CanSizeCacheItemStartTime(dsp)) or (PtInRectEx(GetCacheItemEndTimeSizeRect(dsp), PointF(X, Y))\r\n          and CanSizeCacheItemEndTime(dsp))) and it.Sizeable and AllowDesktopSize and not Interaction.ReadOnly then\r\n        begin\r\n          case OrientationMode of\r\n            pomHorizontal: Cursor := crSizeWE;\r\n            pomVertical: Cursor := crSizeNS;\r\n          end;\r\n        end\r\n        else if PtInRectEx(GetCacheItemMoveRect(dsp), PointF(X, Y)) and CanMoveCacheItem(dsp) and it.Movable and AllowDesktopMove and not Interaction.ReadOnly then\r\n          Cursor := crSize\r\n        else if PtInRectEx(GetCacheItemDeleteRect(dsp), PointF(X, Y)) and CanDeleteCacheItem(dsp) and del and AllowDesktopDelete and ItemsAppearance.ShowDeleteArea and not Interaction.ReadOnly then\r\n          Cursor := crHandPoint\r\n        else if XYToItemAnchor(it, X, Y) <> '' then\r\n          Cursor := crHandPoint\r\n        else\r\n          Cursor := crDefault;\r\n      end\r\n      else\r\n      begin\r\n        if PtInRectEx(GetCacheItemDeleteRect(dsp), PointF(X, Y)) and CanDeleteCacheItem(dsp) and del and AllowDesktopDelete and ItemsAppearance.ShowDeleteArea and not Interaction.ReadOnly then\r\n          Cursor := crHandPoint\r\n        else if (XYToItemAnchor(it, X, Y) <> '') then\r\n          Cursor := crHandPoint\r\n        else\r\n          Cursor := crDefault;\r\n      end;\r\n    end\r\n    else\r\n      Cursor := crDefault;\r\n\r\n    {$IFDEF WEBLIB}\r\n    ShowHintEx(it, X, Y);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    ShowHint(it, X, Y);\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseUp(Button: TTMSFNCMouseButton; Shift: TShiftState;\r\n  X, Y: Single);\r\nvar\r\n  f: Double;\r\n  b: Boolean;\r\n  prev: TTMSFNCPlannerItem;\r\n  a: String;\r\n  it: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  inherited;\r\n\r\n  ReleaseCaptureEx;\r\n\r\n  HandleAfterEvents;\r\n\r\n  ProcessNavigationButtonsUp(X, Y);\r\n\r\n  if FNavigationButtonDown then\r\n  begin\r\n    FNavigationButtonDown := False;\r\n    Invalidate;\r\n    Exit;\r\n  end;\r\n\r\n  if not IsMouseDown then\r\n    Exit;\r\n\r\n  f := 1;\r\n  case ScrollMode of\r\n    smCellScrolling: f := 0.1;\r\n  end;\r\n\r\n  IsMouseDown := False;\r\n  FMouseUp := True;\r\n  FScrolling := False;\r\n  FDownTimer.Enabled := False;\r\n\r\n  if (not FMovePositionPrevious and not FMovePositionNext) or not FDownOnPositions then\r\n  begin\r\n    if not FDoItemSizeUp and not FDoItemSizeDown and not FDoItemMove and not FDoItemDelete and not (FDoItemAnchor <> '') then\r\n    begin\r\n      if not FDoubleSelection and Interaction.TouchScrolling then\r\n      begin\r\n        FTimeStop := GetTickCountX;\r\n        if ((FTimeStop - FTimeStart) < SWIPECOUNT) and ((FTimeStop - FTimeStart) > 0) then\r\n        begin\r\n          FSpY := Abs(Y - FScrollY) / (FTimeStop - FTimeStart);\r\n          if (FSpY > 0) and (not FMoveOnPositions or ((OrientationMode = pomHorizontal) and FMoveOnPositions)) then\r\n          begin\r\n            if (Y - FScrollY) > 0 then\r\n              FScrollVTo := Max(0, Min(VerticalScrollBar.Max - GetVViewPortSize, FScrollVTo - Round(Abs(Y - FScrollY) * FSpY * f * 3)))\r\n            else\r\n              FScrollVTo := Max(0, Min(VerticalScrollBar.Max - GetVViewPortSize, FScrollVTo + Round(Abs(Y - FScrollY) * FSpY * f * 3)));\r\n\r\n            FAnimateVerticalPos := True;\r\n            FAnimateTimer.Enabled := True;\r\n          end;\r\n\r\n          FSpX := Abs(X - FScrollX) / (FTimeStop - FTimeStart);\r\n          if (FSpX > 0) and (not FMoveOnPositions or ((OrientationMode = pomVertical) and FMoveOnPositions)) then\r\n          begin\r\n            if (X - FScrollX) > 0 then\r\n              FScrollHTo := Max(0, Min(HorizontalScrollBar.Max - GetHViewPortSize, FScrollHTo - Round(Abs(X - FScrollX) * FSpX * f * 3)))\r\n            else\r\n              FScrollHTo := Max(0, Min(HorizontalScrollBar.Max - GetHViewPortSize, FScrollHTo + Round(Abs(X - FScrollX) * FSpX * f * 3)));\r\n\r\n            FAnimateHorizontalPos := True;\r\n            FAnimateTimer.Enabled := True;\r\n          end;\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        if Assigned(FDownItem) then\r\n        begin\r\n          b := FDownItem.Selectable and FDownItem.Enabled;\r\n          prev := FActiveItem;\r\n          DoBeforeSelectItem(FDownItem, b);\r\n          if b then\r\n          begin\r\n            if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n              HandleSelectLinkedItems(FDownItem, {$IFNDEF FMXMOBILE}(ssCtrl in Shift) and {$ENDIF} Interaction.MultiSelect)\r\n            else\r\n              HandleSelectItem(FDownItem, {$IFNDEF FMXMOBILE}(ssCtrl in Shift) and {$ENDIF} Interaction.MultiSelect);\r\n\r\n            DoAfterSelectItem(FDownItem);\r\n          end;\r\n\r\n          if ((Interaction.MouseEditMode = pmemSingleClick) or ((Interaction.MouseEditMode = pmemSingleClickOnSelectedItem) and (FDownItem = prev))) and not Interaction.ReadOnly then\r\n          begin\r\n            if Assigned(FDownItem) then\r\n            begin\r\n              it := TTMSFNCPlannerItemOpen(FDownItem);\r\n              if (FDownCacheItemIdx >= 0) and (FDownCacheItemIdx <= it.CacheList.Count - 1) then\r\n                HandleItemEditing(FDownItem, it.CacheList[FDownCacheItemIdx]);\r\n            end;\r\n          end;\r\n        end\r\n        else if IsValidCell(FDownCell.Col, FDownCell.Row) then\r\n        begin\r\n          if not FRangeSelection then\r\n          begin\r\n            if ssShift in Shift then\r\n              SelectCells(Selection.StartCell, FDownCell)\r\n            else\r\n              SelectCells(FDownCell, FDownCell);\r\n          end;\r\n\r\n          HandleCellSelection;\r\n          if not Interaction.ReadOnly then\r\n          begin\r\n            case Interaction.MouseInsertMode of\r\n              pmimAfterSelection: HandleItemInsert(False);\r\n              pmimDialogAfterSelection: HandleItemInsert(True);\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n    end\r\n    else if not FDoItemSizeUp and not FDoItemSizeDown and not FDoItemMove then\r\n    begin\r\n      if FDoItemDelete then\r\n        HandleItemDelete(FDownItem, pidmTouch)    \r\n      else\r\n      begin\r\n        a := XYToItemAnchor(FDownItem, X, Y);\r\n        if a <> '' then\r\n          DoItemAnchorClick(FDownItem, a);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if FDoItemSizeUp or FDoItemSizeDown or FDoItemMove or FDoItemDelete then\r\n    DoAfterItemChanged(FDownItem);\r\n\r\n  FRangeSelection := False;\r\n  FDoItemSizeUp := False;\r\n  FDoItemSizeDown := False;\r\n  FDoItemDelete := False;\r\n  FDoItemAnchor := '';\r\n  FDoItemMove := False;\r\n  if FDrawItemHelpers then\r\n  begin\r\n    FDrawItemHelpers := False;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleMouseWheel(Shift: TShiftState; WheelDelta: Integer;\r\n  var Handled: Boolean);\r\nvar\r\n  vpos, hpos: Double;\r\n  sz: Single;\r\nbegin\r\n  inherited;\r\n  vpos := GetVScrollValue;\r\n  hpos := GetHScrollValue;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal: sz := DefaultColumnWidth;\r\n    pomVertical: sz := DefaultRowHeight;\r\n    else\r\n      sz := 0;\r\n  end;\r\n\r\n  if WheelDelta > 0 then\r\n    Scroll(hpos, vpos - sz)\r\n  else\r\n    Scroll(hpos, vpos + sz);\r\n\r\n  Handled := True;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateGridDisplay;\r\nbegin\r\n  BuildDisplay(FGridCache, FGridDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateGroupCache(ACache: TTMSFNCPlannerCache);\r\nvar\r\n  w, h: Double;\r\n  I: Integer;\r\n  grp: TTMSFNCPlannerDisplayGroup;\r\n  cr: TRectF;\r\n  x, y, bw, bh: Double;\r\n  rt, rc: TRectF;\r\n  bmp: TBitmap;\r\n  g: TTMSFNCGraphics;\r\n  cache: TTMSFNCPlannerCacheItem;\r\n  bmpvalid: Boolean;\r\nbegin\r\n  inherited;\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or (ColumnCount = 0) or (FDisplayGroups.Count = 0) or not Assigned(ACache) then\r\n    Exit;\r\n\r\n  ACache.Clear;\r\n\r\n  if (ACache is TTMSFNCPlannerGroupsTopCache) and (not (pglTop in GroupsAppearance.Layouts) or (GroupsAppearance.TopSize <= 0)) then\r\n    Exit;\r\n\r\n  if (ACache is TTMSFNCPlannerGroupsBottomCache) and (not (pglBottom in GroupsAppearance.Layouts) or (GroupsAppearance.BottomSize <= 0)) then\r\n    Exit;\r\n\r\n  bmpvalid := False;\r\n\r\n  cr := GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      h := cr.Bottom - cr.Top;\r\n      if ACache is TTMSFNCPlannerGroupsTopCache then\r\n        w := GetGroupsTopSize + 1\r\n      else\r\n        w := GetGroupsBottomSize + 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      w := cr.Right - cr.Left;\r\n      if ACache is TTMSFNCPlannerGroupsTopCache then\r\n        h := GetGroupsTopSize + 1\r\n      else\r\n        h := GetGroupsBottomSize + 1;\r\n    end;\r\n    else\r\n    begin\r\n      w := 0;\r\n      h := 0;\r\n    end;\r\n  end;\r\n\r\n  for I := 0 to FDisplayGroups.Count - 1 do\r\n  begin\r\n    grp := FDisplayGroups[I];\r\n\r\n    {$IFDEF FMXWEBLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        x := 0;\r\n        y := Int(ColumnPositions[grp.StartPosition]);\r\n        bw := w;\r\n        bh := Int(ColumnPositions[grp.EndPosition + 1] - y);\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        y := 0;\r\n        x := Int(ColumnPositions[grp.StartPosition]);\r\n        bh := h;\r\n        bw := Int(ColumnPositions[grp.EndPosition + 1] - x);\r\n      end;\r\n      else\r\n      begin\r\n        bw := 0;\r\n        bh := 0;\r\n        x := 0;\r\n        y := 0;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        x := 0;\r\n        y := ColumnPositions[grp.StartPosition];\r\n        bw := w;\r\n        bh := ColumnPositions[grp.EndPosition + 1] - y;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        y := 0;\r\n        x := ColumnPositions[grp.StartPosition];\r\n        bh := h;\r\n        bw := ColumnPositions[grp.EndPosition + 1] - x;\r\n      end\r\n      else\r\n      begin\r\n        bw := 0;\r\n        bh := 0;\r\n        x := 0;\r\n        y := 0;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n\r\n    if (bw <= 0) or (bh <= 0) then\r\n      Continue;\r\n\r\n    rt := RectF(0, 0, bw, bh);\r\n    bmp := nil;\r\n    if GroupsCaching then\r\n      bmpvalid := CreateAndPrepareBitmap(bmp, bw, bh);\r\n\r\n    g := nil;\r\n    if bmpvalid then\r\n      g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n\r\n    {$IFDEF FMXWEBLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        rc.Left := int(rt.Left) + 0.5;\r\n        rc.Right := int(rt.Right) - 0.5;\r\n        rc.Top := int(rt.Top) + 0.5;\r\n        rc.Bottom := int(rt.Bottom) + 0.5;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        rc.Top := int(rt.Top) + 0.5;\r\n        rc.Bottom := int(rt.Bottom) - 0.5;\r\n        rc.Left := int(rt.Left) + 0.5;\r\n        rc.Right := int(rt.Right) + 0.5;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        rc.Left := rt.Left;\r\n        rc.Right := rt.Right;\r\n        rc.Top := rt.Top;\r\n        rc.Bottom := rt.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        rc.Top := rt.Top;\r\n        rc.Bottom := rt.Bottom;\r\n        rc.Left := rt.Left;\r\n        rc.Right := rt.Right + 1;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n\r\n    if GroupsCaching then\r\n    begin\r\n      if bmpvalid then\r\n      begin\r\n        if ACache is TTMSFNCPlannerGroupsTopCache then\r\n          DrawGroup(g, rc, I, grp.StartPosition, grp.EndPosition, ikGroupTop)\r\n        else\r\n          DrawGroup(g, rc, I, grp.StartPosition, grp.EndPosition, ikGroupBottom);\r\n\r\n        {$IFDEF FMXLIB}\r\n        bmp.Canvas.EndScene;\r\n        {$ENDIF}\r\n        if Assigned(g) then\r\n          g.Free;\r\n      end;\r\n\r\n      OffsetRectEx(rt, x, y);\r\n      if ACache is TTMSFNCPlannerGroupsTopCache then\r\n        cache := TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikGroupTop)\r\n      else\r\n        cache := TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikGroupBottom);\r\n\r\n      cache.Group := I;\r\n      ACache.Add(cache);\r\n    end\r\n    else\r\n    begin\r\n      OffsetRectEx(rc, x, y);\r\n      if ACache is TTMSFNCPlannerGroupsTopCache then\r\n        cache := TTMSFNCPlannerCacheItem.CreateGroupTop(rc, I, grp.StartPosition, grp.EndPosition)\r\n      else\r\n        cache := TTMSFNCPlannerCacheItem.CreateGroupBottom(rc, I, grp.StartPosition, grp.EndPosition);\r\n\r\n      ACache.Add(cache);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateGroupsCache;\r\nbegin\r\n  UpdateGroupCache(FGroupsTopCache);\r\n  UpdateGroupCache(FGroupsBottomCache);\r\n  UpdateGroupsDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateGroupsDisplay;\r\nbegin\r\n  BuildDisplay(FGroupsTopCache, FGroupsTopDisplay);\r\n  BuildDisplay(FGroupsBottomCache, FGroupsBottomDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateInplaceEditorPosition;\r\nvar\r\n  it: TTMSFNCPlannerItemOpen;\r\n  c: TTMSFNCPlannerCacheItem;\r\n  r: TRectF;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) then\r\n    Exit;\r\n\r\n  if Assigned(FInplaceEditor) and FInplaceEditorActive then\r\n  begin\r\n    if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n    begin\r\n      it := TTMSFNCPlannerItemOpen(Items[FUpdateItem]);\r\n      c := nil;\r\n      if (FDownCacheItemIdx >= 0) and (FDownCacheItemIdx <= it.CacheList.Count - 1) then\r\n        c := it.CacheList[FDownCacheItemIdx];\r\n\r\n      r := GetInplaceEditorRect(c, it);\r\n      {$IFDEF FMXLIB}\r\n      FInplaceEditor.BoundsRect := r;\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      FInplaceEditor.BoundsRect := Bounds(Round(r.Left), Round(r.Top), Round(r.Right - r.Left), Round(r.Bottom - r.Top));\r\n      {$ENDIF}\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateItemCache;\r\nvar\r\n  ri: TRectF;\r\n  bmp: TBitmap;\r\n  rt: TRectF;\r\n  cp: Integer;\r\n  bw, bh, isz, ispos: Double;\r\n  x, y: Double;\r\n  it: TTMSFNCPlannerItemOpen;\r\n  rc: TRectF;\r\n  cache: TTMSFNCPlannerCacheItem;\r\n  cw, ch: Double;\r\n  I: Integer;\r\n  cr: TRectF;\r\n  hs, vs: Double;\r\n  bmpvalid: Boolean;\r\n  std, etd: Double;\r\n  sta, ste, stadr, stedr: TDateTime;\r\n  K: Integer;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or not Assigned(FItemCache) then\r\n    Exit;\r\n\r\n  if ColumnCount > 0 then\r\n  begin\r\n    cr := GetContentRect;\r\n    hs := GetHorizontalScrollPosition;\r\n    vs := GetVerticalScrollPosition;\r\n    bmpvalid := False;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        cw := GetTotalRowHeight;\r\n        ch := GetTotalColumnWidth;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        ch := GetTotalRowHeight;\r\n        cw := GetTotalColumnWidth;\r\n      end;\r\n      else\r\n      begin\r\n        cw := 0;\r\n        ch := 0;\r\n      end;\r\n    end;\r\n\r\n    for I := 0 to Items.Count - 1 do\r\n    begin\r\n      it := TTMSFNCPlannerItemOpen(Items[I]);\r\n\r\n      for K := it.CleanupList.Count - 1 downto 0 do\r\n      begin\r\n        RemoveItemsFromCache(it.CacheList, it.CleanupList[K]);\r\n        it.CleanupList.Delete(K);\r\n      end;\r\n\r\n      if not IsValidItem(it) then\r\n      begin\r\n        RemoveItemsFromCache(it.CacheList);\r\n        Continue;\r\n      end;\r\n\r\n      if not (ItemCachingMode = picmDelayedCaching) then\r\n      begin\r\n        if it.DirtyList.Count = 0 then\r\n          Continue\r\n        else\r\n          RemoveItemsFromCache(it.CacheList);\r\n      end;\r\n\r\n      sta := it.StartTime;\r\n      ste := it.EndTime;\r\n\r\n      for K := it.DirtyList.Count - 1 downto 0 do\r\n      begin\r\n        cp := it.DirtyList[K];\r\n        if (cp >= 0) and (cp <= ColumnCount - 1) then\r\n        begin\r\n          ispos := ColumnPositions[cp];\r\n          isz := ColumnPositions[cp + 1] - ispos;\r\n\r\n          if (K >= 0) and (K <= it.ConflictsList.Count - 1) then\r\n          begin\r\n            if it.ConflictsList[K] > 0 then\r\n              isz := isz / it.ConflictsList[K]\r\n          end;\r\n\r\n          if (K >= 0) and (K <= it.ConflictsPosList.Count - 1) then\r\n            ispos := ispos + isz * it.ConflictsPosList[K];\r\n\r\n          stadr := MaxPositionDateTime(sta, False, cp);\r\n          stedr := MaxPositionDateTime(ste, True, cp);\r\n          std := DateTimeToValue(stadr);\r\n          if GetDisplayMode = pmMultiMonth then\r\n          begin\r\n            if Abs(stedr - stadr) >= 1 then\r\n              etd := DateTimeToValue(stedr, True)\r\n            else\r\n              etd := DateTimeToValue(stedr);\r\n          end\r\n          else\r\n            etd := DateTimeToValue(stedr, True);\r\n\r\n          case OrientationMode of\r\n            pomHorizontal:\r\n            begin\r\n              y := Floor(ispos);\r\n              x := Round(std);\r\n              bw := Round(etd - std);\r\n              bh := Max(1, Round(isz - ItemsAppearance.Gap));\r\n            end;\r\n            pomVertical:\r\n            begin\r\n              x := Floor(ispos);\r\n              y := Round(std);\r\n              bh := Round(etd - std);\r\n              bw := Max(1, Round(isz - ItemsAppearance.Gap));\r\n            end;\r\n            else\r\n            begin\r\n              x := 0;\r\n              y := 0;\r\n              bw := 0;\r\n              bh := 0;\r\n            end;\r\n          end;\r\n\r\n          if (bw <= 0) or (bh <= 0) then\r\n          begin\r\n            RemoveItemsFromCache(it.CacheList, cp);\r\n            Continue;\r\n          end;\r\n\r\n          ri := RectF(x, y, x + bw, y + bh);\r\n          OffsetRectEx(ri, cr.Left, cr.Top);\r\n          OffsetRectEx(ri, -hs, -vs);\r\n\r\n          if ItemCachingMode = picmDelayedCaching then\r\n          begin\r\n            if not IntersectRectEx(ri, cr) then\r\n            begin\r\n              if not it.DirtyList.IndexOf(cp) > -1 then\r\n                it.DirtyList.Add(cp);\r\n              RemoveItemsFromCache(it.CacheList, cp);\r\n              Continue;\r\n            end\r\n            else if not it.DirtyList.IndexOf(cp) > -1 then\r\n              Continue\r\n            else\r\n              RemoveItemsFromCache(it.CacheList, cp);\r\n          end;\r\n\r\n          rt := RectF(0, 0, bw, bh);\r\n          rc := rt;\r\n          bmp := nil;\r\n          if ItemCachingMode <> picmNoCaching then\r\n            bmpvalid := CreateAndPrepareBitmap(bmp, bw, bh);\r\n\r\n          g := nil;\r\n          if bmpvalid then\r\n            g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n\r\n          {$IFDEF FMXWEBLIB}\r\n          InflateRectEx(rc, -0.5, -0.5);\r\n          {$ENDIF}\r\n\r\n          rc.Left := rc.Left + 1;\r\n          rc.Top := rc.Top + 1;\r\n          case OrientationMode of\r\n            pomHorizontal:\r\n            begin\r\n              if y + bh = ch then\r\n                rc.Bottom := rc.Bottom - 1;\r\n              if x + bw = cw then\r\n                rc.Right := rc.Right - 1\r\n            end;\r\n            pomVertical:\r\n            begin\r\n              if y + bh = ch then\r\n                rc.Bottom := rc.Bottom - 1;\r\n              if x + bw = cw then\r\n                rc.Right := rc.Right - 1;\r\n            end;\r\n          end;\r\n\r\n          if ItemCachingMode <> picmNoCaching then\r\n          begin\r\n            if bmpvalid then\r\n            begin\r\n              DrawItem(g, rc, it, K, True);\r\n              {$IFDEF FMXLIB}\r\n              bmp.Canvas.EndScene;\r\n              {$ENDIF}\r\n              if Assigned(g) then\r\n                g.Free;\r\n            end;\r\n\r\n            OffsetRectEx(rt, x, y);\r\n            cache := TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikItem, cp);\r\n            cache.Item := it;\r\n            cache.Idx := K;\r\n            FItemCache.Add(cache);\r\n          end\r\n          else\r\n          begin\r\n            OffsetRectEx(rc, x, y);\r\n            cache := TTMSFNCPlannerCacheItem.CreateItem(rc, cp, it, K);\r\n            FItemCache.Add(cache);\r\n          end;\r\n          it.DirtyList.Remove(cp);\r\n          it.CacheList.Add(cache);\r\n        end;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n    FItemCache.Clear;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateItemDisplay;\r\nbegin\r\n  BuildDisplay(FItemCache, FItemDisplay);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.MaxPositionDateTime(ADateTime: TDatetime; AEndDateTime: Boolean; APosition: Integer): TDateTime;\r\nvar\r\n  dtmx: TDateTime;\r\nbegin\r\n  case GetDisplayMode of\r\n    pmMultiDayRes:\r\n    begin\r\n      if AEndDatetime then\r\n        Result := Min(IncDay(FDisplayEndTime, APosition mod Max(1, GetNumDays)), ADateTime)\r\n      else\r\n        Result := Max(IncDay(FDisplayStartTime, APosition mod Max(1, GetNumDays)), ADateTime);\r\n    end;\r\n    pmMultiResDay:\r\n    begin\r\n      if AEndDatetime then\r\n        Result := Min(IncDay(FDisplayEndTime, APosition div Max(1, Resources.Count)), ADateTime)\r\n      else\r\n        Result := Max(IncDay(FDisplayStartTime, APosition div Max(1, Resources.Count)), ADateTime);\r\n    end;\r\n    pmMultiDay:\r\n    begin\r\n      if AEndDatetime then\r\n        Result := Min(IncDay(FDisplayEndTime, APosition), ADateTime)\r\n      else\r\n        Result := Max(IncDay(FDisplayStartTime, APosition), ADateTime);\r\n    end;\r\n    pmMultiMonth:\r\n    begin\r\n      dtmx := IncMonth(FDisplayStartTime, APosition);\r\n      if AEndDatetime then\r\n        Result := Min(EncodeDate(YearOf(dtmx), MonthOf(dtmx), DaysInMonth(dtmx)) + 1, ADateTime)\r\n      else\r\n        Result := Max(dtmx, ADateTime);\r\n    end\r\n    else\r\n    begin\r\n      if AEndDatetime then\r\n        Result := Min(FDisplayEndTime, ADateTime)\r\n      else\r\n        Result := Max(FDisplayStartTime, ADateTime);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CalculatePositionDateTime(ADateTime: TDatetime;\r\n  APosition: Integer): TDateTime;\r\nbegin\r\n  Result := ADateTime;\r\n  case GetDisplayMode of\r\n    pmMultiDayRes: Result := IncDay(Result, APosition mod Max(1, GetNumDays));\r\n    pmMultiResDay: Result := IncDay(Result, APosition div Max(1, Resources.Count));\r\n    pmMultiDay: Result := IncDay(Result, APosition);\r\n    pmMultiMonth: Result := IncMonth(Result, APosition);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallAfterMoveLinkedItems(AItem: TTMSFNCPlannerItem);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if (AItem.LinkType <> iltNone) and lio.CanUpdate then\r\n  begin\r\n    DoAfterMoveItem(li, li.StartTime, li.EndTime, TTMSFNCPlannerItemOpen(li).NewPosition);\r\n    DoItemChanged(li);\r\n  end;\r\n\r\n  lio.CanUpdate := False;\r\n  CallAfterMoveLinkedItems(li);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallAfterSizeLinkedItems(AItem: TTMSFNCPlannerItem);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n  if (AItem.LinkType <> iltNone) and lio.CanUpdate then\r\n  begin\r\n    DoAfterSizeItem(li, li.StartTime, li.EndTime, TTMSFNCPlannerItemOpen(li).NewPosition);\r\n    DoItemChanged(li);\r\n  end;\r\n\r\n  lio.CanUpdate := False;\r\n  CallAfterSizeLinkedItems(li);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallAfterUpdateLinkedItems(\r\n  AItem: TTMSFNCPlannerItem);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n  if (AItem.LinkType <> iltNone) and (lio.CanUpdate) then\r\n  begin\r\n    DoAfterUpdateItem(li.StartTime, li.EndTime, TTMSFNCPlannerItemOpen(li).NewPosition, li);\r\n    DoItemChanged(li);\r\n  end;\r\n\r\n  lio.CanUpdate := False;\r\n  CallAfterUpdateLinkedItems(li);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallBeforeMoveLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\n  b: Boolean;\r\n  nst, net: TDateTime;\r\n  nrs: Integer;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if AItem.LinkType <> iltNone then\r\n  begin\r\n    nst := lio.NewStartTime;\r\n    net := lio.NewEndTime;\r\n    GetNewDateTimeAndResource(li, AItem.LinkType, ADiffStartDateTime, ADiffEndDateTime, nst, net);\r\n    nrs := ResourceToPosition(li.Resource + ADiffResource);\r\n    lio.CanUpdate := True;\r\n    b := True;\r\n    DoBeforeMoveItem(li, nst, net, nrs, b);\r\n    lio.NewStartTime := nst;\r\n    lio.NewEndTime := net;\r\n    lio.NewPosition := nrs;\r\n    lio.CanUpdate := b;\r\n  end;\r\n\r\n  CallBeforeMoveLinkedItems(li, ADiffStartDateTime, ADiffEndDateTime, ADiffResource);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallBeforeSizeLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\n  b: Boolean;\r\n  nst, net: TDateTime;\r\n  nrs: Integer;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if AItem.LinkType <> iltNone then\r\n  begin\r\n    nst := lio.NewStartTime;\r\n    net := lio.NewEndTime;\r\n    GetNewDateTimeAndResource(li, AItem.LinkType, ADiffStartDateTime, ADiffEndDateTime, nst, net);\r\n    nrs := ResourceToPosition(li.Resource + ADiffResource);\r\n    lio.CanUpdate := True;\r\n    b := True;\r\n    DoBeforeSizeItem(li, nst, net, nrs, b);\r\n    lio.NewStartTime := nst;\r\n    lio.NewEndTime := net;\r\n    lio.NewPosition := nrs;\r\n    lio.CanUpdate := b;\r\n  end;\r\n\r\n  CallBeforeSizeLinkedItems(li, ADiffStartDateTime, ADiffEndDateTime, ADiffResource);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallBeforeUpdateLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartDateTime, ADiffEndDateTime: TDateTime; ADiffResource: Integer);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\n  b: Boolean;\r\n  nst, net: TDateTime;\r\n  nrs: Integer;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if AItem.LinkType <> iltNone then\r\n  begin\r\n    nst := lio.NewStartTime;\r\n    net := lio.NewEndTime;\r\n    GetNewDateTimeAndResource(li, AItem.LinkType, ADiffStartDateTime, ADiffEndDateTime, nst, net);\r\n    nrs := ResourceToPosition(li.Resource + ADiffResource);\r\n    lio.CanUpdate := True;\r\n    b := True;\r\n    DoBeforeMoveItem(li, nst, net, nrs, b);\r\n    lio.NewStartTime := nst;\r\n    lio.NewEndTime := net;\r\n    lio.NewPosition := nrs;\r\n    lio.CanUpdate := b;\r\n  end;\r\n\r\n  CallBeforeUpdateLinkedItems(li, ADiffStartDateTime, ADiffEndDateTime, ADiffResource);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallMoveLinkedItems(AItem: TTMSFNCPlannerItem);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if (AItem.LinkType <> iltNone) and lio.CanUpdate then\r\n    DoMoveItem(li, li.StartTime, li.EndTime, TTMSFNCPlannerItemOpen(li).NewPosition);\r\n\r\n  CallMoveLinkedItems(li);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CallSizeLinkedItems(AItem: TTMSFNCPlannerItem);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  lio: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  lio := TTMSFNCPlannerItemOpen(li);\r\n  if lio.UpdatingLinked then\r\n    Exit;\r\n\r\n  lio.UpdatingLinked := True;\r\n\r\n  if (AItem.LinkType <> iltNone) and lio.CanUpdate then\r\n    DoSizeItem(li, li.StartTime, li.EndTime, TTMSFNCPlannerItemOpen(li).NewPosition);\r\n\r\n  CallSizeLinkedItems(li);\r\n  lio.UpdatingLinked := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CancelEditing;\r\nbegin\r\n  if FEditorDialogActive then\r\n    CloseEditingDialog(True)\r\n  else if FInplaceEditorActive then\r\n    CloseInplaceEditor(True);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CanDeleteCacheItem(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): Boolean;\r\nbegin\r\n  Result := Assigned(ACacheItem) and (ACacheItem.Idx = 0);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CanMoveCacheItem(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CanNavigate: Boolean;\r\nbegin\r\n  Result := True;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CanSizeCacheItemEndTime(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): Boolean;\r\nbegin\r\n  Result := False;\r\n  if Assigned(ACacheItem) and Assigned(ACacheItem.Item) then\r\n    Result := ACacheItem.Idx = TTMSFNCPlannerItemOpen(ACacheItem.Item).CacheList.Count - 1;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CanSizeCacheItemStartTime(\r\n  ACacheItem: TTMSFNCPlannercacheItem): Boolean;\r\nbegin\r\n  Result := Assigned(ACacheItem) and (ACacheItem.Idx = 0);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CellToDateTime(ACell: TTMSFNCPlannerCell): TDateTime;\r\nbegin\r\n  Result := ValueToDateTime(RowPositions[ACell.Row], ACell.Col, ACell.Row);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CellToEndDateTime(\r\n  ACell: TTMSFNCPlannerCell): TDateTime;\r\nbegin\r\n  Result := CellToDateTime(MakeCell(ACell.Col, ACell.Row + 1));\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CellToStartDatetime(\r\n  ACell: TTMSFNCPlannerCell): TDateTime;\r\nbegin\r\n  Result := CellToDateTime(ACell);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CloseEditingDialog(ACancel: Boolean);\r\nvar\r\n  p: TTMSFNCPlannerEditingDialog;\r\n  sta: TDateTime;\r\n  ste: TDateTime;\r\n  t: String;\r\n  n: String;\r\n  b: Boolean;\r\n  it: TTMSFNCPlannerItem;\r\n  res: Integer;\r\n  s, c: Boolean;\r\n  sc: TTMSFNCPlannerCell;\r\n  {$IFDEF CMNWEBLIB}\r\n  {$IFDEF WEBLIB}\r\n  prtn: TControl;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  prtn: TWinControl;\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nbegin\r\n  it := nil;\r\n  if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n    it := Items[FUpdateItem];\r\n\r\n  sta := 0;\r\n  ste := 0;\r\n  p := GetEditingDialog(FUpdateItem);\r\n  if not ACancel then\r\n  begin\r\n    sta := Int(Now);\r\n    if Assigned(p.StartDateEdit) then\r\n      sta := Int(p.StartDateEdit.Date);\r\n\r\n    if Assigned(p.StartTimeEdit) then\r\n      sta := sta + Frac(p.StartTimeEdit.Time);\r\n\r\n    ste := Int(Now);\r\n    if Assigned(p.EndDateEdit) then\r\n      ste := Int(p.EndDateEdit.Date);\r\n\r\n    if Assigned(p.EndTimeEdit) then\r\n      ste := ste + Frac(p.EndTimeEdit.Time);\r\n\r\n    t := DefaultItem.Title;\r\n    if Assigned(p.TitleEdit) then\r\n      t := p.TitleEdit.Text;\r\n\r\n    n := DefaultItem.Text;\r\n    if Assigned(p.TextMemo) then\r\n      n := p.TextMemo.Text;\r\n\r\n    res := FInsertResource;\r\n    if Assigned(p.ResourcesComboBox) then\r\n    begin\r\n      {$IFDEF CMNWEBLIB}\r\n      prtn := FResourcesComboBox.Parent;\r\n      {$IFNDEF WEBLIB}\r\n      if not p.ResourcesComboBox.HandleAllocated then\r\n        p.ResourcesComboBox.Parent := Application.MainForm;\r\n      {$ENDIF}\r\n      {$ENDIF}\r\n      res := p.ResourcesComboBox.ItemIndex;\r\n      {$IFDEF CMNWEBLIB}\r\n      p.ResourcesComboBox.Parent := prtn;\r\n      {$ENDIF}\r\n    end;\r\n\r\n    if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n    begin\r\n      it := Items[FUpdateItem];\r\n      b := True;\r\n      DoBeforeUpdateItem(sta, ste, res, it, t, n, b);\r\n      if b then\r\n      begin\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := True;\r\n        CallBeforeUpdateLinkedItems(it, sta - it.StartTime, ste - it.EndTime, res - it.Resource);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := False;\r\n        it := AddOrUpdateItem(res, sta, ste, t, n, FUpdateItem);\r\n        if p.CustomContentPanel and Assigned(p.ContentPanel) and not ACancel then\r\n          DoCustomContentPanelToItem(p.ContentPanel, it);\r\n        DoAfterUpdateItem(sta, ste, res, it);\r\n        DoItemChanged(it);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := True;\r\n        CallAfterUpdateLinkedItems(it);\r\n        TTMSFNCPlannerItemOpen(it).UpdatingLinked := False;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      b := True;\r\n      DoBeforeInsertItem(sta, ste, res, t, n,  b);\r\n      if b then\r\n      begin\r\n        it := AddOrUpdateItem(res, sta, ste, t, n);\r\n        if p.CustomContentPanel and Assigned(p.ContentPanel) and not ACancel then\r\n          DoCustomContentPanelToItem(p.ContentPanel, it);\r\n        DoAfterInsertItem(sta, ste, res, it);\r\n        s := it.Selectable and it.Enabled;\r\n        DoBeforeSelectItem(it, s);\r\n        if s then\r\n        begin\r\n          if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n            HandleSelectLinkedItems(it)\r\n          else\r\n            HandleSelectItem(it);\r\n\r\n          DoAfterSelectItem(it);\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  c := True;\r\n  if Assigned(it) then\r\n    sc := ItemToStartCell(it);\r\n\r\n  if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n    DoCloseUpdateDialog(sta, ste, sc.Col, it, ACancel, c)\r\n  else\r\n    DoCloseInsertDialog(sta, ste, sc.Col, it, ACancel, c);\r\n\r\n  if c then\r\n  begin\r\n    if Assigned(p.Background) then\r\n      p.Background.Parent := nil;\r\n    if Assigned(p.Panel) then\r\n      p.Panel.Parent := nil;\r\n\r\n    if CanFocus then\r\n      SetFocus;\r\n\r\n    FEditorDialogActive := False;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.CloseEditingDialogAndRemoveItem;\r\nbegin\r\n  if (FUpdateItem >= 0) and (FUpdateItem <= Items.Count - 1) then\r\n    HandleItemDelete(Items[FUpdateItem], pidmDialog);\r\n  CloseEditingDialog(True);\r\nend;\r\n\r\nconstructor TTMSFNCCustomPlanner.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  FFindItemIndex := 0;\r\n  FNeedsInitialization := True;\r\n  FSelectedItems := TTMSFNCPlannerSelectedItems.Create;\r\n  FCustomDatesList := TTMSFNCPlannerDateTimes.Create;\r\n  {$IFNDEF LCLLIB}\r\n  {$IFNDEF WEBLIB}\r\n  FCompareCustomDates := TDelegatedComparer<TDateTime>.Create(\r\n  function(const Item1, Item2: TDateTime): Integer\r\n  begin\r\n    Result := CompareDateTime(Item1, Item2);\r\n  end\r\n  );\r\n  {$ENDIF}\r\n  {$ENDIF}\r\n  FGroupsCaching := False;\r\n  FGridCaching := False;\r\n  FPositionsCaching := False;\r\n  FTimeLineCaching := False;\r\n  FMode := pmMultiDay;\r\n\r\n  FCustomDateTimes := TTMSFNCPlannerDateTimes.Create;\r\n  FDisplayGroups := TTMSFNCPlannerDisplayGroups.Create;\r\n  FConflicts := TTMSFNCPlannerConflicts.Create;\r\n  FGridCache := TTMSFNCPlannerGridCache.Create;\r\n  FItemCache := TTMSFNCPlannerItemCache.Create;\r\n  FPositionsTopCache := TTMSFNCPlannerPositionsTopCache.Create;\r\n  FTimeLineLeftCache := TTMSFNCPlannerTimeLineLeftCache.Create;\r\n  FGroupsTopCache := TTMSFNCPlannerGroupsTopCache.Create;\r\n  FPositionsBottomCache := TTMSFNCPlannerPositionsBottomCache.Create;\r\n  FTimeLineRightCache := TTMSFNCPlannerTimeLineRightCache.Create;\r\n  FGroupsBottomCache := TTMSFNCPlannerGroupsBottomCache.Create;\r\n\r\n  FGridDisplay := TTMSFNCPlannerGridDisplayList.Create;\r\n  FItemDisplay := TTMSFNCPlannerItemDisplayList.Create;\r\n  FPositionsTopDisplay := TTMSFNCPlannerPositionsTopDisplayList.Create;\r\n  FTimeLineLeftDisplay := TTMSFNCPlannerTimeLineLeftDisplayList.Create;\r\n  FGroupsTopDisplay := TTMSFNCPlannerGroupsTopDisplayList.Create;\r\n  FPositionsBottomDisplay := TTMSFNCPlannerPositionsBottomDisplayList.Create;\r\n  FTimeLineRightDisplay := TTMSFNCPlannerTimeLineRightDisplayList.Create;\r\n  FGroupsBottomDisplay := TTMSFNCPlannerGroupsBottomDisplayList.Create;\r\n\r\n  FSelectionAppearance := TTMSFNCPlannerSelectionAppearance.Create(Self);\r\n  FGridCellAppearance := TTMSFNCPlannerGridCellAppearance.Create(Self);\r\n  FItemsAppearance := TTMSFNCPlannerItemsAppearance.Create(Self);\r\n  FTimeLine := TTMSFNCPlannerTimeLine.Create(Self);\r\n  FModeSettings := TTMSFNCPlannerModeSettings.Create(Self);\r\n  FTimeLineAppearance := TTMSFNCPlannerTimeLineAppearance.Create(Self);\r\n  FPositionsAppearance := TTMSFNCPlannerPositionsAppearance.Create(Self);\r\n  FPositions := TTMSFNCPlannerPositions.Create(Self);\r\n  FGroupsAppearance := TTMSFNCPlannerGroupsAppearance.Create(Self);\r\n  FInteraction := TTMSFNCPlannerInteraction.Create(Self);\r\n  FDefaultItem := TTMSFNCPlannerItem.Create(nil);\r\n\r\n  FAnimateTimer := TTimer.Create(Self);\r\n  FAnimateTimer.Interval := 1;\r\n  FAnimateTimer.Enabled := False;\r\n  FAnimateTimer.OnTimer := Animate;\r\n\r\n  FDownTimer := TTimer.Create(Self);\r\n  FDownTimer.Interval := 1;\r\n  FDownTimer.Enabled := False;\r\n  FDownTimer.OnTimer := DownTime;\r\n\r\n  Width := 600;\r\n  Height := 450;\r\n  if (csDesigning in ComponentState) and not ((csReading in Owner.ComponentState) or (csLoading in Owner.ComponentState)) then\r\n    InitSample;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.FixStroke(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  if (AGraphics.Stroke.Color = gcNull) or (AGraphics.Stroke.Kind = gskNone) then\r\n  begin\r\n    AGraphics.Stroke.Kind := gskSolid;\r\n    AGraphics.Stroke.Color := AGraphics.Fill.Color;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.ColumnStretchingActive: Boolean;\r\nbegin\r\n  Result := PositionsAppearance.Stretch;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetEditingDialogTabOrder;\r\nbegin\r\n  if Assigned(FStartDateEdit) then\r\n    FStartDateEdit.TabOrder := 0;\r\n\r\n  if Assigned(FStartTimeEdit) then\r\n    FStartTimeEdit.TabOrder := 1;\r\n\r\n  if Assigned(FEndDateEdit) then\r\n    FEndDateEdit.TabOrder := 2;\r\n\r\n  if Assigned(FEndTimeEdit) then\r\n    FEndTimeEdit.TabOrder := 3;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetBitmapContainer: TTMSFNCBitmapContainer;\r\nbegin\r\n  Result := FBitmapContainer;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetBitmapContainer(const Value: TTMSFNCBitmapContainer);\r\nbegin\r\n  FBitmapContainer := Value;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ApplyStyle;\r\nvar\r\n  c: TTMSFNCGraphicsColor;\r\nbegin\r\n  inherited;\r\n  BeginUpdate;\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundFillColor(c) then\r\n    Fill.Color := c;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleBackgroundStrokeColor(c) then\r\n    Stroke.Color := c;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleHeaderFillColor(c) then\r\n  begin\r\n    GroupsAppearance.TopFill.Kind := gfkSolid;\r\n    GroupsAppearance.BottomFill.Kind := gfkSolid;\r\n    TimeLineAppearance.LeftFill.Kind := gfkSolid;\r\n    TimeLineAppearance.RightFill.Kind := gfkSolid;\r\n    PositionsAppearance.TopFill.Kind := gfkSolid;\r\n    PositionsAppearance.BottomFill.Kind := gfkSolid;\r\n    PositionsAppearance.TopNavigationButtonFill.Kind := gfkSolid;\r\n    PositionsAppearance.BottomNavigationButtonFill.Kind := gfkSolid;\r\n    GroupsAppearance.TopFill.Color := c;\r\n    GroupsAppearance.BottomFill.Color := c;\r\n    TimeLineAppearance.LeftFill.Color := c;\r\n    TimeLineAppearance.RightFill.Color := c;\r\n    PositionsAppearance.TopFill.Color := c;\r\n    PositionsAppearance.BottomFill.Color := c;\r\n    PositionsAppearance.TopNavigationButtonFill.Color := c;\r\n    PositionsAppearance.BottomNavigationButtonFill.Color := c;\r\n    PositionsAppearance.TopNavigationButtonHoverFill.Assign(SelectionAppearance.Fill);\r\n    PositionsAppearance.BottomNavigationButtonHoverFill.Assign(SelectionAppearance.Fill);\r\n    PositionsAppearance.TopNavigationButtonDownFill.Assign(GridCellAppearance.Fill);\r\n    PositionsAppearance.BottomNavigationButtonDownFill.Assign(GridCellAppearance.Fill);\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleHeaderFillColorTo(c) then\r\n  begin\r\n    GroupsAppearance.TopFill.Kind := gfkGradient;\r\n    GroupsAppearance.BottomFill.Kind := gfkGradient;\r\n    TimeLineAppearance.LeftFill.Kind := gfkGradient;\r\n    TimeLineAppearance.RightFill.Kind := gfkGradient;\r\n    PositionsAppearance.TopFill.Kind := gfkGradient;\r\n    PositionsAppearance.BottomFill.Kind := gfkGradient;\r\n    PositionsAppearance.TopNavigationButtonFill.Kind := gfkGradient;\r\n    PositionsAppearance.BottomNavigationButtonFill.Kind := gfkGradient;\r\n    GroupsAppearance.TopFill.ColorTo := c;\r\n    GroupsAppearance.BottomFill.ColorTo := c;\r\n    TimeLineAppearance.LeftFill.ColorTo := c;\r\n    TimeLineAppearance.RightFill.ColorTo := c;\r\n    PositionsAppearance.TopFill.ColorTo := c;\r\n    PositionsAppearance.BottomFill.ColorTo := c;\r\n    PositionsAppearance.TopNavigationButtonFill.ColorTo := c;\r\n    PositionsAppearance.BottomNavigationButtonFill.ColorTo := c;\r\n    PositionsAppearance.TopNavigationButtonHoverFill.Assign(SelectionAppearance.Fill);\r\n    PositionsAppearance.BottomNavigationButtonHoverFill.Assign(SelectionAppearance.Fill);\r\n    PositionsAppearance.TopNavigationButtonDownFill.Assign(GridCellAppearance.Fill);\r\n    PositionsAppearance.BottomNavigationButtonDownFill.Assign(GridCellAppearance.Fill);\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleLineFillColor(c) then\r\n  begin\r\n    TimeLineAppearance.LeftStroke.Color := c;\r\n    TimeLineAppearance.RightStroke.Color := c;\r\n    PositionsAppearance.TopStroke.Color := c;\r\n    PositionsAppearance.BottomStroke.Color := c;\r\n    PositionsAppearance.TopNavigationButtonStroke.Color := c;\r\n    PositionsAppearance.BottomNavigationButtonStroke.Color := c;\r\n    PositionsAppearance.TopNavigationButtonHoverStroke.Color := c;\r\n    PositionsAppearance.BottomNavigationButtonHoverStroke.Color := c;\r\n    PositionsAppearance.TopNavigationButtonDownStroke.Color := c;\r\n    PositionsAppearance.BottomNavigationButtonDownStroke.Color := c;\r\n    GroupsAppearance.TopStroke.Color := c;\r\n    GroupsAppearance.BottomStroke.Color := c;\r\n    GridCellAppearance.VerticalStroke.Color := c;\r\n    GridCellAppearance.HorizontalStroke.Color := c;\r\n    GridCellAppearance.HorizontalSubStroke.Color := c;\r\n    TimeLineAppearance.LeftSubStroke.Color := c;\r\n    TimeLineAppearance.RightSubStroke.Color := c;\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleSelectionFillColor(c) then\r\n  begin\r\n    SelectionAppearance.Fill.Kind := gfkSolid;\r\n    SelectionAppearance.Fill.Color := c;\r\n    GridCellAppearance.Fill.Assign(SelectionAppearance.Fill);\r\n    GridCellAppearance.Fill.Color := Blend(c, Fill.Color, 25);\r\n    GridCellAppearance.Fill.Kind := gfkSolid;\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleSelectionFillColorTo(c) then\r\n  begin\r\n    SelectionAppearance.Fill.ColorTo := c;\r\n    SelectionAppearance.Fill.Kind := gfkGradient;\r\n  end;\r\n\r\n  c := gcNull;\r\n  if TTMSFNCStyles.GetStyleTextFontColor(c) then\r\n  begin\r\n    TimeLineAppearance.LeftFont.Color := c;\r\n    TimeLineAppearance.RightFont.Color := c;\r\n    PositionsAppearance.TopFont.Color := c;\r\n    PositionsAppearance.BottomFont.Color := c;\r\n    GroupsAppearance.TopFont.Color := c;\r\n    GroupsAppearance.BottomFont.Color := c;\r\n  end;\r\n\r\n  GridCellAppearance.InactiveFill.Assign(Fill);\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ResetToDefaultStyle;\r\nbegin\r\n  Fill.Kind := gfkSolid;\r\n  Stroke.Kind := gskSolid;\r\n  Fill.Color := gcWhite;\r\n  Stroke.Color := gcDarkGray;\r\n  GridCellAppearance.VerticalStroke.Color := gcDarkGray;\r\n  GridCellAppearance.HorizontalStroke.Color := gcDarkGray;\r\n  GridCellAppearance.HorizontalSubStroke.Color := gcLightgray;\r\n  GridCellAppearance.InActiveFill.Color := MakeGraphicsColor(225, 245, 255);\r\n  GridCellAppearance.DisabledFill.Color := MakeGraphicsColor(230, 230, 230);\r\n  GridCellAppearance.Fill.Color := gcWhite;\r\n  PositionsAppearance.TopFill.Color := gcWhite;\r\n  PositionsAppearance.BottomFill.Color := gcWhite;\r\n  PositionsAppearance.TopStroke.Color := gcDarkGray;\r\n  PositionsAppearance.BottomStroke.Color := gcDarkgray;\r\n  PositionsAppearance.BottomNavigationButtonFill.Color := gcWhite;\r\n  PositionsAppearance.BottomNavigationButtonStroke.Color := gcDarkGray;\r\n  PositionsAppearance.TopNavigationButtonFill.Color := gcWhite;\r\n  PositionsAppearance.TopNavigationButtonStroke.Color := gcDarkGray;\r\n  PositionsAppearance.BottomNavigationButtonHoverFill.Color := MakeGraphicsColor(225, 245, 255);\r\n  PositionsAppearance.BottomNavigationButtonHoverStroke.Color := gcDarkGray;\r\n  PositionsAppearance.TopNavigationButtonHoverFill.Color := MakeGraphicsColor(225, 245, 255);\r\n  PositionsAppearance.TopNavigationButtonHoverStroke.Color := gcDarkGray;\r\n  PositionsAppearance.BottomNavigationButtonDownFill.Color := MakeGraphicsColor(149, 213, 246);\r\n  PositionsAppearance.BottomNavigationButtonDownStroke.Color := gcDarkGray;\r\n  PositionsAppearance.TopNavigationButtonDownFill.Color := MakeGraphicsColor(149, 213, 246);\r\n  PositionsAppearance.TopNavigationButtonDownStroke.Color := gcDarkGray;\r\n  PositionsAppearance.TopFont.Color := gcGray;\r\n  PositionsAppearance.BottomFont.Color := gcGray;\r\n  GroupsAppearance.TopFill.Color := gcWhite;\r\n  GroupsAppearance.BottomFill.Color := gcWhite;\r\n  GroupsAppearance.TopStroke.Color := gcDarkGray;\r\n  GroupsAppearance.BottomStroke.Color := gcDarkgray;\r\n  GroupsAppearance.TopFont.Color := gcGray;\r\n  GroupsAppearance.BottomFont.Color := gcGray;\r\n\r\n  TimeLineAppearance.LeftFill.Color := gcWhite;\r\n  TimeLineAppearance.RightFill.Color := gcWhite;\r\n  TimeLineAppearance.LeftStroke.Color := gcDarkGray;\r\n  TimeLineAppearance.RightStroke.Color := gcDarkgray;\r\n  TimeLineAppearance.LeftSubStroke.Color := gcLightgray;\r\n  TimeLineAppearance.RightSubStroke.Color := gcLightgray;\r\n  TimeLineAppearance.LeftFont.Color := gcGray;\r\n  TimeLineAppearance.RightFont.Color := gcGray;\r\n  SelectionAppearance.Fill.Color := MakeGraphicsColor(149, 213, 246);\r\n\r\n  SelectionAppearance.Fill.Kind := gfkSolid;\r\n  GridCellAppearance.VerticalStroke.Kind := gskSolid;\r\n  GridCellAppearance.HorizontalStroke.Kind := gskSolid;\r\n  GridCellAppearance.HorizontalSubStroke.Kind := gskSolid;\r\n  GridCellAppearance.Fill.Kind := gfkNone;\r\n  GridCellAppearance.DisabledFill.Kind := gfkSolid;\r\n  GridCellAppearance.InActiveFill.Kind := gfkSolid;\r\n  PositionsAppearance.TopFill.Kind := gfkNone;\r\n  PositionsAppearance.BottomFill.Kind := gfkNone;\r\n  PositionsAppearance.TopStroke.Kind := gskSolid;\r\n  PositionsAppearance.BottomStroke.Kind := gskSolid;\r\n  PositionsAppearance.TopNavigationButtonFill.Kind := gfkSolid;\r\n  PositionsAppearance.BottomNavigationButtonFill.Kind := gfkSolid;\r\n  PositionsAppearance.TopNavigationButtonStroke.Kind := gskSolid;\r\n  PositionsAppearance.BottomNavigationButtonStroke.Kind := gskSolid;\r\n  PositionsAppearance.TopNavigationButtonHoverFill.Kind := gfkSolid;\r\n  PositionsAppearance.BottomNavigationButtonHoverFill.Kind := gfkSolid;\r\n  PositionsAppearance.TopNavigationButtonHoverStroke.Kind := gskSolid;\r\n  PositionsAppearance.BottomNavigationButtonHoverStroke.Kind := gskSolid;\r\n  PositionsAppearance.TopNavigationButtonDownFill.Kind := gfkSolid;\r\n  PositionsAppearance.BottomNavigationButtonDownFill.Kind := gfkSolid;\r\n  PositionsAppearance.TopNavigationButtonDownStroke.Kind := gskSolid;\r\n  PositionsAppearance.BottomNavigationButtonDownStroke.Kind := gskSolid;\r\n  GroupsAppearance.TopFill.Kind := gfkNone;\r\n  GroupsAppearance.BottomFill.Kind := gfkNone;\r\n  GroupsAppearance.TopStroke.Kind := gskSolid;\r\n  GroupsAppearance.BottomStroke.Kind := gskSolid;\r\n  TimeLineAppearance.LeftFill.Kind := gfkNone;\r\n  TimeLineAppearance.RightFill.Kind := gfkNone;\r\n  TimeLineAppearance.LeftStroke.Kind := gskSolid;\r\n  TimeLineAppearance.RightStroke.Kind := gskSolid;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DestroyEditingDialog;\r\nbegin\r\n  if Assigned(FItemEditor) then\r\n  begin\r\n    FItemEditor.FCreated := False;\r\n    FItemEditor.FInitialized := False;\r\n  end;\r\n\r\n  FCurrentPanel := nil;\r\n  FEditingDialogCreated := False;\r\n  if Assigned(FEditingBackground) then\r\n    FEditingBackground.Free;\r\n\r\n  FEditingBackground := nil;\r\n\r\n  if Assigned(FEditingDialog) then\r\n    FEditingDialog.Free;\r\n\r\n  FEditingDialog := nil;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CreateAndPrepareBitmap(var ABitmap: TBitmap; AWidth, AHeight: Double): Boolean;\r\n{$IFDEF FMXLIB}\r\nvar\r\n  ds: TTMSFNCPlannerSceneDrawingScale;\r\n  bw, bh: Integer;\r\n  mxs: Integer;\r\nbegin\r\n  ds := GetSceneDrawingScale;\r\n  bw := Round(AWidth * ds.SceneScale * ds.DrawingScale.X);\r\n  bh := Round(AHeight * ds.SceneScale * ds.DrawingScale.Y);\r\n  mxs := TCanvasManager.DefaultCanvas.GetAttribute(TCanvasAttribute.MaxBitmapSize);\r\n  Result := False;\r\n  try\r\n    ABitmap := TBitmap.Create(Min(mxs, bw), Min(mxs, bh));\r\n    ABitmap.BitmapScale := ds.SceneScale;\r\n    Result := ABitmap.Canvas.BeginScene;\r\n    if Result then\r\n    begin\r\n      ABitmap.Canvas.SetMatrix(ABitmap.Canvas.Matrix.CreateScaling(ds.DrawingScale.X, ds.DrawingScale.Y));\r\n      ABitmap.Canvas.Clear(0);\r\n    end;\r\n  except\r\n  end;\r\n{$ENDIF}\r\n{$IFDEF CMNWEBLIB}\r\nbegin\r\n  ABitmap := TBitmap.Create;\r\n  ABitmap.Width := Round(AWidth);\r\n  ABitmap.Height := Round(AHeight);\r\n  Result := True;\r\n{$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetEditingDialog(AItemIndex: Integer = -1): TTMSFNCPlannerEditingDialog;\r\nvar\r\n  cp: TTMSFNCPlannerEditingDialogContentPanel;\r\n  it: TTMSFNCPlannerItem;\r\n  {$IFDEF CMNWEBLIB}\r\n  bmp: TTMSFNCBitmap;\r\n  {$ENDIF}\r\n  sc: Single;\r\nbegin\r\n  if not FEditingDialogCreated then\r\n  begin\r\n    FEditingBackground := TTMSFNCImage.Create(Self);\r\n    FEditingBackground.AllowFocus := False;\r\n    {$IFDEF FMXLIB}\r\n    FEditingBackground.Align := TAlignLayout.Client;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FEditingBackground.Align := alClient;\r\n    {$ENDIF}\r\n    FEditingBackground.DisableBackground;\r\n    FEditingBackground.OnClick := EditingDialogCancel;\r\n\r\n    FEditingDialog := TTMSFNCControl.Create(Self);\r\n    FEditingDialog.AdaptToStyle := AdaptToStyle;\r\n    FEditingDialog.AllowFocus := False;\r\n    FEditingDialog.Width := 350;\r\n    FEditingDialog.Height := 300;\r\n    {$IFDEF FMXLIB}\r\n    FEditingDialog.Align := TAlignLayout.Center;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FEditingDialog.Left := (Width - FEditingDialog.Width) div 2;\r\n    FEditingDialog.Top := (Height - FEditingDialog.Height) div 2;\r\n    {$IFNDEF WEBLIB}\r\n    FEditingDialog.Anchors := [];\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n\r\n    FBottomPanel := TTMSFNCControl.Create(FEditingDialog);\r\n    FBottomPanel.AdaptToStyle := AdaptToStyle;\r\n    FBottomPanel.Height := 37;\r\n    FBottomPanel.Parent := FEditingDialog;\r\n    FBottomPanel.Width := 200;\r\n    FBottomPanel.AllowFocus := False;\r\n\r\n    FButtonOK := TLabel.Create(FBottomPanel);\r\n    FButtonOK.Visible := False;\r\n    FButtonOK.Parent := Self;\r\n    {$IFDEF FMXLIB}\r\n    FButtonOK.Text := TranslateTextEx(sTMSFNCPlannerOK);\r\n    FButtonOK.HitTest := True;\r\n    FButtonOK.Align := TAlignLayout.Right;\r\n    FButtonOK.StyledSettings := FButtonOK.StyledSettings - [TStyledSetting.Size];\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FButtonOK.Layout := tlCenter;\r\n    {$ENDIF}\r\n    FButtonOK.Caption := TranslateTextEx(sTMSFNCPlannerOK);\r\n    FButtonOK.Align := alRight;\r\n    {$IFNDEF LCLLIB}\r\n    FButtonOK.AlignWithMargins := True;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FButtonOK.WordWrap := False;\r\n    FButtonOK.AutoSize := True;\r\n    FButtonOK.Cursor := crHandPoint;\r\n    TTMSFNCUtils.SetFontSize(FButtonOK.Font, 16);\r\n    {$IFNDEF LCLLIB}\r\n    FButtonOK.Margins.Right := 5;\r\n    FButtonOK.Margins.Top := 5;\r\n    FButtonOK.Margins.Bottom := 5;\r\n    FButtonOK.Margins.Left := 5;\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    FButtonOK.BorderSpacing.Right := 5;\r\n    FButtonOK.BorderSpacing.Top := 5;\r\n    FButtonOK.BorderSpacing.Bottom := 5;\r\n    FButtonOK.BorderSpacing.Left := 5;\r\n    {$ENDIF}\r\n\r\n    FButtonOK.Font.Style := [TFontStyle.fsBold];\r\n    FButtonOK.OnClick := EditingDialogValidate;\r\n    FButtonOK.Parent := FBottomPanel;\r\n    FButtonOK.Visible := True;\r\n\r\n    FButtonCancel := TLabel.Create(FBottomPanel);\r\n    FButtonCancel.Visible := False;\r\n    FButtonCancel.Parent := Self;\r\n    TTMSFNCUtils.SetFontSize(FButtonCancel.Font, 16);\r\n    {$IFDEF FMXLIB}\r\n    FButtonCancel.Text := TranslateTextEx(sTMSFNCPlannerCancel);\r\n    FButtonCancel.Align := TAlignLayout.Right;\r\n    FButtonCancel.StyledSettings := FButtonCancel.StyledSettings - [TStyledSetting.Size];\r\n    FButtonCancel.HitTest := True;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FButtonCancel.Layout := tlCenter;\r\n    {$ENDIF}\r\n    FButtonCancel.Caption := TranslateTextEx(sTMSFNCPlannerCancel);\r\n    FButtonCancel.Align := alRight;\r\n    {$IFNDEF LCLLIB}\r\n    FButtonCancel.AlignWithMargins := True;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FButtonCancel.WordWrap := False;\r\n    FButtonCancel.AutoSize := True;\r\n    FButtonCancel.Cursor := crHandPoint;\r\n    {$IFDEF LCLLIB}\r\n    FButtonCancel.BorderSpacing.Right := 5;\r\n    FButtonCancel.BorderSpacing.Top := 5;\r\n    FButtonCancel.BorderSpacing.Bottom := 5;\r\n    FButtonCancel.BorderSpacing.Left := 5;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FButtonCancel.Margins.Right := 5;\r\n    FButtonCancel.Margins.Top := 5;\r\n    FButtonCancel.Margins.Bottom := 5;\r\n    FButtonCancel.Margins.Left := 5;\r\n    {$ENDIF}\r\n    FButtonCancel.OnClick := EditingDialogCancel;\r\n    FButtonCancel.Parent := FBottomPanel;\r\n    FButtonCancel.Visible := True;\r\n\r\n    FButtonRemove := TLabel.Create(FBottomPanel);\r\n    FButtonRemove.Visible := False;\r\n    FButtonRemove.Parent := Self;\r\n    TTMSFNCUtils.SetFontSize(FButtonRemove.Font, 16);\r\n    {$IFDEF FMXLIB}\r\n    FButtonRemove.Text := TranslateTextEx(sTMSFNCPlannerRemove);\r\n    FButtonRemove.Align := TAlignLayout.Left;\r\n    FButtonRemove.StyledSettings := FButtonRemove.StyledSettings - [TStyledSetting.FontColor, TStyledSetting.Size];\r\n    FButtonRemove.FontColor := gcRed;\r\n    FButtonRemove.HitTest := True;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FButtonRemove.Layout := tlCenter;\r\n    {$ENDIF}\r\n    FButtonRemove.Align := alLeft;\r\n    FButtonRemove.Caption := TranslateTextEx(sTMSFNCPlannerRemove);\r\n    FButtonRemove.Font.Color := gcRed;\r\n    {$IFNDEF LCLLIB}\r\n    FButtonRemove.AlignWithMargins := True;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    FButtonRemove.WordWrap := False;\r\n    FButtonRemove.AutoSize := True;\r\n    FButtonRemove.Cursor := crHandPoint;\r\n    {$IFDEF LCLLIB}\r\n    FButtonRemove.BorderSpacing.Right := 5;\r\n    FButtonRemove.BorderSpacing.Top := 5;\r\n    FButtonRemove.BorderSpacing.Bottom := 5;\r\n    FButtonRemove.BorderSpacing.Left := 5;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FButtonRemove.Margins.Right := 5;\r\n    FButtonRemove.Margins.Top := 5;\r\n    FButtonRemove.Margins.Bottom := 5;\r\n    FButtonRemove.Margins.Left := 5;\r\n    {$ENDIF}\r\n    FButtonRemove.Font.Style := [TFontStyle.fsBold];\r\n    FButtonRemove.OnClick := EditingDialogRemove;\r\n    FButtonRemove.Parent := FBottomPanel;\r\n    FButtonRemove.Visible := True;\r\n\r\n    FContentPanel := TTMSFNCControl.Create(FEditingDialog);\r\n    FContentPanel.AdaptToStyle := AdaptToStyle;\r\n    FContentPanel.AllowFocus := False;\r\n    FContentPanel.Height := 37;\r\n    {$IFDEF FMXLIB}\r\n    FContentPanel.Align := TAlignLayout.Client;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FContentPanel.Align := alClient;\r\n    {$ENDIF}\r\n    FContentPanel.Parent := FEditingDialog;\r\n\r\n    FStartTimeLabel := TLabel.Create(FContentPanel);\r\n    {$IFDEF WEBLIB}\r\n    FStartTimeLabel.Width := 100;\r\n    FStartTimeLabel.Height := 15;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FStartTimeLabel.Text := TranslateTextEx(sTMSFNCPlannerStartTime);\r\n    FStartTimeLabel.Position.X := 10;\r\n    FStartTimeLabel.Position.Y := 10;\r\n    FStartTimeLabel.FontColor := gcDarkgray;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FStartTimeLabel.Caption := TranslateTextEx(sTMSFNCPlannerStartTime);\r\n    FStartTimeLabel.Left := 10;\r\n    FStartTimeLabel.Top := 10;\r\n    FStartTimeLabel.Font.Color := gcDarkgray;\r\n    {$ENDIF}\r\n    FStartTimeLabel.WordWrap := False;\r\n    {$IFNDEF WEBLIB}\r\n    FStartTimeLabel.AutoSize := True;\r\n    {$ENDIF}\r\n    FStartTimeLabel.Parent := FContentPanel;\r\n\r\n    FStartTimeEdit := TTMSFNCPlannerTimeEdit.Create(FContentPanel);\r\n    FStartTimeEdit.OnChange := @StartTimeEditChanged;\r\n    FStartTimeEdit.Width := 100;\r\n    {$IFDEF FMXLIB}\r\n    FStartTimeEdit.Position.X := FEditingDialog.Width - FStartTimeEdit.Width - 10;\r\n    FStartTimeEdit.Position.Y := FStartTimeLabel.Position.Y + int((FStartTimeLabel.Height - FStartTimeEdit.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FStartTimeEdit.Kind := dtkTime;\r\n    FStartTimeEdit.Left := FEditingDialog.Width - FStartTimeEdit.Width - 10;\r\n    FStartTimeEdit.Top := FStartTimeLabel.Top + (FStartTimeLabel.Height - FStartTimeEdit.Height) div 2;\r\n    {$ENDIF}\r\n    FStartTimeEdit.Parent := FContentPanel;\r\n\r\n    FStartDateEdit := TTMSFNCPlannerDateEdit.Create(FContentPanel);\r\n    FStartDateEdit.OnChange := @StartDateEditChanged;\r\n    FStartDateEdit.Width := 100;\r\n    {$IFDEF FMXLIB}\r\n    FStartDateEdit.Position.X := FStartTimeEdit.Position.X - FStartDateEdit.Width - 10;\r\n    FStartDateEdit.Position.Y := FStartTimeEdit.Position.Y + int((FStartTimeEdit.Height - FStartDateEdit.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FStartDateEdit.Width := 125;\r\n    {$ENDIF}\r\n    FStartDateEdit.Left := FStartTimeEdit.Left - FStartDateEdit.Width - 10;\r\n    FStartDateEdit.Top := FStartTimeEdit.Top + (FStartTimeEdit.Height - FStartDateEdit.Height) div 2;\r\n    {$ENDIF}\r\n    FStartDateEdit.Parent := FContentPanel;\r\n\r\n    FEndTimeLabel := TLabel.Create(FContentPanel);\r\n    FEndTimeLabel.Width := 100;\r\n    {$IFDEF WEBLIB}\r\n    FEndTimeLabel.Height := 15;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FEndTimeLabel.Text := TranslateTextEx(sTMSFNCPlannerEndTime);\r\n    FEndTimeLabel.Position.X := 10;\r\n    FEndTimeLabel.Position.Y := FStartTimeLabel.Position.Y + FStartTimeLabel.Height + 15;\r\n    FEndTimeLabel.FontColor := gcDarkgray;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FEndTimeLabel.Caption := TranslateTextEx(sTMSFNCPlannerEndTime);\r\n    FEndTimeLabel.Left := 10;\r\n    FEndTimeLabel.Top := FStartTimeLabel.Top + FStartTimeLabel.Height + 15;\r\n    FEndTimeLabel.Font.Color := gcDarkgray;\r\n    {$ENDIF}\r\n    FEndTimeLabel.WordWrap := False;\r\n    {$IFNDEF WEBLIB}\r\n    FEndTimeLabel.AutoSize := True;\r\n    {$ENDIF}\r\n    FEndTimeLabel.Parent := FContentPanel;\r\n\r\n    FEndTimeEdit := TTMSFNCPlannerTimeEdit.Create(FContentPanel);\r\n    FEndTimeEdit.OnChange := @EndTimeEditChanged;\r\n    FEndTimeEdit.Width := 100;\r\n    {$IFDEF FMXLIB}\r\n    FEndTimeEdit.Position.X := FEditingDialog.Width - FEndTimeEdit.Width - 10;\r\n    FEndTimeEdit.Position.Y := FEndTimeLabel.Position.Y + int((FEndTimeLabel.Height - FEndTimeEdit.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FEndTimeEdit.Kind := dtkTime;\r\n    FEndTimeEdit.Left := FEditingDialog.Width - FEndTimeEdit.Width - 10;\r\n    FEndTimeEdit.Top := FEndTimeLabel.Top + (FEndTimeLabel.Height - FEndTimeEdit.Height) div 2;\r\n    {$ENDIF}\r\n    FEndTimeEdit.Parent := FContentPanel;\r\n\r\n    FEndDateEdit := TTMSFNCPlannerDateEdit.Create(FContentPanel);\r\n    FEndDateEdit.OnChange := @EndDateEditChanged;\r\n    FEndDateEdit.Width := 100;\r\n    {$IFDEF FMXLIB}\r\n    FEndDateEdit.Position.X := FEndTimeEdit.Position.X - FEndDateEdit.Width - 10;\r\n    FEndDateEdit.Position.Y := FEndTimeEdit.Position.Y + int((FEndTimeEdit.Height - FEndDateEdit.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FEndDateEdit.Width := 125;\r\n    {$ENDIF}\r\n    FEndDateEdit.Left := FEndTimeEdit.Left - FEndDateEdit.Width - 10;\r\n    FEndDateEdit.Top := FEndTimeEdit.Top + (FEndTimeEdit.Height - FEndDateEdit.Height) div 2;\r\n    {$ENDIF}\r\n    FEndDateEdit.Parent := FContentPanel;\r\n\r\n    FResourceLabel := TLabel.Create(FContentPanel);\r\n    FResourceLabel.Width := 100;\r\n    {$IFDEF WEBLIB}\r\n    FResourceLabel.Height := 15;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FResourceLabel.Text := TranslateTextEx(sTMSFNCPlannerResource);\r\n    FResourceLabel.Position.X := 10;\r\n    FResourceLabel.Position.Y := FEndTimeLabel.Position.Y + FEndTimeLabel.Height + 15;\r\n    FResourceLabel.FontColor := gcDarkgray;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FResourceLabel.Caption := TranslateTextEx(sTMSFNCPlannerResource);\r\n    FResourceLabel.Left := 10;\r\n    FResourceLabel.Top := FEndTimeLabel.Top + FEndTimeLabel.Height + 15;\r\n    FResourceLabel.Font.Color := gcDarkgray;\r\n    {$ENDIF}\r\n    FResourceLabel.WordWrap := False;\r\n    {$IFNDEF WEBLIB}\r\n    FResourceLabel.AutoSize := True;\r\n    {$ENDIF}\r\n    FResourceLabel.Parent := FContentPanel;\r\n\r\n    FResourcesComboBox := TComboBox.Create(FContentPanel);\r\n    {$IFDEF FMXLIB}\r\n    FResourcesComboBox.Width := FEditingDialog.Width - FStartDateEdit.Position.X - 10;\r\n    FResourcesComboBox.Position.X := FStartDateEdit.Position.X;\r\n    FResourcesComboBox.Position.Y := FResourceLabel.Position.Y + Int((FResourceLabel.Height - FResourcesComboBox.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FResourcesComboBox.Width := FEditingDialog.Width - FStartDateEdit.Left - 10;\r\n    FResourcesComboBox.Left := FStartDateEdit.Left;\r\n    FResourcesComboBox.Top := FResourceLabel.Top + (FResourceLabel.Height - FResourcesComboBox.Height) div 2;\r\n    {$ENDIF}\r\n    FResourcesComboBox.Parent := FContentPanel;\r\n\r\n    FTitleLabel := TLabel.Create(FContentPanel);\r\n    FTitleLabel.Width := 100;\r\n    {$IFDEF WEBLIB}\r\n    FTitleLabel.Height := 15;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FTitleLabel.Text := TranslateTextEx(sTMSFNCPlannerTitle);\r\n    FTitleLabel.Position.X := 10;\r\n    FTitleLabel.Position.Y := FResourceLabel.Position.Y + FResourceLabel.Height + 15;\r\n    FTitleLabel.FontColor := gcDarkgray;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FTitleLabel.Caption := TranslateTextEx(sTMSFNCPlannerTitle);\r\n    FTitleLabel.Left := 10;\r\n    FTitleLabel.Top := FResourceLabel.Top + FResourceLabel.Height + 15;\r\n    FTitleLabel.Font.Color := gcDarkgray;\r\n    {$ENDIF}\r\n    FTitleLabel.WordWrap := False;\r\n    {$IFNDEF WEBLIB}\r\n    FTitleLabel.AutoSize := True;\r\n    {$ENDIF}\r\n    FTitleLabel.Parent := FContentPanel;\r\n\r\n    FTitleEdit := TEdit.Create(FContentPanel);\r\n    {$IFDEF FMXLIB}\r\n    FTitleEdit.Width := FEditingDialog.Width - FStartDateEdit.Position.X - 10;\r\n    FTitleEdit.Position.X := FStartDateEdit.Position.X;\r\n    FTitleEdit.Position.Y := FTitleLabel.Position.Y + Int((FTitleLabel.Height - FTitleEdit.Height) / 2);\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FTitleEdit.Width := FEditingDialog.Width - FStartDateEdit.Left - 10;\r\n    FTitleEdit.Left := FStartDateEdit.Left;\r\n    FTitleEdit.Top := FTitleLabel.Top + (FTitleLabel.Height - FTitleEdit.Height) div 2;\r\n    {$ENDIF}\r\n    FTitleEdit.Parent := FContentPanel;\r\n\r\n    FTextLabel := TLabel.Create(FContentPanel);\r\n    FTextLabel.Width := 100;\r\n    {$IFDEF WEBLIB}\r\n    FTextLabel.Height := 15;\r\n    {$ENDIF}\r\n    {$IFDEF FMXLIB}\r\n    FTextLabel.Text := TranslateTextEx(sTMSFNCPlannerText);\r\n    FTextLabel.Position.X := 10;\r\n    FTextLabel.Position.Y := FTitleLabel.Position.Y + FTitleLabel.Height + 15;\r\n    FTextLabel.FontColor := gcDarkgray;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FTextLabel.Caption := TranslateTextEx(sTMSFNCPlannerText);\r\n    FTextLabel.Left := 10;\r\n    FTextLabel.Top := FTitleLabel.Top + FTitleLabel.Height + 15;\r\n    FTextLabel.Font.Color := gcDarkgray;\r\n    {$ENDIF}\r\n    FTextLabel.WordWrap := False;\r\n    {$IFNDEF WEBLIB}\r\n    FTextLabel.AutoSize := True;\r\n    {$ENDIF}\r\n    FTextLabel.Parent := FContentPanel;\r\n\r\n    FTextMemo := TMemo.Create(FContentPanel);\r\n    {$IFDEF FMXLIB}\r\n    FTextMemo.Align := TAlignLayout.Client;\r\n    FTextMemo.Margins.Top := FTextLabel.Position.Y + FTextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FTextMemo.Align := alClient;\r\n    {$IFDEF LCLLIB}\r\n    FTextMemo.BorderSpacing.Top := FTextLabel.Top + FTextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FTextMemo.AlignWithMargins := True;\r\n    FTextMemo.Margins.Top := FTextLabel.Top + FTextLabel.Height + 15;\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    FTextMemo.BorderSpacing.Right := 10;\r\n    FTextMemo.BorderSpacing.Bottom := 10;\r\n    FTextMemo.BorderSpacing.Left := 10;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FTextMemo.Margins.Right := 10;\r\n    FTextMemo.Margins.Bottom := 10;\r\n    FTextMemo.Margins.Left := 10;\r\n    {$ENDIF}\r\n    FTextMemo.Parent := FContentPanel;\r\n\r\n    FEditingDialogCreated := True;\r\n\r\n    SetEditingDialogTabOrder;\r\n  end;\r\n\r\n  Result.Background := FEditingBackground;\r\n  Result.Panel := FEditingDialog;\r\n  Result.StartTimeEdit := FStartTimeEdit;\r\n  Result.EndTimeEdit := FEndTimeEdit;\r\n  Result.StartDateEdit := FStartDateEdit;\r\n  Result.EndDateEdit := FEndDateEdit;\r\n  Result.TitleEdit := FTitleEdit;\r\n  Result.TextMemo := FTextMemo;\r\n  Result.TitleLabel := FTitleLabel;\r\n  Result.TextLabel := FTextLabel;\r\n  Result.StartTimeLabel := FStartTimeLabel;\r\n  Result.EndTimeLabel := FEndTimeLabel;\r\n  Result.BottomPanel := FBottomPanel;\r\n  Result.ButtonOK := FButtonOK;\r\n  Result.ButtonRemove := FButtonRemove;\r\n  Result.ButtonCancel := FButtonCancel;\r\n  Result.ResourcesComboBox := FResourcesComboBox;\r\n  Result.ResourceLabel := FResourceLabel;\r\n  Result.ContentPanel := FContentPanel;\r\n  Result.ContentPanel.Visible := True;\r\n  Result.CustomContentPanel := False;\r\n  {$IFDEF FMXLIB}\r\n  Result.BottomPanel.Align := TAlignLayout.None;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  Result.BottomPanel.Align := alNone;\r\n  {$ENDIF}\r\n  Result.BottomPanel.Width := 200;\r\n\r\n  cp := nil;\r\n  it := nil;\r\n  if (AItemIndex >= 0) and (AItemIndex <= Items.Count - 1) then\r\n    it := Items[AItemIndex];\r\n\r\n  if Assigned(FCurrentPanel) then\r\n  begin\r\n    FCurrentPanel.Visible := False;\r\n    {$IFDEF FMXLIB}\r\n    FCurrentPanel.Align := TAlignLayout.None;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    FCurrentPanel.Align := alNone;\r\n    {$ENDIF}\r\n    FCurrentPanel.Parent := nil;\r\n    FCurrentPanel := nil;\r\n  end;\r\n\r\n  DoGetCustomContentPanel(it, cp);\r\n  if Assigned(cp) then\r\n  begin\r\n    if Assigned(Result.ContentPanel) then\r\n    begin\r\n      Result.ContentPanel.Visible := False;\r\n      {$IFDEF FMXLIB}\r\n      Result.ContentPanel.Align := TAlignLayout.None;\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      Result.ContentPanel.Align := alNone;\r\n      {$ENDIF}\r\n    end;\r\n\r\n    cp.Parent := Result.Panel;\r\n    cp.Visible := True;\r\n    Result.ContentPanel := cp;\r\n    Result.CustomContentPanel := True;\r\n    FCurrentPanel := cp;\r\n  end;\r\n\r\n  {$IFDEF VCLLIB}\r\n  if Assigned(Result.Panel) then\r\n    Result.Panel.Parent := Self;\r\n  {$ENDIF}\r\n\r\n  if not Result.CustomContentPanel then\r\n  begin\r\n    {$IFDEF FMXLIB}\r\n    Result.ContentPanel.Align := TAlignLayout.None;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    Result.ContentPanel.Align := alNone;\r\n    {$ENDIF}\r\n    {$IFDEF VCLLIB}\r\n    sc := TTMSFNCUtils.GetDPIScale;\r\n    {$ENDIF}\r\n    {$IFNDEF VCLLIB}\r\n    sc := 1;\r\n    {$ENDIF}\r\n    Result.ContentPanel.Width := Round(350 * sc);\r\n    Result.ContentPanel.Height := Round(300 * sc);\r\n  end;\r\n\r\n  if Assigned(Result.Panel) and Assigned(Result.ContentPanel) and Assigned(Result.BottomPanel) then\r\n  begin\r\n    Result.Panel.Height := Max(Result.BottomPanel.Height, Result.ContentPanel.Height + Result.BottomPanel.Height);\r\n    Result.Panel.Width := Max(Result.BottomPanel.Width, Result.ContentPanel.Width);\r\n    {$IFDEF FMXLIB}\r\n    Result.BottomPanel.Align := TAlignLayout.Bottom;\r\n    Result.ContentPanel.Align := TAlignLayout.Client;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    Result.BottomPanel.Align := alBottom;\r\n    Result.ContentPanel.Align := alClient;\r\n    {$ENDIF}\r\n  end;\r\n\r\n  {$IFDEF VCLLIB}\r\n  if Assigned(Result.Panel) then\r\n    Result.Panel.Parent := nil;\r\n  {$ENDIF}\r\n\r\n  {$IFDEF CMNLIB}\r\n  if Assigned(Result.Background) then\r\n  begin\r\n    Result.Background.Bitmaps.Clear;\r\n    bmp := MakeScreenshot;\r\n    try\r\n      Result.Background.Bitmaps.AddBitmap(bmp);\r\n    finally\r\n      bmp.Free;\r\n    end;\r\n  end;\r\n  {$ENDIF}\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetEndTimeSizeHandler: TTMSFNCPlannerSizeHandler;\r\nbegin\r\n  if not FEndTimeSizeHandlerCreated then\r\n  begin\r\n    FEndTimeSizePanel := TTMSFNCPlannerSizeHandlerPanel.Create(Self);\r\n    FEndTimeSizePanel.Planner := Self;\r\n    FEndTimeSizePanel.Kind := pshpkEndTime;\r\n    FEndTimeSizeHandlerCreated := True;\r\n  end;\r\n\r\n  Result.Background := FEndTimeSizePanel;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.DateTimeToCell(\r\n  ADateTime: TDateTime; AEndDateTime: Boolean = False): TTMSFNCPlannerCell;\r\nvar\r\n  v: Double;\r\n  ch: Double;\r\nbegin\r\n  v := DateTimeToValue(ADateTime, AEndDatetime, False);\r\n  ch := GetTotalRowHeight;\r\n  Result.Row := 0;\r\n  if ch > 0 then\r\n    Result.Row := Round((RowCount / ch) * v);\r\n  Result.Col := DateTimeToPosition(ADateTime, AEndDatetime, False);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.DateTimeToPosition(ADateTime: TDateTime; AEndDateTime: Boolean = False; ACheckBounds: Boolean = True): Integer;\r\nbegin\r\n  Result := 0;\r\n  case GetDisplayMode of\r\n    pmMultiDay, pmMultiDayRes, pmMultiResDay:\r\n    begin\r\n      Result := DaysBetween(ADateTime, FDisplayStartTime);\r\n      if CompareDateTime(FDisplayStartTime, ADateTime) = GreaterThanValue then\r\n        Result := -Result;\r\n\r\n      if AEndDateTime and (CompareDateTime(ADateTime, IncDay(FDisplayStartTime, Result)) = EqualsValue) then\r\n        Result := Result - 1;\r\n\r\n      case GetDisplayMode of\r\n        pmMultiResDay: Result := Result * Max(1, Resources.Count);\r\n      end;\r\n    end;\r\n    pmMultiMonth:\r\n    begin\r\n      if AEndDateTime then\r\n        ADateTime := IncDay(ADateTime, -1);\r\n\r\n      Result := MonthOf(ADateTime) - MonthOf(FDisplayStartTime) + (12 * (YearOf(ADateTime) - YearOf(FDisplayStartTime)));\r\n    end;\r\n  end;\r\n\r\n  if ACheckBounds then\r\n    Result := Max(0, Min(Result, ColumnCount -1));\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.DateTimeToValue(ADateTime: TDateTime; AEndDateTime: Boolean = False; ACheckBounds: Boolean = True): Double;\r\nvar\r\n  st, et, str, etr: Double;\r\n  s: Double;\r\n  c: Double;\r\n  v: Double;\r\n  ps: Integer;\r\n  d: Integer;\r\n  crh: Double;\r\n\r\n  {$IFDEF LCLWEBLIB}\r\n  function BinarySearch(const Values: TTMSFNCPlannerDateTimes; const Item: TDateTime; out FoundIndex: Integer; Index, Count: Integer): Boolean;\r\n  var\r\n    L, H: Integer;\r\n    mid, cmp: Integer;\r\n  begin\r\n    if (Index < 0) or ((Index > Values.Count - 1) and (Count > 0))\r\n      or (Index + Count - 1 > Values.Count - 1) or (Count < 0)\r\n      or (Index + Count < 0) then\r\n      raise EArgumentOutOfRangeException.Create('Argument out of range');\r\n    if Count = 0 then\r\n    begin\r\n      FoundIndex := Index;\r\n      Exit(False);\r\n    end;\r\n\r\n    Result := False;\r\n    L := Index;\r\n    H := Index + Count - 1;\r\n    while L <= H do\r\n    begin\r\n      mid := L + (H - L) shr 1;\r\n      cmp := CompareDateTime(Values[mid], Item);\r\n      if cmp < 0 then\r\n        L := mid + 1\r\n      else\r\n      begin\r\n        H := mid - 1;\r\n        if cmp = 0 then\r\n          Result := True;\r\n      end;\r\n    end;\r\n    FoundIndex := L;\r\n  end;\r\n  {$ENDIF}\r\nbegin\r\n  Result := 0;\r\n  st := FDisplayStartTime;\r\n  et := FDisplayEndTime;\r\n  c := GetTotalRowHeight;\r\n  if GetDisplayMode = pmCustom then\r\n  begin\r\n    {$IFDEF LCLWEBLIB}\r\n    BinarySearch(FCustomDatesList, ADatetime, ps, 0, FCustomDatesList.Count);\r\n    {$ENDIF}\r\n    {$IFNDEF LCLWEBLIB}\r\n    FCustomDatesList.BinarySearch(ADatetime, ps);\r\n    {$ENDIF}\r\n    ps := ps - 1;\r\n    if ps = -1 then\r\n      ps := ps + 1;\r\n\r\n    if (ps >= 0) and (ps < FCustomDatesList.Count - 1) then\r\n    begin\r\n      str := FCustomDatesList[ps];\r\n      etr := FCustomDatesList[ps + 1];\r\n\r\n      crh := RowHeights[ps];\r\n      if ACheckBounds then\r\n        v := Max(st, Min(et, ADateTime))\r\n      else\r\n        v := ADateTime;\r\n\r\n      if (crh > 0) then\r\n        Result := RowPositions[ps] + (crh / (etr - str)) * (v - str);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case GetDisplayMode of\r\n      pmMultiDay, pmMultiResDay, pmMultiDayRes:\r\n      begin\r\n        ps := DateTimeToPosition(ADateTime, AEndDateTime);\r\n        if GetDisplayMode = pmMultiResDay then\r\n          ps := ps div Max(1, Resources.Count);\r\n\r\n        st := IncDay(st, ps);\r\n        et := IncDay(et, ps);\r\n      end;\r\n      pmMultiMonth:\r\n      begin\r\n        st := FDisplayStart;\r\n        et := FDisplayEnd;\r\n      end;\r\n    end;\r\n\r\n    case GetDisplayMode of\r\n      pmMultiMonth:\r\n      begin\r\n        if AEndDateTime then\r\n          d := DayOf(IncDay(ADateTime, -1)) + 1\r\n        else\r\n          d := DayOf(ADateTime);\r\n\r\n        if ACheckBounds then\r\n          v := Max(st, Min(et, d - 1 + Frac(ADateTime)))\r\n        else\r\n          v := d -1 + Frac(ADateTime);\r\n      end\r\n      else\r\n      begin\r\n        if ACheckBounds then\r\n          v := Max(st, Min(et, ADateTime))\r\n        else\r\n          v := ADateTime;\r\n      end;\r\n    end;\r\n\r\n    if (et - st) > 0 then\r\n    begin\r\n      s := c / (et - st);\r\n      Result := (v - st) * s;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleDblClick(X, Y: Single);\r\nvar\r\n  pf: TPointF;\r\n  c: TTMSFNCPlannerCacheItem;\r\nbegin\r\n  inherited;\r\n  FDblClicked := True;\r\n  pf := PointF(X, Y);\r\n  FDownItem := nil;\r\n  FDownCacheItemIdx := -1;\r\n  c := XYToCacheItem(pf.X, pf.Y);\r\n  if Assigned(c) then\r\n  begin\r\n    FDownItem := c.Item;\r\n    FDownCacheItemIdx := TTMSFNCPlannerItemOpen(FDownItem).CacheList.IndexOf(c);\r\n  end;\r\n\r\n  if Assigned(FDownItem) and FDownItem.Enabled and (Interaction.MouseEditMode = pmemDoubleClick) and not Interaction.ReadOnly then\r\n    HandleItemEditing(FDownItem, c);\r\nend;\r\n\r\ndestructor TTMSFNCCustomPlanner.Destroy;\r\nbegin\r\n  FActiveItem := nil;\r\n  if Assigned(FEditingBackground) then\r\n    FEditingBackground.Free;\r\n\r\n  FEditingBackground := nil;\r\n\r\n  if Assigned(FEditingDialog) then\r\n    FEditingDialog.Free;\r\n\r\n  FEditingDialog := nil;\r\n\r\n  if Assigned(FHintPanel) then\r\n    FHintPanel.Free;\r\n\r\n  FHintPanel := nil;\r\n\r\n  if Assigned(FStartTimeSizePanel) then\r\n    FStartTimeSizePanel.Free;\r\n\r\n  FStartTimeSizePanel := nil;\r\n\r\n  if Assigned(FEndTimeSizePanel) then\r\n    FEndTimeSizePanel.Free;\r\n\r\n  FEndTimeSizePanel := nil;\r\n\r\n  FAnimateTimer.Free;\r\n  FDownTimer.Free;\r\n  FItemsAppearance.Free;\r\n  FDefaultItem.Free;\r\n  FModeSettings.Free;\r\n  FTimeLine.Free;\r\n  FGridCellAppearance.Free;\r\n  FGroupsAppearance.Free;\r\n  FTimeLineAppearance.Free;\r\n  FInteraction.Free;\r\n  FPositions.Free;\r\n  FPositionsAppearance.Free;\r\n  FSelectionAppearance.Free;\r\n  FGroupsTopDisplay.Free;\r\n  FPositionsTopDisplay.Free;\r\n  FTimeLineLeftDisplay.Free;\r\n  FGroupsBottomDisplay.Free;\r\n  FPositionsBottomDisplay.Free;\r\n  FTimeLineRightDisplay.Free;\r\n  FCustomDatesList.Free;\r\n  FSelectedItems.Free;\r\n  FCustomDateTimes.Free;\r\n  FItemDisplay.Free;\r\n  FGridDisplay.Free;\r\n  FItemCache.Free;\r\n  FGridCache.Free;\r\n  FConflicts.Free;\r\n  FDisplayGroups.Free;\r\n  FGroupsTopCache.Free;\r\n  FPositionsTopCache.Free;\r\n  FTimeLineLeftCache.Free;\r\n  FGroupsBottomCache.Free;\r\n  FPositionsBottomCache.Free;\r\n  FTimeLineRightCache.Free;\r\n  inherited;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.SelectNextItem: TTMSFNCPlannerItem;\r\nvar\r\n  Idx: Integer;\r\n  s: Boolean;\r\nbegin\r\n  if FActiveItem <> nil then\r\n  begin\r\n    Idx := FActiveItem.Index;\r\n    while Idx + 1 < Items.Count do\r\n    begin\r\n      s := Items[Idx + 1].Selectable and Items[Idx + 1].Enabled;\r\n      DoBeforeSelectItem(Items[Idx + 1], s);\r\n      if (IsValidItem(Items[Idx + 1])) and s then\r\n      begin\r\n        if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n          HandleSelectLinkedItems(Items[idx + 1])\r\n        else\r\n          HandleSelectItem(Items[idx + 1]);\r\n\r\n        DoAfterSelectItem(Items[idx + 1]);\r\n        Break;\r\n      end\r\n      else\r\n        Inc(Idx);\r\n    end;\r\n\r\n    if (Idx + 1 = Items.Count) then\r\n      HandleSelectItem(nil);\r\n  end\r\n  else\r\n  begin\r\n    if (Items.Count > 0) then\r\n    begin\r\n      Idx := 0;\r\n      while Idx < Items.Count do\r\n      begin\r\n        s := Items[Idx].Selectable and Items[Idx].Enabled;\r\n        DoBeforeSelectItem(Items[Idx], s);\r\n        if (IsValidItem(Items[Idx])) and s then\r\n        begin\r\n          if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n            HandleSelectLinkedItems(Items[idx])\r\n          else\r\n            HandleSelectItem(Items[idx]);\r\n\r\n          DoAfterSelectItem(Items[idx]);\r\n          Break;\r\n        end\r\n        else\r\n          Inc(Idx);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := FActiveItem;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.SelectPreviousItem: TTMSFNCPlannerItem;\r\nvar\r\n  Idx: Integer;\r\n  s: Boolean;\r\nbegin\r\n  if FActiveItem <> nil then\r\n  begin\r\n    Idx := FActiveItem.Index;\r\n    while Idx > 0 do\r\n    begin\r\n      s := Items[Idx - 1].Selectable and Items[Idx - 1].Enabled;\r\n      DoBeforeSelectItem(Items[Idx - 1], s);\r\n      if IsValidItem(Items[Idx - 1]) and s then\r\n      begin\r\n        if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n          HandleSelectLinkedItems(Items[Idx - 1])\r\n        else\r\n          HandleSelectItem(Items[Idx - 1]);\r\n\r\n        DoAfterSelectItem(Items[Idx - 1]);\r\n        Break;\r\n      end\r\n      else\r\n        Dec(Idx);\r\n    end;\r\n\r\n    if (Idx <= 0) then\r\n      HandleSelectItem(nil);\r\n  end\r\n  else\r\n  begin\r\n    if Items.Count > 0 then\r\n    begin\r\n      Idx := Items.Count - 1;\r\n      while Idx >= 0 do\r\n      begin\r\n        s := Items[Idx].Selectable and Items[Idx].Enabled;\r\n        DoBeforeSelectItem(Items[Idx], s);\r\n        if (IsValidItem(Items[Idx])) and s then\r\n        begin\r\n          if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n            HandleSelectLinkedItems(Items[idx])\r\n          else\r\n            HandleSelectItem(Items[idx]);\r\n\r\n          DoAfterSelectItem(Items[idx]);\r\n          Break;\r\n        end\r\n        else\r\n          Dec(Idx);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := FActiveItem;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleDialogKey(var Key: Word; Shift: TShiftState);\r\nvar\r\n  it: TTMSFNCPlannerItem;\r\nbegin\r\n  if FInplaceEditorClosed then\r\n  begin\r\n    inherited;\r\n    Exit;\r\n  end;\r\n\r\n  if ((Key = KEY_ESCAPE) or (Key = KEY_TAB) or (Key = KEY_F2)) and Assigned(FInplaceEditor) and FInplaceEditorActive then\r\n  begin\r\n    FCloseWithDialogKey := True;\r\n    CloseInplaceEditor(Key = KEY_ESCAPE);\r\n  end;\r\n\r\n  if (Key = KEY_ESCAPE) and FEditorDialogActive then\r\n    CloseEditingDialog(True);\r\n\r\n  if (Key = KEY_RETURN) and FEditorDialogActive and Assigned(FTextMemo) and not FTextMemo.IsFocused then\r\n    CloseEditingDialog(False);\r\n\r\n  if (Key = KEY_TAB) and FInplaceEditorActive then\r\n  begin\r\n    Key := 0;\r\n    Exit;\r\n  end;\r\n\r\n  it := nil;\r\n\r\n  if (Key = KEY_TAB) and IsFocused then\r\n  begin\r\n    if ssShift in Shift then\r\n      it := SelectPreviousItem\r\n    else\r\n      it := SelectNextItem;\r\n  end;\r\n\r\n  if Assigned(it) then\r\n    Key := 0;\r\n\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DirtyItem(AItem: TTMSFNCPlannerItem);\r\nvar\r\n  rse, rsa: Integer;\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItemOpen;\r\n  svdirty: TTMSFNCPlannerIntegerList;\r\n  sta, ste: TDateTime;\r\n  mxa, mxe: TDateTime;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    it := TTMSFNCPlannerItemOpen(AItem);\r\n    case GetDisplayMode of\r\n      pmDay, pmDayPeriod, pmHalfDayPeriod, pmMonth, pmCustom:\r\n      begin\r\n        rsa := AItem.Resource;\r\n        rse := AItem.Resource;\r\n      end;\r\n      pmMultiDay, pmMultiMonth, pmMultiResDay, pmMultiDayRes:\r\n      begin\r\n        rsa := DateTimeToPosition(it.StartTime);\r\n        rse := DateTimeToPosition(it.EndTime, True);\r\n        case GetDisplayMode of\r\n          pmMultiMonth:\r\n          begin\r\n            if Abs(it.EndTime - it.StartTime) < 1 then\r\n              rse := DateTimeToPosition(it.EndTime);\r\n          end;\r\n          pmMultiResDay:\r\n          begin\r\n            rsa := rsa + AItem.Resource;\r\n            rse := rse + AItem.Resource;\r\n          end;\r\n          pmMultiDayRes:\r\n          begin\r\n            rsa := rsa + (AItem.Resource * Max(1, GetNumDays));\r\n            rse := rse + (AItem.Resource * Max(1, GetNumDays));\r\n          end;\r\n        end;\r\n      end;\r\n      else\r\n      begin\r\n        rsa := -1;\r\n        rse := -1;\r\n      end;\r\n    end;\r\n\r\n    svdirty := TTMSFNCPlannerIntegerList.Create;\r\n    for I := 0 to it.CacheList.Count - 1 do\r\n      svdirty.Add(it.CacheList[I].Position);\r\n\r\n    it.DirtyList.Clear;\r\n    for I := rsa to rse do\r\n    begin\r\n      if (((GetDisplayMode = pmMultiResDay) and (PositionToResource(I) = AItem.Resource)) or (GetDisplayMode <> pmMultiResDay)) then\r\n      begin\r\n        sta := MaxPositionDateTime(it.StartTime, False, I);\r\n        ste := MaxPositionDateTime(it.EndTime, True, I);\r\n        mxa := CalculatePositionDateTime(FDisplayStartTime, I);\r\n        mxe := CalculatePositionDateTime(FDisplayEndTime, I);\r\n        if (((CompareDateTime(sta, mxa) >= EqualsValue) and (CompareDateTime(sta, mxe) <= EqualsValue))\r\n          or ((CompareDateTime(ste, mxa) >= EqualsValue) and (CompareDateTime(ste, mxe) <= EqualsValue)))\r\n            and (ste - sta > 0) then\r\n              it.DirtyList.Add(I);\r\n      end;\r\n    end;\r\n\r\n    it.CleanupList.Clear;\r\n    for I := 0 to svdirty.Count - 1 do\r\n    begin\r\n      if not it.DirtyList.IndexOf(svdirty[I]) > -1 then\r\n        it.CleanupList.Add(svdirty[I]);\r\n    end;\r\n\r\n    it.OldPositionsList.Clear;\r\n    for I := 0 to it.PositionsList.Count - 1 do\r\n      it.OldPositionsList.Add(it.PositionsList[I]);\r\n    it.PositionsList.Clear;\r\n    for I := 0 to it.DirtyList.Count - 1 do\r\n      it.PositionsList.Add(it.DirtyList[I]);\r\n\r\n    svdirty.Free;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.DisplayEndDateTime: TDateTime;\r\nbegin\r\n  Result := CellToDateTime(MakeCell(ColumnCount - 1, RowCount));\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.DisplayStartDateTime: TDateTime;\r\nbegin\r\n  Result := CellToDateTime(MakeCell(0, 0));\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawArrow(AGraphics: TTMSFNCGraphics; ARect: TRectF;\r\n  AArrowKind: TTMSFNCPlannerArrowKind);\r\nvar\r\n  pth: TTMSFNCGraphicsPath;\r\n  s: Single;\r\nbegin\r\n  AGraphics.Fill.Kind := gfkSolid;\r\n  AGraphics.Stroke.Kind := gskSolid;\r\n  AGraphics.Fill.Color := gcGray;\r\n  AGraphics.Stroke.Color := gcGray;\r\n\r\n  s := 7;\r\n  pth := TTMSFNCGraphicsPath.Create;\r\n  case AArrowKind of\r\n    pakLeft:\r\n    begin\r\n      pth.MoveTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s));\r\n    end;\r\n    pakRight:\r\n    begin\r\n      pth.MoveTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s));\r\n    end;\r\n    pakUp:\r\n    begin\r\n      pth.MoveTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s));\r\n    end;\r\n    pakDown:\r\n    begin\r\n      pth.MoveTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s / 2, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2 + s));\r\n      pth.LineTo(PointF(ARect.Left + ((ARect.Right - ARect.Left) - s) / 2 + s, ARect.Top + ((ARect.Bottom - ARect.Top) - s) / 2));\r\n    end;\r\n  end;\r\n\r\n  pth.ClosePath;\r\n  AGraphics.DrawPath(pth);\r\n  pth.Free;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawBorders(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  rrt, rrb, trl, trr, grt, grb: TRectF;\r\nbegin\r\n  grt := GetGroupsTopRect;\r\n  grb := GetGroupsBottomRect;\r\n  rrt := GetPositionsTopRect;\r\n  rrb := GetPositionsBottomRect;\r\n  trl := GetTimeLineLeftRect;\r\n  trr := GetTimeLineRightRect;\r\n\r\n  {$IFDEF CMNLIB}\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      grt.Bottom := grt.Bottom - 1;\r\n      grb.Bottom := grb.Bottom - 1;\r\n      rrt.Bottom := rrt.Bottom - 1;\r\n      rrb.Bottom := rrb.Bottom - 1;\r\n      trl.Right := trl.Right - 1;\r\n      trr.Right := trr.Right - 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      grt.Right := grt.Right - 1;\r\n      grb.Right := grb.Right - 1;\r\n      rrt.Right := rrt.Right - 1;\r\n      rrb.Right := rrb.Right - 1;\r\n      trl.Bottom := trl.Bottom - 1;\r\n      trr.Bottom := trr.Bottom - 1;\r\n    end;\r\n  end;\r\n  {$ENDIF}\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      AGraphics.Stroke.Assign(PositionsAppearance.TopStroke);\r\n      if (pplTop in PositionsAppearance.Layouts) and (PositionsAppearance.TopSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(rrt.Left, rrt.Top), PointF(rrt.Right, rrt.Top));\r\n        AGraphics.DrawLine(PointF(rrt.Left, rrt.Bottom), PointF(rrt.Right, rrt.Bottom), gcpmRightUp, gcpmRightUp);\r\n      end\r\n      else if not (pglTop in GroupsAppearance.Layouts) or (GroupsAppearance.TopSize <= 0) or (FDisplayGroups.Count = 0) then\r\n        AGraphics.DrawLine(PointF(rrt.Right, rrt.Top), PointF(rrt.Right, rrt.Bottom), gcpmRightDown, gcpmRightUp);\r\n\r\n      AGraphics.Stroke.Assign(PositionsAppearance.BottomStroke);\r\n      if (pplBottom in PositionsAppearance.Layouts) and (PositionsAppearance.BottomSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(rrb.Left, rrb.Top), PointF(rrb.Right, rrb.Top), gcpmLeftDown, gcpmLeftDown);\r\n        AGraphics.DrawLine(PointF(rrb.Left, rrb.Bottom), PointF(rrb.Right, rrb.Bottom), gcpmLeftUp, gcpmLeftUp);\r\n      end\r\n      else if not (pglBottom in GroupsAppearance.Layouts) or (GroupsAppearance.BottomSize <= 0) or (FDisplayGroups.Count = 0) then\r\n        AGraphics.DrawLine(PointF(rrb.Left, rrb.Top), PointF(rrb.Left, rrb.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n\r\n      AGraphics.Stroke.Assign(GroupsAppearance.TopStroke);\r\n      if (pglTop in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (GroupsAppearance.TopSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(grt.Left, grt.Top), PointF(grt.Right, grt.Top));\r\n        AGraphics.DrawLine(PointF(grt.Left, grt.Bottom), PointF(grt.Right, grt.Bottom), gcpmRightUp, gcpmRightUp);\r\n      end;\r\n\r\n      if not (pplTop in PositionsAppearance.Layouts) or (PositionsAppearance.TopSize <= 0) then\r\n        AGraphics.DrawLine(PointF(grt.Right, grt.Top), PointF(grt.Right, grt.Bottom), gcpmRightDown, gcpmRightUp);\r\n\r\n      AGraphics.Stroke.Assign(GroupsAppearance.BottomStroke);\r\n      if (pglBottom in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (GroupsAppearance.BottomSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(grb.Left, grb.Top), PointF(grb.Right, grb.Top), gcpmLeftDown, gcpmLeftDown);\r\n        AGraphics.DrawLine(PointF(grb.Left, grb.Bottom), PointF(grb.Right, grb.Bottom), gcpmLeftUp, gcpmLeftUp);\r\n      end;\r\n\r\n      if not (pplBottom in PositionsAppearance.Layouts) or (PositionsAppearance.BottomSize <= 0) then\r\n        AGraphics.DrawLine(PointF(grb.Left, grb.Top), PointF(grb.Left, grb.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.LeftStroke);\r\n      if (ptlLeft in TimeLineAppearance.Layouts) and (TimeLineAppearance.LeftSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(trl.Left, trl.Top), PointF(trl.Left, trl.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(trl.Right, trl.Top), PointF(trl.Right, trl.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end\r\n      else\r\n        AGraphics.DrawLine(PointF(trl.Left, trl.Bottom), PointF(trl.Right, trl.Bottom), gcpmRightDown, gcpmLeftDown);\r\n\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.RightStroke);\r\n      if (ptlRight in TimeLineAppearance.Layouts) and (TimeLineAppearance.RightSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(trr.Left, trr.Top), PointF(trr.Left, trr.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(trr.Right, trr.Top), PointF(trr.Right, trr.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end\r\n      else\r\n        AGraphics.DrawLine(PointF(trr.Left, trr.Top), PointF(trr.Right, trr.Top), gcpmRightUp, gcpmLeftUp);\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.LeftStroke);\r\n      if (ptlLeft in TimeLineAppearance.Layouts) and (TimeLineAppearance.LeftSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(trl.Left, trl.Top), PointF(trl.Right, trl.Top));\r\n        AGraphics.DrawLine(PointF(trl.Left, trl.Bottom), PointF(trl.Right, trl.Bottom), gcpmRightUp, gcpmRightUp);\r\n      end\r\n      else\r\n        AGraphics.DrawLine(PointF(trl.Right, trl.Top), PointF(trl.Right, trl.Bottom), gcpmRightDown, gcpmRightUp);\r\n\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.RightStroke);\r\n      if (ptlRight in TimeLineAppearance.Layouts) and (TimeLineAppearance.RightSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(trr.Left, trr.Top), PointF(trr.Right, trr.Top), gcpmLeftDown, gcpmLeftDown);\r\n        AGraphics.DrawLine(PointF(trr.Left, trr.Bottom), PointF(trr.Right, trr.Bottom), gcpmLeftUp, gcpmLeftUp);\r\n      end\r\n      else\r\n        AGraphics.DrawLine(PointF(trr.Left, trr.Top), PointF(trr.Left, trr.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n\r\n      AGraphics.Stroke.Assign(PositionsAppearance.TopStroke);\r\n      if (pplTop in PositionsAppearance.Layouts) and (PositionsAppearance.TopSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(rrt.Left, rrt.Top), PointF(rrt.Left, rrt.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(rrt.Right, rrt.Top), PointF(rrt.Right, rrt.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end\r\n      else if not (pglTop in GroupsAppearance.Layouts) or (GroupsAppearance.TopSize <= 0) or (FDisplayGroups.Count = 0) then\r\n        AGraphics.DrawLine(PointF(rrt.Left, rrt.Bottom), PointF(rrt.Right, rrt.Bottom), gcpmRightDown, gcpmLeftDown);\r\n\r\n      AGraphics.Stroke.Assign(PositionsAppearance.BottomStroke);\r\n      if (pplBottom in PositionsAppearance.Layouts) and (PositionsAppearance.Bottomsize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(rrb.Left, rrb.Top), PointF(rrb.Left, rrb.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(rrb.Right, rrb.Top), PointF(rrb.Right, rrb.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end\r\n      else if not (pglBottom in GroupsAppearance.Layouts) or (GroupsAppearance.BottomSize <= 0) or (FDisplayGroups.Count = 0) then\r\n        AGraphics.DrawLine(PointF(rrb.Left, rrb.Top), PointF(rrb.Right, rrb.Top), gcpmRightUp, gcpmLeftUp);\r\n\r\n      AGraphics.Stroke.Assign(GroupsAppearance.TopStroke);\r\n      if (pglTop in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (GroupsAppearance.TopSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(grt.Left, grt.Top), PointF(grt.Left, grt.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(grt.Right, grt.Top), PointF(grt.Right, grt.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end;\r\n\r\n      if not (pplTop in PositionsAppearance.Layouts) or (PositionsAppearance.TopSize <= 0) then\r\n        AGraphics.DrawLine(PointF(grt.Left, grt.Bottom), PointF(grt.Right, grt.Bottom), gcpmRightDown, gcpmLeftDown);\r\n\r\n      AGraphics.Stroke.Assign(GroupsAppearance.BottomStroke);\r\n      if (pglBottom in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (GroupsAppearance.BottomSize > 0) then\r\n      begin\r\n        AGraphics.DrawLine(PointF(grb.Left, grb.Top), PointF(grb.Left, grb.Bottom), gcpmRightDown, gcpmRightUp);\r\n        AGraphics.DrawLine(PointF(grb.Right, grb.Top), PointF(grb.Right, grb.Bottom), gcpmLeftDown, gcpmLeftUp);\r\n      end;\r\n\r\n      if not (pplBottom in PositionsAppearance.Layouts) or (PositionsAppearance.BottomSize <= 0) then\r\n        AGraphics.DrawLine(PointF(grb.Left, grb.Top), PointF(grb.Right, grb.Top), gcpmRightUp, gcpmLeftUp);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawDisplay(AGraphics: TTMSFNCGraphics; ADisplay: TTMSFNCPlannerDisplayList);\r\nvar\r\n  I: Integer;\r\n  {$IFDEF WEBLIB}\r\n  bmp: TTMSFNCBitmap;\r\n  {$ENDIF}\r\n  {$IFNDEF WEBLIB}\r\n  bmp: TBitmap;\r\n  {$ENDIF}\r\n  cache: TTMSFNCPlannerCacheItem;\r\n  st: TTMSFNCGraphicsSaveState;\r\n  r: TRectF;\r\nbegin\r\n  if ADisplay.Count = 0 then\r\n    Exit;\r\n\r\n  st := AGraphics.SaveState;\r\n  if (ADisplay is TTMSFNCPlannerGridDisplayList) or (ADisplay is TTMSFNCPlannerItemDisplayList) then\r\n  begin\r\n    r := GetContentClipRect;\r\n    {$IFDEF CMNLIB}\r\n    r.Bottom := r.Bottom - 1;\r\n    {$ENDIF}\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerGroupsTopDisplayList then\r\n  begin\r\n    r := GetGroupsTopRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Right := r.Right + 1;\r\n      pomVertical: r.Bottom := r.Bottom + 1;\r\n    end;\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerGroupsBottomDisplayList then\r\n  begin\r\n    r := GetGroupsBottomRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Left := r.Left - 1;\r\n      pomVertical: r.Top := r.Top - 1;\r\n    end;\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerPositionsTopDisplayList then\r\n  begin\r\n    r := GetPositionsTopRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Right := r.Right + 1;\r\n      pomVertical: r.Bottom := r.Bottom + 1;\r\n    end;\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerPositionsBottomDisplayList then\r\n  begin\r\n    r := GetPositionsBottomRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Left := r.Left - 1;\r\n      pomVertical: r.Top := r.Top - 1;\r\n    end;\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerTimeLineLeftDisplayList then\r\n  begin\r\n    r := GetTimeLineLeftRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Bottom := r.Bottom + 1;\r\n      pomVertical: r.Right := r.Right + 1;\r\n    end;\r\n  end\r\n  else if ADisplay is TTMSFNCPlannerTimeLineRightDisplayList then\r\n  begin\r\n    r := GetTimeLineRightRect;\r\n    case OrientationMode of\r\n      pomHorizontal: r.Top := r.Top - 1;\r\n      pomVertical: r.Left := r.Left - 1;\r\n    end;\r\n  end;\r\n\r\n  AGraphics.ClipRect(r);\r\n\r\n  for I := 0 to ADisplay.Count - 1 do\r\n  begin\r\n    cache := ADisplay[I];\r\n    {$IFDEF WEBLIB}\r\n    bmp := TTMSFNCBitmap(cache.Bitmap);\r\n    {$ENDIF}\r\n    {$IFNDEF WEBLIB}\r\n    bmp := cache.Bitmap;\r\n    {$ENDIF}\r\n    if Assigned(bmp) then\r\n      AGraphics.DrawBitmap(cache.DrawRect, bmp)\r\n    else if ADisplay is TTMSFNCPlannerItemDisplayList then\r\n      DrawItem(AGraphics, cache.DrawRect, cache.Item, cache.Idx)\r\n    else if ADisplay is TTMSFNCPlannerGridDisplayList then\r\n      DrawCell(AGraphics, cache.DrawRect, cache.Col, cache.Row, cache.StartTime, cache.EndTime, cache.Position, cache.Kind)\r\n    else if ADisplay is TTMSFNCPlannerPositionsDisplayList then\r\n      DrawPosition(AGraphics, cache.DrawRect, cache.Position, cache.Kind)\r\n    else if ADisplay is TTMSFNCPlannerGroupsDisplayList then\r\n      DrawGroup(AGraphics, cache.DrawRect, cache.Group, cache.StartPosition, cache.EndPosition, cache.Kind)\r\n    else if ADisplay is TTMSFNCPlannerTimeLineDisplayList then\r\n      DrawTime(AGraphics, cache.DrawRect, cache.Value, cache.Row, cache.Kind);\r\n  end;\r\n\r\n  if ADisplay is TTMSFNCPlannerItemDisplayList then\r\n    DrawItemLinks(AGraphics);\r\n\r\n  if ADisplay is TTMSFNCPlannerTimeLineDisplayList then\r\n    DrawCurrentTimeInTimeLine(AGraphics, ADisplay is TTMSFNCPlannerTimeLineLeftDisplayList);\r\n\r\n  AGraphics.RestoreState(st);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawEmptySpaces(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  r: TRectF;\r\n  b, df: Boolean;\r\n  rm: TTMSFNCGraphicsModifyRectMode;\r\nbegin\r\n  if PositionsAppearance.FillEmptySpaces then\r\n  begin\r\n    //position top left\r\n    if (pplTop in PositionsAppearance.Layouts) and (PositionsAppearance.TopSize > 0) then\r\n    begin\r\n      r := GetPositionTopLeftEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      r.Right := r.Right + 1;\r\n      r.Bottom := r.Bottom + 1;\r\n      {$ENDIF}\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(PositionsAppearance.TopFill);\r\n      AGraphics.Stroke.Assign(PositionsAppearance.TopStroke);\r\n\r\n      DoBeforeDrawPositionEmptySpace(AGraphics, r, ppesTopLeft, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, gcrmShiftRightDown);\r\n\r\n        DoAfterDrawPositionEmptySpace(AGraphics, r, ppesTopLeft);\r\n      end;\r\n\r\n      //position top right\r\n      r := GetPositionTopRightEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Right := r.Right + 1;\r\n          r.Bottom := r.Bottom + 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      case OrientationMode of\r\n        pomHorizontal: rm := gcrmShiftRightUp;\r\n        pomVertical: rm := gcrmShiftDownAndExpandWidth;\r\n        else\r\n          rm := gcrmNone;\r\n      end;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(PositionsAppearance.TopFill);\r\n      AGraphics.Stroke.Assign(PositionsAppearance.TopStroke);\r\n\r\n      DoBeforeDrawPositionEmptySpace(AGraphics, r, ppesTopRight, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawPositionEmptySpace(AGraphics, r, ppesTopRight);\r\n      end;\r\n    end;\r\n\r\n    if (pplBottom in PositionsAppearance.Layouts) and (PositionsAppearance.BottomSize > 0) then\r\n    begin\r\n      //position bottom left\r\n      r := GetPositionBottomLeftEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Bottom := r.Bottom + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      case OrientationMode of\r\n        pomHorizontal: rm := gcrmShiftLeftDown;\r\n        pomVertical: rm := gcrmShiftRightUp;\r\n        else\r\n          rm := gcrmNone;\r\n      end;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(PositionsAppearance.BottomFill);\r\n      AGraphics.Stroke.Assign(PositionsAppearance.BottomStroke);\r\n\r\n      DoBeforeDrawPositionEmptySpace(AGraphics, r, ppesBottomLeft, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawPositionEmptySpace(AGraphics, r, ppesBottomLeft);\r\n      end;\r\n\r\n      //position bottom right\r\n      r := GetPositionBottomRightEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      case OrientationMode of\r\n        pomHorizontal: rm := gcrmShiftLeftUp;\r\n        pomVertical: rm := gcrmShiftUpAndExpandWidth;\r\n        else\r\n          rm := gcrmNone;\r\n      end;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(PositionsAppearance.BottomFill);\r\n      AGraphics.Stroke.Assign(PositionsAppearance.BottomStroke);\r\n\r\n      DoBeforeDrawPositionEmptySpace(AGraphics, r, ppesBottomRight, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawPositionEmptySpace(AGraphics, r, ppesBottomRight);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if GroupsAppearance.FillEmptySpaces then\r\n  begin\r\n    if (pglTop in GroupsAppearance.Layouts) and (GroupsAppearance.TopSize > 0) then\r\n    begin\r\n      //Group top left\r\n      r := GetGroupTopLeftEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      r.Right := r.Right + 1;\r\n      r.Bottom := r.Bottom + 1;\r\n      {$ENDIF}\r\n      rm := gcrmShiftRightDown;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(GroupsAppearance.TopFill);\r\n      AGraphics.Stroke.Assign(GroupsAppearance.TopStroke);\r\n\r\n      DoBeforeDrawGroupEmptySpace(AGraphics, r, pgesTopLeft, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawGroupEmptySpace(AGraphics, r, pgesTopLeft);\r\n      end;\r\n\r\n      //Group top right\r\n      r := GetGroupTopRightEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Bottom := r.Bottom + 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      case OrientationMode of\r\n        pomHorizontal:rm := gcrmShiftRightUp;\r\n        pomVertical: rm := gcrmShiftLeftDown;\r\n        else\r\n          rm := gcrmNone;\r\n      end;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(GroupsAppearance.TopFill);\r\n      AGraphics.Stroke.Assign(GroupsAppearance.TopStroke);\r\n\r\n      DoBeforeDrawGroupEmptySpace(AGraphics, r, pgesTopRight, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawGroupEmptySpace(AGraphics, r, pgesTopRight);\r\n      end;\r\n    end;\r\n\r\n    if (pglBottom in GroupsAppearance.Layouts) and (GroupsAppearance.BottomSize > 0) then\r\n    begin\r\n      //Group bottom left\r\n      r := GetGroupBottomLeftEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Bottom := r.Bottom + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      case OrientationMode of\r\n        pomHorizontal: rm := gcrmShiftLeftDown;\r\n        pomVertical: rm := gcrmShiftRightUp;\r\n        else\r\n          rm := gcrmNone;\r\n      end;\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(GroupsAppearance.BottomFill);\r\n      AGraphics.Stroke.Assign(GroupsAppearance.BottomStroke);\r\n\r\n      DoBeforeDrawGroupEmptySpace(AGraphics, r, pgesBottomLeft, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, rm);\r\n\r\n        DoAfterDrawGroupEmptySpace(AGraphics, r, pgesBottomLeft);\r\n      end;\r\n\r\n      //Group bottom right\r\n      r := GetGroupBottomRightEmptyRect;\r\n      {$IFDEF CMNLIB}\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          r.Left := r.Left - 1;\r\n          r.Right := r.Right + 1;\r\n          r.Top := r.Top - 1;\r\n        end;\r\n      end;\r\n      {$ENDIF}\r\n      b := True;\r\n      df := True;\r\n\r\n      AGraphics.Fill.Assign(GroupsAppearance.BottomFill);\r\n      AGraphics.Stroke.Assign(GroupsAppearance.BottomStroke);\r\n\r\n      DoBeforeDrawGroupEmptySpace(AGraphics, r, pgesBottomRight, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(r, gcrmShiftLeftUp);\r\n\r\n        DoAfterDrawGroupEmptySpace(AGraphics, r, pgesBottomRight);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawGrid(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  DrawDisplay(AGraphics, FGridDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawGroup(AGraphics: TTMSFNCGraphics; ARect: TRectF; AGroup: Integer; AStartPosition, AEndPosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nvar\r\n  b, df: Boolean;\r\n  str: String;\r\n  txtr: TRectF;\r\nbegin\r\n  case AKind of\r\n    ikGroupTop:\r\n    begin\r\n      AGraphics.Stroke.Assign(GroupsAppearance.TopStroke);\r\n      AGraphics.Fill.Assign(GroupsAppearance.TopFill);\r\n    end;\r\n    ikGroupBottom:\r\n    begin\r\n      AGraphics.Stroke.Assign(GroupsAppearance.BottomStroke);\r\n      AGraphics.Fill.Assign(GroupsAppearance.BottomFill);\r\n    end;\r\n  end;\r\n\r\n  FixStroke(AGraphics);\r\n\r\n  b := True;\r\n  df := True;\r\n  DoBeforeDrawGroup(AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind, b, df);\r\n\r\n  if b then\r\n  begin\r\n    if df then\r\n      AGraphics.DrawRectangle(ARect, gcrmNone);\r\n\r\n    case AKind of\r\n      ikGroupTop: AGraphics.Font.Assign(GroupsAppearance.TopFont);\r\n      ikGroupBottom: AGraphics.Font.Assign(GroupsAppearance.BottomFont);\r\n    end;\r\n\r\n    txtr := ARect;\r\n    InflateRectEx(txtr, -2, -2);\r\n\r\n    str := GetGroupText(AGroup);\r\n    DoGetGroupText(AGroup, AKind, str);\r\n    b := True;\r\n    DoBeforeDrawGroupText(AGraphics, txtr, AGroup, AStartPosition, AEndPosition, AKind, str, b);\r\n    if b then\r\n    begin\r\n      case AKind of\r\n        ikGroupTop:\r\n        begin\r\n          case GroupsAppearance.TopVerticalTextMode of\r\n            pvtmAuto:\r\n            begin\r\n              case OrientationMode of\r\n                pomHorizontal: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign, gttNone, -90);\r\n                pomVertical: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign);\r\n              end;\r\n            end;\r\n            pvtmAlways: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign, gttNone, -90);\r\n            pvtmNone: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign);\r\n          end;\r\n        end;\r\n        ikGroupBottom:\r\n        begin\r\n          case GroupsAppearance.BottomVerticalTextMode of\r\n            pvtmAuto:\r\n            begin\r\n              case OrientationMode of\r\n                pomHorizontal: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign, gttNone, 90);\r\n                pomVertical: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign);\r\n              end;\r\n            end;\r\n            pvtmAlways: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign, gttNone, 90);\r\n            pvtmNone: AGraphics.DrawText(txtr, str, False, GroupsAppearance.TopHorizontalTextAlign, GroupsAppearance.TopVerticalTextAlign);\r\n          end;\r\n        end;\r\n      end;\r\n      DoAfterDrawGroupText(AGraphics, txtr, AGroup, AStartPosition, AEndPosition, AKind, str);\r\n    end;\r\n\r\n    DoAfterDrawGroup(AGraphics, ARect, AGroup, AStartPosition, AEndPosition, AKind);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawGroups(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  DrawDisplay(AGraphics, FGroupsTopDisplay);\r\n  DrawDisplay(AGraphics, FGroupsBottomDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawItem(AGraphics: TTMSFNCGraphics; ARect: TRectF; AItem: TTMSFNCPlannerItem; ACacheIndex: Integer; ACaching: Boolean = False);\r\nvar\r\n  str, strt: String;\r\n  b, df: Boolean;\r\n  txtr, txtrt: TRectF;\r\n  th: Double;\r\n  mr: TRectF;\r\n  sr: TRectF;\r\n  sz: Double;\r\n  bm, dfm, d: Boolean;\r\n  itha, itva, ithat, itvat: TTMSFNCGraphicsTextAlign;\r\nbegin\r\n  if not Assigned(AItem) then\r\n    Exit;\r\n\r\n  if AItem.Enabled then\r\n  begin\r\n    if FSelectedItems.IndexOf(AItem) > -1 then\r\n    begin\r\n      if AItem = FActiveItem then\r\n      begin\r\n        AGraphics.Fill.Assign(ItemsAppearance.ActiveFill);\r\n        AGraphics.Fill.Color := AItem.ActiveColor;\r\n        AGraphics.Stroke.Assign(ItemsAppearance.ActiveStroke);\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Fill.Assign(ItemsAppearance.SelectedFill);\r\n        AGraphics.Fill.Color := AItem.SelectedColor;\r\n        AGraphics.Stroke.Assign(ItemsAppearance.SelectedStroke);\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      AGraphics.Fill.Assign(ItemsAppearance.Fill);\r\n      AGraphics.Fill.Color := AItem.Color;\r\n      AGraphics.Stroke.Assign(ItemsAppearance.Stroke);\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    AGraphics.Fill.Assign(ItemsAppearance.DisabledFill);\r\n    AGraphics.Fill.Color := AItem.DisabledColor;\r\n    AGraphics.Stroke.Assign(ItemsAppearance.DisabledStroke);\r\n  end;\r\n\r\n  FixStroke(AGraphics);\r\n\r\n  df := True;\r\n  b := True;\r\n  DoBeforeDrawItem(AGraphics, ARect, AItem, b, df);\r\n\r\n  if b then\r\n  begin\r\n    if df then\r\n    begin\r\n      AGraphics.DrawRectangle(ARect, gcrmNone);\r\n\r\n      if AItem = FActiveItem then\r\n      begin\r\n        if AItem.Movable and ItemsAppearance.ShowMoveArea and AllowDesktopMove and not Interaction.ReadOnly then\r\n        begin\r\n          AGraphics.Fill.Color := ItemsAppearance.MoveAreaColor;\r\n          AGraphics.Stroke.Color := ItemsAppearance.MoveAreaColor;\r\n          AGraphics.Fill.Kind := gfkSolid;\r\n          AGraphics.Stroke.Kind := gskSolid;\r\n          sz := ItemsAppearance.MoveAreaSize;\r\n          case OrientationMode of\r\n            pomHorizontal:\r\n            begin\r\n              mr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n              ARect.Top := mr.Bottom + 1;\r\n            end;\r\n            pomVertical:\r\n            begin\r\n              mr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n              ARect.Left := mr.Right + 1;\r\n            end;\r\n          end;\r\n\r\n          bm := True;\r\n          dfm := True;\r\n          DoBeforeDrawMoveArea(AGraphics, mr, AItem, bm, dfm);\r\n          if bm then\r\n          begin\r\n            if dfm then\r\n              AGraphics.DrawRectangle(mr, gcrmNone);\r\n\r\n            DoAfterDrawMoveArea(AGraphics, mr, AItem);\r\n          end;\r\n        end;\r\n\r\n        if ACacheIndex = 0 then\r\n        begin\r\n          if AItem.Sizeable and ItemsAppearance.ShowSizeArea and AllowDesktopSize and not Interaction.ReadOnly then\r\n          begin\r\n            AGraphics.Fill.Color := ItemsAppearance.SizeAreaColor;\r\n            AGraphics.Stroke.Color := ItemsAppearance.SizeAreaColor;\r\n            AGraphics.Fill.Kind := gfkSolid;\r\n            AGraphics.Stroke.Kind := gskSolid;\r\n            sz := ItemsAppearance.SizeAreaSize;\r\n            case OrientationMode of\r\n              pomHorizontal:\r\n              begin\r\n                sr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n                ARect.Left := sr.Right + 1;\r\n              end;\r\n              pomVertical:\r\n              begin\r\n                sr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n                ARect.Top := sr.Bottom + 1;\r\n              end;\r\n            end;\r\n\r\n            bm := True;\r\n            dfm := True;\r\n            DoBeforeDrawSizeArea(AGraphics, sr, AItem, bm, dfm);\r\n            if bm then\r\n            begin\r\n              if dfm then\r\n                AGraphics.DrawRectangle(sr, gcrmNone);\r\n\r\n              DoAfterDrawSizeArea(AGraphics, sr, AItem);\r\n            end;\r\n          end;\r\n        end;\r\n\r\n        if ((ACacheIndex = TTMSFNCPlannerItemOpen(AItem).PositionsList.Count - 1) and ACaching)\r\n          or ((ACacheIndex = TTMSFNCPlannerItemOpen(AItem).CacheList.Count - 1) and not ACaching) then\r\n        begin\r\n          if AItem.Sizeable and ItemsAppearance.ShowSizeArea and AllowDesktopSize and not Interaction.ReadOnly then\r\n          begin\r\n            AGraphics.Fill.Color := ItemsAppearance.SizeAreaColor;\r\n            AGraphics.Stroke.Color := ItemsAppearance.SizeAreaColor;\r\n            AGraphics.Fill.Kind := gfkSolid;\r\n            AGraphics.Stroke.Kind := gskSolid;\r\n            sz := ItemsAppearance.SizeAreaSize;\r\n            case OrientationMode of\r\n              pomHorizontal:\r\n              begin\r\n                sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Bottom);\r\n                ARect.Right := sr.Left - 1;\r\n              end;\r\n              pomVertical:\r\n              begin\r\n                sr := RectF(ARect.Left, ARect.Bottom - sz, ARect.Right, ARect.Bottom);\r\n                ARect.Bottom := sr.Top - 1;\r\n              end;\r\n            end;\r\n\r\n            bm := True;\r\n            dfm := True;\r\n            DoBeforeDrawSizeArea(AGraphics, sr, AItem, bm, dfm);\r\n            if bm then\r\n            begin\r\n              if dfm then\r\n                AGraphics.DrawRectangle(sr, gcrmNone);\r\n\r\n              DoAfterDrawSizeArea(AGraphics, sr, AItem);\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    strt := AItem.Title;\r\n    DoGetItemTitleText(AItem, pgtmDrawing, strt);\r\n    th := 0;\r\n    if (strt <> '') and AItem.ShowTitle then\r\n    begin\r\n      if AItem.Enabled then\r\n      begin\r\n        if FSelectedItems.IndexOf(AItem) > -1 then\r\n        begin\r\n          if AItem = FActiveItem then\r\n          begin\r\n            AGraphics.Font.Assign(ItemsAppearance.ActiveTitleFont);\r\n            if not AItem.UseDefaultAppearance then\r\n            begin\r\n              if AItem.ActiveTitleFontName <> '' then              \r\n                AGraphics.Font.Name := AItem.ActiveTitleFontName;\r\n\r\n              {$IFDEF FMXLIB}\r\n              if AItem.ActiveTitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := AItem.ActiveTitleFontSize;\r\n              {$ENDIF}\r\n              {$IFDEF CMNWEBLIB}\r\n              if AItem.ActiveTitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := Round(AItem.ActiveTitleFontSize);\r\n              {$ENDIF}\r\n\r\n              AGraphics.Font.Style := AItem.ActiveTitleFontStyle;\r\n            end;            \r\n          end\r\n          else\r\n          begin\r\n            AGraphics.Font.Assign(ItemsAppearance.SelectedTitleFont);\r\n            if not AItem.UseDefaultAppearance then\r\n            begin\r\n              if AItem.SelectedTitleFontName <> '' then              \r\n                AGraphics.Font.Name := AItem.SelectedTitleFontName;\r\n\r\n              {$IFDEF FMXLIB}\r\n              if AItem.SelectedTitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := AItem.SelectedTitleFontSize;\r\n              {$ENDIF}\r\n              {$IFDEF CMNWEBLIB}\r\n              if AItem.SelectedTitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := Round(AItem.SelectedTitleFontSize);\r\n              {$ENDIF}\r\n\r\n              AGraphics.Font.Style := AItem.SelectedTitleFontStyle;\r\n            end;              \r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          AGraphics.Font.Assign(ItemsAppearance.TitleFont);\r\n          if not AItem.UseDefaultAppearance then\r\n          begin\r\n            if AItem.TitleFontName <> '' then              \r\n              AGraphics.Font.Name := AItem.TitleFontName;\r\n\r\n            {$IFDEF FMXLIB}\r\n            if AItem.TitleFontSize <>  -1 then\r\n              AGraphics.Font.Size := AItem.TitleFontSize;\r\n            {$ENDIF}\r\n            {$IFDEF CMNWEBLIB}\r\n            if AItem.TitleFontSize <>  -1 then\r\n              AGraphics.Font.Size := Round(AItem.TitleFontSize);\r\n            {$ENDIF}\r\n\r\n            AGraphics.Font.Style := AItem.TitleFontStyle;\r\n          end;            \r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Font.Assign(ItemsAppearance.DisabledTitleFont);\r\n        if not AItem.UseDefaultAppearance then\r\n        begin\r\n          if AItem.DisabledTitleFontName <> '' then              \r\n            AGraphics.Font.Name := AItem.DisabledTitleFontName;\r\n\r\n          {$IFDEF FMXLIB}\r\n          if AItem.DisabledTitleFontSize <>  -1 then\r\n            AGraphics.Font.Size := AItem.DisabledTitleFontSize;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          if AItem.DisabledTitleFontSize <>  -1 then\r\n            AGraphics.Font.Size := Round(AItem.DisabledTitleFontSize);\r\n          {$ENDIF}\r\n\r\n          AGraphics.Font.Style := AItem.DisabledTitleFontStyle;\r\n        end;          \r\n      end;\r\n\r\n      th := Min(AGraphics.CalculateTextHeight(strt) + 5, ARect.Bottom - ARect.Top);\r\n    end;\r\n\r\n    if AItem.Enabled then\r\n    begin\r\n      if FSelectedItems.IndexOf(AItem) > -1 then\r\n      begin\r\n        if AItem = FActiveItem then\r\n        begin\r\n          AGraphics.Font.Assign(ItemsAppearance.ActiveFont);\r\n          if not AItem.UseDefaultAppearance then\r\n          begin\r\n            if AItem.ActiveFontName <> '' then              \r\n              AGraphics.Font.Name := AItem.ActiveFontName;\r\n\r\n            {$IFDEF FMXLIB}\r\n            if AItem.ActiveFontSize <>  -1 then\r\n              AGraphics.Font.Size := AItem.ActiveFontSize;\r\n            {$ENDIF}\r\n            {$IFDEF CMNWEBLIB}\r\n            if AItem.ActiveFontSize <>  -1 then\r\n              AGraphics.Font.Size := Round(AItem.ActiveFontSize);\r\n            {$ENDIF}\r\n\r\n            AGraphics.Font.Style := AItem.ActiveFontStyle;\r\n            AGraphics.Font.Color := AItem.ActiveFontColor;\r\n          end;  \r\n        end\r\n        else\r\n        begin\r\n          AGraphics.Font.Assign(ItemsAppearance.SelectedFont);          \r\n          if not AItem.UseDefaultAppearance then\r\n          begin\r\n            if AItem.SelectedFontName <> '' then              \r\n              AGraphics.Font.Name := AItem.SelectedFontName;\r\n\r\n            {$IFDEF FMXLIB}\r\n            if AItem.SelectedFontSize <>  -1 then\r\n              AGraphics.Font.Size := AItem.SelectedFontSize;\r\n            {$ENDIF}\r\n            {$IFDEF CMNWEBLIB}\r\n            if AItem.SelectedFontSize <>  -1 then\r\n              AGraphics.Font.Size := Round(AItem.SelectedFontSize);\r\n            {$ENDIF}\r\n\r\n            AGraphics.Font.Style := AItem.SelectedFontStyle;\r\n            AGraphics.Font.Color := AItem.SelectedFontColor;\r\n          end;  \r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Font.Assign(ItemsAppearance.Font);\r\n        if not AItem.UseDefaultAppearance then\r\n        begin\r\n          if AItem.FontName <> '' then              \r\n            AGraphics.Font.Name := AItem.FontName;\r\n\r\n          {$IFDEF FMXLIB}\r\n          if AItem.FontSize <>  -1 then\r\n            AGraphics.Font.Size := AItem.FontSize;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          if AItem.FontSize <>  -1 then\r\n            AGraphics.Font.Size := Round(AItem.FontSize);\r\n          {$ENDIF}\r\n\r\n          AGraphics.Font.Style := AItem.FontStyle;\r\n          AGraphics.Font.Color := AItem.FontColor;\r\n        end;  \r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      AGraphics.Font.Assign(ItemsAppearance.DisabledFont);\r\n      if not AItem.UseDefaultAppearance then\r\n      begin\r\n        if AItem.DisabledFontName <> '' then              \r\n          AGraphics.Font.Name := AItem.DisabledFontName;\r\n\r\n        {$IFDEF FMXLIB}\r\n        if AItem.DisabledFontSize <>  -1 then\r\n          AGraphics.Font.Size := AItem.DisabledFontSize;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        if AItem.DisabledFontSize <>  -1 then\r\n          AGraphics.Font.Size := Round(AItem.DisabledFontSize);\r\n        {$ENDIF}\r\n\r\n        AGraphics.Font.Style := AItem.DisabledFontStyle;\r\n        AGraphics.Font.Color := AItem.DisabledFontColor;\r\n      end;  \r\n    end;\r\n\r\n    if AItem.UseDefaultAppearance then\r\n    begin\r\n      itha := ItemsAppearance.TextHorizontalTextAlign;\r\n      itva := ItemsAppearance.TextVerticalTextAlign;\r\n    end\r\n    else\r\n    begin\r\n      itha := AItem.TextHorizontalTextAlign;\r\n      itva := AItem.TextVerticalTextAlign;\r\n    end;\r\n\r\n    b := True;\r\n    str := AItem.Text;\r\n    DoGetItemText(AItem, pgtmDrawing, str);\r\n    txtr := ARect;\r\n    txtr.Top := txtr.Top + th;\r\n    InflateRectEx(txtr, -2, -2);\r\n    DoBeforeDrawItemText(AGraphics, txtr, AItem, str, b);\r\n    if b then\r\n    begin\r\n      if (FInplaceEditorActive and (Interaction.InplaceEditorMode = piemTitle) and (FActiveItem = AItem)) or ((not FInplaceEditorActive) or (FActiveItem <> AItem)) then\r\n        AGraphics.DrawText(txtr, str, True, itha, itva);\r\n      DoAfterDrawItemText(AGraphics, txtr, AItem, str);\r\n    end;\r\n\r\n    if (strt <> '') and AItem.ShowTitle then\r\n    begin\r\n      txtr := ARect;\r\n      txtr.Bottom := txtr.Top + int(th);\r\n\r\n      if AItem.Enabled then\r\n      begin\r\n        if FSelectedItems.IndexOf(AItem) > -1 then\r\n        begin\r\n          if AItem = FActiveItem then\r\n          begin\r\n            AGraphics.Fill.Assign(ItemsAppearance.ActiveTitleFill);\r\n            AGraphics.Fill.Color := AItem.ActiveTitleColor;\r\n            AGraphics.Stroke.Assign(ItemsAppearance.ActiveTitleStroke);\r\n          end\r\n          else\r\n          begin\r\n            AGraphics.Fill.Assign(ItemsAppearance.SelectedTitleFill);\r\n            AGraphics.Fill.Color := AItem.SelectedTitleColor;\r\n            AGraphics.Stroke.Assign(ItemsAppearance.SelectedTitleStroke);\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          AGraphics.Fill.Assign(ItemsAppearance.TitleFill);\r\n          AGraphics.Fill.Color := AItem.TitleColor;\r\n          AGraphics.Stroke.Assign(ItemsAppearance.TitleStroke);\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        AGraphics.Fill.Assign(ItemsAppearance.DisabledTitleFill);\r\n        AGraphics.Fill.Color := AItem.DisabledTitleColor;\r\n        AGraphics.Stroke.Assign(ItemsAppearance.DisabledTitleStroke);\r\n      end;\r\n\r\n      FixStroke(AGraphics);\r\n\r\n      df := True;\r\n      b := True;\r\n      DoBeforeDrawItemTitle(AGraphics, txtr, AItem, strt, b, df);\r\n\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(txtr, gcrmNone);\r\n\r\n        if AItem.Enabled then\r\n        begin\r\n          if FSelectedItems.IndexOf(AItem) > -1 then\r\n          begin\r\n            if AItem = FActiveItem then\r\n            begin\r\n              AGraphics.Font.Assign(ItemsAppearance.ActiveTitleFont);\r\n              if not AItem.UseDefaultAppearance then\r\n              begin\r\n                if AItem.ActiveTitleFontName <> '' then              \r\n                  AGraphics.Font.Name := AItem.ActiveTitleFontName;\r\n\r\n                {$IFDEF FMXLIB}\r\n                if AItem.ActiveTitleFontSize <>  -1 then\r\n                  AGraphics.Font.Size := AItem.ActiveTitleFontSize;\r\n                {$ENDIF}\r\n                {$IFDEF CMNWEBLIB}\r\n                if AItem.ActiveTitleFontSize <>  -1 then\r\n                  AGraphics.Font.Size := Round(AItem.ActiveTitleFontSize);\r\n                {$ENDIF}\r\n\r\n                AGraphics.Font.Style := AItem.ActiveTitleFontStyle;\r\n                AGraphics.Font.Color := AItem.ActiveTitleFontColor;                \r\n              end;                 \r\n            end\r\n            else\r\n            begin\r\n              AGraphics.Font.Assign(ItemsAppearance.SelectedTitleFont);\r\n              if not AItem.UseDefaultAppearance then\r\n              begin\r\n                if AItem.SelectedTitleFontName <> '' then              \r\n                  AGraphics.Font.Name := AItem.SelectedTitleFontName;\r\n\r\n                {$IFDEF FMXLIB}\r\n                if AItem.SelectedTitleFontSize <>  -1 then\r\n                  AGraphics.Font.Size := AItem.SelectedTitleFontSize;\r\n                {$ENDIF}\r\n                {$IFDEF CMNWEBLIB}\r\n                if AItem.SelectedTitleFontSize <>  -1 then\r\n                  AGraphics.Font.Size := Round(AItem.SelectedTitleFontSize);\r\n                {$ENDIF}\r\n\r\n                AGraphics.Font.Style := AItem.SelectedTitleFontStyle;\r\n                AGraphics.Font.Color := AItem.SelectedTitleFontColor;                \r\n              end;                 \r\n            end;\r\n          end\r\n          else\r\n          begin\r\n            AGraphics.Font.Assign(ItemsAppearance.TitleFont);\r\n            if not AItem.UseDefaultAppearance then\r\n            begin\r\n              if AItem.TitleFontName <> '' then              \r\n                AGraphics.Font.Name := AItem.TitleFontName;\r\n\r\n              {$IFDEF FMXLIB}\r\n              if AItem.TitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := AItem.TitleFontSize;\r\n              {$ENDIF}\r\n              {$IFDEF CMNWEBLIB}\r\n              if AItem.TitleFontSize <>  -1 then\r\n                AGraphics.Font.Size := Round(AItem.TitleFontSize);\r\n              {$ENDIF}\r\n\r\n              AGraphics.Font.Style := AItem.TitleFontStyle;\r\n              AGraphics.Font.Color := AItem.TitleFontColor;                \r\n            end;                 \r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          AGraphics.Font.Assign(ItemsAppearance.DisabledTitleFont);\r\n          if not AItem.UseDefaultAppearance then\r\n          begin\r\n            if AItem.DisabledTitleFontName <> '' then              \r\n              AGraphics.Font.Name := AItem.DisabledTitleFontName;\r\n\r\n            {$IFDEF FMXLIB}\r\n            if AItem.DisabledTitleFontSize <>  -1 then\r\n              AGraphics.Font.Size := AItem.DisabledTitleFontSize;\r\n            {$ENDIF}\r\n            {$IFDEF CMNWEBLIB}\r\n            if AItem.DisabledTitleFontSize <>  -1 then\r\n              AGraphics.Font.Size := Round(AItem.DisabledTitleFontSize);\r\n            {$ENDIF}\r\n\r\n            AGraphics.Font.Style := AItem.DisabledTitleFontStyle;\r\n            AGraphics.Font.Color := AItem.DisabledTitleFontColor;                \r\n          end;                 \r\n        end;\r\n\r\n        if AItem.UseDefaultAppearance then\r\n        begin\r\n          ithat := ItemsAppearance.TitleHorizontalTextAlign;\r\n          itvat := ItemsAppearance.TitleVerticalTextAlign;\r\n        end\r\n        else\r\n        begin\r\n          ithat := AItem.TitleHorizontalTextAlign;\r\n          itvat := AItem.TitleVerticalTextAlign;\r\n        end;        \r\n\r\n        b := True;\r\n        txtrt := txtr;\r\n        InflateRectEx(txtrt, -2, -2);\r\n        DoBeforeDrawItemTitleText(AGraphics, txtrt, AItem, strt, b);\r\n        if b then\r\n        begin\r\n          if (FInplaceEditorActive and (Interaction.InplaceEditorMode = piemText) and (FActiveItem = AItem)) or ((not FInplaceEditorActive) or (FActiveItem <> AItem)) then\r\n            AGraphics.DrawText(txtrt, strt, False, ithat, itvat);\r\n          DoAfterDrawItemTitleText(AGraphics, txtrt, AItem, strt);\r\n        end;\r\n\r\n        DoAfterDrawItemTitle(AGraphics, txtr, AItem, strt);\r\n      end;\r\n    end;\r\n\r\n    if ACacheIndex = 0 then\r\n    begin\r\n      d := AItem.Deletable;\r\n      DoIsItemDeletable(AItem, d);\r\n      if d and ItemsAppearance.ShowDeleteArea and AllowDesktopDelete and not Interaction.ReadOnly then\r\n      begin\r\n        if AItem = FActiveItem then\r\n          AGraphics.Stroke.Color := gcWhite\r\n        else\r\n          AGraphics.Stroke.Color := ItemsAppearance.DeleteAreaColor;\r\n            \r\n        AGraphics.Stroke.Width := 2;\r\n        AGraphics.Stroke.Kind := gskSolid;\r\n        sz := ItemsAppearance.DeleteAreaSize;\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          end;\r\n        end;\r\n\r\n        bm := True;\r\n        dfm := True;\r\n        DoBeforeDrawDeleteArea(AGraphics, sr, AItem, bm, dfm);\r\n        if bm then\r\n        begin\r\n          if dfm then\r\n          begin\r\n            InflateRectEx(sr, -3, -3);\r\n            AGraphics.DrawLine(PointF(sr.Left, sr.Top), PointF(sr.Right, sr.Bottom), gcpmNone);\r\n            AGraphics.DrawLine(PointF(sr.Right, sr.Top), PointF(sr.Left, sr.Bottom), gcpmNone);\r\n          end;\r\n          DoAfterDrawDeleteArea(AGraphics, sr, AItem);\r\n        end;\r\n      end;\r\n    end;\r\n                    \r\n    DoAfterDrawItem(AGraphics, ARect, AItem);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawItemHelpers(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  it: TTMSFNCPlannerItem;\r\n  drs: TRectF;\r\n  cr: TRectF;\r\n  txt: String;\r\n  tw, th: Double;\r\n  ctr: TRectF;\r\n  y: Single;\r\n  st: TTMSFNCGraphicsSaveState;\r\n  dt: TDateTime;\r\n  b, df: Boolean;\r\n  sz: TSizeF;\r\nbegin\r\n  if Assigned(FActiveItem) and FDrawItemHelpers and ItemsAppearance.ShowItemHelpers then\r\n  begin\r\n    it := FActiveItem;\r\n    ctr := GetContentClipRect;\r\n    st := AGraphics.SaveState;\r\n    AGraphics.Fill.Kind := gfkSolid;\r\n    AGraphics.Stroke.Kind := gskSolid;\r\n    AGraphics.Fill.Color := gcWhitesmoke;\r\n    AGraphics.Stroke.Color := gcDarkGray;\r\n    AGraphics.Font.Color := gcDarkGray;\r\n\r\n    AGraphics.ClipRect(ctr);\r\n    //top time\r\n    cr := GetFirstRect(it);\r\n    if IntersectRectEx(cr, ctr) then\r\n    begin\r\n      dt := it.StartTime;\r\n      txt := FormatDateTime('hh:nn', dt);\r\n      DoGetItemHelperText(it, true, dt, txt);\r\n      sz := AGraphics.CalculateTextSize(txt);\r\n      tw := sz.cx + 5;\r\n      th := sz.cy + 5;\r\n\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          drs := RectF(cr.Left, cr.Bottom + 10, cr.Left + tw, cr.Bottom + 10 + th);\r\n          if drs.Bottom > ctr.Bottom then\r\n          begin\r\n            y := drs.Bottom - drs.Top;\r\n            drs.Top := cr.Top - 10 - y;\r\n            drs.Bottom := cr.Top - 10;\r\n          end;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          drs := RectF(cr.Right + 10, cr.Top, cr.Right + 10 + tw, cr.Top + th);\r\n          if drs.Right > ctr.Right then\r\n          begin\r\n            y := drs.Right - drs.Left;\r\n            drs.Left := cr.Left - 10 - y;\r\n            drs.Right := cr.Left - 10;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      b := True;\r\n      df := True;\r\n      DoBeforeDrawItemHelper(AGraphics, drs, it, True, dt, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(drs, gcrmShiftRightDown);\r\n\r\n        b := True;\r\n        DoBeforeDrawItemHelperText(AGraphics, drs, it, true, dt, txt, b);\r\n        if b then\r\n        begin\r\n          AGraphics.DrawText(drs, txt, False, gtaCenter, gtaCenter);\r\n          DoAfterDrawItemHelperText(AGraphics, drs, it, true, dt, txt);\r\n        end;\r\n\r\n        DoAfterDrawItemHelper(AGraphics, drs, it, True, dt);\r\n      end;\r\n    end;\r\n\r\n    AGraphics.Fill.Color := gcNull;\r\n    AGraphics.Fill.Color := gcWhitesmoke;\r\n\r\n    //bottom time\r\n    cr := GetLastRect(it);\r\n    if IntersectRectEx(cr, ctr) then\r\n    begin\r\n      dt := it.EndTime;\r\n      txt := FormatDateTime('hh:nn', dt);\r\n      DoGetItemHelperText(it, False, dt, txt);\r\n      sz := AGraphics.CalculateTextSize(txt);\r\n      tw := sz.cx + 5;\r\n      th := sz.cy + 5;\r\n\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          drs := RectF(cr.Right - tw, cr.Bottom + 10, cr.Right, cr.Bottom + 10 + th);\r\n          if drs.Bottom > ctr.Bottom then\r\n          begin\r\n            y := drs.Bottom - drs.Top;\r\n            drs.Top := cr.Top - 10 - y;\r\n            drs.Bottom := cr.Top - 10;\r\n          end;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          drs := RectF(cr.Right + 10, cr.Bottom - th, cr.Right + 10 + tw, cr.Bottom);\r\n          if drs.Right > ctr.Right then\r\n          begin\r\n            y := drs.Right - drs.Left;\r\n            drs.Left := cr.Left - 10 - y;\r\n            drs.Right := cr.Left - 10;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      b := True;\r\n      df := True;\r\n      DoBeforeDrawItemHelper(AGraphics, drs, it, False, dt, b, df);\r\n      if b then\r\n      begin\r\n        if df then\r\n          AGraphics.DrawRectangle(drs, gcrmShiftRightDown);\r\n\r\n        b := True;\r\n        DoBeforeDrawItemHelperText(AGraphics, drs, it, False, dt, txt, b);\r\n        if b then\r\n        begin\r\n          AGraphics.DrawText(drs, txt, False, gtaCenter, gtaCenter);\r\n          DoAfterDrawItemHelperText(AGraphics, drs, it, False, dt, txt);\r\n        end;\r\n        DoAfterDrawItemHelper(AGraphics, drs, it, False, dt);\r\n      end;\r\n    end;\r\n\r\n    AGraphics.RestoreState(st);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawItemLinks(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  i: Integer;\r\n  m: Double;\r\n  LR1F, LR1T: TRectF;\r\n  AItem: TTMSFNCPlannerItem;\r\n  pol: TTMSFNCGraphicsPathPolygon;\r\n  lasz: Double;\r\n  las: TTMSFNCPlannerLinkArrowShape;\r\n  stk: TTMSFNCGraphicsStrokeKind;\r\n  b: Boolean;\r\nbegin\r\n  if ItemsAppearance.ShowLinks then\r\n  begin\r\n    AGraphics.Stroke.Assign(ItemsAppearance.LinkStroke);\r\n    lasz := ItemsAppearance.LinkArrowSize;\r\n    las := ItemsAppearance.LinkArrowShape;\r\n    SetLength(pol, 4);\r\n    for i := 0 to FItemDisplay.Count - 1 do\r\n    begin\r\n      AItem := FItemDisplay[I].Item;\r\n      if Assigned(AItem) and Assigned(AItem.LinkedItem) and IsValidItem(AItem.LinkedItem) then\r\n      begin\r\n        LR1F := AItem.GetLastRect;\r\n        LR1T := AItem.LinkedItem.GetFirstRect;\r\n\r\n        if (FSelectedItems.IndexOf(AItem) > -1) and (AItem.SelectedLinkColor <> gcNull) then\r\n          AGraphics.Stroke.Color := AItem.SelectedLinkColor\r\n        else if (AItem.LinkColor <> gcNull) then\r\n          AGraphics.Stroke.Color := AItem.LinkColor;\r\n\r\n        AGraphics.Fill.Kind := gfkSolid;\r\n        AGraphics.Fill.Color := AGraphics.Stroke.Color;\r\n\r\n        if (lr1f.Top = 0) and (lr1t.Top = 0) then\r\n          Continue;\r\n\r\n        if (lr1f.Left = 0) and (lr1t.Left = 0) then\r\n          Continue;\r\n\r\n        if (LR1F.Right - LR1F.Left = 0) or (LR1F.Bottom - LR1F.Top = 0) or (LR1T.Right - LR1T.Left = 0) or (LR1T.Bottom - LR1T.Top = 0) then\r\n          Continue;\r\n\r\n\r\n        b := True;\r\n        DoBeforeDrawItemLink(AGraphics, AItem, AItem.LinkedItem, b);\r\n        if b then\r\n        begin\r\n          if (LR1F.Right < LR1T.Left) then\r\n          begin\r\n            m := LR1F.Right + (LR1T.Left - LR1F.Right) / 2;\r\n\r\n            AGraphics.DrawLine(PointF(m, Min(LR1F.Bottom, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2)), PointF(m, Min(LR1T.Bottom, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2)));\r\n\r\n            if LR1F.Bottom > 0 then\r\n            begin\r\n              AGraphics.DrawLine(PointF(LR1F.Right, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2), PointF(m, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2));\r\n\r\n              if (AItem.LinkArrow in [ilaToFrom, ilaBoth]) then\r\n              begin\r\n                if ItemsAppearance.LinkArrowShape = lasNormal then\r\n                begin\r\n                  AGraphics.DrawLine(PointF(LR1F.Right, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2), PointF(LR1F.Right + lasz, lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2));\r\n                  AGraphics.DrawLine(PointF(LR1F.Right, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2), PointF(LR1F.Right + lasz, -lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2));\r\n                end;\r\n\r\n                if las = lasFilled then\r\n                begin\r\n                  pol[0].X := LR1F.Right;\r\n                  pol[0].Y := LR1F.Top + (LR1F.Bottom - LR1F.Top) / 2;\r\n                  pol[1].X := LR1F.Right + lasz;\r\n                  pol[1].Y := lasz + LR1F.Top + (LR1F.Bottom - LR1F.Top) / 2;\r\n                  pol[2].X := LR1F.Right + lasz;\r\n                  pol[2].Y := -lasz + LR1F.Top + (LR1F.Bottom - LR1F.Top) / 2;\r\n                  pol[3].X := pol[0].X;\r\n                  pol[3].Y := pol[0].Y;\r\n                  stk := AGraphics.Stroke.Kind;\r\n                  AGraphics.Stroke.Kind := gskNone;\r\n                  AGraphics.DrawPolygon(pol);\r\n                  AGraphics.Stroke.Kind := stk;\r\n                end;\r\n              end;\r\n            end;\r\n\r\n            if LR1T.Bottom > 0 then\r\n            begin\r\n              AGraphics.DrawLine(PointF(LR1T.Left, Min(LR1T.Bottom, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2)), PointF(m, Min(LR1T.Bottom, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2)));\r\n\r\n              if (AItem.LinkArrow in [ilaFromTo, ilaBoth]) then\r\n              begin\r\n                if las = lasNormal then\r\n                begin\r\n                  AGraphics.DrawLine(PointF(LR1T.Left, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2), PointF(LR1T.Left - lasz, lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2));\r\n                  AGraphics.DrawLine(PointF(LR1T.Left, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2), PointF(LR1T.Left - lasz, -lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2));\r\n                end;\r\n\r\n                if las = lasFilled then\r\n                begin\r\n                  pol[0].X := LR1T.Left;\r\n                  pol[0].Y := LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[1].X := LR1T.Left - lasz;\r\n                  pol[1].Y := lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[2].X := LR1T.Left - lasz;\r\n                  pol[2].Y := -lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[3].X := pol[0].X;\r\n                  pol[3].Y := pol[0].Y;\r\n                  stk := AGraphics.Stroke.Kind;\r\n                  AGraphics.Stroke.Kind := gskNone;\r\n                  AGraphics.DrawPolygon(pol);\r\n                  AGraphics.Stroke.Kind := stk;\r\n                end;\r\n              end;\r\n            end;\r\n          end\r\n          else\r\n          if (LR1F.Left > LR1T.Right) then\r\n          begin\r\n            m := LR1F.Left - (LR1F.Left - LR1T.Right) / 2;\r\n\r\n            AGraphics.DrawLine(PointF(m, Min(LR1F.Bottom, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2)), PointF(m, Min(LR1T.Bottom, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2)));\r\n\r\n            if LR1F.Bottom > 0 then\r\n            begin\r\n              AGraphics.DrawLine(PointF(LR1F.Left, Min(LR1F.Bottom, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2)), PointF(m, Min(LR1F.Bottom, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2)));\r\n\r\n              if (AItem.LinkArrow in [ilaToFrom, ilaBoth]) then\r\n              begin\r\n                if las = lasNormal then\r\n                begin\r\n                  AGraphics.DrawLine(PointF(LR1F.Left, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2), PointF(LR1F.Left - lasz, lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2));\r\n                  AGraphics.DrawLine(PointF(LR1F.Left, LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2), PointF(LR1F.Left - lasz, -lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2));\r\n                end;\r\n\r\n                if las = lasFilled then\r\n                begin\r\n                  pol[0].X := LR1F.Left;\r\n                  pol[0].Y := LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2;\r\n                  pol[1].X := LR1F.Left - lasz;\r\n                  pol[1].Y := lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2;\r\n                  pol[2].X := LR1F.Left - lasz;\r\n                  pol[2].Y := -lasz + LR1F.Top + (LR1F.Bottom -  LR1F.Top) / 2;\r\n                  pol[3].X := pol[0].X;\r\n                  pol[3].Y := pol[0].Y;\r\n                  stk := AGraphics.Stroke.Kind;\r\n                  AGraphics.Stroke.Kind := gskNone;\r\n                  AGraphics.DrawPolygon(pol);\r\n                  AGraphics.Stroke.Kind := stk;\r\n                end;\r\n              end;\r\n            end;\r\n\r\n            if LR1T.Bottom > 0 then\r\n            begin\r\n              AGraphics.DrawLine(PointF(LR1T.Right, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2), PointF(m, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2));\r\n              if (AItem.LinkArrow in [ilaFromTo, ilaBoth]) then\r\n              begin\r\n                if las = lasNormal then\r\n                begin\r\n                  AGraphics.DrawLine(PointF(LR1T.Right, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2), PointF(LR1T.Right + lasz, lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2));\r\n                  AGraphics.DrawLine(PointF(LR1T.Right, LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2), PointF(LR1T.Right + lasz, -lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2));\r\n                end;\r\n\r\n                if las = lasFilled then\r\n                begin\r\n                  pol[0].X := LR1T.Right;\r\n                  pol[0].Y := LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[1].X := LR1T.Right + lasz;\r\n                  pol[1].Y := lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[2].X := LR1T.Right + lasz;\r\n                  pol[2].Y := -lasz + LR1T.Top + (LR1T.Bottom -  LR1T.Top) / 2;\r\n                  pol[3].X := pol[0].X;\r\n                  pol[3].Y := pol[0].Y;\r\n                  stk := AGraphics.Stroke.Kind;\r\n                  AGraphics.Stroke.Kind := gskNone;\r\n                  AGraphics.DrawPolygon(pol);\r\n                  AGraphics.Stroke.Kind := stk;\r\n                end;\r\n              end;\r\n            end;\r\n          end\r\n          else\r\n          if (LR1F.Bottom < LR1T.Top) then\r\n          begin\r\n            m := LR1F.Bottom + (LR1T.Top - LR1F.Bottom) / 2;\r\n\r\n            AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, m), PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, m));\r\n            AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, m), PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Bottom));\r\n\r\n            if (AItem.LinkArrow in [ilaToFrom, ilaBoth]) then\r\n            begin\r\n              if las = lasNormal then\r\n              begin\r\n                AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Bottom), PointF(LR1F.Left + lasz + (LR1F.Right - LR1F.Left) / 2, LR1F.Bottom + lasz));\r\n                AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Bottom), PointF(LR1F.Left - lasz + (LR1F.Right - LR1F.Left) / 2, LR1F.Bottom + lasz));\r\n              end;\r\n\r\n              if las = lasFilled then\r\n              begin\r\n                pol[0].X := LR1F.Left + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[0].Y := LR1F.Bottom;\r\n                pol[1].X := LR1F.Left + lasz + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[1].Y := LR1F.Bottom + lasz;\r\n                pol[2].X := LR1F.Left - lasz + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[2].Y := LR1F.Bottom + lasz;\r\n                pol[3].X := pol[0].X;\r\n                pol[3].Y := pol[0].Y;\r\n                stk := AGraphics.Stroke.Kind;\r\n                AGraphics.Stroke.Kind := gskNone;\r\n                AGraphics.DrawPolygon(pol);\r\n                AGraphics.Stroke.Kind := stk;\r\n              end;\r\n            end;\r\n\r\n            AGraphics.DrawLine(PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, m), PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, LR1T.Top));\r\n            if (AItem.LinkArrow in [ilaFromTo, ilaBoth]) then\r\n            begin\r\n              if las = lasNormal then\r\n              begin\r\n                AGraphics.DrawLine(PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, LR1T.Top), PointF(LR1T.Left + lasz + (LR1T.Right - LR1T.Left) / 2, LR1T.Top - lasz));\r\n                AGraphics.DrawLine(PointF(LR1T.Left  + (LR1T.Right - LR1T.Left) / 2, LR1T.Top), PointF(LR1T.Left - lasz + (LR1T.Right - LR1T.Left) / 2, LR1T.Top - lasz));\r\n              end;\r\n\r\n              if las = lasFilled then\r\n              begin\r\n                pol[0].X := LR1T.Left + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[0].Y := LR1T.Top;\r\n                pol[1].X := LR1T.Left + lasz + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[1].Y := LR1T.Top - lasz;\r\n                pol[2].X := LR1T.Left - lasz + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[2].Y := LR1T.Top - lasz;\r\n                pol[3].X := pol[0].X;\r\n                pol[3].Y := pol[0].Y;\r\n                stk := AGraphics.Stroke.Kind;\r\n                AGraphics.Stroke.Kind := gskNone;\r\n                AGraphics.DrawPolygon(pol);\r\n                AGraphics.Stroke.Kind := stk;\r\n              end;\r\n            end;\r\n          end\r\n          else\r\n          if (LR1F.Top > LR1T.Bottom) then\r\n          begin\r\n            m := LR1T.Bottom  + (LR1F.Top - LR1T.Bottom) / 2;\r\n\r\n            AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, m), PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, m));\r\n            AGraphics.DrawLine(PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, m), PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, LR1T.Bottom));\r\n\r\n            if (AItem.LinkArrow in [ilaFromTo, ilaBoth]) then\r\n            begin\r\n              if las = lasNormal then\r\n              begin\r\n                AGraphics.DrawLine(PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, LR1T.Bottom), PointF(LR1T.Left + lasz + (LR1T.Right - LR1T.Left) / 2, LR1T.Bottom + lasz));\r\n                AGraphics.DrawLine(PointF(LR1T.Left + (LR1T.Right - LR1T.Left) / 2, LR1T.Bottom), PointF(LR1T.Left - lasz + (LR1T.Right - LR1T.Left) / 2, LR1T.Bottom + lasz));\r\n              end;\r\n\r\n              if las = lasFilled then\r\n              begin\r\n                pol[0].X := LR1T.Left + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[0].Y := LR1T.Bottom;\r\n                pol[1].X := LR1T.Left + lasz + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[1].Y := LR1T.Bottom + lasz;\r\n                pol[2].X := LR1T.Left - lasz + (LR1T.Right - LR1T.Left) / 2;\r\n                pol[2].Y := LR1T.Bottom + lasz;\r\n                pol[3].X := pol[0].X;\r\n                pol[3].Y := pol[0].Y;\r\n                stk := AGraphics.Stroke.Kind;\r\n                AGraphics.Stroke.Kind := gskNone;\r\n                AGraphics.DrawPolygon(pol);\r\n                AGraphics.Stroke.Kind := stk;\r\n              end;\r\n            end;\r\n\r\n            AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, m), PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Top));\r\n            if (AItem.LinkArrow in [ilaToFrom, ilaBoth]) then\r\n            begin\r\n              if las = lasNormal then\r\n              begin\r\n                AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Top), PointF(LR1F.Left + lasz + (LR1F.Right - LR1F.Left) / 2, LR1F.Top - lasz));\r\n                AGraphics.DrawLine(PointF(LR1F.Left + (LR1F.Right - LR1F.Left) / 2, LR1F.Top), PointF(LR1F.Left - lasz + (LR1F.Right - LR1F.Left) / 2, LR1F.Top - lasz));\r\n              end;\r\n\r\n              if las = lasFilled then\r\n              begin\r\n                pol[0].X := LR1F.Left + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[0].Y := LR1F.Top;\r\n                pol[1].X := LR1F.Left + lasz + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[1].Y := LR1F.Top - lasz;\r\n                pol[2].X := LR1F.Left - lasz + (LR1F.Right - LR1F.Left) / 2;\r\n                pol[2].Y := LR1F.Top - lasz;\r\n                pol[3].X := pol[0].X;\r\n                pol[3].Y := pol[0].Y;\r\n                stk := AGraphics.Stroke.Kind;\r\n                AGraphics.Stroke.Kind := gskNone;\r\n                AGraphics.DrawPolygon(pol);\r\n                AGraphics.Stroke.Kind := stk;\r\n              end;\r\n            end;\r\n\r\n            DoAfterDrawItemLink(AGraphics, AItem, AItem.LinkedItem);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawItems(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  DrawDisplay(AGraphics, FItemDisplay);\r\n  DrawItemHelpers(AGraphics);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawNavigationButtons(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  r: TRectF;\r\n  b, df: Boolean;\r\n  rm: TTMSFNCGraphicsModifyRectMode;\r\nbegin\r\n  if (pnbPrevious in Interaction.TopNavigationButtons) and (pplTop in PositionsAppearance.Layouts) and (PositionsAppearance.TopSize > 0) then\r\n  begin\r\n    r := GetTopLeftNavigationButtonRect;\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    rm := gcrmShiftRightDown;\r\n\r\n    case FTopLeftNavigationButtonState of\r\n      pnbsNormal:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonFill);\r\n      end;\r\n      pnbsDown:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonDownStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonDownFill);\r\n      end;\r\n      pnbsHover:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonHoverStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonHoverFill);\r\n      end;\r\n    end;\r\n\r\n    b := True;\r\n    df := True;\r\n    DoBeforeDrawTopNavigationButton(AGraphics, r, pnbPrevious, FTopLeftNavigationButtonState, b, df);\r\n    if b then\r\n    begin\r\n      if df then\r\n      begin\r\n        AGraphics.DrawRectangle(r, rm);\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: DrawArrow(AGraphics, r, pakUp);\r\n          pomVertical: DrawArrow(AGraphics, r, pakLeft);\r\n        end;\r\n      end;\r\n\r\n      DoAfterDrawTopNavigationButton(AGraphics, r, pnbPrevious, FTopLeftNavigationButtonState);\r\n    end;\r\n  end;\r\n\r\n  if (pnbNext in Interaction.TopNavigationButtons) and (pplTop in PositionsAppearance.Layouts) and (PositionsAppearance.TopSize > 0) then\r\n  begin\r\n    r := GetTopRightNavigationButtonRect;\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Top := r.Top - 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    case OrientationMode of\r\n      pomHorizontal: rm := gcrmShiftRightAndExpandHeight;\r\n      pomVertical: rm := gcrmShiftDownAndExpandWidth;\r\n      else\r\n        rm := gcrmNone;\r\n    end;\r\n\r\n    case FTopRightNavigationButtonState of\r\n      pnbsNormal:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonFill);\r\n      end;\r\n      pnbsDown:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonDownStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonDownFill);\r\n      end;\r\n      pnbsHover:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.TopNavigationButtonHoverStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.TopNavigationButtonHoverFill);\r\n      end;\r\n    end;\r\n\r\n    b := True;\r\n    df := True;\r\n    DoBeforeDrawTopNavigationButton(AGraphics, r, pnbNext, FTopRightNavigationButtonState, b, df);\r\n    if b then\r\n    begin\r\n      if df then\r\n      begin\r\n        AGraphics.DrawRectangle(r, rm);\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: DrawArrow(AGraphics, r, pakDown);\r\n          pomVertical: DrawArrow(AGraphics, r, pakRight);\r\n        end;\r\n      end;\r\n      DoAfterDrawTopNavigationButton(AGraphics, r, pnbNext, FTopRightNavigationButtonState);\r\n    end;\r\n  end;\r\n\r\n  if (pnbPrevious in Interaction.BottomNavigationButtons) and (pplBottom in PositionsAppearance.Layouts) and (PositionsAppearance.BottomSize > 0) then\r\n  begin\r\n    r := GetBottomLeftNavigationButtonRect;\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        r.Left := r.Left - 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Top := r.Top - 1;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    case OrientationMode of\r\n      pomHorizontal: rm := gcrmShiftLeftDown;\r\n      pomVertical: rm := gcrmShiftRightUp;\r\n      else\r\n        rm := gcrmNone;\r\n    end;\r\n\r\n    case FBottomLeftNavigationButtonState of\r\n      pnbsNormal:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonFill);\r\n      end;\r\n      pnbsDown:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonDownStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonDownFill);\r\n      end;\r\n      pnbsHover:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonHoverStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonHoverFill);\r\n      end;\r\n    end;\r\n\r\n    b := True;\r\n    df := True;\r\n    DoBeforeDrawBottomNavigationButton(AGraphics, r, pnbPrevious, FBottomLeftNavigationButtonState, b, df);\r\n    if b then\r\n    begin\r\n      if df then\r\n      begin\r\n        AGraphics.DrawRectangle(r, rm);\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: DrawArrow(AGraphics, r, pakUp);\r\n          pomVertical: DrawArrow(AGraphics, r, pakLeft);\r\n        end;\r\n      end;\r\n      DoAfterDrawBottomNavigationButton(AGraphics, r, pnbPrevious, FBottomLeftNavigationButtonState);\r\n    end;\r\n  end;\r\n\r\n  if (pnbNext in Interaction.BottomNavigationButtons) and (pplBottom in PositionsAppearance.Layouts) and (PositionsAppearance.BottomSize > 0) then\r\n  begin\r\n    r := GetBottomRightNavigationButtonRect;\r\n    {$IFDEF CMNLIB}\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        r.Left := r.Left - 1;\r\n        r.Top := r.Top - 1;\r\n        r.Bottom := r.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        r.Right := r.Right + 1;\r\n        r.Top := r.Top - 1;\r\n      end;\r\n    end;\r\n    {$ENDIF}\r\n    case OrientationMode of\r\n      pomHorizontal: rm := gcrmShiftLeftAndExpandHeight;\r\n      pomVertical: rm := gcrmShiftUpAndExpandWidth;\r\n      else\r\n        rm := gcrmNone;\r\n    end;\r\n\r\n    case FBottomRightNavigationButtonState of\r\n      pnbsNormal:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonFill);\r\n      end;\r\n      pnbsDown:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonDownStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonDownFill);\r\n      end;\r\n      pnbsHover:\r\n      begin\r\n        AGraphics.Stroke.Assign(PositionsAppearance.BottomNavigationButtonHoverStroke);\r\n        AGraphics.Fill.Assign(PositionsAppearance.BottomNavigationButtonHoverFill);\r\n      end;\r\n    end;\r\n\r\n    b := True;\r\n    df := True;\r\n    DoBeforeDrawBottomNavigationButton(AGraphics, r, pnbNext, FBottomRightNavigationButtonState, b, df);\r\n    if b then\r\n    begin\r\n      if df then\r\n      begin\r\n        AGraphics.DrawRectangle(r, rm);\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: DrawArrow(AGraphics, r, pakDown);\r\n          pomVertical: DrawArrow(AGraphics, r, pakRight);\r\n        end;\r\n      end;\r\n      DoAfterDrawBottomNavigationButton(AGraphics, r, pnbNext, FBottomRightNavigationButtonState);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawCell(AGraphics: TTMSFNCGraphics; ARect: TRectF; ACol, ARow: Integer; AStartTime, AEndTime: TDateTime; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nvar\r\n  b: Boolean;\r\n  df, ds, ac, isSub: Boolean;\r\nbegin\r\n  b := True;\r\n  df := True;\r\n\r\n  ds := IsDateTimeDisabled(AStartTime, APosition);\r\n  if ds then\r\n    AGraphics.Fill.Assign(GridCellAppearance.DisabledFill)\r\n  else\r\n  begin\r\n    ac := IsDateTimeInactive(AStartTime, APosition);\r\n    if ac then\r\n      AGraphics.Fill.Assign(GridCellAppearance.InActiveFill)\r\n    else\r\n      AGraphics.Fill.Assign(GridCellAppearance.Fill);\r\n  end;\r\n\r\n  AGraphics.Stroke.Kind := gskSolid;\r\n  AGraphics.Stroke.Color := AGraphics.Fill.Color;\r\n\r\n  DoBeforeDrawCell(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind, b, df);\r\n  if b then\r\n  begin\r\n    if df then\r\n    begin\r\n      AGraphics.DrawRectangle(ARect, gcrmNone);\r\n    end;\r\n\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        b := True;\r\n        df := True;\r\n\r\n        isSub := HasDateTimeSub and IsDateTimeSub(AStartTime);\r\n        if isSub then\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalSubStroke)\r\n        else\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalStroke);\r\n\r\n        DoBeforeDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AStartTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left, ARect.Bottom), gcpmNone);\r\n\r\n          DoAfterDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AEndTime, APosition, AKind);\r\n        end;\r\n\r\n        isSub := HasDateTimeSub and IsDateTimeSub(AEndTime);\r\n        if isSub then\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalSubStroke)\r\n        else\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalStroke);\r\n\r\n        b := True;\r\n        df := True;\r\n        DoBeforeDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AStartTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n            AGraphics.DrawLine(PointF(ARect.Right, ARect.Top), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n\r\n          DoAfterDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AStartTime, APosition, AKind);\r\n        end;\r\n\r\n        b := True;\r\n        df := True;\r\n\r\n        AGraphics.Stroke.Assign(GridCellAppearance.VerticalStroke);\r\n\r\n        DoBeforeDrawCellVerticalLine(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n          begin\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Right, ARect.Top), gcpmNone);\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Bottom), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n          end;\r\n          DoAfterDrawCellVerticalLine(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind);\r\n        end;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        b := True;\r\n        df := True;\r\n\r\n        AGraphics.Stroke.Assign(GridCellAppearance.VerticalStroke);\r\n\r\n        DoBeforeDrawCellVerticalLine(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n          begin\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left, ARect.Bottom), gcpmNone);\r\n            AGraphics.DrawLine(PointF(ARect.Right, ARect.Top), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n          end;\r\n          DoAfterDrawCellVerticalLine(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind);\r\n        end;\r\n\r\n        b := True;\r\n        df := True;\r\n\r\n        isSub := HasDateTimeSub and IsDateTimeSub(AStartTime);\r\n        if isSub then\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalSubStroke)\r\n        else\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalStroke);\r\n\r\n        DoBeforeDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AStartTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Right, ARect.Top), gcpmNone);\r\n          DoAfterDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AStartTime, APosition, AKind);\r\n        end;\r\n\r\n        isSub := HasDateTimeSub and IsDateTimeSub(AEndTime);\r\n        if isSub then\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalSubStroke)\r\n        else\r\n          AGraphics.Stroke.Assign(GridCellAppearance.HorizontalStroke);\r\n\r\n        b := True;\r\n        df := True;\r\n        DoBeforeDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AEndTime, APosition, AKind, b, df);\r\n        if b then\r\n        begin\r\n          if df then\r\n            AGraphics.DrawLine(PointF(ARect.Left, ARect.Bottom), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n          DoAfterDrawCellHorizontalLine(AGraphics, ARect, isSub, ACol, ARow, AEndTime, APosition, AKind);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    DoAfterDrawCell(AGraphics, ARect, ACol, ARow, AStartTime, AEndTime, APosition, AKind);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawCurrentTimeInGrid(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  st: TTMSFNCGraphicsSaveState;\r\n  dt: TDateTime;\r\n  v: Double;\r\n  cr, crt: TRectF;\r\n  b, df: Boolean;\r\nbegin\r\n  if TimeLine.CurrentTimeMode = pctmLine then\r\n  begin\r\n    dt := CurrentTime;\r\n    if DateTimeInRangeEx(dt, FDisplayStartTime, FDisplayEndTime, True) then\r\n    begin\r\n      st := AGraphics.SaveState;\r\n      cr := GetContentClipRect;\r\n      AGraphics.ClipRect(cr);\r\n      begin\r\n        AGraphics.Fill.Color := TimeLineAppearance.CurrentTimeColor;\r\n        AGraphics.Stroke.Color := TimeLineAppearance.CurrentTimeColor;\r\n        AGraphics.Fill.Kind := gfkSolid;\r\n        AGraphics.Stroke.Kind := gskSolid;\r\n\r\n        b := True;\r\n        df := True;\r\n        crt := GetContentRect;\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: v := DateTimeToValue(dt, True) - GetHorizontalScrollPosition + crt.Left;\r\n          pomVertical: v := DateTimeToValue(dt, True) - GetVerticalScrollPosition + crt.Top;\r\n          else\r\n            v := 0;\r\n        end;\r\n\r\n        DoBeforeDrawCurrentTimeInGrid(AGraphics, cr, v, dt, b, df);\r\n\r\n        if b then\r\n        begin\r\n          if df then\r\n          begin\r\n            case OrientationMode of\r\n              pomHorizontal: AGraphics.DrawLine(PointF(v, cr.Top), PointF(v, cr.Bottom));\r\n              pomVertical: AGraphics.DrawLine(PointF(cr.Left, v), PointF(cr.Right, v));\r\n            end;\r\n          end;\r\n\r\n          DoAfterDrawCurrentTimeInGrid(AGraphics, cr, v, dt);\r\n        end;\r\n      end;\r\n      AGraphics.RestoreState(st);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawCurrentTimeInTimeLine(AGraphics: TTMSFNCGraphics; ALeft: Boolean);\r\nvar\r\n  st: TTMSFNCGraphicsSaveState;\r\n  dt: TDateTime;\r\n  v: Double;\r\n  cr, crt, txtr: TRectF;\r\n  b, df: Boolean;\r\n  str: String;\r\n  th, tw: Double;\r\n  sz: TSizeF;\r\nbegin\r\n  if ALeft and not (ptlLeft in TimeLineAppearance.Layouts) then\r\n    Exit;\r\n\r\n  if not ALeft and not (ptlRight in TimeLineAppearance.Layouts) then\r\n    Exit;\r\n\r\n  if (TimeLine.CurrentTimeMode <> pctmNone) then\r\n  begin\r\n    dt := CurrentTime;\r\n    if DateTimeInRangeEx(dt, FDisplayStartTime, FDisplayEndTime, True) then\r\n    begin\r\n      st := AGraphics.SaveState;\r\n      if ALeft then\r\n        cr := GetTimeLineLeftRect\r\n      else\r\n        cr := GetTimeLineRightRect;\r\n\r\n      AGraphics.ClipRect(cr);\r\n      begin\r\n        if ALeft then\r\n          AGraphics.Font.Assign(TimeLineAppearance.LeftFont)\r\n        else\r\n          AGraphics.Font.Assign(TimeLineAppearance.RightFont);\r\n\r\n        {$IFDEF FMXLIB}\r\n        AGraphics.Font.Size := AGraphics.Font.Size * 0.75;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        AGraphics.Font.Size := Round(AGraphics.Font.Size * 0.75);\r\n        {$ENDIF}\r\n\r\n        AGraphics.Fill.Color := TimeLineAppearance.CurrentTimeColor;\r\n        AGraphics.Stroke.Color := TimeLineAppearance.CurrentTimeColor;\r\n        AGraphics.Fill.Kind := gfkSolid;\r\n        AGraphics.Stroke.Kind := gskSolid;\r\n\r\n        b := True;\r\n        df := True;\r\n        crt := GetContentRect;\r\n\r\n        case OrientationMode of\r\n          pomHorizontal: v := DateTimeToValue(dt, True) - GetHorizontalScrollPosition + crt.Left;\r\n          pomVertical: v := DateTimeToValue(dt, True) - GetVerticalScrollPosition + crt.Top;\r\n          else\r\n            v := 0;\r\n        end;\r\n\r\n        if ALeft then\r\n          DoBeforeDrawCurrentTimeInTimeLine(AGraphics, cr, ikTimeLineLeft, v, dt, b, df)\r\n        else\r\n          DoBeforeDrawCurrentTimeInTimeLine(AGraphics, cr, ikTimeLineRight, v, dt, b, df);\r\n\r\n        if b then\r\n        begin\r\n          if df then\r\n          begin\r\n            case TimeLine.CurrentTimeMode of\r\n              pctmLine:\r\n              begin\r\n                case OrientationMode of\r\n                  pomHorizontal:\r\n                  begin\r\n                    if ALeft then\r\n                    begin\r\n                      AGraphics.DrawLine(PointF(v, cr.Bottom - 20), PointF(v, cr.Bottom));\r\n                      AGraphics.DrawEllipse(RectF(v - 5, cr.Bottom - 30, v + 5, cr.Bottom - 20));\r\n                    end\r\n                    else\r\n                    begin\r\n                      AGraphics.DrawLine(PointF(v, cr.Top), PointF(v, cr.Top + 20));\r\n                      AGraphics.DrawEllipse(RectF(v - 5, cr.Top + 20, v + 5, cr.Top + 30));\r\n                    end;\r\n                  end;\r\n                  pomVertical:\r\n                  begin\r\n                    if ALeft then\r\n                    begin\r\n                      AGraphics.DrawLine(PointF(cr.Right - 20, v), PointF(cr.Right, v), gcpmNone);\r\n                      AGraphics.DrawEllipse(RectF(cr.Right - 30, v - 5, cr.Right - 20, v + 5), gcrmNone);\r\n                    end\r\n                    else\r\n                    begin\r\n                      AGraphics.DrawLine(PointF(cr.Left, v), PointF(cr.Left + 20, v), gcpmNone);\r\n                      AGraphics.DrawEllipse(RectF(cr.Left + 20, v - 5, cr.Left + 30, v + 5), gcrmNone);\r\n                    end;\r\n                  end;\r\n                end;\r\n              end;\r\n              pctmText:\r\n              begin\r\n                str := FormatDateTime('hh:nn', dt);\r\n                sz := AGraphics.CalculateTextSize(str);\r\n                th := sz.cx + 4;\r\n                tw := sz.cy + 4;\r\n                case OrientationMode of\r\n                  pomHorizontal: txtr := RectF(v - tw / 2, cr.Top + ((cr.Bottom - cr.Top) - th) / 2, v + tw / 2, cr.Top + ((cr.Bottom - cr.Top) - th) / 2 + th);\r\n                  pomVertical: txtr := RectF(cr.Left + ((cr.Right - cr.Left) - tw) / 2, v - th / 2, cr.Left + ((cr.Right - cr.Left) - tw) / 2 + tw, v + th / 2);\r\n                end;\r\n                AGraphics.DrawRectangle(txtr, gcrmNone);\r\n                AGraphics.DrawText(txtr, str, False, gtaCenter, gtaCenter);\r\n              end;\r\n            end;\r\n          end;\r\n\r\n          if ALeft then\r\n            DoAfterDrawCurrentTimeInTimeLine(AGraphics, cr, ikTimeLineLeft, v, dt)\r\n          else\r\n            DoAfterDrawCurrentTimeInTimeLine(AGraphics, cr, ikTimeLineRight, v, dt);\r\n        end;\r\n      end;\r\n      AGraphics.RestoreState(st);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawPosition(AGraphics: TTMSFNCGraphics; ARect: TRectF; APosition: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nvar\r\n  b: Boolean;\r\n  str: String;\r\n  df: Boolean;\r\n  txtr: TRectF;\r\nbegin\r\n  case AKind of\r\n    ikPositionTop:\r\n    begin\r\n      AGraphics.Stroke.Assign(PositionsAppearance.TopStroke);\r\n      AGraphics.Fill.Assign(PositionsAppearance.TopFill);\r\n    end;\r\n    ikPositionBottom:\r\n    begin\r\n      AGraphics.Stroke.Assign(PositionsAppearance.BottomStroke);\r\n      AGraphics.Fill.Assign(PositionsAppearance.BottomFill);\r\n    end;\r\n  end;\r\n\r\n  FixStroke(AGraphics);\r\n\r\n  b := True;\r\n  df := True;\r\n  DoBeforeDrawPosition(AGraphics, ARect, APosition, AKind, b, df);\r\n\r\n  if b then\r\n  begin\r\n    if df then\r\n      AGraphics.DrawRectangle(ARect, gcrmNone);\r\n\r\n    case AKind of\r\n      ikPositionTop: AGraphics.Font.Assign(PositionsAppearance.TopFont);\r\n      ikPositionBottom: AGraphics.Font.Assign(PositionsAppearance.BottomFont);\r\n    end;\r\n\r\n    str := GetPositionText(APosition);\r\n    DoGetPositionText(APosition, AKind, str);\r\n    b := True;\r\n    txtr := ARect;\r\n    InflateRectEx(txtr, -2, -2);\r\n    DoBeforeDrawPositionText(AGraphics, txtr, APosition, AKind, str, b);\r\n    if b then\r\n    begin\r\n      case AKind of\r\n        ikPositionTop:\r\n        begin\r\n          case PositionsAppearance.TopVerticalTextMode of\r\n            pvtmAuto:\r\n            begin\r\n              case OrientationMode of\r\n                pomHorizontal: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign, gttNone, -90);\r\n                pomVertical: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign);\r\n              end;\r\n            end;\r\n            pvtmAlways: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign, gttNone, -90);\r\n            pvtmNone: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign);\r\n          end;\r\n        end;\r\n        ikPositionBottom:\r\n        begin\r\n          case PositionsAppearance.BottomVerticalTextMode of\r\n            pvtmAuto:\r\n            begin\r\n              case OrientationMode of\r\n                pomHorizontal: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign, gttNone, 90);\r\n                pomVertical: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign);\r\n              end;\r\n            end;\r\n            pvtmAlways: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign, gttNone, 90);\r\n            pvtmNone: AGraphics.DrawText(txtr, str, False, PositionsAppearance.TopHorizontalTextAlign, PositionsAppearance.TopVerticalTextAlign);\r\n          end;\r\n        end;\r\n      end;\r\n      DoAfterDrawPositionText(AGraphics, txtr, APosition, AKind, str);\r\n    end;\r\n    DoAfterDrawPosition(AGraphics, ARect, APosition, AKind);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawPositions(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  DrawDisplay(AGraphics, FPositionsTopDisplay);\r\n  DrawDisplay(AGraphics, FPositionsBottomDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawSelection(AGraphics: TTMSFNCGraphics);\r\nvar\r\n  st: TTMSFNCGraphicsSaveState;\r\n  c, r: Integer;\r\n  sc, stc: TTMSFNCPlannerCell;\r\n  x, y, w, h: Double;\r\n  rc: TRectF;\r\n  cr: TRectF;\r\nbegin\r\n  if not Interaction.ShowSelection then\r\n    Exit;\r\n\r\n  sc := Selection.StartCell;\r\n  stc := Selection.EndCell;\r\n\r\n  cr := GetContentClipRect;\r\n  InflateRectEx(cr, -1, -1);\r\n  st := AGraphics.SaveState;\r\n  AGraphics.ClipRect(cr);\r\n  AGraphics.Fill.Assign(SelectionAppearance.Fill);\r\n  {$IFDEF FMXLIB}\r\n  AGraphics.Stroke.Kind := gskNone;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  AGraphics.Stroke.Color := AGraphics.Fill.Color;\r\n  {$ENDIF}\r\n\r\n  x := StartX;\r\n  for c := StartCol to stc.Col do\r\n  begin\r\n    w := ColumnWidths[c];\r\n    y := StartY;\r\n    for r := StartRow to stc.Row do\r\n    begin\r\n      h := RowHeights[r];\r\n      if (c >= sc.Col) and (c <= stc.Col) and (r >= sc.Row) and (r <= stc.Row) then\r\n      begin\r\n        case OrientationMode of\r\n          pomHorizontal: rc := RectF(y, x, y + h, x + w);\r\n          pomVertical: rc := RectF(x, y, x + w, y + h);\r\n        end;\r\n\r\n        {$IFDEF FMXWEBLIB}\r\n        rc.Left := int(rc.Left) + 1;\r\n        rc.Top := int(rc.Top) + 1;\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            if rc.Bottom = StopX then\r\n              rc.Bottom := int(rc.Bottom) - 1\r\n            else\r\n              rc.Bottom := int(rc.Bottom);\r\n\r\n            if rc.Right = StopY then\r\n              rc.Right := int(rc.Right) - 1\r\n            else\r\n              rc.Right := int(rc.Right);\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            if rc.Bottom = StopY then\r\n              rc.Bottom := int(rc.Bottom) - 1\r\n            else\r\n              rc.Bottom := int(rc.Bottom);\r\n\r\n            if rc.Right = StopX then\r\n              rc.Right := int(rc.Right) - 1\r\n            else\r\n              rc.Right := int(rc.Right);\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNLIB}\r\n        rc.Left := rc.Left + 1;\r\n        rc.Top := rc.Top + 1;\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            if rc.Bottom = StopX then\r\n              rc.Bottom := rc.Bottom - 1\r\n            else\r\n              rc.Bottom := rc.Bottom;\r\n\r\n            if rc.Right = StopY then\r\n              rc.Right := rc.Right - 1\r\n            else\r\n              rc.Right := rc.Right;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            if rc.Bottom = StopY then\r\n              rc.Bottom := rc.Bottom - 1\r\n            else\r\n              rc.Bottom := rc.Bottom;\r\n\r\n            if rc.Right = StopX then\r\n              rc.Right := rc.Right - 1\r\n            else\r\n              rc.Right := rc.Right;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n        AGraphics.DrawRectangle(rc, gcrmNone);\r\n      end;\r\n      y := y + h;\r\n    end;\r\n    x := x + w;\r\n  end;\r\n\r\n  AGraphics.RestoreState(st);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawTime(AGraphics: TTMSFNCGraphics; ARect: TRectF; AValue: Double; ARow: Integer; AKind: TTMSFNCPlannerCacheItemKind);\r\nvar\r\n  b, df: Boolean;\r\n  str: String;\r\n  txtr: TRectF;\r\n  isSub: Boolean;\r\n  sk: TTMSFNCGraphicsStrokeKind;\r\nbegin\r\n  case AKind of\r\n    ikTimeLineLeft:\r\n    begin\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.LeftStroke);\r\n      AGraphics.Fill.Assign(TimeLineAppearance.LeftFill);\r\n    end;\r\n    ikTimeLineRight:\r\n    begin\r\n      AGraphics.Stroke.Assign(TimeLineAppearance.RightStroke);\r\n      AGraphics.Fill.Assign(TimeLineAppearance.RightFill);\r\n    end;\r\n  end;\r\n\r\n  FixStroke(AGraphics);\r\n\r\n  b := True;\r\n  df := True;\r\n  DoBeforeDrawTime(AGraphics, ARect, AValue, ARow, AKind, b, df);\r\n  if b then\r\n  begin\r\n    if df then\r\n    begin\r\n      sk := AGraphics.Stroke.Kind;\r\n      AGraphics.Stroke.Kind := gskNone;\r\n      AGraphics.DrawRectangle(ARect, gcrmNone);\r\n      AGraphics.Stroke.Kind := sk;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          b := True;\r\n          df := True;\r\n          DoBeforeDrawTimeStroke(AGraphics, ARect, AValue, False, ARow, AKind, b, df);\r\n          if b then\r\n          begin\r\n            if df then\r\n            begin\r\n              AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Right, ARect.Top), gcpmNone);\r\n              AGraphics.DrawLine(PointF(ARect.Left, ARect.Bottom), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n            end;\r\n            DoAfterDrawTimeStroke(AGraphics, ARect, AValue, False, ARow, AKind);\r\n          end;\r\n\r\n          issub := HasDateTimeSub and IsDateTimeSub(AValue);\r\n          if isSub then\r\n          begin\r\n            case AKind of\r\n              ikTimeLineLeft: AGraphics.Stroke.Assign(TimeLineAppearance.LeftSubStroke);\r\n              ikTimeLineRight: AGraphics.Stroke.Assign(TimeLineAppearance.RightSubStroke);\r\n            end;\r\n          end;\r\n\r\n          b := True;\r\n          df := True;\r\n          DoBeforeDrawTimeStroke(AGraphics, ARect, AValue, isSub, ARow, AKind, b, df);\r\n          if b then\r\n          begin\r\n            if df then\r\n            begin\r\n              if isSub then\r\n              begin\r\n                case AKind of\r\n                  ikTimeLineLeft: AGraphics.DrawLine(PointF(ARect.Left, ARect.Bottom - 20), PointF(ARect.Left, ARect.Bottom), gcpmNone);\r\n                  ikTimeLineRight: AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left, ARect.Top + 20), gcpmNone);\r\n                end;\r\n              end\r\n              else\r\n                AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left, ARect.Bottom), gcpmNone)\r\n            end;\r\n            DoAfterDrawTimeStroke(AGraphics, ARect, AValue, isSub, ARow, AKind);\r\n          end;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          b := True;\r\n          df := True;\r\n          DoBeforeDrawTimeStroke(AGraphics, ARect, AValue, False, ARow, AKind, b, df);\r\n          if b then\r\n          begin\r\n            if df then\r\n            begin\r\n              AGraphics.DrawLine(PointF(ARect.Right, ARect.Top), PointF(ARect.Right, ARect.Bottom), gcpmNone);\r\n              AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left, ARect.Bottom), gcpmNone);\r\n            end;\r\n            DoAfterDrawTimeStroke(AGraphics, ARect, AValue, False, ARow, AKind);\r\n          end;\r\n\r\n          issub := HasDateTimeSub and IsDateTimeSub(AValue);\r\n          if isSub then\r\n          begin\r\n            case AKind of\r\n              ikTimeLineLeft: AGraphics.Stroke.Assign(TimeLineAppearance.LeftSubStroke);\r\n              ikTimeLineRight: AGraphics.Stroke.Assign(TimeLineAppearance.RightSubStroke);\r\n            end;\r\n          end;\r\n\r\n          b := True;\r\n          df := True;\r\n          DoBeforeDrawTimeStroke(AGraphics, ARect, AValue, isSub, ARow, AKind, b, df);\r\n          if b then\r\n          begin\r\n            if df then\r\n            begin\r\n              if isSub then\r\n              begin\r\n                case AKind of\r\n                  ikTimeLineLeft: AGraphics.DrawLine(PointF(ARect.Right - 20, ARect.Top), PointF(ARect.Right, ARect.Top), gcpmNone);\r\n                  ikTimeLineRight: AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Left + 20, ARect.Top), gcpmNone);\r\n                end;\r\n              end\r\n              else\r\n                AGraphics.DrawLine(PointF(ARect.Left, ARect.Top), PointF(ARect.Right, ARect.Top), gcpmNone)\r\n            end;\r\n            DoAfterDrawTimeStroke(AGraphics, ARect, AValue, isSub, ARow, AKind);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    case AKind of\r\n      ikTimeLineLeft: AGraphics.Font.Assign(TimeLineAppearance.LeftFont);\r\n      ikTimeLineRight: AGraphics.Font.Assign(TimeLineAppearance.RightFont);\r\n    end;\r\n\r\n    if HasDateTimeSub then\r\n    begin\r\n      if IsDateTimeSub(AValue) then\r\n      begin\r\n        {$IFDEF FMXLIB}\r\n        case AKind of\r\n          ikTimeLineLeft: AGraphics.Font.Size := TimeLineAppearance.LeftSubUnitFontSize;\r\n          ikTimeLineRight: AGraphics.Font.Size := TimeLineAppearance.RightSubUnitFontSize;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        case AKind of\r\n          ikTimeLineLeft: AGraphics.Font.Size := Round(TimeLineAppearance.LeftSubUnitFontSize);\r\n          ikTimeLineRight: AGraphics.Font.Size := Round(TimeLineAppearance.RightSubUnitFontSize);\r\n        end;\r\n        {$ENDIF}\r\n\r\n        str := GetDateTimeText(AValue, True);\r\n        DoGetTimeText(AValue, ARow, True, AKind, str);\r\n        txtr := ARect;\r\n        InflateRectEx(txtr, -2, -2);\r\n        b := True;\r\n        DoBeforeDrawTimeText(AGraphics, txtr, AValue, ARow, True, AKind, str, b);\r\n        if b then\r\n        begin\r\n          case AKind of\r\n            ikTimeLineLeft:\r\n            begin\r\n              case TimeLineAppearance.LeftSubVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign);\r\n              end;\r\n            end;\r\n            ikTimeLineRight:\r\n            begin\r\n              case TimeLineAppearance.RightSubVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign);\r\n              end;\r\n            end;\r\n          end;\r\n          DoAfterDrawTimeText(AGraphics, txtr, AValue, ARow, True, AKind, str);\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        str := GetDateTimeText(AValue, False);\r\n        DoGetTimeText(AValue, ARow, False, AKind, str);\r\n        txtr := ARect;\r\n        InflateRectEx(txtr, -2, -2);\r\n        b := True;\r\n        DoBeforeDrawTimeText(AGraphics, txtr, AValue, ARow, False, AKind, str, b);\r\n        if b then\r\n        begin\r\n          case AKind of\r\n            ikTimeLineLeft:\r\n            begin\r\n              case TimeLineAppearance.LeftVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign);\r\n              end;\r\n            end;\r\n            ikTimeLineRight:\r\n            begin\r\n              case TimeLineAppearance.RightVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign);\r\n              end;\r\n            end;\r\n          end;\r\n          DoAfterDrawTimeText(AGraphics, txtr, AValue, ARow, False, AKind, str);\r\n        end;\r\n\r\n        {$IFDEF FMXLIB}\r\n        case AKind of\r\n          ikTimeLineLeft: AGraphics.Font.Size := TimeLineAppearance.LeftSubUnitFontSize;\r\n          ikTimeLineRight: AGraphics.Font.Size := TimeLineAppearance.RightSubUnitFontSize;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNWEBLIB}\r\n        case AKind of\r\n          ikTimeLineLeft: AGraphics.Font.Size := Round(TimeLineAppearance.LeftSubUnitFontSize);\r\n          ikTimeLineRight: AGraphics.Font.Size := Round(TimeLineAppearance.RightSubUnitFontSize);\r\n        end;\r\n        {$ENDIF}\r\n\r\n        str := GetDateTimeText(AValue, True);\r\n        DoGetTimeText(AValue, ARow, True, AKind, str);\r\n        txtr := ARect;\r\n        InflateRectEx(txtr, -2, -2);\r\n        b := True;\r\n        DoBeforeDrawTimeText(AGraphics, txtr, AValue, ARow, True, AKind, str, b);\r\n        if b then\r\n        begin\r\n          case AKind of\r\n            ikTimeLineLeft:\r\n            begin\r\n              case TimeLineAppearance.LeftSubVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftSubHorizontalTextAlign, TimeLineAppearance.LeftSubVerticalTextAlign);\r\n              end;\r\n            end;\r\n            ikTimeLineRight:\r\n            begin\r\n              case TimeLineAppearance.RightSubVerticalTextMode of\r\n                pvtmAuto:\r\n                begin\r\n                  case OrientationMode of\r\n                    pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign, gttNone, -90);\r\n                    pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign)\r\n                  end;\r\n                end;\r\n                pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign, gttNone, -90);\r\n                pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightSubHorizontalTextAlign, TimeLineAppearance.RightSubVerticalTextAlign);\r\n              end;\r\n            end;\r\n          end;\r\n          DoAfterDrawTimeText(AGraphics, txtr, AValue, ARow, True, AKind, str);\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      str := GetDateTimeText(AValue, False);\r\n      DoGetTimeText(AValue, ARow, False, AKind, str);\r\n      txtr := ARect;\r\n      InflateRectEx(txtr, -2, -2);\r\n      b := True;\r\n      DoBeforeDrawTimeText(AGraphics, txtr, AValue, ARow, False, AKind, str, b);\r\n      if b then\r\n      begin\r\n        case AKind of\r\n          ikTimeLineLeft:\r\n          begin\r\n            case TimeLineAppearance.LeftVerticalTextMode of\r\n              pvtmAuto:\r\n              begin\r\n                case OrientationMode of\r\n                  pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign, gttNone, -90);\r\n                  pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign)\r\n                end;\r\n              end;\r\n              pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign, gttNone, -90);\r\n              pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.LeftHorizontalTextAlign, TimeLineAppearance.LeftVerticalTextAlign);\r\n            end;\r\n          end;\r\n          ikTimeLineRight:\r\n          begin\r\n            case TimeLineAppearance.RightVerticalTextMode of\r\n              pvtmAuto:\r\n              begin\r\n                case OrientationMode of\r\n                  pomHorizontal: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign, gttNone, -90);\r\n                  pomVertical: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign)\r\n                end;\r\n              end;\r\n              pvtmAlways: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign, gttNone, -90);\r\n              pvtmNone: AGraphics.DrawText(txtr, str, False, TimeLineAppearance.RightHorizontalTextAlign, TimeLineAppearance.RightVerticalTextAlign);\r\n            end;\r\n          end;\r\n        end;\r\n        DoAfterDrawTimeText(AGraphics, txtr, AValue, ARow, False, AKind, str);\r\n      end;\r\n    end;\r\n    DoAfterDrawTime(AGraphics, ARect, AValue, ARow, AKind);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DrawTimeLine(AGraphics: TTMSFNCGraphics);\r\nbegin\r\n  DrawDisplay(AGraphics, FTimeLineLeftDisplay);\r\n  DrawDisplay(AGraphics, FTimeLineRightDisplay);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionBottomLeftEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetPositionsBottomRect;\r\n  if (pnbPrevious in Interaction.BottomNavigationButtons) then\r\n    nr := GetBottomLeftNavigationButtonRect\r\n  else\r\n    nr := LocalRect;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      if (pnbPrevious in Interaction.BottomNavigationButtons) then\r\n        Result.Top := nr.Bottom\r\n      else\r\n        Result.Top := nr.Top;\r\n\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := ptr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      if (pnbPrevious in Interaction.BottomNavigationButtons) then\r\n        Result.Left := nr.Right\r\n      else\r\n        Result.Left := nr.Left;\r\n\r\n      Result.Right := ptr.Left;\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetActiveItem: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := ActiveItem;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetBottomLeftNavigationButtonRect: TRectF;\r\nvar\r\n  s: Single;\r\n  cr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not (pnbPrevious in Interaction.BottomNavigationButtons) then\r\n    Exit;\r\n\r\n  Result := GetPositionsBottomRect;\r\n  cr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      s := PositionsAppearance.BottomLeftNavigationButtonSize;\r\n      Result.Top := cr.Top;\r\n      Result.Bottom := Result.Top + s + 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      s := PositionsAppearance.BottomLeftNavigationButtonSize;\r\n      Result.Left := cr.Left;\r\n      Result.Right := Result.Left + s + 1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionBottomRightEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetPositionsBottomRect;\r\n  if (pnbNext in Interaction.BottomNavigationButtons) then\r\n    nr := GetBottomRightNavigationButtonRect\r\n  else\r\n    nr := LocalRect;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := ptr.Bottom;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      if (pnbNext in Interaction.BottomNavigationButtons) then\r\n        Result.Bottom := nr.Top\r\n      else\r\n        Result.Bottom := nr.Bottom;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := ptr.Right;\r\n      if (pnbNext in Interaction.BottomNavigationButtons) then\r\n        Result.Right := nr.Left\r\n      else\r\n        Result.Right := nr.Right - 1;\r\n\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetBottomRightNavigationButtonRect: TRectF;\r\nvar\r\n  s: Single;\r\n  cr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not (pnbNext in Interaction.BottomNavigationButtons) then\r\n    Exit;\r\n\r\n  Result := GetPositionsBottomRect;\r\n  cr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      s := PositionsAppearance.BottomRightNavigationButtonSize;\r\n      Result.Top := cr.Bottom - s - 1;\r\n      Result.Bottom := cr.Bottom - 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      s := PositionsAppearance.BottomRightNavigationButtonSize;\r\n      Result.Left := cr.Right - s - 1;\r\n      Result.Right := cr.Right - 1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheHeight: Integer;\r\nbegin\r\n  Result := CACHEHEIGHT;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemDeleteRect(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  sz: Double;\r\nbegin\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  Result := ACacheItem.DrawRect;\r\n  sz := ItemsAppearance.DeleteAreaSize;\r\n  case OrientationMode of\r\n    pomHorizontal: Result := RectF(Result.Right - sz, Result.Top, Result.Right, Result.Top + sz);\r\n    pomVertical: Result := RectF(Result.Right - sz, Result.Top, Result.Right, Result.Top + sz);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemEndTimeSizeRect(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  sz: Double;\r\nbegin\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  Result := ACacheItem.DrawRect;\r\n  sz := ItemsAppearance.SizeAreaSize;\r\n  case OrientationMode of\r\n    pomHorizontal: Result := RectF(Result.Right - sz, Result.Top, Result.Right, Result.Bottom);\r\n    pomVertical: Result := RectF(Result.Left, Result.Bottom - sz, Result.Right, Result.Bottom);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemMoveRect(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  sz: Double;\r\nbegin\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  Result := ACacheItem.DrawRect;\r\n  sz := ItemsAppearance.MoveAreaSize;\r\n  case OrientationMode of\r\n    pomHorizontal: Result := RectF(Result.Left, Result.Top, Result.Right, Result.Top + sz);\r\n    pomVertical: Result := RectF(Result.Left, Result.Top, Result.Left + sz, Result.Bottom);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemRect(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  ARect: TRectF;\r\n  it: TTMSFNCPlannerItem;\r\n  sz: Double;\r\n  sr, mr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  if not Assigned(ACacheItem.Item) then\r\n    Exit;\r\n\r\n  it := ACacheItem.Item;\r\n  ARect := ACacheItem.DrawRect;\r\n\r\n  if it.Movable and CanMoveCacheItem(ACacheItem) and ItemsAppearance.ShowMoveArea and AllowDesktopMove and not Interaction.ReadOnly then\r\n  begin\r\n    sz := ItemsAppearance.MoveAreaSize;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        mr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n        ARect.Top := mr.Bottom + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        mr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n        ARect.Left := mr.Right + 1;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if (ACacheItem.Idx = 0) and CanSizeCacheItemStartTime(ACacheItem) and ItemsAppearance.ShowSizeArea and AllowDesktopSize and it.Sizeable and not Interaction.ReadOnly then\r\n  begin\r\n    sz := ItemsAppearance.SizeAreaSize;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        sr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n        ARect.Left := sr.Right + 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        sr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n        ARect.Top := sr.Bottom + 1;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if (ACacheItem.Idx = TTMSFNCPlannerItemOpen(it).CacheList.Count - 1) and CanSizeCacheItemEndTime(ACacheItem) and it.Sizeable and ItemsAppearance.ShowSizeArea and AllowDesktopSize and not Interaction.ReadOnly then\r\n  begin\r\n    sz := ItemsAppearance.SizeAreaSize;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Bottom);\r\n        ARect.Right := sr.Left - 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        sr := RectF(ARect.Left, ARect.Bottom - sz, ARect.Right, ARect.Bottom);\r\n        ARect.Bottom := sr.Top - 1;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  Result := ARect;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemStartTimeSizeRect(\r\n  ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  sz: Double;\r\nbegin\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  Result := ACacheItem.DrawRect;\r\n  sz := ItemsAppearance.SizeAreaSize;\r\n  case OrientationMode of\r\n    pomHorizontal: Result := RectF(Result.Left, Result.Top, Result.Left + sz, Result.Bottom);\r\n    pomVertical: Result := RectF(Result.Left, Result.Top, Result.Right, Result.Top + sz);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheWidth: Integer;\r\nbegin\r\n  Result := CACHEWIDTH\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCalculationRect: TRectF;\r\nbegin\r\n  Result := inherited GetCalculationRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := Result.Left + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Top := Result.Top + GetTimeLineLeftSize;\r\n      Result.Right := Result.Right - GetPositionsBottomSize - GetGroupsBottomSize;\r\n      Result.Bottom := Result.Bottom - GetTimeLineRightSize;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := Result.Top + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Left := Result.Left + GetTimeLineLeftSize;\r\n      Result.Bottom := Result.Bottom - GetPositionsBottomSize - GetGroupsBottomSize;\r\n      Result.Right := Result.Right - GetTimeLineRightSize;\r\n    end;\r\n  end;\r\n\r\n  Result.Right := Result.Left + Max(0, Result.Right - Result.Left);\r\n  Result.Bottom := Result.Top + Max(0, Result.Bottom - Result.Top);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetContentClipRect: TRectF;\r\nbegin\r\n  Result := GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Bottom := Result.Top + Min(GetTotalColumnWidth, Result.Bottom - Result.Top);\r\n      Result.Right := Result.Left + Min(GetTotalRowHeight, Result.Right - Result.Left);\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Bottom := Result.Top + Min(GetTotalRowHeight, Result.Bottom - Result.Top);\r\n      Result.Right := Result.Left + Min(GetTotalColumnWidth, Result.Right - Result.Left);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetContentRect: TRectF;\r\nbegin\r\n  Result := inherited GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := Result.Left + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Top := Result.Top + GetTimeLineLeftSize;\r\n      Result.Right := Result.Right - GetPositionsBottomSize - GetGroupsBottomSize;\r\n      Result.Bottom := Result.Bottom - GetTimeLineRightSize;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := Result.Top + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Left := Result.Left + GetTimeLineLeftSize;\r\n      Result.Bottom := Result.Bottom - GetPositionsBottomSize - GetGroupsBottomSize;\r\n      Result.Right := Result.Right - GetTimeLineRightSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.CurrentTime: TDateTime;\r\nbegin\r\n  case Mode of\r\n    pmMonth, pmMultiMonth, pmDayPeriod, pmDay: Result := EncodeDate(YearOf(FDisplayStartTime), MonthOf(FDisplayStartTime), Min(DaysInMonth(FDisplayStartTime), DayOf(Now))) + Frac(Now);\r\n    pmCustom: Result := Now\r\n    else\r\n      Result := Int(FDisplayStartTime) + Frac(Now);\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDateTimeText(ADateTime: TDateTime; ASub: Boolean): String;\r\nbegin\r\n  case GetDisplayMode of\r\n    pmMultiMonth: Result := FloatToStr(ADateTime);\r\n    else\r\n    begin\r\n      if ASub then\r\n        Result := FormatDateTime(GetDisplaySubUnitFormat, ADateTime)\r\n      else\r\n        Result := FormatDateTime(GetDisplayUnitFormat, ADateTime)\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDefaultItem: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := DefaultItem;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDeleteHandler: TTMSFNCPlannerDeleteHandler;\r\nbegin\r\n  if not FDeleteHandlerCreated then\r\n  begin\r\n    FDeletePanel := TTMSFNCPlannerDeleteHandlerPanel.Create(Self);\r\n    FDeletePanel.Planner := Self;\r\n    FDeleteHandlerCreated := True;\r\n  end;\r\n\r\n  Result.Background := FDeletePanel;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDisplaySubUnitFormat: String;\r\nbegin\r\n  if TimeLine.DisplaySubUnitFormat <> '' then\r\n    Result := TimeLine.DisplaySubUnitFormat\r\n  else\r\n  begin\r\n    case GetDisplayMode of\r\n      pmHalfDayPeriod: Result := 'hh:nn';\r\n      pmDay, pmDayPeriod, pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := 'nn';\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDisplayMode: TTMSFNCPlannerMode;\r\nbegin\r\n  Result := Mode;\r\n  case Result of\r\n    pmMultiResDay:\r\n    begin\r\n      if Resources.Count = 0 then\r\n        Result := pmDay;\r\n    end;\r\n    pmMultiDayRes:\r\n    begin\r\n      if Resources.Count = 0 then\r\n        Result := pmMultiDay;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDisplayOffsetValue: TDateTime;\r\nvar\r\n  du: Integer;\r\nbegin\r\n  du := TimeLine.DisplayOffset;\r\n  case TimeLine.DisplayOffsetType of\r\n    pduMilliSecond: Result := IncMilliSecond(0, du);\r\n    pduSecond: Result := IncSecond(0, du);\r\n    pduMinute: Result := IncMinute(0, du);\r\n    pduHour: Result := IncHour(0, du);\r\n    pduDay: Result := IncDay(0, du);\r\n    else\r\n      Result := 0;\r\n  end\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDisplayUnitFormat: String;\r\nbegin\r\n  if TimeLine.DisplayUnitFormat <> '' then\r\n    Result := TimeLine.DisplayUnitFormat\r\n  else\r\n  begin\r\n    {$IFNDEF WEBLIB}\r\n    case GetDisplayMode of\r\n      pmCustom: Result := FormatSettings.ShortDateFormat + ' ' + FormatSettings.ShortTimeFormat;\r\n      pmDayPeriod, pmHalfDayPeriod: Result := FormatSettings.ShortDateFormat;\r\n      pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := 'h';\r\n      pmMonth: Result := FormatSettings.ShortDateFormat;\r\n    end;\r\n    {$ENDIF}\r\n    {$IFDEF WEBLIB}\r\n    case GetDisplayMode of\r\n      pmCustom: Result := ShortDateFormat + ' ' + ShortTimeFormat;\r\n      pmDayPeriod, pmHalfDayPeriod: Result := ShortDateFormat;\r\n      pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := 'h';\r\n      pmMonth: Result := ShortDateFormat;\r\n    end;\r\n    {$ENDIF}\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDisplayUnitValue: TDateTime;\r\nvar\r\n  du: Integer;\r\nbegin\r\n  du := TimeLine.DisplayUnit;\r\n  case TimeLine.DisplayUnitType of\r\n    pduMilliSecond: Result := IncMilliSecond(0, du);\r\n    pduSecond: Result := IncSecond(0, du);\r\n    pduMinute: Result := IncMinute(0, du);\r\n    pduHour: Result := IncHour(0, du);\r\n    pduDay: Result := IncDay(0, du);\r\n    else\r\n      Result := 0;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetFirstRect(AItem: TTMSFNCPlannerItem): TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if Assigned(AItem) and (TTMSFNCPlannerItemOpen(AItem).CacheList.Count > 0) then\r\n    Result := TTMSFNCPlannerItemOpen(AItem).CacheList[TTMSFNCPlannerItemOpen(AItem).CacheList.Count - 1].DrawRect;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupBottomLeftEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetGroupsBottomRect;\r\n  nr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := nr.Top;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := ptr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := nr.Left;\r\n      Result.Right := ptr.Left;\r\n      Result.Bottom := nr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupBottomRightEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetGroupsBottomRect;\r\n  nr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := ptr.Bottom;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := nr.Bottom;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := ptr.Right;\r\n      Result.Right := nr.Right;\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupsBottomRect: TRectF;\r\nbegin\r\n  Result := GetPositionsBottomRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := Result.Right;\r\n      Result.Right := Result.Left + GetGroupsBottomSize\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := Result.Bottom;\r\n      Result.Bottom := Result.Top + GetGroupsBottomSize\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupsBottomSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if (pglBottom in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (ColumnCount > 0) then\r\n    Result := GroupsAppearance.BottomSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupsTopRect: TRectF;\r\nbegin\r\n  Result := GetPositionsTopRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Right := Result.Left;\r\n      Result.Left := Result.Right - GetGroupsTopSize;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Bottom := Result.Top;\r\n      Result.Top := Result.Top - GetGroupsTopSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupsTopSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if (pglTop in GroupsAppearance.Layouts) and (FDisplayGroups.Count > 0) and (ColumnCount > 0) then\r\n    Result := GroupsAppearance.TopSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupText(AGroup: Integer): String;\r\nvar\r\n  p: Double;\r\nbegin\r\n  Result := TranslateTextEx(sTMSFNCPlannerGroup) + ' ' + inttostr(AGroup);\r\n  case GetDisplayMode of\r\n    pmMultiResDay:\r\n    begin\r\n      if ColumnCount > 0 then\r\n      begin\r\n        p := IncDay(FDisplayStartTime, AGroup mod ColumnCount);\r\n        if Positions.Format <> '' then\r\n          Result := FormatDateTime(Positions.Format, p)\r\n        else\r\n          Result := FormatDateTime('dddd', p)\r\n      end;\r\n    end;\r\n    pmMultiDayRes:\r\n    begin\r\n      if (AGroup >= 0) and (AGroup <= Resources.Count - 1) then\r\n        Result := TTMSFNCPlannerResourceOpen(Resources[AGroup]).GetText;\r\n    end\r\n    else\r\n    begin\r\n      if (AGroup >= 0) and (AGroup <= Groups.Count - 1) then\r\n        Result := TTMSFNCPlannerGroupOpen(Groups[AGroup]).GetText;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupTopLeftEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetGroupsTopRect;\r\n  nr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := nr.Top;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := ptr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := nr.Left;\r\n      Result.Right := ptr.Left;\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetGroupTopRightEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetGroupsTopRect;\r\n  nr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := ptr.Bottom;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := nr.Bottom;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := ptr.Right;\r\n      Result.Right := nr.Right;\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetInplaceEditor: TTMSFNCPlannerInplaceEditor;\r\nbegin\r\n  Result := FInplaceEditor;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetInplaceEditorRect(ACacheItem: TTMSFNCPlannerCacheItem; AItem: TTMSFNCPlannerItem): TRectF;\r\nvar\r\n  it: TTMSFNCPlannerItemOpen;\r\n  cr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  it := nil;\r\n  if Assigned(AItem) then\r\n    it := TTMSFNCPlannerItemOpen(AItem);\r\n\r\n  case Interaction.InplaceEditorMode of\r\n    piemText:\r\n    begin\r\n      if Assigned(ACacheItem) then\r\n        Result := GetCacheItemTextRect(ACacheItem)\r\n      else if Assigned(it) and (it.CacheList.Count > 0) then\r\n        Result := GetCacheItemTextRect(it.CacheList[it.CacheList.Count - 1]);\r\n    end;\r\n    piemTitle:\r\n    begin\r\n      if Assigned(ACacheItem) then\r\n        Result := GetCacheItemTitleRect(ACacheItem)\r\n      else if Assigned(it) and (it.CacheList.Count > 0) then\r\n        Result := GetCacheItemTitleRect(it.CacheList[it.CacheList.Count - 1]);\r\n    end;\r\n    piemItem:\r\n    begin\r\n      if Assigned(ACacheItem) then\r\n        Result := GetCacheItemRect(ACacheItem)\r\n      else if Assigned(it) and (it.CacheList.Count > 0) then\r\n        Result := GetCacheItemRect(it.CacheList[it.CacheList.Count - 1]);\r\n    end;\r\n  end;\r\n\r\n  cr := GetContentClipRect;\r\n  Result.Top := Max(Result.Top, cr.Top);\r\n  Result.Bottom := Min(Result.Bottom, cr.Bottom);\r\n  Result.Left := Max(Result.Left, cr.Left);\r\n  Result.Right := Min(Result.Right, cr.Right);\r\n  Result := RectF(Floor(Result.Left), Floor(Result.Top), Floor(Result.Right), Floor(Result.Bottom));\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemTextRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  ARect: TRectF;\r\n  it: TTMSFNCPlannerItem;\r\n  g: TTMSFNCGraphics;\r\n  th: Double;\r\n  str: String;\r\n  sz: Double;\r\n  sr, mr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  if not Assigned(ACacheItem.Item) then\r\n    Exit;\r\n\r\n  g := TTMSFNCGraphics.CreateBitmapCanvas;\r\n  try\r\n    it := ACacheItem.Item;\r\n    ARect := ACacheItem.DrawRect;\r\n\r\n    if it.Movable and CanMoveCacheItem(ACacheItem) and ItemsAppearance.ShowMoveArea and AllowDesktopMove and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.MoveAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          mr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          ARect.Top := mr.Bottom + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          mr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n          ARect.Left := mr.Right + 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if (ACacheItem.Idx = 0) and CanSizeCacheItemStartTime(ACacheItem) and ItemsAppearance.ShowSizeArea and AllowDesktopSize and it.Sizeable and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.SizeAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n          ARect.Left := sr.Right + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          ARect.Top := sr.Bottom + 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if (ACacheItem.Idx = TTMSFNCPlannerItemOpen(it).CacheList.Count - 1) and CanSizeCacheItemEndTime(ACacheItem) and it.Sizeable and ItemsAppearance.ShowSizeArea and AllowDesktopSize and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.SizeAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Bottom);\r\n          ARect.Right := sr.Left - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Bottom - sz, ARect.Right, ARect.Bottom);\r\n          ARect.Bottom := sr.Top - 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    Result := ARect;\r\n\r\n    str := it.Title;\r\n    DoGetItemTitleText(it, pgtmDrawing, str);\r\n    if (str <> '') and it.ShowTitle then\r\n    begin\r\n      if it.Enabled then\r\n      begin\r\n        if FSelectedItems.IndexOf(it) > -1 then\r\n        begin\r\n          if it = FActiveItem then\r\n            g.Font.Assign(ItemsAppearance.ActiveTitleFont)\r\n          else\r\n            g.Font.Assign(ItemsAppearance.SelectedTitleFont)\r\n        end\r\n        else\r\n          g.Font.Assign(ItemsAppearance.TitleFont);\r\n      end\r\n      else\r\n        g.Font.Assign(ItemsAppearance.DisabledTitleFont);\r\n\r\n      th := Min(g.CalculateTextHeight(str) + 5, ARect.Bottom - ARect.Top);\r\n\r\n      Result.Top := Result.Top + th;\r\n    end;\r\n  finally\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetCacheItemTitleRect(ACacheItem: TTMSFNCPlannerCacheItem): TRectF;\r\nvar\r\n  ARect: TRectF;\r\n  it: TTMSFNCPlannerItem;\r\n  th: Double;\r\n  str: String;\r\n  sz: Double;\r\n  sr, mr: TRectF;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not Assigned(ACacheItem) then\r\n    Exit;\r\n\r\n  if not Assigned(ACacheItem.Item) then\r\n    Exit;\r\n\r\n  g := TTMSFNCGraphics.CreateBitmapCanvas;\r\n  try\r\n    it := ACacheItem.Item;\r\n    ARect := ACacheItem.DrawRect;\r\n\r\n    if it.Movable and CanMoveCacheItem(ACacheItem) and ItemsAppearance.ShowMoveArea and AllowDesktopMove and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.MoveAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          mr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          ARect.Top := mr.Bottom + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          mr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n          ARect.Left := mr.Right + 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if (ACacheItem.Idx = 0) and CanSizeCacheItemStartTime(ACacheItem) and ItemsAppearance.ShowSizeArea and AllowDesktopSize and it.Sizeable and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.SizeAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Top, ARect.Left + sz, ARect.Bottom);\r\n          ARect.Left := sr.Right + 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Top, ARect.Right, ARect.Top + sz);\r\n          ARect.Top := sr.Bottom + 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if (ACacheItem.Idx = TTMSFNCPlannerItemOpen(it).CacheList.Count - 1) and CanSizeCacheItemEndTime(ACacheItem) and it.Sizeable and ItemsAppearance.ShowSizeArea and AllowDesktopSize and not Interaction.ReadOnly then\r\n    begin\r\n      sz := ItemsAppearance.SizeAreaSize;\r\n      case OrientationMode of\r\n        pomHorizontal:\r\n        begin\r\n          sr := RectF(ARect.Right - sz, ARect.Top, ARect.Right, ARect.Bottom);\r\n          ARect.Right := sr.Left - 1;\r\n        end;\r\n        pomVertical:\r\n        begin\r\n          sr := RectF(ARect.Left, ARect.Bottom - sz, ARect.Right, ARect.Bottom);\r\n          ARect.Bottom := sr.Top - 1;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    Result := ARect;\r\n\r\n    str := it.Title;\r\n    DoGetItemTitleText(it, pgtmDrawing, str);\r\n    if (str <> '') and it.ShowTitle then\r\n    begin\r\n      if it.Enabled then\r\n      begin\r\n        if FSelectedItems.IndexOf(it) > -1 then\r\n        begin\r\n          if it = FActiveItem then\r\n            g.Font.Assign(ItemsAppearance.ActiveTitleFont)\r\n          else\r\n            g.Font.Assign(ItemsAppearance.SelectedTitleFont)\r\n        end\r\n        else\r\n          g.Font.Assign(ItemsAppearance.TitleFont);\r\n      end\r\n      else\r\n        g.Font.Assign(ItemsAppearance.DisabledTitleFont);\r\n\r\n      th := Min(g.CalculateTextHeight(str) + 5, ARect.Bottom - ARect.Top);\r\n\r\n      Result.Bottom := Result.Top + th;\r\n    end;\r\n  finally\r\n    g.Free;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetLastRect(AItem: TTMSFNCPlannerItem): TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if Assigned(AItem) and (TTMSFNCPlannerItemOpen(AItem).CacheList.Count > 0) then\r\n    Result := TTMSFNCPlannerItemOpen(AItem).CacheList[0].DrawRect;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetMaxDisplayUnitValue: Double;\r\nvar\r\n  du: Double;\r\nbegin\r\n  Result := 0;\r\n  du := TimeLine.DisplayUnit;\r\n  if du > 0 then\r\n  begin\r\n    case GetDisplayMode of\r\n      pmMultiMonth: Result := 31;\r\n      pmMultiDay, pmMultiResDay, pmMultiDayRes:\r\n      begin\r\n        case TimeLine.DisplayUnitType of\r\n          pduMilliSecond: Result := MSecsPerDay / du;\r\n          pduSecond: Result := SecsPerDay / du;\r\n          pduMinute: Result := MinsPerDay / du;\r\n          pduHour: Result := HoursPerDay / du;\r\n          pduDay: Result := 1;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetMaxPositionResources: Integer;\r\nbegin\r\n  case GetDisplayMode of\r\n    pmMultiDayRes: Result := Resources.Count;\r\n    pmMultiResDay: Result := Resources.Count;\r\n    else\r\n      Result := ColumnCount;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetModeName(AMode: TTMSFNCPlannerMode): String;\r\nbegin\r\n  case AMode of\r\n    pmDay: Result := 'Day';\r\n    pmDayPeriod: Result := 'Day Period';\r\n    pmHalfDayPeriod: Result := 'Half Day Period';\r\n    pmMultiDay: Result := 'Multi Day';\r\n    pmMultiResDay: Result := 'Multi Resource Day';\r\n    pmMultiDayRes: Result := 'Multi Day Resource';\r\n    pmMonth: Result := 'Month';\r\n    pmMultiMonth: Result := 'Multi Month';\r\n    pmCustom: Result := 'Custom';\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.GetNewDateTimeAndResource(\r\n  AItem: TTMSFNCPlannerItem; ALinkType: TTMSFNCPlannerItemLinkType;\r\n  ADiffStartDateTime, ADiffEndDateTime: TDateTime; var AStartDateTime, AEndDateTime: TDateTime);\r\nbegin\r\n  case ALinkType of\r\n    iltFull:\r\n    begin\r\n      AStartDateTime := AItem.StartTime + ADiffStartDateTime;\r\n      AEndDateTime := AItem.EndTime + ADiffEndDateTime;\r\n    end;\r\n    iltStartEnd:\r\n    begin\r\n     AStartDateTime := AItem.StartTime + ADiffStartDateTime;\r\n     AEndDateTime := AItem.EndTime + ADiffStartDateTime;\r\n    end;\r\n    iltEndStart:\r\n    begin\r\n      AStartDateTime := AItem.StartTime + ADiffEndDateTime;\r\n      AEndDateTime := AItem.EndTime + ADiffEndDateTime;\r\n    end;\r\n    iltEndEnd:\r\n    begin\r\n      AStartDateTime := AItem.StartTime;\r\n      AEndDateTime := AItem.EndTime + ADiffEndDateTime;\r\n    end;\r\n    iltStartStart:\r\n    begin\r\n      AStartDateTime := AItem.StartTime + ADiffStartDateTime;\r\n      AEndDateTime := AItem.EndTime;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetNextDateTime: TDateTime;\r\nbegin\r\n  Result := ModeSettings.StartTime;\r\n  case GetDisplayMode of\r\n    pmMultiMonth: Result := IncMonth(Result, 1);\r\n    else\r\n      Result := IncDay(Result, 1)\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetNumDays: Integer;\r\nbegin\r\n  Result := Trunc(0.5 + (ColumnCount / Max(1, Resources.Count)));\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionResourceText(APosition: Integer): String;\r\nvar\r\n  p: Double;\r\nbegin\r\n  Result := TranslateTextEx(sTMSFNCPlannerPosition) + ' ' + inttostr(APosition);\r\n  case GetDisplayMode of\r\n    pmDay, pmHalfDayPeriod, pmDayPeriod, pmMonth, pmMultiResDay, pmCustom:\r\n    begin\r\n      if (GetDisplayMode = pmMultiResDay) then\r\n        APosition := APosition mod Max(1, Resources.Count);\r\n\r\n      if (APosition >= 0) and (APosition <= Resources.Count - 1) then\r\n      begin\r\n        Result := Resources[APosition].Text;\r\n        if (Result = '') or (AnsiPos('</', Result) > 0) or (AnsiPos('/>', Result) > 0) or (AnsiPos('<BR>', UpperCase(Result)) > 0) then\r\n        begin\r\n          Result := Resources[APosition].Name;\r\n          if Result = '' then\r\n            Result := TranslateTextEx(sTMSFNCPlannerPosition) + ' ' + inttostr(APosition);\r\n        end;\r\n      end;\r\n    end;\r\n    pmMultiDayRes:\r\n    begin\r\n      p := IncDay(FDisplayStartTime, APosition mod Max(1, GetNumDays));\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n    pmMultiDay:\r\n    begin\r\n      p := IncDay(FDisplayStartTime, APosition);\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n    pmMultiMonth:\r\n    begin\r\n      p := IncMonth(FDisplayStartTime, APosition);\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionFormat: String;\r\nbegin\r\n  if Positions.Format <> '' then\r\n    Result := Positions.Format\r\n  else\r\n  begin\r\n    case GetDisplayMode of\r\n      pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := 'dddd';\r\n      pmMultiMonth: Result := 'mmmmm';\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionsBottomRect: TRectF;\r\nvar\r\n  tlr, trr: TRectF;\r\nbegin\r\n  tlr := GetTimeLineLeftRect;\r\n  trr := GetTimeLineRightRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := tlr.Right;\r\n      Result.Top := tlr.Bottom;\r\n      Result.Right := tlr.Right + GetPositionsBottomSize;\r\n      Result.Bottom := trr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Left := tlr.Right;\r\n      Result.Top := tlr.Bottom;\r\n      Result.Right := trr.Left;\r\n      Result.Bottom := Result.Top + GetPositionsBottomSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionsBottomSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if (pplBottom in PositionsAppearance.Layouts) and (ColumnCount > 0) then\r\n    Result := PositionsAppearance.BottomSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTimeLineRightRect: TRectF;\r\nbegin\r\n  Result := inherited GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := Result.Left + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Right := Result.Left + Min(GetTotalRowHeight, (Result.Right - Result.Left) - GetPositionsBottomSize - GetGroupsBottomSize);\r\n      Result.Top := Result.Top + Min(GetTotalColumnWidth, (Result.Bottom - Result.Top) - GetTimeLineLeftSize - GetTimeLineRightSize) + GetTimeLineLeftSize;\r\n      Result.Bottom := Result.Top + GetTimeLineRightSize;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := Result.Top + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Bottom := Result.Top + Min(GetTotalRowHeight, (Result.Bottom - Result.Top) - GetPositionsBottomSize - GetGroupsBottomSize);\r\n      Result.Left := Result.Left + Min(GetTotalColumnWidth, (Result.Right - Result.Left) - GetTimeLineLeftSize - GetTimeLineRightSize) + GetTimeLineLeftSize;\r\n      Result.Right := Result.Left + GetTimeLineRightSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTimeLineRightSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if ptlRight in TimeLineAppearance.Layouts then\r\n    Result := TimeLineAppearance.RightSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionTopLeftEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetPositionsTopRect;\r\n  if (pnbPrevious in Interaction.TopNavigationButtons) then\r\n    nr := GetTopLeftNavigationButtonRect\r\n  else\r\n    nr := LocalRect;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      if (pnbPrevious in Interaction.TopNavigationButtons) then\r\n        Result.Top := nr.Bottom\r\n      else\r\n        Result.Top := nr.Top;\r\n\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      Result.Bottom := ptr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      if (pnbPrevious in Interaction.TopNavigationButtons) then\r\n        Result.Left := nr.Right\r\n      else\r\n        Result.Left := nr.Left;\r\n\r\n      Result.Right := ptr.Left;\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTopLeftNavigationButtonRect: TRectF;\r\nvar\r\n  cr: TRectF;\r\n  s: Single;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not (pnbPrevious in Interaction.TopNavigationButtons) then\r\n    Exit;\r\n\r\n  Result := GetPositionsTopRect;\r\n  cr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      s := PositionsAppearance.TopLeftNavigationButtonSize;\r\n      Result.Top := cr.Top;\r\n      Result.Bottom := cr.Top + s + 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      s := PositionsAppearance.TopLeftNavigationButtonSize;\r\n      Result.Left := cr.Left;\r\n      Result.Right := Result.Left + s + 1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionTopRightEmptyRect: TRectF;\r\nvar\r\n  ptr, nr: TRectF;\r\nbegin\r\n  ptr := GetPositionsTopRect;\r\n  if (pnbNext in Interaction.TopNavigationButtons) then\r\n    nr := GetTopRightNavigationButtonRect\r\n  else\r\n    nr := LocalRect;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Top := ptr.Bottom;\r\n      Result.Left := ptr.Left;\r\n      Result.Right := ptr.Right;\r\n      if (pnbNext in Interaction.TopNavigationButtons) then\r\n        Result.Bottom := nr.Top\r\n      else\r\n        Result.Bottom := nr.Bottom;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := ptr.Top;\r\n      Result.Left := ptr.Right;\r\n      if (pnbNext in Interaction.TopNavigationButtons) then\r\n        Result.Right := nr.Left\r\n      else\r\n        Result.Right := nr.Right - 1;\r\n\r\n      Result.Bottom := ptr.Bottom;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTopRightNavigationButtonRect: TRectF;\r\nvar\r\n  s: Single;\r\n  cr: TRectF;\r\nbegin\r\n  Result := RectF(0, 0, 0, 0);\r\n  if not (pnbNext in Interaction.TopNavigationButtons) then\r\n    Exit;\r\n\r\n  Result := GetPositionsTopRect;\r\n  cr := LocalRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      s := PositionsAppearance.TopRightNavigationButtonSize;\r\n      Result.Top := cr.Bottom - s - 1;\r\n      Result.Bottom := cr.Bottom - 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      s := PositionsAppearance.TopRightNavigationButtonSize;\r\n      Result.Left := cr.Right - s - 1;\r\n      Result.Right := cr.Right - 1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetDocURL: string;\r\nbegin\r\n  Result := TTMSFNCPlannerDocURL;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetVersion: string;\r\nbegin\r\n  Result := GetVersionNumber(MAJ_VER, MIN_VER, REL_VER, BLD_VER);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetViewCol: Integer;\r\nbegin\r\n  Result := StartCol;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetViewRow: Integer;\r\nbegin\r\n  Result := StartRow;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionsTopRect: TRectF;\r\nvar\r\n  tlr, trr: TRectF;\r\nbegin\r\n  tlr := GetTimeLineLeftRect;\r\n  trr := GetTimeLineRightRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := tlr.Left - GetPositionsTopSize;\r\n      Result.Top := tlr.Bottom;\r\n      Result.Right := tlr.Left;\r\n      Result.Bottom := trr.Top;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Left := tlr.Right;\r\n      Result.Top := tlr.Top - GetPositionsTopSize;\r\n      Result.Right := trr.Left;\r\n      Result.Bottom := tlr.Top;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionsTopSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if (pplTop in PositionsAppearance.Layouts) and (ColumnCount > 0) then\r\n    Result := PositionsAppearance.TopSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPositionText(APosition: Integer): String;\r\nvar\r\n  p: Double;\r\nbegin\r\n  Result := TranslateTextEx(sTMSFNCPlannerPosition) + ' ' + inttostr(APosition);\r\n  case GetDisplayMode of\r\n    pmDay, pmHalfDayPeriod, pmDayPeriod, pmMonth, pmMultiResDay, pmCustom:\r\n    begin\r\n      if (GetDisplayMode = pmMultiResDay) then\r\n        APosition := APosition mod Max(1, Resources.Count);\r\n\r\n      if (APosition >= 0) and (APosition <= Resources.Count - 1) then\r\n      begin\r\n        Result := Resources[APosition].Text;\r\n        if Result = '' then\r\n        begin\r\n          Result := Resources[APosition].Name;\r\n          if Result = '' then\r\n            Result := TranslateTextEx(sTMSFNCPlannerPosition) + ' ' + inttostr(APosition);\r\n        end;\r\n      end;\r\n    end;\r\n    pmMultiDayRes:\r\n    begin\r\n      p := IncDay(FDisplayStartTime, APosition mod Max(1, GetNumDays));\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n    pmMultiDay:\r\n    begin\r\n      p := IncDay(FDisplayStartTime, APosition);\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n    pmMultiMonth:\r\n    begin\r\n      p := IncMonth(FDisplayStartTime, APosition);\r\n      Result := FormatDateTime(GetPositionFormat, p);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetPreviousDateTime: TDateTime;\r\nbegin\r\n  Result := ModeSettings.StartTime;\r\n  case GetDisplayMode of\r\n    pmMultiMonth: Result := IncMonth(Result, -1);\r\n    else\r\n      Result := IncDay(Result, -1)\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetResources: TStringList;\r\nvar\r\n  I: Integer;\r\nbegin\r\n  Result := TStringList.Create;\r\n  case GetDisplayMode of\r\n    pmDay, pmDayPeriod, pmHalfDayPeriod, pmMonth, pmCustom:\r\n    begin\r\n      for I := 0 to ColumnCount - 1 do\r\n        Result.Add(GetPositionResourceText(I));\r\n    end;\r\n    pmMultiResDay, pmMultiDayRes:\r\n    begin\r\n      for I := 0 to Resources.Count - 1 do\r\n        Result.Add(TTMSFNCPlannerResourceOpen(Resources[I]).GetResourceText);\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetResourcesAvailable: Boolean;\r\nbegin\r\n  Result := (GetDisplayMode <> pmMultiDay) and (GetDisplayMode <> pmMultiMonth);\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nfunction TTMSFNCCustomPlanner.GetSceneDrawingScale: TTMSFNCPlannerSceneDrawingScale;\r\nconst\r\n  BaseVector: TPointF = (X: 0; Y: 0);\r\nbegin\r\n  if Assigned(Scene) then\r\n    Result.SceneScale := Scene.GetSceneScale\r\n  else\r\n    Result.SceneScale := 1;\r\n\r\n  Result.DrawingScale.X := (PointF(1, 0) * AbsoluteMatrix).Distance(BaseVector * AbsoluteMatrix);\r\n  Result.DrawingScale.Y := (PointF(0, 1) * AbsoluteMatrix).Distance(BaseVector * AbsoluteMatrix);\r\nend;\r\n{$ENDIF}\r\n\r\nfunction TTMSFNCCustomPlanner.GetStartTimeSizeHandler: TTMSFNCPlannerSizeHandler;\r\nbegin\r\n  if not FStartTimeSizeHandlerCreated then\r\n  begin\r\n    FStartTimeSizePanel := TTMSFNCPlannerSizeHandlerPanel.Create(Self);\r\n    FStartTimeSizePanel.Planner := Self;\r\n    FStartTimeSizePanel.Kind := pshpkStartTime;\r\n    FStartTimeSizeHandlerCreated := True;\r\n  end;\r\n\r\n  Result.Background := FStartTimeSizePanel;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTimeLineLeftRect: TRectF;\r\nbegin\r\n  Result := inherited GetContentRect;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      Result.Left := Result.Left + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Right := Result.Left + Min(GetTotalRowHeight, (Result.Right - Result.Left) - GetPositionsBottomSize - GetGroupsBottomSize);\r\n      Result.Bottom := Result.Top + GetTimeLineLeftSize;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      Result.Top := Result.Top + GetPositionsTopSize + GetGroupsTopSize;\r\n      Result.Bottom := Result.Top + Min(GetTotalRowHeight, (Result.Bottom - Result.Top) - GetPositionsBottomSize - GetGroupsBottomSize);\r\n      Result.Right := Result.Left + GetTimeLineLeftSize;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetTimeLineLeftSize: Double;\r\nbegin\r\n  Result := 0;\r\n  if ptlLeft in TimeLineAppearance.Layouts then\r\n    Result := TimeLineAppearance.LeftSize;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.HandleAfterEvents: Boolean;\r\nvar\r\n  itc: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  Result := False;\r\n  if FCallAfterMoveEvent then\r\n  begin\r\n    FCallAfterMoveEvent := False;\r\n    if (FCallItemIndex >= 0) and (FCallItemIndex <= Items.Count - 1) then\r\n    begin\r\n      itc := TTMSFNCPlannerItemOpen(Items[FCallItemIndex]);\r\n      DoAfterMoveItem(itc, itc.StartTime, itc.EndTime, itc.CallPosition);\r\n      DoItemChanged(itc);\r\n      itc.UpdatingLinked := True;\r\n      CallAfterMoveLinkedItems(itc);\r\n      itc.UpdatingLinked := False;\r\n      Result := True;\r\n    end;\r\n    FCallItemIndex := -1;\r\n  end\r\n  else if FCallAfterSizeEvent then\r\n  begin\r\n    FCallAfterSizeEvent := False;\r\n    if (FCallItemIndex >= 0) and (FCallItemIndex <= Items.Count - 1) then\r\n    begin\r\n      itc := TTMSFNCPlannerItemOpen(Items[FCallItemIndex]);\r\n      DoAfterSizeItem(itc, itc.StartTime, itc.EndTime, itc.CallPosition);\r\n      DoItemChanged(itc);\r\n      itc.UpdatingLinked := True;\r\n      CallAfterSizeLinkedItems(itc);\r\n      itc.UpdatingLinked := False;\r\n      Result := True;\r\n    end;\r\n    FCallItemIndex := -1;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleCellSelection(ASelecting: Boolean = False);\r\nvar\r\n  p: Integer;\r\n  sta, ste: TDateTime;\r\nbegin\r\n  p := Selection.StartCell.Col;\r\n  sta := ValueToDateTime(RowPositions[Selection.StartCell.Row], p, Selection.StartCell.Row);\r\n  ste := ValueToDateTime(RowPositions[Selection.EndCell.Row + 1], p, Selection.EndCell.Row + 1);\r\n  if ASelecting then\r\n  begin\r\n    DoSelectingCell(Selection.StartCell, Selection.EndCell);\r\n    DoSelectingTime(sta, ste, p);\r\n  end\r\n  else\r\n  begin\r\n    DoSelectCell(Selection.StartCell, Selection.EndCell);\r\n    DoSelectTime(sta, ste, p);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleDateTimeNavigation(\r\n  ADirection: TTMSFNCPlannerNavigationDirection; ACurrentDateTime, ANewDateTime: TDateTime);\r\nvar\r\n  b: Boolean;\r\nbegin\r\n  b := True;\r\n  DoBeforeNavigateToDateTime(ADirection, ACurrentDateTime, ANewDateTime, b);\r\n  if b then\r\n  begin\r\n    case ADirection of\r\n      pndPrevious:\r\n      begin\r\n        NavigateToPreviousDateTime(ANewDateTime);\r\n        case OrientationMode of\r\n          pomHorizontal: SetVScrollValue(0);\r\n          pomVertical: SetHScrollValue(0);\r\n        end;\r\n      end;\r\n      pndNext:\r\n      begin\r\n        NavigateToNextDateTime(ANewDateTime);\r\n        case OrientationMode of\r\n          pomHorizontal: SetVScrollValue(VerticalScrollBar.Max);\r\n          pomVertical: SetHScrollValue(HorizontalScrollBar.Max);\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    DoAfterNavigateToDateTime(ADirection, ACurrentDateTime, ANewDateTime);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleItemDelete(AItem: TTMSFNCPlannerItem; AMode: TTMSFNCPlannerItemDeleteMode);\r\nvar\r\n  b: Boolean;\r\n  idx: Integer;\r\n  k: String;\r\n  i: TTMSFNCPlannerItem;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    i := AItem.LinkedItem;\r\n    b := AItem.Deletable;\r\n    DoIsItemDeletable(AItem, b);\r\n    DoBeforeDeleteItem(AItem, AMode, b);\r\n    if b then\r\n    begin\r\n      FActiveItem := nil;\r\n      if Assigned(Adapter) then\r\n        Adapter.DeleteItem(AItem);\r\n\r\n      FSelectedItems.Remove(AItem);\r\n      idx := AItem.Index;\r\n      k := AItem.DBKey;\r\n      Items.Delete(AItem.Index);\r\n      UpdateSizeHandlers;\r\n      UpdateDeleteHandler;\r\n      DoAfterDeleteItem(idx, k, AMode);\r\n    end;\r\n\r\n    if Assigned(i) and Interaction.AutoDeleteLinkedItems then\r\n      HandleItemDelete(i, AMode);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleItemEditing(AItem: TTMSFNCPlannerItem; ACacheItem: TTMSFNCPlannerCacheItem = nil);\r\nvar\r\n  ins: Boolean;\r\n  sta, ste: TDateTime;\r\n  p: Integer;\r\n  {$IFNDEF LCLWEBLIB}\r\n  AContext: TRttiContext;\r\n  rt: TRttiType;\r\n  prop: TRttiProperty;\r\n  {$ENDIF}\r\n  t, n: String;\r\n  r: TRectF;\r\nbegin\r\n  if Assigned(AItem) and AItem.Editable then\r\n  begin\r\n    sta := AItem.StartTime;\r\n    ste := AItem.EndTime;\r\n    p := ItemToStartCell(AItem).Col;\r\n    case Interaction.UpdateMode of\r\n      pumInplace:\r\n      begin\r\n        ins := True;\r\n        DoBeforeOpenInplaceEditor(sta, ste, p, AItem, ins);\r\n        if ins then\r\n        begin\r\n          FInplaceEditorClass := nil;\r\n          DoGetInplaceEditor(sta, ste, p, AItem, FInplaceEditorClass);\r\n          if Assigned(FInplaceEditor) then\r\n          begin\r\n            FInplaceEditor.Free;\r\n            FInplaceEditor := nil;\r\n          end;\r\n\r\n          if Assigned(FInplaceEditorClass) then\r\n            FInplaceEditor := FInplaceEditorClass.Create(Self)\r\n          else\r\n          begin\r\n            FInplaceEditor := TTMSFNCPlannerMemo.Create(Self);\r\n            {$IFDEF FMXLIB}\r\n            FInplaceEditor.DisableFocusEffect := True;\r\n            FInplaceEditor.OnApplyStyleLookup := ApplyInplaceEditorStyleLookup;\r\n            {$ENDIF}\r\n            {$IFDEF WEBLIB}\r\n            FInplaceEditor.ShowFocus := False;\r\n            {$ENDIF}\r\n          end;\r\n\r\n          r := GetInplaceEditorRect(ACacheItem, AItem);\r\n          if Assigned(FInplaceEditor) then\r\n          begin\r\n            FUpdateItem := AItem.Index;\r\n            FInplaceEditor.Parent := Self;\r\n            {$IFDEF FMXLIB}\r\n            FInplaceEditor.BoundsRect := r;\r\n            {$ENDIF}\r\n            {$IFDEF CMNWEBLIB}\r\n            FInplaceEditor.BoundsRect := Bounds(Round(r.Left), Round(r.Top), Round(r.Right - r.Left), Round(r.Bottom - r.Top));\r\n            {$ENDIF}\r\n            if FInplaceEditor is TMemo then\r\n            begin\r\n              {$IFDEF FMXLIB}\r\n              (FInplaceEditor as TMemo).StyledSettings := [];\r\n              {$ENDIF}\r\n              case Interaction.InplaceEditorMode of\r\n                piemText, piemItem:\r\n                begin\r\n                  (FInplaceEditor as TMemo).Font.Assign(ItemsAppearance.ActiveFont);\r\n                  {$IFDEF FMXLIB}\r\n                  if not AItem.UseDefaultAppearance then\r\n                    (FInplaceEditor as TMemo).FontColor := AItem.ActiveFontColor\r\n                  else\r\n                    (FInplaceEditor as TMemo).FontColor := ItemsAppearance.ActiveFont.Color;                    \r\n                  {$ENDIF}\r\n                end;\r\n                piemTitle:\r\n                begin\r\n                  (FInplaceEditor as TMemo).Font.Assign(ItemsAppearance.ActiveTitleFont);\r\n                  {$IFDEF FMXLIB}\r\n                  if not AItem.UseDefaultAppearance then                  \r\n                    (FInplaceEditor as TMemo).FontColor := AItem.ActiveTitleFontColor\r\n                  else\r\n                    (FInplaceEditor as TMemo).FontColor := ItemsAppearance.ActiveTitleFont.Color;                    \r\n                  {$ENDIF}\r\n                end;\r\n              end;\r\n            end;\r\n\r\n            {$IFNDEF LCLWEBLIB}\r\n            AContext := TRttiContext.Create;\r\n            try\r\n              rt := AContext.GetType(FInplaceEditor.ClassInfo);\r\n              prop := rt.GetProperty('Text');\r\n            {$ENDIF}\r\n              case Interaction.InplaceEditorMode of\r\n                piemText, piemItem:\r\n                begin\r\n                  n := AItem.Text;\r\n                  DoGetItemText(AItem, pgtmEditing, n);\r\n                  {$IFNDEF LCLWEBLIB}\r\n                  if Assigned(Prop) then\r\n                    prop.SetValue(FInplaceEditor, n);\r\n                  {$ENDIF}\r\n                  {$IFDEF LCLWEBLIB}\r\n                  if FInplaceEditor is TEdit then\r\n                    (FInplaceEditor as TEdit).Text := n;\r\n                  if FInplaceEditor is TComboBox then\r\n                    (FInplaceEditor as TComboBox).Text := n;\r\n                  if FInplaceEditor is TMemo then\r\n                    (FInplaceEditor as TMemo).Text := n;\r\n                  {$ENDIF}\r\n                end;\r\n                piemTitle:\r\n                begin\r\n                  t := AItem.Title;\r\n                  DoGetItemTitleText(AItem, pgtmEditing, t);\r\n                  {$IFNDEF LCLWEBLIB}\r\n                  if Assigned(Prop) then\r\n                    prop.SetValue(FInplaceEditor, t);\r\n                  {$ENDIF}\r\n                  {$IFDEF LCLWEBLIB}\r\n                  if FInplaceEditor is TEdit then\r\n                    (FInplaceEditor as TEdit).Text := n;\r\n                  if FInplaceEditor is TComboBox then\r\n                    (FInplaceEditor as TComboBox).Text := n;\r\n                  if FInplaceEditor is TMemo then\r\n                    (FInplaceEditor as TMemo).Text := n;\r\n                  {$ENDIF}\r\n                end;\r\n              end;\r\n            {$IFNDEF LCLWEBLIB}\r\n            finally\r\n              AContext.Free;\r\n            end;\r\n            {$ENDIF}\r\n\r\n            if FInplaceEditor.CanFocus then\r\n              FInplaceEditor.SetFocus;\r\n\r\n            if FInplaceEditor is TMemo then\r\n              (FInplaceEditor as TMemo).SelStart := Length((FInplaceEditor as TMemo).Text);\r\n            FInplaceEditorActive := True;\r\n            AItem.UpdateItem;\r\n          end;\r\n\r\n          DoAfterOpenInplaceEditor(sta, ste, p, AItem, FInplaceEditor, r);\r\n        end;\r\n      end;\r\n      pumDialog:\r\n      begin\r\n        ins := True;\r\n        DoBeforeOpenUpdateDialog(sta, ste, p, AItem, ins);\r\n        if ins then\r\n        begin\r\n          t := AItem.Title;\r\n          DoGetItemTitleText(AItem, pgtmEditing, t);\r\n          n := AItem.Text;\r\n          DoGetItemText(AItem, pgtmEditing, n);\r\n          OpenEditingDialog(sta, ste, p, t, n, AItem.Index);\r\n          DoAfterOpenUpdateDialog(sta, ste, p, AItem);\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleItemInsert(ADialog: Boolean);\r\nvar\r\n  p: Integer;\r\n  sta, ste: TDateTime;\r\n  ins, s: Boolean;\r\n  it: TTMSFNCPlannerItem;\r\n  t, n: String;\r\nbegin\r\n  p := Selection.StartCell.Col;\r\n  sta := ValueToDateTime(RowPositions[Selection.StartCell.Row], p, Selection.StartCell.Row);\r\n  ste := ValueToDateTime(RowPositions[Selection.EndCell.Row + 1], p, Selection.EndCell.Row + 1);\r\n  if not ADialog then\r\n  begin\r\n    ins := True;\r\n    t := DefaultItem.Title;\r\n    n := DefaultItem.Text;\r\n\r\n    if not HasItem(sta, ste, p) then\r\n    begin\r\n      DoBeforeInsertItem(sta, ste, p, t, n, ins);\r\n      if ins then\r\n      begin\r\n        it := AddOrUpdateItem(PositionToResource(p), sta, ste, t, n);\r\n        DoAfterInsertItem(sta, ste, p, it);\r\n        s := it.Selectable and it.Enabled;\r\n        DoBeforeSelectItem(it, s);\r\n        if s then\r\n        begin\r\n          if Interaction.AutoSelectLinkedItems and Interaction.MultiSelect then\r\n            HandleSelectLinkedItems(it)\r\n          else\r\n            HandleSelectItem(it);\r\n\r\n          DoAfterSelectItem(it);\r\n        end;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    ins := True;\r\n    DoBeforeOpenInsertDialog(sta, ste, p, ins);\r\n    if ins then\r\n    begin\r\n      OpenEditingDialog(sta, ste, PositionToResource(p), DefaultItem.Title, DefaultItem.Text);\r\n      DoAfterOpenInsertDialog(sta, ste, p);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleItemKeyboardInteraction(AItem: TTMSFNCPlannerItem; ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState;\r\n  AColValue, ARowValue: Integer; AStartCell, AEndCell: TTMSFNCPlannerCell);\r\nvar\r\n  cls, cle, clssave: TTMSFNCPlannerCell;\r\n  res: Integer;\r\n  nst, net: TDateTime;\r\n  c: Boolean;\r\n  ps, pe, difc: Integer;\r\n  rs: Integer;\r\n  b: Boolean;\r\n  duration, deltae, deltas: Double;\r\n  dt: TDateTime;\r\nbegin\r\n  if Assigned(AItem) and (ADirection <> idNone) and not Interaction.ReadOnly then\r\n  begin\r\n    cls := AStartCell;\r\n    cle := AEndCell;\r\n    clssave := cls;\r\n\r\n    deltae := AItem.EndTime - CellToDateTime(cle);\r\n    deltas := AItem.StartTime - CellToDateTime(cls);\r\n\r\n    duration := AItem.EndTime - AItem.StartTime;\r\n\r\n    case ADirection of\r\n      idLeft:\r\n      begin\r\n        if (ssShift in AShift) then\r\n        begin\r\n          if (ssCtrl in AShift) and (cls.Col > 0) then\r\n            cls.Col := cls.Col + AColValue\r\n          else if not (ssCtrl in AShift) and (((cle.Row > cls.Row) and (cle.Col - cls.Col > 0)) or ((cle.Row <= cls.Row) and (cle.Col - cls.Col > 1))) then\r\n            cle.Col := cle.Col + AColValue;\r\n        end\r\n        else if (cls.Col > 0) then\r\n        begin\r\n          cls.Col := cls.Col + AColValue;\r\n          cle.Col := cle.Col + AColValue;\r\n        end;\r\n      end;\r\n      idRight:\r\n      begin\r\n        if (ssShift in AShift) then\r\n        begin\r\n          if (ssCtrl in AShift) and (((cle.Row > cls.Row) and (cle.Col - cls.Col > 0)) or ((cle.Row <= cls.Row) and (cle.Col - cls.Col > 1))) then\r\n            cls.Col := cls.Col + AColValue\r\n          else if not (ssCtrl in AShift) and (cle.Col < ColumnCount - 1) then\r\n            cle.Col := cle.Col + AColValue;\r\n        end\r\n        else if (cle.Col < ColumnCount - 1) then\r\n        begin\r\n          cls.Col := cls.Col + AColValue;\r\n          cle.Col := cle.Col + AColValue;\r\n        end;\r\n      end;\r\n      idUp:\r\n      begin\r\n        if ssShift in AShift then\r\n        begin\r\n          if (ssCtrl in AShift) and (cls.Row > 0) then\r\n            cls.Row := cls.Row + ARowValue\r\n          else if not (ssCtrl in AShift) and (cle.Row > 0) and ((cle.Row - cls.Row > 1) or (cle.Col - cls.Col > 0)) then\r\n            cle.Row := cle.Row + ARowValue;\r\n        end\r\n        else if cls.Row > 0 then\r\n        begin\r\n          cls.Row := cls.Row + ARowValue;\r\n          cle.Row := cle.Row + ARowValue;\r\n        end;\r\n      end;\r\n      idDown:\r\n      begin\r\n        if ssShift in AShift then\r\n        begin\r\n          if (ssCtrl in AShift) and (cls.Row < RowCount) and ((cle.Row - cls.Row > 1) or (cle.Col - cls.Col > 0)) then\r\n            cls.Row := cls.Row + ARowValue\r\n          else if not (ssCtrl in AShift) and (cle.Row < RowCount) then\r\n            cle.Row := cle.Row + ARowValue;\r\n        end\r\n        else if cle.Row < RowCount then\r\n        begin\r\n          cls.Row := cls.Row + ARowValue;\r\n          cle.Row := cle.Row + ARowValue;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if (GetDisplayMode = pmMultiDayRes) then\r\n    begin\r\n      ps := PositionToResource(cls.col);\r\n      pe := PositionToResource(cle.col);\r\n      difc := cle.Col - cls.Col;\r\n\r\n      if pe <> ps then\r\n      begin\r\n        case ADirection of\r\n          idLeft, idUp:\r\n          begin\r\n            cls.Col := cls.Col - difc;\r\n            cle.Col := cle.Col - difc;\r\n          end;\r\n          idRight, idDown:\r\n          begin\r\n            cls.Col := cls.Col + difc;\r\n            cle.Col := cle.Col + difc;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    nst := CellToDateTime(cls);\r\n    net := CellToDateTime(cle);\r\n\r\n    res := 0;\r\n    if not AItem.FixedResource then\r\n    begin\r\n      case ADirection of\r\n        idLeft, idUp:\r\n        begin\r\n          if (ssShift in AShift) and not (ssCtrl in AShift) then\r\n            res := cle.Col\r\n          else\r\n            res := cls.Col;\r\n        end;\r\n        idRight, idDown:\r\n        begin\r\n          if (ssShift in AShift) and (ssCtrl in AShift) then\r\n            res := cls.Col\r\n          else\r\n            res := cle.Col;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if GetDisplayMode <> pmCustom then\r\n    begin\r\n      if not (ssShift in AShift) then\r\n      begin\r\n        nst := nst + deltas;\r\n        net := nst + duration;\r\n      end\r\n      else\r\n      begin\r\n        if ssCtrl in AShift then\r\n        begin\r\n          dt := CellToDateTime(clssave);\r\n          if (deltas <> 0) then\r\n            nst := dt;\r\n\r\n          net := net + deltae;\r\n        end\r\n        else\r\n        begin\r\n          if (net - nst) < GetDisplayUnitValue then\r\n            net := nst + GetDisplayUnitValue;\r\n\r\n          nst := nst + deltas;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    c := False;\r\n    if not HasItem(nst, net, res, AItem.Index) then\r\n    begin\r\n      c := True;\r\n      if not (ssShift in AShift) then\r\n      begin\r\n        c := AItem.Movable;\r\n        DoBeforeMoveItem(AItem, nst, net, res, c);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n        CallBeforeMoveLinkedItems(AItem, nst - AItem.StartTime, net - AItem.EndTime, PositionToResource(res) - AItem.Resource);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n      end\r\n      else\r\n      begin\r\n        c := AItem.Sizeable;\r\n        DoBeforeSizeItem(AItem, nst, net, res, c);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n        CallBeforeSizeLinkedItems(AItem, nst - AItem.StartTime, net - AItem.EndTime, PositionToResource(res) - AItem.Resource);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n      end;\r\n    end;\r\n\r\n    if c then\r\n    begin\r\n      rs := PositionToResource(res);\r\n      b := (CompareDateTime(nst, AItem.StartTime) <> EqualsValue) or (CompareDateTime(net, AItem.EndTime) <> EqualsValue) or\r\n        (AItem.Resource <> rs);\r\n\r\n      if b then\r\n      begin\r\n        AItem.BeginUpdate;\r\n        AItem.StartTime := nst;\r\n        AItem.EndTime := net;\r\n        if not AItem.FixedResource then\r\n          AItem.Resource := rs;\r\n        AItem.EndUpdate(False);\r\n\r\n        if not (ssShift in AShift) then\r\n        begin\r\n          FCallAfterMoveEvent := True;\r\n          FCallItemIndex := AItem.Index;\r\n          TTMSFNCPlannerItemOpen(AItem).CallPosition := res;\r\n          DoMoveItem(AItem, nst, net, res);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n          CallMoveLinkedItems(AItem);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n        end\r\n        else\r\n        begin\r\n          FCallAfterSizeEvent := True;\r\n          FCallItemIndex := AItem.Index;\r\n          TTMSFNCPlannerItemOpen(AItem).CallPosition := res;\r\n          DoSizeItem(AItem, nst, net, res);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n          CallSizeLinkedItems(AItem);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n        end;\r\n      end;\r\n\r\n      case ADirection of\r\n        idLeft, idUp:\r\n        begin\r\n          if (ssShift in AShift) and not (ssCtrl in AShift) then\r\n            Navigate(MakeCell(cle.Col, cle.Row - 1))\r\n          else\r\n            Navigate(cls);\r\n        end;\r\n        idRight, idDown:\r\n        begin\r\n          if (ssShift in AShift) and (ssCtrl in AShift) then\r\n            Navigate(cls)\r\n          else\r\n            Navigate(MakeCell(cle.Col, cle.Row - 1))\r\n        end;\r\n      end;\r\n\r\n      UpdateSizeHandlers;\r\n      UpdateDeleteHandler;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.HandleItemMouseInteraction(\r\n  AItem: TTMSFNCPlannerItem; AStartCell, AEndCell, ANewStartCell,\r\n  ANewEndCell: TTMSFNCPlannerCell; AMode: TTMSFNCPlannerMouseInteractionMode): Boolean;\r\nvar\r\n  cls, cle, clssave, clesave: TTMSFNCPlannerCell;\r\n  res: Integer;\r\n  nst, net: TDateTime;\r\n  c: Boolean;\r\n  ps, pe, difc: Integer;\r\n  rs: Integer;\r\n  deltas, deltae, duration: Double;\r\n  dt: TDateTime;\r\nbegin\r\n  Result := False;\r\n  if Assigned(AItem) then\r\n  begin\r\n    cls := ANewStartCell;\r\n    cle := ANewEndCell;\r\n    clssave := AStartCell;\r\n    clesave := AEndCell;\r\n\r\n    deltas := AItem.StartTime - CellToDateTime(clssave);\r\n    deltae := AItem.EndTime - CellToDateTime(clesave);\r\n    duration := AItem.EndTime - AItem.StartTime;\r\n\r\n    if (GetDisplayMode = pmMultiDayRes) then\r\n    begin\r\n      ps := PositionToResource(cls.col);\r\n      pe := PositionToResource(cle.col);\r\n      difc := cle.Col - cls.Col;\r\n\r\n      if pe <> ps then\r\n      begin\r\n        if cls.Col <> clssave.Col then\r\n        begin\r\n          cls.Col := cls.Col - difc;\r\n          cle.Col := cle.Col - difc;\r\n        end\r\n        else\r\n        begin\r\n          cls.Col := cls.Col + difc;\r\n          cle.Col := cle.Col + difc;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    nst := CellToDateTime(cls);\r\n    net := CellToDateTime(cle);\r\n\r\n    res := 0;\r\n    if not AItem.FixedResource then\r\n    begin\r\n      if cls.Col <> clssave.Col then\r\n        res := cls.Col\r\n      else\r\n        res := cle.Col;\r\n    end;\r\n\r\n    if GetDisplayMode <> pmCustom then\r\n    begin\r\n      case AMode of\r\n        pmmMove:\r\n        begin\r\n          nst := nst + deltas;\r\n          net := nst + duration;\r\n        end;\r\n        pmmSizeDown:\r\n        begin\r\n          if (net - nst) < GetDisplayUnitValue then\r\n            net := nst + GetDisplayUnitValue;\r\n\r\n          nst := nst + deltas;\r\n        end;\r\n        pmmSizeUp:\r\n        begin\r\n          dt := CellToDateTime(clssave);\r\n          if (deltas <> 0) then\r\n            nst := dt;\r\n\r\n          net := net + deltae;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    c := False;\r\n    if not HasItem(nst, net, res, AItem.Index) then\r\n    begin\r\n      c := True;\r\n      if AMode = pmmMove then\r\n      begin\r\n        c := AItem.Movable;\r\n        DoBeforeMoveItem(AItem, nst, net, res, c);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n        CallBeforeMoveLinkedItems(AItem, nst - AItem.StartTime, net - AItem.EndTime, PositionToResource(res) - AItem.Resource);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n      end\r\n      else\r\n      begin\r\n        c := AItem.Sizeable;\r\n        DoBeforeSizeItem(AItem, nst, net, res, c);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n        CallBeforeSizeLinkedItems(AItem, nst - AItem.StartTime, net - AItem.EndTime, PositionToResource(res) - AItem.Resource);\r\n        TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n      end;\r\n    end;\r\n\r\n    if c then\r\n    begin\r\n      rs := PositionToResource(res);\r\n      Result := (CompareDateTime(nst, AItem.StartTime) <> EqualsValue) or (CompareDateTime(net, AItem.EndTime) <> EqualsValue) or\r\n        (AItem.Resource <> rs);\r\n\r\n      if Result then\r\n      begin\r\n        AItem.BeginUpdate;\r\n        AItem.StartTime := nst;\r\n        AItem.EndTime := net;\r\n        if not AItem.FixedResource then\r\n          AItem.Resource := rs;\r\n        AItem.EndUpdate(False);\r\n\r\n        if AMode = pmmMove then\r\n        begin\r\n          FCallAfterMoveEvent := True;\r\n          FCallItemIndex := AItem.Index;\r\n          TTMSFNCPlannerItemOpen(AItem).CallPosition := res;\r\n          DoMoveItem(AItem, nst, net, res);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n          CallMoveLinkedItems(AItem);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n        end\r\n        else\r\n        begin\r\n          FCallAfterSizeEvent := True;\r\n          FCallItemIndex := AItem.Index;\r\n          TTMSFNCPlannerItemOpen(AItem).CallPosition := res;\r\n          DoSizeItem(AItem, nst, net, res);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := True;\r\n          CallSizeLinkedItems(AItem);\r\n          TTMSFNCPlannerItemOpen(AItem).UpdatingLinked := False;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    if cls.Row < clssave.Row then\r\n      Navigate(cls)\r\n    else\r\n      Navigate(cle);\r\n\r\n    UpdateSizeHandlers;\r\n    UpdateDeleteHandler;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ProcessSelection(ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState; AStepCol, AStepRow: Integer);\r\nvar\r\n  prevk, k: TTMSFNCPlannerInteractionDirection;\r\n  prev: TTMSFNCPlannerSelection;\r\n  function CompareSelection(ASelPrev, ASel: TTMSFNCPlannerSelection): Boolean;\r\n  begin\r\n    Result := (ASelPrev.StartCell.Col = ASel.StartCell.Col) and\r\n              (ASelPrev.StartCell.Row = ASel.StartCell.Row) and\r\n              (ASelPrev.EndCell.Col = ASel.EndCell.Col) and\r\n              (ASelPrev.EndCell.Row = ASel.EndCell.Row);\r\n  end;\r\nbegin\r\n  k := ADirection;\r\n  if k <> idNone then\r\n  begin\r\n    if not IsCellDisabled(Selection.StartCell) and not IsCellDisabled(Selection.EndCell) then\r\n    begin\r\n      prevk := ADirection;\r\n      ProcessNavigation(ADirection, AShift, AStepCol, AStepRow);\r\n      while (IsCellDisabled(Selection.StartCell) or IsCellDisabled(Selection.EndCell)) do\r\n      begin\r\n        prev := Selection;\r\n        ProcessNavigation(k, AShift, 1, 1);\r\n        if CompareSelection(prev, Selection) then\r\n        begin\r\n          case prevk of\r\n            idLeft: k := idRight;\r\n            idRight: k := idLeft;\r\n            idUp: k := idDown;\r\n            idDown: k := idUp;\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleSelection(AStartCell,\r\n  AEndCell: TTMSFNCPlannerCell);\r\nbegin\r\n  HandleSelectItem(nil);\r\n\r\n  AStartCell.Row := Max(0, Min(AStartCell.Row, RowCount - 1));\r\n  AStartCell.Col := Max(0, Min(AStartCell.Col, ColumnCount - 1));\r\n\r\n  AEndCell.Row := Max(0, Min(AEndCell.Row, RowCount - 1));\r\n  AEndCell.Col := Max(0, Min(AEndCell.Col, ColumnCount - 1));\r\n\r\n  FPrevSelection := FSelection;\r\n\r\n  if AStartCell.Row > AEndCell.Row then\r\n  begin\r\n    FSelection.StartCell := AEndCell;\r\n    FSelection.EndCell := AStartCell;\r\n  end\r\n  else\r\n  begin\r\n    FSelection.StartCell := AStartCell;\r\n    FSelection.EndCell := AEndCell;\r\n  end;\r\n\r\n  if FPrevSelection.StartCell.Row = Selection.StartCell.Row then\r\n    Navigate(Selection.EndCell)\r\n  else\r\n    Navigate(Selection.StartCell);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleSelectItem(AItem: TTMSFNCPlannerItem; AMultiSelect: Boolean = False);\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItem;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    if AItem.Collection = nil then\r\n      Exit;\r\n  end;\r\n\r\n  if not AMultiSelect then\r\n    FActiveItem := AItem;\r\n\r\n  for I := FSelectedItems.Count - 1 downto 0 do\r\n  begin\r\n    it := FSelectedItems[I];\r\n    if not AMultiSelect then\r\n      FSelectedItems.Remove(it);\r\n    it.UpdateItem;\r\n  end;\r\n\r\n  if Assigned(AItem) then\r\n  begin\r\n    if FSelectedItems.IndexOf(AItem) > -1 then\r\n    begin\r\n      if AItem <> FActiveItem then\r\n        FSelectedItems.Remove(AItem)\r\n    end\r\n    else\r\n      FSelectedItems.Add(AItem);\r\n\r\n    AItem.UpdateItem;\r\n  end;\r\n\r\n  if not Interaction.KeepSelection then\r\n  begin\r\n    FSelection.StartCell := MakeCell(-1, -1);\r\n    FSelection.EndCell := MakeCell(-1, -1);\r\n  end;\r\n\r\n  UpdateSizeHandlers;\r\n  UpdateDeleteHandler;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleUnselectItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    if AItem.Collection = nil then\r\n      Exit;\r\n  end;\r\n\r\n  FSelectedItems.Remove(AItem);\r\n  if FActiveItem = AItem then\r\n    FActiveItem := nil;\r\n  AItem.UpdateItem;\r\n\r\n  UpdateSizeHandlers;\r\n  UpdateDeleteHandler;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleSelectLinkedItems(\r\n  AItem: TTMSFNCPlannerItem; AMultiSelect: Boolean);\r\nvar\r\n  Item: TTMSFNCPlannerItem;\r\nbegin\r\n  Item := AItem;\r\n  if Assigned(Item) then\r\n  begin\r\n    HandleSelectItem(Item, AMultiSelect);\r\n    Item := Item.LinkedItem;\r\n    while Assigned(Item) and (AItem <> Item) do\r\n    begin\r\n      HandleSelectItem(Item, True);\r\n      Item := Item.LinkedItem;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.HasDateTimeSub: Boolean;\r\nbegin\r\n  Result := False;\r\n  case GetDisplayMode of\r\n    pmDay, pmHalfDayPeriod, pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := True;\r\n  end;\r\n\r\n  DoHasDateTimeSub(Result);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.DoHasDateTimeSub(var AHasSub: Boolean);\r\nbegin\r\n  if Assigned(OnHasDateTimeSub) then\r\n    OnHasDateTimeSub(Self, AHasSub);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.HasItem(AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer; ACompareWithItemIndex: Integer = -1; ACheckOverlap: Boolean = True): Boolean;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := False;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    it := Items[I];\r\n    if ((ACheckOverlap and (not it.Overlappable or not ModeSettings.OverlappableItems)) or not ACheckOverlap) and IsValidItem(it) and (it.Index <> ACompareWithItemIndex) and (it.Resource = PositionToResource(APosition)) then\r\n    begin\r\n      if DateTimeInRangeEx(AStartTime, it.StartTime, it.EndTime, False) or DateTimeInRangeEx(AEndTime, it.StartTime, it.EndTime, False)\r\n      or DateTimeInRangeEx(it.StartTime, AStartTime, AEndTime, False) or DateTimeInRangeEx(it.EndTime, AStartTime, AEndTime, False) or\r\n      ((CompareDateTime(it.StartTime, AStartTime) = EqualsValue) and (CompareDateTime(it.EndTime, AEndTime) = EqualsValue)) then\r\n      begin\r\n        Result := True;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.GetHintPopup: TTMSFNCPlannerHintPopup;\r\nbegin\r\n  if not FHintPopupCreated then\r\n  begin\r\n    FHintPanel := TTMSFNCControl.Create(Self);\r\n    FHintPanel.AdaptToStyle := AdaptToStyle;\r\n    FHintPanel.AllowFocus := False;\r\n    {$IFDEF FMXLIB}\r\n    FHintPanel.Align := TAlignLayout.Center;\r\n    FHintPanel.HitTest := False;\r\n    {$ENDIF}\r\n    FHintPanel.Width := 350;\r\n    FHintPanel.Height := 300;\r\n\r\n    FHintLabel := TLabel.Create(Self);\r\n    FHintLabel.Width := 10000;\r\n    FHintLabel.WordWrap := False;\r\n    FHintLabel.AutoSize := True;\r\n    {$IFDEF FMXLIB}\r\n    FHintLabel.Align := TAlignLayout.Center;\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    {$IFDEF WEBLIB}\r\n    FHintLabel.Layout := tlCenter;\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FHintLabel.AlignWithMargins := True;\r\n    FHintLabel.Margins.Left := 5;\r\n    {$ENDIF}\r\n    {$IFDEF LCLLIB}\r\n    FHintLabel.BorderSpacing.Left := 5;\r\n    {$ENDIF}\r\n    FHintLabel.Left := 5;\r\n    FHintLabel.Top := 5;\r\n    {$ENDIF}\r\n    FHintLabel.Parent := FHintPanel;\r\n\r\n    FHintPopupCreated := True;\r\n  end;\r\n\r\n  Result.TextLabel := FHintLabel;\r\n  Result.Panel := FHintPanel;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HorizontalScrollPositionChanged;\r\nbegin\r\n  BlockScrollingUpdate := True;\r\n  UpdateDisplay;\r\n  BlockScrollingUpdate := False;\r\n  DoHScroll(GetHScrollValue);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.InitSample;\r\nbegin\r\n  BeginUpdate;\r\n  AddOrUpdateItem(DefaultItem.StartTime, DefaultItem.EndTime, 'Sample Item', 'Notes');\r\n  TimeLine.ViewStart := Int(Now) + EncodeTime(4, 0, 0, 0);\r\n  Resources.Add.Text := 'BMW';\r\n  Resources.Add.Text := 'Mercedes';\r\n  Resources.Add.Text := 'Audi';\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EditingDialogCancel(Sender: TObject);\r\nbegin\r\n  CloseEditingDialog(True);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EditingDialogRemove(Sender: TObject);\r\nbegin\r\n  CloseEditingDialogAndRemoveItem;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EditingDialogValidate(Sender: TObject);\r\nbegin\r\n  CloseEditingDialog(False);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EditItem(AItemIndex: Integer);\r\nbegin\r\n  if (AItemIndex >= 0) and (AItemIndex <= Items.Count - 1) then\r\n    HandleItemEditing(Items[AItemIndex]);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EditItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  HandleItemEditing(AItem);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EndDateEditChanged(Sender: TObject);\r\nvar\r\n  dt, dte: TDateTime;\r\nbegin\r\n  if Assigned(FStartDateEdit) and Assigned(FStartTimeEdit) and Assigned(FEndDateEdit) and Assigned(FStartDateEdit) then\r\n  begin\r\n    dt := FStartDateEdit.Date + FStartTimeEdit.Time;\r\n    dte := FEndDateEdit.Date + FEndTimeEdit.Time;\r\n    if CompareDateTime(dt + IncMilliSecond(0, 1), dte) = GreaterThanValue then\r\n      FEndDateEdit.Date := FDialogEndDate\r\n    else\r\n      FDialogEndDate := FEndDateEdit.Date;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.EndTimeEditChanged(Sender: TObject);\r\nvar\r\n  dt, dte: TDateTime;\r\nbegin\r\n  if Assigned(FStartDateEdit) and Assigned(FStartTimeEdit) and Assigned(FEndDateEdit) and Assigned(FStartDateEdit) then\r\n  begin\r\n    dt := FStartDateEdit.Date + FStartTimeEdit.Time;\r\n    dte := FEndDateEdit.Date + FEndTimeEdit.Time;\r\n    if CompareDateTime(dt + IncMilliSecond(0, 1), dte) = GreaterThanValue then\r\n      FEndTimeEdit.Time := FDialogEndTime\r\n    else\r\n      FDialogEndTime := FEndTimeEdit.Time;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.FindFirstItem(AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer): TTMSFNCPlannerItem;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := nil;\r\n  FFindItemIndex := 0;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    it := Items[I];\r\n    if IsValidItem(it) and (it.Resource = PositionToResource(APosition)) then\r\n    begin\r\n      if DateTimeInRangeEx(AStartTime, it.StartTime, it.EndTime, False) or DateTimeInRangeEx(AEndTime, it.StartTime, it.EndTime, False)\r\n      or DateTimeInRangeEx(it.StartTime, AStartTime, AEndTime, False) or DateTimeInRangeEx(it.EndTime, AStartTime, AEndTime, False) or\r\n      ((CompareDateTime(it.StartTime, AStartTime) = EqualsValue) and (CompareDateTime(it.EndTime, AEndTime) = EqualsValue)) then\r\n      begin\r\n        FFindItemIndex := it.Index;\r\n        Result := it;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.FindItemLinkedTo(AItem: TTMSFNCPlannerItem): TTMSFNCPlannerItem;\r\nvar\r\n  i: integer;\r\nbegin\r\n  Result := nil;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if (Items[I].LinkedItem = AItem) then\r\n    begin\r\n      Result := Items[I];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.FindItemWithDBKey(\r\n  ADBKey: String): TTMSFNCPlannerItem;\r\nvar\r\n  i: Integer;\r\nbegin\r\n  Result := nil;\r\n  for i := 0 to Items.Count - 1 do\r\n  begin\r\n    if Items[i].DBKey = ADBKey then\r\n    begin\r\n      Result := Items[i];\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.FindNextItem(AStartTime, AEndTime: TDateTime;\r\n  APosition: Integer): TTMSFNCPlannerItem;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItem;\r\nbegin\r\n  Result := nil;\r\n  FFindItemIndex := 0;\r\n  for I := FFindItemIndex to Items.Count - 1 do\r\n  begin\r\n    it := Items[I];\r\n    if IsValidItem(it) and (it.Resource = PositionToResource(APosition)) then\r\n    begin\r\n      if DateTimeInRangeEx(AStartTime, it.StartTime, it.EndTime, False) or DateTimeInRangeEx(AEndTime, it.StartTime, it.EndTime, False)\r\n      or DateTimeInRangeEx(it.StartTime, AStartTime, AEndTime, False) or DateTimeInRangeEx(it.EndTime, AStartTime, AEndTime, False) or\r\n      ((CompareDateTime(it.StartTime, AStartTime) = EqualsValue) and (CompareDateTime(it.EndTime, AEndTime) = EqualsValue)) then\r\n      begin\r\n        FFindItemIndex := it.Index;\r\n        Result := it;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsCellDisabled(\r\n  ACell: TTMSFNCPlannerCell): Boolean;\r\nbegin\r\n  Result := IsDateTimeDisabled(CellToDateTime(ACell), ACell.Col);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsCellInActive(\r\n  ACell: TTMSFNCPlannerCell): Boolean;\r\nbegin\r\n  Result := IsDateTimeInActive(CellToDateTime(ACell), ACell.Col);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsDateTimeDisabled(ADateTime: TDateTime;\r\n  APosition: Integer): Boolean;\r\nbegin\r\n  Result := False;\r\n  case GetDisplayMode of\r\n    pmMultiDay, pmMultiMonth: Result := not (DateTimeToPosition(ADateTime, False, False) = APosition);\r\n    pmMultiDayRes: Result := not (DateTimeToPosition(ADateTime, False, False) = APosition mod Max(1, GetNumDays));\r\n    pmMultiResDay: Result := not (DateTimeToPosition(ADateTime, False, False) div Max(1, Resources.Count) = APosition div Max(1, Resources.Count));\r\n  end;\r\n\r\n  DoIsDateTimeDisabled(ADateTime, APosition, Result);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsDateTimeInActive(ADateTime: TDateTime;\r\n  APosition: Integer): Boolean;\r\nbegin\r\n  Result := TTMSFNCPlannerInActiveDay(DayOfTheWeek(ADateTime) - 1) in ModeSettings.InActiveDays;\r\n  if not Result then\r\n  begin\r\n    case GetDisplayMode of\r\n      pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes:\r\n      begin\r\n        Result := (CompareDateTime(ADateTime, CalculatePositionDateTime(FActiveStartTime, APosition)) = LessThanValue) or\r\n          (CompareDateTime(ADateTime, CalculatePositionDateTime(FActiveEndTime, APosition)) in [EqualsValue, GreaterThanValue]);\r\n      end;\r\n    end;\r\n  end;\r\n  DoIsDateTimeInActive(ADateTime, APosition, Result);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsDateTimeSub(ADateTime: TDateTime): Boolean;\r\nbegin\r\n  Result := False;\r\n  case GetDisplayMode of\r\n    pmDay, pmMonth, pmDayPeriod, pmHalfDayPeriod: ADateTime := ADateTime - GetDisplayOffsetValue;\r\n  end;\r\n  case GetDisplayMode of\r\n    pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes: Result := MinuteOf(ADateTime) + SecondOf(ADateTime) + MilliSecondOf(ADateTime) > 0;\r\n    pmHalfDayPeriod, pmMonth: Result := HourOf(ADateTime) + MinuteOf(ADateTime) + SecondOf(ADateTime) + MilliSecondOf(ADateTime) > 0;\r\n  end;\r\n\r\n  DoIsDateTimeSub(ADateTime, Result);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsEditing: Boolean;\r\nbegin\r\n  Result := FInplaceEditorActive or FEditorDialogActive;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.IsValidItem(AItem: TTMSFNCPlannerItem): Boolean;\r\nvar\r\n  rest, rese: Integer;\r\nbegin\r\n  Result := False;\r\n  if Assigned(AItem) then\r\n  begin\r\n    case GetDisplayMode of\r\n      pmDay, pmDayPeriod, pmHalfDayPeriod, pmMonth, pmCustom:\r\n      begin\r\n        rest := AItem.Resource;\r\n        rese := AItem.Resource;\r\n        Result := AItem.Visible and (AItem.EndTime - AItem.StartTime > 0) and (rest >= 0)\r\n          and (rest <= ColumnCount - 1) and (rese >= 0) and (rese <= ColumnCount - 1);\r\n      end;\r\n      pmMultiDay, pmMultiMonth, pmMultiDayRes, pmMultiResDay:\r\n      begin\r\n        rest := DateTimeToPosition(AItem.StartTime, False, False);\r\n        rese := DateTimeToPosition(AItem.EndTime, True, False);\r\n        case GetDisplayMode of\r\n          pmMultiResDay:\r\n          begin\r\n            rest := rest + AItem.Resource;\r\n            rese := rese + AItem.Resource;\r\n          end;\r\n          pmMultiDayRes:\r\n          begin\r\n            rest := rest + (AItem.Resource * Max(1, GetNumDays));\r\n            rese := rese + (AItem.Resource * Max(1, GetNumDays));\r\n          end;\r\n        end;\r\n        Result := AItem.Visible and (AItem.EndTime - AItem.StartTime > 0) and not (((rest < 0) and (rese < 0)) or ((rest > ColumnCount - 1) and (rese > ColumnCount -1)));\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.ItemToStartCell(\r\n  AItem: TTMSFNCPlannerItem): TTMSFNCPlannerCell;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    Result := DateTimeToCell(AItem.StartTime);\r\n    case GetDisplayMode of\r\n      pmMultiMonth, pmMultiDay:;\r\n      pmMultiDayRes: Result.Col := Result.Col + (AItem.Resource * Max(1, GetNumDays))\r\n      else\r\n        Result.Col := Result.Col + AItem.Resource;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.ItemToEndCell(\r\n  AItem: TTMSFNCPlannerItem): TTMSFNCPlannerCell;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    Result := DateTimeToCell(AItem.EndTime, True);\r\n    case GetDisplayMode of\r\n      pmMultiMonth, pmMultiDay:;\r\n      pmMultiDayRes: Result.Col := Result.Col + (AItem.Resource * Max(1, GetNumDays))\r\n      else\r\n        Result.Col := Result.Col + AItem.Resource;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleKeyDown(var Key: Word; Shift: TShiftState);\r\nvar\r\n  k: TTMSFNCPlannerInteractionDirection;\r\n  sr, sc: Integer;\r\n  cls, cle: TTMSFNCPlannerCell;\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n\r\n  if FInplaceEditorClosed then\r\n    Exit;\r\n\r\n  if Assigned(FActiveItem) then\r\n  begin\r\n    k := idNone;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        case Key of\r\n          KEY_UP: k := idLeft;\r\n          KEY_DOWN: k := idRight;\r\n          KEY_LEFT: k := idUp;\r\n          KEY_RIGHT: k := idDown;\r\n        end;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        case Key of\r\n          KEY_LEFT: k := idLeft;\r\n          KEY_RIGHT: k := idRight;\r\n          KEY_UP: k := idUp;\r\n          KEY_DOWN: k := idDown;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    cls := ItemToStartCell(FActiveItem);\r\n    cle := ItemToEndCell(FActiveItem);\r\n\r\n    case k of\r\n      idLeft: HandleItemKeyboardInteraction(FActiveItem, k, Shift, -1, 0, cls, cle);\r\n      idRight: HandleItemKeyboardInteraction(FActiveItem, k, Shift, 1, 0, cls, cle);\r\n      idUp: HandleItemKeyboardInteraction(FActiveItem, k, Shift, 0, -1, cls, cle);\r\n      idDown: HandleItemKeyboardInteraction(FActiveItem, k, Shift, 0, 1, cls, cle);\r\n    end;\r\n\r\n    case Key of\r\n      KEY_DELETE:\r\n      begin\r\n        if Interaction.KeyboardDelete and not Interaction.ReadOnly then\r\n        begin\r\n          for I := FSelectedItems.Count - 1 downto 0 do\r\n            HandleItemDelete(FSelectedItems[I], pidmKeyboard);\r\n        end;\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    k := idNone;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        case Key of\r\n          KEY_UP, KEY_PRIOR: k := idLeft;\r\n          KEY_DOWN, KEY_NEXT: k := idRight;\r\n          KEY_LEFT, KEY_HOME: k := idUp;\r\n          KEY_RIGHT, KEY_END: k := idDown;\r\n        end;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        case Key of\r\n          KEY_LEFT, KEY_HOME: k := idLeft;\r\n          KEY_RIGHT, KEY_END: k := idRight;\r\n          KEY_UP, KEY_PRIOR: k := idUp;\r\n          KEY_DOWN, KEY_NEXT: k := idDown;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    sr := 1;\r\n    sc := 1;\r\n    case Key of\r\n      KEY_PRIOR, KEY_NEXT: sr := StopRow - StartRow;\r\n      KEY_HOME: sc := Selection.StartCell.Col;\r\n      KEY_END: sc := ColumnCount - 1 - Selection.StartCell.Col;\r\n    end;\r\n\r\n    ProcessSelection(k, Shift, sc, sr);\r\n\r\n    case k of\r\n      idLeft, idRight, idUp, idDown: HandleCellSelection(True);\r\n    end;\r\n\r\n    case Key of\r\n      KEY_INSERT:\r\n      begin\r\n        if not Interaction.ReadOnly then\r\n        begin\r\n          case Interaction.KeyboardInsertMode of\r\n            pkimSelection: HandleItemInsert(False);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if ((ssShift in Shift) or (ssCtrl in Shift)) and not FDrawItemHelpers then\r\n  begin\r\n    FDrawItemHelpers := True;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.HandleKeyUp(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if FInplaceEditorClosed then\r\n  begin\r\n    FInplaceEditorClosed := False;\r\n    Exit;\r\n  end;\r\n\r\n  if HandleAfterEvents and Assigned(FActiveItem) then\r\n    DoAfterItemChanged(FActiveItem);\r\n\r\n  if FCloseWithDialogKey then\r\n  begin\r\n    FCloseWithDialogKey := False;\r\n    Exit;\r\n  end;\r\n\r\n  if Assigned(FActiveItem) then\r\n  begin\r\n    if Interaction.KeyboardEdit and not Interaction.ReadOnly then\r\n    begin\r\n      case Key of\r\n        KEY_F2, KEY_RETURN, KEY_SPACE: HandleItemEditing(FActiveItem);\r\n      end;\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case Key of\r\n      KEY_UP, KEY_DOWN, KEY_RIGHT, KEY_LEFT, KEY_HOME, KEY_PRIOR, KEY_NEXT, KEY_END:\r\n      begin\r\n        HandleCellSelection;\r\n      end;\r\n      KEY_INSERT:\r\n      begin\r\n        if not Interaction.ReadOnly then\r\n        begin\r\n          case Interaction.KeyboardInsertMode of\r\n            pkimSelectionDialog: HandleItemInsert(True);\r\n          end;\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  if FDrawItemHelpers and (Shift = []) then\r\n  begin\r\n    FDrawItemHelpers := False;\r\n    Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nbegin\r\n  inherited;\r\n  AGraphics.BitmapContainer := BitmapContainer;\r\n  DrawEmptySpaces(AGraphics);\r\n  DrawGrid(AGraphics);\r\n  DrawSelection(AGraphics);\r\n  if TimeLine.CurrentTimePosition = pctpUnderItems then\r\n    DrawCurrentTimeInGrid(AGraphics);\r\n  DrawItems(AGraphics);\r\n  if TimeLine.CurrentTimePosition = pctpOverItems then\r\n    DrawCurrentTimeInGrid(AGraphics);\r\n  DrawPositions(AGraphics);\r\n  DrawTimeLine(AGraphics);\r\n  DrawGroups(AGraphics);\r\n  DrawBorders(AGraphics);\r\n  DrawNavigationButtons(AGraphics);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.RemoveAllItemsFromCache;\r\nbegin\r\n  if Assigned(FItemCache) then\r\n    FItemCache.Clear;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.RemoveLinkedItem(\r\n  AItem: TTMSFNCPlannerItem);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  if csDestroying in ComponentState then\r\n    Exit;\r\n\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    if Items[I].LinkedItem = AItem then\r\n      Items[I].LinkedItem := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.RemoveItemsFromCache(AList: TTMSFNCPlannerCacheItemList; APosition: Integer = -1);\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerCacheItem;\r\nbegin\r\n  if Assigned(AList) then\r\n  begin\r\n    for I := AList.Count - 1 downto 0 do\r\n    begin\r\n      it := AList[I];\r\n      if Assigned(it) and ((APosition = -1) or (APosition = it.Position)) then\r\n      begin\r\n        if Assigned(FItemDisplay) then\r\n          FItemDisplay.Remove(it);\r\n        if Assigned(FItemCache) then\r\n          FItemCache.Remove(it);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.ResourceToPosition(AResource: Integer): Integer;\r\nbegin\r\n  case GetDisplayMode of\r\n    pmMultiDayRes:\r\n    begin\r\n      Result := AResource * Max(1, GetNumDays);\r\n    end;\r\n    else\r\n      Result := AResource;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.RestoreScrollPosition;\r\nbegin\r\n  Scroll(FSaveHScrollPos, FSaveVScrollPos);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.PositionToDateTime(APosition: Integer): TDateTime;\r\nbegin\r\n  Result := FDisplayStartTime;\r\n  case GetDisplayMode of\r\n    pmMultiDay: Result := IncDay(Result, APosition);\r\n    pmMultiMonth: Result := IncMonth(Result, APosition);\r\n    pmMultiDayRes: Result := IncDay(Result, APosition mod Max(1, GetNumDays));\r\n    pmMultiResDay: Result := IncDay(Result, APosition div Max(1, Resources.Count));\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.PositionToResource(APosition: Integer): Integer;\r\nbegin\r\n  case GetDisplayMode of\r\n    pmMultiDayRes: Result := APosition div Max(1, GetNumDays);\r\n    pmMultiResDay: Result := APosition mod Max(1, Resources.Count);\r\n    else\r\n      Result := APosition;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ProcessNavigation(ADirection: TTMSFNCPlannerInteractionDirection; AShift: TShiftState; AStepCol, AStepRow: Integer);\r\nbegin\r\n  case ADirection of\r\n    idLeft:\r\n    begin\r\n      if Selection.StartCell.Col > 0 then\r\n      begin\r\n        if ssShift in AShift then\r\n          SelectCells(MakeCell(Selection.StartCell.Col - AStepCol, Selection.StartCell.Row), MakeCell(Selection.EndCell.Col - AStepCol, Selection.EndCell.Row))\r\n        else\r\n        begin\r\n          if FPrevSelection.EndCell.Row = Selection.EndCell.Row then\r\n            SelectCells(MakeCell(Selection.StartCell.Col - AStepCol, Selection.StartCell.Row), MakeCell(Selection.StartCell.Col - AStepCol, Selection.StartCell.Row))\r\n          else\r\n            SelectCells(MakeCell(Selection.EndCell.Col - AStepCol, Selection.EndCell.Row), MakeCell(Selection.EndCell.Col - AStepCol, Selection.EndCell.Row));\r\n        end;\r\n      end;\r\n    end;\r\n    idRight:\r\n    begin\r\n      if Selection.EndCell.Col < ColumnCount - 1 then\r\n      begin\r\n        if ssShift in AShift then\r\n          SelectCells(MakeCell(Selection.StartCell.Col + AStepCol, Selection.StartCell.Row), MakeCell(Selection.EndCell.Col + AStepCol, Selection.EndCell.Row))\r\n        else\r\n        begin\r\n          if FPrevSelection.EndCell.Row = Selection.EndCell.Row then\r\n            SelectCells(MakeCell(Selection.StartCell.Col + AStepCol, Selection.StartCell.Row), MakeCell(Selection.StartCell.Col + AStepCol, Selection.StartCell.Row))\r\n          else\r\n            SelectCells(MakeCell(Selection.EndCell.Col + AStepCol, Selection.EndCell.Row), MakeCell(Selection.EndCell.Col + AStepCol, Selection.EndCell.Row))\r\n        end;\r\n      end;\r\n    end;\r\n    idUp:\r\n    begin\r\n      if (Selection.StartCell.Row > 0) then\r\n      begin\r\n        if (FPrevSelection.StartCell.Row = Selection.StartCell.Row) then\r\n        begin\r\n          if ssShift in AShift then\r\n            SelectCells(MakeCell(Selection.StartCell.Col, Selection.StartCell.Row), MakeCell(Selection.EndCell.Col, Selection.EndCell.Row - AStepRow))\r\n          else\r\n            SelectCells(MakeCell(Selection.StartCell.Col, Selection.StartCell.Row - AStepRow), MakeCell(Selection.EndCell.Col, Selection.StartCell.Row - AStepRow));\r\n        end\r\n        else\r\n        begin\r\n          if ssShift in AShift then\r\n            SelectCells(MakeCell(Selection.StartCell.Col, Selection.StartCell.Row - AStepRow), MakeCell(Selection.StartCell.Col, Selection.EndCell.Row))\r\n          else\r\n            SelectCells(MakeCell(Selection.StartCell.Col, Selection.StartCell.Row - AStepRow), MakeCell(Selection.StartCell.Col, Selection.StartCell.Row - AStepRow));\r\n        end;\r\n      end;\r\n    end;\r\n    idDown:\r\n    begin\r\n      if (Selection.EndCell.Row < RowCount - 1) then\r\n      begin\r\n        if (FPrevSelection.EndCell.Row = Selection.EndCell.Row) then\r\n        begin\r\n          if ssShift in AShift then\r\n            SelectCells(MakeCell(Selection.EndCell.Col, Selection.StartCell.Row + AStepRow), MakeCell(Selection.EndCell.Col, Selection.EndCell.Row))\r\n          else\r\n            SelectCells(MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + AStepRow), MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + AStepRow));\r\n        end\r\n        else\r\n        begin\r\n          if ssShift in AShift then\r\n            SelectCells(MakeCell(Selection.EndCell.Col, Selection.StartCell.Row), MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + AStepRow))\r\n          else\r\n            SelectCells(MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + AStepRow), MakeCell(Selection.EndCell.Col, Selection.EndCell.Row + AStepRow));\r\n        end;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ProcessNavigationButtonsDown(X, Y: Single);\r\nbegin\r\n  FNavigationButtonDown := False;\r\n  if PtInRectEx(GetTopLeftNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    FNavigationButtonDown := True;\r\n    FTopLeftNavigationButtonState := pnbsDown;\r\n  end;\r\n\r\n  if PtInRectEx(GetTopRightNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    FNavigationButtonDown := True;\r\n    FTopRightNavigationButtonState := pnbsDown;\r\n  end;\r\n\r\n  if PtInRectEx(GetBottomLeftNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    FNavigationButtonDown := True;\r\n    FBottomLeftNavigationButtonState := pnbsDown;\r\n  end;\r\n\r\n  if PtInRectEx(GetBottomRightNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    FNavigationButtonDown := True;\r\n    FBottomRightNavigationButtonState := pnbsDown;\r\n  end;\r\n\r\n  if FNavigationButtonDown then\r\n    Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ProcessNavigationButtonsMove(X, Y: Single);\r\nvar\r\n  ch: Boolean;\r\n  tlnb, trnb, blnb, brnb: TTMSFNCPlannerNavigationButtonState;\r\nbegin\r\n  inherited;\r\n\r\n  tlnb := FTopLeftNavigationButtonState;\r\n  if PtInRectEx(GetTopLeftNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    if FNavigationButtonDown then\r\n      FTopLeftNavigationButtonState := pnbsDown\r\n    else\r\n      FTopLeftNavigationButtonState := pnbsHover;\r\n  end\r\n  else if not PtInRectEx(GetTopLeftNavigationButtonRect, PointF(X, Y)) then\r\n    FTopLeftNavigationButtonState := pnbsNormal;\r\n\r\n  trnb := FTopRightNavigationButtonState;\r\n  if PtInRectEx(GetTopRightNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    if FNavigationButtonDown then\r\n      FTopRightNavigationButtonState := pnbsDown\r\n    else\r\n      FTopRightNavigationButtonState := pnbsHover;\r\n  end\r\n  else if not PtInRectEx(GetTopRightNavigationButtonRect, PointF(X, Y)) then\r\n    FTopRightNavigationButtonState := pnbsNormal;\r\n\r\n  blnb := FBottomLeftNavigationButtonState;\r\n  if PtInRectEx(GetBottomLeftNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    if FNavigationButtonDown then\r\n      FBottomLeftNavigationButtonState := pnbsDown\r\n    else\r\n      FBottomLeftNavigationButtonState := pnbsHover;\r\n  end\r\n  else if not PtInRectEx(GetBottomLeftNavigationButtonRect, PointF(X, Y)) then\r\n    FBottomLeftNavigationButtonState := pnbsNormal;\r\n\r\n  brnb := FBottomRightNavigationButtonState;\r\n  if PtInRectEx(GetBottomRightNavigationButtonRect, PointF(X, Y)) then\r\n  begin\r\n    if FNavigationButtonDown then\r\n      FBottomRightNavigationButtonState := pnbsDown\r\n    else\r\n      FBottomRightNavigationButtonState := pnbsHover;\r\n  end\r\n  else if not PtInRectEx(GetBottomRightNavigationButtonRect, PointF(X, Y)) then\r\n    FBottomRightNavigationButtonState := pnbsNormal;\r\n\r\n  ch := (tlnb <> FTopLeftNavigationButtonState) or (trnb <> FTopRightNavigationButtonState) or\r\n    (blnb <> FBottomLeftNavigationButtonState) or (brnb <> FBottomRightNavigationButtonState);\r\n\r\n  if ch then\r\n    Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.ProcessNavigationButtonsUp(X, Y: Single);\r\nvar\r\n  dtc, dtn: TDateTime;\r\nbegin\r\n  if FNavigationButtonDown then\r\n  begin\r\n    if PtInRectEx(GetTopLeftNavigationButtonRect, PointF(X, Y)) or PtInRectEx(GetBottomLeftNavigationButtonRect, PointF(X, Y)) then\r\n    begin\r\n      dtc := FDisplayStartTime;\r\n      dtn := GetPreviousDateTime;\r\n      HandleDateTimeNavigation(pndPrevious, dtc, dtn);\r\n    end;\r\n\r\n    if PtInRectEx(GetTopRightNavigationButtonRect, PointF(X, Y)) or PtInRectEx(GetBottomRightNavigationButtonRect, PointF(X, Y)) then\r\n    begin\r\n      dtc := FDisplayStartTime;\r\n      dtn := GetNextDateTime;\r\n      HandleDateTimeNavigation(pndNext, dtc, dtn);\r\n    end;\r\n\r\n    FTopLeftNavigationButtonState := pnbsNormal;\r\n    FTopRightNavigationButtonState := pnbsNormal;\r\n    FBottomLeftNavigationButtonState := pnbsNormal;\r\n    FBottomRightNavigationButtonState := pnbsNormal;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetDefaultItem(const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  FDefaultItem.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetItemEditor(\r\n  const Value: TTMSFNCPlannerCustomItemEditor);\r\nbegin\r\n  if Assigned(Value) then\r\n    Value.Planner := Self;\r\n  FItemEditor := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetItemsAppearance(\r\n  const Value: TTMSFNCPlannerItemsAppearance);\r\nbegin\r\n  if FItemsAppearance <> Value then\r\n    FItemsAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetGridCellAppearance(\r\n  const Value: TTMSFNCPlannerGridCellAppearance);\r\nbegin\r\n  if FGridCellAppearance <> Value then\r\n    FGridCellAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetMode(const Value: TTMSFNCPlannerMode);\r\nbegin\r\n  if FMode <> Value then\r\n  begin\r\n    FMode := Value;\r\n    case GetDisplayMode of\r\n      pmDay, pmMultiDay, pmMultiDayRes, pmMultiResDay:\r\n      begin\r\n        FTimeLine.FDisplayUnit := 30;\r\n        FTimeLine.FDisplayUnitType := pduMinute;\r\n        FTimeLine.FDisplayStart := 0;\r\n        FTimeLine.FDisplayEnd := 47;\r\n      end;\r\n      pmHalfDayPeriod:\r\n      begin\r\n        FTimeLine.FDisplayUnit := 12;\r\n        FTimeLine.FDisplayUnitType := pduHour;\r\n      end;\r\n      pmDayPeriod:\r\n      begin\r\n        FTimeLine.FDisplayUnit := 1;\r\n        FTimeLine.FDisplayUnitType := pduDay;\r\n      end;\r\n      pmMultiMonth, pmMonth:\r\n      begin\r\n        FTimeLine.FDisplayUnit := 1;\r\n        FTimeLine.FDisplayUnitType := pduDay;\r\n        FTimeLine.FDisplayStart := 0;\r\n        FTimeLine.FDisplayEnd := 30;\r\n      end;\r\n    end;\r\n\r\n    case GetDisplayMode of\r\n      pmMonth:\r\n      begin\r\n        FTimeLineAppearance.FLeftSize := 110;\r\n        FTimeLineAppearance.FRightSize := 110;\r\n      end;\r\n      pmDayPeriod, pmHalfDayPeriod, pmCustom:\r\n      begin\r\n        FTimeLineAppearance.FLeftSize := 150;\r\n        FTimeLineAppearance.FRightSize := 150;\r\n      end\r\n      else\r\n      begin\r\n        FTimeLineAppearance.FLeftSize := 50;\r\n        FTimeLineAppearance.FRightSize := 50;\r\n      end;\r\n    end;\r\n\r\n    FNeedsConflictsUpdate := True;\r\n    FNeedsInitialization := True;\r\n    UpdatePlannerCache;\r\n\r\n    case GetDisplayMode of\r\n      pmDay, pmMultiDay, pmMultiDayRes, pmMultiResDay: FTimeLine.ViewStart := Int(FModeSettings.FStartTime);\r\n      pmHalfDayPeriod: FTimeLine.ViewStart := Int(FModeSettings.FStartTime);\r\n      pmDayPeriod: FTimeLine.ViewStart := Int(FModeSettings.FStartTime);\r\n      pmMultiMonth, pmMonth: TimeLine.ViewStart := EncodeDate(YearOf(FModeSettings.FStartTime), MonthOf(FModeSettings.FStartTime), 1);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetModeSettings(\r\n  const Value: TTMSFNCPlannerModeSettings);\r\nbegin\r\n  if FModeSettings <> Value then\r\n    FModeSettings.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetInteraction(const Value: TTMSFNCPlannerInteraction);\r\nbegin\r\n  if FInteraction <> Value then\r\n    FInteraction.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetGroupsAppearance(\r\n  const Value: TTMSFNCPlannerGroupsAppearance);\r\nbegin\r\n  if FGroupsAppearance <> Value then\r\n    FGroupsAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetPositions(\r\n  const Value: TTMSFNCPlannerPositions);\r\nbegin\r\n  if FPositions <> Value then\r\n    FPositions.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetPositionsAppearance(\r\n  const Value: TTMSFNCPlannerPositionsAppearance);\r\nbegin\r\n  if FPositionsAppearance <> Value then\r\n    FPositionsAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetActiveItem(const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  HandleSelectItem(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetAdapter(const Value: TTMSFNCPlannerAdapter);\r\nbegin\r\n  if Assigned(Value) then\r\n    Value.Planner := Self;\r\n  FAdapter := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetSelectionAppearance(\r\n  const Value: TTMSFNCPlannerSelectionAppearance);\r\nbegin\r\n  if FSelectionAppearance <> Value then\r\n    FSelectionAppearance := Value;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetTimeLine(const Value: TTMSFNCPlannerTimeLine);\r\nbegin\r\n  if FTimeLine <> Value then\r\n    FTimeLine.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetTimeLineAppearance(\r\n  const Value: TTMSFNCPlannerTimeLineAppearance);\r\nbegin\r\n  if FTimeLineAppearance <> Value then\r\n    FTimeLineAppearance.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetViewCol(const Value: Integer);\r\nbegin\r\n  Scroll(ColumnPositions[Max(0, Min(Value, ColumnCount - 1))], RowPositions[Max(0, Min(ViewRow, RowCount - 1))]);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.SetViewRow(const Value: Integer);\r\nbegin\r\n  Scroll(ColumnPositions[Max(0, Min(ViewCol, ColumnCount - 1))], RowPositions[Max(0, Min(Value, RowCount - 1))]);\r\nend;\r\n\r\n{$IFDEF WEBLIB}\r\nprocedure TTMSFNCCustomPlanner.ShowHintEx(AItem: TTMSFNCPlannerItem; X, Y: Double);\r\n{$ENDIF}\r\n{$IFNDEF WEBLIB}\r\nprocedure TTMSFNCCustomPlanner.ShowHint(AItem: TTMSFNCPlannerItem; X, Y: Double);\r\n{$ENDIF}\r\nvar\r\n  hp: TTMSFNCPlannerHintPopup;\r\nbegin\r\n  hp := GetHintPopup;\r\n  if Assigned(hp.Panel) then\r\n  begin\r\n    if Assigned(AItem) and (AItem.Hint <> '') and not FAnimating then\r\n    begin\r\n      if hp.Panel.Parent = nil then\r\n      begin\r\n        hp.Panel.Parent := Self;\r\n        if Assigned(hp.TextLabel) then\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          hp.TextLabel.Text := AItem.Hint;\r\n          hp.TextLabel.NeedStyleLookup;\r\n          hp.TextLabel.ApplyStyleLookup;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          hp.TextLabel.Caption := AItem.Hint;\r\n          {$ENDIF}\r\n          hp.Panel.Width := hp.TextLabel.Width + 10;\r\n          hp.Panel.Height := hp.TextLabel.Height + 10;\r\n        end;\r\n      end;\r\n\r\n      {$IFDEF FMXLIB}\r\n      hp.Panel.Position.X := X;\r\n      hp.Panel.Position.Y := Y + 20;\r\n      {$ENDIF}\r\n      {$IFDEF CMNWEBLIB}\r\n      hp.Panel.Left := Round(X);\r\n      hp.Panel.Top := Round(Y + 20);\r\n      {$ENDIF}\r\n    end\r\n    else\r\n      hp.Panel.Parent := nil;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.StartDateEditChanged(Sender: TObject);\r\nvar\r\n  dt, dte: TDateTime;\r\nbegin\r\n  if Assigned(FStartDateEdit) and Assigned(FStartTimeEdit) and Assigned(FEndDateEdit) and Assigned(FStartDateEdit) then\r\n  begin\r\n    dt := FStartDateEdit.Date + FStartTimeEdit.Time;\r\n    dte := FEndDateEdit.Date + FEndTimeEdit.Time;\r\n    if CompareDateTime(dt + IncMilliSecond(0, 1), dte)  = GreaterThanValue then\r\n      FStartDateEdit.Date := FDialogStartDate\r\n    else\r\n      FDialogStartDate := FStartDateEdit.Date;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.StartTimeEditChanged(Sender: TObject);\r\nvar\r\n  dt, dte: TDateTime;\r\nbegin\r\n  if Assigned(FStartDateEdit) and Assigned(FStartTimeEdit) and Assigned(FEndDateEdit) and Assigned(FStartDateEdit) then\r\n  begin\r\n    dt := FStartDateEdit.Date + FStartTimeEdit.Time;\r\n    dte := FEndDateEdit.Date + FEndTimeEdit.Time;\r\n    if CompareDateTime(dt + IncMilliSecond(0, 1), dte) = GreaterThanValue then\r\n      FStartTimeEdit.Time := FDialogStartTime\r\n    else\r\n      FDialogStartTime := FStartTimeEdit.Time;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.StopAnimationTimer;\r\nbegin\r\n  FAnimateTimer.Enabled := False;\r\n  FAnimating := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.StopEditing;\r\nbegin\r\n  if FEditorDialogActive then\r\n    CloseEditingDialog(False)\r\n  else if FInplaceEditorActive then\r\n    CloseInplaceEditor(False);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UnlinkItems(AItems: TTMSFNCPlannerLinkedItemArray);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  BeginUpdate;\r\n  for I := 0 to Length(AItems) - 1 do\r\n  begin\r\n    AItems[I].LinkedItem := nil;\r\n    AItems[I].LinkType := iltNone;\r\n  end;\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateActiveItem(AItem: TTMSFNCPlannerItem);\r\nbegin\r\n  ActiveItem := AItem;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateAutoSizing;\r\nbegin\r\n  if PositionsAppearance.Stretch then\r\n    StretchColumn\r\n  else\r\n    ColumnW.Clear;\r\n\r\n  if TimeLineAppearance.Stretch then\r\n    StretchRow\r\n  else\r\n    RowH.Clear;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateCalculations(AForce: Boolean = False);\r\nvar\r\n  du, duoff: TDateTime;\r\n  di: Double;\r\n  y, m, d, h, mn, s, z: Word;\r\n  ye, me, de, he, mne, se, ze: Word;\r\n  dt, dte: TDateTime;\r\n  I, p, cnt: Integer;\r\n  grp: TTMSFNCPlannerDisplayGroup;\r\n  g: TTMSFNCPlannerGroup;\r\n  conf: TTMSFNCPlannerConflict;\r\nbegin\r\n  if ((UpdateCount > 0) or (csDestroying in ComponentState) or (csLoading in ComponentState)) and not AForce then\r\n    Exit;\r\n\r\n  FCustomDatesList.Clear;\r\n  if GetDisplayMode = pmCustom then\r\n  begin\r\n    for I := 0 to CustomDateTimes.Count - 1 do\r\n      FCustomDatesList.Add(CustomDateTimes[I]);\r\n\r\n    {$IFNDEF LCLWEBLIB}\r\n    FCustomDatesList.Sort(FCompareCustomDates);\r\n    {$ENDIF}\r\n    {$IFDEF LCLWEBLIB}\r\n    {$IFDEF LCLLIB}\r\n    FCustomDatesList.Sort(@CompareDT);\r\n    {$ENDIF}\r\n    {$IFNDEF LCLLIB}\r\n    FCustomDatesList.Sort(TListSortCompare(@CompareDT));\r\n    {$ENDIF}\r\n    {$ENDIF}\r\n  end;\r\n\r\n  ColumnCount := Positions.Count;\r\n  dt := ModeSettings.StartTime;\r\n  dte := ModeSettings.EndTime;\r\n  du := GetDisplayUnitValue;\r\n  duoff := GetDisplayOffsetValue;\r\n  DecodeDateTime(dt, y, m, d, h, mn, s, z);\r\n  DecodeDateTime(dte, ye, me, de, he, mne, se, ze);\r\n  case GetDisplayMode of\r\n    pmCustom:\r\n    begin\r\n      if FCustomDatesList.Count > 0 then\r\n      begin\r\n        FDisplayStartTime := FCustomDatesList[0];\r\n        FDisplayEndTime := FCustomDatesList[FCustomDatesList.Count - 1];\r\n      end;\r\n    end;\r\n    pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes:\r\n    begin\r\n      FDisplayStartTime := EncodeDate(y, m, d);\r\n      FDisplayEndTime := EncodeDate(y, m, d);\r\n    end;\r\n    pmDayPeriod, pmHalfDayPeriod:\r\n    begin\r\n      FDisplayStartTime := EncodeDate(y, m, d);\r\n      FDisplayEndTime := EncodeDate(ye, me, de);\r\n    end;\r\n    pmMonth, pmMultiMonth:\r\n    begin\r\n      FDisplayStartTime := EncodeDate(y, m, 1);\r\n      FDisplayEndTime := EncodeDate(y, m, 1);\r\n    end;\r\n  end;\r\n\r\n  FDisplayStart := TimeLine.DisplayStart;\r\n  FDisplayEnd := TimeLine.DisplayEnd + 1;\r\n  FActiveStart := TimeLine.ActiveStart;\r\n  FActiveEnd := TimeLine.ActiveEnd;\r\n\r\n  di := GetMaxDisplayUnitValue;\r\n  if du > 0 then\r\n  begin\r\n    case GetDisplayMode of\r\n      pmMultiMonth, pmMultiDay, pmMultiResDay, pmMultiDayRes:\r\n      begin\r\n        FDisplayStart := Max(0, FDisplayStart);\r\n        FDisplayEnd := Round(Min(di, FDisplayEnd));\r\n        FActiveStart := Max(0, FActiveStart);\r\n        FActiveEnd := Round(Min(di, FActiveEnd));\r\n        if GetDisplayMode = pmMultiMonth then\r\n          du := 1;\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  case GetDisplayMode of\r\n    pmDay, pmMultiDay, pmMultiResDay, pmMultiDayRes, pmMonth, pmMultiMonth:\r\n    begin\r\n      FActiveStartTime := FDisplayStartTime + (du * FActiveStart);\r\n      FActiveEndTime := FDisplayEndTime + (du * FActiveEnd);\r\n      FDisplayStartTime := FDisplayStartTime + (du * FDisplayStart);\r\n      FDisplayEndTime := FDisplayEndTime + (du * FDisplayEnd);\r\n    end;\r\n  end;\r\n\r\n  case GetDisplayMode of\r\n    pmDay, pmMonth, pmDayPeriod, pmHalfDayPeriod:\r\n    begin\r\n     FDisplayStartTime := FDisplayStartTime + duoff;\r\n     FDisplayEndTime := FDisplayEndTime + duoff;\r\n     FActiveStartTime := FActiveStartTime + duoff;\r\n     FActiveEndTime := FActiveEndTime + duoff;\r\n    end;\r\n  end;\r\n\r\n  DefaultRowHeight := TimeLine.DisplayUnitSize;\r\n  DefaultColumnWidth := PositionsAppearance.Size;\r\n\r\n  if GetDisplayMode = pmCustom then\r\n    RowCount := FCustomDatesList.Count - 1\r\n  else\r\n  begin\r\n    if du > 0 then\r\n    begin\r\n      case GetDisplayMode of\r\n        pmMultiMonth: RowCount := FDisplayEnd - FDisplayStart;\r\n        else\r\n          RowCount := Round((FDisplayEndTime - FDisplayStartTime) / du);\r\n      end;\r\n    end\r\n    else\r\n      RowCount := 0;\r\n  end;\r\n\r\n  FDisplayGroups.Clear;\r\n  case GetDisplayMode of\r\n    pmDay, pmHalfDayPeriod, pmDayPeriod, pmMultiDay, pmMonth, pmMultiMonth, pmCustom:\r\n    begin\r\n      for I := 0 to Groups.Count - 1 do\r\n      begin\r\n        g := Groups[I];\r\n        grp.StartPosition := Max(0, Min(g.StartPosition, ColumnCount - 1));\r\n        grp.EndPosition := Max(0, Min(g.EndPosition, ColumnCount - 1));\r\n        FDisplayGroups.Add(grp);\r\n      end;\r\n    end;\r\n    pmMultiResDay, pmMultiDayRes:\r\n    begin\r\n      if GetDisplayMode = pmMultiResDay then\r\n      begin\r\n        cnt := Resources.Count;\r\n        p := GetNumDays;\r\n      end\r\n      else\r\n      begin\r\n        cnt := GetNumDays;\r\n        p := Resources.Count;\r\n      end;\r\n\r\n      for I := 0 to p - 1 do\r\n      begin\r\n        grp.StartPosition := Max(0, Min(cnt * I, ColumnCount - 1));\r\n        grp.EndPosition := Max(0, Min(grp.StartPosition + cnt - 1, ColumnCount - 1));\r\n        FDisplayGroups.Add(grp);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  FConflicts.Clear;\r\n  for I := 0 to ColumnCount - 1 do\r\n  begin\r\n    conf := TTMSFNCPlannerConflict.Create(Self);\r\n    conf.NeedsConflictsUpdate := False;\r\n    conf.Position := I;\r\n    FConflicts.Add(conf);\r\n  end;\r\n\r\n  if FNeedsInitialization then\r\n  begin\r\n    FNeedsInitialization := False;\r\n    FSelectedItems.Clear;\r\n    FActiveItem := nil;\r\n    FSelection.StartCell.Col := Max(0, Min(Selection.StartCell.Col, ColumnCount - 1));\r\n    FSelection.StartCell.Row := Max(0, Min(Selection.StartCell.Row, RowCount - 1));\r\n    FSelection.EndCell.Col := Max(0, Min(Selection.EndCell.Col, ColumnCount - 1));\r\n    FSelection.EndCell.Row := Max(0, Min(Selection.EndCell.Row, RowCount - 1));\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateColumnRowCalculations;\r\nvar\r\n  I: Integer;\r\n  r, c: Double;\r\nbegin\r\n  RowP.Clear;\r\n  r := 0;\r\n  RowPositions[0] := r;\r\n  for I := 0 to RowCount - 1 do\r\n  begin\r\n    r := r + RowHeights[I];\r\n    RowPositions[I + 1] := r;\r\n  end;\r\n\r\n  ColumnP.Clear;\r\n  c := 0;\r\n  ColumnPositions[0] := c;\r\n  for I := 0 to ColumnCount - 1 do\r\n  begin\r\n    c := c + ColumnWidths[I];\r\n    ColumnPositions[I + 1] := c;\r\n  end;\r\n\r\n  TotalColumnWidth := c;\r\n  TotalRowHeight := r;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateConflicts;\r\nvar\r\n  I, J, K, L, M, N: Integer;\r\n  conf: TTMSFNCPlannerConflict;\r\n  it, itemA, itemB: TTMSFNCPlannerItemOpen;\r\n  res: TTMSFNCPlannerResourceDate;\r\n  firsttime,lasttime: TDateTime;\r\n  check,found: boolean;\r\n\r\n  function ExtendOverlap(itemA,itemB: TTMSFNCPlannerItemOpen): boolean;\r\n  var\r\n    ms,me: TDateTime;\r\n  begin\r\n    ms := Max(itemA.StartTimeExt, itemB.StartTimeExt);\r\n    me := Min(itemA.EndTimeExt, itemB.EndTimeExt);\r\n\r\n    Result := CompareDateTime(me, ms) = GreaterThanValue;\r\n\r\n    if Result then\r\n    begin\r\n      itemA.StartTimeExt := Min(itemA.StartTimeExt, itemB.StartTimeExt);\r\n      itemA.EndTimeExt := Max(itemA.EndTimeExt, itemB.EndTimeExt);\r\n      itemB.StartTimeExt := itemA.StartTimeExt;\r\n      itemB.EndTimeExt := itemA.EndTimeExt;\r\n    end;\r\n  end;\r\n\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if FNeedsConflictsUpdate then\r\n  begin\r\n    NeedsConflictsUpdate;\r\n    FNeedsConflictsUpdate := False;\r\n  end;\r\n\r\n  for I := 0 to FConflicts.Count - 1 do\r\n  begin\r\n    conf := FConflicts[I];\r\n\r\n    if conf.NeedsConflictsUpdate then\r\n    begin\r\n      conf.UpdateItems;\r\n      conf.UpdateDates;\r\n\r\n      firsttime := 0;\r\n      lasttime := 0;\r\n\r\n      // get position start & end time\r\n      if conf.Dates.Count > 0 then\r\n      begin\r\n        firsttime := TTMSFNCPlannerResourceDate(conf.Dates[0]).DateTime;\r\n        lasttime := TTMSFNCPlannerResourceDate(conf.Dates[conf.Dates.Count - 1]).DateTime;\r\n      end;\r\n\r\n      // limit item time to position start & end time\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        with TTMSFNCPlannerItemOpen(conf.Items[K]) do\r\n        begin\r\n          StartTimeExt := Max(StartTime, firsttime);\r\n          EndTimeExt := Min(EndTime, lasttime);\r\n        end;\r\n      end;\r\n\r\n      // extend item start & end time with overlapping item start & end time\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        for L := 0 to conf.Items.Count - 1 do\r\n        begin\r\n          if (K <> L) then\r\n            ExtendOverlap(TTMSFNCPlannerItemOpen(conf.Items[K]), TTMSFNCPlannerItemOpen(conf.Items[L]));\r\n        end;\r\n\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n        it.DirtyItem;\r\n      end;\r\n\r\n      // initialize conflicts counters\r\n      for J := 0 to conf.Dates.Count - 1 do\r\n      begin\r\n        res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n        res.X := 0;\r\n        res.Y := 0;\r\n        conf.Dates[J] := res;\r\n      end;\r\n\r\n      // set nr. of items per slot\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n\r\n        for J := 0 to conf.Dates.Count - 1 do\r\n        begin\r\n          if (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, it.StartTimeExt) in [GreaterThanValue, EqualsValue])\r\n            and (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, it.EndTimeExt) = LessThanValue) then\r\n          begin\r\n            res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n            res.Y := res.Y + 1;\r\n            conf.Dates[J] := res;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      // set max. nr. of conflicts found per item\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n\r\n        it.ConflictsExt := 1;\r\n\r\n        for J := 0 to conf.Dates.Count - 1 do\r\n        begin\r\n          if (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, it.StartTime) in [GreaterThanValue, EqualsValue])\r\n            and (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, it.EndTime) = LessThanValue) then\r\n          begin\r\n            if TTMSFNCPlannerResourceDate(conf.Dates[J]).Y > it.ConflictsExt then\r\n              it.ConflictsExt := TTMSFNCPlannerResourceDate(conf.Dates[J]).Y;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      // initialize conflicts position placeholders per timeslot\r\n      for J := 0 to conf.Dates.Count - 1 do\r\n      begin\r\n        res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n        SetLength(res.Z, res.Y);\r\n\r\n        // initialize slots to unoccupied\r\n        for L := 0 to res.Y - 1 do\r\n          res.Z[L] := false;\r\n\r\n        conf.Dates[J] := res;\r\n      end;\r\n\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n\r\n        for N := 0 to it.ConflictsExt - 1 do\r\n        begin\r\n          found := true;\r\n          check := false;\r\n\r\n          for J := 0 to conf.Dates.Count - 1 do\r\n          begin\r\n            if CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Max(it.StartTime, firsttime)) = EqualsValue then\r\n              check := true;\r\n\r\n            if CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Min(it.EndTime, lasttime)) = EqualsValue then\r\n              check := false;\r\n\r\n            if check then\r\n            begin\r\n              res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n              if res.Z[N] then\r\n              begin\r\n                found := false;\r\n                break;\r\n              end;\r\n            end;\r\n          end;\r\n\r\n          if found then\r\n          begin\r\n            it.ConflictsPosExt := N;\r\n            check := false;\r\n\r\n            for J := 0 to conf.Dates.Count - 1 do\r\n            begin\r\n              if CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Max(it.StartTime, firsttime)) = EqualsValue then\r\n                check := true;\r\n\r\n              if CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Min(it.EndTime, lasttime)) = EqualsValue then\r\n                check := false;\r\n\r\n              if check then\r\n              begin\r\n                res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n                res.Z[N] := true;\r\n                if res.X < N then\r\n                  res.X := N;\r\n\r\n                conf.Dates[J] := res;\r\n              end;\r\n\r\n            end;\r\n            break;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      (*\r\n      for J := 0 to conf.Dates.Count - 1 do\r\n      begin\r\n        for K := 0 to conf.Items.Count - 1 do\r\n        begin\r\n\r\n          it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n\r\n          if CompareDateTime(conf.Dates[J].DateTime, Max(it.StartTime, firsttime)) = EqualsValue then\r\n          begin\r\n            res := conf.Dates[J];\r\n\r\n            MM := 0;\r\n            for L := 0 to Length(res.Z) - 1 do\r\n            begin\r\n              if not res.Z[L] then\r\n              begin\r\n                res.Z[L] := true;\r\n                MM := L;\r\n                if MM > res.X then\r\n                  res.X := MM;\r\n                conf.Dates[J] := res;\r\n\r\n                Break;\r\n              end;\r\n            end;\r\n\r\n            it.ConflictsPosExt := MM;\r\n\r\n            L := J + 1;\r\n            while (L < conf.Dates.Count) do\r\n            begin\r\n              if CompareDateTime(Min(it.EndTime, lasttime), conf.Dates[L].DateTime) = EqualsValue then\r\n                Break\r\n              else\r\n              begin\r\n                res := conf.Dates[L];\r\n                if MM < Length(res.Z)  then\r\n                begin\r\n                  res.Z[MM] := true;\r\n                  if MM > res.X then\r\n                    res.X := MM;\r\n                end;\r\n                conf.Dates[L] := res;\r\n              end;\r\n\r\n              inc(L);\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n      *)\r\n\r\n      // calculate nr. of conflicts after resolution\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n\r\n        M := 1;\r\n\r\n        for J := 0 to conf.Dates.Count - 1 do\r\n        begin\r\n          res := TTMSFNCPlannerResourceDate(conf.Dates[J]);\r\n          if (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Max(it.StartTime, firsttime)) in [GreaterThanValue, EqualsValue])\r\n            and (CompareDateTime(TTMSFNCPlannerResourceDate(conf.Dates[J]).DateTime, Min(it.EndTime, lasttime)) = LessThanValue) then\r\n          begin\r\n            if res.X > M then\r\n              M := res.X;\r\n          end;\r\n        end;\r\n\r\n        if it.ConflictsExt > M + 1 then\r\n          it.ConflictsExt := M + 1;\r\n      end;\r\n\r\n      // set nr. of conflicts\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        for L := 0 to conf.Items.Count - 1 do\r\n        begin\r\n          if (K <> L) then\r\n          begin\r\n            itemA := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n            itemB := TTMSFNCPlannerItemOpen(conf.Items[L]);\r\n            if ExtendOverlap(itemA, itemB) then\r\n            begin\r\n              if itemA.ConflictsExt <> itemB.ConflictsExt then\r\n              begin\r\n                M := Max(itemA.ConflictsExt, itemB.ConflictsExt);\r\n                itemA.ConflictsExt := M;\r\n                itemB.ConflictsExt := M;\r\n              end;\r\n            end;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      // set conflictpos\r\n      for K := 0 to conf.Items.Count - 1 do\r\n      begin\r\n        it := TTMSFNCPlannerItemOpen(conf.Items[K]);\r\n        it.DirtyItem;\r\n        for J := 0 to it.PositionsList.Count - 1 do\r\n        begin\r\n          if it.PositionsList[J] = conf.Position then\r\n          begin\r\n            if (J >= 0) and (J <= it.ConflictsList.Count - 1) then\r\n              it.ConflictsList[J] := it.ConflictsExt\r\n            else\r\n              it.ConflictsList.Add(it.ConflictsExt);\r\n\r\n            if (J >= 0) and (J <= it.ConflictsPosList.Count - 1) then\r\n              it.ConflictsPosList[J] := it.ConflictsPosExt\r\n            else\r\n              it.ConflictsPosList.Add(it.ConflictsPosExt);\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      conf.NeedsConflictsUpdate := False;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateDeleteHandler;\r\nvar\r\n  delh: TTMSFNCPlannerDeleteHandler;\r\n  bkg: TTMSFNCPlannerDeleteHandlerPanel;\r\n  r: TRectF;\r\n  w, h: Single;\r\n  d: Boolean;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if AllowMobileDelete and not Interaction.ReadOnly then\r\n  begin\r\n    delh := GetDeleteHandler;\r\n    bkg := delh.Background;\r\n    if Assigned(bkg) then\r\n    begin\r\n      if Assigned(FActiveItem) then\r\n      begin\r\n        d := FActiveItem.Deletable;\r\n        DoIsItemDeletable(FActiveItem, d);\r\n        if d then\r\n        begin\r\n          bkg.Parent := Self;\r\n          r := GetFirstRect(FActiveItem);\r\n          w := ItemsAppearance.DeleteHandlerWidth;\r\n          h := ItemsAppearance.DeleteHandlerHeight;\r\n          {$IFDEF FMXLIB}\r\n          case OrientationMode of\r\n            pomHorizontal: bkg.BoundsRect := RectF(Int(r.Right), Int(r.Top), Int(r.Right + w), Int(r.Top + h));\r\n            pomVertical: bkg.BoundsRect := RectF(Int(r.Right), Int(r.Top), Int(r.Right + w), Int(r.Top + h));\r\n          end;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          case OrientationMode of\r\n            pomHorizontal: bkg.BoundsRect := Rect(Round(r.Right), Round(r.Top), Round(r.Right + w), Round(r.Top + h));\r\n            pomVertical: bkg.BoundsRect := Rect(Round(r.Right), Round(r.Top), Round(r.Right + w), Round(r.Top + h));\r\n          end;\r\n          {$ENDIF}\r\n        end\r\n      end\r\n      else\r\n        bkg.Parent := nil;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateDisplay;\r\nbegin\r\n  inherited;\r\n  UpdateGridDisplay;\r\n  UpdateGroupsDisplay;\r\n  UpdatePositionsDisplay;\r\n  UpdateTimeLineDisplay;\r\n  UpdateItemDisplay;\r\n  UpdateInplaceEditorPosition;\r\n  UpdateSizeHandlers;\r\n  UpdateDeleteHandler;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateGridCache;\r\nvar\r\n  w, h, bmpw, bmph, bw, bh, offh, offw: Double;\r\n  bmp: TBitmap;\r\n  rt: TRectF;\r\n  c, r: Integer;\r\n  dx, dy, sdx: Double;\r\n  offsetx, offsety: Double;\r\n  ac, ar: Integer;\r\n  rc: TRectF;\r\n  rcnt, ccnt: Integer;\r\n  bmpvalid: Boolean;\r\n  dt, dte: TDateTime;\r\n  p: Integer;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or not Assigned(FGridCache) then\r\n    Exit;\r\n\r\n  FGridCache.Clear;\r\n\r\n  if ColumnCount > 0 then\r\n  begin\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        h := GetTotalColumnWidth;\r\n        w := GetTotalRowHeight;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        w := GetTotalColumnWidth;\r\n        h := GetTotalRowHeight;\r\n      end;\r\n      else\r\n      begin\r\n        w := 0;\r\n        h := 0;\r\n      end;\r\n    end;\r\n\r\n    bmpvalid := False;\r\n    offsetx := 0;\r\n    offsety := 0;\r\n    bmpw := 0;\r\n    bmph := 0;\r\n    ac := 0;\r\n    ar := 0;\r\n    dx := 0;\r\n    dy := 0;\r\n    c := 0;\r\n    r := 0;\r\n\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        ccnt := RowCount - 1;\r\n        rcnt := ColumnCount - 1;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        rcnt := RowCount - 1;\r\n        ccnt := ColumnCount - 1;\r\n      end;\r\n      else\r\n      begin\r\n        ccnt := 0;\r\n        rcnt := 0;\r\n      end;\r\n    end;\r\n\r\n    while bmpw < w do\r\n    begin\r\n      if GridCaching then\r\n      begin\r\n        bw := Min(w - bmpw, GetCacheWidth);\r\n        offw := bmpw;\r\n      end\r\n      else\r\n      begin\r\n        bw := w;\r\n        offw := 0;\r\n      end;\r\n\r\n      while bmph < h do\r\n      begin\r\n        if GridCaching then\r\n        begin\r\n          bh := Min(h - bmph, GetCacheHeight);\r\n          offh := bmph;\r\n        end\r\n        else\r\n        begin\r\n          bh := h;\r\n          offh := 0;\r\n        end;\r\n\r\n        bmp := nil;\r\n        if GridCaching then\r\n          bmpvalid := CreateAndPrepareBitmap(bmp, bw, bh);\r\n\r\n        g := nil;\r\n        if bmpvalid then\r\n          g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n\r\n        rt := RectF(0, 0, bw, bh);\r\n\r\n        dx := rt.Left + offsetx;\r\n        for c := ac to ccnt do\r\n        begin\r\n          sdx := dx;\r\n          {$IFDEF FMXWEBLIB}\r\n          rc.Left := int(dx) + 0.5;\r\n          case OrientationMode of\r\n            pomHorizontal: dx := dx + RowHeights[c];\r\n            pomVertical: dx := dx + ColumnWidths[c];\r\n          end;\r\n          rc.Right := int(dx) + 0.5;\r\n          {$ENDIF}\r\n          {$IFDEF CMNLIB}\r\n          rc.Left := dx;\r\n          case OrientationMode of\r\n            pomHorizontal: dx := dx + RowHeights[c];\r\n            pomVertical: dx := dx + ColumnWidths[c];\r\n          end;\r\n          rc.Right := dx;\r\n          {$ENDIF}\r\n\r\n          dy := rt.Top + offsety;\r\n          for r := ar to rcnt do\r\n          begin\r\n            case OrientationMode of\r\n              pomHorizontal: dt := ValueToDateTime(sdx + offw, r, c);\r\n              pomVertical: dt := ValueToDateTime(dy + offh, c, r);\r\n              else\r\n                dt := 0;\r\n            end;\r\n\r\n            {$IFDEF FMXWEBLIB}\r\n            rc.Top := int(dy) + 0.5;\r\n            case OrientationMode of\r\n              pomHorizontal: dy := dy + ColumnWidths[r];\r\n              pomVertical: dy := dy + RowHeights[r];\r\n            end;\r\n            rc.Bottom := int(dy) + 0.5;\r\n            {$ENDIF}\r\n\r\n            {$IFDEF CMNLIB}\r\n            rc.Top := dy;\r\n            case OrientationMode of\r\n              pomHorizontal: dy := dy + ColumnWidths[r];\r\n              pomVertical: dy := dy + RowHeights[r];\r\n            end;\r\n            rc.Bottom := dy;\r\n            {$ENDIF}\r\n\r\n            case OrientationMode of\r\n              pomHorizontal: dte := ValueToDateTime(dx + offw, r, c);\r\n              pomVertical: dte := ValueToDateTime(dy + offh, c, r);\r\n              else\r\n                dte := 0;\r\n            end;\r\n\r\n            case OrientationMode of\r\n              pomHorizontal: p := r;\r\n              pomVertical: p := c;\r\n              else\r\n                p := 0;\r\n            end;\r\n\r\n            if GridCaching then\r\n            begin\r\n              if bmpvalid then\r\n              begin\r\n                case OrientationMode of\r\n                  pomHorizontal: DrawCell(g, rc, r, c, dt, dte , p, ikCell);\r\n                  pomVertical: DrawCell(g, rc, c, r, dt, dte , p, ikCell);\r\n                end;\r\n              end;\r\n            end\r\n            else\r\n            begin\r\n              OffsetRectEx(rc, bmpw, bmph);\r\n              case OrientationMode of\r\n                pomHorizontal: FGridCache.Add(TTMSFNCPlannerCacheItem.CreateCell(rc, r, c, dt, dte, p));\r\n                pomVertical: FGridCache.Add(TTMSFNCPlannerCacheItem.CreateCell(rc, c, r, dt, dte, p));\r\n              end;\r\n            end;\r\n\r\n            if dy > (rt.Bottom - rt.Top) then\r\n              Break;\r\n          end;\r\n\r\n          if dx > (rt.Right - rt.Left) then\r\n             Break;\r\n        end;\r\n\r\n        if GridCaching then\r\n        begin\r\n          OffsetRectEx(rt, bmpw, bmph);\r\n          if bmpvalid then\r\n          begin\r\n            {$IFDEF FMXLIB}\r\n            bmp.Canvas.EndScene;\r\n            {$ENDIF}\r\n            if Assigned(g) then\r\n              g.Free;\r\n          end;\r\n\r\n          FGridCache.Add(TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikCell));\r\n        end;\r\n        bmph := bmph + bh;\r\n        ar := r;\r\n        case OrientationMode of\r\n          pomHorizontal: offsety := -ColumnWidths[r] - (bh - dy);\r\n          pomVertical:offsety := -RowHeights[r] - (bh - dy);\r\n        end;\r\n      end;\r\n      bmpw := bmpw + bw;\r\n      bmph := 0;\r\n      ar := 0;\r\n      ac := c;\r\n      offsety := 0;\r\n      case OrientationMode of\r\n        pomHorizontal: offsetx := -RowHeights[c] - (bw - dx);\r\n        pomVertical: offsetx := -ColumnWidths[c] - (bw - dx);\r\n      end;\r\n    end;\r\n  end;\r\n\r\n  UpdateGridDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateItemsCache;\r\nbegin\r\n  UpdateItemCache;\r\n  UpdateItemDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateLinkedItems(AItem: TTMSFNCPlannerItem; ADiffStartTime, ADiffEndTime: TDateTime; ADiffPosition: Integer);\r\nvar\r\n  li: TTMSFNCPlannerItem;\r\n  nst, net: TDateTime;\r\nbegin\r\n  if not Assigned(AItem) or not Assigned(AItem.LinkedItem) then\r\n     Exit;\r\n\r\n  li := AItem.LinkedItem;\r\n  if TTMSFNCPlannerItemOpen(li).CanUpdate and (AItem.LinkType <> iltNone) then\r\n  begin\r\n    li.BeginUpdate;\r\n    nst := li.StartTime;\r\n    net := li.EndTime;\r\n    GetNewDateTimeAndResource(li, AItem.LinkType, ADiffStartTime, ADiffEndTime, nst, net);\r\n    li.StartTime := nst;\r\n    li.EndTime := net;\r\n    if not li.FixedResource then\r\n      li.Resource := li.Resource + ADiffPosition;\r\n    li.EndUpdate(False, False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdatePlannerCache(ADirtyItems: Boolean = True);\r\nbegin\r\n  if (UpdateCount > 0) then\r\n  begin\r\n    UpdateCalculations(True);\r\n    if ADirtyItems then\r\n      DirtyItems;\r\n    Exit;\r\n  end;\r\n\r\n  inherited;\r\n  UpdateInplaceEditorPosition;\r\n  UpdateSizeHandlers;\r\n  UpdateDeleteHandler;\r\n  Invalidate;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdatePositionsCache;\r\nbegin\r\n  UpdatePositionCache(FPositionsTopCache);\r\n  UpdatePositionCache(FPositionsBottomCache);\r\n  UpdatePositionsDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdatePositionCache(ACache: TTMSFNCPlannerCache);\r\nvar\r\n  w, h, bmpw, bmph, bw, bh: Double;\r\n  bmp: TBitmap;\r\n  rt: TRectF;\r\n  c: Integer;\r\n  dx: Double;\r\n  offsetx: Double;\r\n  ac: Integer;\r\n  rc: TRectF;\r\n  cnt: Integer;\r\n  cache: TTMSFNCPlannerCacheItem;\r\n  bmpvalid: Boolean;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  inherited;\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or not Assigned(ACache) then\r\n    Exit;\r\n\r\n  ACache.Clear;\r\n\r\n  if (ACache is TTMSFNCPlannerPositionsTopCache) and (not (pplTop in PositionsAppearance.Layouts) or (PositionsAppearance.TopSize <= 0)) then\r\n    Exit;\r\n\r\n  if (ACache is TTMSFNCPlannerPositionsBottomCache) and (not (pplBottom in PositionsAppearance.Layouts) or (PositionsAppearance.BottomSize <= 0)) then\r\n    Exit;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      h := GetTotalColumnWidth;\r\n      if ACache is TTMSFNCPlannerPositionsTopCache then\r\n        w := GetPositionsTopSize + 1\r\n      else\r\n        w := GetPositionsBottomSize + 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      w := GetTotalColumnWidth;\r\n      if ACache is TTMSFNCPlannerPositionsTopCache then\r\n        h := GetPositionsTopSize + 1\r\n      else\r\n        h := GetPositionsBottomSize + 1;\r\n    end;\r\n    else\r\n    begin\r\n      w := 0;\r\n      h := 0;\r\n    end;\r\n  end;\r\n\r\n  offsetx := 0;\r\n  bmpw := 0;\r\n  bmph := 0;\r\n  ac := 0;\r\n  c := 0;\r\n  dx := 0;\r\n  bmpvalid := False;\r\n\r\n  cnt := ColumnCount - 1;\r\n\r\n  while bmpw < w do\r\n  begin\r\n    if PositionsCaching then\r\n      bw := Min(w - bmpw, GetCacheWidth)\r\n    else\r\n      bw := w;\r\n\r\n    while bmph < h do\r\n    begin\r\n      if PositionsCaching then\r\n        bh := Min(h - bmph, GetCacheHeight)\r\n      else\r\n        bh := h;\r\n\r\n      bmp := nil;\r\n      if PositionsCaching then\r\n        bmpvalid := CreateAndPrepareBitmap(bmp, bw, bh);\r\n\r\n      g := nil;\r\n      if bmpvalid then\r\n        g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n\r\n      rt := RectF(0, 0, bw, bh);\r\n\r\n      case OrientationMode of\r\n        pomHorizontal: dx := rt.Top + offsetx;\r\n        pomVertical: dx := rt.Left + offsetx;\r\n      end;\r\n\r\n      for c := ac to cnt do\r\n      begin\r\n        {$IFDEF FMXWEBLIB}\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            rc.Left := int(rt.Left) + 0.5;\r\n            rc.Right := int(rt.Right) - 0.5;\r\n            rc.Top := int(dx) + 0.5;\r\n            dx := dx + ColumnWidths[c];\r\n            rc.Bottom := int(dx) + 0.5;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            rc.Top := int(rt.Top) + 0.5;\r\n            rc.Bottom := int(rt.Bottom) - 0.5;\r\n            rc.Left := int(dx) + 0.5;\r\n            dx := dx + ColumnWidths[c];\r\n            rc.Right := int(dx) + 0.5;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNLIB}\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            rc.Left := rt.Left;\r\n            rc.Right := rt.Right;\r\n            rc.Top := dx;\r\n            dx := dx + ColumnWidths[c];\r\n            rc.Bottom := dx + 1;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            rc.Top := rt.Top;\r\n            rc.Bottom := rt.Bottom;\r\n            rc.Left := dx;\r\n            dx := dx + ColumnWidths[c];\r\n            rc.Right := dx + 1;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n\r\n        if PositionsCaching then\r\n        begin\r\n          if bmpvalid then\r\n          begin\r\n            if ACache is TTMSFNCPlannerPositionsTopCache then\r\n              DrawPosition(g, rc, c, ikPositionTop)\r\n            else\r\n              DrawPosition(g, rc, c, ikPositionBottom);\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          OffsetRectEx(rc, bmpw, bmph);\r\n          if ACache is TTMSFNCPlannerPositionsTopCache then\r\n            ACache.Add(TTMSFNCPlannerCacheItem.CreatePositionTop(rc, c))\r\n          else\r\n            ACache.Add(TTMSFNCPlannerCacheItem.CreatePositionBottom(rc, c));\r\n        end;\r\n\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            if dx > (rt.Bottom - rt.Top) then\r\n            begin\r\n              ac := c;\r\n              offsetx := -ColumnWidths[c] - (bh - dx);\r\n              Break;\r\n            end;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            if dx > (rt.Right - rt.Left) then\r\n              Break;\r\n          end;\r\n        end;\r\n      end;\r\n\r\n      if PositionsCaching then\r\n      begin\r\n        OffsetRectEx(rt, bmpw, bmph);\r\n        if bmpvalid then\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          bmp.Canvas.EndScene;\r\n          {$ENDIF}\r\n          if Assigned(g) then\r\n            g.Free;\r\n        end;\r\n\r\n        if ACache is TTMSFNCPlannerPositionsTopCache then\r\n          cache := TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikPositionTop)\r\n        else\r\n          cache := TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikPositionBottom);\r\n\r\n        ACache.Add(cache);\r\n      end;\r\n      bmph := bmph + bh;\r\n    end;\r\n    bmpw := bmpw + bw;\r\n    bmph := 0;\r\n    case OrientationMode of\r\n      pomVertical:\r\n      begin\r\n        ac := c;\r\n        offsetx := -ColumnWidths[c] - (bw - dx);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdatePositionsDisplay;\r\nbegin\r\n  BuildDisplay(FPositionsTopCache, FPositionsTopDisplay);\r\n  BuildDisplay(FPositionsBottomCache, FPositionsBottomDisplay);\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateScrollPosition(AForce: Boolean = True);\r\nvar\r\n  cl: TTMSFNCPlannerCell;\r\nbegin\r\n  if not (csLoading in ComponentState) and not AForce then\r\n    Exit;\r\n\r\n  cl := DateTimeToCell(TimeLine.ViewStart);\r\n  case GetDisplayMode of\r\n    pmMultiMonth, pmMultiDay:;\r\n    else\r\n      cl.Col := cl.Col + PositionToResource(Positions.ViewStart);\r\n  end;\r\n\r\n  BlockScrollingUpdate := True;\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      SetVScrollValue(ColumnPositions[cl.Col]);\r\n      SetHScrollValue(RowPositions[cl.Row]);\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      SetHScrollValue(ColumnPositions[cl.Col]);\r\n      SetVScrollValue(RowPositions[cl.Row]);\r\n    end;\r\n  end;\r\n  BlockScrollingUpdate := False;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateSizeHandlers;\r\nvar\r\n  startsz, endsz: TTMSFNCPlannerSizeHandler;\r\n  bkgst, bkget: TTMSFNCPlannerSizeHandlerPanel;\r\n  r: TRectF;\r\n  w, h: Single;\r\nbegin\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or (csLoading in ComponentState) then\r\n    Exit;\r\n\r\n  if AllowMobileSize and not Interaction.ReadOnly then\r\n  begin\r\n    startsz := GetStartTimeSizeHandler;\r\n    endsz := GetEndTimeSizeHandler;\r\n    bkgst := startsz.Background;\r\n    bkget := endsz.Background;\r\n\r\n    if Assigned(bkgst) and Assigned(bkget) then\r\n    begin\r\n      //show or hide handlers\r\n      if Assigned(FActiveItem) then\r\n      begin\r\n        if FActiveItem.Sizeable then\r\n        begin\r\n          bkgst.Parent := Self;\r\n          bkget.Parent := Self;\r\n\r\n          w := ItemsAppearance.SizeHandlerWidth;\r\n          h := ItemsAppearance.SizeHandlerHeight;\r\n          r := GetFirstRect(FActiveItem);\r\n          {$IFDEF FMXLIB}\r\n          case OrientationMode of\r\n            pomHorizontal: bkgst.BoundsRect := RectF(Int(r.Left - h) + 1, Int(r.Top + (r.Height - w) / 2), Int(r.Left) + 1, Int(r.Top + (r.Height - w) / 2 + w));\r\n            pomVertical: bkgst.BoundsRect := RectF(Int(r.Left + (r.Width - w) / 2), Int(r.Top - h) + 1, Int(r.Left + (r.Width - w) / 2 + w), Int(r.Top) + 1);\r\n          end;\r\n          r := GetLastRect(FActiveItem);\r\n          case OrientationMode of\r\n            pomHorizontal: bkget.BoundsRect := RectF(Int(r.Right), Int(r.Top + (r.Height - w) / 2), Int(r.Right + h), Int(r.Top + (r.Height - w) / 2 + w));\r\n            pomVertical: bkget.BoundsRect := RectF(Int(r.Left + (r.Width - w) / 2), Int(r.Bottom), Int(r.Left + (r.Width - w) / 2 + w), Int(r.Bottom + h));\r\n          end;\r\n          {$ENDIF}\r\n          {$IFDEF CMNWEBLIB}\r\n          case OrientationMode of\r\n            pomHorizontal: bkgst.BoundsRect := Rect(Round(r.Left - h) + 1, Round(r.Top + ((r.Bottom - r.Top) - w) / 2), Round(r.Left) + 1, Round(r.Top + ((r.Bottom - r.Top) - w) / 2 + w));\r\n            pomVertical: bkgst.BoundsRect := Rect(Round(r.Left + ((r.Right - r.Left) - w) / 2), Round(r.Top - h) + 1, Round(r.Left + ((r.Right - r.Left) - w) / 2 + w), Round(r.Top) + 1);\r\n          end;\r\n          r := GetLastRect(FActiveItem);\r\n          case OrientationMode of\r\n            pomHorizontal: bkget.BoundsRect := Rect(Round(r.Right), Round(r.Top + ((r.Bottom - r.Top) - w) / 2), Round(r.Right + h), Round(r.Top + ((r.Bottom - r.Top) - w) / 2 + w));\r\n            pomVertical: bkget.BoundsRect := Rect(Round(r.Left + ((r.Right - r.Left) - w) / 2), Round(r.Bottom), Round(r.Left + ((r.Right - r.Left) - w) / 2 + w), Round(r.Bottom + h));\r\n          end;\r\n          {$ENDIF}\r\n        end;\r\n      end\r\n      else\r\n      begin\r\n        bkgst.Parent := nil;\r\n        bkget.Parent := nil;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateTimeLinesCache;\r\nbegin\r\n  UpdateTimeLineCache(FTimeLineLeftCache);\r\n  UpdateTimeLineCache(FTimeLineRightCache);\r\n  UpdateTimeLineDisplay;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateTimeLineCache(ACache: TTMSFNCPlannerCache);\r\nvar\r\n  w, h, bmpw, bmph, bw, bh: Double;\r\n  bmp: TBitmap;\r\n  rt: TRectF;\r\n  r: Integer;\r\n  dy: Double;\r\n  offsety: Double;\r\n  ar: Integer;\r\n  rc: TRectF;\r\n  cnt: Integer;\r\n  dt: Double;\r\n  bmpvalid: Boolean;\r\n  du: TDateTime;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  inherited;\r\n  if (UpdateCount > 0) or (csDestroying in ComponentState) or not Assigned(ACache) then\r\n    Exit;\r\n\r\n  ACache.Clear;\r\n\r\n  if (ACache is TTMSFNCPlannerTimeLineLeftCache) and (not (ptlLeft in TimeLineAppearance.Layouts) or (TimeLineAppearance.LeftSize <= 0)) then\r\n    Exit;\r\n\r\n  if (ACache is TTMSFNCPlannerTimeLineRightCache) and (not (ptlRight in TimeLineAppearance.Layouts) or (TimeLineAppearance.RightSize <= 0)) then\r\n    Exit;\r\n\r\n  case OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      w := GetTotalRowHeight;\r\n      if ACache is TTMSFNCPlannerTimeLineLeftCache then\r\n        h := GetTimeLineLeftSize + 1\r\n      else\r\n        h := GetTimeLineRightSize + 1;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      h := GetTotalRowHeight;\r\n      if ACache is TTMSFNCPlannerTimeLineLeftCache then\r\n        w := GetTimeLineLeftSize + 1\r\n      else\r\n        w := GetTimeLineRightSize + 1;\r\n    end;\r\n    else\r\n    begin\r\n      w := 0;\r\n      h := 0;\r\n    end;\r\n  end;\r\n\r\n  bmpvalid := False;\r\n  offsety := 0;\r\n  bmpw := 0;\r\n  bmph := 0;\r\n  ar := 0;\r\n  r := 0;\r\n  dy := 0;\r\n\r\n  cnt := RowCount - 1;\r\n\r\n  while bmpw < w do\r\n  begin\r\n    if TimeLineCaching then\r\n      bw := Min(w - bmpw, GetCacheWidth)\r\n    else\r\n      bw := w;\r\n\r\n    while bmph < h do\r\n    begin\r\n      if TimeLineCaching then\r\n        bh := Min(h - bmph, GetCacheHeight)\r\n      else\r\n        bh := h;\r\n\r\n      bmp := nil;\r\n      if TimeLineCaching then\r\n        bmpvalid := CreateAndPrepareBitmap(bmp, bw, bh);\r\n\r\n      g := nil;\r\n      if bmpvalid then\r\n        g := TTMSFNCGraphics.Create(bmp.Canvas);\r\n\r\n      rt := RectF(0, 0, bw, bh);\r\n\r\n      case OrientationMode of\r\n        pomHorizontal: dy := rt.Left + offsety;\r\n        pomVertical: dy := rt.Top + offsety;\r\n      end;\r\n\r\n      case GetDisplayMode of\r\n        pmMultiMonth:\r\n        begin\r\n          dt := (FDisplayStart + 1);\r\n          du := 1;\r\n        end;\r\n        else\r\n        begin\r\n          dt := FDisplayStartTime;\r\n          du := GetDisplayUnitValue;\r\n        end;\r\n      end;\r\n\r\n      dt := dt + ar* du;\r\n\r\n      for r := ar to cnt do\r\n      begin\r\n        if (GetDisplayMode = pmCustom) and (r >= 0) and (r <= FCustomDatesList.Count - 1) then\r\n          dt := FCustomDatesList[r];\r\n\r\n        {$IFDEF FMXWEBLIB}\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            rc.Top := int(rt.Top) + 0.5;\r\n            rc.Bottom := int(rt.Bottom) - 0.5;\r\n            rc.Left := int(dy) + 0.5;\r\n            dy := dy + RowHeights[r];\r\n            if r = cnt then\r\n              rc.Right := int(dy) - 0.5\r\n            else\r\n              rc.Right := int(dy) + 0.5;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            rc.Left := int(rt.Left) + 0.5;\r\n            rc.Right := int(rt.Right) - 0.5;\r\n            rc.Top := int(dy) + 0.5;\r\n            dy := dy + RowHeights[r];\r\n            if r = cnt then\r\n              rc.Bottom := int(dy) - 0.5\r\n            else\r\n              rc.Bottom := int(dy) + 0.5;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n        {$IFDEF CMNLIB}\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            rc.Top := rt.Top;\r\n            rc.Bottom := rt.Bottom;\r\n            rc.Left := dy;\r\n            dy := dy + RowHeights[r];\r\n            if r = cnt then\r\n              rc.Right := dy\r\n            else\r\n              rc.Right := dy;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            rc.Left := rt.Left;\r\n            rc.Right := rt.Right;\r\n            rc.Top := dy;\r\n            dy := dy + RowHeights[r];\r\n            if r = cnt then\r\n              rc.Bottom := dy\r\n            else\r\n              rc.Bottom := dy;\r\n          end;\r\n        end;\r\n        {$ENDIF}\r\n\r\n        if TimeLineCaching then\r\n        begin\r\n          if bmpvalid then\r\n          begin\r\n            if ACache is TTMSFNCPlannerTimeLineLeftCache then\r\n              DrawTime(g, rc, dt, r, ikTimeLineLeft)\r\n            else\r\n              DrawTime(g, rc, dt, r, ikTimeLineRight);\r\n          end;\r\n        end\r\n        else\r\n        begin\r\n          OffsetRectEx(rc, bmpw, bmph);\r\n          if ACache is TTMSFNCPlannerTimeLineLeftCache then\r\n            ACache.Add(TTMSFNCPlannerCacheItem.CreateTimeLineLeft(rc, dt, r))\r\n          else\r\n            ACache.Add(TTMSFNCPlannerCacheItem.CreateTimeLineRight(rc, dt, r));\r\n        end;\r\n\r\n        case OrientationMode of\r\n          pomHorizontal:\r\n          begin\r\n            if dy > rt.Right - rt.Left then\r\n              Break;\r\n          end;\r\n          pomVertical:\r\n          begin\r\n            if dy > rt.Bottom - rt.Top then\r\n            begin\r\n              ar := r;\r\n              offsety := -RowHeights[r] - (bh - dy);\r\n              Break;\r\n            end;\r\n          end;\r\n        end;\r\n\r\n        if GetDisplayMode <> pmCustom then\r\n          dt := dt + du;\r\n      end;\r\n\r\n      if TimeLineCaching then\r\n      begin\r\n        OffsetRectEx(rt, bmpw, bmph);\r\n        if bmpvalid then\r\n        begin\r\n          {$IFDEF FMXLIB}\r\n          bmp.Canvas.EndScene;\r\n          {$ENDIF}\r\n          if Assigned(g) then\r\n            g.Free;\r\n        end;\r\n\r\n        if ACache is TTMSFNCPlannerTimeLineLeftCache then\r\n          ACache.Add(TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikTimeLineLeft))\r\n        else\r\n          ACache.Add(TTMSFNCPlannerCacheItem.CreateCache(rt, bmp, ikTimeLineRight));\r\n      end;\r\n      bmph := bmph + bh;\r\n    end;\r\n    bmpw := bmpw + bw;\r\n    bmph := 0;\r\n    case OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        ar := r;\r\n        offsety := -RowHeights[r] - (bw - dy);\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.UpdateTimeLineDisplay;\r\nbegin\r\n  BuildDisplay(FTimeLineLeftCache, FTimeLineLeftDisplay);\r\n  BuildDisplay(FTimeLineRightCache, FTimeLineRightDisplay);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.ValueToDateTime(AValue: Double; APosition: Integer = -1; ARow: Integer = -1): TDateTime;\r\nvar\r\n  st, et: Double;\r\n  s: Double;\r\n  c: Double;\r\n  v: Double;\r\n  cr: Integer;\r\n  crh: Double;\r\nbegin\r\n  Result := 0;\r\n  v := AValue;\r\n  c := GetTotalRowHeight;\r\n\r\n  if GetDisplayMode = pmCustom then\r\n  begin\r\n    if ARow = -1 then\r\n    begin\r\n      if c > 0 then\r\n      begin\r\n        cr := Floor((v / c) * RowCount);\r\n        cr := cr - 1;\r\n        if cr = -1 then\r\n          cr := cr + 1;\r\n\r\n        crh := RowHeights[cr];\r\n        if (cr >= 0) and (cr < FCustomDatesList.Count) and (crh > 0) then\r\n        begin\r\n          st := FCustomDatesList[cr];\r\n          et := FCustomDatesList[cr + 1];\r\n          s := (et - st) / crh;\r\n          Result := st + ((v - RowPositions[cr]) * s);\r\n        end;\r\n      end;\r\n    end\r\n    else\r\n    begin\r\n      if (ARow >= 0) and (ARow < FCustomDatesList.Count) then\r\n        Result := FCustomDatesList[ARow];\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    case GetDisplayMode of\r\n      pmMultiMonth:\r\n      begin\r\n        st := FDisplayStart;\r\n        et := FDisplayEnd;\r\n        Result := FDisplayStartTime;\r\n        Result := IncMonth(Result, APosition);\r\n      end\r\n      else\r\n      begin\r\n        st := FDisplayStartTime;\r\n        et := FDisplayEndTime;\r\n        Result := st;\r\n      end;\r\n    end;\r\n\r\n    if c > 0 then\r\n    begin\r\n      s := (et - st) / c;\r\n      Result := Result + (v * s);\r\n    end;\r\n\r\n    case GetDisplayMode of\r\n      pmMultiDay: Result := IncDay(Result, APosition);\r\n      pmMultiDayRes: Result := IncDay(Result, APosition mod Max(1, GetNumDays));\r\n      pmMultiResDay: Result := IncDay(Result, APosition div Max(1, Resources.Count));\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCCustomPlanner.VerticalScrollPositionChanged;\r\nbegin\r\n  BlockScrollingUpdate := True;\r\n  UpdateDisplay;\r\n  BlockScrollingUpdate := False;\r\n  DoVScroll(GetVScrollValue);\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.XYToItemAnchor(AItem: TTMSFNCPlannerItem; X,\r\n  Y: Single): String;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItemOpen;\r\n  txtr: TRectF;\r\n  a: String;\r\n  str: String;\r\n  g: TTMSFNCGraphics;\r\nbegin\r\n  if Assigned(AItem) then\r\n  begin\r\n    g := TTMSFNCGraphics.CreateBitmapCanvas;\r\n    try\r\n      it := TTMSFNCPlannerItemOpen(AItem);\r\n      for I := 0 to it.CacheList.Count - 1 do\r\n      begin\r\n        txtr := GetCacheItemTextRect(it.CacheList[I]);\r\n        if PtInRectEx(txtr, PointF(X, Y)) then\r\n        begin\r\n          str := AItem.Text;\r\n          DoGetItemText(AItem, pgtmDrawing, str);\r\n          a := g.DrawText(txtr, str, True, ItemsAppearance.TextHorizontalTextAlign, ItemsAppearance.TextVerticalTextAlign, gttNone, 0, -1, -1, True, True, X, Y);\r\n          if a <> '' then\r\n          begin\r\n            Result := a;\r\n            Break;\r\n          end;\r\n        end;\r\n      end;\r\n    finally\r\n      g.Free;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.XYToTime(X, Y: Double): TTMSFNCPlannerTime;\r\nvar\r\n  cl: TTMSFNCPlannerCell;\r\nbegin\r\n  cl := XYToCell(X, Y);\r\n  if (cl.Col <> -1) and (cl.Row <> -1) then\r\n  begin\r\n    Result.StartTime := CellToDateTime(cl);\r\n    Result.EndTime := CellToDateTime(MakeCell(cl.Col, cl.Row + 1))\r\n  end\r\n  else\r\n  begin\r\n    Result.StartTime := -1;\r\n    Result.EndTime := -1;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.XYToCacheItem(X,\r\n  Y: Double): TTMSFNCPlannerCacheItem;\r\nvar\r\n  I: Integer;\r\n  dsp: TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := nil;\r\n  if not Assigned(FItemDisplay) then\r\n    Exit;\r\n\r\n  for I := 0 to FItemDisplay.Count - 1 do\r\n  begin\r\n    dsp := FItemDisplay[I];\r\n    if PtInRectEx(dsp.DrawRect, PointF(X, Y)) then\r\n    begin\r\n      Result := dsp;\r\n      Break;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.XYToCell(X, Y: Double): TTMSFNCPlannerCell;\r\nbegin\r\n  Result := inherited XYToCell(X, Y);\r\n  if (Result.Col >= 0) and (Result.Col <= ColumnCount - 1) and (Result.Row >= 0) and (Result.Row <= RowCount - 1) then\r\n  begin\r\n    if IsCellDisabled(Result) then\r\n    begin\r\n      Result.Col := -1;\r\n      Result.Row := -1;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCCustomPlanner.XYToItem(X, Y: Double): TTMSFNCPlannerItem;\r\nvar\r\n  dsp: TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := nil;\r\n  dsp := XYToCacheItem(X, Y);\r\n  if Assigned(dsp) then\r\n    Result := dsp.Item;\r\nend;\r\n\r\n{ TTMSFNCPlanner }\r\n\r\nprocedure TTMSFNCPlanner.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  {$IFNDEF WEBLIB}\r\n  RegisterClasses([TTMSFNCPlanner, TTMSFNCPlannerItem, TTMSFNCPlannerResource]);\r\n  {$ENDIF}\r\nend;\r\n\r\n{ TTMSFNCPlannerItemsAppearance }\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerItemsAppearance then\r\n  begin\r\n    FGap := (Source as TTMSFNCPlannerItemsAppearance).Gap;\r\n    FMoveAreaSize := (Source as TTMSFNCPlannerItemsAppearance).MoveAreaSize;\r\n    FMoveAreaColor := (Source as TTMSFNCPlannerItemsAppearance).MoveAreaColor;\r\n    FSizeAreaSize := (Source as TTMSFNCPlannerItemsAppearance).SizeAreaSize;\r\n    FDeleteAreaSize := (Source as TTMSFNCPlannerItemsAppearance).DeleteAreaSize;\r\n    FSizeAreaColor := (Source as TTMSFNCPlannerItemsAppearance).SizeAreaColor;\r\n    FDeleteAreaColor := (Source as TTMSFNCPlannerItemsAppearance).DeleteAreaColor;\r\n    FFill.Assign((Source as TTMSFNCPlannerItemsAppearance).Fill);\r\n    FStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).Stroke);\r\n    FFont.Assign((Source as TTMSFNCPlannerItemsAppearance).Font);\r\n    FTitleFill.Assign((Source as TTMSFNCPlannerItemsAppearance).TitleFill);\r\n    FTitleStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).TitleStroke);\r\n    FTitleFont.Assign((Source as TTMSFNCPlannerItemsAppearance).TitleFont);\r\n    FSelectedFill.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedFill);\r\n    FSelectedStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedStroke);\r\n    FSelectedFont.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedFont);\r\n    FSelectedTitleFill.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedTitleFill);\r\n    FSelectedTitleStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedTitleStroke);\r\n    FSelectedTitleFont.Assign((Source as TTMSFNCPlannerItemsAppearance).SelectedTitleFont);\r\n    FActiveFill.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveFill);\r\n    FActiveStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveStroke);\r\n    FActiveFont.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveFont);\r\n    FActiveTitleFill.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveTitleFill);\r\n    FActiveTitleStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveTitleStroke);\r\n    FActiveTitleFont.Assign((Source as TTMSFNCPlannerItemsAppearance).ActiveTitleFont);\r\n    FDisabledFill.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledFill);\r\n    FDisabledStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledStroke);\r\n    FDisabledFont.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledFont);\r\n    FDisabledTitleFill.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledTitleFill);\r\n    FDisabledTitleStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledTitleStroke);\r\n    FDisabledTitleFont.Assign((Source as TTMSFNCPlannerItemsAppearance).DisabledTitleFont);\r\n    FShowItemHelpers := (Source as TTMSFNCPlannerItemsAppearance).ShowItemHelpers;\r\n    FSizeHandlerHeight := (Source as TTMSFNCPlannerItemsAppearance).SizeHandlerHeight;\r\n    FSizeHandlerWidth := (Source as TTMSFNCPlannerItemsAppearance).SizeHandlerWidth;\r\n    FDeleteHandlerHeight := (Source as TTMSFNCPlannerItemsAppearance).DeleteHandlerHeight;\r\n    FDeleteHandlerWidth := (Source as TTMSFNCPlannerItemsAppearance).DeleteHandlerWidth;\r\n    FSizeHandlerUpBitmap.Assign((Source as TTMSFNCPlannerItemsAppearance).SizeHandlerUpBitmap);\r\n    FSizeHandlerDownBitmap.Assign((Source as TTMSFNCPlannerItemsAppearance).SizeHandlerDownBitmap);\r\n    FSizeHandlerLeftBitmap.Assign((Source as TTMSFNCPlannerItemsAppearance).SizeHandlerLeftBitmap);\r\n    FSizeHandlerRightBitmap.Assign((Source as TTMSFNCPlannerItemsAppearance).SizeHandlerRightBitmap);\r\n    FDeleteHandlerBitmap.Assign((Source as TTMSFNCPlannerItemsAppearance).DeleteHandlerBitmap);\r\n    FShowLinks := (Source as TTMSFNCPlannerItemsAppearance).ShowLinks;\r\n    FLinkArrowSize := (Source as TTMSFNCPlannerItemsAppearance).LinkArrowSize;\r\n    FLinkArrowShape := (Source as TTMSFNCPlannerItemsAppearance).LinkArrowShape;\r\n    FLinkStroke.Assign((Source as TTMSFNCPlannerItemsAppearance).LinkStroke);\r\n    FTextVerticalTextAlign := (Source as TTMSFNCPlannerItemsAppearance).TextVerticalTextAlign;\r\n    FTextHorizontalTextAlign := (Source as TTMSFNCPlannerItemsAppearance).TextHorizontalTextAlign;\r\n    FTitleVerticalTextAlign := (Source as TTMSFNCPlannerItemsAppearance).TitleVerticalTextAlign;\r\n    FTitleHorizontalTextAlign := (Source as TTMSFNCPlannerItemsAppearance).TitleHorizontalTextAlign;    \r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.UpdatePlannerCache;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerItemsAppearance.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FGap := 10;\r\n  FSizeAreaSize := 4;\r\n  FMoveAreaSize := 4;\r\n  FDeleteAreaSize := 16;\r\n  FShowItemSizeHandlers := True;\r\n  FShowItemHelpers := True;\r\n  FSizeHandlerWidth := 50;\r\n  FSizeHandlerHeight := 30;\r\n  FDeleteHandlerWidth := 30;\r\n  FDeleteHandlerHeight := 30;\r\n  FShowLinks := False;\r\n  FLinkArrowShape := lasNormal;\r\n  FLinkArrowSize := 7;\r\n  FTitleHorizontalTextAlign := gtaLeading;\r\n  FTitleVerticalTextAlign := gtaLeading;\r\n  FTextHorizontalTextAlign := gtaLeading;\r\n  FTextVerticalTextAlign := gtaLeading;\r\n  FSizeHandlerUpBitmap := TTMSFNCBitmap.Create;\r\n  FSizeHandlerUpBitmap.LoadFromResource('TTMSFNCPLANNERARROWUP', HInstance);\r\n  FSizeHandlerUpBitmap.OnChange := @Changed;\r\n  FSizeHandlerRightBitmap := TTMSFNCBitmap.Create;\r\n  FSizeHandlerRightBitmap.LoadFromResource('TTMSFNCPLANNERARROWRIGHT', HInstance);\r\n  FSizeHandlerRightBitmap.OnChange := @Changed;\r\n  FDeleteHandlerBitmap := TTMSFNCBitmap.Create;\r\n  FDeleteHandlerBitmap.LoadFromResource('TTMSFNCPLANNERDELETE', HInstance);\r\n  FDeleteHandlerBitmap.OnChange := @Changed;\r\n  FSizeHandlerLeftBitmap := TTMSFNCBitmap.Create;\r\n  FSizeHandlerLeftBitmap.LoadFromResource('TTMSFNCPLANNERARROWLEFT', HInstance);\r\n  FSizeHandlerLeftBitmap.OnChange := @Changed;\r\n  FSizeHandlerDownBitmap := TTMSFNCBitmap.Create;\r\n  FSizeHandlerDownBitmap.LoadFromResource('TTMSFNCPLANNERARROWDOWN', HInstance);\r\n  FSizeHandlerDownBitmap.OnChange := @Changed;\r\n  FMoveAreaColor := TMSFNCPlannerAreaColor;\r\n  FSizeAreaColor := TMSFNCPlannerAreaColor;\r\n  FDeleteAreaColor := gcSteelBlue;\r\n  FShowMoveArea := True;\r\n  FShowSizeArea := True;\r\n  FShowDeleteArea := False;\r\n  FLinkStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FLinkStroke.Width := 2;\r\n  FFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcDarkGray);\r\n  FStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FTitleFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FTitleStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FSelectedFill := TTMSFNCGraphicsFill.Create(gfkSolid, TMSFNCPlannerSelectedColor);\r\n  FSelectedStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FSelectedTitleFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FSelectedTitleStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FActiveFill := TTMSFNCGraphicsFill.Create(gfkSolid, TMSFNCPlannerSelectedColor);\r\n  FActiveStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FActiveTitleFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FActiveTitleStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FDisabledFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcDarkGray);\r\n  FDisabledStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n  FDisabledTitleFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcDarkGray);\r\n  FDisabledTitleStroke := TTMSFNCGraphicsStroke.Create(gskNone, gcDarkGray);\r\n\r\n  FFont := TTMSFNCGraphicsFont.Create;\r\n  FTitleFont := TTMSFNCGraphicsFont.Create;\r\n  FTitleFont.Style := [TFontStyle.fsBold];\r\n  FSelectedFont := TTMSFNCGraphicsFont.Create;\r\n  FSelectedTitleFont := TTMSFNCGraphicsFont.Create;\r\n  FSelectedTitleFont.Style := [TFontStyle.fsBold];\r\n  FActiveFont := TTMSFNCGraphicsFont.Create;\r\n  FActiveTitleFont := TTMSFNCGraphicsFont.Create;\r\n  FActiveTitleFont.Style := [TFontStyle.fsBold];\r\n  FDisabledFont := TTMSFNCGraphicsFont.Create;\r\n  FDisabledTitleFont := TTMSFNCGraphicsFont.Create;\r\n  FDisabledTitleFont.Style := [TFontStyle.fsBold];\r\n\r\n  TTMSFNCUtils.SetFontSize(FTitleFont, 16);\r\n  TTMSFNCUtils.SetFontSize(FSelectedTitleFont, 16);\r\n  TTMSFNCUtils.SetFontSize(FActiveTitleFont, 16);\r\n  TTMSFNCUtils.SetFontSize(FDisabledTitleFont, 16);\r\n\r\n  FFill.OnChanged := @Changed;\r\n  FStroke.OnChanged := @Changed;\r\n  FFont.OnChanged := @Changed;\r\n\r\n  FTitleFill.OnChanged := @Changed;\r\n  FTitleStroke.OnChanged := @Changed;\r\n  FTitleFont.OnChanged := @Changed;\r\n\r\n  FSelectedFill.OnChanged := @Changed;\r\n  FSelectedStroke.OnChanged := @Changed;\r\n  FSelectedFont.OnChanged := @Changed;\r\n\r\n  FSelectedTitleFill.OnChanged := @Changed;\r\n  FSelectedTitleStroke.OnChanged := @Changed;\r\n  FSelectedTitleFont.OnChanged := @Changed;\r\n\r\n  FActiveFill.OnChanged := @Changed;\r\n  FActiveStroke.OnChanged := @Changed;\r\n  FActiveFont.OnChanged := @Changed;\r\n\r\n  FActiveTitleFill.OnChanged := @Changed;\r\n  FActiveTitleStroke.OnChanged := @Changed;\r\n  FActiveTitleFont.OnChanged := @Changed;\r\n\r\n  FDisabledFill.OnChanged := @Changed;\r\n  FDisabledStroke.OnChanged := @Changed;\r\n  FDisabledFont.OnChanged := @Changed;\r\n\r\n  FDisabledTitleFill.OnChanged := @Changed;\r\n  FDisabledTitleStroke.OnChanged := @Changed;\r\n  FDisabledTitleFont.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerItemsAppearance.Destroy;\r\nbegin\r\n  FDeleteHandlerBitmap.Free;\r\n  FSizeHandlerUpBitmap.Free;\r\n  FSizeHandlerLeftBitmap.Free;\r\n  FSizeHandlerDownBitmap.Free;\r\n  FSizeHandlerRightBitmap.Free;\r\n\r\n  FFill.Free;\r\n  FStroke.Free;\r\n  FLinkStroke.Free;\r\n  FFont.Free;\r\n  FTitleFill.Free;\r\n  FTitleStroke.Free;\r\n  FTitleFont.Free;\r\n\r\n  FSelectedFill.Free;\r\n  FSelectedStroke.Free;\r\n  FSelectedFont.Free;\r\n\r\n  FSelectedTitleFill.Free;\r\n  FSelectedTitleStroke.Free;\r\n  FSelectedTitleFont.Free;\r\n\r\n  FActiveFill.Free;\r\n  FActiveStroke.Free;\r\n  FActiveFont.Free;\r\n\r\n  FActiveTitleFill.Free;\r\n  FActiveTitleStroke.Free;\r\n  FActiveTitleFont.Free;\r\n\r\n  FDisabledFill.Free;\r\n  FDisabledStroke.Free;\r\n  FDisabledFont.Free;\r\n\r\n  FDisabledTitleFill.Free;\r\n  FDisabledTitleStroke.Free;\r\n  FDisabledTitleFont.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FActiveFill <> Value then\r\n    FActiveFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FActiveFont <> Value then\r\n    FActiveFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveTitleFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FActiveTitleFill <> Value then\r\n    FActiveTitleFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveTitleFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FActiveTitleFont <> Value then\r\n    FActiveTitleFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FActiveTitleStroke <> Value then\r\n    FActiveTitleStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetActiveStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FActiveStroke <> Value then\r\n    FActiveStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FSelectedFill <> Value then\r\n    FSelectedFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FSelectedFont <> Value then\r\n    FSelectedFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedTitleFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FSelectedTitleFill <> Value then\r\n    FSelectedTitleFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedTitleFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FSelectedTitleFont <> Value then\r\n    FSelectedTitleFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FSelectedTitleStroke <> Value then\r\n    FSelectedTitleStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetShowDeleteArea(const Value: Boolean);\r\nbegin\r\n  if FShowDeleteArea <> Value then\r\n  begin\r\n    FShowDeleteArea := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetShowItemHelpers(\r\n  const Value: Boolean);\r\nbegin\r\n  if FShowItemHelpers <> Value then\r\n    FShowItemHelpers := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetShowLinks(const Value: Boolean);\r\nbegin\r\n  if FShowLinks <> Value then\r\n  begin\r\n    FShowLinks := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetShowMoveArea(const Value: Boolean);\r\nbegin\r\n  if FShowMoveArea <> Value then\r\n  begin\r\n    FShowMoveArea := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetShowSizeArea(const Value: Boolean);\r\nbegin\r\n  if FShowSizeArea <> Value then\r\n  begin\r\n    FShowSizeArea := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSelectedStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FSelectedStroke <> Value then\r\n    FSelectedStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FFill <> Value then\r\n    FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FFont <> Value then\r\n    FFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTextHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTextHorizontalTextAlign <> Value then\r\n  begin\r\n    FTextHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTextVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTextVerticalTextAlign <> Value then\r\n  begin\r\n    FTextVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTitleFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTitleFill <> Value then\r\n    FTitleFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTitleFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FTitleFont <> Value then\r\n    FTitleFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTitleHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTitleHorizontalTextAlign <> Value then\r\n  begin\r\n    FTitleHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTitleStroke <> Value then\r\n    FTitleStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetTitleVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTitleVerticalTextAlign <> Value then\r\n  begin\r\n    FTitleVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FStroke <> Value then\r\n    FStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDeleteAreaColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FDeleteAreaColor <> Value then\r\n  begin\r\n    FDeleteAreaColor := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDeleteAreaSize(const Value: Double);\r\nbegin\r\n  if FDeleteAreaSize <> Value then\r\n  begin\r\n    FDeleteAreaSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDeleteHandlerBitmap(\r\n  const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FDeleteHandlerBitmap <> Value then\r\n  begin\r\n    FDeleteHandlerBitmap.Assign(Value);\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDeleteHandlerHeight(\r\n  const Value: Double);\r\nbegin\r\n  if FDeleteHandlerHeight <> Value then\r\n  begin\r\n    FDeleteHandlerHeight := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDeleteHandlerWidth(\r\n  const Value: Double);\r\nbegin\r\n  if FDeleteHandlerWidth <> Value then\r\n  begin\r\n    FDeleteHandlerWidth := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FDisabledFill <> Value then\r\n    FDisabledFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FDisabledFont <> Value then\r\n    FDisabledFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledTitleFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FDisabledTitleFill <> Value then\r\n    FDisabledTitleFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledTitleFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FDisabledTitleFont <> Value then\r\n    FDisabledTitleFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledTitleStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FDisabledTitleStroke <> Value then\r\n    FDisabledTitleStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetDisabledStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FDisabledStroke <> Value then\r\n    FDisabledStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetGap(const Value: Double);\r\nbegin\r\n  if FGap <> Value then\r\n  begin\r\n    FGap := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetLinkArrowShape(\r\n  const Value: TTMSFNCPlannerLinkArrowShape);\r\nbegin\r\n  if FLinkArrowShape <> Value then\r\n  begin\r\n    FLinkArrowShape := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetLinkArrowSize(const Value: Double);\r\nbegin\r\n  if FLinkArrowSize <> Value then\r\n  begin\r\n    FLinkArrowSize := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetLinkStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FLinkStroke <> Value then\r\n    FLinkStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetMoveAreaSize(const Value: Double);\r\nbegin\r\n  if FMoveAreaSize <> Value then\r\n  begin\r\n    FMoveAreaSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetMoveAreaColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FMoveAreaColor <> Value then\r\n  begin\r\n    FMoveAreaColor := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeAreaSize(const Value: Double);\r\nbegin\r\n  if FSizeAreaSize <> Value then\r\n  begin\r\n    FSizeAreaSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeAreaColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FSizeAreaColor <> Value then\r\n  begin\r\n    FSizeAreaColor := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerDownBitmap(\r\n  const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FSizeHandlerDownBitmap <> Value then\r\n  begin\r\n    FSizeHandlerDownBitmap.Assign(Value);\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerLeftBitmap(\r\n  const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FSizeHandlerLeftBitmap <> Value then\r\n  begin\r\n    FSizeHandlerLeftBitmap.Assign(Value);\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerHeight(\r\n  const Value: Double);\r\nbegin\r\n  if FSizeHandlerHeight <> Value then\r\n  begin\r\n    FSizeHandlerHeight := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerRightBitmap(\r\n  const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FSizeHandlerRightBitmap <> Value then\r\n  begin\r\n    FSizeHandlerRightBitmap.Assign(Value);\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerWidth(\r\n  const Value: Double);\r\nbegin\r\n  if FSizeHandlerHeight <> Value then\r\n  begin\r\n    FSizeHandlerWidth := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerItemsAppearance.SetSizeHandlerUpBitmap(\r\n  const Value: TTMSFNCBitmap);\r\nbegin\r\n  if FSizeHandlerUpBitmap <> Value then\r\n  begin\r\n    FSizeHandlerUpBitmap.Assign(Value);\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerDisplay }\r\n\r\nprocedure TTMSFNCPlannerTimeLine.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerTimeLine then\r\n  begin\r\n    FCurrentTimeMode := (Source as TTMSFNCPlannerTimeLine).CurrentTimeMode;\r\n    FCurrentTimePosition := (Source as TTMSFNCPlannerTimeLine).CurrentTimePosition;\r\n    FDisplayUnit := (Source as TTMSFNCPlannerTimeLine).DisplayUnit;\r\n    FDisplayUnitSize := (Source as TTMSFNCPlannerTimeLine).DisplayUnitSize;\r\n    FDisplaySubUnitFormat := (Source as TTMSFNCPlannerTimeLine).DisplaySubUnitFormat;\r\n    FDisplayUnitFormat := (Source as TTMSFNCPlannerTimeLine).DisplayUnitFormat;\r\n    FDisplayUnitType := (Source as TTMSFNCPlannerTimeLine).DisplayUnitType;\r\n    FDisplayOffsetType := (Source as TTMSFNCPlannerTimeLine).DisplayOffsetType;\r\n    FDisplayOffset := (Source as TTMSFNCPlannerTimeLine).DisplayOffset;\r\n    FDisplayStart := (Source as TTMSFNCPlannerTimeLine).DisplayStart;\r\n    FDisplayEnd := (Source as TTMSFNCPlannerTimeLine).DisplayEnd;\r\n    FActiveStart := (Source as TTMSFNCPlannerTimeLine).ActiveStart;\r\n    FActiveEnd := (Source as TTMSFNCPlannerTimeLine).ActiveEnd;\r\n    FViewStart := (Source as TTMSFNCPlannerTimeLine).ViewStart;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerTimeLine.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FCurrentTimeMode := pctmLine;\r\n  FCurrentTimePosition := pctpUnderItems;\r\n  FDisplayUnit := 30;\r\n  FDisplayUnitSize := 25;\r\n  FDisplayStart := 0;\r\n  FDisplayEnd := 47;\r\n  FActiveStart := 16;\r\n  FActiveEnd := 40;\r\n  FDisplaySubUnitFormat := '';\r\n  FDisplayUnitType := pduMinute;\r\n  FDisplayOffsetType := pduMinute;\r\n  FDisplayOffset := 0;\r\n  FViewStart := Int(Now);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetViewStart(const Value: TDateTime);\r\nbegin\r\n  if FViewStart <> Value then\r\n  begin\r\n    FViewStart := Value;\r\n    FPlanner.UpdateScrollPosition;\r\n    FPlanner.UpdateDisplay;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerTimeLine.GetViewStart: TDateTime;\r\nbegin\r\n  Result := FViewStart;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayUnit(const Value: Integer);\r\nbegin\r\n  if FDisplayUnit <> Value then\r\n  begin\r\n    FDisplayUnit := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplaySubUnitFormat(const Value: String);\r\nbegin\r\n  if FDisplaySubUnitFormat <> Value then\r\n  begin\r\n    FDisplaySubUnitFormat := Value;\r\n    FPlanner.UpdatePlannerCache(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetActiveEnd(const Value: Integer);\r\nbegin\r\n  if FActiveEnd <> Value then\r\n  begin\r\n    FActiveEnd := Value;\r\n    FPlanner.UpdatePlannerCache(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetActiveStart(const Value: Integer);\r\nbegin\r\n  if FActiveStart <> Value then\r\n  begin\r\n    FActiveStart := Value;\r\n    FPlanner.UpdatePlannerCache(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetCurrentTimeMode(\r\n  const Value: TTMSFNCPlannerCurrentTimeMode);\r\nbegin\r\n  if FCurrentTimeMode <> Value then\r\n  begin\r\n    FCurrentTimeMode := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetCurrentTimePosition(\r\n  const Value: TTMSFNCPlannerCurrentTimePosition);\r\nbegin\r\n  if FCurrentTimePosition <> Value then\r\n  begin\r\n    FCurrentTimePosition := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayEnd(const Value: Integer);\r\nbegin\r\n  if FDisplayEnd <> Value then\r\n  begin\r\n    FDisplayEnd := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayUnitFormat(const Value: String);\r\nbegin\r\n  if FDisplayUnitFormat <> Value then\r\n  begin\r\n    FDisplayUnitFormat := Value;\r\n    FPlanner.UpdatePlannerCache(False);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayOffset(const Value: Integer);\r\nbegin\r\n  if FDisplayOffset <> Value then\r\n  begin\r\n    FDisplayOffset := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayOffsetType(\r\n  const Value: TTMSFNCPlannerDisplayUnitType);\r\nbegin\r\n  if FDisplayOffsetType <> Value then\r\n  begin\r\n    FDisplayOffsetType := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayStart(const Value: Integer);\r\nbegin\r\n  if FDisplayStart <> Value then\r\n  begin\r\n    FDisplayStart := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayUnitSize(const Value: Double);\r\nbegin\r\n  if FDisplayUnitSize <> Value then\r\n  begin\r\n    FDisplayUnitSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLine.SetDisplayUnitType(\r\n  const Value: TTMSFNCPlannerDisplayUnitType);\r\nbegin\r\n  if FDisplayUnitType <> Value then\r\n  begin\r\n    FDisplayUnitType := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerTimeLineAppearance }\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerTimeLineAppearance then\r\n  begin\r\n    FLayouts := (Source as TTMSFNCPlannerTimeLineAppearance).Layouts;\r\n    FRightSize := (Source as TTMSFNCPlannerTimeLineAppearance).RightSize;\r\n    FLeftSize := (Source as TTMSFNCPlannerTimeLineAppearance).LeftSize;\r\n    FRightFill.Assign((Source as TTMSFNCPlannerTimeLineAppearance).RightFill);\r\n    FRightStroke.Assign((Source as TTMSFNCPlannerTimeLineAppearance).RightStroke);\r\n    FRightSubStroke.Assign((Source as TTMSFNCPlannerTimeLineAppearance).RightSubStroke);\r\n    FLeftFill.Assign((Source as TTMSFNCPlannerTimeLineAppearance).LeftFill);\r\n    FLeftFont.Assign((Source as TTMSFNCPlannerTimeLineAppearance).LeftFont);\r\n    FLeftStroke.Assign((Source as TTMSFNCPlannerTimeLineAppearance).LeftStroke);\r\n    FLeftSubStroke.Assign((Source as TTMSFNCPlannerTimeLineAppearance).LeftSubStroke);\r\n    FRightFont.Assign((Source as TTMSFNCPlannerTimeLineAppearance).RightFont);\r\n    FRightSubUnitFontSize := (Source as TTMSFNCPlannerTimeLineAppearance).RightSubUnitFontSize;\r\n    FLeftSubUnitFontSize := (Source as TTMSFNCPlannerTimeLineAppearance).LeftSubUnitFontSize;\r\n    FCurrentTimeColor := (Source as TTMSFNCPlannerTimeLineAppearance).CurrentTimeColor;\r\n    FStretch := (Source as TTMSFNCPlannerTimeLineAppearance).Stretch;\r\n    FLeftVerticalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).LeftVerticalTextAlign;\r\n    FLeftSubVerticalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).LeftSubVerticalTextAlign;\r\n    FLeftHorizontalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).LeftHorizontalTextAlign;\r\n    FLeftSubHorizontalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).LeftSubHorizontalTextAlign;\r\n    FRightVerticalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).RightVerticalTextAlign;\r\n    FRightSubVerticalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).RightSubVerticalTextAlign;\r\n    FRightHorizontalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).RightHorizontalTextAlign;\r\n    FRightSubHorizontalTextAlign := (Source as TTMSFNCPlannerTimeLineAppearance).RightSubHorizontalTextAlign;\r\n    FLeftSubVerticalTextMode := (Source as TTMSFNCPlannerTimeLineAppearance).LeftSubVerticalTextMode;\r\n    FRightSubVerticalTextMode := (Source as TTMSFNCPlannerTimeLineAppearance).RightSubVerticalTextMode;\r\n    FLeftVerticalTextMode := (Source as TTMSFNCPlannerTimeLineAppearance).LeftVerticalTextMode;\r\n    FRightVerticalTextMode := (Source as TTMSFNCPlannerTimeLineAppearance).RightVerticalTextMode;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerTimeLineAppearance.Create(\r\n  APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FStretch := False;\r\n  FCurrentTimeColor := gcOrange;\r\n  FLayouts := [ptlLeft];\r\n  FLeftSize := 50;\r\n  FRightSize := 50;\r\n  FLeftVerticalTextMode := pvtmNone;\r\n  FRightVerticalTextMode := pvtmNone;\r\n  FLeftSubVerticalTextMode := pvtmNone;\r\n  FRightSubVerticalTextMode := pvtmNone;\r\n  FLeftHorizontalTextAlign := gtaLeading;\r\n  FLeftVerticalTextAlign := gtaLeading;\r\n  FRightHorizontalTextAlign := gtaLeading;\r\n  FRightVerticalTextAlign := gtaLeading;\r\n  FLeftSubHorizontalTextAlign := gtaTrailing;\r\n  FLeftSubVerticalTextAlign := gtaTrailing;\r\n  FRightSubHorizontalTextAlign := gtaTrailing;\r\n  FRightSubVerticalTextAlign := gtaTrailing;\r\n  FRightFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FRightStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FRightSubStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcLightGray);\r\n  FLeftFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FLeftStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FLeftSubStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcLightGray);\r\n\r\n  FLeftFont := TTMSFNCGraphicsFont.Create;\r\n  FLeftFont.Color := gcGray;\r\n  FRightFont := TTMSFNCGraphicsFont.Create;\r\n  FRightFont.Color := gcGray;\r\n\r\n  TTMSFNCUtils.SetFontSize(FLeftFont, 18);\r\n  TTMSFNCUtils.SetFontSize(FRightFont, 18);\r\n  FLeftSubUnitFontSize := 14;\r\n  FRightSubUnitFontSize := 14;\r\n\r\n  {$IFDEF CMNWEBLIB}\r\n  FLeftSubUnitFontSize := Round(FLeftSubUnitFontSize / 96 * 72);\r\n  FRightSubUnitFontSize := Round(FRightSubUnitFontSize / 96 * 72);\r\n  {$ENDIF}\r\n\r\n  FRightFont.OnChanged := @Changed;\r\n  FLeftFont.OnChanged := @Changed;\r\n  FRightFill.OnChanged := @Changed;\r\n  FLeftFill.OnChanged := @Changed;\r\n  FRightStroke.OnChanged := @Changed;\r\n  FRightSubStroke.OnChanged := @Changed;\r\n  FLeftStroke.OnChanged := @Changed;\r\n  FLeftSubStroke.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerTimeLineAppearance.Destroy;\r\nbegin\r\n  FLeftFont.Free;\r\n  FRightFont.Free;\r\n  FRightStroke.Free;\r\n  FRightSubStroke.Free;\r\n  FRightFill.Free;\r\n  FLeftStroke.Free;\r\n  FLeftSubStroke.Free;\r\n  FLeftFill.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.UpdatePlannerCache;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSize(const Value: Double);\r\nbegin\r\n  if FLeftSize <> Value then\r\n  begin\r\n    FLeftSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetCurrentTimeColor(\r\n  const Value: TTMSFNCGraphicsColor);\r\nbegin\r\n  if FCurrentTimeColor <> Value then\r\n  begin\r\n    FCurrentTimeColor := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLayouts(\r\n  const Value: TTMSFNCPlannerTimeLineLayouts);\r\nbegin\r\n  if FLayouts <> Value then\r\n  begin\r\n    FLayouts := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSize(const Value: Double);\r\nbegin\r\n  if FRightSize <> Value then\r\n  begin\r\n    FRightSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FLeftFill <> Value then\r\n    FLeftFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FLeftFont <> Value then\r\n    FLeftFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FLeftHorizontalTextAlign <> Value then\r\n  begin\r\n    FLeftHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSubHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FLeftSubHorizontalTextAlign <> Value then\r\n  begin\r\n    FLeftSubHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSubStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FLeftSubStroke <> Value then\r\n    FLeftSubStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSubUnitFontSize(\r\n  const Value: Double);\r\nbegin\r\n  if FLeftSubUnitFontSize <> Value then\r\n  begin\r\n    FLeftSubUnitFontSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSubVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FLeftSubVerticalTextAlign <> Value then\r\n  begin\r\n    FLeftSubVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftSubVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FLeftSubVerticalTextMode <> Value then\r\n  begin\r\n    FLeftSubVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FLeftVerticalTextAlign <> Value then\r\n  begin\r\n    FLeftVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FLeftVerticalTextMode <> Value then\r\n  begin\r\n    FLeftVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetLeftStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FLeftStroke <> Value then\r\n    FLeftStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FRightFill <> Value then\r\n    FRightFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FRightHorizontalTextAlign <> Value then\r\n  begin\r\n    FRightHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSubStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FRightSubStroke <> Value then\r\n    FRightSubStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSubUnitFontSize(\r\n  const Value: Double);\r\nbegin\r\n  if FRightSubUnitFontSize <> Value then\r\n  begin\r\n    FRightSubUnitFontSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSubHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FRightSubHorizontalTextAlign <> Value then\r\n  begin\r\n    FRightSubHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSubVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FRightSubVerticalTextAlign <> Value then\r\n  begin\r\n    FRightSubVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightSubVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FRightSubVerticalTextMode <> Value then\r\n  begin\r\n    FRightSubVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FRightVerticalTextAlign <> Value then\r\n  begin\r\n    FRightVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FRightVerticalTextMode <> Value then\r\n  begin\r\n    FRightVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FRightFont <> Value then\r\n    FRightFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetRightStroke(const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FRightStroke <> Value then\r\n    FRightStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerTimeLineAppearance.SetStretch(const Value: Boolean);\r\nbegin\r\n  if FStretch <> Value then\r\n  begin\r\n    FStretch := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerPositionsAppearance }\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerPositionsAppearance then\r\n  begin\r\n    FLayouts := (Source as TTMSFNCPlannerPositionsAppearance).Layouts;\r\n    FTopSize := (Source as TTMSFNCPlannerPositionsAppearance).TopSize;\r\n    FSize := (Source as TTMSFNCPlannerPositionsAppearance).Size;\r\n    FBottomSize := (Source as TTMSFNCPlannerPositionsAppearance).BottomSize;\r\n    FBottomFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomFill);\r\n    FBottomFont.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomFont);\r\n    FBottomStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomStroke);\r\n    FTopFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopFill);\r\n    FTopStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopStroke);\r\n    FTopNavigationButtonFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonFill);\r\n    FTopNavigationButtonStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonStroke);\r\n    FBottomNavigationButtonFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonFill);\r\n    FBottomNavigationButtonStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonStroke);\r\n    FTopNavigationButtonHoverFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonHoverFill);\r\n    FTopNavigationButtonHoverStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonHoverStroke);\r\n    FBottomNavigationButtonHoverFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonHoverFill);\r\n    FBottomNavigationButtonHoverStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonHoverStroke);\r\n    FTopNavigationButtonDownFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonDownFill);\r\n    FTopNavigationButtonDownStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopNavigationButtonDownStroke);\r\n    FBottomNavigationButtonDownFill.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonDownFill);\r\n    FBottomNavigationButtonDownStroke.Assign((Source as TTMSFNCPlannerPositionsAppearance).BottomNavigationButtonDownStroke);\r\n    FTopFont.Assign((Source as TTMSFNCPlannerPositionsAppearance).TopFont);\r\n    FStretch := (Source as TTMSFNCPlannerPositionsAppearance).Stretch;\r\n    FTopHorizontalTextAlign := (Source as TTMSFNCPlannerPositionsAppearance).TopHorizontalTextAlign;\r\n    FTopVerticalTextAlign := (Source as TTMSFNCPlannerPositionsAppearance).TopVerticalTextAlign;\r\n    FBottomHorizontalTextAlign := (Source as TTMSFNCPlannerPositionsAppearance).BottomHorizontalTextAlign;\r\n    FBottomVerticalTextAlign := (Source as TTMSFNCPlannerPositionsAppearance).BottomVerticalTextAlign;\r\n    FTopVerticalTextMode := (Source as TTMSFNCPlannerPositionsAppearance).TopVerticalTextMode;\r\n    FBottomVerticalTextMode := (Source as TTMSFNCPlannerPositionsAppearance).BottomVerticalTextMode;\r\n    FFillEmptySpaces := (Source as TTMSFNCPlannerPositionsAppearance).FillEmptySpaces;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerPositionsAppearance.Create(\r\n  APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FLayouts := [pplTop];\r\n  FFillEmptySpaces := True;\r\n  FStretch := True;\r\n  FBottomSize := 50;\r\n  FTopVerticalTextMode := pvtmAuto;\r\n  FBottomVerticalTextMode := pvtmAuto;\r\n  FTopSize := 50;\r\n  FSize := 100;\r\n  FTopHorizontalTextAlign := gtaCenter;\r\n  FTopVerticalTextAlign := gtaCenter;\r\n  FBottomHorizontalTextAlign := gtaCenter;\r\n  FBottomVerticalTextAlign := gtaCenter;\r\n  FBottomFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FBottomStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FTopStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FBottomNavigationButtonFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FBottomNavigationButtonStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopNavigationButtonFill := TTMSFNCGraphicsFill.Create(gfkSolid, gcWhite);\r\n  FTopNavigationButtonStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FBottomNavigationButtonHoverFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(225, 245, 255));\r\n  FBottomNavigationButtonHoverStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopNavigationButtonHoverFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(225, 245, 255));\r\n  FTopNavigationButtonHoverStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FBottomNavigationButtonDownFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(149, 213, 246));\r\n  FBottomNavigationButtonDownStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopNavigationButtonDownFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(149, 213, 246));\r\n  FTopNavigationButtonDownStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopFont := TTMSFNCGraphicsFont.Create;\r\n  FTopFont.Color := gcGray;\r\n  FBottomFont := TTMSFNCGraphicsFont.Create;\r\n  FBottomFont.Color := gcGray;\r\n\r\n  FTopLeftNavigationButtonSize := 18;\r\n  FTopRightNavigationButtonSize := 18;\r\n  FBottomLeftNavigationButtonSize := 18;\r\n  FBottomRightNavigationButtonSize := 18;\r\n\r\n  FBottomFill.OnChanged := @Changed;\r\n  FTopFill.OnChanged := @Changed;\r\n  FBottomStroke.OnChanged := @Changed;\r\n  FTopStroke.OnChanged := @Changed;\r\n  FBottomNavigationButtonFill.OnChanged := @Changed;\r\n  FTopNavigationButtonFill.OnChanged := @Changed;\r\n  FBottomNavigationButtonStroke.OnChanged := @Changed;\r\n  FTopNavigationButtonStroke.OnChanged := @Changed;\r\n  FBottomNavigationButtonHoverFill.OnChanged := @Changed;\r\n  FTopNavigationButtonHoverFill.OnChanged := @Changed;\r\n  FBottomNavigationButtonHoverStroke.OnChanged := @Changed;\r\n  FTopNavigationButtonHoverStroke.OnChanged := @Changed;\r\n  FBottomNavigationButtonDownFill.OnChanged := @Changed;\r\n  FTopNavigationButtonDownFill.OnChanged := @Changed;\r\n  FBottomNavigationButtonDownStroke.OnChanged := @Changed;\r\n  FTopNavigationButtonDownStroke.OnChanged := @Changed;\r\n  FTopFont.OnChanged := @Changed;\r\n  FBottomFont.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerPositionsAppearance.Destroy;\r\nbegin\r\n  FTopNavigationButtonStroke.Free;\r\n  FTopNavigationButtonFill.Free;\r\n  FBottomNavigationButtonStroke.Free;\r\n  FBottomNavigationButtonFill.Free;\r\n  FBottomNavigationButtonHoverFill.Free;\r\n  FTopNavigationButtonHoverFill.Free;\r\n  FBottomNavigationButtonHoverStroke.Free;\r\n  FTopNavigationButtonHoverStroke.Free;\r\n  FBottomNavigationButtonDownFill.Free;\r\n  FTopNavigationButtonDownFill.Free;\r\n  FBottomNavigationButtonDownStroke.Free;\r\n  FTopNavigationButtonDownStroke.Free;\r\n  FTopFont.Free;\r\n  FBottomFont.Free;\r\n  FBottomFill.Free;\r\n  FTopFill.Free;\r\n  FBottomStroke.Free;\r\n  FTopStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.UpdatePlannerCache;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonDownFill(\r\n  const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBottomNavigationButtonDownFill <> Value then\r\n    FBottomNavigationButtonDownFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonDownStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBottomNavigationButtonDownStroke <> Value then\r\n    FBottomNavigationButtonDownStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBottomNavigationButtonFill <> Value then\r\n    FBottomNavigationButtonFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonHoverFill(\r\n  const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBottomNavigationButtonHoverFill <> Value then\r\n    FBottomNavigationButtonHoverFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonHoverStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBottomNavigationButtonStroke <> Value then\r\n    FBottomNavigationButtonHoverStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBottomFill <> Value then\r\n    FBottomFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FBottomFont <> Value then\r\n    FBottomFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FBottomHorizontalTextAlign <> Value then\r\n  begin\r\n    FBottomHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomLeftNavigationButtonSize(\r\n  const Value: Double);\r\nbegin\r\n  if FBottomLeftNavigationButtonSize <> Value then\r\n  begin\r\n    FBottomLeftNavigationButtonSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomSize(const Value: Double);\r\nbegin\r\n  if FBottomSize <> Value then\r\n  begin\r\n    FBottomSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomNavigationButtonStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBottomNavigationButtonStroke <> Value then\r\n    FBottomNavigationButtonStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomRightNavigationButtonSize(\r\n  const Value: Double);\r\nbegin\r\n  if FBottomRightNavigationButtonSize <> Value then\r\n  begin\r\n    FBottomRightNavigationButtonSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBottomStroke <> Value then\r\n    FBottomStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FBottomVerticalTextAlign <> Value then\r\n  begin\r\n    FBottomVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetBottomVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FBottomVerticalTextMode <> Value then\r\n  begin\r\n    FBottomVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetFillEmptySpaces(\r\n  const Value: Boolean);\r\nbegin\r\n  if FFillEmptySpaces <> Value then\r\n  begin\r\n    FFillEmptySpaces := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTopHorizontalTextAlign <> Value then\r\n  begin\r\n    FTopHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopLeftNavigationButtonSize(\r\n  const Value: Double);\r\nbegin\r\n  if FTopLeftNavigationButtonSize <> Value then\r\n  begin\r\n    FTopLeftNavigationButtonSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetLayouts(\r\n  const Value: TTMSFNCPlannerPositionsLayouts);\r\nbegin\r\n  if FLayouts <> Value then\r\n  begin\r\n    FLayouts := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetSize(const Value: Double);\r\nbegin\r\n  if FSize <> Value then\r\n  begin\r\n    FSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetStretch(const Value: Boolean);\r\nbegin\r\n  if FStretch <> Value then\r\n  begin\r\n    FStretch := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTopFill <> Value then\r\n    FTopFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonDownFill(\r\n  const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTopNavigationButtonDownFill <> Value then\r\n    FTopNavigationButtonDownFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonDownStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTopNavigationButtonDownStroke <> Value then\r\n    FTopNavigationButtonDownStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTopNavigationButtonFill <> Value then\r\n    FTopNavigationButtonFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonHoverFill(\r\n  const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTopNavigationButtonHoverFill <> Value then\r\n    FTopNavigationButtonHoverFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonHoverStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTopNavigationButtonHoverStroke <> Value then\r\n    FTopNavigationButtonHoverStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FTopFont <> Value then\r\n    FTopFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopSize(const Value: Double);\r\nbegin\r\n  if FTopSize <> Value then\r\n  begin\r\n    FTopSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTopStroke <> Value then\r\n    FTopStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopNavigationButtonStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTopNavigationButtonStroke <> Value then\r\n    FTopNavigationButtonStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopRightNavigationButtonSize(\r\n  const Value: Double);\r\nbegin\r\n  if FTopRightNavigationButtonSize <> Value then\r\n  begin\r\n    FTopRightNavigationButtonSize := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTopVerticalTextAlign <> Value then\r\n  begin\r\n    FTopVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositionsAppearance.SetTopVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FTopVerticalTextMode <> Value then\r\n  begin\r\n    FTopVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerGroupsAppearance }\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerGroupsAppearance then\r\n  begin\r\n    FLayouts := (Source as TTMSFNCPlannerGroupsAppearance).Layouts;\r\n    FTopSize := (Source as TTMSFNCPlannerGroupsAppearance).TopSize;\r\n    FBottomSize := (Source as TTMSFNCPlannerGroupsAppearance).BottomSize;\r\n    FBottomFill.Assign((Source as TTMSFNCPlannerGroupsAppearance).BottomFill);\r\n    FBottomFont.Assign((Source as TTMSFNCPlannerGroupsAppearance).BottomFont);\r\n    FBottomStroke.Assign((Source as TTMSFNCPlannerGroupsAppearance).BottomStroke);\r\n    FTopFill.Assign((Source as TTMSFNCPlannerGroupsAppearance).TopFill);\r\n    FTopStroke.Assign((Source as TTMSFNCPlannerGroupsAppearance).TopStroke);\r\n    FTopFont.Assign((Source as TTMSFNCPlannerGroupsAppearance).TopFont);\r\n    FTopHorizontalTextAlign := (Source as TTMSFNCPlannerGroupsAppearance).TopHorizontalTextAlign;\r\n    FTopVerticalTextAlign := (Source as TTMSFNCPlannerGroupsAppearance).TopVerticalTextAlign;\r\n    FBottomHorizontalTextAlign := (Source as TTMSFNCPlannerGroupsAppearance).BottomHorizontalTextAlign;\r\n    FBottomVerticalTextAlign := (Source as TTMSFNCPlannerGroupsAppearance).BottomVerticalTextAlign;\r\n    FTopVerticalTextMode := (Source as TTMSFNCPlannerGroupsAppearance).TopVerticalTextMode;\r\n    FBottomVerticalTextMode := (Source as TTMSFNCPlannerGroupsAppearance).BottomVerticalTextMode;\r\n    FFillEmptySpaces := (Source as TTMSFNCPlannerGroupsAppearance).FillEmptySpaces;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerGroupsAppearance.Create(\r\n  APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FLayouts := [pglTop];\r\n  FFillEmptySpaces := True;\r\n  FTopSize := 50;\r\n  FBottomSize := 50;\r\n  FTopVerticalTextMode := pvtmAuto;\r\n  FBottomVerticalTextMode := pvtmAuto;\r\n  FTopHorizontalTextAlign := gtaCenter;\r\n  FTopVerticalTextAlign := gtaCenter;\r\n  FBottomHorizontalTextAlign := gtaCenter;\r\n  FBottomVerticalTextAlign := gtaCenter;\r\n  FBottomFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FBottomStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FTopFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FTopStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n\r\n  FTopFont := TTMSFNCGraphicsFont.Create;\r\n  FTopFont.Color := gcGray;\r\n  FBottomFont := TTMSFNCGraphicsFont.Create;\r\n  FBottomFont.Color := gcGray;\r\n\r\n  FTopFont.OnChanged := @Changed;\r\n  FBottomFont.OnChanged := @Changed;\r\n  FBottomFill.OnChanged := @Changed;\r\n  FTopFill.OnChanged := @Changed;\r\n  FBottomStroke.OnChanged := @Changed;\r\n  FTopStroke.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerGroupsAppearance.Destroy;\r\nbegin\r\n  FBottomFont.Free;\r\n  FTopFont.Free;\r\n  FBottomFill.Free;\r\n  FBottomStroke.Free;\r\n  FTopFill.Free;\r\n  FTopStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.UpdatePlannerCache;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FBottomFill <> Value then\r\n    FBottomFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FBottomHorizontalTextAlign <> Value then\r\n  begin\r\n    FBottomHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FBottomFont <> Value then\r\n    FBottomFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomSize(const Value: Double);\r\nbegin\r\n  if FBottomSize <> Value then\r\n  begin\r\n    FBottomSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FBottomStroke <> Value then\r\n    FBottomStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FBottomVerticalTextAlign <> Value then\r\n  begin\r\n    FBottomVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetBottomVerticalTextMode(\r\n  const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FBottomVerticalTextMode <> Value then\r\n  begin\r\n    FBottomVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetFillEmptySpaces(\r\n  const Value: Boolean);\r\nbegin\r\n  if FFillEmptySpaces <> Value then\r\n  begin\r\n    FFillEmptySpaces := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetLayouts(\r\n  const Value: TTMSFNCPlannerGroupsLayouts);\r\nbegin\r\n  if FLayouts <> Value then\r\n  begin\r\n    FLayouts := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FTopFill <> Value then\r\n    FTopFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopFont(const Value: TTMSFNCGraphicsFont);\r\nbegin\r\n  if FTopFont <> Value then\r\n    FTopFont.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopHorizontalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTopHorizontalTextAlign <> Value then\r\n  begin\r\n    FTopHorizontalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopSize(const Value: Double);\r\nbegin\r\n  if FTopSize <> Value then\r\n  begin\r\n    FTopSize := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FTopStroke <> Value then\r\n    FTopStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopVerticalTextAlign(\r\n  const Value: TTMSFNCGraphicsTextAlign);\r\nbegin\r\n  if FTopVerticalTextAlign <> Value then\r\n  begin\r\n    FTopVerticalTextAlign := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGroupsAppearance.SetTopVerticalTextMode(const Value: TTMSFNCPlannerVerticalTextMode);\r\nbegin\r\n  if FTopVerticalTextMode <> Value then\r\n  begin\r\n    FTopVerticalTextMode := Value;\r\n    Changed(Self);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerGridCellAppearance }\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerGridCellAppearance then\r\n  begin\r\n    FFill.Assign((Source as TTMSFNCPlannerGridCellAppearance).Fill);\r\n    FInActiveFill.Assign((Source as TTMSFNCPlannerGridCellAppearance).InActiveFill);\r\n    FDisabledFill.Assign((Source as TTMSFNCPlannerGridCellAppearance).DisabledFill);\r\n    FVerticalStroke.Assign((Source as TTMSFNCPlannerGridCellAppearance).VerticalStroke);\r\n    FHorizontalStroke.Assign((Source as TTMSFNCPlannerGridCellAppearance).HorizontalStroke);\r\n    FHorizontalSubStroke.Assign((Source as TTMSFNCPlannerGridCellAppearance).HorizontalSubStroke);\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerGridCellAppearance.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FVerticalStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FHorizontalStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcDarkGray);\r\n  FHorizontalSubStroke := TTMSFNCGraphicsStroke.Create(gskSolid, gcLightGray);\r\n  FInactiveFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(225, 245, 255));\r\n  FFill := TTMSFNCGraphicsFill.Create(gfkNone, gcWhite);\r\n  FDisabledFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(230, 230, 230));\r\n\r\n  FFill.OnChanged := @Changed;\r\n  FInActiveFill.OnChanged := @Changed;\r\n  FDisabledFill.OnChanged := @Changed;\r\n  FVerticalStroke.OnChanged := @Changed;\r\n  FHorizontalStroke.OnChanged := @Changed;\r\n  FHorizontalSubStroke.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerGridCellAppearance.Destroy;\r\nbegin\r\n  FFill.Free;\r\n  FInActiveFill.Free;\r\n  FDisabledFill.Free;\r\n  FVerticalStroke.Free;\r\n  FHorizontalStroke.Free;\r\n  FHorizontalSubStroke.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetDisabledFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FDisabledFill <> Value then\r\n    FDisabledFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FFill <> Value then\r\n    FFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetHorizontalStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FHorizontalStroke <> Value then\r\n    FHorizontalStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetInActiveFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FInActiveFill <> Value then\r\n    FInActiveFill.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetHorizontalSubStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FHorizontalSubStroke <> Value then\r\n    FHorizontalSubStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.SetVerticalStroke(\r\n  const Value: TTMSFNCGraphicsStroke);\r\nbegin\r\n  if FVerticalStroke <> Value then\r\n    FVerticalStroke.Assign(Value);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerGridCellAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.UpdatePlannerCache;\r\nend;\r\n\r\n{ TTMSFNCPlannerSelectionAppearance }\r\n\r\nprocedure TTMSFNCPlannerSelectionAppearance.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerSelectionAppearance then\r\n  begin\r\n    FFill.Assign((Source as TTMSFNCPlannerSelectionAppearance).Fill);\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSelectionAppearance.Changed(Sender: TObject);\r\nbegin\r\n  FPlanner.Invalidate;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerSelectionAppearance.Create(\r\n  APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FFill := TTMSFNCGraphicsFill.Create(gfkSolid, MakeGraphicsColor(149, 213, 246));\r\n  FFill.OnChanged := @Changed;\r\nend;\r\n\r\ndestructor TTMSFNCPlannerSelectionAppearance.Destroy;\r\nbegin\r\n  FFill.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSelectionAppearance.SetFill(const Value: TTMSFNCGraphicsFill);\r\nbegin\r\n  if FFill <> Value then\r\n    FFill.Assign(Value);\r\nend;\r\n\r\n{ TTMSFNCPlannerModeSettings }\r\n\r\nprocedure TTMSFNCPlannerModeSettings.Assign(Source: TPersistent);\r\nbegin\r\n  if Source is TTMSFNCPlannerModeSettings then\r\n  begin\r\n    FStartTime := (Source as TTMSFNCPlannerModeSettings).StartTime;\r\n    FEndTime := (Source as TTMSFNCPlannerModeSettings).EndTime;\r\n    FInActiveDays := (Source as TTMSFNCPlannerModeSettings).InActiveDays;\r\n    FOverlappableItems := (Source as TTMSFNCPlannerModeSettings).OverlappableItems;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerModeSettings.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FStartTime := Now;\r\n  FEndTime := Now + 20;\r\n  FInActiveDays := [padSaturday, padSunday];\r\n  FOverlappableItems := True;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerModeSettings.SetInActiveDays(\r\n  const Value: TTMSFNCPlannerInActiveDays);\r\nbegin\r\n  if FInActiveDays <> Value then\r\n  begin\r\n    FInActiveDays := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerModeSettings.SetOverlappableItems(const Value: Boolean);\r\nbegin\r\n  if FOverlappableItems <> Value then\r\n    FOverlappableItems := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerModeSettings.SetEndTime(const Value: TDateTime);\r\nbegin\r\n  if FEndTime <> Value then\r\n  begin\r\n    FEndTime := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerModeSettings.SetStartTime(const Value: TDateTime);\r\nbegin\r\n  if FStartTime <> Value then\r\n  begin\r\n    FStartTime := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n    FPlanner.TimeLine.ViewStart := Int(FStartTime);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerInteraction }\r\n\r\nprocedure TTMSFNCPlannerInteraction.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TTMSFNCPlannerInteraction) then\r\n  begin\r\n    FTopNavigationButtons := (Source as TTMSFNCPlannerInteraction).TopNavigationButtons;\r\n    FBottomNavigationButtons := (Source as TTMSFNCPlannerInteraction).BottomNavigationButtons;\r\n    FSizeMode := (Source as TTMSFNCPlannerInteraction).SizeMode;\r\n    FDeleteMode := (Source as TTMSFNCPlannerInteraction).DeleteMode;\r\n    FMoveMode := (Source as TTMSFNCPlannerInteraction).MoveMode;\r\n    FMouseInsertMode := (Source as TTMSFNCPlannerInteraction).MouseInsertMode;\r\n    FMouseEditMode := (Source as TTMSFNCPlannerInteraction).MouseEditMode;\r\n    FUpdateMode := (Source as TTMSFNCPlannerInteraction).UpdateMode;\r\n    FKeyboardInsertMode := (Source as TTMSFNCPlannerInteraction).KeyboardInsertMode;\r\n    FKeyboardDelete := (Source as TTMSFNCPlannerInteraction).KeyboardDelete;\r\n    FKeyboardEdit := (Source as TTMSFNCPlannerInteraction).KeyboardEdit;\r\n    FMultiSelect := (Source as TTMSFNCPlannerInteraction).MultiSelect;\r\n    FTouchScrolling := (Source as TTMSFNCPlannerInteraction).TouchScrolling;\r\n    FInplaceEditorMode := (Source as TTMSFNCPlannerInteraction).InplaceEditorMode;\r\n    FSwipeToNextDateTime := (Source as TTMSFNCPlannerInteraction).SwipeToNextDateTime;\r\n    FSwipeToPreviousDateTime := (Source as TTMSFNCPlannerInteraction).SwipeToPreviousDateTime;\r\n    FKeepSelection := (Source as TTMSFNCPlannerInteraction).KeepSelection;\r\n    FShowSelection := (Source as TTMSFNCPlannerInteraction).ShowSelection;\r\n    FReadOnly := (Source as TTMSFNCPlannerInteraction).ReadOnly;\r\n    FAutoSelectLinkedItems := (Source as TTMSFNCPlannerInteraction).AutoSelectLinkedItems;\r\n    FAutoDeleteLinkedItems := (Source as TTMSFNCPlannerInteraction).AutoDeleteLinkedItems;\r\n    FAutoOpenURL := (Source as TTMSFNCPlannerInteraction).AutoOpenURL;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerInteraction.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FAutoOpenURL := True;\r\n  FSizeMode := psmAuto;\r\n  FDeleteMode := pdmAuto;\r\n  FReadOnly := False;\r\n  FMoveMode := pmmAuto;\r\n  FMouseInsertMode := pmimNone;\r\n  FUpdateMode := pumInplace;\r\n  FTopNavigationButtons := [];\r\n  FBottomNavigationButtons := [];\r\n  FMouseEditMode := pmemSingleClickOnSelectedItem;\r\n  FKeyboardDelete := False;\r\n  FKeyboardInsertMode := pkimNone;\r\n  FSwipeToNextDateTime := True;\r\n  FShowSelection := True;\r\n  FSwipeToPreviousDateTime := True;\r\n  FKeyboardEdit := True;\r\n  FKeepSelection := True;\r\n  FTouchScrolling := True;\r\n  FMultiSelect := False;\r\n  FInplaceEditorMode := piemText;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetBottomNavigationButtons(\r\n  const Value: TTMSFNCPlannerNavigationButtons);\r\nbegin\r\n  if FBottomNavigationButtons <> Value then\r\n  begin\r\n    FBottomNavigationButtons := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetDeleteMode(\r\n  const Value: TTMSFNCPlannerDeleteMode);\r\nbegin\r\n  if FDeleteMode <> Value then\r\n    FDeleteMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetTopNavigationButtons(\r\n  const Value: TTMSFNCPlannerNavigationButtons);\r\nbegin\r\n  if FTopNavigationButtons <> Value then\r\n  begin\r\n    FTopNavigationButtons := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetUpdateMode(\r\n  const Value: TTMSFNCPlannerUpdateMode);\r\nbegin\r\n  if FUpdateMode <> Value then\r\n    FUpdateMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetInplaceEditorMode(\r\n  const Value: TTMSFNCPlannerInplaceEditorMode);\r\nbegin\r\n  if FInplaceEditorMode <> Value then\r\n    FInplaceEditorMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetKeepSelection(const Value: Boolean);\r\nbegin\r\n  if FKeepSelection <> Value then\r\n    FKeepSelection := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetKeyboardDelete(const Value: Boolean);\r\nbegin\r\n  if FKeyboardDelete <> Value then\r\n    FKeyboardDelete := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetKeyboardInsertMode(const Value: TTMSFNCPlannerKeyboardInsertMode);\r\nbegin\r\n  if FKeyboardInsertMode <> Value then\r\n    FKeyboardInsertMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetKeyboardEdit(const Value: Boolean);\r\nbegin\r\n  if FKeyboardEdit <> Value then\r\n    FKeyboardEdit := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetMouseEditMode(\r\n  const Value: TTMSFNCPlannerMouseEditMode);\r\nbegin\r\n  if FMouseEditMode <> Value then\r\n    FMouseEditMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetMouseInsertMode(\r\n  const Value: TTMSFNCPlannerMouseInsertMode);\r\nbegin\r\n  if FMouseInsertMode <> Value then\r\n    FMouseInsertMode := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetMultiSelect(const Value: Boolean);\r\nbegin\r\n  if FMultiSelect <> Value then\r\n    FMultiSelect := Value;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetReadOnly(const Value: Boolean);\r\nbegin\r\n  if FReadOnly <> Value then\r\n  begin\r\n    FReadOnly := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetShowSelection(\r\n  const Value: Boolean);\r\nbegin\r\n  if FShowSelection <> Value then\r\n  begin\r\n    FShowSelection := Value;\r\n    FPlanner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetSizeMode(\r\n  const Value: TTMSFNCPlannerSizeMode);\r\nbegin\r\n  if FSizeMode <> Value then\r\n  begin\r\n    FSizeMode := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetMoveMode(\r\n  const Value: TTMSFNCPlannerMoveMode);\r\nbegin\r\n  if FMoveMode <> Value then\r\n  begin\r\n    FMoveMode := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetSwipeToNextDateTime(const Value: Boolean);\r\nbegin\r\n  if FSwipeToNextDateTime <> Value then\r\n  begin\r\n    FSwipeToNextDateTime := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetSwipeToPreviousDateTime(const Value: Boolean);\r\nbegin\r\n  if FSwipeToPreviousDateTime <> Value then\r\n  begin\r\n    FSwipeToPreviousDateTime := Value;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerInteraction.SetTouchScrolling(const Value: Boolean);\r\nbegin\r\n  if FTouchScrolling <> Value then\r\n    FTouchScrolling := Value;\r\nend;\r\n\r\n{ TTMSFNCPlannerPositions }\r\n\r\nprocedure TTMSFNCPlannerPositions.Assign(Source: TPersistent);\r\nbegin\r\n  if (Source is TTMSFNCPlannerPositions) then\r\n  begin\r\n    FCount := (Source as TTMSFNCPlannerPositions).Count;\r\n    FFormat := (Source as TTMSFNCPlannerPositions).Format;\r\n    FViewStart := (Source as TTMSFNCPlannerPositions).ViewStart;\r\n  end;\r\nend;\r\n\r\nconstructor TTMSFNCPlannerPositions.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FCount := 3;\r\n  FViewStart := 0;\r\nend;\r\n\r\nfunction TTMSFNCPlannerPositions.GetViewStart: Integer;\r\nbegin\r\n  Result := FViewStart;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositions.SetCount(const Value: Integer);\r\nbegin\r\n  if FCount <> Value then\r\n  begin\r\n    FCount := Value;\r\n    FPlanner.FNeedsConflictsUpdate := True;\r\n    FPlanner.FNeedsInitialization := True;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositions.SetFormat(const Value: String);\r\nbegin\r\n  if FFormat <> Value then\r\n  begin\r\n    FFormat := Value;\r\n    FPlanner.UpdatePlannerCache;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerPositions.SetViewStart(const Value: Integer);\r\nbegin\r\n  if FViewStart <> Value then\r\n  begin\r\n    FViewStart := Value;\r\n    FPlanner.UpdateScrollPosition;\r\n    FPlanner.UpdateDisplay;\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerConflict }\r\n\r\nconstructor TTMSFNCPlannerConflict.Create(APlanner: TTMSFNCCustomPlanner);\r\nbegin\r\n  FPlanner := APlanner;\r\n  FNeedsConflictsUpdate := True;\r\n  {$IFNDEF LCLWEBLIB}\r\n  FCompareResourceDates := TDelegatedComparer<TTMSFNCPlannerResourceDate>.Create(\r\n    function(const Item1, Item2: TTMSFNCPlannerResourceDate): Integer\r\n    begin\r\n      Result := CompareDateTime(Item1.DateTime, Item2.DateTime);\r\n    end\r\n    );\r\n  {$ENDIF}\r\n  FItems := TTMSFNCPlannerResourceItems.Create;\r\n  FDates := TTMSFNCPlannerResourceDates.Create{$IFNDEF LCLWEBLIB}(FCompareResourceDates){$ENDIF};\r\nend;\r\n\r\ndestructor TTMSFNCPlannerConflict.Destroy;\r\nbegin\r\n  FDates.Free;\r\n  FItems.Free;\r\n  inherited;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerConflict.UpdateDates;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItem;\r\n  rcs, rce: TTMSFNCPlannerResourceDate;\r\nbegin\r\n  if not Assigned(FPlanner) then\r\n    Exit;\r\n\r\n  Dates.Clear;\r\n  for I := 0 to Items.Count - 1 do\r\n  begin\r\n    it := Items[I];\r\n    if Assigned(it) then\r\n    begin\r\n      rcs.X := 0;\r\n      rcs.Y := 0;\r\n      rcs.Z := nil;\r\n      rcs.DateTime := FPlanner.MaxPositionDateTime(it.StartTime, False, Position);\r\n      if not Dates.IndexOf(rcs) > -1 then\r\n        Dates.Add(rcs);\r\n\r\n      rce.X := 0;\r\n      rce.Y := 0;\r\n      rcs.Z := nil;\r\n      rce.DateTime := FPlanner.MaxPositionDateTime(it.EndTime, True, Position);\r\n      if not Dates.IndexOf(rce) > -1 then\r\n        Dates.Add(rce);\r\n    end;\r\n  end;\r\n\r\n  {$IFNDEF LCLWEBLIB}\r\n  Dates.Sort(FCompareResourceDates);\r\n  {$ENDIF}\r\n  {$IFDEF LCLWEBLIB}\r\n  {$IFDEF LCLLIB}\r\n  Dates.Sort(@CompareRes);\r\n  {$ENDIF}\r\n  {$IFNDEF LCLLIB}\r\n  Dates.Sort(TListSortCompare(@CompareRes));\r\n  {$ENDIF}\r\n  {$ENDIF}\r\nend;\r\n\r\nprocedure TTMSFNCPlannerConflict.UpdateItems;\r\nvar\r\n  I: Integer;\r\n  it: TTMSFNCPlannerItemOpen;\r\nbegin\r\n  if not Assigned(FPlanner) then\r\n    Exit;\r\n\r\n  Items.Clear;\r\n  for I := 0 to FPlanner.Items.Count - 1 do\r\n  begin\r\n    it := TTMSFNCPlannerItemOpen(FPlanner.Items[I]);\r\n    if (it.PositionsList.IndexOf(Position) > -1) and FPlanner.IsValidItem(it) then\r\n      Items.Add(it);\r\n  end;\r\nend;\r\n\r\n{ TTMSFNCPlannerSizeHandlerPanel }\r\n\r\nconstructor TTMSFNCPlannerSizeHandlerPanel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  DisableBackground;\r\n  {$IFDEF FMXLIB}\r\n  ClipChildren := True;\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nfunction TTMSFNCPlannerSizeHandlerPanel.GetClipRect: TRectF;\r\nvar\r\n  cr, br: TRectF;\r\nbegin\r\n  Result := inherited;\r\n  br := RectF(Position.X, Position.Y, Position.X + Width, Position.Y + Height);\r\n  cr := Planner.GetContentClipRect;\r\n  Result.Top := Max(cr.Top - br.Top, 0);\r\n  Result.Bottom := Min(Result.Bottom - (br.Bottom - cr.Bottom), Result.Bottom);\r\n  Result.Left := Max(cr.Left - br.Left, 0);\r\n  Result.Right := Min(Result.Right - (br.Right - cr.Right), Result.Right);\r\nend;\r\n{$ENDIF}\r\n\r\nprocedure TTMSFNCCustomPlanner.LinkItems(AItems: TTMSFNCPlannerLinkedItemArray; ACircular: Boolean = False; ALinkType: TTMSFNCPlannerItemLinkType = iltNone);\r\nvar\r\n  i: integer;\r\nbegin\r\n  BeginUpdate;\r\n  for I := 0 to Length(AItems) - 2 do\r\n  begin\r\n    AItems[I].LinkedItem := Items[I + 1];\r\n    AItems[I].LinkType := ALinkType;\r\n  end;\r\n\r\n  if ACircular then\r\n  begin\r\n    AItems[Length(AItems) - 1].LinkedItem := AItems[0];\r\n    AItems[Length(AItems) - 1].LinkType := ALinkType;\r\n  end;\r\n  EndUpdate;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSizeHandlerPanel.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  inherited;\r\n  if not Assigned(Planner) then\r\n    Exit;\r\n\r\n  case Planner.OrientationMode of\r\n    pomHorizontal:\r\n    begin\r\n      case Kind of\r\n        pshpkStartTime: bmp := Planner.ItemsAppearance.SizeHandlerLeftBitmap;\r\n        pshpkEndTime: bmp := Planner.ItemsAppearance.SizeHandlerRightBitmap;\r\n        else\r\n          bmp := nil;\r\n      end;\r\n    end;\r\n    pomVertical:\r\n    begin\r\n      case Kind of\r\n        pshpkStartTime: bmp := Planner.ItemsAppearance.SizeHandlerUpBitmap;\r\n        pshpkEndTime: bmp := Planner.ItemsAppearance.SizeHandlerDownBitmap;\r\n        else\r\n          bmp := nil;\r\n      end;\r\n    end;\r\n    else\r\n      bmp := nil;\r\n  end;\r\n\r\n  if Assigned(bmp) then\r\n    AGraphics.DrawBitmap(RectF(0, 0, Width, Height), BitmapToDrawBitmap(bmp));\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSizeHandlerPanel.HandleMouseDown(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  FMouseDown := True;\r\n  FDownPoint := PointF(X, Y);\r\n  if Assigned(Planner) then\r\n  begin\r\n    Planner.FDrawItemHelpers := True;\r\n    Planner.Invalidate;\r\n  end;\r\n  CaptureEx;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSizeHandlerPanel.HandleMouseMove(Shift: TShiftState; X,\r\n  Y: Single);\r\nvar\r\n  {$IFDEF FMXLIB}\r\n  pt: TPointF;\r\n  {$ENDIF}\r\n  {$IFDEF CMNWEBLIB}\r\n  pt: TPoint;\r\n  {$ENDIF}\r\n  cl, cls, clsn, cle, clen: TTMSFNCPlannerCell;\r\n  m: TTMSFNCPlannerMouseInteractionMode;\r\n  offx, offy: Single;\r\nbegin\r\n  inherited;\r\n  if FMouseDown and Assigned(Planner) and Assigned(Planner.ActiveItem) then\r\n  begin\r\n    offx := 0;\r\n    offy := 0;\r\n    case Planner.OrientationMode of\r\n      pomHorizontal:\r\n      begin\r\n        case Kind of\r\n          pshpkStartTime: offx := Width - FDownPoint.X;\r\n          pshpkEndTime: offx := -FDownPoint.X;\r\n        end;\r\n      end;\r\n      pomVertical:\r\n      begin\r\n        case Kind of\r\n          pshpkStartTime: offy := Height - FDownPoint.Y;\r\n          pshpkEndTime: offy := -FDownPoint.Y;\r\n        end;\r\n      end;\r\n    end;\r\n\r\n    {$IFDEF FMXLIB}\r\n    pt := Planner.ScreenToLocal(LocalToScreen(PointF(X + offx, Y + offy)));\r\n    {$ENDIF}\r\n    {$IFDEF CMNWEBLIB}\r\n    pt := Planner.ScreenToClient(ClientToScreen(Point(Round(X + offx), Round(Y + offy))));\r\n    {$ENDIF}\r\n    cl := Planner.XYToCell(pt.X, pt.Y);\r\n\r\n    if (cl.Col <> -1) and (cl.Row <> -1) then\r\n    begin\r\n      cls := Planner.ItemToStartCell(Planner.ActiveItem);\r\n      cle := Planner.ItemToEndCell(Planner.ActiveItem);\r\n\r\n      clsn.Col := cls.Col;\r\n      clen.Col := cle.Col;\r\n      clsn.Row := cls.Row;\r\n      clen.Row := cle.Row;\r\n\r\n      case Kind of\r\n        pshpkStartTime:\r\n        begin\r\n          if ((cls.Row >= cle.Row) and (cle.Col - cl.Col > 0)) or ((cls.Row < cle.Row) and (cle.Col - cl.Col >= 0)) then\r\n            clsn.Col := cl.Col;\r\n\r\n          if clsn.Col = cle.Col then\r\n            clsn.Row := Min(cle.Row - 1, cl.Row)\r\n          else\r\n            clsn.Row := cl.Row;\r\n        end;\r\n        pshpkEndTime:\r\n        begin\r\n          if ((cle.Row <= cls.Row) and (cl.Col - cls.Col > 0)) or ((cle.Row > cls.Row) and (cl.Col - cls.Col >= 0)) then\r\n            clen.Col := cl.Col;\r\n\r\n          if clen.Col = cls.Col then\r\n            clen.Row := Max(cls.Row + 1, cl.Row + 1)\r\n          else\r\n            clen.Row := cl.Row + 1;\r\n        end;\r\n      end;\r\n\r\n      m := pmmSizeUp;\r\n      Planner.HandleItemMouseInteraction(Planner.ActiveItem, cls, cle, clsn, clen, m);\r\n    end;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSizeHandlerPanel.HandleMouseUp(Button: TTMSFNCMouseButton;\r\n  Shift: TShiftState; X, Y: Single);\r\nbegin\r\n  inherited;\r\n  ReleaseCaptureEx;\r\n\r\n  FMouseDown := False;\r\n  if Assigned(Planner) then\r\n  begin\r\n    Planner.HandleAfterEvents;\r\n    Planner.FDrawItemHelpers := False;\r\n    Planner.Invalidate;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSizeHandlerPanel.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCPlannerSizeHandlerPanel);\r\nend;\r\n\r\n{ TTMSFNCPlannerAdapter }\r\n\r\nconstructor TTMSFNCPlannerAdapter.Create(AOwner: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  FActive := False;\r\n  if Assigned(AOwner) and (AOwner is TCustomForm) then\r\n  begin\r\n    for I := 0 to AOwner.ComponentCount - 1 do\r\n    begin\r\n      if (AOwner.Components[i] is TTMSFNCCustomPlanner) then\r\n      begin\r\n        Planner := AOwner.Components[i] as TTMSFNCCustomPlanner;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerAdapter.GetInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerAdapter.LoadItems;\r\nbegin\r\n  if not Assigned(FPlanner) then\r\n    Exit;\r\n\r\n  FPlanner.Items.Clear;\r\n\r\n  if Active then\r\n    GetItems(FPlanner.DisplayStartDateTime, FPlanner.DisplayEndDateTime);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerAdapter.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FPlanner) then\r\n    FPlanner := nil;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerAdapter.SetActive(const Value: boolean);\r\nbegin\r\n  if (Value <> FActive) then\r\n  begin\r\n    FActive := Value;\r\n    LoadItems;\r\n  end;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerAdapter.UpdateItems;\r\nbegin\r\n  Active := false;\r\n  Active := true;\r\nend;\r\n\r\n{ TTMSFNCPlannerCustomItemEditor }\r\n\r\nprocedure TTMSFNCPlannerCustomItemEditor.Assign(Source: TPersistent);\r\nbegin\r\nend;\r\n\r\nconstructor TTMSFNCPlannerCustomItemEditor.Create(AOwner: TComponent);\r\nvar\r\n  I: Integer;\r\nbegin\r\n  inherited;\r\n  if Assigned(AOwner) and (AOwner is TCustomForm) then\r\n  begin\r\n    for I := 0 to AOwner.ComponentCount - 1 do\r\n    begin\r\n      if (AOwner.Components[i] is TTMSFNCCustomPlanner) then\r\n      begin\r\n        Planner := AOwner.Components[i] as TTMSFNCCustomPlanner;\r\n        Break;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n\r\nfunction TTMSFNCPlannerCustomItemEditor.GetInstance: NativeUInt;\r\nbegin\r\n  Result := HInstance;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerCustomItemEditor.Notification(AComponent: TComponent;\r\n  Operation: TOperation);\r\nbegin\r\n  inherited;\r\n  if (Operation = opRemove) and (AComponent = FPlanner) then\r\n    FPlanner := nil;\r\nend;\r\n\r\n{ TTMSFNCPlannerDeleteHandlerPanel }\r\n\r\nprocedure TTMSFNCPlannerDeleteHandlerPanel.Click;\r\nbegin\r\n  inherited;\r\n  if Assigned(Planner) and Assigned(Planner.ActiveItem) then\r\n    Planner.HandleItemDelete(Planner.ActiveItem, pidmKeyboard);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDeleteHandlerPanel.Draw(AGraphics: TTMSFNCGraphics; ARect: TRectF);\r\nvar\r\n  bmp: TTMSFNCBitmap;\r\nbegin\r\n  inherited;\r\n  if not Assigned(Planner) then\r\n    Exit;\r\n\r\n  bmp := Planner.ItemsAppearance.DeleteHandlerBitmap;\r\n  AGraphics.DrawBitmap(RectF(0, 0, Width, Height), BitmapToDrawBitmap(bmp));\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDeleteHandlerPanel.RegisterRuntimeClasses;\r\nbegin\r\n  inherited;\r\n  RegisterClass(TTMSFNCPlannerDeleteHandlerPanel);\r\nend;\r\n\r\nconstructor TTMSFNCPlannerDeleteHandlerPanel.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  DisableBackground;\r\n  {$IFDEF FMXLIB}\r\n  ClipChildren := True;\r\n  {$ENDIF}\r\nend;\r\n\r\n{$IFDEF FMXLIB}\r\nfunction TTMSFNCPlannerDeleteHandlerPanel.GetClipRect: TRectF;\r\nvar\r\n  cr, br: TRectF;\r\nbegin\r\n  Result := inherited;\r\n  br := RectF(Position.X, Position.Y, Position.X + Width, Position.Y + Height);\r\n  cr := Planner.GetContentClipRect;\r\n  Result.Top := Max(cr.Top - br.Top, 0);\r\n  Result.Bottom := Min(Result.Bottom - (br.Bottom - cr.Bottom), Result.Bottom);\r\n  Result.Left := Max(cr.Left - br.Left, 0);\r\n  Result.Right := Min(Result.Right - (br.Right - cr.Right), Result.Right);\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF LCLLIB}\r\nclass operator TTMSFNCPlannerDisplayGroup.=(z1, z2: TTMSFNCPlannerDisplayGroup)b: boolean;\r\nbegin\r\n  Result := z1 = z2;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF CMNWEBLIB}\r\nconstructor TTMSFNCPlannerMemo.Create(AOwner: TComponent);\r\nbegin\r\n  inherited;\r\n  if AOwner is TTMSFNCCustomPlanner then\r\n    FPlanner := AOwner as TTMSFNCCustomPlanner;\r\nend;\r\n\r\nprocedure TTMSFNCPlannerMemo.DoExit;\r\nbegin\r\n  inherited;\r\n  if Assigned(FPlanner) and FPlanner.FInplaceEditorActive then\r\n    FPlanner.CloseInplaceEditor(False);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerMemo.KeyDown(var Key: Word; Shift: TShiftState);\r\nbegin\r\n  inherited;\r\n  if Assigned(FPlanner) and FPlanner.FInplaceEditorActive then\r\n  begin\r\n    case Key of\r\n      KEY_ESCAPE:\r\n      begin\r\n        FPlanner.CloseInplaceEditor(True);\r\n        FPlanner.FInplaceEditorClosed := True;\r\n        Key := 0;\r\n      end;\r\n      KEY_F2:\r\n      begin\r\n        FPlanner.CloseInplaceEditor(False);\r\n        FPlanner.FInplaceEditorClosed := True;\r\n        Key := 0;\r\n      end;\r\n    end;\r\n  end;\r\nend;\r\n{$ENDIF}\r\n\r\n{$IFDEF WEBLIB}\r\nfunction TTMSFNCPlannerCache.GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerCache.SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerDisplayList.GetItem(Index: Integer): TTMSFNCPlannerCacheItem;\r\nbegin\r\n  Result := TTMSFNCPlannerCacheItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDisplayList.SetItem(Index: Integer; const Value: TTMSFNCPlannerCacheItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerDisplayGroups.GetItem(Index: Integer): TTMSFNCPlannerDisplayGroup;\r\nbegin\r\n  Result := TTMSFNCPlannerDisplayGroup(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDisplayGroups.SetItem(Index: Integer; const Value: TTMSFNCPlannerDisplayGroup);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerConflicts.GetItem(Index: Integer): TTMSFNCPlannerConflict;\r\nbegin\r\n  Result := TTMSFNCPlannerConflict(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerConflicts.SetItem(Index: Integer; const Value: TTMSFNCPlannerConflict);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerDateTimes.GetItem(Index: Integer): TDateTime;\r\nbegin\r\n  Result := TDateTime(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerDateTimes.SetItem(Index: Integer; const Value: TDateTime);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n\r\nfunction TTMSFNCPlannerSelectedItems.GetItem(Index: Integer): TTMSFNCPlannerItem;\r\nbegin\r\n  Result := TTMSFNCPlannerItem(inherited Items[Index]);\r\nend;\r\n\r\nprocedure TTMSFNCPlannerSelectedItems.SetItem(Index: Integer; const Value: TTMSFNCPlannerItem);\r\nbegin\r\n  inherited Items[Index] := Value;\r\nend;\r\n{$ENDIF}\r\n\r\nend.\r\n","unit Unit1;\r\n\r\ninterface\r\n\r\nuses\r\n  SysUtils, Classes, WEBLib.Graphics, WEBLib.Forms, WEBLib.TMSFNCTypes, WEBLib.TMSFNCUtils, WEBLib.TMSFNCGraphics, WEBLib.TMSFNCGraphicsTypes,\r\n  WEBLib.TMSFNCCustomComponent, WEBLib.TMSFNCBitmapContainer, WEBLib.TMSFNCCustomControl,\r\n  WEBLib.TMSFNCPlannerBase, WEBLib.TMSFNCPlannerData, WEBLib.TMSFNCPlanner, WEBLib.Controls,\r\n  WEBLib.StdCtrls, WEBLib.ExtCtrls;\r\n\r\ntype\r\n  TForm4 = class(TForm)\r\n    WebPanel1: TPanel;\r\n    WebRadioButton1: TRadioButton;\r\n    WebRadioButton2: TRadioButton;\r\n    WebRadioButton3: TRadioButton;\r\n    WebCheckBox1: TCheckBox;\r\n    WebComboBox1: TComboBox;\r\n    TMSFNCPlanner1: TTMSFNCPlanner;\r\n    TMSFNCBitmapContainer1: TTMSFNCBitmapContainer;\r\n    procedure WebFormCreate(Sender: TObject);\r\n    procedure WebRadioButton1Click(Sender: TObject);\r\n    procedure WebRadioButton2Click(Sender: TObject);\r\n    procedure WebRadioButton3Click(Sender: TObject);\r\n    procedure WebCheckBox1Click(Sender: TObject);\r\n    procedure WebComboBox1Change(Sender: TObject);\r\n  protected\r\n    procedure LoadDFMValues; override;\r\n  public\r\n    dt: TDateTime;\r\n    procedure AddItems;\r\n    procedure ChangeDisplayUnit;\r\n    procedure ChangeMode;\r\n\r\n  end;\r\n\r\nvar\r\n  Form4: TForm4;\r\n\r\nimplementation\r\n\r\n\r\nuses\r\n  DateUtils, Math;\r\n\r\nprocedure TForm4.AddItems;\r\nvar\r\n  dt: TDateTime;\r\n  it: TTMSFNCPlannerItem;\r\n  c: Double;\r\n  I: Integer;\r\nbegin\r\n  TMSFNCPlanner1.BeginUpdate;\r\n\r\n  dt := Now;\r\n  TMSFNCPlanner1.Items.Clear;\r\n  c := 0;\r\n  if (TMSFNCPlanner1.Mode = pmMultiDay) then\r\n    c := 2;\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + EncodeTime(6, 30, 0, 0), Int(dt) + EncodeTime(13, 0, 0, 0), 'Meeting with John',\r\n    '<u>Necessities</u><br><ul><li>Notebook<li>Digital lineout<li>Model artwork</ul>');\r\n  it.Color := MakeGraphicsColor(255, 246, 210);\r\n  it.TitleColor := MakeGraphicsColor(255, 211, 39);\r\n  it.FontColor := MakeGraphicsColor(190, 165, 59);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + c + EncodeTime(13, 30, 0, 0), Int(dt) + c + EncodeTime(16, 30, 0, 0), 'Presentation', 'The new A3');\r\n  it.Resource := 2;\r\n  it.Color := MakeGraphicsColor(210, 239, 255);\r\n  it.TitleColor := MakeGraphicsColor(61, 185, 249);\r\n  it.FontColor := MakeGraphicsColor(17, 111, 159);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + c + 1 + EncodeTime(20, 30, 0, 0), Int(dt) + c + 1 + EncodeTime(21, 30, 0, 0), 'Audi Conditions', '<ul><li>Update iOS application<li>Change Audi packs<li>Change online terms</ul>');\r\n  it.Resource := 2;\r\n  it.Color := MakeGraphicsColor(210, 239, 255);\r\n  it.TitleColor := MakeGraphicsColor(61, 185, 249);\r\n  it.FontColor := MakeGraphicsColor(17, 111, 159);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + c + 1 + EncodeTime(9, 30, 0, 0), Int(dt) + c + 1 + EncodeTime(12, 45, 0, 0), 'Audi - Mercedes fusion', 'Meeting with Bruno Fierens for approval<br><a href=\"http://www.tmssoftware.com\">http://www.tmssoftware.com</a>');\r\n  it.Resource := 2;\r\n  it.Color := MakeGraphicsColor(210, 239, 255);\r\n  it.TitleColor := MakeGraphicsColor(61, 185, 249);\r\n  it.FontColor := MakeGraphicsColor(17, 111, 159);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + 1 + C + EncodeTime(5, 45, 0, 0), Int(dt) + 1 + c + EncodeTime(7, 35, 0, 0), 'Test drive',\r\n    'Test drive of the new BMW i8');\r\n  it.Color := MakeGraphicsColor(255, 246, 210);\r\n  it.TitleColor := MakeGraphicsColor(255, 211, 39);\r\n  it.FontColor := MakeGraphicsColor(190, 165, 59);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + 1 + C + EncodeTime(9, 30, 0, 0), Int(dt) + 1 + c + EncodeTime(11, 35, 0, 0), 'Reminder',\r\n    'Trip to Brussels to present the future of BMW');\r\n  it.Color := MakeGraphicsColor(255, 246, 210);\r\n  it.TitleColor := MakeGraphicsColor(255, 211, 39);\r\n  it.FontColor := MakeGraphicsColor(190, 165, 59);\r\n\r\n  c := 0;\r\n  if TMSFNCPlanner1.Mode = pmMultiResDay then\r\n    c := -5;\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + c + 6 + EncodeTime(12, 35, 0, 0), Int(dt) + c + 6 + EncodeTime(16, 50, 0, 0), 'Exposition', 'Mercedes exposition on the AMG GT Coup');\r\n  it.Resource := 1;\r\n  it.Color := MakeGraphicsColor(222, 255, 210);\r\n  it.TitleColor := MakeGraphicsColor(122, 223, 86);\r\n  it.FontColor := MakeGraphicsColor(114, 172, 93);\r\n\r\n  it := TMSFNCPlanner1.AddOrUpdateItem(Int(dt) + c + 5 + EncodeTime(8, 35, 0, 0), Int(dt) + c + 5 + EncodeTime(10, 50, 0, 0), 'Meeting', 'Meeting with sponsors for 2015');\r\n  it.Resource := 1;\r\n  it.Color := MakeGraphicsColor(222, 255, 210);\r\n  it.TitleColor := MakeGraphicsColor(122, 223, 86);\r\n  it.FontColor := MakeGraphicsColor(114, 172, 93);\r\n\r\n  for I := 0 to TMSFNCPlanner1.Items.Count - 1 do\r\n  begin\r\n    it := TMSFNCPlanner1.Items[I];\r\n    if (TMSFNCPlanner1.Mode = pmMonth) or (TMSFNCPlanner1.Mode = pmMultiMonth) then\r\n    begin\r\n      if TMSFNCPlanner1.Mode = pmMultiMonth then\r\n        c := Random(100)\r\n      else\r\n        c := RandomRange(-20, 20);\r\n\r\n      it.StartTime := it.StartTime + c;\r\n      it.EndTime := it.EndTime + c + 6;\r\n    end;\r\n\r\n    {$IFNDEF IOS}\r\n    it.Hint := it.Title;\r\n    {$ENDIF}\r\n    it.TitleFontColor := it.FontColor;\r\n    it.ActiveColor := it.TitleColor;\r\n    it.ActiveTitleFontColor := it.TitleFontColor;\r\n    it.ActiveFontColor := it.FontColor;\r\n  end;\r\n\r\n  TMSFNCPlanner1.EndUpdate;\r\n\r\nend;\r\n\r\nprocedure TForm4.ChangeDisplayUnit;\r\nbegin\r\n  if (TMSFNCPlanner1.Mode <> pmMonth) and (TMSFNCPlanner1.Mode <> pmMultiMonth) then\r\n  begin\r\n    TMSFNCPlanner1.BeginUpdate;\r\n    case WebComboBox1.ItemIndex of\r\n      0: TMSFNCPlanner1.TimeLine.DisplayUnit := 5;\r\n      1: TMSFNCPlanner1.TimeLine.DisplayUnit := 10;\r\n      2: TMSFNCPlanner1.TimeLine.DisplayUnit := 12;\r\n      3: TMSFNCPlanner1.TimeLine.DisplayUnit := 15;\r\n      4: TMSFNCPlanner1.TimeLine.DisplayUnit := 20;\r\n      5: TMSFNCPlanner1.TimeLine.DisplayUnit := 30;\r\n      6: TMSFNCPlanner1.TimeLine.DisplayUnit := 60;\r\n    end;\r\n    TMSFNCPlanner1.TimeLine.DisplayEnd := 10000;\r\n    TMSFNCPlanner1.EndUpdate;\r\n  end;\r\n\r\nend;\r\n\r\nprocedure TForm4.ChangeMode;\r\nbegin\r\n  TMSFNCPlanner1.BeginUpdate;\r\n  if WebCheckBox1.Checked then\r\n  begin\r\n    if WebRadioButton1.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMultiResDay;\r\n      TMSFNCPlanner1.Positions.Count := 3;\r\n      TMSFNCPlanner1.Positions.Format := 'dddd d';\r\n    end\r\n    else if WebRadioButton2.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMultiResDay;\r\n      TMSFNCPlanner1.Positions.Count := 6;\r\n      TMSFNCPlanner1.Positions.Format := 'dddd d';\r\n    end\r\n    else if WebRadioButton3.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMonth;\r\n      TMSFNCPlanner1.Positions.Count := 3;\r\n      TMSFNCPlanner1.Positions.Format := 'mmmm';\r\n    end;\r\n  end\r\n  else\r\n  begin\r\n    if WebRadioButton1.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMultiDay;\r\n      TMSFNCPlanner1.Positions.Count := 1;\r\n      TMSFNCPlanner1.Positions.Format := 'dddd d';\r\n    end\r\n    else if WebRadioButton2.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMultiDay;\r\n      TMSFNCPlanner1.Positions.Count := 7;\r\n      TMSFNCPlanner1.Positions.Format := 'dddd d';\r\n    end\r\n    else if WebRadioButton3.Checked then\r\n    begin\r\n      TMSFNCPlanner1.Mode := pmMultiMonth;\r\n      TMSFNCPlanner1.Positions.Count := 5;\r\n      TMSFNCPlanner1.Positions.Format := 'mmmm';\r\n    end;\r\n  end;\r\n\r\n  TMSFNCPlanner1.EndUpdate;\r\n  if not WebRadioButton3.Checked then\r\n    TMSFNCPlanner1.TimeLine.ViewStart := Int(Now) + EncodeTime(5, 0, 0, 0);\r\n\r\n  ChangeDisplayUnit;\r\n  AddItems;\r\nend;\r\n\r\nprocedure TForm4.WebCheckBox1Click(Sender: TObject);\r\nbegin\r\n  ChangeMode;\r\nend;\r\n\r\nprocedure TForm4.WebComboBox1Change(Sender: TObject);\r\nbegin\r\n  ChangeDisplayUnit;\r\nend;\r\n\r\nprocedure TForm4.WebFormCreate(Sender: TObject);\r\nvar\r\n  i: integer;\r\nbegin\r\n  WebComboBox1.Items.Add('5');\r\n  WebComboBox1.Items.Add('10');\r\n  WebComboBox1.Items.Add('12');\r\n  WebComboBox1.Items.Add('15');\r\n  WebComboBox1.Items.Add('20');\r\n  WebComboBox1.Items.Add('30');\r\n  WebComboBox1.Items.Add('60');\r\n  WebComboBox1.ItemIndex := 5;\r\n\r\n  TMSFNCBitmapContainer1.AddFromURL('http://www.tmssoftware.net/public/WebPas/Audi.png', 'Audi');\r\n  TMSFNCBitmapContainer1.AddFromURL('http://www.tmssoftware.net/public/WebPas/BMW.png', 'BMW');\r\n  TMSFNCBitmapContainer1.AddFromURL('http://www.tmssoftware.net/public/WebPas/Mercedes.png', 'Mercedes');\r\n\r\n  TMSFNCPlanner1.InitSample;\r\n\r\n  dt := Now;\r\n  TMSFNCPlanner1.Stroke.Kind := gskNone;\r\n  TMSFNCPlanner1.BeginUpdate;\r\n  TMSFNCPlanner1.BitmapContainer := TMSFNCBitmapContainer1;\r\n\r\n  TMSFNCPlanner1.Interaction.KeyboardInsertMode := pkimSelection;\r\n  TMSFNCPlanner1.Interaction.MouseInsertMode := pmimDialogAfterSelection;\r\n  TMSFNCPlanner1.Interaction.UpdateMode := pumDialog;\r\n  TMSFNCPlanner1.ModeSettings.StartTime := dt;\r\n\r\n  Color := MakeGraphicsColor(237, 243, 248);\r\n  TMSFNCPlanner1.Fill.Color := Color;\r\n\r\n  TMSFNCPlanner1.TimeLineAppearance.LeftStroke.Color := Color;\r\n  TMSFNCPlanner1.TimeLineAppearance.LeftFont.Color := MakeGraphicsColor(115, 115, 115);\r\n  TMSFNCPlanner1.TimeLineAppearance.LeftFont.Style := [fsBold];\r\n  TMSFNCPlanner1.TimeLineAppearance.LeftFont.Size := 14;\r\n  TMSFNCPlanner1.TimeLineAppearance.LeftSubUnitFontSize := 12;\r\n\r\n  TMSFNCPlanner1.Positions.Count := 7;\r\n  TMSFNCPlanner1.Positions.Format := 'dddd d';\r\n  TMSFNCPlanner1.PositionsAppearance.TopStroke.Color := Color;\r\n  TMSFNCPlanner1.PositionsAppearance.TopFont.Color := MakeGraphicsColor(115, 115, 115);\r\n  TMSFNCPlanner1.PositionsAppearance.TopFont.Size := 12;\r\n  TMSFNCPlanner1.PositionsAppearance.TopFont.Color := MakeGraphicsColor(115, 115, 115);\r\n\r\n  TMSFNCPlanner1.GroupsAppearance.TopStroke.Color := Color;\r\n  TMSFNCPlanner1.GroupsAppearance.TopFont.Color := MakeGraphicsColor(115, 115, 115);\r\n  TMSFNCPlanner1.GroupsAppearance.TopFont.Size := 12;\r\n  TMSFNCPlanner1.GroupsAppearance.TopFont.Color := MakeGraphicsColor(115, 115, 115);\r\n\r\n  TMSFNCPlanner1.GridCellAppearance.Fill.Kind := gfkSolid;\r\n  TMSFNCPlanner1.Margins.Left := 10;\r\n  TMSFNCPlanner1.Margins.Bottom := 10;\r\n  TMSFNCPlanner1.StretchScrollBars := False;\r\n\r\n  TMSFNCPlanner1.ItemsAppearance.MoveAreaColor := gcDarkgray;\r\n  TMSFNCPlanner1.ItemsAppearance.SizeAreaColor := gcDarkgray;\r\n\r\n  for I := 0 to TMSFNCPlanner1.Resources.Count - 1 do\r\n  begin\r\n    TMSFNCPlanner1.Resources[I].Name := TMSFNCPlanner1.Resources[I].Text;\r\n    TMSFNCPlanner1.Resources[I].Text := '<img src=\"'+TMSFNCPlanner1.Resources[I].Text+'\" height=\"45\"/>';\r\n  end;\r\n\r\n  TMSFNCPlanner1.EndUpdate;\r\n  TMSFNCPlanner1.TimeLine.ViewStart := Int(Now) + EncodeTime(5, 0, 0, 0);\r\n\r\n  AddItems;\r\n\r\nend;\r\n\r\nprocedure TForm4.WebRadioButton1Click(Sender: TObject);\r\nbegin\r\n  ChangeMode;\r\nend;\r\n\r\nprocedure TForm4.WebRadioButton2Click(Sender: TObject);\r\nbegin\r\n  ChangeMode;\r\nend;\r\n\r\nprocedure TForm4.WebRadioButton3Click(Sender: TObject);\r\nbegin\r\n  ChangeMode;\r\nend;\r\n\r\nprocedure TForm4.LoadDFMValues;\r\nbegin\r\n  inherited LoadDFMValues;\r\n\r\n  WebPanel1 := TPanel.Create(Self);\r\n  WebRadioButton1 := TRadioButton.Create(WebPanel1);\r\n  WebRadioButton2 := TRadioButton.Create(WebPanel1);\r\n  WebRadioButton3 := TRadioButton.Create(WebPanel1);\r\n  WebCheckBox1 := TCheckBox.Create(WebPanel1);\r\n  WebComboBox1 := TComboBox.Create(WebPanel1);\r\n  TMSFNCBitmapContainer1 := TTMSFNCBitmapContainer.Create(WebPanel1);\r\n  TMSFNCPlanner1 := TTMSFNCPlanner.Create(Self);\r\n\r\n  WebPanel1.BeforeLoadDFMValues;\r\n  WebRadioButton1.BeforeLoadDFMValues;\r\n  WebRadioButton2.BeforeLoadDFMValues;\r\n  WebRadioButton3.BeforeLoadDFMValues;\r\n  WebCheckBox1.BeforeLoadDFMValues;\r\n  WebComboBox1.BeforeLoadDFMValues;\r\n  TMSFNCBitmapContainer1.BeforeLoadDFMValues;\r\n  TMSFNCPlanner1.BeforeLoadDFMValues;\r\n  try\r\n    Name := 'Form4';\r\n    Left := 0;\r\n    Top := 0;\r\n    Width := 1070;\r\n    Height := 785;\r\n    Font.Charset := DEFAULT_CHARSET;\r\n    Font.Color := clWindowText;\r\n    Font.Height := -11;\r\n    Font.Name := 'Tahoma';\r\n    Font.Style := [];\r\n    FormContainer := 'appcontent';\r\n    TabOrder := 1;\r\n    OnCreate := WebFormCreate;\r\n    WebPanel1.SetParentComponent(Self);\r\n    WebPanel1.Name := 'WebPanel1';\r\n    WebPanel1.Left := 0;\r\n    WebPanel1.Top := 0;\r\n    WebPanel1.Width := 1070;\r\n    WebPanel1.Height := 97;\r\n    WebPanel1.Align := alTop;\r\n    WebPanel1.BorderStyle := bsSingle;\r\n    WebRadioButton1.SetParentComponent(WebPanel1);\r\n    WebRadioButton1.Name := 'WebRadioButton1';\r\n    WebRadioButton1.Left := 208;\r\n    WebRadioButton1.Top := 16;\r\n    WebRadioButton1.Width := 113;\r\n    WebRadioButton1.Height := 17;\r\n    WebRadioButton1.Caption := 'Day';\r\n    WebRadioButton1.Checked := True;\r\n    WebRadioButton1.GroupName := 'Planner';\r\n    WebRadioButton1.TabOrder := 0;\r\n    WebRadioButton1.OnClick := WebRadioButton1Click;\r\n    WebRadioButton2.SetParentComponent(WebPanel1);\r\n    WebRadioButton2.Name := 'WebRadioButton2';\r\n    WebRadioButton2.Left := 208;\r\n    WebRadioButton2.Top := 39;\r\n    WebRadioButton2.Width := 113;\r\n    WebRadioButton2.Height := 17;\r\n    WebRadioButton2.Caption := 'Week';\r\n    WebRadioButton2.Checked := False;\r\n    WebRadioButton2.GroupName := 'Planner';\r\n    WebRadioButton2.TabOrder := 1;\r\n    WebRadioButton2.OnClick := WebRadioButton2Click;\r\n    WebRadioButton3.SetParentComponent(WebPanel1);\r\n    WebRadioButton3.Name := 'WebRadioButton3';\r\n    WebRadioButton3.Left := 208;\r\n    WebRadioButton3.Top := 62;\r\n    WebRadioButton3.Width := 113;\r\n    WebRadioButton3.Height := 17;\r\n    WebRadioButton3.Caption := 'Month';\r\n    WebRadioButton3.Checked := False;\r\n    WebRadioButton3.GroupName := 'Planner';\r\n    WebRadioButton3.TabOrder := 2;\r\n    WebRadioButton3.OnClick := WebRadioButton3Click;\r\n    WebCheckBox1.SetParentComponent(WebPanel1);\r\n    WebCheckBox1.Name := 'WebCheckBox1';\r\n    WebCheckBox1.Left := 40;\r\n    WebCheckBox1.Top := 62;\r\n    WebCheckBox1.Width := 97;\r\n    WebCheckBox1.Height := 17;\r\n    WebCheckBox1.Caption := 'Resources';\r\n    WebCheckBox1.State := cbUnchecked;\r\n    WebCheckBox1.TabOrder := 3;\r\n    WebCheckBox1.OnClick := WebCheckBox1Click;\r\n    WebComboBox1.SetParentComponent(WebPanel1);\r\n    WebComboBox1.Name := 'WebComboBox1';\r\n    WebComboBox1.Left := 40;\r\n    WebComboBox1.Top := 14;\r\n    WebComboBox1.Width := 145;\r\n    WebComboBox1.Height := 21;\r\n    WebComboBox1.ItemIndex := -1;\r\n    WebComboBox1.TabOrder := 4;\r\n    WebComboBox1.Text := 'WebComboBox1';\r\n    WebComboBox1.OnChange := WebComboBox1Change;\r\n    TMSFNCBitmapContainer1.SetParentComponent(WebPanel1);\r\n    TMSFNCBitmapContainer1.Name := 'TMSFNCBitmapContainer1';\r\n    TMSFNCBitmapContainer1.Left := 944;\r\n    TMSFNCBitmapContainer1.Top := 39;\r\n    TMSFNCBitmapContainer1.Width := 26;\r\n    TMSFNCBitmapContainer1.Height := 26;\r\n    TMSFNCBitmapContainer1.Visible := True;\r\n    TMSFNCPlanner1.SetParentComponent(Self);\r\n    TMSFNCPlanner1.Name := 'TMSFNCPlanner1';\r\n    TMSFNCPlanner1.Left := 0;\r\n    TMSFNCPlanner1.Top := 97;\r\n    TMSFNCPlanner1.Width := 1070;\r\n    TMSFNCPlanner1.Height := 688;\r\n    TMSFNCPlanner1.Align := alClient;\r\n    TMSFNCPlanner1.ParentDoubleBuffered := False;\r\n    TMSFNCPlanner1.DoubleBuffered := True;\r\n    TMSFNCPlanner1.TabOrder := 1;\r\n    TMSFNCPlanner1.DefaultItem.StartTime := 43051.270833333340000000;\r\n    TMSFNCPlanner1.DefaultItem.EndTime := 43051.375000000000000000;\r\n    TMSFNCPlanner1.GridCellAppearance.VerticalStroke.Color := 11119017;\r\n    TMSFNCPlanner1.GridCellAppearance.HorizontalStroke.Color := 11119017;\r\n    TMSFNCPlanner1.GridCellAppearance.HorizontalSubStroke.Color := 13882323;\r\n    TMSFNCPlanner1.GridCellAppearance.InActiveFill.Color := 16774625;\r\n    TMSFNCPlanner1.GridCellAppearance.Fill.Kind := gfkNone;\r\n    TMSFNCPlanner1.GridCellAppearance.DisabledFill.Color := 15132390;\r\n    TMSFNCPlanner1.GroupsAppearance.TopSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.GroupsAppearance.TopFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.GroupsAppearance.TopFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.GroupsAppearance.TopFont.Color := clGray;\r\n    TMSFNCPlanner1.GroupsAppearance.TopFont.Height := -11;\r\n    TMSFNCPlanner1.GroupsAppearance.TopFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.GroupsAppearance.TopFont.Style := [];\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFont.Color := clGray;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFont.Height := -11;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.GroupsAppearance.BottomFont.Style := [];\r\n    TMSFNCPlanner1.GroupsAppearance.TopStroke.Color := 11119017;\r\n    TMSFNCPlanner1.GroupsAppearance.BottomStroke.Color := 11119017;\r\n    with TMSFNCPlanner1.Items.Add do\r\n    begin\r\n      Text := 'Notes';\r\n      Title := 'Sample Item';\r\n      StartTime := 43051.270833333340000000;\r\n      EndTime := 43051.375000000000000000;\r\n    end;\r\n    TMSFNCPlanner1.ModeSettings.StartTime := 43051.683571504630000000;\r\n    TMSFNCPlanner1.ModeSettings.EndTime := 43071.683571504630000000;\r\n    TMSFNCPlanner1.PositionsAppearance.Size := 100.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.TopSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.TopFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.PositionsAppearance.TopFont.Color := clGray;\r\n    TMSFNCPlanner1.PositionsAppearance.TopFont.Height := -11;\r\n    TMSFNCPlanner1.PositionsAppearance.TopFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.PositionsAppearance.TopFont.Style := [];\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFont.Color := clGray;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFont.Height := -11;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFont.Style := [];\r\n    TMSFNCPlanner1.PositionsAppearance.TopFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.PositionsAppearance.TopStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.TopNavigationButtonStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomNavigationButtonStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.TopNavigationButtonHoverFill.Color := 16774625;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomNavigationButtonHoverFill.Color := 16774625;\r\n    TMSFNCPlanner1.PositionsAppearance.TopNavigationButtonHoverStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomNavigationButtonHoverStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.TopNavigationButtonDownFill.Color := 16176533;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomNavigationButtonDownFill.Color := 16176533;\r\n    TMSFNCPlanner1.PositionsAppearance.TopNavigationButtonDownStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomNavigationButtonDownStroke.Color := 11119017;\r\n    TMSFNCPlanner1.PositionsAppearance.TopLeftNavigationButtonSize := 18.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.TopRightNavigationButtonSize := 18.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomLeftNavigationButtonSize := 18.000000000000000000;\r\n    TMSFNCPlanner1.PositionsAppearance.BottomRightNavigationButtonSize := 18.000000000000000000;\r\n    with TMSFNCPlanner1.Resources.Add do\r\n    begin\r\n      Name := 'Resource0';\r\n      Text := 'BMW';\r\n    end;\r\n    with TMSFNCPlanner1.Resources.Add do\r\n    begin\r\n      Name := 'Resource1';\r\n      Text := 'Mercedes';\r\n    end;\r\n    with TMSFNCPlanner1.Resources.Add do\r\n    begin\r\n      Name := 'Resource2';\r\n      Text := 'Audi';\r\n    end;\r\n    TMSFNCPlanner1.SelectionAppearance.Fill.Color := 16176533;\r\n    TMSFNCPlanner1.TimeLine.DisplayUnitSize := 25.000000000000000000;\r\n    TMSFNCPlanner1.TimeLine.ViewStart := 43051.166666666660000000;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightSize := 50.000000000000000000;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFill.Kind := gfkNone;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftStroke.Color := 11119017;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightStroke.Color := 11119017;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftSubStroke.Color := 13882323;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightSubStroke.Color := 13882323;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFont.Color := clGray;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFont.Height := -19;\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftFont.Style := [];\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFont.Color := clGray;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFont.Height := -19;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.TimeLineAppearance.RightFont.Style := [];\r\n    TMSFNCPlanner1.TimeLineAppearance.LeftSubUnitFontSize := 10.000000000000000000;\r\n    TMSFNCPlanner1.TimeLineAppearance.RightSubUnitFontSize := 10.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.Gap := 10.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.MoveAreaSize := 4.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.SizeAreaSize := 4.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.DeleteAreaSize := 16.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.DeleteHandlerBitmap.LoadFromFile('Unit1.TMSFNCPlanner1.ItemsAppearance.DeleteHandlerBitmap.png');\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerHeight := 30.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerWidth := 50.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.DeleteHandlerHeight := 30.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.DeleteHandlerWidth := 30.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerLeftBitmap.LoadFromFile('Unit1.TMSFNCPlanner1.ItemsAppearance.SizeHandlerLeftBitmap.png');\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerRightBitmap.LoadFromFile('Unit1.TMSFNCPlanner1.ItemsAppearance.SizeHandlerRightBitmap.png');\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerUpBitmap.LoadFromFile('Unit1.TMSFNCPlanner1.ItemsAppearance.SizeHandlerUpBitmap.png');\r\n    TMSFNCPlanner1.ItemsAppearance.SizeHandlerDownBitmap.LoadFromFile('Unit1.TMSFNCPlanner1.ItemsAppearance.SizeHandlerDownBitmap.png');\r\n    TMSFNCPlanner1.ItemsAppearance.LinkStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.LinkStroke.Width := 2.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.LinkArrowSize := 7.000000000000000000;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleFont.Height := -16;\r\n    TMSFNCPlanner1.ItemsAppearance.TitleFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.TitleFont.Style := [fsBold];\r\n    TMSFNCPlanner1.ItemsAppearance.Fill.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.Stroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.Stroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.Font.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.Font.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.Font.Height := -11;\r\n    TMSFNCPlanner1.ItemsAppearance.Font.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.Font.Style := [];\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleFont.Height := -16;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedTitleFont.Style := [fsBold];\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleFont.Height := -16;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveTitleFont.Style := [fsBold];\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFill.Color := 16297243;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFont.Height := -11;\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.SelectedFont.Style := [];\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFill.Color := 16297243;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFont.Height := -11;\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.ActiveFont.Style := [];\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFill.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFont.Height := -16;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledTitleFont.Style := [fsBold];\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFill.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledStroke.Kind := gskNone;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledStroke.Color := 11119017;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFont.Charset := DEFAULT_CHARSET;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFont.Color := clWindowText;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFont.Height := -11;\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFont.Name := 'Tahoma';\r\n    TMSFNCPlanner1.ItemsAppearance.DisabledFont.Style := [];\r\n  finally\r\n    WebPanel1.AfterLoadDFMValues;\r\n    WebRadioButton1.AfterLoadDFMValues;\r\n    WebRadioButton2.AfterLoadDFMValues;\r\n    WebRadioButton3.AfterLoadDFMValues;\r\n    WebCheckBox1.AfterLoadDFMValues;\r\n    WebComboBox1.AfterLoadDFMValues;\r\n    TMSFNCBitmapContainer1.AfterLoadDFMValues;\r\n    TMSFNCPlanner1.AfterLoadDFMValues;\r\n  end;\r\nend;\r\n\r\nend.","program TMSWeb_FNCPlanner;\r\n\r\nuses\r\n  WEBLib.Forms,\r\n  Unit1 in 'Unit1.pas'{*.html};\r\n\r\n{$R *.res}\r\n\r\nbegin\r\n  Application.Initialize;\r\n  Application.MainFormOnTaskbar := True;\r\n  Application.CreateForm(TForm4, Form4);\r\n  Application.Run;\r\nend.\r\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1nCA;;;AAQY,oBAAG;pBACH,oBAAG;pBAQH,oBAAI;pBAGR,gBAAG;hBAiCU;AAMV;AASC;;AACP;AACA;;AADA;AACA;;AAFO;aACP,sBACA;nCAFO;;AAUL;;AACH;AACA;AACA;AACA;;AAHA;AACA;AACA;AACA;;AAJG;aACH,kBACA,IACA,CADA,kBACA,IACA,C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Aa,MAAM,YAAY,CAAC,cAAe,QAAhB;1EAC/B,iCAAa,MAAM,YAAY,CAAC,UAAW,QAAZ;;tEAI/B,iCAAa,MAAM,YAAY,CAAC,WAAY,QAAb;vEAC/B,iCAAa,MAAM,YAAY,CAAC,cAAe,QAAhB;1EAC/B,iCAAa,MAAM,YAAY,CAAC,UAAW,cAAZ;;5EAgBjC,+BAAa,MAAM,YAAY,CAAC,mBAAoB,kCAAW,CAAC,WAAD,CAAhC;7GA5BjC;PAJwC;AAlCH;AAErC;AACA,uBAAa;vBACb,oBAAS,QAAT;5BACA,sBAAW,KAAX;3BACA,2BAAgB;3BANqB;AA1qCzB;AAeN;;AAEU,6BFzJV,uCEyJU;pEACW;AACT,+BFnJV,yCEmJU;xEACC;AACG,mCJ9ChB,YI8CgB;/CACA,mCF5JV,6CE4JU;hFACJ;AACF,6BJjDV,YIiDU;zCACW;AACP;AACE,mCFrJV,6CEqJU;hFACI,uCFrJV,iDEqJU;xFACR;AACD,8Bb5PV,Ya4PU;1CACF;AACA,4Bb9PR,Ya8PQ;xCACI;AACL,2BbhQP,YagQO;vCACI;AACF,6BblQT,YakQS;zCACE,+BFxJN,6CEwJM;5EACG,kCFzJT,6CEyJS;/EAvBf;AApQR;ACAA,8BAES,UAFT;;;xCAoFiC;AAAxB;AAEP;AAIF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGE,aAAU;bAjOH;AAAwB;AAoOJ;AAApB;AAEP;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEE,aAAU;bAdH;AAAoB;AAiBC;AAArB;AAEP;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEE,aAAU;bAdH;AAAqB;AAiBC;AAAtB;AAEP;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGE,aAAU;bAfH;AAAsB;AAkBC;AAAvB;AAEP;AAGF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGE,aAAU;bAfH;AAAuB;AAkBE;AAAzB;AAEP;AAGF;AACA;AACA;AAEE,aAAU;bATH;AAAyB;AAaT;AAAhB;AAEP;AAGF;AAEE,aAAU;bAPH;AAAgB;AA3YzB,GAmBc,WAnBd;dCAA,6BAES,2FAFT;;;;xHAQa;AAQA;;;AAET;AAGA;AACA;AACA;AACA;AARS;;AAOT,yBAPS;zBAQT,mBARS;;;nBAwImB;;AARM;AAEpC;AACA,sBAAY;tBACZ,sBAAY;tBACZ,yBAAe;zBALqB;AAhIzB;AA0BO;AAEM,q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,GAAe;rBACf,YAAM,OAAN,GAAgB;tBAChB,YAAM,eAAN,GAAwB;9BACxB,YAAM,aAAN,GAAsB;5BACtB,YAAM,MAAN,GAAe;rBARsB;AAAiB;AAyDE;AAAnB;AAErC,eAAU,4BAAuB,QAAC;nDAClC,YAAM,MAAN,GAAe;rBACf,YAAM,OAAN,GAAgB;tBAChB,YAAM,KAAN,GAAc;pBACd,YAAM,MAAN,GAAe;rBANsB;AAAmB;AAShB;AAExC,UAAY,UAAD,QAAX,EACE,UAAK,WAAW,OAAO,CAAC,IAAD,CADzB;hEAGA,mBAAS;nBAET,UAAY,YAAD,QAAX,EACU,SAAR,KAAQ,UADV;xDAEA;AATwC;AA5hEjB;AAgDI;AAggEe;AAAP;AAEnC,eAAiC,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAFE;AAAO;AAhgEf;AAOF;AAmgEe;AAAP;AAEjC,eAAiB,WAAW,QAAK,CAAC,KAAD,CAAhB;zCAFgB;AAAO;AAKC;AAE/B,cAAK,CAAC,MAAU,KAAX;1BAF0B;AAxgEhB;AAaC;AACC;;AAET;;;AAEhB;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApGgB;;AAKhB,qBALgB;rBAWhB,mBAXgB;nBAiBhB,4BAjBgB;5BAkBhB,yBAlBgB;zBAuChB,qBAvCgB;rBAwChB,uBAxCgB;vBA0ChB,yBA1CgB;zBA0CA,4BA1CA;5BAyDhB,sBAzDgB;tBA+DhB,sBA/DgB;tBAwEhB,6BAxEgB;7BAyEhB,6BAzEgB;7BA0EhB,2BA1EgB;3BA2EhB,qBA3EgB;rBA4EhB,kCA5EgB;lCA6EhB,kCA7EgB;lCA8EhB,gCA9EgB;hCA+EhB,0BA/EgB;;;1BA86CgB;AAElC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT,wBA5uCsD,MAAyB;vBAyuCjF;PAFkC;AAzJG;AAErC;AAAK;AACL;AAEA,UAAqC,CAAjC,6BAAe,CAAC,cAAU,KAAX,CAAkB,KAAG,CAAH,CAAM,IAAI,CAAI,wBAAnD;jGAEE,mCAAuB;nCACvB,cAAO;dACP,cAAO,KAAM,GAAE,aAAF;nCACb,cAAO;dACP,wBAAY;xBACZ,YAAY,aAAD,QAAX,EACE,aAAQ,kBAAkB,CAAC,KAAM,IAAK,IAAK,GAAjB,CAD5B;pFAEA,uBAAU,CAAC,KA5lCoE,IA4lCrE;jCACV,mCAAuB;5BAVzB;PALqC;AAsIE;AAEvC;AAAK;AACL;AAEA,UAAuC,CAAnC,6BAAe,CAAC,gBAAY,KAAb,CAAoB,KAAG,CAAH,CAAM,IAAI,CAAI,wBAArD;nGAEE,mCAAuB;nCACvB,cAAO,KAAM,GAAE,eAAF;rCACb,cAAO;dACP,cAAO;dACP,0BAAc;1BACd,YAAY,aAAD,QAAX,EACE,aAAQ,kBAAkB,CAAC,KAAM,IAAK,IAAK,GAAjB,CAD5B;pFAEA,uBAAU,CAAC,KAluCoE,IAkuCrE;jCACV,mCAAuB;5BAVzB;PALuC;AAnBD;AAEtC;AAAK;AACL;AAEA,UAAc,CAAV,cAAU,KAAG,KAAH,CAAU,IAAI,CAAI,wBAAhC;jEAEE,mCAAuB;nCACvB,cAAO;dACP,cAAO;dACP,cAAO,KAAM,GAAE,cAAF;pCACb,yBAAa;zBACb,YAAY,aAAD,QAAX,EACE,aAAQ,kBAAkB,CAAC,KAAM,IAAK,IAAK,GAAjB,CAD5B;pFAEA,uBAAU,CAAC,KA/sCoE,IA+sCrE;jCACV,mCAAuB;5BAVzB;PALsC;AAsJD;AAErC,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,uBAAU,CAAC,KA51CoE,IA41CrE;1BAHZ;PAFqC;AAnFF;AAEnC,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,wBAzwCsD,MAAyB;vBAswCjF;PAFmC;AArMG;AAEtC,UAAG,cAAU,KAAG,KAAhB,EACE,iBAAa,KADf;1DAFsC;AAMD;AAErC,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,wBA1kCsD,MAAyB;vBAukCjF;PAFqC;AA3ZG;AAExC,UAAG,gBAAY,KAAG,KAAlB,EACE,mBAAe,KADjB;9DAFwC;AAuSL;AAEnC,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,wBAt9BsD,MAAyB;vBAm9BjF;PAFmC;AA4TK;AAExC,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf,wBAlxCsD,MAAyB;vBA+wCjF;PAFwC;AA1SG;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,wBAx+BsD,MAAyB;vBAq+BjF;PAF2C;AASI;AAE/C,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,wBAj/BsD,MAAyB;vBA8+BjF;PAF+C;AAoCC;AAEhD,UAAG,wBAAoB,KAAG,KAA1B;5CAEE,mCAAuB;nCACvB,wBArhCsD,MAAyB;vBAkhCjF;PAFgD;AASI;AAGpD,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,wBA/hCsD,MAAyB;vBA4hCjF;PAHoD;AAgFb;AAEvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,wBA9mCsD,MAAyB;vBA2mCjF;PAFuC;AAzbI;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,wBArrBsD,MAAyB;vBAkrBjF;PAF2C;AAkBI;AAE/C,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,wBAvsBsD,MAAyB;vBAosBjF;PAF+C;AAoCC;AAEhD,UAAG,wBAAoB,KAAG,KAA1B;5CAEE,mCAAuB;nCACvB,wBA3uBsD,MAAyB;vBAwuBjF;PAFgD;AASI;AAGpD,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,wBArvBsD,MAAyB;vBAkvBjF;PAHoD;AA+CX;AAEzC,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB,wBAnyBsD,MAAyB;vBAgyBjF;PAFyC;AASI;AAE7C,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,wBA5yBsD,MAAyB;vBAyyBjF;PAF6C;AAoCC;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,wBAh1BsD,MAAyB;vBA60BjF;PAF8C;AASI;AAGlD,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,wBA11BsD,MAAyB;vBAu1BjF;PAHkD;AAkcN;AAE5C,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,wBA3xCsD,MAAyB;vBAwxCjF;PAF4C;AAzIV;AAElC,UAAG,UAAM,KAAG,KAAZ,EACE,aAAS,KADX;lDAFkC;AAsCG;AAErC,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;jBAFd;PAFqC;AA1TC;AAEtC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;lBAFf;PAFsC;AAwOK;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;vBAFpB;PAF2C;AA5UJ;AAEvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,wBA1xBsD,MAAyB;vBAuxBjF;PAFuC;AAsaG;AAE1C,UAAG,kBAAc,KAAG,KAApB,EACE,qBAAiB,KADnB;lEAF0C;AAjOH;AAEvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,wBA/9BsD,MAAyB;vBA49BjF;PAFuC;AA4MC;AAExC,UAAG,gBAAY,KAAG,KAAlB,EACE,mBAAe,KADjB;9DAFwC;AAnBD;AAGvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,wBAzpCsD,MAAyB;vBAspCjF;PAHuC;AAUA;AAEvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,wBAlqCsD,MAAyB;vBA+pCjF;PAFuC;AApeQ;AAE/C,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,wBA9rBsD,MAAyB;vBA2rBjF;PAF+C;AAyIF;AAE7C,UAAoB,UAAjB,sBAAoB,KAAH,CAApB;hDAEE,gCAAoB;hCACpB,wBAv0BsD,MAAyB;vBAo0BjF;PAF6C;AA8CK;AAElD,UAAyB,UAAtB,2BAAyB,KAAH,CAAzB;rDAEE,qCAAyB;rCACzB,wBAr3BsD,MAAyB;vBAk3BjF;PAFkD;AAuJH;AAE/C,UAAsB,UAAnB,wBAAsB,KAAH,CAAtB;lDAEE,kCAAsB;lCACtB,wBA5gCsD,MAAyB;vBAygCjF;PAF+C;AA8CK;AAGpD,UAA2B,UAAxB,6BAA2B,KAAH,CAA3B;vDAEE,uCAA2B;vCAC3B,wBA3jCsD,MAAyB;vBAwjCjF;PAHoD;AA+Eb;AAEvC,UAAc,UAAX,gBAAc,KAAH,CAAd;1CAEE,0BAAc;1BACd,wBAzoCsD,MAAyB;vBAsoCjF;PAFuC;AAvaQ;AAE/C,UAAsB,UAAnB,wBAAsB,KAAH,CAAtB;lDAEE,kCAAsB;lCACtB,wBAluBsD,MAAyB;vBA+tBjF;PAF+C;AA8CK;AAGpD,UAA2B,UAAxB,6BAA2B,KAAH,CAA3B;vDAEE,uCAA2B;vCAC3B,wBAjxBsD,MAAyB;vBA8wBjF;PAHoD;AAsiBR;AAE5C,UAAmB,UAAhB,qBAAmB,KAAH,CAAnB;/CAEE,+BAAmB;/BACnB,wBAtzCsD,MAAyB;vBAmzCjF;PAF4C;AAjgBA;AAE5C,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,wBArzBsD,MAAyB;vBAkzBjF;PAF4C;AA8CK;AAEjD,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,wBAn2BsD,MAAyB;vBAg2BjF;PAFiD;AAuJH;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,wBA1/BsD,MAAyB;vBAu/BjF;PAF8C;AA8CK;AAEnD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,wBAxiCsD,MAAyB;vBAqiCjF;PAFmD;AAxVL;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,wBAhtBsD,MAAyB;vBA6sBjF;PAF8C;AA8CK;AAEnD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,wBA9vBsD,MAAyB;vBA2vBjF;PAFmD;AAsiBR;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,wBApyCsD,MAAyB;vBAiyCjF;PAF2C;AA+CO;AAElD,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,wBAn1CsD,MAAyB;vBAg1CjF;PAFkD;AA5NZ;AAEtC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb,wBAvnCsD,MAAyB;vBAonCjF;PAFsC;AA8He;AAGrD,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,wBAtvCsD,MAAyB;vBAmvCjF;PAHqD;AAUF;AAGnD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,wBAhwCsD,MAAyB;vBA6vCjF;PAHmD;AAgEG;AAGtD,UAAG,8BAA0B,KAAG,KAAhC;lDAEE,yCAA6B;zCAC7B,wBAh0CsD,MAAyB;vBA6zCjF;PAHsD;AAUF;AAGpD,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,wBA10CsD,MAAyB;vBAu0CjF;PAHoD;AAraJ;AAAtB;AAE1B,eAAU,oBAAe,KAAG,CAAC,CAAJ;1CAFC;AAAsB;AAKK;AAA3B;AAE1B,eAAU,yBAAoB,KAAG,CAAC,CAAJ;/CAFJ;AAA2B;AAKH;AAAxB;AAE1B,eAAU,sBAAiB,KAAG,CAAC,CAAJ;5CAFD;AAAwB;AAKK;AAA7B;AAE1B,eAAU,2BAAsB,KAAG,CAAC,CAAJ;jDAFN;AAA6B;AAKb;AAAhB;AAE1B,eAAU,cAAS,KAAG,CAAC,CAAJ;pCAFO;AAAgB;AAKQ;AAAxB;AAE1B,eAAU,sBAAiB,KAAG,CAAC,CAAJ;5CAFD;AAAwB;AAKK;AAA7B;AAE1B,eAAU,2BAAsB,KAAG,CAAC,CAAJ;jDAFN;AAA6B;AAKR;AAArB;AAE1B,eAAU,mBAAc,KAAG,CAAC,CAAJ;zCAFE;AAAqB;AAzIH;AAE5C,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,wBA9zBsD,MAAyB;vBA2zBjF;PAF4C;AA8CK;AAEjD,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,wBA52BsD,MAAyB;vBAy2BjF;PAFiD;AAuJH;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,wBAngCsD,MAAyB;vBAggCjF;PAF8C;AA8CK;AAEnD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,wBAjjCsD,MAAyB;vBA8iCjF;PAFmD;AA+Eb;AAEtC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb,wBAhoCsD,MAAyB;vBA6nCjF;PAFsC;AAvaQ;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,wBAztBsD,MAAyB;vBAstBjF;PAF8C;AA8CK;AAEnD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,wBAvwBsD,MAAyB;vBAowBjF;PAFmD;AAsiBR;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,wBA7yCsD,MAAyB;vBA0yCjF;PAF2C;AAhwBR;AAEnC;AACA,UAAY,gBAAD,QAAX;lCAEE,wBAAwB,OAAX,iBAAc,wBAAH,CAAgC;zEACxD,sBAAU,OAAQ,GAAE,qBAAQ,CAAC,aAAQ,OAAM,SAAC,EAAM,GAAE,CAAxB,CAAV;nFAHpB;PAMA,+BAAqB,8BAAyB,QAAC;rEAC/C,4BAAkB,8BAAyB,QAAC;lEAC5C,wBAAc,8BAAyB,QAAC;9DACxC,0BAAgB,8BAAyB,QAAC;hEAC1C,+BAAqB,8BAAyB,QAAC;rEAC/C,4BAAkB,8BAAyB,QAAC;lEAC5C,wBAAc,gCAA2B,QAAC;hEAE1C,uBAAa;vBACb,2BAAiB;3BACjB,wBAAc;xBACd,sBAAY;tBACZ,yBAAe;zBACf,wBAAc;xBACd,sBAAY;tBACZ,uBAAa;vBACb,4BAAkB;5BAClB,wBAAc;xBACd,gCAAsB;hCACtB,wBAAc;xBACd,uBAAa;vBAEb,oBAAU;pBACV,wBAAc;xBACd,yBAAe;zBACf,6BAAmB;7BACnB,4BAAkB;5BAClB,gCAAsB;hCACtB,iCAAuB;jCACvB,qCAA2B;rCAC3B,0BAAgB;1BAChB,8BAAoB;9BACpB,+BAAqB;/BACrB,mCAAyB;nCACzB,4BAAkB;5BAClB,gCAAsB;hCACtB,iCAAuB;jCACvB,qCAA2B;rCAC3B,wBAAc,cAAG,CAAC,kBAAD,CAAM,GAAE,uBAAU,CAAC,EAAG,GAAI,EAAG,CAAX,CAAZ;9FACvB,sBAAY,eAAW,GAAE,uBAAU,CAAC,EAAG,GAAI,EAAG,CAAX,CAAZ;zEAEvB,wBAAc;xBACd,8BAAoB;9BACpB,gCAAsB;hCACtB,gCAAsB;hCAEtB,6BAAmB,cAAC,iCAAU,OAAX;nFACnB,mCAAyB,cAAC,iCAAU,OAAX;zFACzB,qCAA2B,cAAC,iCAAU,OAAX;3FAC3B,qCAA2B,cAAC,iCAAU,OAAX;3FAE3B,mCAAyB;nCAEzB,uBAAa;vBACb,6BAAmB;7BACnB,+BAAqB;/BACrB,+BAAqB;/BAErB,4BAAkB;5BAClB,kCAAwB;lCACxB,oCAA0B;pCAC1B,oCAA0B;pCAE1B,uBAAa,CAAC;xBACd,6BAAmB,CAAC;9BACpB,+BAAqB,CAAC;hCACtB,+BAAqB,CAAC;hCAEtB,4BAAkB,CAAC;7BACnB,kCAAwB,CAAC;nCACzB,oCAA0B,CAAC;rCAC3B,oCAA0B,CAAC;rCAE3B,uBAAa;vBACb,sBAAY;tBAEZ,qCAA2B;rCAC3B,uCAA6B;vCAC7B,sCAA4B;tCAC5B,oCAA0B;pCAE1B,UAAY,aAAD,QAAX,EACE,WAAM,CAAC,aAAQ,iBAAT,CADR;5EAGA,qBAAU,CAAC,KAroBsE,IAqoBvE;/BA7FyB;AAgGA;AAEnC,UAAW,CAAC,aAAD,SAAW,IAA4B,CAAvB,aAAQ,gBAAe,KAAE,IAAF,CAAlD,EACE,aAAQ,iBAAiB,CAAC,IAAD,CAD3B;nHAGA,UAAwB,CAAb,CAAC,eAAD,SAAa,IAAY,CAAC,aAAD,SAAZ,CAAuB,IAAI,CAAkB,CAAb,4CAAa,IAAG,cAAO,gBAAV,CAArE,EACE,aAAQ,qBAAqB,CAAC,gBArY0D,CAAC,CAqY5D,CAD/B;7MAGA,UAAY,aAAD,QAAX,EACE,aAAQ,qBAAqB,CAAC,IAAD,CAD/B;zEAGA,UAAY,aAAD,QAAX,EACE,aAAQ,iBAAiB,CAAC,IAAD,CAD3B;rEAGA,yBAAe;zBACf,yBAAe;zBACG,eAAlB,KAAkB;pBACH,eAAf,KAAe;pBACG,eAAlB,KAAkB;pBACH,eAAf,KAAe;pBACJ,eAAX,KAAW;pBACE,eAAb,KAAa;pBACF,eAAX,KAAW;pBACX;AACA,qBAAU,CAAC,KAhqBsE,IAgqBvE;/BACV,sBAAY;tBAzBuB;AA4BC;AAEpC,UAAY,aAAD,QAAX,EACE,aAAQ,UAAU,CAAC,IAAD,CADpB;9DAFoC;AA4rBC;AAErC;AAEA,UAAG,iBAAa,IAAuB,CAAX,CAAC,aAAD,SAAW,IAAkB,CAAb,4CAAa,IAAG,aAAQ,gBAAX,CAAlB,CAAvC,EACE,MADF;nJAGA,UAAK;VACL,UAAY,CAAD,QAAX;nBAEE,YAAY,IAAgB,YAAjB,QAAX;pCAEE,cAAG,MAAH,EACE,gBADF;tCAEA,cAAG,qBAAH,EACE,CAAC,qBAAqB,CAAC,IAAD,CADxB;xDAJF;TAQA,YAAiB,CAAb,mBAAa,GAAE,CAAF,CAAK,IAAuB,CAAX,CAAC,aAAD,SAAW,IAA0B,CAArB,aAAQ,eAAC,EAAY,GAAE,CAAF,CAA1B,CAA7C,EACE,MADF;lHAGA,SAAC;TACD,SAAC;TACD,SAAC;FAfH;PARqC;AAx6BJ;AAEjC,UAAa,uBAAH,eAAP,MAAO,CAAV;vDAEE,4BAAgB;5BAChB,2BAAuB,OAAP,OAAU,uBAAH,CAAkC;jEACzD,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,6BAAyB,OAAP,OAAU,uBAAH,CAAoC;nEAC7D,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,kCAA8B,OAAP,OAAU,uBAAH,CAAyC;xEACvE,oBAAgB,OAAP,OAAU,uBAAH,CAA2B;1DAC3C,qBAAiB,OAAP,OAAU,uBAAH,CAA4B;3DAC7C,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,wBAAoB,OAAP,OAAU,uBAAH,CAA+B;9DACnD,yBAAqB,OAAP,OAAU,uBAAH,CAAgC;/DACrD,sBAAkB,OAAP,OAAU,uBAAH,CAA6B;5DAC/C,wBAAoB,OAAP,OAAU,uBAAH,CAA+B;9DACnD,yBAAqB,OAAP,OAAU,uBAAH,CAAgC;/DACrD,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,wBAAoB,OAAP,OAAU,uBAAH,CAA+B;9DACnD,2BAAuB,OAAP,OAAU,uBAAH,CAAkC;jEACzD,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,yBAAqB,OAAP,OAAU,uBAAH,CAAgC;/DACrD,wBAAoB,OAAP,OAAU,uBAAH,CAA+B;9DACnD,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,sBAAkB,OAAP,OAAU,uBAAH,CAA6B;5DAC/C,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,0BAAuD,WAAjC,OAAP,OAAU,uBAAH,CAAiC;3EACvD,yBAAqB,OAAP,OAAU,uBAAH,CAAgC;/DACrD,yBAAqB,OAAP,OAAU,uBAAH,CAAgC;/DACrD,2BAAuB,OAAP,OAAU,uBAAH,CAAkC;jEACzD,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,+BAAiE,WAAtC,OAAP,OAAU,uBAAH,CAAsC;hFACjE,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,kCAA8B,OAAP,OAAU,uBAAH,CAAyC;xEACvE,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,kCAAuE,WAAzC,OAAP,OAAU,uBAAH,CAAyC;nFACvE,mCAA+B,OAAP,OAAU,uBAAH,CAA0C;zEACzE,uCAAmC,OAAP,OAAU,uBAAH,CAA8C;7EACjF,uCAAiF,WAA9C,OAAP,OAAU,uBAAH,CAA8C;xFACjF,sCAAkC,OAAP,OAAU,uBAAH,CAA6C;5EAC/E,sCAAkC,OAAP,OAAU,uBAAH,CAA6C;5EAC/E,4BAAwB,OAAP,OAAU,uBAAH,CAAmC;lEAC3D,gCAA4B,OAAP,OAAU,uBAAH,CAAuC;tEACnE,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,qCAAiC,OAAP,OAAU,uBAAH,CAA4C;3EAC7E,gCAAmE,WAAvC,OAAP,OAAU,uBAAH,CAAuC;jFACnE,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,qCAA6E,WAA5C,OAAP,OAAU,uBAAH,CAA4C;tFAC7E,oCAAgC,OAAP,OAAU,uBAAH,CAA2C;1EAC3E,oCAAgC,OAAP,OAAU,uBAAH,CAA2C;1EAC3E,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,kCAA8B,OAAP,OAAU,uBAAH,CAAyC;xEACvE,mCAA+B,OAAP,OAAU,uBAAH,CAA0C;zEACzE,uCAAmC,OAAP,OAAU,uBAAH,CAA8C;7EACjF,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,kCAAuE,WAAzC,OAAP,OAAU,uBAAH,CAAyC;nFACvE,sCAAkC,OAAP,OAAU,uBAAH,CAA6C;5EAC/E,uCAAiF,WAA9C,OAAP,OAAU,uBAAH,CAA8C;xFACjF,sCAAkC,OAAP,OAAU,uBAAH,CAA6C;5EAC/E,qCAAiC,OAAP,OAAU,uBAAH,CAA4C;3EAC7E,sCAAkC,OAAP,OAAU,uBAAH,CAA6C;5EAC/E,wCAAoC,OAAP,OAAU,uBAAH,CAA+C;9EACnF,uCAAmC,OAAP,OAAU,uBAAH,CAA8C;7EACjF,yCAAqC,OAAP,OAAU,uBAAH,CAAgD;/EACrF,qBAAiB,OAAP,OAAU,uBAAH,CAA4B;3DAC7C,4BAAgB;rBAtElB;PAFiC;AA4EK;AAElC,yBAAJ,IAAG;7BAFmC;AA6XF;AAEhC,yBAAJ,IAAG;7BACH,UAAiB,CAAb,mBAAa,KAAE,CAAF,CAAK,IAAI,OAA1B,EACE,eAAU,CAAC,MAAO,MAAR,CADZ;/EAHoC;AAsEH;AAAP;AAE1B,eAAU;fAFgB;AAAO;AA/DK;AAAZ;AAE1B,eAAU;fACV,UAAI,eAAS,SAAC,EAAM,GAAE,CAAtB,EACE,SAAwC,qCAA9B,eAAS,SAAC,eAAS,SAAC,EAAM,GAAE,CAAnB,CAAqB,WAD1C;1JAH0B;AAAY;AAOD;AAAX;AAE1B,eAAU;fACV,UAAI,eAAS,SAAC,EAAM,GAAE,CAAtB,EACE,SAAsB,qCAAZ,eAAS,SAAC,CAAD,CAAG,WADxB;7HAH0B;AAAW;AAtlCnB;AAiOH;AACC;AACG,gC/BxUZ,Y+BwUY;5CACC,iC/BxSX,8B+BwSW;/DACF,+B/BzST,8B+BySS;7DACA;AACA;AACC;AACE;AACD;AACI;AACJ;AACF;AACC;AACH,6BZII,YYJJ;zCACK,kCZGD,YYHC;9CACG,qCZEJ,YYFI;jDACK,0CZCT,YYDS;tDACP,mCZAF,YYAE;/CACK,wCZDP,YYCO;pDACH,qCZFJ,YYEI;jDACK,0CZHT,YYGS;tDACT,iCZJA,YYIA;7CACK,sCZLL,YYKK;lDACG,yCZNR,YYMQ;rDACK,8CZPb,YYOa;1DACP,uCZRN,YYQM;nDACK,4CZTX,YYSW;xDACH,yCZVR,YYUQ;rDACK,8CZXb,YYWa;1DACb,iCtBnJT,4CsBmJS,6BAAyD,WAAzD;rHACK,sCtBpJd,4CsBoJc,uCAAmE,uBAAC,iCAAU,OAAX,CAAnE;zLACG,yCtBrJjB,4CsBqJiB,6CAAyE,WAAzE;7IACK,8CtBtJtB,4CsBsJsB,uDAAmF,uBAAC,iCAAU,OAAX,CAAnF;jNACP,uCtBvJf,4CsBuJe,yCAAqE,WAArE;vIACK,4CtBxJpB,4CsBwJoB,mDAA+E,uBAAC,iCAAU,OAAX,CAA/E;3MACH,yCtBzJjB,4CsByJiB,6CAAyE,WAAzE;7IACK,8CtB1JtB,4CsB0JsB,uDAAmF,uBAAC,iCAAU,OAAX,CAAnF;jNACd;AACK;AACG;AACK;AACP;AACK;AACH;AACK;AACb,iCtBhLb,WsBgLa;5CACK,sCtBjLlB,WsBiLkB;jDACG,yCtBlLrB,WsBkLqB;pDACK,8CtBnL1B,WsBmL0B;zDACP,uCtBpLnB,WsBoLmB;lDACK,4CtBrLxB,WsBqLwB;vDACH,yCtBtLrB,WsBsLqB;pDACK,8CtBvL1B,WsBuL0B;zDACD;AACX,iCZrCA,YYqCA;7CACQ,yCZtCR,YYsCQ;rDACR,iCA5RO,0CA4RP;3EACe,gDZqIX,oEYrIW;pHACF,8CZoIT,oEYpIS;lHACC,+CZmIV,oEYnIU;nHACF,6CZkIR,oEYlIQ;jHACT;AACR;AACD;AAjSI;AAqSC;;;AAMjB;AANiB;;AAMjB,mBANiB;;;nBAqzCe;AAAP;AAE3B,eAAuC,YAAK,CAAC,KAAD;jCAFjB;AAAO;AAKK;AAAZ;AAE3B,eAAU;fAFiB;AAAY;AAtBN;AAEjC;AAEA,UAAK;VACL,UAAW,CAAC,CAAD,SAAI,IAAI,CAAkB,CAAb,4CAAa,IAAG,CAAC,gBAAJ,CAArC,EACE,CAAC,0BADH;1HAGU;AARuB;AAgCC;AAAP;AAE3B,eAAU;fAFiB;AAAO;AArBE;AAEpB,sDAAC,SAAU,mBAAX;lFAChB,sBAAY;tBAHwB;AAhBN;AAAH;AAE3B,eAAuC;fAFZ;AAAG;AA/xCX;AAoBO;;AACxB;AACA;AACA;AACA;;AAHA;AACA;AACA;AACA;;AAJwB;aACxB,8BACA,IACA,CADA,gBACA,IACA,CADA,gBACA,qBADA,CADA;3GAFwB;;AAWC;AAyrDe;AAAP;AAEnC,eAA4B,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAFO;AAAO;AAzrDf;AAOA;;AAOL;;;AAEpB;AAIA;AACA;AACA;AARoB;;AAMpB,mBANoB;;;nBAg/CgB;AAEtC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT;OAHF;PAFsC;AARA;AAEtC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;dAFX;PAFsC;AAiBO;AAE7C;AAEA,UAAK;VACL,UAAY,CAAD,QAAX,EACE,CAAC,oBF9uDmD,KE6uDtD;/CAL6C;AAjCR;AAAP;AAE9B,eAAU;fACV,UAAG,MAAO,KAAE,EAAZ;vBAEE,iBAAU;jBACV,YAAG,MAAO,KAAE,EAAZ,EACE,SAAkD,CAAxC,oBAAe,CAAC,uEAAD,CAAyB,GAAE,GAAF,CAAM,GAAE,qBAAQ,CAAC,eAAD,CADpE;3KAHF;PAH8B;AAAO;AAXQ;AAAf;AAE9B,eAAU;fACV,UAAgD,CAA/B,CAAN,CAAP,MAAO,KAAE,EAAF,CAAM,IAA0B,CAAtB,iCAAO,CAAC,MAAM,MAAP,CAAe,GAAE,CAAF,CAA1B,CAA+B,IAA0B,CAAtB,iCAAO,CAAC,MAAM,MAAP,CAAe,GAAE,CAAF,CAA1B,CAA+B,IAAuC,CAAnC,iCAAO,CAAC,OAAQ,sBAAS,CAAC,MAAD,CAAlB,CAA4B,GAAE,CAAF,CAAtH;jOAEE,iBAAU;jBACV,YAAG,MAAO,KAAE,EAAZ,EACE,SAAkD,CAAxC,oBAAe,CAAC,uEAAD,CAAyB,GAAE,GAAF,CAAM,GAAE,qBAAQ,CAAC,eAAD,CADpE;3KAHF;PAH8B;AAAe;AAsBR;AAAP;AAE9B,eAAU;fAFoB;AAAO;AAzCE;AAEvC;AACA,UAAY,gBAAD,QAAX,EACE,gBAAwB,OAAX,iBAAc,4BAAH,CAAoC,UAD9D;nHAGA,UAAY,aAAD,QAAX,EACE,aAAiD,CAAxC,oBAAe,CAAC,uEAAD,CAAyB,GAAE,GAAF,CAAM,GAAE,qBAAQ,CAAC,aAAQ,WAAU,SAAC,EAAM,GAAE,CAA5B,CADnE;pNAGA,mBAAS,0BAAa,CAAC,WAAO,IAAK,GAAI,cAAC,4CAAD,CAAjB;3HACtB;AAVuC;AAaA;AAEvC;AACA;AAHuC;AAvBF;AAErC,UAAa,2BAAH,eAAP,MAAO,CAAV;3DAEE,oBAAgB,OAAP,OAAU,2BAAH,CAA+B;9DAC/C,qBAAiB,OAAP,OAAU,2BAAH,CAAgC;/DACjD,qBAAiB,OAAP,OAAU,2BAAH,CAAgC;xDAJnD;PAFqC;AAh7Cf;AA8BP;AACA;AACD;AAhCQ;AAoCC;;;AAMrB;AANqB;;AAMrB,mBANqB;;;nBA2+Ce;AAAP;AAE/B,eAA2C,YAAK,CAAC,KAAD;jCAFjB;AAAO;AAKK;AAAZ;AAE/B,eAAU;fAFqB;AAAY;AAUL;AAAP;AAE/B,eAAU;fAFqB;AAAO;AArBE;AAExB,sDAAC,SAAU,mBAAX;lFAChB,sBAAY;tBAH4B;AALN;AAAH;AAE/B,eAA2C;fAFZ;AAAG;AAh+CX;AAmBJ;;;AAEjB;AAIA;AACA;AACA;AACA;AACA;AAViB;;AAMjB,mBANiB;;;nBA8zCgB;AAEnC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT;OAHF;PAFmC;AA1BS;AAE5C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB;OAHF;PAF4C;AASF;AAE1C,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB;OAHF;PAF0C;AASP;AAEnC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;dAFX;PAFmC;AAiBI;AAEvC;AAEA,UAAK;VACL,UAAY,CAAD,QAAX,EACE,CAAC,oBFnnDmD,KEknDtD;/CALuC;AAxCL;AAAP;AAE3B,eAAU;fAFiB;AAAO;AAvCE;AAEpC;AAEA;AACA,UAAY,gBAAD,QAAX,EACE,gBAAwB,OAAX,iBAAc,yBAAH,CAAiC,UAD3D;hHAEA,mBAA8C,CAArC,oBAAe,CAAC,oEAAD,CAAsB,GAAE,GAAF,CAAM,GAAE,qBAAQ,CAAC,aAAQ,QAAO,SAAC,EAAM,GAAE,CAAzB,CAAV;nLACpD,UAAG,aAAQ,QAAO,SAAC,EAAM,GAAE,CAA3B;9CAEE,8BAAkB;9BAClB,4BAAgB;;5BAIhB,cAAO,aAAQ,QAAO,WAAC,aAAQ,QAAO,SAAC,EAAM,GAAE,CAAzB;lFACtB,8BAAkB,GAAG,eAAe,GAAE,CAAF;pDACpC,4BAAgB;;5BAElB;AAnBoC;AAsBA;AAEpC;AACA;AAHoC;AAjCF;AAElC,UAAa,wBAAH,eAAP,MAAO,CAAV;xDAEE,oBAAgB,OAAP,OAAU,wBAAH,CAA4B;3DAC5C,qBAAiB,OAAP,OAAU,wBAAH,CAA6B;5DAC9C,8BAA0B,OAAP,OAAU,wBAAH,CAAsC;rEAChE,4BAAwB,OAAP,OAAU,wBAAH,CAAoC;5DAL9D;PAFkC;AAuCA;AAAP;AAE3B,eAAW;fACX,UAAG,MAAO,KAAE,EAAZ;vBAEE,iBAAU;jBACV,YAAG,MAAO,KAAE,EAAZ,EACE,SAA+C,CAArC,oBAAe,CAAC,oEAAD,CAAsB,GAAE,GAAF,CAAM,GAAE,qBAAQ,CAAC,eAAD,CADjE;xKAHF;PAH2B;AAAO;AApxCf;AAiCJ;AACA;AACS,qC/BjhBjB,Y+BihBiB;jDACF,mC/BlhBf,Y+BkhBe;/CACR;AArCK;AAyCC;;;AAMlB;AANkB;;AAMlB,mBANkB;;;nBAozCe;AAAP;AAE5B,eAAwC,YAAK,CAAC,KAAD;jCAFjB;AAAO;AAKK;AAAZ;AAE5B,eAAU;fAFkB;AAAY;AAUL;AAAP;AAE5B,eAAU;fAFkB;AAAO;AArBE;AAErB,sDAAC,SAAU,mBAAX;lFAChB,sBAAY;tBAHyB;AA9yCjB;AAmBF;;;AAEhB;AACA;AACA;AAJgB;;AAEhB,iBAFgB;jBAGhB,qBAHgB;rBAIhB,kBAJgB;;;lBA8KiB;AAEnC,iBAAM,OAAO,CAAC,KAAD;9BAFsB;AAKI;AAEvC,qBAAU,OAAO,CAAC,KAAD;lCAFsB;AAVH;AAEpC,kBAAO,OAAO,CAAC,KAAD;/BAFsB;AA/DC;AAErC;AAEA,eAAS,SAAiB,QAAZ,WAAK,SAAC,EAAM,GAAE,CAAF,qBAA1B;/EAAI;AACF,mBAAK,WAAC,CAAD,CAAG;;hCAL2B;AAlBA;AAAX;AAE1B,eAAU,wBAAmB,QAAC,YAAM,CAAC,IAAD,CAAN;jEAFJ;AAAW;AAKI;AAAf;AAE1B,eAAU,4BAAuB,QAAC,YAAM,CAAC,IAAD,CAAN;rEAFR;AAAe;AAVH;AAAZ;AAE1B,eAAU,yBAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;lEAFL;AAAY;AAnBL;AAEjC;AACA,UAAa,uBAAH,eAAP,MAAO,CAAV;vDAEE,mBAAM,OAAO,CAAS,OAAP,OAAU,uBAAH,CAA6B,OAAtC;xEACb,uBAAU,OAAO,CAAS,OAAP,OAAU,uBAAH,CAAiC,WAA1C;hFACjB,oBAAO,OAAO,CAAS,OAAP,OAAU,uBAAH,CAA8B,QAAvC;nEAJhB;PAHiC;AAWE;AAEnC;AACA,oBAAU;pBACV,wBAAc;xBACd,qBAAW;rBALwB;AAuBA;AAE3B,eAAR,KAAQ;pBACG,eAAX,KAAW;pBACJ,eAAP,KAAO;pBACP;AALmC;AAlGjB;AAoDI;AAAf;AAMP,aAAU;bANH;AAAe;AAnnBf,2BAuCY,qCACG,yCAxCf;zGAFT,GAsmBc,YAtmBd;fCAA,iCAIS,0JAJT;;;3LAiBS,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBASQ;;;AAMhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdgB;;AAMhB,kBANgB;lBAOhB,2BAPgB;3BAShB,mBATgB;nBAchB,2BAdgB;;;3BAiP2B;AAG7C,8BAAoB;9BACpB;AACA;AAL6C;AAoBR;AAErC,sBAAY;tBACZ;AAHqC;AAhCA;AAErC,mBAAQ,OAAO,CAAC,KAAD;hCACf;AAHqC;AA0BC;AAEtC,uBAAa;vBACb;AAHsC;AANF;AAEpC,qBAAW;rBACX;AAHoC;AA3BJ;AAEhC,uBAAa;vBACb;AACA;AAJgC;AANS;AAEzC,0BAAgB;1BAChB;AAHyC;AAmBL;AAEpC,kBAAO,OAAO,CAAC,KAAD;/BACd;AAHoC;AApGQ;AAAlB;AAE1B,eAAU;fAFgB;AAAkB;AAgCR;AAAV;AAE1B,eAAU,4BAAgB,CAAC,EAAS,EAAS,EAAS,CAA5B;nDAFA;AAAU;AA9FI;AAExC;AAEA,YAAO;ZACP,UAAY,GAAD,QAAX;rBAEE,YAAG,cAAU,IAAI,CAAI,uCAAa,CAAC,GAAD,CAAlC;3EAEE,cAAa,SAAR,CAAS,GAAG,SAAC,EAAb;tCACL,cAAc,UAAT,CAAU,GAAG,UAAC,EAAd;/BAHP;FAFF;PALwC;AAmGD;AAGvC;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,qBAAF,CAA1C,EACE,wBAAoB,IADtB;jIAJuC;AApFC;AAExC,UAAY,qBAAD,QAAX,EACE,qBAAe,CAAC,IAAD,CADjB;pEAGA;AACA;AANwC;AAuCL;AAAT;AAE1B,UAAG,CAAI,uCAAa,CAAC,YAAD,CAApB;hEACE,iBAAU;jBAEV,qBAAU,4CAAe,gBAAgB,CAAC,cAAS,EAAG,qBAAb;vHALjB;AAAS;AAzBA;AAEnC;AACA,UAAG,mBAAH,EACE,wBADF;vDAGA,qBAAW;rBACX,sBAAY;tBACZ,0BAAgB;1BAChB,uBAAa;vBACb,sBAAY,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;9FACjC,mBAAQ,UAAR,GAAsB;hCACtB,qBAAW,uCAAa,QAAC;pEACzB,kBAAO,UAAP,GAAqB;/BACrB,oBAAS,GAAT;vBACA,qBAAU,GAAV;xBAfmC;AAkBA;AAE3B,eAAR,KAAQ;pBACC,eAAT,KAAS;pBACT;AAJmC;AA4DJ;AAE/B;AACC;AACD;AAAG;AACH;AAAG;AAEH;AACA,UAAG,2CAAY,IAAG,oBAAlB;7EAEE,iBAAS,QAAO,QAAC,CAAQ,kEAAR;pGACjB,iBAAS,gBAAc,CAAC,4CVpBqE,6EUoBtE;pJAHzB;PAMA,YAAO;ZACP,UAAY,GAAD,QAAX;rBAEE,YAAK;ZACL,YAAK;ZACL,YAAK;ZACL,YAAK;ZACL,oDAAe,cAAc,CAAC;;;;tDAAG;;;;AAAG,GAAG,SAAC,GAAO,GAAG,UAAC,GAAQ,gBAAO,iBAAQ,kBAAa,cAAS,cAAnE;3HAC7B,YAAG,YAAO,IAAG,cAAb;1CAEE,cAAY,CAAN,eAAM,GAAE,CAAF,CAAK,GAAE,CAAF;vCACjB,cAAa,CAAP,gBAAO,GAAE,CAAF,CAAK,GAAE,CAAF;/BAHpB;TAMA,YAAK,UAAK,CAAC,CAAD;xBACV,YAAK,UAAK,CAAC,CAAD;xBAEV,gBAAc,qCAAL,+BAAK,CAAC,EAAG,EAAG,CAAE,GAAE,CAAF,CAAK,CAAE,GAAE,CAAlB;pGACd,iBAAS,aAAW,CAAC,4CAAO,4CAAkB,CAAC,GAAD,EVvB0C,KAClE,MAA0B,KAA2B,KUsBvD;3IAjBtB;PAf+B;AApLb;;;;AAmDN;AA0N+B;AAE3C;AACA,+BAAa,CAAC,iBAAD;jDAH8B;AA1N/B;AAIU;AACL,8BfqKJ,iDerKI;/EACC;AACA,+Bf4PE,wDe5PF;vFACQ,uCTLJ,oESKI;3GACR;AACC;AACF;AACE;AACJ,4BbwhBI,+DaxhBJ;3FACE,8Bb6mBI,iEa7mBJ;/FAdL;AAhFd,GAiGc,yDAjGd;5DCAA,iCAWS,0MAXT;;;3OA0CS,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBASW;;AAGJ,wEAAmB,UjC8B7B,2BiC9B6B,EAAoB,aX2DzC,qDW3DyC,EAAwB,ShBuJ1E,yCgBvJ0E,CAA/D;tOAMK;;;AAEpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvBoB;;AAIpB,iBAJoB;jBAMpB,mBANoB;nBAUpB,4BAVoB;5BAWpB,kBAXoB;lBAYpB,gBAZoB;hBAapB,8BAboB;9BAcpB,+BAdoB;/BAiBpB,yBAjBoB;zBAkBpB,wBAlBoB;xBAmBpB,6BAnBoB;7BAoBpB,0BApBoB;1BAqBpB,0BArBoB;1BAsBpB,kCAtBoB;lCAuBpB,wBAvBoB;;;xBA4iCkB;AAExC,UAAc,CAAV,YAAO,EAAG,KAAG,KAAK,EAAR,CAAY,IAAc,CAAV,YAAO,EAAG,KAAG,KAAK,EAAR,CAAxC;tEAEE,uBAAW;vBACX;OAHF;PAFwC;AAmCF;AAEtC,UAAa,CAAT,UAAK,GAAI,KAAG,KAAK,GAAR,CAAa,IAAa,CAAT,UAAK,GAAI,KAAG,KAAK,GAAR,CAAvC;tEAEE,qBAAS;rBACT;OAHF;PAFsC;AA+UE;AAExC,UAAY,CAAR,aAAQ,IAAG,gBAAH,CAAgB,IAAgB,CAAX,eAAW,IAAG,oBAAH,CAA5C,EACE,qBADF;jHAEA,UAAY,CAAR,aAAQ,IAAG,gBAAH,CAAgB,IAAK,eAAjC;hEAEE,0BAAc;nBAFhB;PAJwC;AAhWY;AAEpD,8BAAmB,OAAO,CAAC,KAAD;3CAF0B;AATT;AAE3C,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd;OAHF;PAF2C;AAcO;AAElD,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,YAAG,sBAAkB,KAAG,IAAxB,EACa,sBAAkB,uBAAuB,CAAC,IAAD,CADtD;hGAEA,iCAAqB;jCACrB,YAAG,sBAAkB,KAAG,IAAxB,EACa,sBAAkB,iBAAiB,CAAC,IAAD,CADhD;nFALF;PAFkD;AA1DF;AAEhD,6BAAmB;7BAF6B;AAKA;AAEhD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,YAAG,oBAAgB,KAAG,IAAtB,EACa,oBAAgB,uBAAuB,CAAC,IAAD,CADpD;5FAEA,+BAAmB;/BACnB,YAAG,oBAAgB,KAAG,IAAtB;zCAEa,8BAAgB,iBAAiB,CAAC,IAAD;pDAC5C;AACE,gCAAe,UAAC,CAAU,IAAV;/CAKhB,gCAAe,SAAC,CAAS,oCAAT;9EAEhB,gCAAe,WAAC,CAAW,IAAX;hDARlB;;SAHF;FALF;PAFgD;AAgYL;AAE3C,yBAAe;zBACf,UAAY,kBAAD,QAAX,EACE,kBAAY,CAAC,IAAD,CADd;9DAGA,wBAAc;xBAEd,UAAG,CAAY,CAAC,WAAD,SAAf,EACE,cAAU,6BAAM,QAAC,YAAM,CAAC,IAAD,CAAN,CADnB;xGAGA,iBAAM,YAAC,CAAY,EAAZ;hCACP,iBAAM,SAAN,GAAkB;7BAClB,iBAAM,WAAC,CAAW,IAAX;jCAboC;AANC;AAE5C,UAAY,mBAAD,QAAX,EACE,mBAAa,CAAC,IAAD,CADf;hEAF4C;AAxSD;AAE3C,oBAAS,CAAC,UAAK,CAAC,KAAK,KAAN,EAAc,UAAK,CAAC,KAAK,IAAN,EAAa,UAAK,CAAC,KAAK,MAAO,GAAE,KAAK,KAApB,EAA4B,UAAK,CAAC,KAAK,OAAQ,GAAE,KAAK,IAArB,CAA5E;3IAFkC;AA/JL;AAGtC,sBAAe,gCAAY,OAA3B;7DAEA;AACA,UAAG,iBAAY,KAAG,gCAAY,OAA9B;vEAEE,YAAY,WAAD,QAAX,EACE,WAAM,WAAC,CAAW,KAAX,CADT;vDAFF;PANsC;AA2KS;;AAQ/C;AAAI;AAAK;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AAC2B;AAAlB;AAEP;AACA;AACA;AAAG;AAQH,iBAAU;jBACV,eAAC,KAAD,GAAU,UAAK,CAAC,OAAC,KAAF;9CACf,eAAC,IAAD,GAAS,UAAK,CAAC,OAAC,IAAF;5CACd,eAAC,MAAD,GAAW,UAAK,CAAC,OAAC,MAAF;hDAChB,eAAC,OAAD,GAAY,UAAK,CAAC,OAAC,OAAF;lDA8BjB,oBAAY,KAAZ,GAAqB;5BACrB,oBAAY,IAAZ,GAAoB;3BACpB,oBAAY,MAAZ,GAAsB,MAAM;nCAC5B,oBAAY,OAAZ,GAAuB,MAAM;pCAwB7B,wBAAsB,qCAAL,+BAAK,CAAC,YAAY,KAAM,GAAE,oBAAc,MAAhB,CAAuB,YAAY,IAAK,GAAE,oBAAc,KAAhB,CAC/E,YAAY,MAAO,GAAE,oBAAc,OAAhB,CAAwB,YAAY,OAAQ,GAAE,oBAAc,QAD3D;5RAEtB,YAAG,CAAiB,CAAZ,2CAAY,IAAG,EAAH,CAApB;hEAEE,cAAK,OAAC,MAAO,GAAE,OAAC,KAAH;1CACb,cAAK,OAAC,OAAQ,GAAE,OAAC,IAAH;1CACd,cAAG,OAAC,KAAM,GAAE,aAAa,KAAzB;/CAEE,gBAAG,OAAC,KAAM,GAAsB,CAApB,aAAa,MAAO,GAAE,CAAF,CAAhC;xDAEE,qBAAC,KAAD,GAAU,aAAa,MAAO,GAAE,CAAF;pDAC9B,kBAAG,UAAW,KAAE,kCAAhB;nEAEE,6BAAc;7BACd,yBAAU;VAHZ;fAKA,kBAAG,UAAW,KAAE,wCAAhB;zEAEE,6BAAc;7BACd,yBAAU;VAHZ;FARF;;bAiBA,mBAAC,KAAD,GAAU,aAAa;xCACvB,gBAAG,UAAW,KAAE,iCAAhB;hEAEE,2BAAc;3BACd,uBAAU;VAHZ;bAKA,gBAAG,UAAW,KAAE,uCAAhB;tEAEE,2BAAc;3BACd,uBAAU;VAHZ;;bAMF,cAAG,OAAC,IAAK,GAAE,aAAa,IAAxB;7CAEE,gBAAG,OAAC,IAAK,GAAuB,CAArB,aAAa,OAAQ,GAAE,CAAF,CAAhC;xDAEE,qBAAC,IAAD,GAAS,aAAa,OAAQ,GAAE,CAAF;pDAC9B,kBAAG,UAAW,KAAE,mCAAhB;pEAEE,6BAAc;7BACd,yBAAU;VAHZ;fAKA,kBAAG,UAAW,KAAE,yCAAhB;1EAEE,6BAAc;7BACd,yBAAU;VAHZ;FARF;;bAiBA,mBAAC,IAAD,GAAS,aAAa;vCACtB,gBAAG,UAAW,KAAE,gCAAhB;/DAEE,2BAAc;3BACd,uBAAU;VAHZ;bAKA,gBAAG,UAAW,KAAE,sCAAhB;rEAEE,2BAAc;3BACd,uBAAU;VAHZ;;bAMF,iBAAC,MAAD,GAAW,OAAC,KAAM,GAAE,CAAF;1CAClB,iBAAC,OAAD,GAAY,OAAC,IAAK,GAAE,CAAF;jCAnEpB;TA3EO;AAAkB;AAkJ3B,+BAAqB;/BACrB,gBAAW;hBACX,mBAAc;nBACd,cAAS;dACT;AACE,gBAAc,qCAAL,+BAAK,CAAC,wBAAmB,OAAO,wBAAmB,MAAM,wBAAmB,QAAQ,wBAAmB,QAAlG;lNACd,YAAqB,CAAjB,sBAAiB,KAAG,IAAH,CAAQ,IAAI,wBAAmB,QAApD,EACE,QAAc,qCAAL,+BAAK,CAAC,EAAG,EAAG,sBAAgB,SAAC,GAAO,sBAAgB,UAAC,EAAhD,EADhB;1OAEA,YAA4B,CAAP,CAAjB,sBAAiB,KAAE,IAAF,CAAO,IAAI,wBAAkB,QAAtB,CAA6B,IACrD,CAAgB,CAAX,UAAW,IAAG,cAAC,sCAAY,mCAAS,yCAAe,wCAAc,6CAAnD,CAAH,CADpB;9TAUA,oCAAwB;pCAExB,YAAG,UAAW,IAAG,cAAC,iCAAO,sCAAR,CAAjB;hHACE,kDAAY,CAAC;;;;pCAAO,EAAG,oBAAc,QAAQ,GAAE,OAAO,EAA1C;zDAEZ,cAAA,wCAAY,CAAC;;;;1CAAO,EAAG,OAAO,EAAG,GAAE,oBAAc,KAArC;pDAEd,YAAG,UAAW,IAAG,cAAC,kCAAQ,uCAAT,CAAjB;lHACE,kDAAY,CAAC;;;;pCAAO,oBAAc,OAAO,GAAE,OAAO,EAAT,CAAa,CAA1C;xDAEZ,cAAA,wCAAY,CAAC;;;;1CAAO,OAAO,EAAG,GAAE,oBAAc,MAAhB,CAAuB,CAAzC;rDAEd,4BAAqB,CAAgB,CAAX,UAAW,IAAG,cAAC,sCAAY,mCAAS,yCAAe,wCAAc,6CAAnD,CAAH;lQACrC,qBAAc;rBAET;AACH,YADG,KACH;jBACE,kDAAY,CAAC;;;;pCAAO,EAAI,KAAK,OAAQ,GAAE,KAAK,IAAhC;zCACd,kBAHG,KAGH;vBACE,kDAAY,CAAC;;;;pCAAO,EAAG,CAAC,UAAU,GAAtB;/BACd,kBALG,KAKH;vBACE,kDAAY,CAAC;;;;pCAAO,CAAC,UAAU,IAAK,CAAxB;/BACd,kBAPG,KAOH;vBACE,kDAAY,CAAC;;;;pCAAQ,KAAK,MAAO,GAAE,KAAK,IAAP,CAAc,CAAnC;xCACd,kBATG,KASH;vBACE,kDAAY,CAAC;;;;pCAAkC,CAAb,CAAZ,KAAK,MAAO,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAF,CAAiC,CAAb,CAAb,KAAK,OAAQ,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAxG;/GACd,kBAXG,KAWH;vBACE,kDAAY,CAAC;;;;pCAAkC,CAAb,CAAZ,KAAK,MAAO,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAF,CAAM,KAAK,OAAQ,GAAE,KAAK,IAA9E;vFACd,kBAbG,KAaH;vBACE,kDAAY,CAAC;;;;pCAAkC,CAAb,CAAZ,KAAK,MAAO,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAF,CAAK,CAAC,UAAU,GAApE;7EACd,kBAfG,KAeH;vBACE,kDAAY,CAAC;;;;pCAAO,CAAC,UAAU,IAAiC,CAAb,CAAb,KAAK,OAAQ,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAvE;9EACd,kBAjBG,KAiBH;vBACE,kDAAY,CAAC;;;;pCAAQ,KAAK,MAAO,GAAE,KAAK,IAAP,CAA0C,CAAb,CAAb,KAAK,OAAQ,GAAE,KAAK,IAAP,CAAa,GAAE,UAAU,GAAZ,CAAiB,GAAE,CAAlF;vFACd,kBAnBG,KAmBH;vBAEI,cAAG,wBAAmB,QAAtB;9CACE,oBAAc,qCAAL,+BAAK,CAAC,wBAAmB,OAAK,MAAO,wBAAmB,OAAK,KAAM,wBAAmB,OAAK,KAAM,GAAE,UAAU,GAAZ,CAAiB,wBAAmB,OAAK,IAAK,GAAE,UAAU,GAAtJ;1QAEd,wBAA4B,qCAAnB,wBAAmB;5EAElC,aA1BG,KA0BH,4CAAS,CA1BN,KA0BM,8CAAT,KAAwB,CA1BrB,KA0BqB,6CAAxB,KAAsC,CA1BnC,KA0BmC,mDAAtC;jPAQI,kBAAc,qCAAL,+BAAK,CAAC,GAAG,GAAI,GAAG,GAAI,GAAG,EAAG,GAAE,UAAU,GAAZ,CAAiB,GAAG,EAAG,GAAE,UAAU,GAAxD;9IACd,cAAG,UAAW,KAAE,wCAAhB,EACE,wCAAY,CAAC;;;;jGAAO,CAAC,UAAU,GAAI,GAAE,CAAF,CAAK,CAAC,UAAU,GAAI,GAAE,CAA7C,CADd;rDAEA,cAAG,UAAW,KAAE,6CAAhB,EACE,wCAAY,CAAC;;;;tGAAO,CAAC,UAAU,GAAI,GAAE,CAAF,CAAK,CAAC,UAAU,GAAI,GAAE,CAA7C,CADd;rDAEA,cAAG,UAAW,KAAE,uCAAhB,EACE,wCAAY,CAAC;;;;hGAAO,EAAG,CAAC,UAAU,GAAI,GAAE,CAA5B,CADd;3BAbJ;TAkBF,YAAG,iBAAH;7BAME,wBAAoB,qBAAL,eAAK,CAAC,UAAK,CAAC,KAAK,KAAN,EAAc,UAAK,CAAC,KAAK,IAAN,CAAzB;zGAEpB,cAAG,sBAAiB,KAAG,IAAvB;7CAcE,0BAA+B,qBAAhB,sBAAgB,eAAe,CAAC,WAAD,CAAf;jGAC/B,iBAAW,qBAAL,eAAK,CAAC,UAAK,CAAC,yBAAoB,KAArB,EAA6B,UAAK,CAAC,yBAAoB,IAArB,CAAxC;1IACX,iBAAsB,qBAAhB,sBAAgB,eAAe,CAAC,EAAD,CAAf;/EACtB,qCAAoB,KAApB,GAA6B,EAAE;/CAC/B,qCAAoB,IAApB,GAA4B,EAAE;9CAC9B,iBAAW,qBAAL,eAAK,CAAC,UAAK,CAAC,yBAAoB,MAArB,EAA8B,UAAK,CAAC,yBAAoB,OAArB,CAAzC;9IACX,iBAAsB,qBAAhB,sBAAgB,eAAe,CAAC,EAAD,CAAf;/EACtB,qCAAoB,MAApB,GAA8B,EAAE;hDAChC,qCAAoB,OAApB,GAA+B,EAAE;tCAtBnC;XAyBA,kBAAc,qCAAL,+BAAK,CAAC,WAAW,GAAI,WAAW,GAAI,WAAW,EAAG,GAAE,UAAI,GAAN,CAAW,WAAW,EAAG,GAAE,UAAI,GAA5E;rKAjChB;TAmCA,kBAAW,kBAAkB,CAAC;;;;xBAAO,gCAAR;7CACzB,aAAJ,IAAG;VA7GL,QA8Gc,EAAR,OAAQ,IAAU,CAAN,KAAM,GAAE,CAAF,CAAV,CA9Gd;xCA+GA,gCAAsB;hCACtB,gCAA2B,qCAAL,+BAAK,CAAC,uBAAkB,KAAM,GAAE,oBAAe,MAAjB,CAAwB,uBAAkB,IAAK,GAAE,oBAAe,KAAjB,CAAuB,uBAAkB,MAAO,GAAE,oBAAe,OAAjB,CAAyB,uBAAkB,OAAQ,GAAE,oBAAe,QAA5L;hVAC3B,4BAAkB;5BAClB,uBAAY,CAAC,2CAAD;nEAzRmC;AAnBV;AAErC;AACA,UAAG,sBAAH,EACE,qBADF;vDAHqC;AA/FM;AAE3C;AACA,UAAG,SAAU,KAAE,+BAAf;vDAEE,YAAG,UAAW,KAAE,sBAAhB;jDAEE,mCAAqB;nCACrB;SAHF;TAKA,YAAG,UAAW,KAAE,oBAAhB,EACE,uBAAmB,IADrB;rEAPF;PAH2C;AA5CU;AAErD,UAAY,4BAAD,QAAX,EACE,4BAAuB,CAAC,IAAD,CADzB;lFAFqD;AAhFX;;AAKf;AAAlB;AAEP;AAEA,YAAK;ZACL,iBAAU;jBACV,eAAmC,CAA5B,0CAAmB,CAAC,MAAD,CAAS,KAAG,IAAH,CAAQ,IACpB,CAAR,CAAP,MAAO,KAAG,IAAH,CAAQ,IAAkC,CAA7B,MAAM,cAAc,CAAC,MAAD,CAAS,KAAG,IAAH,CAAlC,CADvB;9IAGM,WAAJ,IAAG;fACH,mBAAU,mBAAM,CAAC,QAAS,CAAC,KAAM,CAAP,CAAV;;vDAVX;AAAkB;AAc3B,mBAAQ,kBAAkB,CAAC,iBAAD,CAA1B;xDACA;AACA,mCAAyB,CAAC;pCAC1B,sBAAU;tBACV,6BAAmB;7BACnB,iCAAuB,wCAAc,QAAC;jFACtC,6BAAmB,wCAAc,QAAC;7EAClC,gBAAK,GAAL,GAAY;tBACZ,gBAAK,GAAL,GAAY;tBACZ,wBAAc;xBACd,4BAAkB;5BAClB,sBAAW,KAAX;3BACA;;AA/B0C;AAbH;AAEvC,oBAAS,CAAC,OAj0BoD,CAi0BrD;7BACT;AACE,YAAG,iBAAkB,KAAG,IAAxB,EACE,yBAAqB,iBADvB;lFAEA,YAAG,sBAAkB,KAAG,IAAxB,EACa,sBAAkB,iBAAiB,CAAC,IAAD,CADhD;1FAHF;;AAHuC;AAmEA;AAEvC,6BAAU,CAAC;;;;pBAAD;VACV,UAAG,sBAAkB,KAAG,IAAxB;zCAEa,8BAAkB,uBAAuB,CAAC,IAAD;1DACpD,iCAAqB;1BAHvB;PAKA,6BAAU,CAAC;;;;pBAAD;VACV,6BAAU,CAAC;;;;pBAAD;VACV;AAVuC;AAofM;AAE7C;AAAS;AACT;AAME,gBAAe,oBAAJ,cAAI,CAAC,eAAM,cAAK,cAAK,GAAE,eAAF,CAAS,aAAI,GAAE,gBAAhC;jJACf,yBAAoB;zBACpB;AACA,gBAAe,oBAAJ,cAAI,CAAC,eAAM,cAAK,cAAK,GAAE,eAAF,CAAS,aAAI,GAAE,gBAAhC;jJACf,UAAwG,CAAtC,CAAhC,CAAjB,CAAb,OAAO,KAAM,KAAG,OAAO,KAAV,CAAiB,IAAgB,CAAZ,OAAO,IAAK,KAAG,OAAO,IAAV,CAAhB,CAAgC,IAAmB,CAAf,OAAO,OAAQ,KAAG,OAAO,OAAV,CAAnB,CAAsC,IAAkB,CAAd,OAAO,MAAO,KAAG,OAAO,MAAV,CAAlB,CACtG,IAAqB,CAAjB,gBAAiB,KAAG,mBAAH,CADvB,EAEE,6BAFF;zOAb2C;AApdP;AAEtC;AACA,UAAS,UAAN,MAAS,EAAH,CAAT,EACE,MADF;rCAGK;AACH,WADG,KACH,YAAY,CADT,KACS,SAAZ,EAAoB,YAApB;zDAPoC;AA+BE;AAAV;AAE9B,eAAoB;fACpB,UAAG,MAAO,IAAK,CAAkB,CAAb,4CAAa,IAAG,oBAAH,CAAjC,EACE,oBADF;jHAH8B;AAAU;AAn/BlB;AA6EJ;;;AAKhB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BgB;;AAKhB,mBALgB;nBAOhB,4BAPgB;5BAQhB,qBARgB;rBAWhB,8BAXgB;9BAiBhB,wBAjBgB;xBAkBhB,mBAlBgB;nBAmBhB,yBAnBgB;zBAoBhB,0BApBgB;1BAwBhB,0BAxBgB;1BAyBhB,wBAzBgB;xBA0BhB,wBA1BgB;;;xBAwgBkB;AAEpC,UAAG,YAAQ,KAAG,KAAd;hCAEE,YAAG,2CAAY,IAAG,oBAAlB;/EAEE,yBAAW;zBACX;SAHF;TAKA,YAAG,KAAH;jBACE,6BAjdkD;;7BAodlD,cAAG,mBAAH;jCACE,2BAAU;3BAEV,+BAAW;;xBAdjB;PAFoC;AAwKY;AAEhD,8BAAmB,OAAO,CAAC,KAAD;3CAFsB;AA/VP;AAEzC,0BAAgB;1BAChB,UAAY,eAAD,QAAX,EACE,eAAU,eAAC,CAAe,iBAAf,CADb;pFAHyC;AAoWK;AAE9C,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,YAAG,sBAAkB,KAAG,IAAxB,EACE,sBAAiB,uBAAuB,CAAC,IAAD,CAD1C;hGAEA,iCAAqB;jCACrB,YAAG,mBAAH,EACE,eAAU,oBAAC,CAAoB,sBAApB,CADb;5FAEA,YAAG,sBAAkB,KAAG,IAAxB,EACE,sBAAiB,iBAAiB,CAAC,IAAD,CADpC;nFAPF;PAF8C;AAfP;AAEvC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,YAAG,mBAAH,EACE,eAAS,aAAC,CAAa,eAAb,CADZ;vEAHF;PAFuC;AA8FK;AAE5C,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,YAAG,mBAAH,EACE,eAAU,kBAAC,CAAkB,oBAAlB,CADb;jFAHF;PAF4C;AAvOH;AAEzC,qBAAW;rBACX;AAHyC;AA6CC;AAE1C,qBAAW;rBAF+B;AAKN;AAapC;AAboC;AA8ID;AAEnC,UAAW,CAAC,eAAD,SAAa,IAAI,eAAU,WAAtC,EACE,2BADF;9FAGA;AALmC;AAneM;AAEzC,UAAwB,CAAb,CAAC,eAAD,SAAa,IAAI,CAAI,eAAU,WAAlB,CAA8B,IAAI,CAAI,eAA9D;xFAEE,uBAAU,WAAC,CAAW,KAAX;xCACX,uBAAU;hBAHZ;PAFyC;AAySC;AAE1C;AAEA,UAAG,eAAW,KAAG,IAAjB;lCAEE,YAAI,mBAAc,GAAI,GAAE,CAAxB;tCACE,eAAK,GAAL,GAAY,mBAAc;xCAE1B,cAAA,KAAK,GAAL,GAAY;zBACd,YAAI,mBAAc,GAAI,GAAE,CAAxB;tCACE,eAAK,GAAL,GAAY,mBAAc;xCAE1B,cAAA,KAAK,GAAL,GAAY;zBAEd,uBAAU,QAAC,CAAQ,2CAAR;pEAXb;PAJ0C;AAgNE;AAE5C,UAAG,KAAM,KAAE,IAAX;xBAEE,YAAY,oBAAD,QAAX,EACE,oBAAe,WAAC,CAAW,IAAX,CADlB;xEAFF;PAMA,6BAAmB;7BACnB,UAAY,oBAAD,QAAX;tCAEE,4BAAe,WAAC,CAAW,KAAX;7CAChB,8BAAiB,oBAAe,SAAC,EAAjC;7DACA,+BAAkB,oBAAe,UAAC,EAAlC;xDAJF;PAT4C;AA2BA;AAE5C,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,YAAY,eAAD,QAAX,EACE,eAAS,UAAC,CAAU,UAAK,CAAC,KAAD,CAAf,CADZ;1EAHF;PAF4C;AAUD;AAE3C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,YAAY,eAAD,QAAX,EACE,eAAS,SAAC,CAAS,UAAK,CAAC,KAAD,CAAd,CADZ;zEAHF;PAF2C;AAxIN;AAAX;AAE1B,eAAU;fAFgB;AAAW;AAiBD;AAAV;AAE1B,eAAU,4BAAgB,CAAC,EAAS,EAAS,EAAS,CAA5B;nDAFA;AAAU;AAqEM;AAE1C;AAF0C;AAI1C;AACA,YAAY,oBAAD,QAAX;xCAEE,cAAG,uBAAQ,CAAC,qBAAgB,qDAAqB;;;;lGAAtC,CAAX,EACE,EAAE,gBAAC,CAAgB,kBAAhB,CADL;9CAFF;TAL0C;AAE1C;AAF0C;;AA1BN;AAEpC,UAAG,MAAH;hBACE,4BAAgB,eAAU;;3CAG1B,uBAAU;vBAOV;;AAbkC;AAzcW;AAE/C;AAEA,UAAW,CAAC,eAAD,SAAa,IAAY,CAAC,oBAAD,SAApC;rEAEE,YAAG,CAAI,eAAU,WAAjB;vCAEE,gBAAO,sCAAY,cAAc,CAAC,oBAAD;zFACjC,cAAW,CAAC,GAAD,SAAM,IAAS,CAAJ,GAAI,KAAG,eAAH,CAA1B;xDAME,eAAG;JANL;FAHF;TA0BA,YAAqB,+BAAH,eAAf,oBAAe,CAAlB;/EAEE,cAAmB,OAAf,qBAAkB,+BAAH,CAA0B,WAA7C,EACkB,OAAf,qBAAkB,+BAAH,CAAsB,WADxC;rJAFF;FA5BF;PAJ+C;AAoXX;AAGpC;AACA;AAEA,UAAY,eAAD,QAAX;jCAEE,YAAK,4CAAe,QAAC,YAAM,CAAC,eAAU,UAAC,GXzmBiB,KWymB7B,CAAN;/GACrB;AACE,WAAC,MAAK,QAAC,CAAQ,kEAAR;5FACP,WAAC,QAAO,QAAC,CAAQ,oEAAR;hGACT,WAAC,MAAK,SAAC,CAAS,4CAAe,sBAAxB;7FACP,WAAC,QAAO,SAAC,CAAS,4CAAe,wBAAxB;jGACT,cAAU,qCAAL,+BAAK,CAAC,EAAG,EAAG,eAAU,SAAC,GAAO,eAAU,UAAC,EAApC;7IACV,WAAC,gBAAc,CAAC,wCX1kB2E,6EW0kB5E;jJAEf,cAAY,kBAAD,QAAX,EACE,kBAAY,CAAC,KAAM,EAAG,uCAAV,CADd;5GARF;AAWE,WAAE,eAAF,CAAE;3BAXJ;OAHF;PANoC;AAjBG;AAGvC,UAAY,kBAAD,QAAX,EACE,kBAAY,CAAC,KAAM,UAAW,2CAAlB,CADd;pHAHuC;AA3HA;AAEvC;AACA,UAAG,SAAU,KAAE,+BAAf;vDAEE,YAAG,UAAW,KAAE,oBAAhB,EACE,uBAAmB,IADrB;5EAGA,YAAG,UAAW,KAAE,oBAAhB,EACE,uBAAmB,IADrB;5EAGA,YAAI,UAAW,KAAE,eAAjB,EACE,kBAAc,IADhB;lEAEA,YAAI,UAAW,KAAE,sBAAjB;jDAEE,mCAAqB;nCACrB,cAAG,mBAAH,EACE,eAAU,oBAAC,CAAoB,IAApB,CADb;nEAHF;FAVF;PAHuC;AA1LE;AAEzC,UAAI,eAAW,KAAG,IAAlB,EACE,eAAU,sBAAC,CAAsB,wBAAtB,CADb;nGAFyC;AAyGF;AAEvC,UAAY,kBAAD,QAAX,EACE,kBAAa,CAAC,IAAD,CADf;9DAFuC;AAsML;AAElC,UAAY,aAAD,QAAX,EACE,aAAQ,CAAC,IAAD,CADV;pDAFkC;AAaK;AAEvC,UAAY,kBAAD,QAAX,EACE,kBAAa,CAAC,IAAD,CADf;9DAFuC;AAzPF;AAErC;AAEA,UAAG,CAAI,mBAAP,EACE,MADF;tCAEA,UAAG,WAAO,IAAkB,CAAb,iBAAa,KAAE,CAAF,CAA5B;lDAEE,4BAAe,CAAf;7BACA;OAHF;PAMA,qBAAW;rBACX,UAAY,oBAAD,QAAX;tCAEE,YAAK;ZACL,4BAAe,WAAC,CAAW,KAAX;7CAKhB,YAAW,CAAC,CAAD,SAAI,IAAU,kCAAH,eAAF,CAAE,CAAtB,EACE,oBAAe,UAAC,CAAY,OAAF,EAAK,kCAAH,CAAZ,CADlB;rJARF;PAaA,UAAG,CAAkB,CAAb,4CAAa,IAAG,oBAAH,CAArB;jFAEE,YAAG,mBAAH;/BAEE,cAAW,6BAAH,eAAL,IAAK,CAAR,EACa,SAAX,KAAW,aADb;5FAEA;AACA,4BAAc;nBALhB;FAFF;PA1BqC;AA4CG;AAGxC;AAHwC;AAMxC,YAAG,YAAH,EACE,MADF;hCAGA,YAAG,mBAAH,EACE,eAAU,QADZ;xDAGA,0BAAc;1BACd;AACE;AAgBE,2BAAU,aAAC,CAAa,0CAAb;nFAGX,2BAAU,SAAV,GAAsB;vCACtB,2BAAU,cAAV,GAA2B;5CAEhB,2BAAW,iBAAiB,CAAC,IAAD;jDACvC,2BAAU,aAAC,CAAa,eAAb;xDACX,2BAAU,UAAC,CAAgB,sCAAN,gCAAM,CAAC,IAAsB,mBAAC,IAAoB,gBAA5C,EAAhB;1JACX,2BAAU,sBAAC,CAAsB,IAAwB,oBAA9C;1EACX,2BAAU,kBAAC,CAAkB,oBAAlB;lEACX;AACA,2BAAU,cAAV,GAA2B;5CAC3B,2BAAU,cAAV,GAA2B;5CAC3B,2BAAU,eAAV,GAA4B;7CAC5B,2BAAU,SAAV,GAAsB;vCACtB,2BAAU,QAAV,GAAqB;tCACrB,2BAAU,WAAV,GAAyB;zCAEzB,2BAAU,kBAAC,CAAkB,oBAAlB;lEAEX,gBAAG,uBAAQ,CAAC,qBAAiB,qDAAqB;;;;lGAAvC,CAAX,EACE,EAAE,gBAAC,CAAgB,kBAAhB,CADL;zDAQA,gBAAY,oBAAD,QAAX,EACE,oBAAe,SAAC,CAAS,sCAAT,CADlB;nHA7CF;;AADF;AAoDE,iCAAU,CAAC;;;;pBAAD;dACV;AArDF;AAwDA,YAAI,CAAkB,CAAb,4CAAa,IAAG,oBAAH,CAAtB,EACE,eAAU,eADZ;nHAGA,sBAAS,CAAC,UAAD;jCAxE+B;AAGxC;AAHwC;;AA4PG;AAAjB;AAE1B,eAAU;fAFgB;AAAiB;AAPR;AAAT;AAE1B,eAAU;fACV,UAAG,CAAY,CAAC,MAAD,SAAS,IAAe,+BAAH,eAAP,aAAO,CAApC,EACE,SAAiB,OAAP,cAAU,+BAAH,CADnB;3JAH0B;AAAS;AA9VM;AAAf;AAE1B;AACA;AAEA,gBAAW;hBACX;AACE,cAAO;dAKP,kBAAW,GAAG,QAAC,YAAM,CAAC,KAAM,sBAAP,CAAN;tEANjB;AASE,+BAAU,CAAC;;;;pBAAD;ZACV;AAVF;AAYA,eAAU;fAlBgB;AAAe;AAvFN;AAEnB,oFAAC,MAAD;1FAChB,sBAAU;tBACV,wBAAc;xBACd,wBAAc;xBACd,wBAAc;xBACd,iCAAuB,wCAAc,QAAC;jFACtC,8BAAmB,UAAnB,GAAiC;3CARE;AAsVF;AAEjC,UAAa,uBAAH,eAAP,MAAO,CAAV;vDAEE,4BAAwB,OAAP,OAAU,uBAAH,CAAmC;lEAC3D,8BAA+D,qCAArC,OAAP,OAAU,uBAAH,CAAqC;zGAC/D,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,8BAA0B,OAAP,OAAU,uBAAH,CAAqC;pEAC/D,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,iCAA6B,OAAP,OAAU,uBAAH,CAAwC;vEACrE,0BAAsB,OAAP,OAAU,uBAAH,CAAiC;hEACvD,gCAAmB,OAAO,CAAS,OAAP,OAAU,uBAAH,CAA0C,oBAAnD;lGAC1B,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;rEACjE,+BAA2B,OAAP,OAAU,uBAAH,CAAsC;9DAdnE;PAFiC;AA3UE;AAEnC,6BAAmB;7BACnB;AACA,UAAG,mBAAH;7BAEE,+BAAU,CAAC;;;;pBAAD;LAFZ;PAIA,6BAAU,CAAC;;;;pBAAD;VAIV;AAZmC;AAiEG;AAAZ;AAE1B,eAAU,eAAW,KAAG,IAAH;vCAFK;AAAY;AAqNA;AAAZ;AAE1B,eAAU;fACV,UAAY,eAAD,QAAX,EACE,SAAU,oCAAU,CAAC,+BAAK,CAAC,eAAU,QAAC,GAAM,eAAU,OAAC,GAAK,eAAU,QAAC,EAAK,GAAE,eAAU,SAAC,EAAb,CAAoB,eAAU,OAAC,EAAI,GAAE,eAAU,UAAC,EAAlG,EAA2G,MAAjH,CADtB;1RAH0B;AAAY;AAjgBpB;AAqGN;AAyQ+B;AAE3C;AACA,+BAAa,CAAC,iBAAD;jDAH8B;AAzQ/B;AAaQ;AACK,sCxBpCnB,WwBoCmB;jDACD,qCxBrClB,WwBqCkB;hDACG,wCxBtCrB,WwBsCqB;nDACP,iCA5MC,oCA4MD;rEACS,0ChB0Bf,kDgB1Be;5FACF,wCtB5FnB,yCsB4FmB;jFACF,sCxB1CnB,WwB0CmB;jDACA,sCtB9FjB,yCsB8FiB;/EACA,sCtB/FjB,yCsB+FiB;/EACF,oCtBtIX,6CsBsIW;jFACA,oCAhNN,gCAgNM;pEACL,+BtBxIN,6CsBwIM;5EACK,oCtBzIX,6CsByIW;jFACL;AA3BN;AAuCsB;AA+xCqB;AAQvD;AARuD;AA/xCrB;AA2BJ;AA2sC+B;;AAuBb;AA6BhD,qBAAW;rBA7BqC;AALO;AAAjB;AAEtC,eAAU;fAF4B;AAAiB;AAXR;AAE/C;AACA,wBAAa;xBAHkC;AAMA;AAE/C;AAF+C;AAxtCjB;AAcN;AAi2CmB;AAE3C;AAF2C;AAKF;AAEzC,wBAAa,CAAC,KAAD;9BAF4B;AAt2CjB;AAKC,sCtB9JjB,yCsB8JiB;/EACL,iCAjRC,oCAiRD;rEACS,0ChB3Cf,kDgB2Ce;5FACF,wCtBjKnB,yCsBiKmB;jFARH;AAjU1B,GA4Uc,mEA5Ud;tECAA,sCAIS,UAJT;;;hDAQqB,6BAAmH,CAAhH,kHAAgH,GAChH,4FADgH,CACtB,GAC1F,kDAD0F;rSAExF,kCAAG;lCAEP,8BAAkH,CAA/G,iHAA+G,GAC/G,iHAD+G,CACA,GAC/G,wDAD+G;hUAI9G,kCAA8G,CAA3G,6GAA2G,GAC3G,8GAD2G,CACA,GAC3G,8CAD2G;nTAEzG,uCAAG;vCAEV,gCAAiH,CAA9G,gHAA8G,GAC9G,gHAD8G,CACA,GAC9G,gCAD8G;xSAEhH,iCAAgH,CAA7G,8GAA6G,GAC7G,8GAD6G,CACA,GAC7G,uEAD6G;5UAYzI;AAEE,2CAAa,mBAAmB,CAAC,wBAAD;vFAChC,2CAAa,mBAAmB,CAAC,yBAAD;xFAChC,2CAAa,mBAAmB,CAAC,6BAAD;5FAChC,2CAAa,mBAAmB,CAAC,2BAAD;1FAChC,2CAAa,mBAAmB,CAAC,4BAAD;3FANlC;AAvCA,GAiCc,qBAjCd;xBCAA,2BAES,iDAFT;;;5EAaW;;;AAEP;AACA;AAGA;AANO;;AAGP,iBAHO;jBAMP,mBANO;;;nBA6FgB;AAAR;AAEjB,UAAG,WAAO,KAAE,IAAZ;9BACE,iBAAU;jBAEV,qBAAU,WAAM,SAAC;zCALF;AAAQ;AA7FhB;AAgBS;AACF,6B9B6EX,2B8B7EW;xDACA,6BnCRT,YmCQS;zCACE,+BxBkGN,6CwBlGM;5EAnBT;AAbX;ACAA,mCAeS,gSAfT;;;nUA4CS,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBAiB0B;;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBkC;;AAElC,iBAFkC;jBAGlC,uBAHkC;vBAIlC,oBAJkC;pBAKlC,sBALkC;tBAMlC,sBANkC;tBAOlC,wBAPkC;xBAQlC,wBARkC;xBASlC,0BATkC;1BAUlC,qBAVkC;rBAWlC,mBAXkC;nBAelC,uBAfkC;vBAiBlC,oBAjBkC;;;pBA28KwB;AAE5D,wBAAa,OAAO,CAAC,KAAD;rCAFwC;AAKE;AAG9D,0BAAe,OAAO,CAAC,KAAD;vCAHwC;AAMN;AAExD,oBAAS,OAAO,CAAC,KAAD;jCAFwC;AAKE;AAG1D,sBAAW,OAAO,CAAC,KAAD;nCAHwC;AAoCD;AAEzD,qBAAU,OAAO,CAAC,KAAD;lCAFwC;AAKE;AAG3D,uBAAY,OAAO,CAAC,KAAD;pCAHwC;AAYD;AAE1D,sBAAW,OAAO,CAAC,KAAD;nCAFwC;AAKE;AAG5D,wBAAa,OAAO,CAAC,KAAD;rCAHwC;AAvRL;AAEvD,UAAY,UAAT,cAAY,KAAH,CAAZ;xCAEE,wBAAY;xBACZ;OAHF;PAFuD;AASC;AAExD,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb;OAHF;PAFwD;AAmQG;AAG3D,uBAAY,OAAO,CAAC,KAAD;pCAHwC;AAiBI;AAG/D,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB;OAHF;PAH+D;AAUJ;AAG3D,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB;OAHF;PAH2D;AA/FC;AAAhB;AAE5C,eAAU,cAAS,KAAG,CAAH;nCAFyB;AAAgB;AA2BH;AAEzD;AACA;AAEA,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,YAAY,WAAD,QAAX;/BAEE,mBAAS,SAAyB,QAApB,WAAM,iBAAC,EAAa,GAAE,CAAF,qBAAlC;3FAAI;AAEF,gBAAK,WAAM,YAAS,CAAC,CAAD;zCAMpB,gBAAQ,gCAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,gCAAH,CAAuD,YAAb,aAAC,CAAa,eAAb,CADhD;vJAGA,gBAAQ,yBAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,yBAAH,CAAgD,YAAb,aAAC,CAAa,eAAb,CADzC;;hIAbJ;TAkBA;OArBF;PALyD;AAhCD;AAExD;AAFwD;AAjLE;AAE1D;AAF0D;AA4GN;AAEpD,UAAY,WAAD,QAAX;7BACE,mBAAM;nBACH,gBAAY,cAAD,QAAX,EACH,cAAQ,CAAC,IAAD,CADL;5DAJ+C;AAtBD;AAEnD,UAAa,yCAAH,eAAP,MAAO,CAAV;zEAEE,wBAAW,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAoD,YAA7D;pGAClB,0BAAa,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAsD,cAA/D;xGACpB,uBAAU,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAmD,WAA5D;lGACjB,sBAAS,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAkD,UAA3D;hGAChB,0BAAa,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAsD,cAA/D;xGACpB,4BAAe,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAwD,gBAAjE;5GACtB,yBAAY,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAqD,aAA9D;tGACnB,wBAAW,OAAO,CAAS,OAAP,OAAU,yCAAH,CAAoD,YAA7D;pGAClB,yBAAqB,OAAP,OAAU,yCAAH,CAAkD;jFACvE,wBAAqE,WAAjD,OAAP,OAAU,yCAAH,CAAiD;3FACrE,gCAA4B,OAAP,OAAU,yCAAH,CAAyD;xFACrF,4BAAwB,OAAP,OAAU,yCAAH,CAAqD;pFAC7E,0BAAsB,OAAP,OAAU,yCAAH,CAAmD;3EAGzE;PAnBiD;AA8BE;AAErD,oBAAU;pBACV,sBAAY,cAAC,kEAAW,mEAAY,qEAAc,qEAAtC;nTACZ,uBAAa;vBACb,0BAAgB;1BAChB,8BAAoB;9BACpB,wBAAc;xBAEd,yBAAe,qDAAmB,QAAC,YAAM,CAAC,sEjB/1JiE,QiB+1JlE,CAAN;lLACnC,wBAAc,qDAAmB,QAAC,YAAM,CAAC,sEjBh2JkE,QiBg2JnE,CAAN;jLAClC,uBAAa,qDAAmB,QAAC,YAAM,CAAC,sEjBj2JmE,QiBi2JpE,CAAN;hLACjC,2BAAiB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;jLACrC,2BAAiB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;pLACvC,0BAAgB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;pLACtC,0BAAgB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;nLACtC,yBAAe,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;lLACrC,6BAAmB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;tLAEzC,sBAAW,WAAX,GAA0B;pCAC1B,qBAAU,WAAV,GAAyB;nCACzB,oBAAS,WAAT,GAAwB;lCACxB,wBAAa,WAAb,GAA4B;tCAE5B,uBAAY,WAAZ,GAA2B;rCAC3B,wBAAa,WAAb,GAA4B;tCAC5B,uBAAY,WAAZ,GAA2B;rCAC3B,sBAAW,WAAX,GAA0B;pCAC1B,0BAAe,WAAf,GAA8B;xCAE9B,sBAAW,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;hGACZ,sBAAW,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;lGACZ,sBAAW,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;tGACZ,sBAAW,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;xGAEZ,qBAAU,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;/FACX,qBAAU,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;jGACX,qBAAU,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;rGACX,qBAAU,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;vGAEX,oBAAS,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;9FACV,oBAAS,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;hGACV,oBAAS,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;pGACV,oBAAS,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;tGA3C2C;AA8CA;AAEzC,eAAZ,KAAY;pBACD,eAAX,KAAW;pBACD,eAAV,KAAU;pBACI,eAAd,KAAc;pBAED,eAAb,KAAa;pBACC,eAAd,KAAc;pBACD,eAAb,KAAa;pBACD,eAAZ,KAAY;pBACI,eAAhB,KAAgB;pBAChB;AAZqD;AAl7KjB;AA0DN;;AAER;AACI;AACP,iC1BtHb,W0BsHa;5CACD,+BjB0uBI,kEiB1uBJ,yBAvBgE,uBAAC,kEAAW,mEAAY,qEAAc,qEAAtC,CAuBhE;jaACI,mCjB2kBD,iEiB3kBC;pGACD,kCjBofF,+DiBpfE;jGACE,oCjBykBF,iEiBzkBE;rGACH,iCjBkfD,+DiBlfC;hGACE,mCjBukBD,iEiBvkBC;pGACH,gCjBgfA,+DiBhfA;/FACE,kCjBqkBA,iEiBrkBA;nGACE,oCjB8eJ,+DiB9eI;nGACE,sCjBmkBJ,iEiBnkBI;vGACL;AAfU;AAkBC;;AAEV,kCjBueF,+DiBveE;jGACE,oCjB4jBF,iEiB5jBE;rGACH,iCjBqeD,+DiBreC;hGACE,mCjB0jBD,iEiB1jBC;pGACH,gCjBmeA,+DiBneA;/FACE,kCjBwjBA,iEiBxjBA;nGACE,oCjBieJ,+DiBjeI;nGACE,sCjBsjBJ,iEiBtjBI;vGACL;AAVW;AAaQ;;AAElB,kCjB0dF,+DiB1dE;jGACE,oCjB+iBF,iEiB/iBE;rGACH,iCjBwdD,+DiBxdC;hGACE,mCjB6iBD,iEiB7iBC;pGACH,gCjBsdA,+DiBtdA;/FACE,kCjB2iBA,iEiB3iBA;nGACE,oCjBodJ,+DiBpdI;nGACE,sCjByiBJ,iEiBziBI;vGACL;AAVmB;AAab;;AAEC;;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AARyB;;AAGzB,2BAHyB;3BAIzB,kCAJyB;;;lCA4oMiB;AAG5C,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV;OAHF;PAH4C;AATM;AAElD,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB;OAHF;PAFkD;AA8BH;;AAKE;AAEjD,UAAW,CAAC,qBAAD,SAAkB,IAAI,CAAI,iBAArC,EACE,qBAAe,CAAC,IAAD,CADjB;5FAFiD;AAZE;AAGnD;AACA;AAJmD;AA7BS;AAE5D;AACA;AAH4D;AApDlB;AAE1C;AACA,UAAa,gCAAH,eAAP,MAAO,CAAV;hEAEE,sBAAkB,OAAP,OAAU,gCAAH,CAAsC;rEACxD,4BAAwB,OAAP,OAAU,gCAAH,CAA4C;3EACpE,wBAAoB,OAAP,OAAU,gCAAH,CAAwC;hEAJ9D;PAH0C;AAWE;AAE5C;AACA;AAOA,0BAAgB;1BAChB,sBAAY;tBACZ,oBAAU;pBAZkC;AA4BA;AAE5C;AAF4C;AAhnMjB;AAwCO;;AAER;;AAGC;;;AAMzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAO;AAAQ;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlDyB;;AASzB,iBATyB;jBAczB,sBAdyB;tBAezB,2BAfyB;3BAgBzB,mBAhByB;nBAkBzB,2BAlByB;3BAmBzB,kBAnByB;lBAoBzB,4BApByB;5BAwBzB,2BAxByB;3BAyBzB,sBAzByB;tBAgCzB,2BAhCyB;3BAiCzB,wBAjCyB;xBA8CzB,8BA9CyB;9BA+CzB,mCA/CyB;nCAgDzB,sCAhDyB;;;tCAkzJsB;AAGjD,sBAAW,OAAO,CAAC,KAAD;nCAH+B;AA+BK;AAGtD,8BAAoB;9BACpB;AACA;AALsD;AAfR;AAE9C,mBAAQ,OAAO,CAAC,KAAD;hCAF+B;AAkJH;AAE3C,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT,4BAAgB,KAAM,KAAG,EAAH;xCACtB;AACA;OALF;PAF2C;AAzlCU;AAErD,6BAAmB;7BACnB,UAAW,CAAC,WAAD,SAAS,IAAI,CAAI,uBAA5B,EACE,WAAM,kBAAC,CAAkB,oBAAlB,CADT;hHAHqD;AAOD;AAEpD,4BAAkB;5BAClB,UAAY,WAAD,QAAX,EACE,WAAM,iBAAC,CAAiB,mBAAjB,CADT;hFAHoD;AAi+BA;AAEpD,4BAAkB;5BAClB;AACA;AAJoD;AA4HF;AAElD,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB;AACA;OAJF;PAFkD;AAtlCP;AAE3C,kBAAK,OAAO,CAAC,KAAD;/BAF+B;AAnDW;AAEtD,8BAAoB;9BACpB,UAAY,qBAAD,QAAX;vCAEE,YAAG,CAAiB,CAAZ,2CAAY,IAAG,oBAAH,CAApB;lFAEE,cAAY,WAAD,QAAX;jCAEE,uBAAM,kBAAC,CAAkB,qBAAlB;/DACP,uBAAM,gBAAN,GAAyB;/BAH3B;FAMG,UAAI,2CAAY,IAAG,oBAAnB;tFAEH,iCAAkB,qBAAgB,UAAC,EAAnC;lEACA,gCAAiB,qBAAgB,SAAC,EAAlC;vDAHG;FAVP;PAHsD;AA8uBG;AAAtB;AAEnC,eAAU,oBAAe,KAAG,GAAH;3CAFU;AAAsB;AAKD;AAArB;AAEnC,eAAU,mBAAc,KAAG,GAAH;1CAFW;AAAqB;AA3rBE;AAG1D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB;OAHF;PAH0D;AAqmCF;AAGxD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB;OAHF;PAHwD;AAUL;AAEnD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB;OAHF;PAFmD;AApBJ;AAG/C,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb;OAHF;PAH+C;AA1aM;AAAlB;AAEnC,eAAU,gBAAW,KAAG,EAAH;tCAFc;AAAkB;AAwQJ;AAEjD,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf;AACA;OAJF;PAFiD;AAmIC;AAElD,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB;AACA;OAJF;PAFkD;AAtrCI;AAEtD,2BAAgB,OAAO,CAAC,KAAD;xCAF+B;AAeH;AAEnD,wBAAa,OAAO,CAAC,KAAD;rCAF+B;AA6pBE;AAAlB;AAEnC,eAAU;fAFyB;AAAkB;AAsfL;AAEhD,UAAG,iBAAW,KAAG,KAAjB;rCAEE,4BAAc;5BACd;OAHF;PAFgD;AA3kCQ;AAGxD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,YAAY,WAAD,QAAX;/BAEE,cAAG,uBAAH;rCACE,uBAAM,iBAAC,CAAiB,eAAjB;xDAEA,gBAAP,WAAM,iBAAC,CAAiB,mBAAjB;vDALX;FAHF;PAHwD;AAolCI;AAG5D,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B;AACA;OAJF;PAH4D;AAtGP;AAGrD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB;OAHF;PAHqD;AA7hCD;AAGpD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB;OAHF;PAHoD;AAUA;AAGpD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB;OAHF;PAHoD;AA4kCP;AAG7C,UAAG,YAAQ,KAAG,KAAd;hCAEE,uBAAW;vBACX;OAHF;PAH6C;AAkBO;AAGpD,UAAG,mBAAe,KAAG,KAArB,EACE,sBAAkB,KADpB;pEAHoD;AAtVY;AAA7B;AAEnC,eAAU,2BAAsB,KAAG,EAAH;jDAFG;AAA6B;AAuSP;AAGzD,8BAAmB,OAAO,CAAC,KAAD;3CAH+B;AAMG;AAG5D,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B;AACA;OAJF;PAH4D;AAWK;AAGjE,sCAA2B,OAAO,CAAC,KAAD;nDAH+B;AAMH;AAG9D,mCAAwB,OAAO,CAAC,KAAD;hDAH+B;AApFT;AAErD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB;AACA;OAJF;PAFqD;AAkDW;AAGhE,UAAG,+BAA2B,KAAG,KAAjC;nDAEE,0CAA8B;1CAC9B;AACA;OAJF;PAHgE;AAnrCZ;AAAjB;AAEnC,eAAU;fAFyB;AAAiB;AAo1BV;AAAP;AAEnC,eAAU;fAFyB;AAAO;AAyBI;AAAX;AAEnC;AACA;AAEA,YAAM,GAAN,GAAa;lBACb,YAAM,GAAN,GAAa;lBACb,UAAG,iBAAY,IAAU,CAAL,cAAK,KAAG,EAAH,CAAzB;tDAEE,YAAK,4CAAe,QAAC,sBAAkB,CAAC,EAAG,EAAG,mBd9lJ+E,Ic8lJtF,CAAlB;nHACrB,SAAC,iBAAD,GAAqB;7BACrB,SAAC,sBAAD,GAA0B;lCAC1B;AACE,cAAK;dACL,iDAAa,CAAC;;;;nCAAG,CAAC,EAAG,CAAC,CAAT;pBACb,mBAAW,qCAAD,CAAC,kBAAkB,CAAC,eAAM,wCAAG,mBdl/IqG,Ick/I/G,CAAlB;3JAHb;AAKE,WAAE,eAAF,CAAE;3BALJ;OALF;PAPmC;AAAW;AAkec;AAE5D;AACA,UAAG,YAAO,KAAE,wCAAZ,EACE,kBAAc,gBADhB;vGAH4D;AAx7Cd;AAE9C;AAEA;AACA,UAAK;VACL,UAAG,wCAAa,4BAA4B,CAAC;;;;rEAAD,CAA5C;XAEE,wBAAU,YAAW,SAAC,CAAS,CAAT;/CACtB,wBAAU,YAAW,QAAC,CAAQ,kEAAR;/GACtB,wBAAU,cAAa,SAAC,CAAS,uCAAK,CAAC,EAAG,SAAY,EAAhB,CAAd;tGACxB,wBAAU,cAAa,QAAC,CAAQ,kEAAR;jHACxB,wBAAU,aAAY,SAAC,CAAS,uCAAK,CAAC,gBAAU,YAAW,QAAQ,gBAAU,cAAa,QAAQ,EAA7D,CAAd;pKACvB,wBAAU,aAAY,QAAC,CAAQ,oEAAR;3GAPzB;PAUA,UAAK;VACL,UAAG,wCAAa,sBAAsB,CAAC;;;;/DAAD,CAAtC,EACE,YAAI,SAAC,CAAS,CAAT,CADP;rCAGA,UAAK;VACL,UAAG,wCAAa,8BAA8B,CAAC;;;;vEAAD,CAA9C;XAEE,wBAAU,cAAa,SAAC,CAAS,CAAT;jDACxB,wBAAU,YAAW,SAAC,CAAS,CAAT;/CACtB,wBAAU,gBAAe,SAAC,CAAS,CAAT;nDAC1B,wBAAU,cAAa,SAAC,CAAS,CAAT;jDACxB,wBAAU,YAAW,SAAC,CAAS,CAAT;/CACtB,wBAAU,gBAAe,SAAC,CAAS,CAAT;nDAC1B,wBAAU,aAAY,SAAC,CAAS,CAAT;zCARzB;PAWA,UAAK;VACL,UAAG,wCAAa,2BAA2B,CAAC;;;;pEAAD,CAA3C;XAEE,wBAAU,WAAU,SAAC,CAAS,CAAT;9CACrB,wBAAU,WAAU,QAAC,CAAQ,kEAAR;9GACrB,wBAAU,UAAS,SAAC,CAAS,uCAAK,CAAC,EAAG,UAAI,QAAQ,EAAhB,CAAd;3GACpB,wBAAU,UAAS,QAAC,CAAQ,kEAAR;tGALtB;PAjC8C;AA2pCS;AAEvD;AACA,kBAAI,SAAC,CAAS,CAAT;7BACL,sBAAU,YAAW,SAAC,CAAS,QAAT;pDACtB,sBAAU,WAAU,SAAC,CAAS,QAAT;nDACrB,sBAAU,UAAS,SAAC,CAAS,QAAT;lDACpB,sBAAU,cAAa,SAAC,CAAS,QAAT;tDACxB,sBAAU,cAAa,SAAC,CAAS,OAAT;rDACxB,sBAAU,aAAY,SAAC,CAAS,QAAT;rDACvB,sBAAU,aAAY,SAAC,CAAS,OAAT;pDACvB,sBAAU,YAAW,SAAC,CAAS,OAAT;nDACtB,sBAAU,gBAAe,SAAC,CAAS,OAAT;vDAE1B,sBAAU,YAAW,QAAC,CAAQ,qEAAR;hHACtB,sBAAU,WAAU,QAAC,CAAQ,qEAAR;/GACrB,sBAAU,UAAS,QAAC,CAAQ,qEAAR;9GACpB,sBAAU,cAAa,QAAC,CAAQ,kEAAR;/GACxB,sBAAU,cAAa,QAAC,CAAQ,oEAAR;jHACxB,sBAAU,aAAY,QAAC,CAAQ,oEAAR;hHACvB,sBAAU,aAAY,QAAC,CAAQ,oEAAR;hHACvB,sBAAU,YAAW,QAAC,CAAQ,oEAAR;/GACtB,sBAAU,gBAAe,QAAC,CAAQ,oEAAR;nHAE1B,sBAAU,YAAW,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;5GACtB,sBAAU,YAAW,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;9GACtB,sBAAU,YAAW,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;lHACtB,sBAAU,YAAW,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;pHAEtB,sBAAU,WAAU,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;3GACrB,sBAAU,WAAU,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;7GACrB,sBAAU,WAAU,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;jHACrB,sBAAU,WAAU,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;nHAErB,sBAAU,UAAS,SAAC,CAAS,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA1B;1GACpB,sBAAU,UAAS,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;5GACpB,sBAAU,UAAS,eAAC,CAAe,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAhC;hHACpB,sBAAU,UAAS,iBAAC,CAAiB,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAAlC;lHArCmC;AAkEJ;AAEnD;AACA,UAAY,WAAD,QAAX,EACE,WAAM,gBAAC,CAAgB,sBAAhB,CADT;lFAHmD;AAzoCD;AAElD;AAEA,YAAO,4CAAe,gBAAgB,CAAC,cAAS,EAAG,yBAAb;lHACtC,4BAAyB,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAApD;1FAEA,UAAG,CAAI,mBAAc,IAAY,CAAP,YAAO,KAAE,wCAAF,CAAjC;7FAEE,cAAO,4CAAe,gBAAgB,CAAC,yBAAoB,EAAG,yBAAxB;/HACtC,8BAAyB,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAApD;rFAHF;PAMA;AAbkD;AAynBD;AAEjD;AAFiD;AAkvBD;AAEhD;AACA;AAEA,UAAW,CAAP,YAAO,KAAE,uCAAF,CAAW,IAAG,iBAAzB,EACE,MADF;jGAGA,0BAAgB;1BACX;AACH,UADG,KACH;fAEE,4BAAe,KAAf;jCACA,+BAAkB,+CAAlB;9EACA,4BAAe,KAAf;jCACA,uBAAU,UAAK,CAAC,oBAAc,GAAE,CAAjB,CAAf;3DACA,sBAAS,UAAK,CAAC,oBAAc,GAAE,CAAjB,CAAd;nDAEF,UATG,KASH;tBAEE,4BAAe,IAAf;hCACA,+BAAkB,+CAAlB;9EACA,4BAAe,KAAf;jCACA,aAAM;bACN,YAAG,mBAAH;/BAEE,yBAAU,UAAK,CAAC,QAAG,CAAC,qBAAe,EAAE,GAAlB,CAAuB,GAAE,CAA7B,CAAf;7EACA,wBAAS,UAAK,CAAe,CAAd,oBAAc,GAAE,EAAE,GAAJ,CAAQ,GAAE,EAAzB,CAAd;9DAEG,UAAG,iBAAY,IAAU,CAAL,cAAK,KAAG,EAAH,CAAzB;/DAEH,yBAAU,UAAK,CAAC,EAAE,GAAI,GAAE,CAAT,CAAf;9CACA,wBAAS,UAAK,CAAC,EAAE,GAAI,GAAE,CAAT,CAAd;;7CAIA,wBAAS,EAAT;1BACA,yBAAU,EAAV;;pBAGJ,UA/BG,KA+BH;tBAEE,4BAAe,IAAf;hCACA,+BAAkB,8CAAlB;7EACA,4BAAe,CAAI,mBAAnB;hDAEA,aAAM;bACN,YAAK;ZACL,YAAG,mBAAH,EACE,IAAK,QAAG,CAAC,EAAG,+BAAyB,GAAE,CAA/B,CADV;pFAGA,YAAG,iBAAY,IAAU,CAAL,cAAK,KAAG,EAAH,CAAzB,EACE,IAAK,QAAG,CAAC,EAAG,EAAE,GAAI,GAAE,EAAZ,CADV;pFAGA,sBAAS,UAAK,CAAC,CAAD,CAAd;nCAEA,YAAG,eAAW,KAAG,CAAC,CAAlB,EACE,eAAU,UAAK,CAAC,eAAD,CAAf,CADF;xEAhBF;PAoBF,0BAAgB;1BAEhB;AA9DgD;AA1SA;AAEhD,UAAY,qBAAD,QAAX,EACE,qBAAe,CAAC,IAAD,CADjB;pEAFgD;AA1sBL;AAE3C;AAF2C;AAiiBQ;;AAohBJ;AAE/C;AAEA;AACK;AACH,UADG,KACH;fAAU,YAAK;ZACf,gBAFG,KAEH;rBAAS,YAAK;;ZAEZ,YAAK;;ZAGT,UAAG,CAAe,CAAV,yCAAU,IAAG,oBAAH,CAAlB;9EAEE,8BAAiB,mBAAc,GAAE,CAAjC;rDACA,+BAAkB,oBAAe,GAAE,CAAnC;vDAMA,oBAAI,QAAC,CAAQ,UAAK,CAAC,YAAI,MAAM,GAAE,CAAb,CAAb;/DACL,sBAAS,CAAC,eAAM,cAAK,UAAK,CAAC,eAAM,GAAE,CAAT,EAAa,UAAK,CAAC,gBAAO,GAAE,CAAV,CAAnC;7GAVX;PAZ+C;AArgDM;AAErD;AAFqD;AA+kCL;AAGhD;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,qBAAF,CAA1C,EACE,wBAAoB,IADtB;jIAGA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,qBAAF,CAA1C,EACE,wBAAoB,IADtB;jIAPgD;AAmRL;AAE3C;AAEA,mBAAgD,CAAlC,CAAe,CAAV,yCAAU,IAAG,oBAAH,CAAmB,IAAU,CAAL,UAAK,KAAE,cAAF,CAAV,CAAkB,IACZ,CAA7B,CAArB,CAAY,CAAC,WAAD,SAAS,IAAG,CAAc,sBAAH,eAAN,WAAM,CAAd,CAA6B,IAAG,CAAe,CAAV,yCAAU,IAAc,WAAM,gBAApB,CAAlB,CADY;/RAEjD,+CAAC,KAAD;pDACjB,UAAc,CAAX,UAAW,IAAI,eAAJ,CAAc,IAAI,oBAAhC,EACE,aAAQ,0BAAa,CAAC,eAAM,gBAAiB,GAAI,cAAC,4CAAD,CAA5B,CAArB,CADF;1MAP2C;AAtTQ;AAGnD;AACA,UAAG,eAAH,EACE,eADF;1CAGA,mBAAS;nBACT;AARmD;AAWA;AAGnD;AACA,oBAAU;pBACV,UAAG,eAAW,KAAG,WAAjB,EACE,iBADF;5DAGA,wBAAc;xBARqC;AAWF;AAGjD;AACA,mBAAS;nBACT;AALiD;AArCF;AAE/C;AACA,UAAS,UAAN,MAAS,EAAH,CAAT,EACE,MADF;rCAGK;AACH,WADG,KACH,YAAY,CADT,KACS,SAAZ;3CAEE,YAAG,kBAAH,EACE,eADF;xCAFF;PAP6C;AAnBE;AAEjD;AACK;AACH,UADG,KACH;fAAU;AACV,gBAFG,KAEH;rBAAS;AACT,iBAHG,KAGH,YAAQ,CAHL,KAGK,QAAR;hDAAmB;AACnB,iBAJG,KAIH,YAAU,CAJP,KAIO,QAAV;hDAAqB;AACrB,gBALG,KAKH,SAAW,YAAX;1CAR+C;AAYC;AAElD;AACA,UAAQ,CAAJ,SAAI,IAAG,GAAH,CAAQ,IAAI,CAAc,CAAL,SAAD,aAAM,IAAG,cAAC,IAAQ,GAAY,GAAW,GAAY,GAAU,GAAS,GAAQ,GAAU,GAAU,EAA3F,CAAH,CAAlC,EACE,6BAAwB,CAAC,SAAD,CAD1B;pJAHkD;AAjkBE;AAEpD;AAFoD;AAKA;AAEpD;AACA,mBAAS;nBACT,oBAAU;pBACV,wBAAc;xBACd;AANoD;AA8uBA;;AAoBQ;;AAfT;;AAKA;;AAKI;;AAzjBX;AAE5C;AACA;AAEA,UAAG,CAAI,iBAAY,IAAS,CAAL,cAAK,KAAE,EAAF,CAA5B,EACE,MADF;/DAGA,WAAM;XACN,WAAM,SAAS,Wd7oI6B;/Bc8oI5C;AACE,iBAAS,SAAS,CAAC,wCAAD;nEAClB,iBAAS,MAAK,OAAO,CAAC,YAAD;3CAErB,YAAG,aAAH;zBAEE,cAAU,CAAN,UAAM,IAAG,eAAH,CAAe,IAAmB,CAAd,mBAAc,KAAG,EAAH,CAA5C;7EACE,qBAAS,MAAK,SAAC,CAAS,mBAAT;xDACZ,oBAAG,WAAO,IAAoB,CAAf,oBAAe,KAAG,EAAH,CAA9B,EACH,SAAS,MAAK,SAAC,CAAS,oBAAT,CADZ;vGAGF,UAAG,uBAAkB,KAAG,EAAxB,EACH,SAAS,MAAK,SAAC,CAAS,uBAAT,CADZ;pGAGL,iBAAS,WAAS,CAAC,yCAAI,eAAM,mBAAc,0BAAqB,wBAAmB,ed5qI+K,EAC5O,CAAC,EAAwB,CAAC,EAAwD,KAA6B,MAAoB,CAAC,EAAgB,CAAE,Cc2qI1J;jMAdpB;AAgBE,iBAAS,aAAa,CAAC,GdxyIyD,KcwyI1D;vCAhBxB;AAV4C;AAxGE;AAE9C;AACA;AACA;AAEA,UAAG,CAAI,mBAAP,EACE,MADF;tCAGA,UAAkB,qCAAb,oBAAa,CAAC,2CAAD;/GAElB,UAAY,iCAAH,eAAL,IAAK,CAAiC,IAAI,sBAA9C;zFAEE,eAAQ,8BAAO,QAAC;rDAChB,YAAI,QAAQ,CAAC,EAAG,CAAJ;xBAMZ,YAAK,4CAAe,QAAC,YAAM,CAAC,IAAI,UAAC,GdtsIuB,KcssI7B,CAAN;pGACrB;AACE,WAAC;XAQD,WAAC,QAAO,QAAC,CAAQ,oEAAR;hGACT,WAAC,QAAO,SAAC,CAAS,4CAAe,0BAAxB;nGACT,WAAC,WAAS,CAAO,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAc,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAQ,+Ed1rIuJ,8Ec0rIpL;9UACV,WAAC,WAAS,CAAO,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAc,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAQ,+Ed3rIuJ,8Ec2rIpL;9UACV,WAAC,WAAS,CAAO,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAc,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAQ,+Ed5rIuJ,8Ec4rIpL;9UACV,WAAC,WAAS,CAAO,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAc,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAQ,+Ed7rIuJ,8Ec6rIpL;9UACV,WAAC,WAAS,CAAO,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAc,sCAAN,gCAAM,CAAC,EAAG,CAAJ,GAAQ,+Ed9rIuJ,8Ec8rIpL;9UAfZ;AAiBE,WAAC;XACD,WAAE,eAAF,CAAE;3BAlBJ;AAqBA;AAEE,mBAAS,aAAW,CAAC,wCAAiB,KdtqIgD,KAClE,MAA0B,KAA2B,KcqqIrD;nGAFtB;AAQE,cAAK,eAAL,IAAK;jCARP;;AAaA,iBAAS,iBAAT,GAA6B;rCAExB;AACH,YADG,KACH;jBAEE,cAAG,aAAH;3BAEE,gBAAG,WAAO,IAAmC,CAA9B,6BAAuB,SAAC,EAAM,GAAE,CAAF,CAA7C;7EACE,uBAAS,iBAAiB,CAAC,wCAAG,8BdnpIqD,EAA2B,KAChG,MAA0B,KAA2B,KckpIzC;tIACvB,sBAAG,WAAO,IAAwB,CAAnB,kBAAY,SAAC,EAAM,GAAE,CAAF,CAAlC;xEACH,uBAAS,iBAAiB,CAAC,wCAAG,mBdrpIqD,EAA2B,KAChG,MAA0B,KAA2B,KcopIzC;3HACvB,sBAAG,wBAAkB,SAAC,EAAM,GAAE,CAA9B;7DACH,uBAAS,iBAAiB,CAAC,wCAAG,yBdvpIqD,EAA2B,KAChG,MAA0B,KAA2B,KcspIzC;jIAE1B,kBAAA,SAAS,iBAAiB,CAAC,wCAAG,cdzpIqD,EAA2B,KAChG,MAA0B,KAA2B,KcwpIzC;;1HAI5B,gBAAG,gCAA0B,SAAC,EAAM,GAAE,CAAtC;/DACE,uBAAS,iBAAiB,CAAC,wCAAG,iCd9pIqD,EAA2B,KAChG,MAA0B,KAA2B,Kc6pIzC;zIACvB,sBAAG,qBAAe,SAAC,EAAM,GAAE,CAA3B;1DACH,uBAAS,iBAAiB,CAAC,wCAAG,sBdhqIqD,EAA2B,KAChG,MAA0B,KAA2B,Kc+pIzC;9HAE1B,kBAAA,SAAS,iBAAiB,CAAC,wCAAG,cdlqIqD,EAA2B,KAChG,MAA0B,KAA2B,KciqIzC;;;1HAK9B,cAAG,aAAH;3BAEE,gBAAG,WAAO,IAAwB,CAAnB,kBAAY,SAAC,EAAM,GAAE,CAAF,CAAlC;lEACE,uBAAS,iBAAiB,CAAC,wCAAG,mBd1qIqD,EAA2B,KAChG,MAA0B,KAA2B,KcyqIzC;3HAE1B,kBAAA,SAAS,iBAAiB,CAAC,wCAAG,cd5qIqD,EAA2B,KAChG,MAA0B,KAA2B,Kc2qIzC;/GAEzB,UAAG,qBAAe,SAAC,EAAM,GAAE,CAA3B;zDACH,qBAAS,iBAAiB,CAAC,wCAAG,sBd/qIuD,EAA2B,KAChG,MAA0B,KAA2B,Kc8qI3C;5HAE1B,gBAAA,SAAS,iBAAiB,CAAC,wCAAG,cdjrIuD,EAA2B,KAChG,MAA0B,KAA2B,KcgrI3C;;;xHA7FY;AAmGA;;AAtiBA;AAAX;AAEnC,eAAU;fAFyB;AAAW;AAVE;AAAb;AAEnC,eAAU;fAFyB;AAAa;AA81BF;AAAX;AAEnC;AACA;AACA;AAEA,UAAK;VACL,aAAQ;bACR,WAAM;XACN,UAAG,CAAI,iBAAP;5BAEO;AACH,YADG,KACH;jBAAS,mBAAe,qCAAL,+BAAK,CAAC,IAAI,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAApD;zIACxB,kBAFG,KAEH,qDAAQ,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,IAAI,OAAQ,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAtD,EAAvB;xMAIF,eAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;xIAjBkB;AAAW;AApCI;AAAf;AAEnC;AAEA,UAAK;VACL,eAAe,qCAAL,+BAAK,CAAC,CAAC,OAAQ,CAAC,KAAM,CAAC,OAAQ,CAAC,OAA3B;lHALoB;AAAe;AALF;AAAb;AAEnC,eAAuB,qCAAb,oBAAa,CAAC,sDAAD;/HAFY;AAAa;AAlCA;AAAb;AAEnC;AACA;AAEA,WAAM;XACD;AACH,UADG,KACH,+CAAU,KAAM,+BAAhB;lGAGF,UAAK;VACL,eAAe,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,KAAM,CAAC,MAAO,CAAC,OAAzB;hHACf,UAAG,mBAAH;7BAEO;AACH,YADG,KACH;jBAAS,mBAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAiB,CAAZ,MAAM,KAAM,GAAE,CAAF,CAAI,GAAE,EAAF,CAAM,MAAM,OAAQ,GAAE,CAAxE;/JACxB,kBAFG,KAEH,qDAAQ,SAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAK,MAAM,MAAO,GAAE,CAAF,CAAgB,CAAX,MAAM,IAAK,GAAE,CAAF,CAAI,GAAE,EAArE,EAAvB;1NAJJ;PAZmC;AAAa;AAqBA;AAAb;AAEnC;AAEA,eAAU;fACV,UAAG,oBAAH;9BAEE,cAAO,4CAAe,gBAAgB,CAAC,cAAS,EAAG,yBAAb;pHACtC,YAAW,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAAtC,EACE,SAAU,QAAG,CAAC,GAAG,UAAC,GAAQ,GAAG,SAAC,EAAjB,CADf;tHAHF;PALmC;AAAa;AA+BW;AAAxB;AAEnC;AAEA,eAAU;fACV,UAAG,+BAAH;zCAEE,cAAO,4CAAe,gBAAgB,CAAC,yBAAoB,EAAG,yBAAxB;/HACtC,YAAW,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAAtC,EACE,SAAU,QAAG,CAAC,GAAG,UAAC,GAAQ,GAAG,SAAC,EAAjB,CADf;tHAHF;PALmC;AAAwB;AAj4BjB;AAE1C;AACA,UAAa,gCAAH,eAAP,MAAO,CAAV;hEAEE,uBAAmB,OAAP,OAAU,gCAAH,CAAuC;tEAC1D,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,+BAA2B,OAAP,OAAU,gCAAH,CAA+C;9EAC1E,2BAAuB,OAAP,OAAU,gCAAH,CAA2C;1EAClE,sCAAkC,OAAP,OAAU,gCAAH,CAAsD;rFACxF,+BAA2B,OAAP,OAAU,gCAAH,CAA+C;9EAC1E,0CAAsC,OAAP,OAAU,gCAAH,CAA0D;zFAChG,sCAAkC,OAAP,OAAU,gCAAH,CAAsD;rFACxF,wBAAW,OAAO,CAAS,OAAP,OAAU,gCAAH,CAA2C,YAApD;3FAClB,gCAA4B,OAAP,OAAU,gCAAH,CAAgD,mBAAhB;lGAC5D,qBAAQ,OAAO,CAAS,OAAP,OAAU,gCAAH,CAAwC,SAAjD;rFACf,6BAAgB,OAAO,CAAS,OAAP,OAAU,gCAAH,CAAgD,iBAAzD;rGACvB,qCAAwB,OAAO,CAAS,OAAP,OAAU,gCAAH,CAAwD,yBAAjE;rHAC/B,gCAAmB,OAAO,CAAS,OAAP,OAAU,gCAAH,CAAmD,oBAA5D;3GAC1B,wCAA2B,OAAO,CAAS,OAAP,OAAU,gCAAH,CAA2D,4BAApE;3HAClC,0BAAa,OAAO,CAAS,OAAP,OAAU,gCAAH,CAA6C,cAAtD;/FACpB,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,qBAAiB,OAAP,OAAU,gCAAH,CAAqC,QAAL;5EACjD,4BAAwB,OAAP,OAAU,gCAAH,CAA4C;3EACpE,+BAA2B,OAAP,OAAU,gCAAH,CAA+C;9EAC1E,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,kCAA8B,OAAP,OAAU,gCAAH,CAAkD;jFAChF,6BAAyB,OAAP,OAAU,gCAAH,CAA6C;5EACtE,oCAAgC,OAAP,OAAU,gCAAH,CAAoD;nFACpF,kCAA8B,OAAP,OAAU,gCAAH,CAAkD;jFAChF,yBAAqB,OAAP,OAAU,gCAAH,CAAyC;xEAC9D,oBAAK,OAAO,CAAS,OAAP,OAAU,gCAAH,CAAqC,QAA9C;nFACZ,+BAA2B,OAAP,OAAU,gCAAH,CAA+C;9EAC1E,8BAA0B,OAAP,OAAU,gCAAH,CAA8C;7EACxE,kCAA8B,OAAP,OAAU,gCAAH,CAAkD;jFAChF,4BAAwB,OAAP,OAAU,gCAAH,CAA4C;3EACpE;OAnCF;PAH0C;AA0FE;AAE5C;AACA,wBAAc,CAAC;zBACf,qBAAW;rBACX,4BAAkB;5BAClB,4BAAkB;5BAClB,4BAAkB;5BAElB,qBAAS,qDAAmB,QAAC;lFAC7B,kBAAK,WAAL,GAAoB;hCAEpB,6BAAmB;7BACnB,4BAAkB;5BAClB,gCAAsB;hCAEtB,wBAAc;xBACd,wBAAc;xBACd,+BAAqB;/BACrB,yBAAe;zBACf,oCAA0B;pCAC1B,6BAAmB;7BACnB,wCAA8B;xCAC9B,oCAA0B;pCAC1B,0BAAgB;1BAEhB,4BAAkB;5BAClB,6BAAmB;7BACnB,gCAAsB;hCACtB,oBAAU,sCAAY,QAAC,YAAM,CAAC,IAAD,CAAN;pFACvB,iBAAM,oBAAC,CAAoB,IAApB;1CACP,iBAAM,kBAAC,CAAkB,IAAlB;xCACP,iBAAM,iBAAC,CAAiB,mBAAjB;tDACP,iBAAM,kBAAC,CAAkB,oBAAlB;xDACP,iBAAM,SAAN,GAAkB;7BAClB,iBAAM,cAAN,GAAuB;lCACvB,6BAAmB;7BAEnB,sBAAY,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;9FACjC,mBAAQ,UAAR,GAAsB;hCACtB,8BAAoB,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;tGACzC,2BAAgB,UAAhB,GAA8B;xCAC9B,2BAAiB,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;nGACtC,wBAAa,UAAb,GAA2B;rCAE3B,iCAAuB,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;zGAC5C,8BAAmB,UAAnB,GAAiC;3CACjC,yCAA+B,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;jHACpD,sCAA2B,UAA3B,GAAyC;nDACzC,sCAA4B,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;9GACjD,mCAAwB,UAAxB,GAAsC;hDAEtC,yBAAe,mCAA8B,QAAC,YAAM,CAAC,IAAD,CAAN;tFAE9C,0BAAgB;1BAChB,4BAAkB;5BAClB,2BAAiB;3BACjB,kCAAwB;lCACxB,gCAAsB;hCACtB,uBAAa;vBACb,6BAAmB;7BAEnB,oBAAS,GAAT;vBACA,qBAAU,EAAV;vBA/D4C;AAyTA;AAEtC,eAAN,KAAM;pBACC,eAAP,KAAO;pBACE,eAAT,KAAS;pBACQ,eAAjB,KAAiB;pBACH,eAAd,KAAc;pBACM,eAApB,KAAoB;pBACQ,eAA5B,KAA4B;pBACH,eAAzB,KAAyB;pBACb,eAAZ,KAAY;pBACZ;AAX4C;AAwpBJ;AAExC;AAEA;AACA,UAAG,CAAI,gBAAU,aAAjB;xCAEE,YAAG,aAAH;zBAEE,cAAG,UAAM,IAAG,eAAZ;3CAEE,qBAAS,MAAK,OAAO,CAAC,gBAAU,UAAX;7DACrB,qBAAS,QAAO,OAAO,CAAC,gBAAU,YAAX;tDAEpB,UAAG,WAAH;hCAEH,qBAAS,MAAK,OAAO,CAAC,gBAAU,WAAX;9DACrB,qBAAS,QAAO,OAAO,CAAC,gBAAU,aAAX;;lEAIvB,qBAAS,MAAK,OAAO,CAAC,gBAAU,YAAX;/DACrB,qBAAS,QAAO,OAAO,CAAC,gBAAU,cAAX;;;nEAKzB,mBAAS,MAAK,OAAO,CAAC,gBAAU,cAAX;/DACrB,mBAAS,QAAO,OAAO,CAAC,gBAAU,gBAAX;;nEAGzB,YAAK;ZAEL,YAAG,gBAAU,WAAb;vCAEE,mBAAS,MAAK,QAAC,CAAQ,kEAAR;pGACf,mBAAS,gBAAc,CAAC,wCdptJmE,6EcotJpE;hJAGvB,MAAA,SAAS,qBAAmB,CAAC,wCAAG,gBAAU,WAAqB,WAAV,gBAAU,Wd/sJkJ,6Ec+sJrL;pOAE9B,YAAG,gBAAU,iBAAiB,IAAI,CAAI,gBAAU,WAAhD;7EAEE,iDAAa,CAAC;;;;nCAAG,CAAC,EAAG,CAAC,CAAT;pBACb,mBAAS,QAAO,OAAO,CAAC,gBAAU,aAAX;hEACvB,mBAAS,MAAK,QAAC,CAAQ,iEAAR;nGACf,mBAAS,qBAAmB,CAAC,wCAAG,gBAAU,WAAqB,WAAV,gBAAU,WdttJkJ,6EcstJrL;tNAL9B;FApCF;PA6CA,qBAAU,CAAC,UAAW,2CAAZ;3EACV,mBAAQ,CAAC,SAAD;7BACR,qBAAU,CAAC,SAAD;/BAEV,UAAG,iBAAU,IAAI,gBAAjB;/CAEE,YAAK;ZACL,iBAAS,qBAAmB,CAAC,wCdnvJ8C,EAA+D,6EcmvJ9G;vJAH9B;PAMA,UAAG,mBAAa,IAAI,wBAApB,EACE,SAAS,qBAAmB,CAAC,4CAAO,EdvvJsG,6EcuvJ9G,CAD9B;tNA5DwC;AA9ZI;AAE5C,UAAG,CAAY,CAAC,WAAD,SAAf,EACE,MADF;xCAGA,UAAG,CAAI,WAAM,QAAb;9BAEE,YAAY,sBAAD,QAAX,EACE,sBAAgB,CAAC,IAAD,CADlB;xEAGA,YAAG,uBAAH,EACE,WAAM,iBAAC,CAAiB,eAAjB,CADT;lFAGA,mBAAM,aAAC,CAAa,oBAAb;rDACP,mBAAM,UAAC,CAAU,IAAV;lCACP,YAAY,gBAAD,QAAX,EACE,gBAAU,CAAC,IAAD,CADZ;rDAIO,MAAP,WAAM,UAAC,CAAU,KAAV;xCAnBmC;AArwIjB;;;;AA+LK;;AACI;;AAER;AAy5M+B;AAE3D;AACA,+BAAa,CAAC,iCAAD;jEAH8C;AARV;AAAb;AAEpC;AAEA,UAAK;VACL,eAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;jIALqB;AAAa;AAj5MrB;AAKb,4BjB6OI,+DiB7OJ;3FACA;AACK;AACE;AACA;AACC;AACO,2CjB0HN,oEiB1HM;/GACF,yCjByHJ,oEiBzHI;7GACT,gCjByHQ,uEiBzHR;vGACD,+BnBlFE,wDmBkFF;vFACQ,uCnBnFN,wDmBmFM;/FACH,oCnBpFH,wDmBoFG;5FACC;AACE,uCbtVJ,oEasVI;3GACV,6BApQU,yCAoQV;tEACM;AACD,kCAlTS,6CAkTT;/EArBO;AA2BF;;;AAExB;AACA;AACA;AACA;AACA;AANwB;;AAExB,0BAFwB;;;1BAksHwB;AAGlD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,YAAY,oBAAD,QAAX;xCAEO;AACH,cADG,KACH;nBAEE,gCAAe,WAAC,CAAW,KAAX;jDAChB,gCAAe,UAAC,CAAU,IAAV;/CAIhB,gCAAe,YAAW,eAAC,CAAe,KAAf;tDAE7B,UAVG,KAUH;1BAEE,gCAAe,WAAC,CAAW,KAAX;jDAChB,gCAAe,UAAC,CAAU,IAAV;/CAIhB,gCAAe,YAAW,eAAC,CAAe,IAAf;rDAE7B,UAnBG,KAmBH;1BAEE,gCAAe,WAAC,CAAW,IAAX;hDAChB,gCAAe,UAAC,CAAU,IAAV;/CAIhB,gCAAe,YAAW,eAAC,CAAe,KAAf;tDAP7B;FArBJ;TAgCA;OAnCF;PAHkD;AA0CI;AAGtD,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,YAAY,oBAAD,QAAX;xCAEO;AACH,cADG,KACH;nBAME,gCAAe,SAAC,CAAS,qCAAT;/EAEhB,gCAAe,SAAC,CAAS,EAAT;5CAChB,gCAAe,YAAW,WAAC,CAAW,cAAC,mEAAY,qEAAb,CAAX;pMAE7B,UAZG,KAYH;1BAME,gCAAe,SAAC,CAAS,sCAAT;hFAEhB,gCAAe,UAAC,CAAU,EAAV;7CAChB,gCAAe,YAAW,WAAC,CAAW,cAAC,qEAAc,qEAAf,CAAX;tMAT7B;FAdJ;FAHF;PAHsD;AAjDJ;AAElD;AACA,UAAY,oBAAD,QAAX,EACE,oBAAe,gBAAC,CAAgB,sBAAhB,CADlB;pGAHkD;AAyJE;AAEpD;AACA;AAHoD;AA5CG;AAEvD,UAAY,oBAAD,QAAX,EACE,oBAAe,YAAW,YAAC,CAAY,gBAAU,UAAtB,CAD7B;hHAFuD;AA8aL;AAGlD;AACA,UAAG,kBAAa,KAAE,iDAAlB,EACE,eADF;nGAJkD;AAzTI;AAEtD;AAFsD;AAfT;AAE7C;AAEA;AACA,UAAW,CAAC,oBAAD,SAAkB,IAAkB,CAAb,kBAAa,KAAE,iDAAF,CAA/C;tHAEO;AACH,YADG,KACH;jBAAU,cAAU,qCAAL,+BAAK,CAAC,eAAM,GAAE,oBAAe,SAAC,EAAlB,CAAyB,EAAG,gBAAO,gBAA1C;vKACpB,kBAFG,KAEH,0DAAW,IAAU,qCAAL,+BAAK,CAAC,EAAG,gBAAO,GAAE,oBAAe,UAAC,EAAlB,CAA0B,gBAAO,gBAA5C,EAArB;lPAEF,4BAAe,WAAW,CAAC,UAAW,uCAAZ;lFAN5B;PAL6C;AA1HA;AAG7C;AAEA;AACA,UAAK;VACL,UAAY,CAAD,QAAX,EACE,CAAC,WAAC,CAAW,KAAX,CADJ;xCAP6C;AA4WW;AAAtB;AAElC,eAAU;fAFwB;AAAsB;AAUP;AAAf;AAElC,eAAoB;fACpB,UAAW,CAAC,oBAAD,SAAkB,IAAkB,CAAb,kBAAa,KAAG,+CAAH,CAA/C;pHAEE,YAAG,kBAAa,KAAE,iDAAlB;pFAEO;AACH,cADG,KACH;nBAAU,qBAAe,qCAAL,+BAAK,CAAC,eAAM,GAAE,oBAAe,SAAC,EAAlB,CAAyB,EAAG,gBAAO,gBAA1C;9KACzB,oBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,EAAG,gBAAO,GAAE,oBAAe,UAAC,EAAlB,CAA0B,gBAAO,gBAA5C,EAA1B;;zPASF,mBAAe,qCAAL,+BAAK,CAAC,oBAAe,QAAC,GAAM,oBAAe,OAAC,GAAK,oBAAe,QAAC,EAAK,GAAE,oBAAe,SAAC,EAAlB,CAAyB,oBAAe,OAAC,EAAI,GAAE,oBAAe,UAAC,EAAhI;;/QAfnB;PAHkC;AAAe;AAwBJ;AAAX;AAElC;AACA;AACA;AAEA,UAAK;VACL,aAAqB,qCAAb,oBAAa,CAAC,uCAAD;9GACrB,WAAM;XACN,UAAG,kBAAa,KAAG,+CAAnB;hFAEE,YAAG,CAAI,iBAAP;9BAEO;AACH,cADG,KACH;nBAEO;AACH,gBADG,KACH;rBAAU,uBAAe,qCAAL,+BAAK,CAAC,IAAI,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAApD;7IACzB,sBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,IAAI,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,EAAE,IAAK,GAAE,CAAlD,EAA1B;zMAGJ,UARG,KAQH;1BAEO;AACH,gBADG,KACH;rBAAU,uBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,IAAI,OAAQ,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAtD;/IACzB,sBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,IAAI,OAAQ,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,EAAE,IAAK,GAAE,CAApD,EAA1B;3MAJJ;;XAWG;AACH,cADG,KACH;nBAAU,qBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;vIACzB,oBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,EAAE,IAAK,GAAE,CAA9C,EAA1B;;;9MAMJ,YAAG,CAAI,iBAAP;9BAEO;AACH,cADG,KACH;nBAAS,qBAAe,qCAAL,+BAAK,CAAC,IAAI,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAApD;3IACxB,oBAFG,KAEH,qDAAQ,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,IAAI,OAAQ,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAtD,EAAvB;xMAIF,eAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;;1IAhDe;AAAW;AA1FE;AAAb;AAElC;AACA;AACA;AAEA,WAAM;XACD;AACH,UADG,KACH,+CAAU,KAAM,+BAAhB;lGAGF,UAAK;VACL,eAAe,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,KAAM,CAAC,MAAO,CAAC,OAAzB;hHACf,UAAG,mBAAH;7BAEE,YAAG,kBAAa,KAAG,+CAAnB;lFAEE,eAAM;fACD;AACH,cADG,KACH;nBAEO;AACH,gBADG,KACH;rBAAU,uBAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAiB,CAAZ,MAAM,KAAM,GAAE,CAAF,CAAI,GAAE,EAAF,CAAM,MAAM,OAAQ,GAAE,CAAxE;nKACzB,sBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAiB,CAAZ,MAAM,KAAM,GAAE,CAAF,CAAI,GAAE,EAAF,CAAM,EAAE,IAAK,GAAE,CAAjE,EAA1B;1NAGJ,UARG,KAQH;1BAEO;AACH,gBADG,KACH;rBAAU,uBAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAK,EAAE,KAAM,GAAE,CAAF,CAAgB,CAAX,MAAM,IAAK,GAAE,CAAF,CAAI,GAAE,EAAhE;5JACzB,sBAFG,KAEH,0DAAW,SAAe,qCAAL,+BAAK,CAAC,MAAM,KAAM,GAAE,CAAF,CAAK,MAAM,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAgB,CAAX,MAAM,IAAK,GAAE,CAAF,CAAI,GAAE,EAAhE,EAA1B;1NAJJ;FASC,UAAG,CAAI,iBAAY,IAAS,CAAL,cAAK,KAAE,EAAF,CAA5B;hEAEH,mBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;rIACf,cAAO,CAAH,EAAG,KAAG,CAAC,CAAJ,CAAO,IAAI,CAAI,2BAAtB;zDAEE,kBAAM,KAAN,GAAe,UAAK,CAAC,CAAC,KAAM,GAA4B,CAAN,CAAV,CAAR,CAAC,MAAO,GAAE,CAAC,KAAH,CAAU,GAAE,EAAF,CAAM,GAAE,CAAF,CAApC;7EACpB,kBAAM,IAAN,GAAc,UAAK,CAAC,CAAC,IAAK,GAA4B,CAAN,CAAT,CAAT,CAAC,OAAQ,GAAE,CAAC,IAAH,CAAS,GAAE,EAAF,CAAM,GAAE,CAAF,CAAnC;3EACnB,kBAAM,MAAN,GAAgB,MAAM,KAAM,GAAE,EAAF;3CAC5B,kBAAM,OAAN,GAAiB,MAAM,IAAK,GAAE,EAAF;hCAL9B;FAQG,UAAG,iBAAY,IAAI,CAAU,CAAL,cAAK,KAAE,EAAF,CAA7B;hEAEE;AACH,cADG,KACH;nBAAS,qBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAY,CAAP,CAAC,KAAM,GAAE,CAAF,CAAI,GAAE,EAAF,CAAM,CAAC,OAAQ,GAAE,CAApD;7IACxB,oBAFG,KAEH,qDAAQ,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAW,CAAN,CAAC,IAAK,GAAE,CAAF,CAAI,GAAE,EAAjD,EAAvB;tMAJC;FAjCP;PAbkC;AAAa;AALA;AAAb;AAElC,eAAoB;fAFc;AAAa;AA5NF;AAAX;AAElC,eAAU,kBAAa,KAAG,+CAAH;rFAFW;AAAW;AAbJ;AAEzC;AACA,UAAa,+BAAH,eAAP,MAAO,CAAV;/DAEE,6BAAyB,OAAP,OAAU,+BAAH,CAA4C;3EACrE,iCAA6B,OAAP,OAAU,+BAAH,CAAgD;/EAC7E,oCAAgC,OAAP,OAAU,+BAAH,CAAmD;lFACnF,uBAAmB,OAAP,OAAU,+BAAH,CAAsC;rEACzD;OANF;PAHyC;AAkBE;AAE3C;AACA,qBAAW;rBACX,+BAAqB;/BACrB,6BAAmB,6BAAsB,QAAC,YAAM,CAAC,IAAD,CAAN;pFAC1C,0BAAe,WAAC,CAAW,KAAX;3CAChB,0BAAe,QAAC,CAAQ,EAAR;rCAChB,0BAAe,SAAf,GAA2B;tCAC3B,0BAAe,WAAC,CAAW,KAAX;3CAChB,0BAAe,SAAC,CAAS,EAAT;tCAChB,0BAAe,YAAW,WAAC,CAAW,cAAC,mEAAY,qEAAb,CAAX;zMAK3B,0BAAe,SAAC,CAAS,qCAAT;zEAEhB,0BAAe,QAAf,GAA0B;rCAE1B,0BAAe,SAAQ,wBAAsB,CAAC,mDAAqB,sCAAW,GAAjC;xJAC7C,0BAAe,SAAQ,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;7JAC7C,0BAAe,iBAAgB,wBAAsB,CAAC,mDAAqB,sCAAW,GAAjC;hKACrD,0BAAe,iBAAgB,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;rKACrD,0BAAe,cAAa,wBAAsB,CAAC,mDAAqB,sCAAW,GAAjC;7JAClD,0BAAe,cAAa,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;lKAzBP;AA4BA;AAE3B,eAAhB,KAAgB;pBAChB;AAH2C;AA6Pe;AAAxB;AAElC,eAAU;fAFwB;AAAwB;AAroIhC;AAkFN;AA6nN+B;AAEnD;AACA,+BAAa,CAAC,yBAAD;zDAHsC;AA7nN/B;AAML,4BjB+HI,+DiB/HJ;3FACe;AACF;AACL,oCAzHS,+CAyHT;nFACI,wCAzHS,mDAyHT;3FACF,uC1BvgBnB,W0BugBmB;lDACD,sC1BxgBlB,W0BwgBkB;jDACE,uCzBzWlB,yCyByWkB;hFACC,wCzBhZf,6CyBgZe;rFACN,kCzBjZT,6CyBiZS;/EACK,uCzBlZd,6CyBkZc;pFACX;AACK;AACE;AACA;AACU;AACF,2CjBEN,oEiBFM;/GACF,yCjBCJ,oEiBDI;7GACT,gCjBCQ,uEiBDR;vGACD,+BnB1ME,wDmB0MF;vFACW,0CnB3MT,wDmB2MS;lGACZ,8BA7US,yCA6UT;vEACO,qCA9UE,yCA8UF;9EACA,qCA/UE,yCA+UF;9EACA,qCAhVE,yCAgVF;9EACC,sCAnVS,iDAmVT;vFACC,uCnBjNN,wDmBiNM;/FACH,oCnBlNH,wDmBkNG;5FACc,kDnBnNjB,wDmBmNiB;1GACH,+CnBpNd,wDmBoNc;vGACV;AACE,uCbtdJ,oEasdI;3GACL,mC1BliBf,W0BkiBe;9CACI;AACO,8C1BpiB1B,W0BoiB0B;zDACI;AACpB,6BAxYU,yCAwYV;tEACM;AACD,kCAtbS,6CAsbT;/EACE;AA7CH;AAwQU;;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZ4B;;AAE5B,iBAF4B;jBAG5B,gBAH4B;hBAI5B,kBAJ4B;lBAU5B,gBAV4B;hBAW5B,2BAX4B;;;3BAs7JgB;AAE9C,gBAAK,OAAO,CAAC,KAAD;7BAFkC;AAwCE;AAEhD,kBAAO,OAAO,CAAC,KAAD;/BAFkC;AAzBW;AAG3D,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,mBAAM;ZAHR;PAH2D;AA8BF;AAGzD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,mBAAM;ZAHR;PAHyD;AAhEP;AAElD,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb,mBAAM;ZAHR;PAFkD;AASK;AAGvD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,mBAAM;ZAHR;PAHuD;AAnBQ;AAAzB;AAEtC,eAAU,uBAAkB,KAAG,CAAH;5CAFU;AAAyB;AAKF;AAAvB;AAEtC,eAAU,qBAAgB,KAAG,CAAH;1CAFY;AAAuB;AA6BV;AAEnD,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,YAAY,WAAD,QAAX,EACE,WAAM,iBADR;tDAHF;PAFmD;AAoBA;AAEnD,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,mBAAM;ZAHR;PAFmD;AASM;AAGzD,2BAAgB,OAAO,CAAC,KAAD;xCAHkC;AApEP;AAElD,iBAAM;jBAF4C;AAyFE;AAEpD,iBAAM;jBAF8C;AAxIP;AAE7C,UAAa,mCAAH,eAAP,MAAO,CAAV;nEAEE,6BAAgB,OAAO,CAAS,OAAP,OAAU,mCAAH,CAAmD,iBAA5D;xGACvB,0BAAsB,OAAP,OAAU,mCAAH,CAA6C;5EACnE,kBAAK,OAAO,CAAS,OAAP,OAAU,mCAAH,CAAwC,MAAjD;lFACZ,oBAAO,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA0C,QAAnD;tFACd,kCAA8B,OAAP,OAAU,mCAAH,CAAqD;pFACnF,gCAA4B,OAAP,OAAU,mCAAH,CAAmD;lFAC/E,8BAA0B,OAAP,OAAU,mCAAH,CAAiD;hFAC3E,yBAAqB,OAAP,OAAU,mCAAH,CAA4C;3EACjE,0BAAsB,OAAP,OAAU,mCAAH,CAA6C;rEAVrE;PAF6C;AAgBE;AAE/C,oBAAU;pBACV,mBAAS,qDAAmB,QAAC;hFAC7B,wBAAc;xBACd,gCAAsB;hCACtB,8BAAoB;9BACpB,uBAAa;vBACb,4BAAkB;5BAClB,mBAAS,qDAAmB,QAAC,YAAM,CAAC,sEjB5hKuE,QiB4hKxE,CAAN;5KAC7B,qBAAW,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;9KAEjC,gBAAK,WAAL,GAAoB;9BACpB,kBAAO,WAAP,GAAsB;hCAEtB,gBAAK,SAAC,CAAS,QAAT;lCACN,gBAAK,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;5FAEN,8BAAoB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;xLAC1C,2BAAgB,WAAhB,GAA+B;zCAnBgB;AAsBA;AAE9B,eAAjB,KAAiB;pBACX,eAAN,KAAM;pBACA,eAAN,KAAM;pBACE,eAAR,KAAQ;pBACR;AAN+C;AA34JjB;AA0CN;;AAEJ;AACL,4BjBpMI,+DiBoMJ;3FACE,8BjB/GI,iEiB+GJ;/FACG;AACM,uCjBjHL,iEiBiHK;xGACE,0C1BrzBtB,W0BqzBsB;rDACF,wC1BtzBpB,W0BszBoB;nDACP;AACK,qCjBjdJ,YiBidI;jDAVA;AAyBH;;;AAEnB;AACA;AACA;AACA;AALmB;;AAGnB,mBAHmB;nBAKnB,kBALmB;;;lBAugLiB;AAEtC,qBAAW,uCAAa,QAAC;pEAFa;AAKA;AAE9B,eAAR,KAAQ;pBACR;AAHsC;AA5gLjB;AAaa,yFAAmB,UpCrwB9C,2BoCqwB8C,EAAqB,cnBrrBhE,6CmBqrBgE,CAAxC;5LACI,6FAAmB,UpCtwBlD,2BoCswBkD,EAAmB,YzBrrBpE,wCyBqrBoE,EAAqB,aDh1BxF,sCCg1BwF,CAA3D;9OACF,2FAAmB,UpCvwBhD,2BoCuwBgD,EAAmB,YzBtrBlE,wCyBsrBkE,EAA4B,8BAAlE;tNACF,yFAAmB,UpCxwB9C,2BoCwwB8C,EAAmB,YzBvrBhE,wCyBurBgE,EAAqB,aDl1BpF,sCCk1BoF,EAAsC,uCAAjG;lRACP,kFAAmB,UpCzwBvC,2BoCywBuC,EAAmB,YzBxrBzD,wCyBwrByD,EAA8B,gCAApE;/MAEI;;;AAE7B;AACA;AACA;AACA;AACA;AACA;AAP6B;;AAE7B,iBAF6B;;;jBAqjLsB;AAErD,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf,mBAAM,mBAAmB,WAAC,CAAW,gBAAX;lEAC1B,YAAG,gBAAH;5BACE,qBAAM,mBAAmB,UAAC,CAAU,WAAV;9DAEA,cAA1B,WAAM,mBAAmB,UAAC,CAAU,IAAV;3DAE5B,mBAAM;ZATR;PAFqD;AAeI;AAGzD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;xBAFrB;PAHyD;AASF;AAEvD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;tBAFnB;PAFuD;AA1CO;AAG9D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;7BAF1B;PAH8D;AASJ;AAG1D,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;zBAFtB;PAH0D;AAdI;AAAvB;AAEvC,eAAU,qBAAgB,KAAG,EAAH;3CAFa;AAAuB;AA7BhB;AAE9C,UAAa,oCAAH,eAAP,MAAO,CAAV;pEAEE,6BAAyB,OAAP,OAAU,oCAAH,CAAiD;hFAC1E,+BAA2B,OAAP,OAAU,oCAAH,CAAmD;lFAC9E,2BAAuB,OAAP,OAAU,oCAAH,CAA+C;9EACtE,oCAAgC,OAAP,OAAU,oCAAH,CAAwD;vFACxF,gCAA4B,OAAP,OAAU,oCAAH,CAAoD;5EANlF;PAF8C;AAYE;AAGhD,oBAAU;pBACV,2BAAiB;3BACjB,yBAAe;zBACf,6BAAmB;7BACnB,kCAAwB;lCACxB,8BAAoB;9BAR4B;AAWA;AAGhD;AAHgD;AAxhLjB;AA0BN;;AAEJ;AACI;AACF;AACO;AACJ,wC1B13BpB,W0B03BoB;nDAND;AAUM;AAkxMe;AAAP;AAGvC,eAA0C,YAAK,CAAC,KAAD;jCAHR;AAAO;AAlxMf;AAON;AAsxMe;AAAP;AAGjC,eAA+B,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAHE;AAAO;AAtxMf;AAqBQ,wFAAmB,UpC30B7C,2BoC20B6C,EAAiB,sBAAgB,qBAApD;1KAEd;;AAMC;;;AAMlB;AACA;AACA;AAAQ;AAAS;AAAuB;AACxC;AAAO;AACP;AACA;AACA;AACA;AAAa;AAAiB;AAC9B;AAQA;AACA;AACA;AAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1EkB;;AAMlB,0BANkB;1BAOlB,wBAPkB;xBAYlB,2BAZkB;3BAclB,0BAdkB;1BAsBlB,0BAtBkB;1BAuBlB,2BAvBkB;3BA0BlB,sBA1BkB;tBA4BlB,6BA5BkB;7BA6BlB,2BA7BkB;3BA8BlB,kCA9BkB;lCA+BlB,sCA/BkB;tCAgClB,oCAhCkB;pCAiClB,uBAjCkB;vBAkClB,6BAlCkB;7BAmClB,oCAnCkB;pCAqClB,kCArCkB;lCAsClB,uCAtCkB;vCAuClB,6BAvCkB;7BAwClB,4BAxCkB;5BAyClB,2BAzCkB;3BA0ClB,4BA1CkB;5BA4ClB,gCA5CkB;hCA6ClB,iCA7CkB;jCA8ClB,iCA9CkB;jCA+ClB,+BA/CkB;/BAkDlB,mCAlDkB;nCAqDlB,kBArDkB;lBA+DlB,6BA/DkB;7BAgElB,0BAhEkB;1BAiElB,0BAjEkB;1BAoElB,kCApEkB;lCAsElB,qCAtEkB;rCAuElB,kCAvEkB;lCAwElB,kCAxEkB;;;lCAkkEsB;AAG1C,sBAAW,OAAO,CAAC,KAAD;nCAHwB;AAmRR;AAElC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb;OAHF;PAFkC;AAlLO;AAEzC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd;OAHF;PAFyC;AA3FE;AAG3C,uBAAY,OAAO,CAAC,KAAD;pCAHwB;AA2BN;AAErC;AACA;AAEA,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,iBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;lFAAI;AAEF,cAAK,IAAiB,YAAJ,CAAC,CAAD;hCAClB,cAAQ,gCAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,gCAAH,CAAwC,SAAR,CAAS,WAAT,CADrC;;1HANJ;PALqC;AAyEK;AAE1C,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf;OAHF;PAF0C;AAkBD;AAEzC,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd;OAHF;PAFyC;AATQ;AAEjD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB;OAHF;PAFiD;AAjEb;AAEpC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT;OAHF;PAFoC;AA/9BU;AAAlB;AAE5B,eAAU;fAFkB;AAAkB;AAwqCV;AAEpC,kBAAK,OAAO,CAAC,KAAD;/BAFwB;AAKe;AAGnD,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB;OAHF;PAHmD;AA5LX;AAGxC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb;OAHF;PAHwC;AAUS;AAGjD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB;OAHF;PAHiD;AAUL;AAE5C,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB;OAHF;PAF4C;AA3iBI;AAApB;AAE5B,eAAU,kBAAa,KAAG,EAAH;xCAFK;AAAoB;AA6tBJ;AAE5C,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB;OAHF;PAF4C;AAjGL;AAEvC,UAAG,aAAS,KAAG,KAAf;jCAEE,YAAG,gBAAH;5BAEE,0BAAY;1BACZ,cAAG,aAAH;3BAEE,uCAAuB,iBAAW;xDAClC,6BAAW,cAAC,CAAc,KAAd;jDACZ,6BAAa;7BACb;AACA,0BAAS,UAAK,CAAC,kBAAD,CAAd;;xDAIA,0BAAS,UAAK,CAAC,cAAD,CAAd;pDACA;AACA,6BAAW,cAAC,CAAc,wBAAd;;pEAGd;SAlBF;FAFF;PAFuC;AANG;AAE1C,UAAG,gBAAY,KAAG,KAAlB,EACE,mBAAe,KADjB;9DAF0C;AA3nBM;AAApB;AAE5B,eAAU,kBAAa,KAAG,EAAH;xCAFK;AAAoB;AAysBJ;AAE5C,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,YAAG,aAAH,EACE,cAAS,UAAK,CAAC,kBAAD,CAAd,CADF;jEAHF;PAF4C;AA7CK;AAGjD,6BAAkB,OAAO,CAAC,KAAD;1CAHwB;AAeH;AAG9C,0BAAe,OAAO,CAAC,KAAD;vCAHwB;AAhrBO;AAAzB;AAE5B,eAAU,uBAAkB,KAAG,EAAH;7CAFA;AAAyB;AAsrBJ;AAEjD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB;OAHF;PAFiD;AASG;AAEpD,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB;OAHF;PAFoD;AAtNL;AAE/C,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB;OAHF;PAF+C;AASU;AAGzD,qCAA0B,OAAO,CAAC,KAAD;lDAHwB;AAqLJ;AAErD,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B;OAHF;PAFqD;AAn5Bf;AAAV;AAE5B,eAAU,4BAAgB,CAAC,EAAS,EAAS,EAAS,CAA5B;nDAFE;AAAU;AAhsBO;AAAjB;AAE5B,eAAU;fAFkB;AAAiB;AALD;AAAhB;AAE5B,eAAU;fAFkB;AAAgB;AA4nBS;AAAzB;AAE5B,eAAU;fAFkB;AAAyB;AA8Bd;AAAX;AAE5B;AACA;AACA;AAEA,YAAM,GAAN,GAAa;lBACb,YAAM,GAAN,GAAa;lBACb,UAAG,iBAAY,IAAU,CAAL,UAAK,KAAG,EAAH,CAAzB;lDAEE,YAAK,4CAAe,QAAC,sBAAkB,CAAC,EAAG,EAAG,mBd9lE+E,Ic8lEtF,CAAlB;nHACrB,SAAC,iBAAD,GAAqB;7BACrB,SAAC,sBAAD,GAA0B;lCAC1B;AACE,eAAM;fACN,cAAG,gBAAU,UAAb;xCAEE,gBAAG,WAAM,KAAE,uCAAX;vEACE,mBAAM;nBAEN,uBAAM;ZALV;XAQA,cAAK;dACL,cAAU,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,EAAF,CAAM,CAAC,KAAM,CAAC,OAAQ,CAAC,OAA/B;rHACV,iDAAa,CAAC;;;;nCAAG,CAAC,EAAG,CAAC,CAAT;pBACb,mBAAW,qCAAD,CAAC,kBAAkB,CAAC,WAAM,wCAAG,mBd5/DqG,Ic4/D/G,CAAlB;vJAbb;AAeE,WAAE,eAAF,CAAE;3BAfJ;OALF;PAR4B;AAAW;AApFK;AAAhB;AAG5B;AAEA,eAAU;fACV,eAAS,SAA2B,QAAtB,oBAAe,SAAC,EAAM,GAAE,CAAF,qBAApC;xFAAI;AAEF,YAAyB,oBAAe,WAAC,CAAD,CAAI,SAAU,KAAE,QAAxD;nEAEE,mBAAgC,oBAAe,WAAC,CAAD;nDAC/C;SAHF;;TAR0B;AAAgB;AAgBK;AAArB;AAG5B;AACA;AAEA,YAAO,8BAAyB,QAAC;lDACjC,eAAS,SAA2B,QAAtB,oBAAe,SAAC,EAAM,GAAE,CAAF,qBAApC;xFAAI;AACF,WAAG,IAAI,CAAC,oBAAe,WAAC,CAAD,CAAhB;;jDAOT,eAAU;fACV,eAAS,SAAe,QAAV,GAAG,SAAC,EAAM,GAAE,CAAF,qBAAxB;vEAAI;AAEF,YAAyB,GAAG,SAAC,CAAD,CAAI,SAAU,KAAE,QAA5C;hDACE;AAEA,cAAI,MAAJ,IAAG;;xBAEP,SAAI,eAAJ,GAAI;3BAvBwB;AAAqB;AA0DH;AAAlB;AAE5B;AACA;AAEA,UAAK;VACL,aAA4B,qCAApB,yBAAoB,CAAC,uCAAD;nHAC5B,eAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,IAAI,OAAQ,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,EAAtD;xIAPa;AAAkB;AArKE;AAApB;AAE5B;AACA;AAEA,UAAK;VACL,eAAe,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,KAAM,CAAC,OAAQ,CAAC,IAA1B;9GACf,UAAG,0BAAH;pCAEE,aAAM;bACN,YAAG,CAAI,iBAAY,IAAS,CAAL,UAAK,KAAE,EAAF,CAA5B;rDAEE,mBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAhD;rIACf,cAAI,EAAG,KAAG,CAAC,CAAX;vBAEE,kBAAM,KAAN,GAAe,UAAK,CAAC,CAAC,KAAM,GAA4B,CAAN,CAAV,CAAR,CAAC,MAAO,GAAE,CAAC,KAAH,CAAU,GAAE,EAAF,CAAM,GAAE,CAAF,CAApC;7EACpB,kBAAM,IAAN,GAAc,UAAK,CAAC,CAAC,IAAK,GAA4B,CAAN,CAAT,CAAT,CAAC,OAAQ,GAAE,CAAC,IAAH,CAAS,GAAE,EAAF,CAAM,GAAE,CAAF,CAAnC;3EACnB,kBAAM,MAAN,GAAgB,MAAM,KAAM,GAAE,EAAF;3CAC5B,kBAAM,OAAN,GAAiB,MAAM,IAAK,GAAE,EAAF;hCAL9B;FAQG,UAAG,iBAAY,IAAI,CAAU,CAAL,UAAK,KAAE,EAAF,CAA7B,EACH,SAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,EAA7C,EADZ;lLAdP;PAP4B;AAAoB;AA0BA;AAApB;AAE5B;AAEA,eAAU;fACV,UAAG,2BAAH;rCAEE,cAAO,4CAAe,gBAAgB,CAAC,qBAAgB,EAAG,yBAApB;3HACtC,YAAW,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAAtC,EACE,SAAU,QAAG,CAAC,GAAG,UAAC,GAAQ,GAAG,SAAC,EAAjB,CADf;tHAHF;PAL4B;AAAoB;AAiIE;AAAtB;AAE5B,eAAe,qCAAL,+BAAK,CAAC,eAAM,GAAE,EAAF,CAAM,gBAAO,GAAE,EAAF,CAAM,gBAAO,gBAAjC;/JACf,UAAG,gBAAU,WAAb;rCAEE,cAAM,KAAN,GAAe,MAAM,KAAM,GAAE,gBAAU,iBAAgB,OAA5B;5EAC3B,cAAM,MAAN,GAAgB,MAAM,MAAO,GAAE,gBAAU,iBAAgB,OAA5B;vEAH/B;PAH4B;AAAsB;AA5TA;AAElD,UAAY,4BAAD,QAAX,EACE,4BAAsB,CAAC,IAAD,CADxB;lFAFkD;AA3RG;AAErD;AAFqD;AAwpCQ;AAG7D;AAH6D;AAnpCX;AAElD;AAEA,YAAO,4CAAe,gBAAgB,CAAC,qBAAgB,EAAG,yBAApB;zHACtC,mCAAgC,CAAC,GAAD,SAAM,IAAI,CAAI,uCAAa,CAAC,GAAD,CAA3D;jGACA;AANkD;AAmDQ;AAE1D;AAF0D;AAsmCA;AAG1D;AAH0D;AAh2Cf;AAE3C;AACA;AAEA,eAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;hFAAI;AAEF,YAAK,IAAiB,YAAJ,CAAC,CAAD;9BAMlB,YAAQ,gCAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,gCAAH,CAAuD,YAAb,aAAC,CAAa,gBAAU,WAAvB,CADhD;/JAGA,YAAQ,yBAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,yBAAH,CAAgD,YAAb,aAAC,CAAa,gBAAU,WAAvB,CADzC;;jJAIF;AApB2C;AA2hDC;AAE5C;AACA;AAH4C;AApgDL;AAEvC;AAEA;AACA,UAAK;VACL,UAAG,wCAAa,wBAAwB,CAAC;;;;jEAAD,CAAxC;XAEE,wBAAU,MAAK,QAAC,CAAQ,kEAAR;zGAChB,wBAAU,MAAK,SAAC,CAAS,CAAT;lCAHlB;PAMA,UAAG,wCAAa,0BAA0B,CAAC;;;;nEAAD,CAA1C;XAEE,wBAAU,MAAK,QAAC,CAAQ,qEAAR;5GAChB,wBAAU,MAAK,WAAC,CAAW,CAAX;pCAHlB;PAZuC;AA+0CS;AAEhD;AACA,sBAAU,iBAAC,CAAiB,QAAjB;hDACX,sBAAU,MAAK,SAAC,CAAS,QAAT;9CAChB,sBAAU,QAAO,SAAC,CAAS,OAAT;/CAClB,sBAAU,MAAK,QAAC,CAAQ,qEAAR;1GAChB,sBAAU,QAAO,QAAC,CAAQ,oEAAR;3GAClB,sBAAU,MAAK,SAAC,CAAS,QAAT;9CAChB,sBAAU,MAAK,WAAC,CAAW,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B;xGATgC;AAhOJ;AAG5C;AACA,UAAG,gBAAU,UAAU,IAAI,CAAI,oBAA/B;7DAEE,6BAAiB,oCAAU,CAAC,oBAAe,CAAC,IAAD,EAAQ,gCAAM,CAAC,EAAG,CAAJ,CAA9B;lIAC3B,+BAAyB,sCAAN,gCAAM,CAAC,EAAG,CAAJ;lGAH3B;PAMA,UAAG,CAAI,kBAAP;7BAEE,YAAG,aAAH;zBAEE,uBAAS;vBACT;AACA;SAEG,UAAG,qBAAH;xCAEH,sCAAwB,oCAAU,CAAC,8BAAwB,gCAAM,CAAC,EAAG,CAAJ,CAA/B;9IAClC,cAAG,yBAAH;vCAEE;AACA;WAHF;FAHG;FARP;PAmBA,UAAW,CAAC,2BAAD,SAAsB,IAAI,CAAY,CAAP,MAAO,KAAE,mCAAkB,QAApB,CAAjD,EACE,2BAAmB,CAAC,IAAD,CADrB;/IA7B4C;AAiCA;AAE5C;AACA;AAAM;AACN;AACA;AAEA;AAEA,UAAG,aAAH;vBAEE,uBAAW;vBACX,sBAAU;tBACV,YAAG,WAAO,KAAG,YAAb,EACE,iBADF;pDAGG,UAAG,qBAAH;tCAEH,sCAA0B;tCAC1B,qCAAyB,oCAAU,CAAC,8BAAwB,gCAAM,CAAC,EAAG,CAAJ,CAA/B;7IACnC,YAAG,0BAAsB,KAAG,2BAA5B,EACE,iBADF;lFAJG;PAQL,UAAG,gBAAU,UAAb;pCAEE,YAAG,kBAAH;9BAEE,cAAG,CAAI,oBAAP;nCAEE;AACA,mCAAmB;xBAHrB;XAMA,cAAG,oBAAH;lCAEE,mBAAS,oBAAe,EAAG,GAAE,CAAF;7CAC3B,mBAAS,oBAAe,EAAG,GAAE,CAAF;7CAC3B,gBAAG,qBAAH;rCAME,mBAAY,sCAAN,gCAAM,CAAC,cAAK,GAAE,IAAF,CAAQ,aAAI,GAAE,IAApB;pIAGZ,kBAAa,2BAAH,eAAP,YAAO,CAAV;zEAEE,oBAAY,OAAP,aAAU,2BAAH;nEACZ,oBAAG,CAAC,WAAJ;hCAEE,sBAAG,EAAE,EAAG,GAAE,CAAC,YAAW,SAAQ,KAA9B,EACE,EAAE,EAAF,GAAQ,UAAK,CAAC,CAAC,YAAW,SAAQ,KAArB,CADf;xGAEA,sBAAG,EAAE,EAAG,GAAE,CAAC,YAAW,SAAQ,MAA9B;zDACE,sBAAE,EAAF,GAAQ,UAAK,CAAC,CAAC,YAAW,SAAQ,MAArB;lEACV,4BAAQ,CAAL,EAAE,EAAG,GAAE,eAAF,CAAQ,GAAU,CAAR,CAAC,SAAC,EAAM,GAAE,CAAC,YAAW,SAAQ,OAAtB,CAA1B,EACH,EAAE,EAAF,GAAQ,UAAK,CAAS,CAAR,CAAC,SAAC,EAAM,GAAE,CAAC,YAAW,SAAQ,OAAtB,CAA6B,GAAE,eAAxC,CADV;1LAGL,gCAAS,CAAC,UAAK,CAAC,EAAE,EAAH,EAAQ,UAAK,CAAC,EAAE,EAAH,EAAQ,gBAAO,gBAAlC;lFATX;FAHF;FATF;bAyBA,mCAAyB,sCAAN,gCAAM,CAAC,CAAE,GAAE,IAAF,CAAQ,CAAE,GAAE,IAAf;3HACzB,iCAAgB,CAAC,KAAM,IAAP;hCA9BlB;;XAmCA,cAAoB,qCAAf,oBAAe,CAAC,IAAD;5EACpB,cAAG,oCAAU,CAAC,EAAG,gCAAM,CAAC,EAAG,CAAJ,CAAV,CAAb;3FAEE,gBAAG,CAAI,gBAAP;jCAEE,iCAAe;jCACf,6BAAU,EAAV;lBAHF;FAMG,UAAG,gBAAH;rCAEH,+BAAe;/BACf,2BAAU,CAAV;jBAHG;;JAtDT;PA8DA,UAAY,2BAAD,QAAX,EACE,2BAAmB,CAAC,IAAD,CADrB;hFAtF4C;AArrBC;AAE7C;AACA,oBAAU;pBACV,mCAAyB;nCACzB,qBAAU,CAAV;tBACA,yBAAe;zBACf;AAP6C;AA+wBH;AAG1C;AACA,UAAG,kBAAH;5BACE;AACG,gBAAG,UAAM,IAAI,aAAb;3CAEH;AACA;AACA;OAEG,UAAwB,CAArB,yBAAqB,IAAI,qBAAJ,CAAoB,IAAI,CAAI,aAApD;vFAEH;AACA;AACA;OAJG;PAOL,2BAAiB;3BACjB,6BAAmB;7BACnB,mBAAS;nBACT,kCAAwB;lCAExB,UAAW,CAAC,yBAAD,SAAoB,IAAI,CAAY,CAAP,MAAO,KAAE,mCAAkB,QAApB,CAA/C,EACE,yBAAiB,CAAC,IAAD,CADnB;3IAxB0C;AA9KA;AAE1C;AACA;AAIA;AAEA,UAAY,oBAAD,QAAX;tCAEkB,iBAAhB,KAAgB;tBAChB,+BAAmB;xBAHrB;PAMA,6BAAmB,yBAAoB,QAAC,YAAM,CAAC,kBAAD,CAAN;9FACxC,0BAAe,OAAO,CAAC,IAAD;tCACtB,0BAAe,WAAC,CAAW,KAAX;3CAChB,0BAAe,MAAC,CAAY,IAAZ;rCAChB,0BAAe,cAAC,CAAc,KAAd;9CAChB,0BAAe,aAAC,CAAa,IAAb;5CAChB,0BAAe,qBAAC,CAAqB,KAArB;rDAChB,0BAAe,YAAW,aAAC,CAAa,KAAb;zDAC3B,0BAAe,kBAAkB,CAAC,EAAG,EAAG,EAAG,CAAV;pDACjC,0BAAe,UAAC,CAAU,gBAAO,GAAE,CAAnB;zDAEhB,eAAgC,MAAvB,qBAAgB,SAAC,EAAM,GAAE,CAAF,EAAW,eAA3C;1EAAI;AAEF,aAA4B,qBAAgB,WAAC,CAAD;9CAC5C,YAAY,EAAE,SAAH,QAAX;/BAEE,cAAkB,gCAAH,eAAZ,EAAE,SAAU,CAAf,EACe,OAAZ,EAAE,UAAa,gCAAH,CAAyC,UAAT,CAAuB,OAAZ,EAAE,UAAa,gCAAH,CAA8C,eAArE,CAD/C;9MAEA,YAAE,SAAS,WAAC,CAAW,IAAX;rCACZ,YAAE,SAAS,UAAC,CAAU,oBAAV;3CALd;;TASF,0BAAe;1BACf,wBAAa,kBAAC,CAAkB,oBAAlB;/DACd,wBAAa;xBACb;AAzC0C;AAxtBM;AAEhD;AAGA,UAAW,CAAC,YAAD,SAAS,IAAe,kCAAH,eAAP,YAAO,CAAhC,EACE,SAAS,SAA0C,QAA7B,OAAP,aAAU,kCAAH,CAA8B,iBAAd,EAAa,GAAE,CAAF,qBAAnD;jOAAI;AACF,YAA0C,yBAAH,eAA5B,OAAP,aAAU,kCAAH,CAA8B,YAAN,CAAC,CAAD,CAAI,CAAvC,EACuC,OAA5B,OAAP,aAAU,kCAAH,CAA8B,YAAN,CAAC,CAAD,EAAO,yBAAH,CAA2C,oBADlF;lPAFJ;PALgD;AAoEL;AAE3C,UAAY,oBAAD,QAAX,EACE,oBAAc,CAAC,IAAD,CADhB;lEAF2C;AAgsBA;AAE3C;AACA,UAAY,0BAAD,QAAX,EACE,0BAAkB,CAAC,IAAD,CADpB;9EAH2C;AA4sCC;AAE5C,UAAY,uBAAD,QAAX,EACE,uBAAiB,CAAC,IAAD,CADnB;xEAF4C;AA1xCK;AAUjD,cAAQ,UAAC,CAAU,IAAV;7BACT,UAAG,MAAO,GAAE,CAAC,CAAb,EACE,kBAAa,CAAC,SAAU,MAAX,CADf;1DAIA,UAAY,6BAAD,QAAX,EACE,6BAAuB,CAAC,QAAD,CADzB;xFAfiD;AAhmBJ;AAE7C,UAAY,sBAAD,QAAX,EACE,sBAAgB,CAAC,KAAM,QAAS,OAAhB,CADlB;tFAF6C;AAg3CD;AAG5C;AACA;AAJ4C;AAloCD;AAAf;AAE5B;AACA;AAEA,UAAK;VACL,UAAK;VACL,UAAG,WAAM,KAAE,uCAAX,EACE,IAAK,IADP;3EAGA,UAAG,YAAH;tBACE,iBAAe,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,KAAM,CAAC,KAAM,GAAK,CAAF,CAAE,GAAE,CAAF,CAAL,CAAW,CAAC,OAAnC;5HAEf,qBAAe,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,KAAM,GAAK,CAAF,CAAE,GAAE,CAAF,CAAL,CAAW,CAAC,OAAQ,GAAE,CAArD;5IAbW;AAAe;AA/eC;AAE5C;AACA;AACA;AAEA,0BAAgB;1BAChB,2BAAgB;3BAChB,eAA2B,MAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,EAAW,eAAtC;jEAAI;AAEF,YAAK,IAAiB,YAAJ,CAAC,CAAD;9BAMlB,YAAG,CAAE,KAAG,uBAAR;zCAEE,eAAM,0BAAqB,QAAC;jDAC5B,YAAE,SAAF,GAAe;xBACf,cAAQ,gCAAH,eAAF,CAAE,CAAL;/DAEE,cAAE,QAAF,GAAiB,OAAF,EAAK,gCAAH,CAAuC;nEACxD,gBAAqD,CAA9C,OAAF,EAAK,gCAAH,CAA+C,eAAD,KAAE,uCAAF,CAAW,IAA+C,CAAvC,OAAF,EAAK,gCAAH,CAAyC,QAAF,KAAG,uCAAH,CAA/G,EACK,OAAF,EAAK,gCAAH,CAAgD,iBAAhB,CAAoB,OAAF,EAAK,gCAAH,CAA8C,eAAlE,CADrC;xUAHF;XAOA,cAAQ,gCAAH,eAAF,CAAE,CAAL;/DACE,cAAE,cAAF,GAAuB,OAAF,EAAK,gCAAH,CACrB;zEACF,gBAAA,EAAE,cAAF,GAAoB,CAAC;pCAEvB,WAAC,UAAC,CAAU,IAAV;1BACF,WAAC,WAAC,CAAW,KAAX;5BACF,+BAAgB,MAAI,CAAC,EAAD;/BAlBtB;;TAqBF,0BAAgB;1BAChB;AACA;AAvC4C;AAyyCE;AAE9C;AACA;AACA;AAEA,0BAAgB;1BAChB,eAAgC,MAAvB,qBAAgB,SAAC,EAAM,GAAE,CAAF,EAAW,eAA3C;1EAAI;AAEF,aAA4B,qBAAgB,WAAC,CAAD;9CAC5C,YAAK,EAAE;dACP,YAAY,CAAD,QAAX;rBAEE,cAAQ,gCAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,gCAAH,CAA+C,aAAlD,GAAmD,IADrD;/HAEA,WAAC,UAAC,CAAU,IAAV;1BACF,WAAC,WAAC,CAAW,IAAX;3BACF,cAAQ,gCAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,gCAAH,CAA+C,aAAlD,GAAmD,KADrD;vHANF;;TAWF,0BAAgB;1BAChB;AAEA;AAzB8C;AA5pBJ;AAE1C;AAF0C;AAtYE;AAE5C,UAAY,qBAAD,QAAX,EACE,qBAAe,CAAC,KAAM,SAAU,YAAjB,CADjB;1FAF4C;AA2YK;AAEjD;AACA;AACA;AACA;AACA;AAEA,UAAG,CAAY,CAAC,MAAD,SAAf,EACE,MADF;nCAGA,0BAAgB;1BAEhB,UAAY,OAAP,OAAU,+BAAH;vDAEZ,WAAM,qBAAgB,CAAC,CAAD;lCACtB,UAAY,EAAD,QAAX;pBAEE,aAAM,EAAE;fACR,cAAO,QAAG,CAAC,EAAG,QAAG,CAAC,wBAAc,EAAE,cAAe,GAAE,0BAAqB,CAAC,EAAD,CAAvD,CAAP;5GACV,4BAAe,SAAO,CAAC,EAAD;xCACtB,iCAAoB,CAAC,GAAI,GAAL;xCACpB,UAAE,WAAC,CAAW,IAAX;;1BAIH,aAAM,0BAAqB,QAAC;/CAE5B,YAAQ,gCAAH,eAAF,CAAE,CAAL;7DACE,YAAE,cAAF,GAAuB,OAAF,EAAK,gCAAH,CACrB;vEACF,cAAA,EAAE,cAAF,GAAoB,CAAC;lCAEvB,UAAE,SAAF,GAAe;tBACf,4BAAgB;5BAEhB,cAAqB,CAAC;fAKtB,4BAAgB;5BAChB,UAAE,QAAQ,OAAO,CAAC,GAAD;7BACjB,WAAI,eAAJ,GAAI;7BACJ,4BAAe,MAAI,CAAC,EAAD;rCACnB,SAAC,UAAC,CAAU,IAAV;xBACF,SAAC,WAAC,CAAW,KAAX;;1BAGJ,0BAAgB;1BAChB;AAlDiD;AAqeF;AAE/C;AAEA,UAAY,8BAAD,QAAX;hDACE,sCAAwB,CAAC,IAAD;;3CAOxB,aAAY,sCAAN,gCAAM,CAAC,uBAAkB,QAAC,GAAM,uBAAkB,OAAC,EAA7C;tJAEZ,aAAqB,sCAAf,oBAAe,CAAO,sCAAN,gCAAM,CAAC,EAAE,GAAI,EAAE,EAAG,GAAE,uBAAkB,UAAC,EAAjC,EAAP;hMACrB,4BAAe,CAAC,EAAE,GAAI,EAAE,EAAT;;tCAf8B;AAn6BC;AAEhD;AACA;AAEA,wBAAa,kBAAC,CAAkB,IAAlB;/CAEd,eAAS,SAA4B,QAAvB,qBAAgB,SAAC,EAAM,GAAE,CAAF,qBAArC;zFAAI;AAEF,aAA4B,qBAAgB,WAAC,CAAD;9CAC5C,YAAY,EAAE,SAAH,QAAX;/BAEE,cAAkB,gCAAH,eAAZ,EAAE,SAAU,CAAf,EACe,OAAZ,EAAE,UAAa,gCAAH,CAAyC,UAAT,CAAU,EAAE,QAAZ,CAD/C;rJAGA,YAAE,SAAS,UAAC,CAAU,IAAV;pCACZ,YAAE,SAAS,WAAC,CAAW,KAAX;7BANd;;TAUF,UAAY,oBAAD,QAAX;tCAEkB,iBAAhB,KAAgB;tBAChB,+BAAmB;xBAHrB;PApBgD;AAy3BP;AAGzC;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,qBAAF,CAA1C,EACE,wBAAoB,IADtB;jIAGA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,uBAAF,CAA1C,EACE,0BAAsB,IADxB;rIAPyC;AAhyBC;AAE1C;AACA;AAH0C;AAwhCW;AAErD;AACA;AAHqD;AA6UV;;AAE3C;AACA;AACA;AACA;AACA;AAMA;AAAM;AAAG;AAAG;AAAG;AAAG;AAAI;AAAK;AAAI;AAAI;AAAI;AAAM;AAM7C;AAEA;AAEA;AAEA;AACA;AACA;AAAI;AAAI;AAAI;AAEO;AAAV;AAEP,iBAAU;jBAEV,YAAW,CAAP,MAAO,IAAG,CAAH,CAAM,IAAY,CAAP,MAAO,IAAqB,CAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,CAArB,CAA7B;tEAEE,cAAG,IAAkC,YAArB,CAAC,MAAD,CAAQ,SAAxB;/CAEE,qBAAU,IAAsB,YAAT,CAAC,MAAD;5CACvB;WAHF;FAFF;TASA,eAAc,CAAP,MAAO,IAAG,CAAH,CAAM,IAAY,CAAP,MAAO,IAAqB,CAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,CAArB,CAAhC;zEAEM,gBAAJ,IAAG;pBACH,cAAW,CAAP,MAAO,IAAG,CAAH,CAAM,IAAY,CAAP,MAAO,IAAqB,CAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,CAArB,CAA7B;xEAEE,gBAAG,IAAkC,YAArB,CAAC,MAAD,CAAQ,SAAxB;jDAEE,uBAAU,IAAsB,YAAT,CAAC,MAAD;9CACvB;aAHF;FAFF;;XAhBK;AAAU;AA5BwB;AAuD3C,YAA6C,CAAb,CAAhB,CAAb,iBAAa,IAAG,iBAAH,CAAgB,IAAG,gBAAH,CAAa,IAAG,mBAAH,CAAgB,IAAG,CAAI,uBAApE,EACE,MADF;vIAGA,4BAAgB;5BAMhB,aAAM,UAAK,CAAC,gBAAU,mBAAX;3DACX,aAAM,UAAK,CAAC,gBAAU,iBAAX;zDAGX,YAAK;ZACL,YAAG,gBAAU,UAAb;tCAME,cAAK,CAAE,GAAE,UAAK,CAAC,qBA5yEkC,MA4yEnB,MAAhB,CAAP;/DAEP,cAAG,EAAG,KAAE,CAAR,EACE,IAAK,CAAE,GAAE,CADX;xBARF;TAYA,YAAK;ZAEL,aAAM;bACN,aAAM;bAEN,cAAO;dACP,eAAQ;fACR,eAAQ;fACR,aAAM;bACN,YAAG,EAAE,GAAI,GAAE,CAAX,EACE,OAAQ,UAAK,CAAC,EAAE,GAAI,GAAE,CAAT,CADf;nDAGA,YAAG,EAAE,GAAI,GAAE,CAAX,EACE,OAAQ,UAAK,CAAC,EAAE,GAAI,GAAE,CAAT,CADf;nDAGA,YAAK;ZACL,eAAQ;fACR,YAAK;ZACL,cAAO;dAEP,aAAM;bACN,iBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;lFAAI;AAEF,cAAK,IAAiB,YAAJ,CAAC,CAAD;hCAMlB,eAAM,qBAAgB,CAAC,CAAD;tCACtB,eAAM,CAAY,CAAC,EAAD;nBAClB,cAAG,EAAH,EACE,KADF;;vBAIF,YAAK;ZACL,iBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;lFAAI;AAEF,cAAK,IAAiB,YAAJ,CAAC,CAAD;hCAOlB,cAAG,uBAAQ,CAAC,EAAG,qDAAqB;;;;/EAAzB,CAAX,EACE,EAAE,gBAAC,CAAgB,sBAAhB,CADL;3DAIA,cAAG,CAAH;fAEE,gBAAK;hBACL,gBAAQ,CAAH,EAAG,GAAE,CAAF,CAAI,GAAE,EAAF;7BACZ,iBAAM;NAJR;XAOA,cAAK;dACL,cAAQ,gCAAH,eAAF,CAAE,CAAL;/DAEE,gBAAQ,OAAF,EAAK,gCAAH,CAA4C;1DACjD,mBAAF,EAAK,gCAAH,CAAkD,iBAArD,GAAsD;1EACnD,mBAAF,EAAK,gCAAH,CAAyD,wBAA5D,GAA6D;tEAJ/D;XAOA,8BAAe,CAAC,EAAG;;;;nBAAJ;dAEf,cAAG,CAAH,EACE,IAAK,IADP;zBAGA,cAAG,CAAO,CAAF,CAAE,KAAE,uBAAF,CAAV;9CAEE,gBAAG,EAAH;lBAEE,kBAAQ,gCAAH,eAAF,CAAE,CAAL;nEACK,uBAAF,EAAK,gCAAH,CAA+C,cAAlD,GAAmD;3EAEnD,oBAAA,CAAC,OAAD,GAAS;lBALb;bAQA,gBAAG,CAAC,SAAJ;1BAkDE,kBAAG,CAAC,kBAAJ;rCAEE,oBAAG,eAAH;nCAEE,mBAAC,QAAC,CAAQ,CAAE,GAAE,CAAC,SAAQ,MAArB;hDACF,mBAAC,OAAC,CAAO,CAAE,GAAE,CAAC,SAAQ,KAApB;7BAHJ;jBAMA,oBAAG,uBAAkB,IAAuC,CAA7B,gCAAH,eAAF,CAAE,CAAgC,IAA+C,CAAvC,OAAF,EAAK,gCAAH,CAAwC,QAAD,KAAE,wCAAF,CAA/C,CAA5D;vMAEE,sBAA+B,CAAnB,CAAP,gBAAO,GAAE,CAAC,SAAQ,QAAX,CAAmB,GAAE,IAAF,CAAO,GAAE,CAAF;1EACtC,mBAAC,UAAC,CAAU,CAAV;dAGF,UAAK,QAAG,CAAC,EAAoB,CAAX,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,QAArC;9FAEV,qBAAM,UAAU,CAAC,CAAE,GAAE,CAAL;rCAChB,oBAAW,CAAC,EAAD,SAAK,IAAW,gCAAH,eAAH,EAAG,CAAxB;tFAEoD,8BAAzC,OAAH,GAAM,gCAAH,CAAyC;zEAChD,uBADgD,KAChD,mDAAW,CADqC,KACrC,8CAAX;nIAEE,wBAAK,QAAG,CAAC,EAAoB,CAAX,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,QAArC;3FACR,wBAAsB,CAAjB,CAAF,CAAE,GAAE,EAAE,SAAQ,KAAZ,CAAiB,GAAE,EAAE,UAAC,EAAL,CAAY,GAA6B,CAApB,CAAP,gBAAO,GAAE,EAAE,SAAQ,QAAZ,CAAoB,GAAE,IAAF,CAA/D;rHAEE,0BAAK,QAAG,CAAC,EAAG,QAAG,CAAC,KAAuB,CAAV,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,OAAxC,CAAP;3GACR,0BAAK;;1BAIL,uBAAC,QAAC,CAAQ,CAAE,GAAE,CAAC,SAAQ,MAArB;pDACF,6BAAQ,QAAG,CAAC,EAAG,QAAG,CAAC,KAAuB,CAAV,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,OAAxC,CAAP;;3FAGf,WAfgD,KAehD,iDAAS,CAfuC,KAevC,8CAAT;xIAEE,wBAAK,QAAG,CAAC,EAAoB,CAAV,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,OAArC;1FACR,wBAAK;LAHP;;nBASF,sBAAK,QAAG,CAAC,EAAG,QAAG,CAAC,KAAuB,CAAV,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAAF,CAAK,GAAE,CAAC,SAAQ,OAAxC,CAAP;vGACR,sBAAK;;;tBAKP,oBAAG,eAAH;nCAEE,mBAAC,QAAC,CAAQ,CAAR;7BACF,mBAAC,OAAC,CAAO,CAAP;XAHJ;jBAMA,oBAAG,uBAAkB,IAAuC,CAA7B,gCAAH,eAAF,CAAE,CAAgC,IAA+C,CAAvC,OAAF,EAAK,gCAAH,CAAwC,QAAD,KAAE,wCAAF,CAA/C,CAA5D;vMAEE,sBAAY,CAAP,gBAAO,GAAE,IAAF,CAAO,GAAE,CAAF;nDACnB,mBAAC,UAAC,CAAU,CAAV;dAGF,UAAK,QAAG,CAAC,EAAS,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,EAAvB;vEAEV,qBAAM,UAAU,CAAC,CAAE,GAAE,CAAL;rCAChB,oBAAW,CAAC,EAAD,SAAK,IAAW,gCAAH,eAAH,EAAG,CAAxB;tFAEoD,8BAAzC,OAAH,GAAM,gCAAH,CAAyC;zEAChD,uBADgD,KAChD,mDAAW,CADqC,KACrC,8CAAX;nIAEE,wBAAK,QAAG,CAAC,EAAS,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,EAAvB;pEACR,wBAAK,CAAF,CAAE,GAAE,EAAE,UAAC,EAAL,CAAY,GAAS,CAAP,gBAAO,GAAE,IAAF,CAA1B;xEAEE,0BAAK,QAAG,CAAC,EAAG,QAAG,CAAC,KAAa,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAA1B,CAAP;rFACR,0BAAK;;1BAIL,uBAAC,QAAC,CAAQ,CAAR;jCACF,6BAAQ,QAAG,CAAC,EAAG,QAAG,CAAC,KAAa,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAA1B,CAAP;;rEAGf,WAfgD,KAehD,iDAAS,CAfuC,KAevC,8CAAT;xIAEE,wBAAK,QAAG,CAAC,EAAU,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAAvB;pEACR,wBAAK;LAHP;;nBASF,sBAAK,QAAG,CAAC,EAAG,QAAG,CAAC,KAAa,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,EAA1B,CAAP;jFACR,sBAAK;;;tBAmDT,kBAAK,QAAG,CAAC,EAAG,CAAJ;jBAhMV;bAkMI,eAAJ,IAAG;RA5ML;;XAgNF,YAAG,CAAE,KAAE,CAAP,EACE,IAAK,GADP;5BAGA,+BAAkB,WAAC,CAAW,iBAAW,YAAtB;xEACnB,YAAG,iBAAW,YAAd;zCACE,iCAAkB,UAAC,CAAU,IAAV;hDAEA,cAAnB,uBAAkB,UAAC,CAAU,IAAV;pDAuDrB,YAAG,uBAAkB,SAArB;5CAEE,iCAAkB,cAAlB,GAAmC,IAAmB,iBAAd,EAAa,GAAE,CAAF;7EAMrD,iCAAkB,OAAC,CAAO,uBAAkB,SAAQ,KAAjC;9EACnB,gBAAO,uBAAkB;vCACzB,cAAG,CAAI,uBAAkB,kBAAzB;xDAEE,eAAG,QAAC,CAAQ,CAAR;zBACJ,eAAG,OAAC,CAAO,CAAP;xBACJ,eAAG,SAAC,CAAS,CAAT;1BACJ,eAAG,UAAC,CAAU,CAAV;hBALN;XASA,cAAG,cAAH;5BAEE,mCAAkB,QAAC,CAAQ,CAAE,GAAE,GAAG,MAAf;zDACnB,gBAAG,gBAAH;hCACE,qCAAkB,UAAC,CAAY,CAAF,CAAE,GAAE,GAAG,QAAL,CAAa,GAAE,GAAG,KAA9B;5EAChB,sBAAG,uBAAH,EACH,uBAAkB,UAAC,CAA8B,CAAb,CAAP,gBAAO,GAAE,GAAG,QAAL,CAAa,GAAE,IAAF,CAAO,GAAE,GAAG,KAA1C,CADhB;;tIAKL,mCAAkB,QAAC,CAAc,CAAN,eAAM,GAAE,uBAAkB,SAAC,EAArB,CAA2B,GAAE,GAAG,OAA9C;/GACnB,mCAAkB,UAAC,CAA8B,CAAb,CAAP,gBAAO,GAAE,GAAG,QAAL,CAAa,GAAE,GAAG,KAAL,CAAU,GAAE,IAA1C;;lGAErB,cAAkC,CAA3B,CAAF,CAAE,GAAE,uBAAkB,SAAC,EAArB,CAA2B,GAAE,GAAG,OAAL,CAAY,GAAE,GAAG,MAAL;xEAhChD;TAmCA,YAAG,cAAH;1BAEE,cAAG,gBAAU,WAAb,EACE,IAAK,CAAE,GAAE,UAAK,CAAC,gBAAU,iBAAgB,OAA3B,CADhB;vGAGA,cAAK,UAAK,CAAC,QAAG,CAAC,mBAAc,CAAf,CAAJ;vDAEV,cAAG,0BAAiB,KAAE,gEAAtB;7GAEE,iBAAM;jBACN,iBAAM;jBACN,iBAAM;jBACN,iBAAM;jBACN,kCAAiB,CAAC;;;;lBAAI;;;;AAAI;;;;AAAI;;;;DAAb;hBACjB,gBAAK,CAAE,GAAE,UAAK,CAAC,EAAG,GAAE,EAAN,CAAP;5BAPT;XAUA,cAAK,CAAE,GAAE,IAAF;tBAEP,cAAc,CAAX,gBAAW,IAAI,eAAJ,CAAc,IAAsB,CAAjB,0BAAiB,KAAE,gEAAF,CAAlD;xJACE,0BAAS,CAAC,eAAM,cAAK,EAAG,CAAf;3DACN,oBAAG,gBAAW,IAAI,CAAsB,CAAjB,0BAAiB,IAAG,cAAC,iEAAQ,kEAAS,kEAAlB,CAAH,CAAxC;7RACH,0BAAS,CAAC,eAAM,cAAK,gBAAO,CAAnB;zEACN,oBAAG,eAAU,IAAI,CAAsB,CAAjB,0BAAiB,IAAG,cAAC,gEAAO,mEAAU,kEAAlB,CAAH,CAAvC,EACH,cAAS,CAAC,eAAM,cAAK,EAAG,gBAAf,CADN;pVAvBP;TA4BA,YAAY,sBAAD,QAAX,EACE,sBAAgB,CAAC,IAAD,CADlB;xEAGA,4BAAgB;5BAte2B;AAsB3C;AAtB2C;;AAn0CF;;AAEzC;AAEkB;AAEhB;AACA;AACA;AAEA,YAAG,WAAM,KAAE,uCAAX;nEACE,eAAM;fAEN,mBAAM;nBAER,aAAK,KAAL,GAAc,KAAK;1BACnB,aAAK,IAAL,GAAa,KAAK;zBAClB,cAA2B,WAApB,UAAK,CAAC,KAAK,OAAN,CAAe,GAAe,CAAV,UAAK,CAAC,EAAD,CAAK,GAAE,CAAF,CAAf;xEAC3B,iBAAS,SAAK,gCAAd;1DAAI;AAEF,gBAAY,qCAAL,+BAAK,CAAC,KAAK,KAAM,GAAoC,CAAN,CAAd,CAAZ,KAAK,MAAO,GAAE,KAAK,KAAP,CAAc,GAAE,EAAF,CAAM,GAAE,CAAF,CAApC,CAAyC,KAAK,IAAK,GAAE,CAAF,CAAgB,CAAX,KAAK,KAAM,GAAE,EAAF,CAAK,GAAoC,CAAN,CAAd,CAAZ,KAAK,MAAO,GAAE,KAAK,KAAP,CAAc,GAAE,EAAF,CAAM,GAAE,CAAF,CAApC,CAAmD,CAAV,KAAK,IAAK,GAAE,CAAF,CAAI,GAAE,EAA7I;xOACZ,gBAAY,qCAAL,+BAAK,CAAC,cAAG,CAAC,GAAG,KAAJ,EAAY,cAAG,CAAC,GAAG,IAAJ,EAAW,cAAG,CAAC,GAAG,MAAJ,EAAa,cAAG,CAAC,GAAG,OAAJ,CAAjD;1LACZ,mBAAS,gBAAc,CAAC,0CdxzDmE,6EcwzDpE;3JACvB,eAAK,IAAL,GAAa,KAAK,IAAK,GAAK,CAAH,EAAG,GAAE,CAAF,CAAL;;1CAnBT;AAuBlB;AAEA,eAAS,MAAK,SAAC,CAAS,gBAAU,eAAnB;9DACf,eAAS,MAAK,QAAC,CAAQ,kEAAR;hGACf,UAAK,0DA77B8C,MA67B9C;1EACL,cAAQ,CAAC,uCAAD;tDAhCiC;AAmCJ;AAErC;AAAI;AACJ;AAEA,UAAG,iBAAY,IAAU,CAAL,UAAK,KAAG,EAAH,CAAzB;lDAEE,aAAM;bACN,YAAG,gBAAU,UAAb;tCAEE,cAAG,WAAM,KAAE,uCAAX;rEACE,iBAAM;jBAEN,qBAAM;ZALV;TAQA,YAAK;ZACL,YAAU,qCAAL,+BAAK,CAAC,CAAC,KAAM,GAAE,EAAF,CAAM,CAAC,KAAM,CAAC,OAAQ,CAAC,OAA/B;nHACV,+CAAa,CAAC;;;;nCAAG,CAAC,EAAG,CAAC,CAAT;lBAEb,iBAAS,MAAK,OAAO,CAAC,YAAD;3CAErB,YAAK,kBAAW;9BAEhB,YAAU,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,OAAQ,GAAE,CAAF,CAAK,CAAC,OAAQ,CAAC,OAAjC;rHACV,iBAAS,WAAS,CAAC,wCAAG,WAAM,mBAAc,0BAAqB,wBAAmB,ed9vDgL,EAC5O,CAAC,EAAwB,CAAC,EAAwD,KAA6B,MAAoB,CAAC,EAAgB,CAAE,Cc6vD1J;rLApBpB;PALqC;AAg5BS;AAG9C;AAEA,UAAyB,qCAApB,yBAAoB,CAAC,2CAAD;pHACzB,eAAS,iBAAT,GAA6B;nCAC7B,eAAS,iBAAiB,CAAC,wCAAG,qBdpqF+D,EAA2B,KAChG,MAA0B,KAA2B,KcmqFnD;rHAPoB;AAoBF;AAE5C;AACA;AAEA,UAAG,CAAI,iBAAY,IAAS,CAAL,UAAK,KAAE,EAAF,CAA5B,EACE,MADF;3DAGA,WAAM;XACN,WAAM,SAAS,WdloF6B;/BcmoF5C;AACE,iBAAS,SAAS,CAAC,wCAAD;nEAClB,iBAAS,MAAK,OAAO,CAAC,YAAD;3CACrB,iBAAS,WAAS,CAAC,yCAAI,WAAM,mBAAc,0BAAqB,wBAAmB,edtpF+K,EAC5O,CAAC,EAAwB,CAAC,EAAwD,KAA6B,MAAoB,CAAC,EAAgB,CAAE,CcqpF1J;7LAHpB;AAKE,iBAAS,aAAa,CAAC,GdlxFyD,KckxF1D;vCALxB;AAV4C;AAVI;AAEhD;AAEA,UAAK;VACL,UAAU,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,OAAQ,GAAE,EAAF,CAAM,CAAC,OAAQ,CAAC,OAAlC;pHACV,6CAAa,CAAC;;;;nCAAG,CAAC,EAAG,CAAC,CAAT;hBACb,eAAS,iBAAiB,CAAC,wCAAG,6Bd9qF+D,EAA2B,KAChG,MAA0B,KAA2B,Kc6qFnD;7HAPsB;AA4WJ;;AA9xDT;AAEnC;AAAG;AACH;AAEA;AACA,UAAa,yBAAH,eAAP,MAAO,CAAV;zDAEE,+BAAkB,OAAO,CAAS,OAAP,OAAU,yBAAH,CAA2C,mBAApD;lGACzB,uCAA0B,OAAO,CAAS,OAAP,OAAU,yBAAH,CAAmD,2BAA5D;lHACjC,gCAA4B,OAAP,OAAU,yBAAH,CAAyC;xEACrE,4BAAe,OAAO,CAAS,OAAP,OAAU,yBAAH,CAAwC,gBAAjD;5FACtB,wBAAoB,OAAP,OAAU,yBAAH,CAAiC;hEACrD,2BAAuB,OAAP,OAAU,yBAAH,CAAoC;nEAC3D,6BAAyB,OAAP,OAAU,yBAAH,CAAsC;rEAC/D,6BAAyB,OAAP,OAAU,yBAAH,CAAsC;rEAC/D,kCAA8B,OAAP,OAAU,yBAAH,CAA2C;1EACzE,sCAAkC,OAAP,OAAU,yBAAH,CAA+C;9EACjF,oCAAuB,OAAO,CAAS,OAAP,OAAU,yBAAH,CAAgD,wBAAzD;5GAC9B,oCAAuB,OAAO,CAAS,OAAP,OAAU,yBAAH,CAAgD,wBAAzD;5GAC9B,qCAAiC,OAAP,OAAU,yBAAH,CAA8C;7EAC/E,qBAAiB,OAAP,OAAU,yBAAH,CAA8B;7DAC/C,4BAAwB,OAAP,OAAU,yBAAH,CAAqC;pEAC7D,6BAAyB,OAAP,OAAU,yBAAH,CAAsC;rEAC/D,oCAAgC,OAAP,OAAU,yBAAH,CAA6C;5EAC7E,kCAA8B,OAAP,OAAU,yBAAH,CAA2C;1EACzE,yBAAqB,OAAP,OAAU,yBAAH,CAAkC;jEACvD,oBAAK,OAAO,CAAS,OAAP,OAAU,yBAAH,CAA8B,QAAvC;5EACZ,yBAAqB,OAAP,OAAU,yBAAH,CAAkC;jEACvD,2BAAuB,OAAP,OAAU,yBAAH,CAAoC;nEAC3D,0BAAsB,OAAP,OAAU,yBAAH,CAAmC;lEACzD,0BAAsB,OAAP,OAAU,yBAAH,CAAmC;lEACzD,kCAA8B,OAAP,OAAU,yBAAH,CAA2C;1EACzE,gCAA4B,OAAP,OAAU,yBAAH,CAAyC;xEACrE,wBAAW,OAAO,CAAS,OAAP,OAAU,yBAAH,CAAoC,YAA7C;pFAClB,iBAAS,SAAmD,QAAtC,OAAP,OAAU,yBAAH,CAAuC,iBAAd,EAAa,GAAE,CAAF,qBAA5D;tHAAI;AAEF,eAAc,OAAP,OAAU,yBAAH,CAAqC,YAAJ,CAAC,CAAD;rEAC/C,cAAwC,CAA7B,gCAAH,eAAH,EAAG,CAAgC,IAAQ,OAAH,GAAM,gCAAH,CAAwC,SAAhD,CAAiD,IAAG,CAAyC,CAA7B,gCAAH,eAAH,EAAG,CAAgC,IAAW,+BAAH,eAAH,EAAG,CAAR,CAArI;xOAEE,gBAAS,gCAAH,eAAH,EAAG,CAAN,EACM,OAAH,GAAM,gCAAH,CAA4C,WAAhD,GAAiD,KADnD;lIAGA,gBAA6B,OAAvB,sCAAY,MAAM,CAAC,EAAD,EAAQ,+BAAH;vGAC7B,gBAAS,gCAAH,eAAH,EAAG,CAAN,EACM,OAAH,GAAM,gCAAH,CAA4C,WAAhD,GAAiD,IADnD;jIAGA,iCAAgB,CAAC,EAvX4C,CAAC,CAuX9C;3BATlB;;XAYF;OAGA;PArDiC;AAqNE;AAErC;AAEA;AACA,6BAAmB,oCAA+B,QAAC;zEACnD,8BAAoB,oCAA+B,QAAC;1EA2BpD,oBAAU;pBACV,yBAAe,6BAAwB,QAAC,YAAM,CAAC,IAAD,CAAN;hFACxC,gCAAsB,oCAA+B,QAAC,YAAM,CAAC,IAAD,CAAN;9FACtD,6BAAkB,UAAlB,GAAgC;1CAChC,wCAA8B,4CAAuC,QAAC,YAAM,CAAC,IAAD,CAAN;9GACtE,qCAA0B,UAA1B,GAAwC;lDACxC,6BAAmB,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;rGACxC,0BAAe,UAAf,GAA6B;vCAC7B,0BAAgB,8BAAyB,QAAC,YAAM,CAAC,IAAD,CAAN;lFAC1C,2BAAiB;3BACjB,2BAAiB;3BACjB,gCAAsB;hCACtB,oCAA0B;pCAC1B,mCAAyB;nCACzB,qCAA2B,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;7GAChD,kCAAuB,UAAvB,GAAqC;/CACrC,qCAA2B,8CAAoB,QAAC,YAAM,CAAC,IAAD,CAAN;7GAChD,kCAAuB,UAAvB,GAAqC;/CACrC,yBAAe;zBACf,8BAAoB;9BACpB,sBAAY;tBACZ,uBAAa;vBACb,wBAAc;xBACd,yBAAe;zBACf,wBAAc;xBACd,gCAAsB;hCACtB,8BAAoB;9BACpB,gCAAsB,gCAAyB,QAAC,YAAM,CAAC,IAAD,CAAN;1FAChD,6BAAkB,YAAW,YAAW,QAAC,CAAQ,kEAAR;hIACzC,UAAK;VACL,6BAAkB,YAAW,YAAW,SAAC,CAAS,CAAT;hEACzC,6BAAkB,YAAW,mBAAC,CAAmB,KAAnB;lEAC9B,6BAAkB,YAAW,YAAC,CAAY,CAAZ;vDAE9B,6BAAkB,YAAW,WAAU,OAAO,CAAC,uBAAkB,YAAW,YAA9B;3GAC9C,6BAAkB,YAAW,cAAa,OAAO,CAAC,uBAAkB,YAAW,YAA9B;9GACjD,6BAAkB,YAAW,UAAS,OAAO,CAAC,uBAAkB,YAAW,YAA9B;1GAE7C,6BAAkB,YAAW,WAAU,SAAC,CAAS,QAAT;tEACxC,6BAAkB,YAAW,UAAS,SAAC,CAAS,QAAT;rEACvC,6BAAkB,YAAW,cAAa,SAAC,CAAS,QAAT;zEAG3C,6BAAkB,oBAAC,CAAoB,IAApB;tDAInB,6BAAkB,SAAQ,OAAC,CAAO,CAAP;/CAC3B,6BAAkB,SAAQ,UAAC,CAAU,CAAV;lDAC3B,6BAAkB,SAAQ,SAAC,CAAS,CAAT;jDAQ3B,6BAAkB,SAAlB,GAA8B;zCAC9B,8BAAoB,oCAAU,QAAC,YAAM,CAAC,IAAD,CAAN;5FAK/B,6BAAkB,SAAlB,GAA8B;zCAC9B,6BAAkB,SAAC,CAAS,EAAT;zCACnB,6BAAkB,QAAC,CAAQ,EAAR;xCACnB,6BAAkB,QAAlB,GAA6B;xCAE7B,6BAAkB,SAAQ,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;hKAChD,6BAAkB,SAAQ,wBAAsB,CAAC,6DAA+B,sCAAW,GAA3C;rKAChD,6BAAkB,iBAAgB,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;xKACxD,6BAAkB,iBAAgB,wBAAsB,CAAC,6DAA+B,sCAAU,GAA1C;7KACxD,6BAAkB,cAAa,wBAAsB,CAAC,wDAA0B,sCAAW,GAAtC;rKACrD,6BAAkB,cAAa,wBAAsB,CAAC,6DAA+B,sCAAU,GAA1C;1KAErD,kCAAwB;lCACxB,gCAAsB;hCACtB,uBAAa;vBACb,2BAAiB;3BACjB,0BAAgB;1BAEhB,qBAAS,qDAAmB,QAAC;lFAE7B,2BAAiB,wBAAmB,QAAC,YAAM,CAAC,IAAD,CAAN;7EACrC,wBAAa,cAAb,GAA8B;zCAC9B,wBAAa,oBAAC,CAAoB,IAApB;jDAEd,kCAAuB,wBAAsB,CAAC,gDAAoB,sCAAW,GAAhC;pJAC7C,kCAAuB,wBAAsB,CAAC,sDAAwB,sCAAW,GAApC;1JAzHR;AA8IA;AAEb,eAAxB,KAAwB;pBACA,eAAxB,KAAwB;pBACV,eAAd,KAAc;pBACa,eAA3B,KAA2B;pBACR,eAAnB,KAAmB;pBACH,eAAhB,KAAgB;pBACV,eAAN,KAAM;pBACO,eAAb,KAAa;pBACD,eAAZ,KAAY;pBACI,eAAhB,KAAgB;pBACC,eAAjB,KAAiB;pBACjB;AAbqC;AAq+BJ;AAEjC;AAAI;AACJ;AAEA;AAEA,UAAK;VAEL,UAAG,aAAH;vBAEE,YAAG,UAAH;tBAEE,mBAAS,MAAK,OAAO,CAAC,uBAAiB,UAAlB;lEACrB,mBAAS,QAAO,OAAO,CAAC,uBAAiB,YAAlB;7DAEpB,UAAG,WAAH;9BAEH,mBAAS,MAAK,OAAO,CAAC,uBAAiB,WAAlB;nEACrB,mBAAS,QAAO,OAAO,CAAC,uBAAiB,aAAlB;;vEAIvB,mBAAS,MAAK,OAAO,CAAC,uBAAiB,YAAlB;pEACrB,mBAAS,QAAO,OAAO,CAAC,uBAAiB,cAAlB;;xEAGzB,YAAG,uBAAiB,WAApB,EACE,SAAS,MAAK,QAAC,CAAQ,kEAAR,CADjB;3IAGA,iBAAS,gBAAc,CAAM,qCAAL,+BAAK,CAAC,CAAC,MAAO,CAAC,IAAK,GAAE,CAAF,CAAK,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAA5C,GdnpFgE,6EcmpFtE;;hOAIvB,iBAAS,MAAK,OAAO,CAAC,gBAAU,MAAX;rDACrB,iBAAS,QAAO,OAAO,CAAC,gBAAU,QAAX;zDAEvB,YAAG,gBAAU,WAAb,EACE,SAAS,MAAK,QAAC,CAAQ,kEAAR,CADjB;pIAGA,iBAAS,gBAAc,CAAC,wCd7pFqE,6Ec6pFtE;;vJAGzB,UAAG,aAAH;vBAEE,8BAAiB,CAAC,UAAW,2CAAZ;pFACjB,4BAAe,CAAC,SAAD;tCACf,gCAAmB,CAAC,SAAD;;1CAInB,YAAG,gBAAU,UAAb,EACE,iBAAY,CAAC,SAAD,CADd;pEAGA,qBAAQ,CAAC,SAAD;/BAER,YAAG,qBAAH;jCAEE,cAAG,yBAAH;vCAEE,qBAAS,MAAK,OAAO,CAAC,+BAAyB,UAA1B;5EACrB,qBAAS,QAAO,OAAO,CAAC,+BAAyB,YAA1B;rEAEpB,UAAG,0BAAH;/CAEH,qBAAS,MAAK,OAAO,CAAC,+BAAyB,WAA1B;7EACrB,qBAAS,QAAO,OAAO,CAAC,+BAAyB,aAA1B;;jFAIvB,qBAAS,MAAK,OAAO,CAAC,+BAAyB,YAA1B;9EACrB,qBAAS,QAAO,OAAO,CAAC,+BAAyB,cAA1B;;lFAGzB,cAAG,+BAAyB,WAA5B,EACE,SAAS,MAAK,QAAC,CAAQ,kEAAR,CADjB;rJAGA,eAAM;fACN,mBAAS,gBAAc,CAAC,yCdnsFmE,6EcmsFpE;1JAEvB,iDAAa,CAAC;;;;nCAAI,CAAC,EAAG,CAAC,CAAV;pBACb,mBAAS,iBAAiB,CAAC,yCAAI,6Bd9oF0D,EAA2B,KAChG,MAA0B,KAA2B,Kc6oF/C;zHAzB5B;;TA6BF,UAAG,gBAAU,WAAb;rCAEE,iBAAS,QAAO,OAAO,CAAC,gBAAU,iBAAX;lEACvB,YAAK,gBAAU,iBAAgB;7CAC/B,iBAAS,WAAS,CAAO,sCAAN,gCAAM,CAAC,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,IAAK,GAAE,CAAtB,GAAgC,sCAAN,gCAAM,CAAC,CAAC,MAAO,GAAE,CAAF,CAAK,CAAC,OAAQ,GAAE,CAAzB,Gd5tF8D,+EAAyE,8Ec4tF9K;pXAJpB;PAOA,UAAG,mBAAa,IAAI,wBAApB,EACE,SAAS,qBAAmB,CAAC,4CAAO,Ed5tFsG,6Ec4tF9G,CAD9B;tNA5FiC;AAnxBS;AAAd;AAE5B;AACA;AAEA,eAAU;fACV,eAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;hFAAI;AAEF,YAAK,IAAiB,YAAJ,CAAC,CAAD;9BAClB,YAAQ,gCAAH,eAAF,CAAE,CAAL;7DAEE,cAAe,OAAF,EAAK,gCAAH,CAAuC,OAA3C,QAAX;vEAEE,qBAAa,OAAF,EAAK,gCAAH,CAA8C,OAAR;tEACnD,gBAAG,MAAH,EACE,KADF;lBAHF;FAFF;;TAT0B;AAAc;AAldI;AAE9C,UAAY,kBAAD,QAAX,EACE,kBAAa,aADf;rEAF8C;AAzMD;AAE7C,0BAAgB;1BAChB,+BAAoB,CAAC,SAAU,MAAX;/CACpB,0BAAgB;1BAChB;AAL6C;AArezB;;;;AAmRN;AAo9L+B;AAE7C;AACA,+BAAa,CAAC,mBAAD;nDAHgC;AAp9L/B;AAIqB,gDzB/jCvB,6CyB+jCuB;7FACA,gDApWC,mDAoWD;nGACF,8CAvWC,iDAuWD;/FACI,kDAvWC,qDAuWD;vGACC,mDAxWA,qDAwWA;xGACL,8CAvWC,iDAuWD;/FACP,uCAvWC,0CAuWD;jFACC,wCAtSM,gDAsSN;xFACM,8CzBvkCrB,6CyBukCqB;3FAEf;AACG;AACD;AACD;AACC;AACQ;AACF;AACL,kCA5ZG,uCA4ZH;zEACA;AACI,sCzBllCb,6CyBklCa;nFACM;AACN,sCnBn4BL,wDmBm4BK;9FACP;AACK,qC1BhtCjB,W0BgtCiB;hDACK,yCA7kCG,8CA6kCH;vFACA,0C1BltCtB,W0BktCsB;rDACI;AACF;AACJ;AACU,iDArkCG,sDAqkCH;vGACb,qC1BvtCjB,W0ButCiB;hDACA;AACR;AACI,gCjBrsBQ,uEiBqsBR;vGACW,2CjBvsBN,oEiBusBM;/GACF,yCjBxsBJ,oEiBwsBI;7GACb,4BjB5lBI,+DiB4lBJ;3FACO,mCA1WG,wCA0WH;3EACM,yCnBhkClB,8CmBgkCkB;vFACZ,6BAlkCU,yCAkkCV;tEA3CF;AA8CkB;;;AAE9B;AACA;AACA;AACA;AAL8B;;AAE9B,iBAF8B;jBAG9B,gBAH8B;hBAI9B,kBAJ8B;lBAK9B,mBAL8B;;;nBA69JgB;AAEhD,gBAAK,OAAO,CAAC,KAAD;7BAFoC;AAWE;AAElD,kBAAO,OAAO,CAAC,KAAD;/BAFoC;AAtBE;AAEpD,iBAAM;jBAF8C;AA2BE;AAEtD,iBAAM;jBAFgD;AAlDL;AAEjD,oBAAU;pBACV,mBAAS,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;zKAC7B,qBAAW,uDAAqB,QAAC,YAAM,CAAC,qEAAU,OAAX,CAAN;9KAEjC,gBAAK,WAAL,GAAoB;9BACpB,kBAAO,WAAP,GAAsB;hCACtB,sBAAY,wCAAc,QAAC;tEAC3B,mBAAQ,QAAC,CAAQ,CAAR;7BACT,mBAAQ,OAAC,CAAO,CAAP;5BACT,mBAAQ,UAAC,CAAU,CAAV;/BACT,mBAAQ,SAAC,CAAS,CAAT;9BAZwC;AAeA;AAExC,eAAT,KAAS;pBACH,eAAN,KAAM;pBACE,eAAR,KAAQ;pBACR;AALiD;AA18JjB;AAqBN;;AAEX,4BjB7oBI,+DiB6oBJ;3FACE,8BjBxjBI,iEiBwjBJ;/FAHS;AAMJ;;;AAEpB;AACA;AACA;AACA;AACA;AANoB;;AAGpB,sBAHoB;;;tBAizJqB;AAE3C,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd;OAHF;PAF2C;AASP;AAEpC,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb;OAHF;PAFoC;AASG;AAGvC;AACA;AAEA,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,iBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;lFAAI;AAEF,cAAK,IAAiB,YAAJ,CAAC,CAAD;hCAClB,cAAQ,yBAAH,eAAF,CAAE,CAAL,EACK,OAAF,EAAK,yBAAH,CAAiC,SAAR,CAAS,WAAT,CAD9B;;5GANJ;PANuC;AA9BO;AAE9C;AACA;AAH8C;AAgDD;AAE7C;AAKA;AAAG;AAEH;AAEA;AAX6C;AAc7C,YAAgB,CAAb,iBAAa,IAAG,gBAAH,CAAa,IAAG,mBAAhC,EACE,MADF;lFAGA,4BAAgB;5BAChB,YAAK;ZACL,cAAO;dAEP,YAAG,eAAH;3BAEE;AACA;SAHF;TAMA,YAAG,cAAH;1BAEE,mBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;pFAAI;AAEF,gBAAK,IAAiB,YAAJ,CAAC,CAAD;lCAUlB,gBAAG,uBAAQ,CAAC,EAAG,qDAAqB;;;;/EAAzB,CAAX,EACE,EAAE,gBAAC,CAAgB,sBAAhB,CADL;7DAKA,gBAAG,CAAC,SAAJ,EACE,IAAK,UAAK,CAAC,QAAG,CAAC,EAAS,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,gBAAU,SAAQ,QAAzC,CAAJ,CADZ;;xHAKF,cAAG,CAAE,KAAE,CAAP,EACE,IAAK,GADP;9BAGA,cAAG,2CAAY,IAAG,oBAAlB,EACE,IAAK,CAAE,GAAE,EADX;7FAOA,wBAAS,CAAC,eAAM,cAAK,gBAAO,CAAnB;9DAlCX;TAsCA,4BAAgB;5BAjE6B;AAW7C;AAX6C;;AAzLI;AAEjD;AACA;AAEA,eAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;hFAAI;AAEF,YAAK,IAAiB,YAAJ,CAAC,CAAD;9BAMlB,YAAQ,yBAAH,eAAF,CAAE,CAAL;tDAEK,iBAAF,EAAK,yBAAH,CAA6C,mBAAhD,GAAiD;nEACjD,cAAM,OAAF,EAAK,yBAAH,CAA6C,gBAAnD,EACE,QADF;lEAHF;TAOA,YAAG,CAAC,SAAJ;tBAWE,cAAG,CAAC,OAAC,EAAI,GAAE,gBAAU,SAAQ,KAA7B,EACE,CAAC,OAAC,CAAO,UAAK,CAAC,gBAAU,SAAQ,KAAnB,CAAZ,CADJ;/GAEA,cAAG,CAAC,QAAC,EAAK,GAAE,gBAAU,SAAQ,MAA9B;3DACE,aAAC,QAAC,CAAQ,UAAK,CAAC,gBAAU,SAAQ,MAAnB,CAAb;jEACC,oBAAU,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAQ,CAAN,eAAM,GAAE,gBAAU,SAAQ,OAApB,CAA5B,EACH,CAAC,QAAC,CAAQ,UAAK,CAAO,CAAN,eAAM,GAAE,gBAAU,SAAQ,OAApB,CAA2B,GAAE,CAAC,SAAC,EAAtC,CAAb,CADC;1LAfP;;TApB+C;AAsDD;AAEhD;AAAG;AACH;AAAI;AACJ;AAAG;AAEH,eAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;hFAAI;AAEF,YAAK,IAAiB,YAAJ,CAAC,CAAD;9BAOlB,YAAG,CAAI,CAAC,SAAR,EACE,QADF;jCAGA,YAAQ,yBAAH,eAAF,CAAE,CAAL;tDAEE,cAAM,OAAF,EAAK,yBAAH,CAA6C,gBAAnD,EACE,QADF;lEAFF;TAMA,iBAAS,SAAuB,QAAlB,IAAmB,iBAAd,EAAa,GAAE,CAAF,qBAAhC;lFAAI;AAEF,eAAM,IAAiB,YAAJ,CAAC,CAAD;jCAEnB,cAAO,CAAH,EAAG,KAAE,CAAF,CAAK,IAAG,CAAI,EAAE,SAArB,EACE,QADF;lDA4BA,eAAW,qCAAL,+BAAK,CAAC,CAAC,QAAC,GAAM,CAAC,OAAC,GAAK,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAW,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAA5C;hKACX,gBAAY,qCAAL,+BAAK,CAAC,EAAE,QAAC,GAAM,EAAE,OAAC,GAAK,EAAE,QAAC,EAAK,GAAE,EAAE,SAAC,EAAL,CAAY,EAAE,OAAC,EAAI,GAAE,EAAE,UAAC,EAAlD;vKAEZ,cAAa,CAAT,GAAG,KAAM,IAAW,CAAR,EAAE,KAAM,GAAE,CAAF,CAAX,CAAgB,IAAc,CAAT,GAAG,KAAM,IAAY,CAAT,EAAE,MAAO,GAAE,CAAF,CAAZ,CAA3C;zEAEE,gBAAY,CAAR,GAAG,IAAK,GAAE,uCAAa,CAAC,EAAD,CAAI,EAAnB,CAAuB,IAAa,CAAR,GAAG,IAAK,IAAU,CAAP,EAAE,IAAK,GAAE,CAAF,CAAV,CAAhD;tGAEE,gBAAE,QAAC,CAAe,CAAP,CAAC,QAAC,EAAK,GAAE,CAAC,SAAC,EAAJ,CAAU,GAAE,CAA3B;zDACH,gBAAE,OAAC,CAAO,CAAC,OAAC,EAAT;rBAEA,UAAY,CAAR,GAAG,IAAK,IAAG,uCAAa,CAAC,EAAD,CAAI,EAApB,CAAwB,IAAa,CAAR,GAAG,IAAK,IAAa,CAAV,EAAE,OAAQ,GAAE,CAAF,CAAb,CAAjD;jHAEH,gBAAE,OAAC,CAAa,CAAN,CAAC,OAAC,EAAI,GAAE,CAAC,UAAC,EAAJ,CAAW,GAAE,CAA1B;xDACH,gBAAE,QAAC,CAAQ,CAAC,QAAC,EAAV;vBAHA;FAPP;;;XA3D4C;AAuMF;AAE9C;AAF8C;AA7VL;AAEzC;AAEA;AACA,UAAK;VACL,UAAG,wCAAa,wBAAwB,CAAC;;;;jEAAD,CAAxC;XAEE,wBAAU,MAAK,QAAC,CAAQ,kEAAR;zGAChB,wBAAU,MAAK,SAAC,CAAS,CAAT;lCAHlB;PAMA,UAAG,wCAAa,0BAA0B,CAAC;;;;nEAAD,CAA1C;XAEE,wBAAU,MAAK,QAAC,CAAQ,qEAAR;5GAChB,wBAAU,MAAK,WAAC,CAAW,CAAX;pCAHlB;PAZyC;AAmOS;AAElD;AAFkD;AA3KN;AAE5C;AACA;AAH4C;AArCP;AAErC;AACA,UAAa,2BAAH,eAAP,MAAO,CAAV;3DAEE,wBAAU,OAAO,CAAS,OAAP,OAAU,2BAAH,CAAsC,YAA/C;tFACjB,mBAAoB,OAAP,OAAU,2BAAH,CAAoC,UAAxD;vEACA,0BAAqB,OAAP,OAAU,2BAAH,CAAqC,WAA1D;/EACA,sBAAiB,OAAP,OAAU,2BAAH,CAAiC,OAAlD;hEAGA;PAXmC;AAcE;AAEvC;AACA,oBAAU;pBACV,yBAAe,+BAA0B,QAAC,YAAM,CAAC,IAAD,CAAN;lFAC1C,uBAAa;vBACb,wBAAc;xBAKd,oBAAS,mCAAT;vDAEA,qBAAU,EAAV;vBAbuC;AAgBA;AAE3B,eAAZ,KAAY;pBACZ;AAHuC;AAyFJ;AAEnC;AAEA;AACA,eAAS,MAAK,OAAO,CAAC,gBAAU,MAAX;nDACrB,eAAS,QAAO,OAAO,CAAC,gBAAU,QAAX;vDAEvB,UAAK;VACL,eAAS,gBAAc,CAAC,wCd7wLuE,6Ec6wLxE;rJATY;AAtsJb;AAm7LxB;AACE,6BAAa,CAAC,yBAAD;vDADf;AAzrOA,GAq0Cc,+EAr0Cd;lFCAA,wCAWS,qFAXT;;;;7HAqBS,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBAQe;;;AAEvB;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBuB;;AAEvB,iBAFuB;jBAGvB,kBAHuB;lBAiBvB,kBAjBuB;;;lBAwhBgB;AAEzC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT,YAAY,YAAD,QAAX,EACE,YAAO,QAAC,CAAQ,UAAR,CADV;lEAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAFyC;AApCE;AAE3C,UAAG,YAAQ,KAAG,KAAd;hCAEE,uBAAW;vBACX,YAAW,CAAC,YAAD,SAAU,IAAa,CAAR,YAAQ,GAAE,CAAC,CAAH,CAAlC,EACE,YAAO,UAAC,CAAU,UAAK,CAAC,YAAD,CAAf,CADV;3GAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAF2C;AAwED;AAE1C,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,YAAW,CAAC,YAAD,SAAU,IAAY,CAAP,WAAO,GAAE,CAAC,CAAH,CAAjC,EACE,YAAO,SAAC,CAAS,UAAK,CAAC,WAAD,CAAd,CADV;xGAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAF0C;AAxHK;AAAd;AAEjC,eAAU,YAAO,KAAG,CAAC,CAAJ;lCAFgB;AAAc;AAeD;AAAb;AAEjC,eAAU,WAAM,KAAG,CAAC,CAAJ;jCAFiB;AAAa;AAqBF;AAE5C,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,YAAY,YAAD,QAAX,EACE,YAAO,WAAC,CAAW,aAAX,CADV;xEAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAF4C;AAwEA;AAE5C,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,YAAY,YAAD,QAAX,EACE,YAAO,WAAC,CAAW,aAAX,CADV;xEAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAF4C;AAvGC;AAAZ;AAEjC,eAAU,UAAK,KAAG,CAAC,CAAJ;hCAFkB;AAAY;AAKD;AAAX;AAEjC,eAAU,SAAI,KAAG,CAAC,CAAJ;/BAFmB;AAAW;AA8DH;AAEzC,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT,YAAW,CAAC,YAAD,SAAU,IAAW,CAAN,UAAM,GAAE,CAAC,CAAH,CAAhC,EACE,YAAO,QAAC,CAAQ,UAAK,CAAC,UAAD,CAAb,CADV;rGAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAFyC;AAwBD;AAExC,UAAG,SAAK,KAAG,KAAX;7BAEE,oBAAQ;pBACR,YAAW,CAAC,YAAD,SAAU,IAAU,CAAL,SAAK,GAAE,CAAC,CAAH,CAA/B,EACE,YAAO,OAAC,CAAO,UAAK,CAAC,SAAD,CAAZ,CADV;lGAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAFwC;AApCQ;AAEhD,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB,YAAY,YAAD,QAAX,EACE,YAAO,eAAC,CAAe,iBAAf,CADV;hFAEA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDALF;PAFgD;AAxCL;AAE3C,UAAG,YAAQ,KAAG,KAAd;hCAEE,oBAAO,OAAO,CAAC,KAAD;jCACd,YAAW,CAAC,YAAD,SAAU,IAAI,CAAI,uCAAa,CAAC,YAAD,CAA1C;5FAEE,sBAAO,SAAQ;/BACf,sBAAO,SAAQ,UAAU,CAAC,apB3J8B,GoB2J/B;jDAH3B;TAMA,YAAY,WAAD,QAAX,EACE,WAAM,gBADR;rDATF;PAF2C;AAzEI;AAE/C,UAAW,CAAC,YAAD,SAAU,IAAI,CAAI,uCAAa,CAAC,YAAD,CAA1C;1FAEE,oBAAO,SAAQ;7BACf,oBAAO,SAAQ,UAAU,CAAC,apB/EgC,GoB+EjC;jDAH3B;PAMA,UAAY,WAAD,QAAX,EACE,WAAM,gBADR;1DAR+C;AAYL;AAE1C;AACA,UAAY,gBAAD,QAAX,EACE,cAAsB,OAAX,iBAAc,+BAAH,CAAsC,SAD9D;nHAGA,qBAAW,uCAAa,QAAC;pEACzB,kBAAO,UAAP,GAAqB;/BACrB,oBAAU,CAAC;rBACX,qBAAW,CAAC;tBACZ,kBAAQ,CAAC;nBACT,mBAAS,CAAC;pBACV,sBAAY;tBACZ,sBAAY;tBACZ,0BAAgB;1BAEhB,UAAW,CAAC,WAAD,SAAS,IAAY,CAAC,WAAM,SAAP,SAAhC;jEAEE,uBAAW,gDAAoB,QAAC,YAAM,CAAC,WAAM,SAAP,CAAN;jHAChC,oBAAO,WAAC,CAAW,KAAX;rCACR,oBAAO,cAAC,CAAc,KAAd;xCACR,oBAAO,UAAC,CAAU,WAAM,SAAhB;nDACR,oBAAO,SAAP,GAAyB,mBAAN,YAAM;xDAN3B;PASA,UAAY,WAAD,QAAX;7BAEE,YAAY,WAAM,SAAP,QAAX,EACE,WAAM,SAAS,iBAAiB,CAAC,aAAS,eAAV,CADlC;7GAEA,mBAAM;ZAJR;PAzB0C;AA5BF;AAExC,UAAa,8BAAH,eAAP,MAAO,CAAV;9DAEE,qBAAiB,OAAP,OAAU,8BAAH,CAAmC;lEACpD,sBAAkB,OAAP,OAAU,8BAAH,CAAoC;nEACtD,uBAAmB,OAAP,OAAU,8BAAH,CAAqC;pEACxD,qBAAiB,OAAP,OAAU,8BAAH,CAAmC;lEACpD,oBAAgB,OAAP,OAAU,8BAAH,CAAkC;jEAClD,wBAAoB,OAAP,OAAU,8BAAH,CAAsC;rEAC1D,wBAAoB,OAAP,OAAU,8BAAH,CAAsC;rEAC1D,oBAAO,OAAO,CAAS,OAAP,OAAU,8BAAH,CAAqC,QAA9C;jFACd,4BAAwB,OAAP,OAAU,8BAAH,CAA0C;lEAVpE;PAFwC;AA6DE;AAElC,eAAR,KAAQ;pBACR;AACA,UAAY,WAAD,QAAX,EACE,WAAM,gBADR;1DAJ0C;AA5bjB;AA6CV;AACD,2BrCvDP,YqCuDO;vCACC,6BrCxCT,WqCwCS;xCACD,4BrCzCR,WqCyCQ;vCACE,8BrC1CV,WqC0CU;zCACC,+BrC3CX,WqC2CW;1CACC;AACA;AACI;AACL,8BpBoKJ,iDoBpKI;/EAtDQ;AA0DC;;;AAMxB;AANwB;;AAMxB,mBANwB;;;nBAgiBe;AAAP;AAGlC,eAA8C,YAAK,CAAC,KAAD;jCAHjB;AAAO;AALQ;AAAf;AAElC,eAAU;fAFwB;AAAe;AAWP;AAAR;AAElC,eAAU;fAFwB;AAAQ;AAjBC;AAE3B,sDAAC,OAAQ,sBAAT;nFAChB,sBAAU;tBAHiC;AArhBjB;AAqBD;;;AAEvB;AACA;AACA;AACA;AACA;AACA;AAPuB;;AAGvB,mBAHuB;nBAIvB,mBAJuB;nBAKvB,uBALuB;vBAMvB,wBANuB;xBAOvB,sBAPuB;;;tBAkKoB;AAAZ;AAEjC,eAA6B,aAAS;5BAFL;AAAY;AA4BC;AAE3B,mBAAS,aAAC,CAAa,KAAb;tCAFiB;AAvBF;AAAX;AAEjC,eAA6B,aAAS,YAAW;xCAFhB;AAAW;AAkCC;AAE1B,mBAAS,YAAW,YAAC,CAAY,KAAZ;jDAFK;AA7BF;AAAV;AAEjC,eAAU,4BAAgB,CAAC,EAAS,EAAS,EAAS,CAA5B;nDAFO;AAAU;AAxEG;AAAb;AAEjC,eAAU,0CAAc,QAAC,YAAM,CAAC,IAAD,CAAN;nFAFQ;AAAa;AA8CE;AAAf;AAGjC;AAEA,eAAU;fACV,eAAS,SAAoB,QAAf,aAAQ,SAAC,EAAM,GAAE,CAAF,qBAA7B;jFAAI;AAEF,YAAG,OAAQ,KAAE,aAAQ,WAAC,CAAD,CAAG,QAAxB;1DAEE,mBAAU,aAAQ,WAAC,CAAD;5CAClB;SAHF;;TAR+B;AAAe;AAqCC;AAEjD;AACA,UAAY,aAAD,QAAX,EACE,aAAQ,gBAAC,CAAgB,kBAAhB,CADX;lFAHiD;AAmDD;AAEhD;AAFgD;AAKD;AAE/C,UAAc,CAAV,yCAAU,IAAG,oBAAH,CAAmB,IAAiB,CAAb,4CAAa,IAAG,oBAAH,CAAlD,EACE,MADF;/JAGA,4BAAiB,aAAQ,SAAC,EAA1B;pDACA,6BAAkB,aAAQ,UAAC,EAA3B;tDAN+C;AA9DC;AAEhD,UAAY,aAAD,QAAX,EACE,aAAQ,gBAAC,CAAgB,kBAAhB,CADX;lFAFgD;AA6BD;AAE/C,wBAAa,CAAC,KAAD;9BAFkC;AA2FE;AAEjD;AAFiD;AA1LH;AAE9C;AAGA,UAAY,eAAD,QAAX,EACE,eAAS,YADX;9DAL8C;AAsHA;AAE9C;AAF8C;AAPM;AAEpD,UAAY,iBAAD,QAAX,EACE,iBAAa,CAAC,KAAM,oBAAe,CAAS,OAAP,OAAU,gDAAH,CAAT,CAAtB,CADf;lJAEA;AAJoD;AA7FF;AAGlD,UAAY,eAAD,QAAX;jCAEE,uBAAS,QAAC,CAAQ,eAAS,QAAC,EAAK,GAAE,UAAK,CAAC,OAAD,CAA9B;/EACV,uBAAS,OAAC,CAAO,eAAS,OAAC,EAAI,GAAE,UAAK,CAAC,OAAD,CAA5B;tEAHZ;PAHkD;AAjDR;AAE1C;AACA,wBAAa,uDAAb;/EACA,sBAAY,+BAA0B,QAAC,YAAM,CAAC,IAAD,CAAN;/EACvC,sBAAY;tBACZ,UAAG,CAAiB,CAAZ,2CAAY,IAAG,oBAAH,CAApB,EACE,aAAQ,UAAC,CAAU,IAAV,CADX;/GAEA,mBAAQ,aAAC,CAAa,IAAb;rCACT,mBAAQ,SAAR,GAAoB;/BACpB,mBAAQ,WAAC,CAAW,KAAX;pCACT,mBAAQ,cAAC,CAAc,KAAd;vCACT,mBAAQ,aAAY,cAAC,CAAc,KAAd;pDACrB,mBAAQ,YAAW,YAAC,CAAY,KAAZ;jDACpB,mBAAQ,kBAAR,GAA6B;xCAC7B,mBAAQ,iBAAR,GAA4B;vCACT,mBAAS,kBAA5B,GAAiD;xCACjD,6BAAkB,aAAlB;1CAjB0C;AAmIF;AAExC;AACA,UAAa,8BAAH,eAAP,MAAO,CAAV;9DAEE,qBAAQ,OAAO,CAAS,OAAP,OAAU,8BAAH,CAAsC,SAA/C;nFACf,0BAAqB,OAAP,OAAU,8BAAH,CAAwC,aAAV,EAAnD;tFACA,yBAAoB,OAAP,OAAU,8BAAH,CAAuC,YAAT,EAAlD;7EAJF;PAHwC;AA1GE;AAEjC,eAAT,KAAS;pBACT;AAH0C;AAmJA;AAM1C;AAGA,UAAG,gBAAH,EACE,iBADF;7CASA,UAAY,aAAD,QAAX;/BAEE,qBAAO,UAAC,CAAU,GAAV;nCACR,qBAAO,WAAC,CAAW,KAAX;/BAHV;PAMA;AACA;AACA;AACA,uBAAa;vBACb,UAAY,gBAAD,QAAX,EACE,gBAAU,CAAC,IAAD,CADZ;1DA5B0C;AAqCE;AAE5C;AACA,uBAAa;vBACb,UAAY,kBAAD,QAAX,EACE,kBAAY,CAAC,IAAD,CADd;9DAJ4C;AAtJG;AAAd;AAEjC,eAAU;fACV,UAAY,aAAD,QAAX,EACE,SAAU,aAAO,iBADnB;xEAHiC;AAAc;AAiJL;AAAT;AAEjC,eAAU;fAFuB;AAAS;AA5RjB;AA/G3B,GA+Kc,6CA/Kd;;;hDA+Kc;AAYM;;AA3LpB;ACAA,mCAES,0ZAFT;;;;7bAiDY,oBAAG;pBACF,qBAAG;rBAIA,wBAAG;xBAMK,gCAAG;hCAIlB,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBACH,iBAAG;jBAoCY;;AACA;;AACJ;;;AAEhB;AAFgB;;AAEhB,mBAFgB;;;nBAu5hBgB;AAElC;AACA,UAAW,CAAC,aAAD,SAAW,IAAI,aAAQ,qBAAlC;vEAEO;AACH,YADG,KACH;jBAEE,uBAAQ,mBAAmB,CAAC,IAAD;/CAC3B,uBAAQ,qBAAR,GAAiC;/CACjC,kBAAO,CAAP;VAEF,UAPG,KAOH;xBAEE,uBAAQ,mBAAmB,CAAC,KAAD;hDAC3B,uBAAQ,qBAAR,GAAiC;/CACjC,kBAAO,CAAP;VAJF;FATJ;PAHkC;AAPD;AAEjC;AACA,UAAW,CAAC,aAAD,SAAW,IAAI,aAAQ,qBAAlC,EACE,aAAQ,mBAAmB,CAAC,KAAD,CAD7B;hHAHiC;AAPE;AAEnC;AACA,UAAa,yBAAH,eAAP,MAAO,CAAV,EACE,gBAAmB,OAAP,OAAU,yBAAH,CADrB;nHAHmC;AAz4hBjB;AAYC;AAm6hBe;AAAP;AAE3B,eAA4C,YAAK,CAAC,KAAD;jCAFtB;AAAO;AAn6hBf;AAOM;AAs6hBe;AAAP;AAEjC,eAAiC,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAFA;AAAO;AAt6hBf;AAYF;;AACA;;AACK;;AACG;;AACG;;AACT;;AACG;;AACG;;AACJ;;AACI;;AACC;;AAEH;;AACA;;AACK;;AACG;;AACG;;AACT;;AACG;;AACG;;AACJ;;AACI;;AACC;;AAET;;AACC,oDADD,qDACC;zGAEL;;AACE,iDADF,iDACE;lGAEC;;AACC,mDADD,oDACC;vGAEH;;AACxB;AACA;;AADA;AACA;;AAFwB;aACxB,wCACA;rDAFwB;;AAQL;;;AAEnB;AACA;AAHmB;;AAEnB,mBAFmB;;;nBAkthBkB;AAEvC,UAAI,KAAM,KAAG,YAAb;hCAEE,uBAAW;vBACX;OAHF;PAFuC;AAxBC;AAAX;AAE7B,eAAU;fAFmB;AAAW;AAgBE;AAG1C;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,aAAF,CAA1C,EACE,gBAAY,IADd;jHAJ0C;AAXH;AAEvC,UAAG,CAAY,CAAC,aAAD,SAAf,EACE,MADF;1CAGA,mBAAQ,OAAM;1BAEd,UAAG,YAAH,EACE,aAAQ,CAAC,aAAQ,wBAAuB,aAAQ,qBAAxC,CADV;9GAPuC;AAxBD;AAEtC;AAEA;AACA,qBAAW;rBACX,UAAW,CAAC,MAAD,SAAS,IAAe,+BAAH,eAAP,MAAO,CAAhC;nFAEE,iBAAS,SAA2B,QAAtB,MAAM,kBAAC,EAAe,GAAE,CAAF,qBAApC;rFAAI;AAEF,cAA4B,yBAAH,eAArB,MAAM,aAAW,CAAC,CAAD,CAAI,CAAzB;7EAEE,4BAAgC,OAArB,MAAM,aAAW,CAAC,CAAD,EAAO,yBAAH;nFAChC;WAHF;;JAJJ;PANsC;AAvqhBjB;AAoBJ;AApBI;AAqCW,2D3BySrB,yD2BzSqB;pHAGF;;;AAE5B;AACA;AACA;AAJ4B;;AAE5B,mBAF4B;;;nBAithBmB;AAAX;AAEtC,eAAU;fAF4B;AAAW;AAKE;AAGnD;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,aAAF,CAA1C,EACE,gBAAY,IADd;jHAJmD;AAvBJ;AAE/C;AAEA;AACA,UAAW,CAAC,MAAD,SAAS,IAAe,+BAAH,eAAP,MAAO,CAAhC;nFAEE,iBAAS,SAA2B,QAAtB,MAAM,kBAAC,EAAe,GAAE,CAAF,qBAApC;rFAAI;AAEF,cAA4B,yBAAH,eAArB,MAAM,aAAW,CAAC,CAAD,CAAI,CAAzB;7EAEE,4BAAgC,OAArB,MAAM,aAAW,CAAC,CAAD,EAAO,yBAAH;nFAChC;WAHF;;JAJJ;PAL+C;AAJF;;AA3rhBf;AAuBH;AA4zhBe;AAAP;AAEnC,eAAoC,kDAAW,QAAK,CAAC,KAAD,CAAhB;hFAFD;AAAO;AA5zhBf;AAYL;;;AAEpB;AAMA;AACA;AACA;AACA;AAXoB;;AAEpB,mBAFoB;nBASpB,iBAToB;jBAUpB,iBAVoB;;;jBAo4gBoB;AAE1C;AACA;AAEA,UAAG,CAAY,CAAC,aAAD,SAAf,EACE,MADF;1CAGA,iBAAK;jBACL,eAAS,SAA0B,QAArB,aAAQ,OAAM,SAAC,EAAM,GAAE,CAAF,qBAAnC;xFAAI;AAEF,aAA6B,aAAQ,OAAM,WAAC,CAAD;7CAC3C,YAAuC,CAAnC,EAAE,eAAc,QAAQ,CAAC,cAAD,CAAW,GAAE,CAAC,CAAH,CAAM,IAAI,aAAQ,YAAY,CAAC,EAAD,CAArE,EACE,WAAK,IAAI,CAAC,EAAD,CADX;;lHAZwC;AA5CA;AAE1C;AACA;AACA;AAAK;AAEL,UAAG,CAAY,CAAC,aAAD,SAAf,EACE,MADF;1CAGA,iBAAK;jBACL,eAAS,SAAiB,QAAZ,WAAK,SAAC,EAAM,GAAE,CAAF,qBAA1B;/EAAI;AAEF,aAAM,WAAK,SAAC,CAAD;lCACX,YAAY,EAAD,QAAX;tBAEE,aAAG,EAAH,GAAS;lBACT,aAAG,EAAH,GAAS;lBACT,aAAG,EAAH,GAAS;lBACT,aAAG,SAAH,GAAgB,aAAQ,oBAAoB,CAAC,EAAE,YAAY,MAAO,cAAtB;7FAC5C,cAAG,CAAI,WAAK,QAAQ,CAAC,mEAAD,CAAM,GAAE,CAAC,CAA7B,EACE,WAAK,IAAI,CAAC,mEAAD,CADX;lMAGA,aAAG,EAAH,GAAS;lBACT,aAAG,EAAH,GAAS;lBACT,aAAG,EAAH,GAAS;lBACT,aAAG,SAAH,GAAgB,aAAQ,oBAAoB,CAAC,EAAE,UAAU,KAAM,cAAnB;1FAC5C,cAAG,CAAI,WAAK,QAAQ,CAAC,mEAAD,CAAM,GAAE,CAAC,CAA7B,EACE,WAAK,IAAI,CAAC,mEAAD,CADX;zLAbF;;TA0BF,iBAAK,KAAK,CAAmB,gBAAnB;vCAvCgC;AAvBH;AAEvC,sBAAY;tBACZ,mCAAyB;nCASzB,oBAAU,2DAA2B,QAAC;vFACtC,oBAAU,2DAA2B,QAAC;vFAbC;AAgBA;AAEhC,eAAP,KAAO;pBACA,eAAP,KAAO;pBACP;AAJuC;AAj1gBjB;AAyBC;AAiyhBe;AAAP;AAE/B,eAA2C,YAAK,CAAC,KAAD;jCAFjB;AAAO;AAjyhBf;AAYS;;;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AAR8B;;AAE9B,mBAF8B;nBAG9B,0BAH8B;1BAI9B,4BAJ8B;5BAK9B,gBAL8B;hBAM9B,wBAN8B;xBAO9B,wBAP8B;xBAQ9B,+BAR8B;;;/BA65f4B;AAG5D,UAAG,sBAAkB,KAAG,KAAxB,EACE,sBAAiB,OAAO,CAAC,KAAD,CAD1B;hFAH4D;AAoBF;AAG1D,UAAG,oBAAgB,KAAG,KAAtB,EACE,oBAAe,OAAO,CAAC,KAAD,CADxB;5EAH0D;AA1BV;AAEhD,UAAG,UAAM,KAAG,KAAZ,EACE,UAAK,OAAO,CAAC,KAAD,CADd;xDAFgD;AANQ;AAExD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFwD;AAmBA;AAExD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFwD;AAMO;AAG/D,UAAG,yBAAqB,KAAG,KAA3B,EACE,yBAAoB,OAAO,CAAC,KAAD,CAD7B;tFAH+D;AAcf;AAEhD,mBAAQ,oBA11c8C;vCAw1cN;AApEC;AAEjD,sBAAY;tBACZ,6BAAmB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;vLACzC,+BAAqB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;zLAC3C,kCAAwB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;5LAC9C,2BAAiB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;zOACrC,mBAAS,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;xKAC7B,2BAAiB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;zOAErC,gBAAK,WAAL,GAAoB;9BACpB,wBAAa,WAAb,GAA4B;tCAC5B,wBAAa,WAAb,GAA4B;tCAC5B,0BAAe,WAAf,GAA8B;xCAC9B,4BAAiB,WAAjB,GAAgC;1CAChC,+BAAoB,WAApB,GAAmC;7CAfc;AAkBA;AAE3C,eAAN,KAAM;pBACQ,eAAd,KAAc;pBACA,eAAd,KAAc;pBACE,eAAhB,KAAgB;pBACE,eAAlB,KAAkB;pBACG,eAArB,KAAqB;pBACrB;AARiD;AA/BF;AAE/C,UAAa,qCAAH,eAAP,MAAO,CAAV;rEAEE,kBAAK,OAAO,CAAS,OAAP,OAAU,qCAAH,CAA0C,MAAnD;pFACZ,0BAAa,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAkD,cAA3D;pGACpB,0BAAa,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAkD,cAA3D;pGACpB,4BAAe,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAoD,gBAA7D;xGACtB,8BAAiB,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAsD,kBAA/D;5GACxB,iCAAoB,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAyD,qBAAlE;3GAP7B;PAF+C;AAv2ff;AAsBP,sCnBoZJ,iEmBpZI;vGACE,wCnBmZN,iEmBnZM;zGACG,2CnBkZT,iEmBlZS;5GACP,oCnB2TJ,+DmB3TI;nGACR,4BnB0TI,+DmB1TJ;3FACQ,oCnByTJ,+DmBzTI;nGA3BS;AA8BJ;;AAEC;;;AAE3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvD2B;;AAE3B,mBAF2B;nBAI3B,gBAJ2B;hBAK3B,kBAL2B;lBAM3B,gBAN2B;hBAO3B,qBAP2B;rBAQ3B,uBAR2B;vBAS3B,qBAT2B;rBAU3B,+BAV2B;/BAW3B,+BAX2B;/BAY3B,6BAZ2B;7BAa3B,wBAb2B;xBAc3B,wBAd2B;xBAe3B,sBAf2B;tBAgB3B,wBAhB2B;xBAiB3B,wBAjB2B;xBAkB3B,sBAlB2B;tBAmB3B,0BAnB2B;1BAoB3B,6BApB2B;7BAqB3B,0BArB2B;1BAsB3B,6BAtB2B;7BAuB3B,wBAvB2B;xBAwB3B,2BAxB2B;3BAyB3B,6BAzB2B;7BA0B3B,6BA1B2B;7BA2B3B,2BA3B2B;3BA0C3B,+BA1C2B;/BA2C3B,iCA3C2B;jCA4C3B,kCA5C2B;lCA6C3B,iCA7C2B;jCA8C3B,+BA9C2B;/BAqD3B,sBArD2B;;;tBAukde;AAE5C,UAAG,SAAK,KAAG,KAAX;7BAEE,oBAAQ;pBACR,qBAAQ,oBA5ga4C;lCAygatD;PAF4C;AAjKC;AAE7C,UAAG,UAAM,KAAG,KAAZ,EACE,UAAK,OAAO,CAAC,KAAD,CADd;xDAF6C;AAsEE;AAE/C,UAAG,YAAQ,KAAG,KAAd,EACE,YAAO,OAAO,CAAC,KAAD,CADhB;5DAF+C;AAhEF;AAE7C,UAAG,UAAM,KAAG,KAAZ,EACE,UAAK,OAAO,CAAC,KAAD,CADd;xDAF6C;AA0BK;AAElD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAFkD;AAsBE;AAEpD,UAAG,iBAAa,KAAG,KAAnB,EACE,iBAAY,OAAO,CAAC,KAAD,CADrB;tEAFoD;AAhBF;AAElD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAFkD;AAuFG;AAErD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFqD;AAMA;AAErD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFqD;AAwBE;AAEvD,UAAG,oBAAgB,KAAG,KAAtB,EACE,oBAAe,OAAO,CAAC,KAAD,CADxB;5EAFuD;AAlBG;AAE1D,UAAG,uBAAmB,KAAG,KAAzB,EACE,uBAAkB,OAAO,CAAC,KAAD,CAD3B;lFAF0D;AAMA;AAE1D,UAAG,uBAAmB,KAAG,KAAzB,EACE,uBAAkB,OAAO,CAAC,KAAD,CAD3B;lFAF0D;AAME;AAE5D,UAAG,yBAAqB,KAAG,KAA3B,EACE,yBAAoB,OAAO,CAAC,KAAD,CAD7B;tFAF4D;AApOP;AAErD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFqD;AAMA;AAErD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFqD;AAmEE;AAEvD,UAAG,oBAAgB,KAAG,KAAtB,EACE,oBAAe,OAAO,CAAC,KAAD,CADxB;5EAFuD;AA7DG;AAE1D,UAAG,uBAAmB,KAAG,KAAzB,EACE,uBAAkB,OAAO,CAAC,KAAD,CAD3B;lFAF0D;AAMA;AAE1D,UAAG,uBAAmB,KAAG,KAAzB,EACE,uBAAkB,OAAO,CAAC,KAAD,CAD3B;lFAF0D;AAME;AAE5D,UAAG,yBAAqB,KAAG,KAA3B,EACE,yBAAoB,OAAO,CAAC,KAAD,CAD7B;tFAF4D;AA5DT;AAEnD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFmD;AAMA;AAEnD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFmD;AAwBE;AAErD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAFqD;AAlBG;AAExD,UAAG,qBAAiB,KAAG,KAAvB,EACE,qBAAgB,OAAO,CAAC,KAAD,CADzB;9EAFwD;AAMA;AAExD,UAAG,qBAAiB,KAAG,KAAvB,EACE,qBAAgB,OAAO,CAAC,KAAD,CADzB;9EAFwD;AAME;AAE1D,UAAG,uBAAmB,KAAG,KAAzB,EACE,uBAAkB,OAAO,CAAC,KAAD,CAD3B;lFAF0D;AA+RL;AAErD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,qBAAQ,oBA/ia4C;lCA4iatD;PAFqD;AAmBA;AAErD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,qBAAQ,oBAlka4C;lCA+jatD;PAFqD;AAVC;AAGtD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,qBAAQ,oBAzja4C;lCAsjatD;PAHsD;AAmBA;AAGtD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,qBAAQ,oBA5ka4C;lCAykatD;PAHsD;AAxPD;AAErD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,qBAAQ,oBAn1Z4C;lCAg1ZtD;PAFqD;AASA;AAErD,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,qBAAQ,oBA51Z4C;lCAy1ZtD;PAFqD;AA2BW;AAGhE,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AAUF;AAG9D,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,oBAAO,CAAC,IAAD;lBAHT;PAH8D;AAsBG;AAGjE,UAAG,8BAA0B,KAAG,KAAhC;lDAEE,yCAA6B;zCAC7B,oBAAO,CAAC,IAAD;lBAHT;PAHiE;AAgBF;AAG/D,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAH+D;AApGP;AAGxD,UAAG,qBAAiB,KAAG,KAAvB,EACE,wBAAoB,KADtB;xEAHwD;AAsSE;AAG1D,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,qBAAQ,oBA1ma4C;lCAumatD;PAH0D;AAoBD;AAGzD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,iCAAqB;jCACrB,qBAAQ,oBA9na4C;lCA2natD;PAHyD;AAxCK;AAG9D,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,mCAAsB,OAAO,CAAC,KAAD;hDAC7B,qBAAQ,oBAtla4C;lCAmlatD;PAH8D;AAUA;AAG9D,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,mCAAsB,OAAO,CAAC,KAAD;hDAC7B,qBAAQ,oBAhma4C;lCA6latD;PAH8D;AAoBC;AAG/D,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,oCAAuB,OAAO,CAAC,KAAD;jDAC9B,qBAAQ,oBApna4C;lCAinatD;PAH+D;AAoBH;AAG5D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,iCAAoB,OAAO,CAAC,KAAD;9CAC3B,qBAAQ,oBAxoa4C;lCAqoatD;PAH4D;AA7LA;AAG5D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,iCAAoB,OAAO,CAAC,KAAD;9CAC3B,qBAAQ,oBA38Z4C;lCAw8ZtD;PAH4D;AAUA;AAG5D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,qBAAQ,oBAr9Z4C;lCAk9ZtD;PAH4D;AAUD;AAG3D,UAAG,wBAAoB,KAAG,KAA1B;5CAEE,mCAAuB;nCACvB,qBAAQ,oBA/9Z4C;lCA49ZtD;PAH2D;AAvCH;AAGxD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ,oBAx7Z4C;lCAq7ZtD;PAHwD;AAUD;AAEvD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,qBAAQ,oBAj8Z4C;lCA87ZtD;PAFuD;AAvIA;AAEvD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,qBAAQ,oBA1zZ4C;lCAuzZtD;PAFuD;AAgBL;AAElD,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,qBAAQ;dAHV;PAFkD;AA8NC;AAGnD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAHmD;AAnBI;AAGvD,UAAG,oBAAgB,KAAG,KAAtB;xCAEE,+BAAmB;/BACnB,qBAAQ;dAHV;PAHuD;AAUD;AAEtD,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,qBAAQ;dAHV;PAFsD;AArcT;AAE7C,mBAAQ,oBAvlZ8C;vCAqlZT;AAKC;AAE9C,sBAAY;tBACZ,kBAAQ;lBACR,2BAAiB;3BACjB,2BAAiB;3BACjB,6BAAmB;7BACnB,mCAAyB;nCACzB,8BAAoB;9BACpB,+BAAqB;/BACrB,gCAAsB;hCACtB,iCAAuB;jCACvB,kCAAwB;lCACxB,wBAAc;xBACd,6BAAmB;7BACnB,4BAAkB;5BAClB,uCAA6B;vCAC7B,qCAA2B;rCAC3B,sCAA4B;tCAC5B,oCAA0B;pCAC1B,kCAAwB,uCAAa,QAAC;jFACtC,+BAAoB,mBAAiB,CAAC,wBAAyB,qCAA1B;hHACrC,+BAAoB,UAApB,GAAkC;5CAClC,qCAA2B,uCAAa,QAAC;pFACzC,kCAAuB,mBAAiB,CAAC,2BAA4B,qCAA7B;tHACxC,kCAAuB,UAAvB,GAAqC;/CACrC,kCAAwB,uCAAa,QAAC;jFACtC,+BAAoB,mBAAiB,CAAC,uBAAwB,qCAAzB;/GACrC,+BAAoB,UAApB,GAAkC;5CAClC,oCAA0B,uCAAa,QAAC;nFACxC,iCAAsB,mBAAiB,CAAC,0BAA2B,qCAA5B;pHACvC,iCAAsB,UAAtB,GAAoC;9CACpC,oCAA0B,uCAAa,QAAC;nFACxC,iCAAsB,mBAAiB,CAAC,0BAA2B,qCAA5B;pHACvC,iCAAsB,UAAtB,GAAoC;9CACpC,4BAAkB;5BAClB,4BAAkB;5BAClB,8BAAoB;9BACpB,2BAAiB;3BACjB,2BAAiB;3BACjB,6BAAmB;7BACnB,yBAAe,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;nLACrC,sBAAW,SAAC,CAAS,CAAT;jCACZ,mBAAS,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;zKAC7B,qBAAW,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;9KACjC,wBAAc,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;9KAClC,0BAAgB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;nLACtC,2BAAiB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;jLACrC,6BAAmB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;tLACzC,gCAAsB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;tLAC1C,kCAAwB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;3LAC9C,yBAAe,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;/KACnC,2BAAiB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;pLACvC,8BAAoB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;pLACxC,gCAAsB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;zLAC5C,2BAAiB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;jLACrC,6BAAmB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;tLACzC,gCAAsB,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;tLAC1C,kCAAwB,uDAAqB,QAAC,YAAM,CAAC,oEAAS,QAAV,CAAN;3LAE9C,mBAAS,qDAAmB,QAAC;hFAC7B,wBAAc,qDAAmB,QAAC;rFAClC,qBAAU,SAAC,CAAS,cAAC,iCAAU,OAAX,CAAT;tFACX,2BAAiB,qDAAmB,QAAC;xFACrC,gCAAsB,qDAAmB,QAAC;7FAC1C,6BAAkB,SAAC,CAAS,cAAC,iCAAU,OAAX,CAAT;9FACnB,yBAAe,qDAAmB,QAAC;tFACnC,8BAAoB,qDAAmB,QAAC;3FACxC,2BAAgB,SAAC,CAAS,cAAC,iCAAU,OAAX,CAAT;5FACjB,2BAAiB,qDAAmB,QAAC;xFACrC,gCAAsB,qDAAmB,QAAC;7FAC1C,6BAAkB,SAAC,CAAS,cAAC,iCAAU,OAAX,CAAT;9FAEnB,4CAAY,YAAY,CAAC,gBAAY,EAAb;3EACxB,4CAAY,YAAY,CAAC,wBAAoB,EAArB;nFACxB,4CAAY,YAAY,CAAC,sBAAkB,EAAnB;jFACxB,4CAAY,YAAY,CAAC,wBAAoB,EAArB;nFAExB,gBAAK,WAAL,GAAoB;9BACpB,kBAAO,WAAP,GAAsB;hCACtB,gBAAK,WAAL,GAAoB;9BAEpB,qBAAU,WAAV,GAAyB;nCACzB,uBAAY,WAAZ,GAA2B;rCAC3B,qBAAU,WAAV,GAAyB;nCAEzB,wBAAa,WAAb,GAA4B;tCAC5B,0BAAe,WAAf,GAA8B;xCAC9B,wBAAa,WAAb,GAA4B;tCAE5B,6BAAkB,WAAlB,GAAiC;3CACjC,+BAAoB,WAApB,GAAmC;7CACnC,6BAAkB,WAAlB,GAAiC;3CAEjC,sBAAW,WAAX,GAA0B;pCAC1B,wBAAa,WAAb,GAA4B;tCAC5B,sBAAW,WAAX,GAA0B;pCAE1B,2BAAgB,WAAhB,GAA+B;zCAC/B,6BAAkB,WAAlB,GAAiC;3CACjC,2BAAgB,WAAhB,GAA+B;zCAE/B,wBAAa,WAAb,GAA4B;tCAC5B,0BAAe,WAAf,GAA8B;xCAC9B,wBAAa,WAAb,GAA4B;tCAE5B,6BAAkB,WAAlB,GAAiC;3CACjC,+BAAoB,WAApB,GAAmC;7CACnC,6BAAkB,WAAlB,GAAiC;3CA5Ga;AA7DF;AAE5C,UAAa,kCAAH,eAAP,MAAO,CAAV;lEAEE,oBAAgB,OAAP,OAAU,kCAAH,CAAsC;rEACtD,6BAAyB,OAAP,OAAU,kCAAH,CAA+C;9EACxE,8BAA0B,OAAP,OAAU,kCAAH,CAAgD;/EAC1E,6BAAyB,OAAP,OAAU,kCAAH,CAA+C;9EACxE,+BAA2B,OAAP,OAAU,kCAAH,CAAiD;hFAC5E,8BAA0B,OAAP,OAAU,kCAAH,CAAgD;/EAC1E,gCAA4B,OAAP,OAAU,kCAAH,CAAkD;jFAC9E,kBAAK,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAuC,MAAhD;jFACZ,oBAAO,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAyC,QAAlD;rFACd,kBAAK,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAuC,MAAhD;jFACZ,uBAAU,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA4C,WAArD;3FACjB,yBAAY,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA8C,aAAvD;/FACnB,uBAAU,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA4C,WAArD;3FACjB,0BAAa,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA+C,cAAxD;jGACpB,4BAAe,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAiD,gBAA1D;rGACtB,0BAAa,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA+C,cAAxD;jGACpB,+BAAkB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAoD,mBAA7D;3GACzB,iCAAoB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAsD,qBAA/D;/GAC3B,+BAAkB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAoD,mBAA7D;3GACzB,wBAAW,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA6C,YAAtD;7FAClB,0BAAa,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA+C,cAAxD;jGACpB,wBAAW,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA6C,YAAtD;7FAClB,6BAAgB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAkD,iBAA3D;vGACvB,+BAAkB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAoD,mBAA7D;3GACzB,6BAAgB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAkD,iBAA3D;vGACvB,0BAAa,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA+C,cAAxD;jGACpB,4BAAe,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAiD,gBAA1D;rGACtB,0BAAa,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA+C,cAAxD;jGACpB,+BAAkB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAoD,mBAA7D;3GACzB,iCAAoB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAsD,qBAA/D;/GAC3B,+BAAkB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAoD,mBAA7D;3GACzB,gCAA4B,OAAP,OAAU,kCAAH,CAAkD;jFAC9E,kCAA8B,OAAP,OAAU,kCAAH,CAAoD;nFAClF,iCAA6B,OAAP,OAAU,kCAAH,CAAmD;lFAChF,oCAAgC,OAAP,OAAU,kCAAH,CAAsD;rFACtF,mCAA+B,OAAP,OAAU,kCAAH,CAAqD;pFACpF,iCAAoB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAsD,qBAA/D;/GAC3B,mCAAsB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAwD,uBAAjE;nHAC7B,mCAAsB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAwD,uBAAjE;nHAC7B,oCAAuB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAyD,wBAAlE;rHAC9B,iCAAoB,OAAO,CAAS,OAAP,OAAU,kCAAH,CAAsD,qBAA/D;/GAC3B,0BAAsB,OAAP,OAAU,kCAAH,CAA4C;3EAClE,8BAA0B,OAAP,OAAU,kCAAH,CAAgD;/EAC1E,+BAA2B,OAAP,OAAU,kCAAH,CAAiD;hFAC5E,wBAAW,OAAO,CAAS,OAAP,OAAU,kCAAH,CAA6C,YAAtD;7FAClB,sCAAkC,OAAP,OAAU,kCAAH,CAAwD;vFAC1F,wCAAoC,OAAP,OAAU,kCAAH,CAA0D;zFAC9F,uCAAmC,OAAP,OAAU,kCAAH,CAAyD;xFAC5F,yCAAqC,OAAP,OAAU,kCAAH,CAA2D;nFAlDlG;PAF4C;AA4KE;AAEzB,eAArB,KAAqB;pBACA,eAArB,KAAqB;pBACE,eAAvB,KAAuB;pBACA,eAAvB,KAAuB;pBACC,eAAxB,KAAwB;pBAElB,eAAN,KAAM;pBACE,eAAR,KAAQ;pBACI,eAAZ,KAAY;pBACN,eAAN,KAAM;pBACK,eAAX,KAAW;pBACE,eAAb,KAAa;pBACF,eAAX,KAAW;pBAEG,eAAd,KAAc;pBACE,eAAhB,KAAgB;pBACF,eAAd,KAAc;pBAEK,eAAnB,KAAmB;pBACE,eAArB,KAAqB;pBACF,eAAnB,KAAmB;pBAEP,eAAZ,KAAY;pBACE,eAAd,KAAc;pBACF,eAAZ,KAAY;pBAEK,eAAjB,KAAiB;pBACE,eAAnB,KAAmB;pBACF,eAAjB,KAAiB;pBAEH,eAAd,KAAc;pBACE,eAAhB,KAAgB;pBACF,eAAd,KAAc;pBAEK,eAAnB,KAAmB;pBACE,eAArB,KAAqB;pBACF,eAAnB,KAAmB;pBACnB;AAvC8C;AAzwcjB;AAmHf;AACS;AACA;AACE;AACK,2CrB9LjB,iDqB8LiB;5FACF;AACD;AACG;AACD;AACG,6CrBnMnB,iDqBmMmB;9FACC,8CrBpMpB,iDqBoMoB;/FACH,2CrBrMjB,iDqBqMiB;5FACE,6CrBtMnB,iDqBsMmB;9FACR,qCnBlFJ,YmBkFI;jDACA,qCnBnFJ,YmBmFI;jDACE,uCnBpFN,YmBoFM;nDACH;AACA;AACE;AACC;AACN;AACC,kCnBkQA,iEmBlQA;nGACI,sCA3IG,2CA2IH;jFACD;AAGJ,iCnBuKD,+DmBvKC;hGACE,mCnB4PD,iEmB5PC;pGACF,iCnByLD,+DmBzLC;hGAEL,4BnBmKI,+DmBnKJ;3FACE,8BnBwPI,iEmBxPJ;/FACF,4BnBqLI,+DmBrLJ;3FAEa,yCnB+JT,+DmB/JS;xGACE,2CnBoPT,iEmBpPS;5GACF,yCnBiLT,+DmBjLS;xGAEF,uCnB2JP,+DmB3JO;tGACE,yCnBgPP,iEmBhPO;1GACF,uCnB6KP,+DmB7KO;tGAEH,oCnBuJJ,+DmBvJI;nGACE,sCnB4OJ,iEmB5OI;vGACF,oCnByKJ,+DmBzKI;nGAEF,kCnBmJF,+DmBnJE;jGACE,oCnBwOF,iEmBxOE;rGACF,kCnBqKF,+DmBrKE;jGAEO,yCnB+IT,+DmB/IS;xGACE,2CnBoOT,iEmBpOS;5GACF,yCnBiKT,+DmBjKS;xGAEL,oCnB2IJ,+DmB3II;nGACE,sCnBgOJ,iEmBhOI;vGACF,oCnB6JJ,+DmB7JI;nGAEY,gDnB8CX,oEmB9CW;pHACF,8CnB6CT,oEmB7CS;lHACC,+CnB4CV,oEmB5CU;nHACF,6CnB2CR,oEmB3CQ;jHAhLH;AAmLI;;;AAE/B;AACA;AAH+B;;AAE/B,mBAF+B;nBAG/B,gBAH+B;;;hBAuwfgB;AAEjD,UAAG,UAAM,KAAG,KAAZ,EACE,UAAK,OAAO,CAAC,KAAD,CADd;xDAFiD;AAnBA;AAEjD,mBAAQ;nBAFyC;AAKC;AAGlD,sBAAY;tBACZ,mBAAS,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;jOAC7B,gBAAK,WAAL,GAAoB;9BAL8B;AAQA;AAE5C,eAAN,KAAM;pBACN;AAHkD;AArBF;AAEhD,UAAa,sCAAH,eAAP,MAAO,CAAV;tEAEE,kBAAK,OAAO,CAAS,OAAP,OAAU,sCAAH,CAA2C,MAApD;9EAFd;PAFgD;AA5uff;AAYlB,4BnBqHI,+DmBrHJ;3FAZkB;AAeH;;AAEE;;;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7B8B;;AAE9B,mBAF8B;nBAG9B,mBAH8B;nBAM9B,uBAN8B;vBAO9B,oBAP8B;pBAQ9B,sBAR8B;tBAS9B,qBAT8B;rBAU9B,oBAV8B;pBAW9B,qBAX8B;rBAwB9B,yBAxB8B;zBAyB9B,0BAzB8B;;;1BAm0dmB;AAGnD,UAAY,UAAT,cAAY,KAAH,CAAZ;xCAEE,wBAAY;xBACZ,qBAAQ,oBA78a4C;lCA08atD;PAHmD;AAnBC;AAEpD,UAAG,cAAU,KAAG,KAAhB;lCAEE,yBAAa;zBACb,qBAAQ,oBAz7a4C;lCAs7atD;PAFoD;AA6BC;AAErD,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,qBAAQ,oBAt9a4C;lCAm9atD;PAFqD;AASD;AAEpD,UAAG,cAAU,KAAG,KAAhB,EACE,cAAS,OAAO,CAAC,KAAD,CADlB;hEAFoD;AAyFE;AAEtD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFsD;AAMD;AAErD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAFqD;AAwFE;AAEvD,UAAG,iBAAa,KAAG,KAAnB,EACE,iBAAY,OAAO,CAAC,KAAD,CADrB;tEAFuD;AAjLH;AAEpD,UAAG,cAAU,KAAG,KAAhB,EACE,cAAS,OAAO,CAAC,KAAD,CADlB;hEAFoD;AA2KC;AAErD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAFqD;AAYF;AAEnD,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,qBAAQ,oBA5pb4C;lCAypbtD;PAFmD;AAtJY;AAG/D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,oBAAO,CAAC,IAAD;lBAHT;PAH+D;AA+EC;AAGhE,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AAnJJ;AAG5D,UAAG,sBAAkB,KAAG,KAAxB;1CAEE,iCAAqB;jCACrB,qBAAQ;dAHV;PAH4D;AAyCO;AAGnE,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,oBAAO,CAAC,IAAD;lBAHT;PAHmE;AAUG;AAGtE,UAAG,gCAA4B,KAAG,KAAlC;pDAEE,2CAA+B;3CAC/B,oBAAO,CAAC,IAAD;lBAHT;PAHsE;AA2BF;AAGpE,UAAG,8BAA0B,KAAG,KAAhC;lDAEE,yCAA6B;zCAC7B,oBAAO,CAAC,IAAD;lBAHT;PAHoE;AAoBH;AAGjE,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,oBAAO,CAAC,IAAD;lBAHT;PAHiE;AAgCG;AAGpE,UAAG,8BAA0B,KAAG,KAAhC;lDAEE,yCAA6B;zCAC7B,oBAAO,CAAC,IAAD;lBAHT;PAHoE;AA2BG;AAGvE,UAAG,iCAA6B,KAAG,KAAnC;rDAEE,4CAAgC;5CAChC,oBAAO,CAAC,IAAD;lBAHT;PAHuE;AAUF;AAGrE,UAAG,+BAA2B,KAAG,KAAjC;nDAEE,0CAA8B;1CAC9B,oBAAO,CAAC,IAAD;lBAHT;PAHqE;AAoBH;AAGlE,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAHkE;AA9HT;AAGzD,UAAG,mBAAe,KAAG,KAArB,EACE,mBAAc,OAAO,CAAC,KAAD,CADvB;1EAHyD;AA+EC;AAG1D,UAAG,oBAAgB,KAAG,KAAtB,EACE,oBAAe,OAAO,CAAC,KAAD,CADxB;5EAH0D;AApDS;AAGnE,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,oBAAO,CAAC,IAAD;lBAHT;PAHmE;AAoBH;AAGhE,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AAqEI;AAGpE,UAAG,8BAA0B,KAAG,KAAhC;lDAEE,yCAA6B;zCAC7B,oBAAO,CAAC,IAAD;lBAHT;PAHoE;AAmBH;AAGjE,UAAG,2BAAuB,KAAG,KAA7B;/CAEE,sCAA0B;tCAC1B,oBAAO,CAAC,IAAD;lBAHT;PAHiE;AAlNjB;AAEhD,mBAAQ,oBAj7a8C;vCA+6aN;AAlEC;AAGjD,sBAAY;tBACZ,sBAAY;tBACZ,+BAAqB;/BACrB,sBAAY,cAAC,yCAAD;7EACZ,uBAAa;vBACb,wBAAc;xBACd,mCAAyB;nCACzB,oCAA0B;pCAC1B,sCAA4B;tCAC5B,uCAA6B;vCAC7B,sCAA4B;tCAC5B,oCAA0B;pCAC1B,uCAA6B;vCAC7B,qCAA2B;rCAC3B,yCAA+B;zCAC/B,uCAA6B;vCAC7B,0CAAgC;1CAChC,wCAA8B;xCAC9B,wBAAc,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;7KAClC,0BAAgB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;pLACtC,6BAAmB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;vLACzC,uBAAa,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;5KACjC,yBAAe,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;nLACrC,4BAAkB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;tLAExC,uBAAa,qDAAmB,QAAC;pFACjC,oBAAS,SAAC,CAAS,OAAT;rCACV,wBAAc,qDAAmB,QAAC;rFAClC,qBAAU,SAAC,CAAS,OAAT;tCAEX,4CAAY,YAAY,CAAC,eAAW,EAAZ;1EACxB,4CAAY,YAAY,CAAC,gBAAY,EAAb;3EACxB,kCAAwB;lCACxB,mCAAyB;nCAGzB,kCAAwB,UAAK,CAAsB,CAArB,yBAAqB,GAAE,EAAF,CAAK,GAAE,EAA7B;lFAC7B,mCAAyB,UAAK,CAAuB,CAAtB,0BAAsB,GAAE,EAAF,CAAK,GAAE,EAA9B;pFAG9B,qBAAU,WAAV,GAAyB;nCACzB,oBAAS,WAAT,GAAwB;lCACxB,qBAAU,WAAV,GAAyB;nCACzB,oBAAS,WAAT,GAAwB;lCACxB,uBAAY,WAAZ,GAA2B;rCAC3B,0BAAe,WAAf,GAA8B;xCAC9B,sBAAW,WAAX,GAA0B;pCAC1B,yBAAc,WAAd,GAA6B;vCAlDoB;AAqDA;AAEvC,eAAV,KAAU;pBACC,eAAX,KAAW;pBACE,eAAb,KAAa;pBACG,eAAhB,KAAgB;pBACL,eAAX,KAAW;pBACC,eAAZ,KAAY;pBACG,eAAf,KAAe;pBACL,eAAV,KAAU;pBACV;AAViD;AAvFF;AAE/C,UAAa,qCAAH,eAAP,MAAO,CAAV;rEAEE,wBAAiE,WAA7C,OAAP,OAAU,qCAAH,CAA6C;vFACjE,0BAAsB,OAAP,OAAU,qCAAH,CAA+C;9EACrE,yBAAqB,OAAP,OAAU,qCAAH,CAA8C;7EACnE,uBAAU,OAAO,CAAS,OAAP,OAAU,qCAAH,CAA+C,WAAxD;9FACjB,yBAAY,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAiD,aAA1D;lGACnB,4BAAe,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAoD,gBAA7D;xGACtB,sBAAS,OAAO,CAAS,OAAP,OAAU,qCAAH,CAA8C,UAAvD;5FAChB,sBAAS,OAAO,CAAS,OAAP,OAAU,qCAAH,CAA8C,UAAvD;5FAChB,wBAAW,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAgD,YAAzD;hGAClB,2BAAc,OAAO,CAAS,OAAP,OAAU,qCAAH,CAAmD,eAA5D;tGACrB,uBAAU,OAAO,CAAS,OAAP,OAAU,qCAAH,CAA+C,WAAxD;9FACjB,qCAAiC,OAAP,OAAU,qCAAH,CAA0D;zFAC3F,oCAAgC,OAAP,OAAU,qCAAH,CAAyD;xFACzF,iCAA6B,OAAP,OAAU,qCAAH,CAAsD;rFACnF,wBAAoB,OAAP,OAAU,qCAAH,CAA6C;5EACjE,sCAAkC,OAAP,OAAU,qCAAH,CAA2D;1FAC7F,yCAAqC,OAAP,OAAU,qCAAH,CAA8D;7FACnG,wCAAoC,OAAP,OAAU,qCAAH,CAA6D;5FACjG,2CAAuC,OAAP,OAAU,qCAAH,CAAgE;/FACvG,uCAAmC,OAAP,OAAU,qCAAH,CAA4D;3FAC/F,0CAAsC,OAAP,OAAU,qCAAH,CAA+D;9FACrG,yCAAqC,OAAP,OAAU,qCAAH,CAA8D;7FACnG,4CAAwC,OAAP,OAAU,qCAAH,CAAiE;hGACzG,wCAAoC,OAAP,OAAU,qCAAH,CAA6D;5FACjG,yCAAqC,OAAP,OAAU,qCAAH,CAA8D;7FACnG,qCAAiC,OAAP,OAAU,qCAAH,CAA0D;zFAC3F,sCAAkC,OAAP,OAAU,qCAAH,CAA2D;nFA5B/F;PAF+C;AAvsdf;AAuEd,+BAraW,4CAqaX,yBAAuE,uBAAC,yCAAD,CAAvE;rKACA;AACC;AACC;AACD,gCnBqCA,+DmBrCA;/FACC,iCnBoCD,+DmBpCC;hGACC,kCnByHA,iEmBzHA;nGACC,mCnBwHD,iEmBxHC;pGACE,qCnBuHH,iEmBvHG;tGACC,sCnBsHJ,iEmBtHI;vGACN,gCnBmDA,+DmBnDA;/FACC,iCnBkDD,+DmBlDC;hGACU;AACC;AACJ,wCnB3OP,YmB2OO;pDACO,+CnB/DV,oEmB+DU;nHACF,6CnBhER,oEmBgEQ;jHACG,gDnBjEX,oEmBiEW;pHACF,8CnBlET,oEmBkES;lHACI,kDnBnEb,oEmBmEa;tHACF,gDnBpEX,oEmBoEW;pHACG,mDnBrEd,oEmBqEc;vHACF,iDnBtEZ,oEmBsEY;rHACL,4CAhGD,6CAgGC;zFACC,6CAjGF,6CAiGE;1FACE,+CAlGJ,6CAkGI;5FACC,gDAnGL,6CAmGK;7FAjGH;AAoGC;;;AAE/B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApC+B;;AAE/B,mBAF+B;nBAG/B,mBAH+B;nBAO/B,sBAP+B;tBAQ/B,wBAR+B;xBAS/B,mBAT+B;nBAU/B,qBAV+B;rBAW/B,mBAX+B;nBAY/B,sBAZ+B;tBAoB/B,qCApB+B;rCAqB/B,sCArB+B;tCAsB/B,wCAtB+B;xCAuB/B,mCAvB+B;nCAyB/B,0CAzB+B;1CA0B/B,wCA1B+B;xCA2B/B,4CA3B+B;5CA4B/B,0CA5B+B;1CA6B/B,uCA7B+B;vCA8B/B,yCA9B+B;zCA+B/B,2CA/B+B;3CAgC/B,6CAhC+B;;;7CA8semB;AAGpD,UAAY,UAAT,cAAY,KAAH,CAAZ;xCAEE,wBAAY;xBACZ,qBAAQ,oBA57b4C;lCAy7btD;PAHoD;AAmBA;AAEpD,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,qBAAQ,oBA98b4C;lCA28btD;PAFoD;AAtGG;AAEvD,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf,qBAAQ,oBAx2b4C;lCAq2btD;PAFuD;AA6JH;AAEpD,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,oBAAO,CAAC,IAAD;lBAHT;PAFoD;AA7LG;AAEvD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFuD;AA0DE;AAGzD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAHyD;AAqFL;AAEpD,UAAG,aAAS,KAAG,KAAf,EACE,aAAQ,OAAO,CAAC,KAAD,CADjB;9DAFoD;AAuDE;AAGtD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAHsD;AAhMC;AAEvD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFuD;AAiLH;AAEpD,UAAG,aAAS,KAAG,KAAf,EACE,aAAQ,OAAO,CAAC,KAAD,CADjB;9DAFoD;AAxFe;AAGnE,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAHmE;AA+HF;AAGjE,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,oBAAO,CAAC,IAAD;lBAHT;PAHiE;AAlNK;AAGtE,UAAG,+BAA2B,KAAG,KAAjC;nDAEE,0CAA8B;1CAC9B,oBAAO,CAAC,IAAD;lBAHT;PAHsE;AAqDF;AAGpE,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,oBAAO,CAAC,IAAD;lBAHT;PAHoE;AA4DnB;AAEjD,UAAG,UAAM,KAAG,KAAZ;9BAEE,qBAAS;rBACT,qBAAQ,oBAr8b4C;lCAk8btD;PAFiD;AA2Ge;AAGhE,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AA7JG;AAGnE,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAHmE;AA/FI;AAEvE,UAAG,gCAA4B,KAAG,KAAlC,EACE,gCAA2B,OAAO,CAAC,KAAD,CADpC;pGAFuE;AA6DE;AAGzE,UAAG,kCAA8B,KAAG,KAApC,EACE,kCAA6B,OAAO,CAAC,KAAD,CADtC;xGAHyE;AA0HL;AAEpE,UAAG,6BAAyB,KAAG,KAA/B,EACE,6BAAwB,OAAO,CAAC,KAAD,CADjC;9FAFoE;AA0CE;AAGtE,UAAG,+BAA2B,KAAG,KAAjC,EACE,+BAA0B,OAAO,CAAC,KAAD,CADnC;lGAHsE;AAxHV;AAG5D,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ;dAHV;PAH4D;AAvHe;AAG3E,UAAG,oCAAgC,KAAG,KAAtC,EACE,oCAA+B,OAAO,CAAC,KAAD,CADxC;5GAH2E;AAOE;AAG7E,UAAG,sCAAkC,KAAG,KAAxC,EACE,sCAAiC,OAAO,CAAC,KAAD,CAD1C;hHAH6E;AAaD;AAG5E,UAAG,qCAAiC,KAAG,KAAvC,EACE,qCAAgC,OAAO,CAAC,KAAD,CADzC;9GAH4E;AAOE;AAG9E,UAAG,kCAA8B,KAAG,KAApC,EACE,uCAAkC,OAAO,CAAC,KAAD,CAD3C;7GAH8E;AA4JN;AAGxE,UAAG,iCAA6B,KAAG,KAAnC,EACE,iCAA4B,OAAO,CAAC,KAAD,CADrC;tGAHwE;AAOE;AAG1E,UAAG,mCAA+B,KAAG,KAArC,EACE,mCAA8B,OAAO,CAAC,KAAD,CADvC;1GAH0E;AAaD;AAGzE,UAAG,kCAA8B,KAAG,KAApC,EACE,kCAA6B,OAAO,CAAC,KAAD,CADtC;xGAHyE;AAOE;AAG3E,UAAG,oCAAgC,KAAG,KAAtC,EACE,oCAA+B,OAAO,CAAC,KAAD,CADxC;5GAH2E;AA1JA;AAG3E,UAAG,oCAAgC,KAAG,KAAtC;xDAEE,+CAAmC;/CACnC,oBAAO,CAAC,IAAD;lBAHT;PAH2E;AA0BC;AAG5E,UAAG,qCAAiC,KAAG,KAAvC;zDAEE,gDAAoC;hDACpC,oBAAO,CAAC,IAAD;lBAHT;PAH4E;AAyDJ;AAGxE,UAAG,iCAA6B,KAAG,KAAnC;rDAEE,4CAAgC;5CAChC,oBAAO,CAAC,IAAD;lBAHT;PAHwE;AA2GC;AAGzE,UAAG,kCAA8B,KAAG,KAApC;tDAEE,6CAAiC;7CACjC,oBAAO,CAAC,IAAD;lBAHT;PAHyE;AA3PxB;AAEjD,mBAAQ,oBA9xb8C;vCA4xbL;AArFC;AAGlD,sBAAY;tBACZ,sBAAY,cAAC,yCAAD;7EACZ,8BAAoB;9BACpB,sBAAY;tBACZ,yBAAe;zBACf,kCAAwB;lCACxB,qCAA2B;rCAC3B,sBAAY;tBACZ,mBAAS;nBACT,qCAA2B;rCAC3B,mCAAyB;nCACzB,wCAA8B;xCAC9B,sCAA4B;tCAC5B,yBAAe,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;9KACnC,2BAAiB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;rLACvC,sBAAY,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;3KAChC,wBAAc,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;lLACpC,yCAA+B,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;/LACnD,2CAAiC,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;rMACvD,sCAA4B,qDAAmB,QAAC,YAAM,CAAC,mEAAU,QAAX,CAAN;5LAChD,wCAA8B,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;lMACpD,8CAAoC,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;5PACxD,gDAAsC,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;1MAC5D,2CAAiC,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;zPACrD,6CAAmC,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;vMACzD,6CAAmC,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;3PACvD,+CAAqC,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;zMAC3D,0CAAgC,qDAAmB,QAAC,YAAM,CAAC,mEAAU,mDAAiB,CAAC,IAAK,IAAK,GAAX,CAA5B,CAAN;xPACpD,4CAAkC,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;tMACxD,sBAAY,qDAAmB,QAAC;nFAChC,mBAAQ,SAAC,CAAS,OAAT;pCACT,yBAAe,qDAAmB,QAAC;tFACnC,sBAAW,SAAC,CAAS,OAAT;vCAEZ,0CAAgC;1CAChC,2CAAiC;3CACjC,6CAAmC;7CACnC,8CAAoC;9CAEpC,sBAAW,WAAX,GAA0B;pCAC1B,mBAAQ,WAAR,GAAuB;jCACvB,wBAAa,WAAb,GAA4B;tCAC5B,qBAAU,WAAV,GAAyB;nCACzB,sCAA2B,WAA3B,GAA0C;pDAC1C,mCAAwB,WAAxB,GAAuC;jDACvC,wCAA6B,WAA7B,GAA4C;tDAC5C,qCAA0B,WAA1B,GAAyC;nDACzC,2CAAgC,WAAhC,GAA+C;zDAC/C,wCAA6B,WAA7B,GAA4C;tDAC5C,6CAAkC,WAAlC,GAAiD;3DACjD,0CAA+B,WAA/B,GAA8C;xDAC9C,0CAA+B,WAA/B,GAA8C;xDAC9C,uCAA4B,WAA5B,GAA2C;rDAC3C,4CAAiC,WAAjC,GAAgD;1DAChD,yCAA8B,WAA9B,GAA6C;vDAC7C,mBAAQ,WAAR,GAAuB;jCACvB,sBAAW,WAAX,GAA0B;pCA3DwB;AA8DA;AAEvB,eAA3B,KAA2B;pBACF,eAAzB,KAAyB;pBACK,eAA9B,KAA8B;pBACF,eAA5B,KAA4B;pBACK,eAAjC,KAAiC;pBACH,eAA9B,KAA8B;pBACK,eAAnC,KAAmC;pBACH,eAAhC,KAAgC;pBACA,eAAhC,KAAgC;pBACH,eAA7B,KAA6B;pBACK,eAAlC,KAAkC;pBACH,eAA/B,KAA+B;pBACtB,eAAT,KAAS;pBACG,eAAZ,KAAY;pBACA,eAAZ,KAAY;pBACH,eAAT,KAAS;pBACK,eAAd,KAAc;pBACH,eAAX,KAAW;pBACX;AApBkD;AAnGF;AAEhD,UAAa,sCAAH,eAAP,MAAO,CAAV;tEAEE,wBAAkE,WAA9C,OAAP,OAAU,sCAAH,CAA8C;xFAClE,wBAAoB,OAAP,OAAU,sCAAH,CAA8C;7EAClE,qBAAiB,OAAP,OAAU,sCAAH,CAA2C;1EAC5D,2BAAuB,OAAP,OAAU,sCAAH,CAAiD;hFACxE,wBAAW,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAiD,YAA1D;jGAClB,wBAAW,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAiD,YAA1D;jGAClB,0BAAa,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAmD,cAA5D;rGACpB,qBAAQ,OAAO,CAAS,OAAP,OAAU,sCAAH,CAA8C,SAAvD;3FACf,uBAAU,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAgD,WAAzD;/FACjB,qCAAwB,OAAO,CAAS,OAAP,OAAU,sCAAH,CAA8D,yBAAvE;3HAC/B,uCAA0B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAgE,2BAAzE;/HACjC,wCAA2B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAiE,4BAA1E;jIAClC,0CAA6B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAmE,8BAA5E;rIACpC,0CAA6B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAmE,8BAA5E;rIACpC,4CAA+B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAqE,gCAA9E;zIACtC,6CAAgC,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAsE,iCAA/E;3IACvC,+CAAkC,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAwE,mCAAjF;/IACzC,yCAA4B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAkE,6BAA3E;nIACnC,2CAA8B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAoE,+BAA7E;vIACrC,4CAA+B,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAqE,gCAA9E;zIACtC,8CAAiC,OAAO,CAAS,OAAP,OAAU,sCAAH,CAAuE,kCAAhF;7IACxC,qBAAQ,OAAO,CAAS,OAAP,OAAU,sCAAH,CAA8C,SAAvD;3FACf,wBAAoB,OAAP,OAAU,sCAAH,CAA8C;7EAClE,uCAAmC,OAAP,OAAU,sCAAH,CAA6D;5FAChG,qCAAiC,OAAP,OAAU,sCAAH,CAA2D;1FAC5F,0CAAsC,OAAP,OAAU,sCAAH,CAAgE;/FACtG,wCAAoC,OAAP,OAAU,sCAAH,CAA8D;7FAClG,oCAAgC,OAAP,OAAU,sCAAH,CAA0D;zFAC1F,uCAAmC,OAAP,OAAU,sCAAH,CAA6D;5FAChG,gCAA4B,OAAP,OAAU,sCAAH,CAAsD;9EA/BpF;PAFgD;AA17df;AAoFlB;AACG,+BA7hBY,6CA6hBZ,yBAAwE,uBAAC,yCAAD,CAAxE;tKACA;AACA;AACG;AACH,+BnBzDC,+DmByDD;9FACG,kCnB1DF,+DmB0DE;jGACH,+BnB/EC,+DmB+ED;9FACG,kCnBhFF,+DmBgFE;jGACD,iCnBKC,iEmBLD;lGACG,oCnBIF,iEmBJE;rGACU,8CnB5KT,oEmB4KS;lHACF,4CnB7KP,oEmB6KO;hHACK,iDnB9KZ,oEmB8KY;rHACF,+CnB/KV,oEmB+KU;nHACJ,2CAzMA,6CAyMA;xFACG,8CA1MH,6CA0MG;3FACC,+CnBzFf,+DmByFe;9GACG,kDnB1FlB,+DmB0FkB;jHACD,iDnBLf,iEmBKe;lHACG,oDnBNlB,iEmBMkB;rHACA,oDnB7FpB,+DmB6FoB;nHACG,uDnB9FvB,+DmB8FuB;tHACD,sDnBTpB,iEmBSoB;vHACG,yDnBVvB,iEmBUuB;1HACN,mDnBjGnB,+DmBiGmB;lHACG,sDnBlGtB,+DmBkGsB;rHACD,qDnBbnB,iEmBamB;tHACG,wDnBdtB,iEmBcsB;zHACL;AACC;AACE;AACC;AAChB;AArHO;AAwHD;;AACH;;AAEN;;;AAErB;AACA;AACA;AACA;AALqB;;AAErB,mBAFqB;;;nBAyzfiB;AAExC,UAAG,WAAO,KAAG,KAAb;/BAEE,sBAAU;tBACV,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBAnqd4C;lCA8pdtD;PAFwC;AAWC;AAEzC,UAAG,YAAQ,KAAG,KAAd;hCAEE,uBAAW;vBACX,qBAAQ,oBA5qd4C;lCAyqdtD;PAFyC;AAhBE;AAAZ;AAE/B,eAAU;fAFqB;AAAY;AAyBC;AAE5C,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,qBAAQ,sBAnneyC;3CAonejD,qBAAQ;dAJV;PAF4C;AAhCJ;AAExC,sBAAY;tBACZ,oBAAU;pBACV,wBAAc;xBAJ0B;AAVF;AAEtC,UAAc,4BAAH,eAAP,MAAO,CAAX;5DAEE,sBAAkB,OAAP,OAAU,4BAAH,CAAkC;jEACpD,uBAAmB,OAAP,OAAU,4BAAH,CAAmC;lEACtD,0BAAsB,OAAP,OAAU,4BAAH,CAAsC,aAAV;3EAJpD;PAFsC;AAnyff;AAcP,6BtC3tBT,YsC2tBS;zCACC;AACG,iCtC7tBb,YsC6tBa;7CAhBG;AAmBO;;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAlB4B;;AAE5B,mBAF4B;nBAG5B,mBAH4B;nBAM5B,sBAN4B;tBAO5B,wBAP4B;xBAQ5B,mBAR4B;nBAS5B,qBAT4B;rBAU5B,mBAV4B;nBAW5B,sBAX4B;;;tBA40emB;AAGjD,UAAY,UAAT,cAAY,KAAH,CAAZ;xCAEE,wBAAY;xBACZ,qBAAQ,oBAxsc4C;lCAqsctD;PAHiD;AA9CG;AAEpD,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf,qBAAQ,oBAzpc4C;lCAspctD;PAFoD;AA8EH;AAEjD,UAAG,aAAS,KAAG,KAAf;jCAEE,wBAAY;xBACZ,qBAAQ,oBAvuc4C;lCAouctD;PAFiD;AApGG;AAEpD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFoD;AA+BE;AAGtD,UAAG,kBAAc,KAAG,KAApB,EACE,kBAAa,OAAO,CAAC,KAAD,CADtB;xEAHsD;AA+CL;AAEjD,UAAG,aAAS,KAAG,KAAf,EACE,aAAQ,OAAO,CAAC,KAAD,CADjB;9DAFiD;AA+BE;AAGnD,UAAG,eAAW,KAAG,KAAjB,EACE,eAAU,OAAO,CAAC,KAAD,CADnB;lEAHmD;AA7FC;AAEpD,UAAG,gBAAY,KAAG,KAAlB,EACE,gBAAW,OAAO,CAAC,KAAD,CADpB;pEAFoD;AAoEH;AAEjD,UAAG,aAAS,KAAG,KAAf,EACE,aAAQ,OAAO,CAAC,KAAD,CADjB;9DAFiD;AA9EkB;AAGnE,UAAG,+BAA2B,KAAG,KAAjC;nDAEE,0CAA8B;1CAC9B,oBAAO,CAAC,IAAD;lBAHT;PAHmE;AAgCF;AAGjE,UAAG,6BAAyB,KAAG,KAA/B;jDAEE,wCAA4B;xCAC5B,oBAAO,CAAC,IAAD;lBAHT;PAHiE;AAoDD;AAGhE,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AA0BF;AAG9D,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,oBAAO,CAAC,IAAD;lBAHT;PAH8D;AAUD;AAE7D,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,oBAAO,CAAC,IAAD;lBAHT;PAF6D;AA9EG;AAGhE,UAAG,4BAAwB,KAAG,KAA9B;hDAEE,uCAA2B;vCAC3B,oBAAO,CAAC,IAAD;lBAHT;PAHgE;AAUP;AAGzD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ;dAHV;PAHyD;AA/DX;AAE9C,mBAAQ,oBA3nc8C;vCAyncR;AA3CC;AAG/C,sBAAY;tBACZ,sBAAY,cAAC,qCAAD;zEACZ,8BAAoB;9BACpB,sBAAY;tBACZ,yBAAe;zBACf,kCAAwB;lCACxB,qCAA2B;rCAC3B,qCAA2B;rCAC3B,mCAAyB;nCACzB,wCAA8B;xCAC9B,sCAA4B;tCAC5B,yBAAe,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;9KACnC,2BAAiB,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;rLACvC,sBAAY,qDAAmB,QAAC,YAAM,CAAC,kEAAS,QAAV,CAAN;3KAChC,wBAAc,uDAAqB,QAAC,YAAM,CAAC,qEAAU,QAAX,CAAN;lLAEpC,sBAAY,qDAAmB,QAAC;nFAChC,mBAAQ,SAAC,CAAS,OAAT;pCACT,yBAAe,qDAAmB,QAAC;tFACnC,sBAAW,SAAC,CAAS,OAAT;vCAEZ,mBAAQ,WAAR,GAAuB;jCACvB,sBAAW,WAAX,GAA0B;pCAC1B,sBAAW,WAAX,GAA0B;pCAC1B,mBAAQ,WAAR,GAAuB;jCACvB,wBAAa,WAAb,GAA4B;tCAC5B,qBAAU,WAAV,GAAyB;nCA7BsB;AAgCA;AAEnC,eAAZ,KAAY;pBACH,eAAT,KAAS;pBACG,eAAZ,KAAY;pBACE,eAAd,KAAc;pBACL,eAAT,KAAS;pBACE,eAAX,KAAW;pBACX;AAR+C;AAvDF;AAE7C,UAAa,mCAAH,eAAP,MAAO,CAAV;nEAEE,wBAA+D,WAA3C,OAAP,OAAU,mCAAH,CAA2C;rFAC/D,wBAAoB,OAAP,OAAU,mCAAH,CAA2C;1EAC/D,2BAAuB,OAAP,OAAU,mCAAH,CAA8C;7EACrE,wBAAW,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA8C,YAAvD;9FAClB,wBAAW,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA8C,YAAvD;9FAClB,0BAAa,OAAO,CAAS,OAAP,OAAU,mCAAH,CAAgD,cAAzD;lGACpB,qBAAQ,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA2C,SAApD;xFACf,uBAAU,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA6C,WAAtD;5FACjB,qBAAQ,OAAO,CAAS,OAAP,OAAU,mCAAH,CAA2C,SAApD;xFACf,uCAAmC,OAAP,OAAU,mCAAH,CAA0D;zFAC7F,qCAAiC,OAAP,OAAU,mCAAH,CAAwD;vFACzF,0CAAsC,OAAP,OAAU,mCAAH,CAA6D;5FACnG,wCAAoC,OAAP,OAAU,mCAAH,CAA2D;1FAC/F,oCAAgC,OAAP,OAAU,mCAAH,CAAuD;tFACvF,uCAAmC,OAAP,OAAU,mCAAH,CAA0D;zFAC7F,gCAA4B,OAAP,OAAU,mCAAH,CAAmD;3EAjBjF;PAF6C;AAjsef;AA4CZ,+BA/nBS,0CA+nBT,yBAAqE,uBAAC,qCAAD,CAArE;/JACA;AACG;AACH,+BnBjLC,+DmBiLD;9FACG,kCnBlLF,+DmBkLE;jGACH,+BnB/JC,+DmB+JD;9FACG,kCnBhKF,+DmBgKE;jGACD,iCnB/FC,iEmB+FD;lGACG,oCnBhGF,iEmBgGE;rGACU,8CnBhRT,oEmBgRS;lHACF,4CnBjRP,oEmBiRO;hHACK,iDnBlRZ,oEmBkRY;rHACF,+CnBnRV,oEmBmRU;nHACJ,2CA7SA,6CA6SA;xFACG,8CA9SH,6CA8SG;3FACP;AA3DI;AA8DZ;;AAEW;;AAEA;;AAEI;;AAEX;;;AAEpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhBoB;;AAEpB,mBAFoB;;;nBAwwcuB;AAE7C,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBA3sa4C;lCAssatD;PAF6C;AAgHI;AAEjD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ,oBAzza4C;lCAszatD;PAFiD;AAtDL;AAE5C,UAAG,gBAAY,KAAG,KAAlB;pCAEE,2BAAe;3BACf,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBArwa4C;lCAgwatD;PAF4C;AA2CE;AAE9C,UAAG,kBAAc,KAAG,KAApB;tCAEE,6BAAiB;7BACjB,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBAhza4C;lCA2yatD;PAF8C;AA1FQ;AAEtD,UAAG,0BAAsB,KAAG,KAA5B;9CAEE,qCAAyB;rCACzB,qBAAQ,mBAAmB,CAAC,KAAD;vCAH7B;PAFsD;AA8GL;AAGjD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBAr0a4C;lCAg0atD;PAHiD;AA3CF;AAE/C,UAAG,mBAAe,KAAG,KAArB;vCAEE,8BAAkB;9BAClB,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBAzxa4C;lCAoxatD;PAF+C;AAWI;AAGnD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,qBAAQ,sBAAR,GAAkC;9CAClC,qBAAQ,qBAAR,GAAiC;7CACjC,qBAAQ,oBArya4C;lCAgyatD;PAHmD;AApBA;AAEnD,UAAG,uBAAmB,KAAG,KAAzB;3CAEE,kCAAsB;lCACtB,qBAAQ,mBAAmB,CAAC,KAAD;vCAH7B;PAFmD;AA/BF;AAGjD,UAAG,qBAAiB,KAAG,KAAvB;zCAEE,gCAAoB;hCACpB,qBAAQ;dAHV;PAHiD;AA3CP;AAAZ;AAE9B,eAAU;fAFoB;AAAY;AAVC;AAE3C,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,qBAAQ,sBAxnbyC;3CAynbjD,qBAAQ;dAJV;PAF2C;AAmCA;AAE3C,UAAG,eAAW,KAAG,KAAjB;nCAEE,0BAAc;1BACd,qBAAQ,mBAAmB,CAAC,KAAD;vCAH7B;PAF2C;AASE;AAE7C,UAAG,iBAAa,KAAG,KAAnB;rCAEE,4BAAgB;5BAChB,qBAAQ,mBAAmB,CAAC,KAAD;vCAH7B;PAF6C;AAmBQ;AAGrD,UAAG,yBAAqB,KAAG,KAA3B;7CAEE,oCAAwB;pCACxB,qBAAQ;dAHV;PAHqD;AAjFd;AAEvC,sBAAY;tBACZ,8BAAoB;9BACpB,kCAAwB;lCACxB,0BAAgB;1BAChB,8BAAoB;9BACpB,2BAAiB;3BACjB,yBAAe;zBACf,0BAAgB;1BAChB,wBAAc;xBACd,mCAAyB;nCACzB,8BAAoB;9BACpB,gCAAsB;hCACtB,4BAAkB;5BAClB,wBAAc,cAAG,CAAC,kBAAD;zDAfsB;AArBF;AAErC,UAAa,2BAAH,eAAP,MAAO,CAAV;3DAEE,gCAA4B,OAAP,OAAU,2BAAH,CAA2C;1EACvE,oCAAgC,OAAP,OAAU,2BAAH,CAA+C;9EAC/E,4BAAwB,OAAP,OAAU,2BAAH,CAAuC;tEAC/D,gCAA4B,OAAP,OAAU,2BAAH,CAA2C;1EACvE,qCAAiC,OAAP,OAAU,2BAAH,CAAgD;/EACjF,kCAA8B,OAAP,OAAU,2BAAH,CAA6C;5EAC3E,gCAA4B,OAAP,OAAU,2BAAH,CAA2C;1EACvE,kCAA8B,OAAP,OAAU,2BAAH,CAA6C;5EAC3E,8BAA0B,OAAP,OAAU,2BAAH,CAAyC;xEACnE,6BAAyB,OAAP,OAAU,2BAAH,CAAwC;vEACjE,2BAAuB,OAAP,OAAU,2BAAH,CAAsC;rEAC7D,4BAAwB,OAAP,OAAU,2BAAH,CAAuC;tEAC/D,0BAAsB,OAAP,OAAU,2BAAH,CAAqC;pEAC3D,0BAAsB,OAAP,OAAU,2BAAH,CAAqC,aAAV;1EAfnD;PAFqC;AAltcf;AAsCM;AACG;AACT,mCtC90Bf,YsC80Be;/CACI,uCA/CG,4CA+CH;nFACH,oCtCh1BhB,YsCg1BgB;hDACF,kCtCj1Bd,YsCi1Bc;9CACC,mCtCl1Bf,YsCk1Be;/CACF,iCtCn1Bb,YsCm1Ba;7CACI,qCtCp1BjB,YsCo1BiB;jDACI,yCArDC,4CAqDD;rFACF;AACN,iCtCtzBX,8BsCszBW;/DACM,uCAtDG,4CAsDH;nFACI,2CArDG,gDAqDH;3FAnDR;AAsDG;;AACQ;;AACH;;AACC,qDADD,sDACC;3GACI;;AACP;;AAEE,qFAAmB,UtCnyB1C,2BsCmyB0C,EAAgB,SP9vB/C,2DO8vB+C,CAAnC;jMACiB,sGAAmB,UtCpyB3D,2BsCoyB2D,EAAoB,ahBvwBvE,qDgBuwBuE,EAAwB,SrB3qBxG,yCqB2qBwG,EAAgB,UA1J9F,8CA0J8F,EAA8C,yBAA2B,8BAAxJ;tXACD,qGAAmB,UtCryB1D,2BsCqyB0D,EAAoB,ahBxwBtE,qDgBwwBsE,EAAwB,SrB5qBvG,yCqB4qBuG,EAAgB,UA3J7F,8CA2J6F,CAA/E;7TACF,mGAAmB,UtCtyBxD,2BsCsyBwD,EAAoB,ahBzwBpE,qDgBywBoE,EAAwB,SrB7qBrG,yCqB6qBqG,EAAgB,UA3J9F,2CA2J8F,EAA2C,yBAA2B,8BAArJ;hXACD,kGAAmB,UtCvyBvD,2BsCuyBuD,EAAoB,ahB1wBnE,qDgB0wBmE,EAAwB,SrB9qBpG,yCqB8qBoG,EAAgB,UA5J7F,2CA4J6F,CAA/E;vTACX,uFAAmB,UtCxyB5C,2BsCwyB4C,EAAoB,ahB3wBxD,qDgB2wBwD,EAAwB,SPnwB7E,2DOmwB6E,EAAa,ePnwB1F,2DOmwB0F,EAAsC,8BAAlH;lXACD,sFAAmB,UtCzyB3C,2BsCyyB2C,EAAoB,ahB5wBvD,qDgB4wBuD,EAAwB,SPpwB5E,2DOowB4E,EAAa,ePpwBzF,2DOowByF,CAA5E;lVAEiB,uGAAmB,UtC3yB5D,2BsC2yB4D,EAAoB,ahB9wBxE,qDgB8wBwE,EAAwB,SrBlrBzG,yCqBkrByG,EAAiB,WAblG,4CAakG,EAA8C,gBAX3I,iDAW2I,EAAiD,yBAA2B,8BAA1M;zbACG,0GAAmB,UtC5yB/D,2BsC4yB+D,EAAoB,ahB/wB3E,qDgB+wB2E,EAAwB,SrBnrB5G,yCqBmrB4G,EAAiB,WAdrG,4CAcqG,EAA8C,gBAZ9I,iDAY8I,EAAiD,yBAA2B,8BAA1M;5bACJ,sGAAmB,UtC7yB3D,2BsC6yB2D,EAAoB,ahBhxBvE,qDgBgxBuE,EAAwB,SrBprBxG,yCqBorBwG,EAAiB,WAfjG,4CAeiG,EAA8C,gBAb1I,iDAa0I,CAA9H;hYACG,yGAAmB,UtC9yB9D,2BsC8yB8D,EAAoB,ahBjxB1E,qDgBixB0E,EAAwB,SrBrrB3G,yCqBqrB2G,EAAiB,WAhBpG,4CAgBoG,EAA8C,gBAd7I,iDAc6I,CAA9H;nYACA,yGAAmB,UtC/yB9D,2BsC+yB8D,EAAoB,ahBlxB1E,qDgBkxB0E,EAAwB,SrBtrB3G,yCqBsrB2G,EAAe,SPn1BrG,oEOm1BqG,EAAqC,sBAAsB,gBtC90BlL,6BsC80BkL,EAAuB,yBAA2B,8BAA3L;ndACD,wGAAmB,UtChzB7D,2BsCgzB6D,EAAoB,ahBnxBzE,qDgBmxByE,EAAwB,SrBvrB1G,yCqBurB0G,EAAe,SPp1BpG,oEOo1BoG,EAAqC,sBAAsB,gBtC/0BjL,6BsC+0BiL,CAAzI;1ZACH,qGAAmB,UtCjzB1D,2BsCizB0D,EAAoB,ahBpxBtE,qDgBoxBsE,EAAwB,SrBxrBvG,yCqBwrBuG,EAAgB,sBAAsB,gBtCh1B1I,6BsCg1B0I,EAAuB,yBAA2B,8BAAvJ;hYACD,oGAAmB,UtClzBzD,2BsCkzByD,EAAoB,ahBrxBrE,qDgBqxBqE,EAAwB,SrBzrBtG,yCqByrBsG,EAAgB,sBAAsB,gBtCj1BzI,6BsCi1ByI,CAArG;vUACZ,wFAAmB,UtCnzB7C,2BsCmzB6C,EAAoB,ahBtxBzD,qDgBsxByD,EAAwB,SrB1rB1F,yCqB0rB0F,EAAc,QtCn3BvG,WsCm3BuG,EAAM,QtCn3B7G,WsCm3B6G,EAAqB,ctCl1BhI,6BsCk1BgI,EAAqB,YtCl1BrJ,6BsCk1BqJ,EAAsB,atCn3B7K,WsCm3B6K,EAAgB,SPv1BzK,oEOu1ByK,EAAyC,yBAA2B,8BAAvO;zhBACD,uFAAmB,UtCpzB5C,2BsCozB4C,EAAoB,ahBvxBxD,qDgBuxBwD,EAAwB,SrB3rBzF,yCqB2rByF,EAAc,QtCp3BtG,WsCo3BsG,EAAM,QtCp3B5G,WsCo3B4G,EAAqB,ctCn1B/H,6BsCm1B+H,EAAqB,YtCn1BpJ,6BsCm1BoJ,EAAsB,atCp3B5K,WsCo3B4K,EAAgB,SPx1BxK,oEOw1BwK,CAAnK;heACa,oGAAmB,UtCrzBzD,2BsCqzByD,EAAoB,ahBxxBrE,qDgBwxBqE,EAAwB,SrB5rBtG,yCqB4rBsG,EAAc,QtCr3BnH,WsCq3BmH,EAAM,QtCr3BzH,WsCq3ByH,EAAqB,ctCp1B5I,6BsCo1B4I,EAAqB,YtCp1BjK,6BsCo1BiK,EAAsB,atCr3BzL,WsCq3ByL,EAAgB,SPz1BrL,oEOy1BqL,EAAyC,yBAA2B,8BAAvO;riBACD,mGAAmB,UtCtzBxD,2BsCszBwD,EAAoB,ahBzxBpE,qDgByxBoE,EAAwB,SrB7rBrG,yCqB6rBqG,EAAc,QtCt3BlH,WsCs3BkH,EAAM,QtCt3BxH,WsCs3BwH,EAAqB,ctCr1B3I,6BsCq1B2I,EAAqB,YtCr1BhK,6BsCq1BgK,EAAsB,atCt3BxL,WsCs3BwL,EAAgB,SP11BpL,oEO01BoL,CAAnK;5eACG,sGAAmB,UtCvzB3D,2BsCuzB2D,EAAoB,ahB1xBvE,qDgB0xBuE,EAAwB,SrB9rBxG,yCqB8rBwG,EAAkB,yBAAe,QtCv3BxI,WsCu3BwI,EAAM,QtCv3B9I,WsCu3B8I,EAAoB,atCt1BhK,6BsCs1BgK,EAAsB,atCv3BxL,WsCu3BwL,EAAgB,SP31BpL,oEO21BoL,EAAyC,yBAA2B,8BAApO;phBACD,qGAAmB,UtCxzB1D,2BsCwzB0D,EAAoB,ahB3xBtE,qDgB2xBsE,EAAwB,SrB/rBvG,yCqB+rBuG,EAAkB,yBAAe,QtCx3BvI,WsCw3BuI,EAAM,QtCx3B7I,WsCw3B6I,EAAoB,atCv1B/J,6BsCu1B+J,EAAsB,atCx3BvL,WsCw3BuL,EAAgB,SP51BnL,oEO41BmL,CAAhK;3dACT,4FAAmB,UtCzzBjD,2BsCyzBiD,EAAoB,ahB5xB7D,qDgB4xB6D,EAAwB,SrBhsB9F,yCqBgsB8F,EAAmB,atCz3BhH,WsCy3BgH,EAAgB,SP71B5G,oEO61B4G,EAAyC,yBAA2B,8BAAtK;3ZACD,2FAAmB,UtC1zBhD,2BsC0zBgD,EAAoB,ahB7xB5D,qDgB6xB4D,EAAwB,SrBjsB7F,yCqBisB6F,EAAmB,atC13B/G,WsC03B+G,EAAgB,SP91B3G,oEO81B2G,CAAlG;lWACF,yFAAmB,UtC3zB9C,2BsC2zB8C,EAAoB,ahB9xB1D,qDgB8xB0D,EAAwB,SrBlsB3F,yCqBksB2F,EAAgB,UtC33B1G,WsC23B0G,EAAgB,kBtC33B1H,WsC23B0H,EAAc,gBtC33BxI,WsC23BwI,EAAgB,SP/1BpI,oEO+1BoI,EAAyC,yBAA2B,8BAAjM;jdACD,wFAAmB,UtC5zB7C,2BsC4zB6C,EAAoB,ahB/xBzD,qDgB+xByD,EAAwB,SrBnsB1F,yCqBmsB0F,EAAgB,UtC53BzG,WsC43ByG,EAAgB,kBtC53BzH,WsC43ByH,EAAc,gBtC53BvI,WsC43BuI,EAAgB,SPh2BnI,oEOg2BmI,CAA7H;xZACM,8FAAmB,UtC7zBnD,2BsC6zBmD,EAAoB,ahBhyB/D,qDgBgyB+D,EAAwB,SrBpsBhG,yCqBosBgG,EAAgB,sBAAkB,yBAAe,QtC73BhJ,WsC63BgJ,EAAgB,SPj2B5I,oEOi2B4I,EAAyC,yBAA2B,8BAApM;vcACD,6FAAmB,UtC9zBlD,2BsC8zBkD,EAAoB,ahBjyB9D,qDgBiyB8D,EAAwB,SrBrsB/F,yCqBqsB+F,EAAgB,sBAAkB,yBAAe,QtC93B/I,WsC83B+I,EAAgB,SPl2B3I,oEOk2B2I,CAAhI;9YACL,wFAAmB,UtC/zB7C,2BsC+zB6C,EAAoB,ahBlyBzD,qDgBkyByD,EAAwB,SrBtsB1F,yCqBssB0F,EAAgB,sBAAc,QtC/3BvH,WsC+3BuH,EAAgB,SPn2BnH,oEOm2BmH,EAAyC,yBAA2B,8BAAjL;xaACD,uFAAmB,UtCh0B5C,2BsCg0B4C,EAAoB,ahBnyBxD,qDgBmyBwD,EAAwB,SrBvsBzF,yCqBusByF,EAAgB,sBAAc,QtCh4BtH,WsCg4BsH,EAAgB,SPp2BlH,oEOo2BkH,CAA7G;/WACC,wFAAmB,UtCj0B7C,2BsCi0B6C,EAAoB,ahBpyBzD,qDgBoyByD,EAAwB,SrBxsB1F,yCqBwsB0F,EAAe,SP5xB7F,2DO4xB6F,EAAgC,yBAA2B,8BAAzI;pXACD,uFAAmB,UtCl0B5C,2BsCk0B4C,EAAoB,ahBryBxD,qDgBqyBwD,EAAwB,SrBzsBzF,yCqBysByF,EAAe,SP7xB5F,2DO6xB4F,CAA9E;3TACK,4FAAmB,UtCn0BjD,2BsCm0BiD,EAAoB,ahBtyB7D,qDgBsyB6D,EAAwB,SrB1sB9F,yCqB0sB8F,EAAe,SP9xBjG,2DO8xBiG,EAAgC,yBAA2B,8BAAzI;xXACD,2FAAmB,UtCp0BhD,2BsCo0BgD,EAAoB,ahBvyB5D,qDgBuyB4D,EAAwB,SrB3sB7F,yCqB2sB6F,EAAe,SP/xBhG,2DO+xBgG,CAA9E;/TACC,4FAAmB,UtCr0BjD,2BsCq0BiD,EAAoB,ahBxyB7D,qDgBwyB6D,EAAwB,SrB5sB9F,yCqB4sB8F,EAAe,SPhyBjG,2DOgyBiG,EAAgC,yBAA2B,8BAAzI;xXACD,2FAAmB,UtCt0BhD,2BsCs0BgD,EAAoB,ahBzyB5D,qDgByyB4D,EAAwB,SrB7sB7F,yCqB6sB6F,EAAe,SPjyBhG,2DOiyBgG,CAA9E;/TACG,8FAAmB,UtCv0BnD,2BsCu0BmD,EAAoB,ahB1yB/D,qDgB0yB+D,EAAwB,SrB9sBhG,yCqB8sBgG,EAAe,SPlyBnG,2DOkyBmG,EAAgC,yBAA2B,8BAAzI;1XACD,6FAAmB,UtCx0BlD,2BsCw0BkD,EAAoB,ahB3yB9D,qDgB2yB8D,EAAwB,SrB/sB/F,yCqB+sB+F,EAAe,SPnyBlG,2DOmyBkG,CAA9E;jUACA,6FAAmB,UtCz0BlD,2BsCy0BkD,EAAoB,ahB5yB9D,qDgB4yB8D,EAAwB,SrBhtB/F,yCqBgtB+F,EAAe,SPpyBlG,2DOoyBkG,EAA4B,sBAAoB,yBAA2B,8BAAzJ;/YACD,4FAAmB,UtC10BjD,2BsC00BiD,EAAoB,ahB7yB7D,qDgB6yB6D,EAAwB,SrBjtB9F,yCqBitB8F,EAAe,SPryBjG,2DOqyBiG,EAA4B,qBAA1G;tVACG,+FAAmB,UtC30BpD,2BsC20BoD,EAAgB,SPtyBzD,2DOsyByD,EAAuC,iBAntB3E,0BAmtB2E,EAA1E;zPACO,sGAAmB,UtC50B3D,2BsC40B2D,EAAgB,SPvyBhE,2DOuyBgE,EAAmC,iBAptB9E,yBAotB8E,CAAtE;9PACJ,kGAAmB,UtC70BvD,2BsC60BuD,EAAgB,SPxyB5D,2DOwyB4D,EAAmC,iBArtB1E,yBAqtB0E,CAAtE;1PACA,kGAAmB,UtC90BvD,2BsC80BuD,EAAwB,iBAttB/C,yBAstB+C,EAAgD,SPzyBpH,2DOyyBoH,CAA3F;1PAET,yFAAmB,UtCh1B9C,2BsCg1B8C,EAAoB,atCh5BlE,WsCg5BkE,EAAgB,SPp3B9D,oEOo3B8D,EAAwC,sBAA/F;/PACO,gGAAmB,UtCj1BrD,2BsCi1BqD,EAAoB,ahBpzBjE,qDgBozBiE,EAAwB,SrBxtBlG,yCqBwtBkG,EAAmB,atCj5BpH,WsCi5BoH,EAAgB,SPr3BhH,oEOq3BgH,EAAoC,qBAAoB,wBAA1J;rZACD,+FAAmB,UtCl1BpD,2BsCk1BoD,EAAoB,ahBrzBhE,qDgBqzBgE,EAAwB,SrBztBjG,yCqBytBiG,EAAmB,atCl5BnH,WsCk5BmH,EAAgB,SPt3B/G,oEOs3B+G,EAAoC,oBAAtI;3XACT,sFAAmB,UtCn1B3C,2BsCm1B2C,EAAiB,UtCn5B5D,WsCm5B4D,EAAgB,SPv3BxD,oEOu3BwD,EAAwC,sBAA5F;zPACO,6FAAmB,UtCp1BlD,2BsCo1BkD,EAAoB,ahBvzB9D,qDgBuzB8D,EAAwB,SrB3tB/F,yCqB2tB+F,EAAgB,UtCp5B9G,WsCo5B8G,EAAgB,kBtCp5B9H,WsCo5B8H,EAAc,gBtCp5B5I,WsCo5B4I,EAAgB,SPx3BxI,oEOw3BwI,EAAoC,qBAAoB,wBAArL;3cACD,4FAAmB,UtCr1BjD,2BsCq1BiD,EAAoB,ahBxzB7D,qDgBwzB6D,EAAwB,SrB5tB9F,yCqB4tB8F,EAAgB,UtCr5B7G,WsCq5B6G,EAAgB,kBtCr5B7H,WsCq5B6H,EAAc,gBtCr5B3I,WsCq5B2I,EAAgB,SPz3BvI,oEOy3BuI,EAAoC,oBAAjK;jbACP,qFAAmB,UtCt1B1C,2BsCs1B0C,EAAiB,sBAAc,QtCt5BzE,WsCs5ByE,EAAmB,yBAAgB,SP13BxF,oEO03BwF,EAAwC,sBAA7H;rSACO,4FAAmB,UtCv1BjD,2BsCu1BiD,EAAoB,ahB1zB7D,qDgB0zB6D,EAAwB,SrB9tB9F,yCqB8tB8F,EAAgB,sBAAc,QtCv5B3H,WsCu5B2H,EAAmB,yBAAgB,SP33B1I,oEO23B0I,EAAoC,qBAAoB,wBAAxL;3bACD,2FAAmB,UtCx1BhD,2BsCw1BgD,EAAoB,ahB3zB5D,qDgB2zB4D,EAAwB,SrB/tB7F,yCqB+tB6F,EAAgB,sBAAc,QtCx5B1H,WsCw5B0H,EAAmB,yBAAgB,SP53BzI,oEO43ByI,EAAoC,oBAApK;jaACF,yFAAmB,UtCz1B9C,2BsCy1B8C,EAAgB,SPpzBnD,2DOozBmD,EAA6B,sBAAhE;5NACJ,qFAAmB,UtC11B1C,2BsC01B0C,EAAgB,SPrzB/C,2DOqzB+C,EAA2B,SA9DnE,uCA8DmE,EAAsC,sBAApG;1QACO,4FAAmB,UtC31BjD,2BsC21BiD,EAAoB,ahB9zB7D,qDgB8zB6D,EAAwB,SrBluB9F,yCqBkuB8F,EAAe,SPtzBjG,2DOszBiG,EAA2B,qBAAoB,wBAA7H;9WACD,2FAAmB,UtC51BhD,2BsC41BgD,EAAoB,ahB/zB5D,qDgB+zB4D,EAAwB,SrBnuB7F,yCqBmuB6F,EAAe,SPvzBhG,2DOuzBgG,EAA2B,oBAAzG;pVACD,0FAAmB,UtC71B/C,2BsC61B+C,EAAgB,SPxzBpD,2DOwzBoD,EAA2B,SAjExE,uCAiEwE,EAAuC,uBAArG;hRACO,iGAAmB,UtC91BtD,2BsC81BsD,EAAoB,ahBj0BlE,qDgBi0BkE,EAAwB,SrBruBnG,yCqBquBmG,EAAe,SPzzBtG,2DOyzBsG,EAA4B,sBAAoB,wBAA9H;pXACD,gGAAmB,UtC/1BrD,2BsC+1BqD,EAAoB,ahBl0BjE,qDgBk0BiE,EAAwB,SrBtuBlG,yCqBsuBkG,EAAe,SP1zBrG,2DO0zBqG,EAA4B,qBAA1G;1VAEP,yFAAmB,UtCj2B9C,2BsCi2B8C,EAAgB,SP5zBnD,2DO4zBmD,EAAoC,4BAAvE;lOACC,0FAAmB,UtCl2B/C,2BsCk2B+C,EAAqB,ctCj4BlE,6BsCi4BkE,EAAU,YtCj4B5E,6BsCi4B4E,EAAsB,atCl6BpG,WsCk6BoG,EAAgB,SP7zBzG,2DO6zByG,EAA6C,uBAnuBxI,+CAmuBwI,EAArI;jYACE,4FAAmB,UtCn2BjD,2BsCm2BiD,EAAoB,atCl4BnE,6BsCk4BmE,EAAsB,atCn6B3F,WsCm6B2F,EAAwB,2BAArF;pOACA,4FAAmB,UtCp2BjD,2BsCo2BiD,EAAoB,atCn4BnE,6BsCm4BmE,EAAsB,atCp6B3F,WsCo6B2F,EAAwB,2BAArF;pOACL,uFAAmB,UtCr2B5C,2BsCq2B4C,EAAoB,atCp4B9D,6BsCo4B8D,EAAuB,wBAA9D;lMACC,wFAAmB,UtCt2B7C,2BsCs2B6C,EAAsB,yBAAzC;xJACJ,oFAAmB,UtCv2BzC,2BsCu2ByC,EAAqB,ctCt4B5D,6BsCs4B4D,EAAU,YtCt4BtE,6BsCs4BsE,EAAsB,atCv6B9F,WsCu6B8F,CAAxE;5OACA,oFAAmB,UtCx2BzC,2BsCw2ByC,EAAqB,cT51BnD,2DS41BmD,EAAU,YT51B7D,2DS41B6D,CAAlD;9QACM,0FAAmB,UtCz2B/C,2BsCy2B+C,EAAqB,ctCx4BlE,6BsCw4BkE,EAAU,YtCx4B5E,6BsCw4B4E,EAAsB,atCz6BpG,WsCy6BoG,EAAqB,wBAAmB,uBAAwB,4BAAxI;9TACD,yFAAmB,UtC12B9C,2BsC02B8C,EAAqB,ctCz4BjE,6BsCy4BiE,EAAU,YtCz4B3E,6BsCy4B2E,EAAsB,atC16BnG,WsC06BmG,EAAgB,SPr0BxG,2DOq0BwG,CAAxF;vTACC,0FAAmB,UtC32B/C,2BsC22B+C,EAAqB,ctC14BlE,6BsC04BkE,EAAU,YtC14B5E,6BsC04B4E,EAAsB,atC36BpG,WsC26BoG,EAAgB,SPt0BzG,2DOs0ByG,EAAgC,wBAAmB,uBAAwB,4BAAnK;pYACD,yFAAmB,UtC52B9C,2BsC42B8C,EAAqB,ctC34BjE,6BsC24BiE,EAAU,YtC34B3E,6BsC24B2E,EAAsB,atC56BnG,WsC46BmG,EAAgB,SPv0BxG,2DOu0BwG,CAAxF;vTACO,gGAAmB,UtC72BrD,2BsC62BqD,EAAqB,ctC54BxE,6BsC44BwE,EAAU,YtC54BlF,6BsC44BkF,EAAsB,atC76B1G,WsC66B0G,EAAuB,0BAA/F;nRACD,+FAAmB,UtC92BpD,2BsC82BoD,EAAqB,ctC74BvE,6BsC64BuE,EAAU,YtC74BjF,6BsC64BiF,EAAsB,atC96BzG,WsC86ByG,CAAxE;vPACC,gGAAmB,UtC/2BrD,2BsC+2BqD,EAAqB,ctC94BxE,6BsC84BwE,EAAU,YtC94BlF,6BsC84BkF,EAAsB,atC/6B1G,WsC+6B0G,EAAgB,SP10B/G,2DO00B+G,EAAkC,0BAA1H;zVACD,+FAAmB,UtCh3BpD,2BsCg3BoD,EAAqB,ctC/4BvE,6BsC+4BuE,EAAU,YtC/4BjF,6BsC+4BiF,EAAsB,atCh7BzG,WsCg7ByG,EAAgB,SP30B9G,2DO20B8G,CAAxF;7TACE,iGAAmB,UtCj3BtD,2BsCi3BsD,EAAqB,ctCh5BzE,6BsCg5ByE,EAAU,YtCh5BnF,6BsCg5BmF,EAAsB,atCj7B3G,WsCi7B2G,EAAgB,SP50BhH,2DO40BgH,EAAkC,0BAA1H;1VACD,gGAAmB,UtCl3BrD,2BsCk3BqD,EAAqB,ctCj5BxE,6BsCi5BwE,EAAU,YtCj5BlF,6BsCi5BkF,EAAsB,atCl7B1G,WsCk7B0G,EAAgB,SP70B/G,2DO60B+G,EAAoC,kBA3vB1I,yBA2vB0I,EAAiD,sBrBzvBhN,yCqByvBgN,CAA7K;5aACJ,4FAAmB,UtCn3BjD,2BsCm3BiD,EAAqB,ctCl5BpE,6BsCk5BoE,EAAU,YtCl5B9E,6BsCk5B8E,EAAsB,atCn7BtG,WsCm7BsG,EAAgB,SP90B3G,2DO80B2G,EAAgC,2BAAwB,2BAAhJ;jXACD,2FAAmB,UtCp3BhD,2BsCo3BgD,EAAqB,ctCn5BnE,6BsCm5BmE,EAAU,YtCn5B7E,6BsCm5B6E,EAAsB,atCp7BrG,WsCo7BqG,EAAgB,SP/0B1G,2DO+0B0G,EAAgC,2BAAwB,2BAAhJ;hXACA,2FAAmB,UtCr3BhD,2BsCq3BgD,EAAqB,ctCp5BnE,6BsCo5BmE,EAAU,YtCp5B7E,6BsCo5B6E,EAAsB,atCr7BrG,WsCq7BqG,EAAgB,SPh1B1G,2DOg1B0G,EAAgC,2BAAwB,2BAAhJ;hXAED,0FAAmB,UtCv3B/C,2BsCu3B+C,EAAgB,SPl1BpD,2DOk1BoD,EAA2B,SAtFrE,0CAsFqE,EAA8C,4BAA5G;xRACA,0FAAmB,UtCx3B/C,2BsCw3B+C,EAAgB,SPn1BpD,2DOm1BoD,EAAoC,4BAAvE;nOACD,yFAAmB,UtCz3B9C,2BsCy3B8C,EAAgB,SPp1BnD,2DOo1BmD,CAAnC;rMACA,yFAAmB,UtC13B9C,2BsC03B8C,EAAqB,ctC17BnE,WsC07BmE,EAAiB,sBAAe,SAzF9E,0CAyF8E,CAAxE;rOACD,wFAAmB,UtC33B7C,2BsC23B6C,EAAgB,SPt1BlD,2DOs1BkD,EAAuC,iBtC15BlG,8BsC05BkG,GAA4B,etC15B9H,8BsC05B8H,GAA6B,gBtC37B7J,YsC27B6J,GAAuB,0BAA1J;hWACA,wFAAmB,UtC53B7C,2BsC43B6C,EAAgB,SPv1BlD,2DOu1BkD,EAAuC,iBtC35BlG,8BsC25BkG,GAA4B,etC35B9H,8BsC25B8H,GAA6B,gBtC57B7J,YsC47B6J,GAAuB,0BAA1J;hWACD,uFAAmB,UtC73B5C,2BsC63B4C,EAAgB,SPx1BjD,2DOw1BiD,EAAmC,iBtC55B7F,6BsC45B6F,EAAa,etC55B1G,6BsC45B0G,EAAyB,gBtC77BrI,WsC67BqI,CAA5G;9TACA,uFAAmB,UtC93B5C,2BsC83B4C,EAAgB,SPz1BjD,2DOy1BiD,EAAmC,iBtC75B7F,6BsC65B6F,EAAa,etC75B1G,6BsC65B0G,EAAyB,gBtC97BrI,WsC87BqI,CAA5G;9TACL,kFAAmB,UtC/3BvC,2BsC+3BuC,EAAgB,SP11B5C,2DO01B4C,EAAmC,iBtC95BxF,6BsC85BwF,EAAa,etC95BrG,6BsC85BqG,EAAyB,gBtC/7BhI,WsC+7BgI,CAA5G;zTACA,kFAAmB,UtCh4BvC,2BsCg4BuC,EAAgB,SP31B5C,2DO21B4C,EAAmC,iBtC/5BxF,6BsC+5BwF,EAAa,etC/5BrG,6BsC+5BqG,EAAyB,gBtCh8BhI,WsCg8BgI,CAA5G;zTACF,gFAAmB,UtCj4BrC,2BsCi4BqC,EAAoB,a5Bh9B1D,U4Bg9B0D,CAAvC;/IACc,8FAAmB,UtCl4BnD,2BsCk4BmD,EAAoB,ahBr2B/D,qDgBq2B+D,EAAwB,SrBzwBhG,yCqBywBgG,EAAe,SP71BnG,2DO61BmG,EAAkC,6BAAiB,UtCj6B/J,6BsCi6B+J,EAAuB,yBAA2B,8BAAnL;hcACI,kGAAmB,UtCn4BvD,2BsCm4BuD,EAAoB,ahBt2BnE,qDgBs2BmE,EAAwB,SrB1wBpG,yCqB0wBoG,EAAe,SP91BvG,2DO81BuG,EAAkC,6BAAiB,UtCl6BnK,6BsCk6BmK,EAAkB,qBAAoB,wBAAvK;1bACL,6FAAmB,UtCp4BlD,2BsCo4BkD,EAAoB,ahBv2B9D,qDgBu2B8D,EAAwB,SrB3wB/F,yCqB2wB+F,EAAe,SP/1BlG,2DO+1BkG,EAAkC,6BAAiB,UtCn6B9J,6BsCm6B8J,CAAjI;vYACI,iGAAmB,UtCr4BtD,2BsCq4BsD,EAAoB,ahBx2BlE,qDgBw2BkE,EAAwB,SrB5wBnG,yCqB4wBmG,EAAe,SPh2BtG,2DOg2BsG,EAAkC,6BAAiB,UtCp6BlK,6BsCo6BkK,EAAkB,oBAAnJ;haACN,2FAAmB,UtCt4BhD,2BsCs4B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BAAK,CAAC,EAAG,EAAG,gBAAO,gBAAd,GAAuB,4CAAkB,CAAC,GAAD,EhBpghBqB,KAClE,MAA0B,KAA2B,KgBmghBvD,CADtB;lOA/B2C;AAjmfb;AAqBH;;AACzB;;;;AADyB;aACzB;bADyB;;AAIF;;AACvB;;;;AADuB;aACvB;bADuB;;AAIF;;AACrB;AACA;;AADA;AACA;;AAFqB;aACrB,wBACA;rCAFqB;;AAKI;;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AApByB;aACzB,kCACA,IACA,CADA,gDACA,IACA,CADA,wBACA,IACA,CADA,wCACA,IACA,CADA,wCACA,IACA,CADA,oCACA,IACA,CADA,oCACA,IACA,CADA,gCACA,IACA,CADA,8BACA,IACA,CADA,kCACA,IACA,CADA,gCACA,IACA,CADA,0CACA,IACA,CADA,sCACA,IACA,CADA,oCACA,IACA,CADA,8BACA,IACA,CADA,sCACA,IACA,CADA,sCACA,IACA,CADA,wCACA,IACA,CADA,sCACA,uDADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA,CADA;71BAFyB;;AA6BJ;AAo6fe;AAAP;AAE/B,eAAmB,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAFY;AAAO;AAp6ff;AAOI;AAu6fe;AAAP;AAEnC,eAA4B,cAAW,QAAK,CAAC,KAAD,CAAhB;5CAFO;AAAO;AAv6ff;AAaO;AAMX;AAES;;;AAE9B;AACA;AAH8B;;AAE9B,mBAF8B;nBAG9B,uBAH8B;;;vBAy/BqB;AAGrD;AACA,UAAc,CAAV,SAAU,KAAE,+BAAF,CAAY,IAAgB,CAAX,UAAW,KAAE,aAAF,CAA1C,EACE,gBAAW,IADb;jHAJqD;AAnBJ;AAEjD;AAEA;AACA,UAAW,CAAC,MAAD,SAAS,IAAe,+BAAH,eAAP,MAAO,CAAhC;nFAEE,iBAAS,SAA2B,QAAtB,MAAM,kBAAC,EAAe,GAAE,CAAF,qBAApC;rFAAI;AAEF,cAA4B,yBAAH,eAArB,MAAM,aAAW,CAAC,CAAD,CAAI,CAAzB;7EAEE,4BAAgC,OAArB,MAAM,aAAW,CAAC,CAAD,EAAO,yBAAH;nFAChC,yBAAO,cAAP,GAAwB;1CACxB;WAJF;;JAJJ;PALiD;AAt+BjB;AAeZ;;;AAElB;AACA;AACA;AACA;AACA;AACA;AAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AAA+B;AAC/B;AAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AAAsB;AACtB;AACA;AACA;AACA;AACA;AAAe;AAAiB;AAAa;AAC7C;AACA;AACA;AAMA;AACA;AACA;AACA;AAAuB;AAAmB;AAC1C;AAA8B;AAC9B;AACA;AACA;AAAgB;AAAc;AAC9B;AAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAqB;AACrB;AACA;AACA;AAAe;AAAW;AAC1B;AAAmB;AAAiB;AAAkB;AACtD;AAAe;AAAa;AAAc;AAC1C;AACA;AACA;AACA;AAAkB;AAClB;AAAW;AAAW;AACtB;AAAW;AACX;AACA;AAAkB;AAClB;AACA;AAAU;AAAqB;AAC/B;AACA;AAAM;AACN;AAAuB;AACvB;AAAU;AAAU;AAAQ;AAAQ;AAAS;AAC7C;AAAY;AACZ;AAAY;AACZ;AAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A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"}